/*!
*  filename: ej2-spreadsheet.min.js
*  version : 29.2.5
*  Copyright Syncfusion Inc. 2001 - 2024. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("SyncfusionBase"),require("SyncfusionData"),require("SyncfusionPopups"),require("SyncfusionNavigations"),require("SyncfusionInputs"),require("SyncfusionButtons"),require("SyncfusionDropdowns"),require("SyncfusionLists"),require("SyncfusionSplitbuttons"),require("SyncfusionGrids"),require("SyncfusionCharts")):"function"==typeof define&&define.amd?define(["SyncfusionBase","SyncfusionData","SyncfusionPopups","SyncfusionNavigations","SyncfusionInputs","SyncfusionButtons","SyncfusionDropdowns","SyncfusionLists","SyncfusionSplitbuttons","SyncfusionGrids","SyncfusionCharts"],t):"object"==typeof exports?exports.SyncfusionSpreadsheet=t(require("SyncfusionBase"),require("SyncfusionData"),require("SyncfusionPopups"),require("SyncfusionNavigations"),require("SyncfusionInputs"),require("SyncfusionButtons"),require("SyncfusionDropdowns"),require("SyncfusionLists"),require("SyncfusionSplitbuttons"),require("SyncfusionGrids"),require("SyncfusionCharts")):e.SyncfusionSpreadsheet=t(e.SyncfusionBase,e.SyncfusionData,e.SyncfusionPopups,e.SyncfusionNavigations,e.SyncfusionInputs,e.SyncfusionButtons,e.SyncfusionDropdowns,e.SyncfusionLists,e.SyncfusionSplitbuttons,e.SyncfusionGrids,e.SyncfusionCharts)}(self,((e,t,r,n,i,a,o,s,l,d,h)=>(()=>{"use strict";var p={766:t=>{t.exports=e},741:e=>{e.exports=a},60:e=>{e.exports=h},74:e=>{e.exports=t},778:e=>{e.exports=o},707:e=>{e.exports=d},323:e=>{e.exports=i},90:e=>{e.exports=s},215:e=>{e.exports=n},197:e=>{e.exports=r},295:e=>{e.exports=l}},c={};function u(e){var t=c[e];if(void 0!==t)return t.exports;var r=c[e]={exports:{}};return p[e](r,r.exports,u),r.exports}u.d=(e,t)=>{for(var r in t)u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var f={};return(()=>{u.r(f),u.d(f,{AutoFill:()=>Lh,AutoFillSettings:()=>z,Axis:()=>H,BasicFormulas:()=>Is,Border:()=>L,CalcSheetFamilyItem:()=>Ds,Calculate:()=>Os,CalculateCommon:()=>bs,Cell:()=>Vn,CellFormat:()=>uh,CellRenderer:()=>rh,CellStyle:()=>w,Chart:()=>U,Clipboard:()=>oh,Column:()=>wl,CommonErrors:()=>Xn,ConditionalFormat:()=>F,ConditionalFormatting:()=>Th,ContextMenu:()=>Jh,DISABLED:()=>Fl,DataBind:()=>Jn,DataLabelSettings:()=>D,DataValidation:()=>Rh,DefineName:()=>N,Delete:()=>wh,Edit:()=>sh,ExcelFileFormats:()=>$n,Filter:()=>rp,FilterCollection:()=>I,FindAndReplace:()=>Oh,Format:()=>O,Formula:()=>Xh,FormulaBar:()=>Yh,FormulaError:()=>Fs,FormulaInfo:()=>Ts,FormulasErrorsStrings:()=>Kn,Hyperlink:()=>A,Image:()=>V,Insert:()=>Sh,KeyboardNavigation:()=>ph,KeyboardShortcut:()=>ch,LegendSettings:()=>T,MajorGridLines:()=>M,MarkerSettings:()=>P,Merge:()=>Fh,MinorGridLines:()=>B,NumberFormat:()=>Qh,Open:()=>$h,OpenSettings:()=>Zn,Parser:()=>Es,ProtectSettings:()=>R,ProtectSheet:()=>kh,Range:()=>xn,Render:()=>nh,Resize:()=>gh,Ribbon:()=>Gh,Row:()=>ul,RowRenderer:()=>th,Save:()=>Zh,Scroll:()=>dh,ScrollSettings:()=>Jd,Selection:()=>lh,SelectionSettings:()=>Qd,Sheet:()=>wn,SheetRender:()=>eh,SheetTabs:()=>Kh,ShowHide:()=>mh,Sort:()=>ep,SortCollection:()=>E,Spreadsheet:()=>dp,SpreadsheetChart:()=>ap,SpreadsheetHyperlink:()=>yh,SpreadsheetImage:()=>np,SpreadsheetNote:()=>Ph,UndoRedo:()=>bh,UsedRange:()=>Sn,Validation:()=>k,ValueChangedArgs:()=>Bs,VirtualScroll:()=>hh,WRAPTEXT:()=>Tl,Workbook:()=>hl,WorkbookAutoFill:()=>al,WorkbookCellFormat:()=>Xs,WorkbookChart:()=>Ys,WorkbookConditionalFormat:()=>il,WorkbookDataValidation:()=>Qs,WorkbookDelete:()=>Js,WorkbookEdit:()=>Ks,WorkbookFilter:()=>Ws,WorkbookFindAndReplace:()=>tl,WorkbookFormula:()=>Hs,WorkbookHyperlink:()=>$s,WorkbookImage:()=>Gs,WorkbookInsert:()=>Zs,WorkbookMerge:()=>nl,WorkbookNumberFormat:()=>Us,WorkbookOpen:()=>gs,WorkbookProtectSheet:()=>rl,WorkbookSave:()=>Cs,WorkbookSort:()=>qs,WrapText:()=>xh,actionEvents:()=>Pl,activeCellChanged:()=>ve,activeCellMergedRange:()=>Et,activeSheetChanged:()=>ra,addChartEle:()=>jo,addContextMenuItems:()=>Vi,addDPRValue:()=>tn,addFileMenuItems:()=>Wi,addHighlight:()=>et,addHyperlink:()=>Ue,addListValidationDropdown:()=>vr,addNote:()=>ca,addRibbonTabs:()=>Xi,addToolbarItems:()=>Ki,addressHandle:()=>bo,afterHyperlinkClick:()=>He,afterHyperlinkCreate:()=>Me,aggregateComputation:()=>Se,applyCF:()=>kt,applyCellFormat:()=>le,applyLockCells:()=>xt,applyMerge:()=>wt,applyNumberFormatting:()=>te,applyPredicates:()=>Zr,applyProtect:()=>Ga,applySort:()=>ia,autoFill:()=>ns,autoFit:()=>oa,beforeCellUpdate:()=>ar,beforeCheckboxRender:()=>ds,beforeContentLoaded:()=>yi,beforeDataBound:()=>Ui,beforeDelete:()=>Wt,beforeFilter:()=>ze,beforeHyperlinkClick:()=>Be,beforeHyperlinkCreate:()=>Pe,beforeInsert:()=>qt,beforeRibbonCreate:()=>Zi,beforeSort:()=>ke,beforeVirtualContentLoaded:()=>Ci,beginAction:()=>K,beginSave:()=>X,cMenuBeforeOpen:()=>Ii,calculateFormula:()=>ne,cellNavigate:()=>Si,cellValidation:()=>Qe,chartDesignTab:()=>zo,chartRangeSelection:()=>Ho,checkColumnValidation:()=>kl,checkDateFormat:()=>ue,checkFormulaRef:()=>lr,checkIsFormula:()=>wr,checkMerge:()=>lo,checkNumberFormat:()=>fe,checkPrevMerge:()=>so,checkRange:()=>Wr,checkUniqueRange:()=>Ee,clear:()=>Ft,clearAllFilter:()=>We,clearCF:()=>Tt,clearCFRule:()=>Ot,clearCellRef:()=>yo,clearChartBorder:()=>Mo,clearCopy:()=>Bi,clearFilter:()=>Da,clearFormulaDependentCells:()=>Re,clearInvalid:()=>qa,clearRange:()=>Ud,clearUndoRedoCollection:()=>Ra,clearViewer:()=>go,click:()=>hi,colWidthChanged:()=>Qi,collaborativeUpdate:()=>aa,columnIndex:()=>Lr,commputeFormulaValue:()=>pr,completeAction:()=>Pa,configureLocalizedFormat:()=>_s,contentLoaded:()=>ii,contextMenuOpen:()=>xi,convertToDefaultFormat:()=>js,copy:()=>Pi,count:()=>pt,createHyperlinkElement:()=>ba,createImageElement:()=>Ao,createNoteIndicator:()=>ma,created:()=>Ja,cut:()=>Li,dataBound:()=>Hi,dataChanged:()=>W,dataSourceChanged:()=>q,dataValidate:()=>tt,dateToInt:()=>sn,deInitProperties:()=>ta,defaultLocale:()=>Vl,deleteAction:()=>Ke,deleteChart:()=>Oo,deleteChartColl:()=>Ut,deleteFormatRange:()=>_r,deleteHyperlink:()=>Gt,deleteImage:()=>ko,deleteModel:()=>Ze,deleteNote:()=>fa,destroyComponent:()=>yd,dialog:()=>Ll,duplicateSheet:()=>Bn,duplicateSheetFilterHandler:()=>or,editAlert:()=>eo,editHyperlink:()=>ha,editNote:()=>ua,editOperation:()=>si,editValue:()=>Co,enableContextMenuItems:()=>ji,enableFileMenuItems:()=>_i,enableFormulaInput:()=>io,enableRibbonTabs:()=>Yi,enableToolbarItems:()=>Oi,evaluate:()=>hn,executeTaskAsync:()=>v,exportDialog:()=>J,fillColor:()=>Hl,filterByCellValue:()=>Ta,filterCellKeyDown:()=>Ma,filterComplete:()=>_e,filterRangeAlert:()=>qe,find:()=>rt,findAllValues:()=>oe,findCount:()=>ct,findDlg:()=>$a,findHandler:()=>Za,findKeyUp:()=>lt,findMaxValue:()=>Sd,findToolDlg:()=>Z,findWorkbookHandler:()=>it,finiteAlert:()=>ro,focus:()=>Md,focusBorder:()=>Po,focusChartBorder:()=>zt,focusRenameInput:()=>vi,fontColor:()=>Bl,forRefSelRender:()=>So,formulaBar:()=>ei,formulaBarOperation:()=>di,formulaBarUpdate:()=>fi,formulaInValidation:()=>Ae,formulaKeyUp:()=>ui,formulaOperation:()=>li,freeze:()=>$o,getAddressFromSelectedRange:()=>d,getAddressInfo:()=>h,getAlphalabel:()=>Ls,getAutoDetectFormatParser:()=>$r,getBeforeActionData:()=>Na,getBorderHeight:()=>Fd,getBorderWidth:()=>Od,getBottomOffset:()=>Vd,getCell:()=>zn,getCellAddress:()=>i,getCellIndexes:()=>r,getCellPosition:()=>$l,getCellRefValue:()=>hr,getChartColIdxFromClientX:()=>ur,getChartRowIdxFromClientY:()=>cr,getChartsIndexes:()=>qd,getClientX:()=>pd,getClientY:()=>cd,getColGroupWidth:()=>_l,getColIdxFromClientX:()=>Ro,getColIndex:()=>n,getColorCode:()=>Wn,getColumn:()=>Il,getColumnHeaderText:()=>o,getColumnWidth:()=>Nl,getColumnsWidth:()=>Rl,getCustomColors:()=>Gn,getDPRValue:()=>gd,getData:()=>gn,getDataRange:()=>zr,getEndEvent:()=>nd,getExcludedColumnWidth:()=>Td,getFillInfo:()=>$t,getFilterRange:()=>Ba,getFilteredColumn:()=>La,getFormatFromType:()=>Vs,getFormattedBarText:()=>me,getFormattedCellObject:()=>re,getGcd:()=>an,getIndexesFromAddress:()=>s,getLeadingSpaces:()=>Hr,getLineHeight:()=>Rd,getLines:()=>kd,getMaxHgt:()=>Pd,getMaxSheetId:()=>Dn,getModel:()=>vn,getMoveEvent:()=>rd,getPageX:()=>ud,getPageY:()=>fd,getRangeAddress:()=>a,getRangeFromAddress:()=>l,getRangeIndexes:()=>t,getRequiredModules:()=>Ol,getRightIdx:()=>zd,getRow:()=>fl,getRowHeight:()=>yl,getRowIdxFromClientY:()=>No,getRowsHeight:()=>bl,getScrollBarWidth:()=>Gl,getSelectedRange:()=>kn,getSheet:()=>Fn,getSheetIndex:()=>In,getSheetIndexByName:()=>Rn,getSheetIndexFromAddress:()=>p,getSheetIndexFromId:()=>En,getSheetName:()=>Pn,getSheetNameCount:()=>Tn,getSheetNameFromAddress:()=>Nn,getSheetProperties:()=>_d,getSiblingsHeight:()=>Yl,getSingleSelectedRange:()=>On,getSkeletonVal:()=>Ss,getSplittedAddressForColumn:()=>Fr,getStandardHeight:()=>Xd,getStartEvent:()=>td,getSwapRange:()=>c,getTextHeight:()=>Nd,getTextHeightWithBorder:()=>Dd,getTextSpace:()=>Qt,getTextWidth:()=>Ad,getTrailingSpaces:()=>Ur,getTypeFromFormat:()=>zs,getUniqueRange:()=>we,getUpdateUsingRaf:()=>zl,getUpdatedFormula:()=>Br,getUpdatedFormulaOnInsertDelete:()=>ir,getUpdatedRange:()=>en,getUpdatedScrollPosition:()=>ss,getValueFromFormat:()=>mn,getViewportIndexes:()=>Yr,getWorkbookRequiredModules:()=>C,getautofillDDB:()=>Zt,goToSheet:()=>co,goto:()=>nt,gotoDlg:()=>Ka,hasTemplate:()=>Id,hiddenMerge:()=>oo,hideAutoFillElement:()=>is,hideAutoFillOptions:()=>es,hideFileMenuItems:()=>qi,hideRibbonTabs:()=>Gi,hideSheet:()=>Sa,hideShow:()=>Rt,hideToolbarItems:()=>$i,importProtectWorkbook:()=>Xo,inRange:()=>Ar,inView:()=>Kl,initSheet:()=>Ln,initiateChart:()=>Pt,initiateChartModel:()=>Vt,initiateCur:()=>vo,initiateCustomSort:()=>na,initiateDataValidation:()=>Va,initiateEdit:()=>xo,initiateFilter:()=>je,initiateFilterUI:()=>Aa,initiateFormulaReference:()=>mo,initiateHyperlink:()=>da,initiateSort:()=>Oe,initiatelink:()=>Le,insert:()=>Xe,insertChart:()=>Bo,insertDesignChart:()=>Uo,insertFormatRange:()=>jr,insertImage:()=>wo,insertMerge:()=>Nt,insertModel:()=>$e,insertSheetTab:()=>Ei,intToDate:()=>on,invalidData:()=>_a,isCellReference:()=>Ir,isChar:()=>Er,isColumnRange:()=>Wd,isColumnSelected:()=>Rr,isCustomDateTime:()=>Yn,isDateTime:()=>ln,isDiscontinuousRange:()=>Hd,isExternalFileLink:()=>ws,isFilterHidden:()=>vl,isFormulaBarEdit:()=>ni,isHeightCheckNeeded:()=>Mr,isHiddenCol:()=>Al,isHiddenRow:()=>ml,isImported:()=>Kr,isInMultipleRange:()=>kr,isInRange:()=>Or,isLocked:()=>Tr,isLockedCells:()=>Bd,isMouseDown:()=>sd,isMouseMove:()=>ld,isMouseUp:()=>dd,isNavigationKey:()=>hd,isNumber:()=>dn,isReadOnly:()=>Jr,isReadOnlyCells:()=>Qr,isRowRange:()=>Gd,isRowSelected:()=>Nr,isSingleCell:()=>m,isTouchEnd:()=>od,isTouchMove:()=>ad,isTouchStart:()=>id,isUndefined:()=>xs,isValidCellReference:()=>Dr,isValidation:()=>Je,keyCodes:()=>Ul,keyDown:()=>ci,keyUp:()=>pi,locale:()=>Dl,localeData:()=>fn,localizedFormatAction:()=>gr,locateElem:()=>Ql,mergedRange:()=>It,mouseDown:()=>ai,mouseUpAfterSelection:()=>wi,moveOrDuplicateSheet:()=>Yt,moveSheet:()=>Mn,moveSheetHandler:()=>mr,onContentScroll:()=>ea,onHorizontalScroll:()=>mi,onSave:()=>Ye,onVerticalScroll:()=>gi,openFailure:()=>Ce,openHyperlink:()=>pa,openSuccess:()=>ye,overlay:()=>Ml,overlayEleSize:()=>Zo,parseDecimalNumber:()=>ge,parseFormulaArgument:()=>dr,parseIntValue:()=>cn,parseLocaleNumber:()=>Gr,paste:()=>Mi,performAutoFill:()=>ts,performUndoRedo:()=>wa,positionAutoFillElement:()=>Qo,processIdx:()=>yn,propertyChange:()=>us,protectCellFormat:()=>Xa,protectSelection:()=>ao,protectSheet:()=>Wa,protectSheetWorkBook:()=>ut,protectWorkbook:()=>qo,protectsheetHandler:()=>gt,queryCellInfo:()=>ht,rangeSelectionByKeydown:()=>Di,reApplyFormula:()=>Ne,readonlyAlert:()=>to,reapplyFilter:()=>Fa,refreshCell:()=>Kt,refreshCellElement:()=>ie,refreshChart:()=>Bt,refreshChartCellModel:()=>To,refreshChartCellObj:()=>Fo,refreshChartCellOnInit:()=>fr,refreshChartSize:()=>Ht,refreshCheckbox:()=>hs,refreshClipboard:()=>er,refreshFilterCellsOnResize:()=>sa,refreshFilterRange:()=>Oa,refreshFormulaDatasource:()=>Ua,refreshImagePosition:()=>Do,refreshImgCellObj:()=>Eo,refreshInsertDelete:()=>nr,refreshOverlayElem:()=>Io,refreshRibbon:()=>ki,refreshRibbonIcons:()=>Mt,refreshSheetTabs:()=>ri,removeAllChildren:()=>jl,removeContextMenuItems:()=>zi,removeDataValidation:()=>ho,removeDesignChart:()=>Vo,removeElements:()=>Kd,removeHighlight:()=>dt,removeHyperlink:()=>Ca,removeNoteContainer:()=>ya,removeRangeEle:()=>Jl,removeSheetTab:()=>Ni,removeUniquecol:()=>Ie,removeWorkbookProtection:()=>Yo,renameSheetTab:()=>Ri,renderCFDlg:()=>fo,renderFilterCell:()=>ka,renderInsertDlg:()=>ps,replace:()=>at,replaceAll:()=>ot,replaceAllDialog:()=>mt,ribbon:()=>Qn,ribbonClick:()=>Ai,rowFillHandler:()=>Jt,rowHeightChanged:()=>Ji,saveCompleted:()=>ee,saveError:()=>jt,selectAutoFillRange:()=>rs,selectRange:()=>Ti,selectionComplete:()=>rr,selectionStatus:()=>Ko,setActionData:()=>Ea,setAriaOptions:()=>vd,setAutoFill:()=>Xt,setAutoFit:()=>Ha,setCFRule:()=>At,setCell:()=>jn,setCellFormat:()=>ae,setChart:()=>Lt,setColMinWidth:()=>jd,setColumn:()=>El,setFilteredCollection:()=>Q,setImage:()=>Dt,setLinkModel:()=>Ve,setLockCells:()=>bt,setMaxHgt:()=>Ld,setMerge:()=>St,setPosition:()=>Zl,setProtectWorkbook:()=>Go,setResize:()=>Cd,setRow:()=>gl,setRowEleHeight:()=>Ed,setRowHeight:()=>Cl,setStandardHeight:()=>Yd,setStyleAttribute:()=>ed,setTextLineHeight:()=>xd,setUndoRedo:()=>no,setVisibleMergeIndex:()=>Xr,setWidthAndHeight:()=>bd,sheetCreated:()=>be,sheetNameUpdate:()=>xa,sheetRenameUpdate:()=>yr,sheetTabs:()=>ti,sheetsDestroyed:()=>xe,showAggregate:()=>po,showFindAlert:()=>st,showNote:()=>ga,showSheet:()=>uo,skipDefaultValue:()=>_n,skipHiddenIdx:()=>Pr,sortComplete:()=>Te,sortImport:()=>$,sortRangeAlert:()=>De,spreadsheetCreated:()=>Qa,spreadsheetDestroyed:()=>oi,startEdit:()=>ja,tabSwitch:()=>Fi,textDecorationUpdate:()=>se,toDate:()=>pn,toFraction:()=>nn,toggleProtect:()=>cs,triggerDataChange:()=>G,unMerge:()=>sr,unProtectSheetPassword:()=>as,unProtectWorkbook:()=>Wo,undoRedoForChartDesign:()=>_o,unprotectSheet:()=>Ya,unprotectsheetHandler:()=>vt,updateAction:()=>wd,updateCFModel:()=>qr,updateCell:()=>Vr,updateHighlight:()=>_t,updateMergeBorder:()=>rn,updateNoteContainer:()=>va,updateRowColCount:()=>he,updateScroll:()=>Jo,updateScrollValue:()=>ls,updateSelectedRange:()=>An,updateSheetFromDataSource:()=>_,updateSortCollection:()=>Cr,updateSortedDataOnCell:()=>Fe,updateTableWidth:()=>Lo,updateToggle:()=>ft,updateToggleItem:()=>la,updateTranslate:()=>os,updateUndoRedoCollection:()=>Ia,updateUsedRange:()=>de,updateView:()=>tr,updateWrapCell:()=>fs,validationError:()=>za,virtualContentLoaded:()=>bi,workBookeditAlert:()=>yt,workbookDestroyed:()=>j,workbookEditOperation:()=>ce,workbookFormulaOperation:()=>pe,workbookLocale:()=>un,workbookOpen:()=>Y,workbookReadonlyAlert:()=>Ct,wrap:()=>qn,wrapEvent:()=>Ge});var e=u(766);function t(t,n,i){var a,s=[];if(t){var l=void 0;if(n&&!(0,e.isNullOrUndefined)(i)&&(l=Fn(n,i)),t=-1===(t=t.lastIndexOf("!")>-1?t.substring(t.lastIndexOf("!")+1):t).indexOf(":")?t+":"+t:t,!new RegExp(/^(?=.*[a-zA-Z])(?=.*\d)/g).test(t)){var d=t.split(":");t=(0,e.isNullOrUndefined)(t.match(/[0-9]/))?d[0]+"1:"+d[1]+(l?l.rowCount-1:"1"):"A"+d[0]+":"+(l?o(l.colCount):"A")+d[1]}t.split(":").forEach((function(e){a=r(e),s.push(a[0]),s.push(a[1])}))}return s}function r(e){return[parseInt(e.match(/\d+/)[0],10)-1,n(e.match(/[A-Z]+/i)[0].toUpperCase())]}function n(e){for(var t=0,r=(e=e.split("").reverse().join("")).length-1;r>=0;r--)t+=(e[r].charCodeAt(0)-64)*Math.pow(26,r);return t-1}function i(e,t){return o(t+1)+(e+1)}function a(t){return i(t[0],t[1])+":"+((0,e.isNullOrUndefined)(t[2])?i(t[0],t[1]):i(t[2],t[3]))}function o(e){return e/26>1?o(e%26==0?e/26-1:Math.floor(e/26))+String.fromCharCode(e%26==0?"Z".charCodeAt(0):64+e%26):String.fromCharCode(64+e)}function s(e,r,n){return t(l(e),r,n)}function l(e){var t=e.lastIndexOf("!");return t>-1?e.substring(t+1):e}function d(e){return e.name+"!"+e.selectedRange}function h(e,t){var r=p(e,t);return{sheetIndex:r,indices:s(t,e,r)}}function p(e,t){return t.indexOf("!")>-1?In(e,Nn(t)):e.activeSheetIndex}function c(e){var t=e.slice();return e[0]>e[2]&&g(t,0,2),e[1]>e[3]&&g(t,1,3),t}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e){return e[0]===e[2]&&e[1]===e[3]}function v(e,t,r,n,i,a){return new y(e,t,r,n,i,a)}var y=function(){function e(e,t,r,n,i,a){this.preventCallback=!1,this.context=e,this.workerTask=t,this.defaultListener=r,this.workerData=n,this.parent=a,i&&(this.preventCallback=!0),this.initWorker()}return e.prototype.terminate=function(){this.worker.terminate(),URL.revokeObjectURL(this.workerUrl)},e.prototype.initWorker=function(){var e=new Blob([this.getFnCode()],{type:"text/javascript"});if(this.workerUrl=URL.createObjectURL(e),this.worker=new Worker(this.workerUrl),this.worker.onmessage=this.messageFromWorker.bind(this),this.worker.onerror=this.onError.bind(this),this.parent.isVue){var t=JSON.parse(JSON.stringify(this.workerData));this.worker.postMessage(t)}else this.worker.postMessage(this.workerData)},e.prototype.messageFromWorker=function(e){this.terminate(),this.defaultListener.apply(this.context,[e.data])},e.prototype.onError=function(e){if(this.terminate(),!e.message||!e.message.includes("FormData"))throw e.message||e;this.defaultListener.apply(this.context,[{isFormDataError:!0}])},e.prototype.getFnCode=function(){var e,t,r="",n="",i=!1;if("function"==typeof this.workerTask)this.workerTask.toString().indexOf("function")<0?n="function "+this.workerTask.toString():(n=this.workerTask.toString(),i=!0),r+="self.workerTask = "+n+"; \n";else if("object"==typeof this.workerTask)for(t=Object.keys(this.workerTask),e=0;e<t.length;e++)this.workerTask[t[e]].toString().indexOf("function")<0?n="function "+this.workerTask[t[e]].toString():(n=this.workerTask[t[e]].toString(),i=!0),r+=(0===e?"self.workerTask":t[e])+"= "+n+"; \n";return r+="self.onmessage = "+(i?"":" function ")+(this.preventCallback?this.getMessageFn.toString():this.getCallbackMessageFn.toString())+"; \n"},e.prototype.getCallbackMessageFn=function(e){postMessage(this.workerTask.apply(this,e.data))},e.prototype.getMessageFn=function(e){this.workerTask.apply(this,e.data)},e}();function C(e,t){return void 0===t&&(t=[]),t.push({member:"dataBind",args:[e]}),t.push({member:"workbookProtectSheet",args:[e]}),e.allowSave&&t.push({member:"workbookSave",args:[e]}),e.allowPrint&&t.push({member:"print",args:[e]}),e.allowOpen&&t.push({member:"workbookOpen",args:[e]}),e.allowEditing&&(t.push({member:"workbookEdit",args:[e]}),t.push({member:"workbookFormula",args:[e]})),e.allowNumberFormatting&&t.push({member:"workbookNumberFormat",args:[e]}),e.allowCellFormatting&&t.push({member:"workbookcellformat",args:[e]}),e.allowSorting&&t.push({member:"workbookSort",args:[e]}),e.allowHyperlink&&t.push({member:"workbookHyperlink",args:[e]}),e.allowFiltering&&t.push({member:"workbookFilter",args:[e]}),e.allowFindAndReplace&&t.push({member:"workbookfindAndReplace",args:[e]}),e.allowInsert&&t.push({member:"workbookinsert",args:[e]}),e.allowDelete&&t.push({member:"workbookdelete",args:[e]}),e.allowDataValidation&&t.push({member:"workbookDataValidation",args:[e]}),e.allowMerge&&t.push({member:"workbookmerge",args:[e]}),e.allowCellFormatting&&t.push({member:"workbookConditionalFormatting",args:[e]}),e.allowImage&&t.push({member:"workbookImage",args:[e]}),e.allowChart&&t.push({member:"workbookChart",args:[e]}),e.allowAutoFill&&t.push({member:"workbookautofill",args:[e]}),t}var b,x=(b=function(e,t){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},b(e,t)},function(e,t){function r(){this.constructor=e}b(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),S=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},w=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)("Calibri")],r.prototype,"fontFamily",void 0),S([(0,e.Property)("bottom")],r.prototype,"verticalAlign",void 0),S([(0,e.Property)("left")],r.prototype,"textAlign",void 0),S([(0,e.Property)("0pt")],r.prototype,"textIndent",void 0),S([(0,e.Property)("#000000")],r.prototype,"color",void 0),S([(0,e.Property)("#ffffff")],r.prototype,"backgroundColor",void 0),S([(0,e.Property)("normal")],r.prototype,"fontWeight",void 0),S([(0,e.Property)("normal")],r.prototype,"fontStyle",void 0),S([(0,e.Property)("11pt")],r.prototype,"fontSize",void 0),S([(0,e.Property)("none")],r.prototype,"textDecoration",void 0),S([(0,e.Property)("")],r.prototype,"border",void 0),S([(0,e.Property)("")],r.prototype,"borderTop",void 0),S([(0,e.Property)("")],r.prototype,"borderBottom",void 0),S([(0,e.Property)("")],r.prototype,"borderLeft",void 0),S([(0,e.Property)("")],r.prototype,"borderRight",void 0),r}(e.ChildProperty),I=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)()],r.prototype,"sheetIndex",void 0),S([(0,e.Property)()],r.prototype,"filterRange",void 0),S([(0,e.Property)(!1)],r.prototype,"hasFilter",void 0),S([(0,e.Property)()],r.prototype,"column",void 0),S([(0,e.Property)()],r.prototype,"criteria",void 0),S([(0,e.Property)()],r.prototype,"value",void 0),S([(0,e.Property)()],r.prototype,"dataType",void 0),S([(0,e.Property)()],r.prototype,"predicates",void 0),r}(e.ChildProperty),E=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)()],r.prototype,"sortRange",void 0),S([(0,e.Property)()],r.prototype,"columnIndex",void 0),S([(0,e.Property)()],r.prototype,"order",void 0),S([(0,e.Property)()],r.prototype,"sheetIndex",void 0),r}(e.ChildProperty),N=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)("")],r.prototype,"name",void 0),S([(0,e.Property)("")],r.prototype,"scope",void 0),S([(0,e.Property)("")],r.prototype,"comment",void 0),S([(0,e.Property)("")],r.prototype,"refersTo",void 0),r}(e.ChildProperty),R=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)(!1)],r.prototype,"selectCells",void 0),S([(0,e.Property)(!1)],r.prototype,"selectUnLockedCells",void 0),S([(0,e.Property)(!1)],r.prototype,"formatCells",void 0),S([(0,e.Property)(!1)],r.prototype,"formatRows",void 0),S([(0,e.Property)(!1)],r.prototype,"formatColumns",void 0),S([(0,e.Property)(!1)],r.prototype,"insertLink",void 0),r}(e.ChildProperty),A=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)("")],r.prototype,"address",void 0),r}(e.ChildProperty),k=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)("WholeNumber")],r.prototype,"type",void 0),S([(0,e.Property)("Between")],r.prototype,"operator",void 0),S([(0,e.Property)("0")],r.prototype,"value1",void 0),S([(0,e.Property)("0")],r.prototype,"value2",void 0),S([(0,e.Property)(!0)],r.prototype,"ignoreBlank",void 0),S([(0,e.Property)(!0)],r.prototype,"inCellDropDown",void 0),S([(0,e.Property)(!1)],r.prototype,"isHighlighted",void 0),S([(0,e.Property)("")],r.prototype,"address",void 0),r}(e.ChildProperty),O=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)("General")],r.prototype,"format",void 0),S([(0,e.Complex)({},w)],r.prototype,"style",void 0),S([(0,e.Property)(!0)],r.prototype,"isLocked",void 0),r}(e.ChildProperty),F=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)("GreaterThan")],r.prototype,"type",void 0),S([(0,e.Complex)({},O)],r.prototype,"format",void 0),S([(0,e.Property)("RedFT")],r.prototype,"cFColor",void 0),S([(0,e.Property)("")],r.prototype,"value",void 0),S([(0,e.Property)("")],r.prototype,"range",void 0),S([(0,e.Property)("")],r.prototype,"action",void 0),r}(e.ChildProperty),T=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)(!0)],r.prototype,"visible",void 0),S([(0,e.Property)("Auto")],r.prototype,"position",void 0),r}(e.ChildProperty),D=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)(!1)],r.prototype,"visible",void 0),S([(0,e.Property)("Auto")],r.prototype,"position",void 0),r}(e.ChildProperty),L=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)("")],r.prototype,"color",void 0),S([(0,e.Property)(1)],r.prototype,"width",void 0),r}(e.ChildProperty),P=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)(!1)],r.prototype,"visible",void 0),S([(0,e.Property)("Circle")],r.prototype,"shape",void 0),S([(0,e.Property)(5)],r.prototype,"size",void 0),S([(0,e.Property)(null)],r.prototype,"fill",void 0),S([(0,e.Property)(!0)],r.prototype,"isFilled",void 0),S([(0,e.Complex)({},L)],r.prototype,"border",void 0),r}(e.ChildProperty),M=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)(0)],r.prototype,"width",void 0),r}(e.ChildProperty),B=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)(0)],r.prototype,"width",void 0),r}(e.ChildProperty),H=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)("")],r.prototype,"title",void 0),S([(0,e.Complex)({},M)],r.prototype,"majorGridLines",void 0),S([(0,e.Complex)({},B)],r.prototype,"minorGridLines",void 0),S([(0,e.Property)(!0)],r.prototype,"visible",void 0),r}(e.ChildProperty),U=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)("Line")],r.prototype,"type",void 0),S([(0,e.Property)("Material")],r.prototype,"theme",void 0),S([(0,e.Property)(!1)],r.prototype,"isSeriesInRows",void 0),S([(0,e.Complex)({},P)],r.prototype,"markerSettings",void 0),S([(0,e.Property)("")],r.prototype,"range",void 0),S([(0,e.Property)("")],r.prototype,"id",void 0),S([(0,e.Property)("")],r.prototype,"title",void 0),S([(0,e.Property)(290)],r.prototype,"height",void 0),S([(0,e.Property)(480)],r.prototype,"width",void 0),S([(0,e.Property)(0)],r.prototype,"top",void 0),S([(0,e.Property)(0)],r.prototype,"left",void 0),S([(0,e.Complex)({},T)],r.prototype,"legendSettings",void 0),S([(0,e.Complex)({},H)],r.prototype,"primaryXAxis",void 0),S([(0,e.Complex)({},H)],r.prototype,"primaryYAxis",void 0),S([(0,e.Complex)({},D)],r.prototype,"dataLabelSettings",void 0),r}(e.ChildProperty),V=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)("")],r.prototype,"src",void 0),S([(0,e.Property)("")],r.prototype,"id",void 0),S([(0,e.Property)(300)],r.prototype,"height",void 0),S([(0,e.Property)(400)],r.prototype,"width",void 0),S([(0,e.Property)(0)],r.prototype,"top",void 0),S([(0,e.Property)(0)],r.prototype,"left",void 0),r}(e.ChildProperty),z=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return x(r,t),S([(0,e.Property)("FillSeries")],r.prototype,"fillType",void 0),S([(0,e.Property)(!0)],r.prototype,"showFillOptions",void 0),r}(e.ChildProperty),j="workbookDestroyed",_="updateSheetFromDataSource",q="dataSourceChanged",W="dataChanged",G="triggerDataChange",Y="workbookOpen",X="beginSave",K="actionBegin",$="sortImport",Z="findToolDlg",J="exportDialog",Q="setFilteredCollection",ee="saveCompleted",te="applyNumber",re="getFormattedCell",ne="calculateFormula",ie="refreshCellElem",ae="setCellFormat",oe="findAllValues",se="textDecorationUpdate",le="applyCellFormat",de="updateUsedRange",he="updateRowColCount",pe="workbookFormulaOperation",ce="workbookEditOperation",ue="checkDateFormat",fe="checkNumberFormat",ge="parseDecimalNumber",me="getFormattedBarText",ve="activeCellChanged",ye="openSuccess",Ce="openFailure",be="sheetCreated",xe="sheetsDestroyed",Se="aggregateComputation",we="getUniqueRange",Ie="removeUniquecol",Ee="checkUniqueRange",Ne="reApplyFormula",Re="clearFormulaDependentCells",Ae="formulaInValidation",ke="beforeSort",Oe="initiateSort",Fe="updateSortedDataOnCell",Te="sortComplete",De="sortRangeAlert",Le="initiatelink",Pe="beforeHyperlinkCreate",Me="afterHyperlinkCreate",Be="beforeHyperlinkClick",He="afterHyperlinkClick",Ue="addHyperlink",Ve="setLinkModel",ze="beforeFilter",je="initiateFilter",_e="filterComplete",qe="filterRangeAlert",We="clearAllFilter",Ge="wrapText",Ye="onSave",Xe="insert",Ke="delete",$e="insertModel",Ze="deleteModel",Je="isValidation",Qe="cellValidation",et="addHighlight",tt="dataValidate",rt="find",nt="gotoHandler",it="findHandler",at="replace",ot="replaceAll",st="showFindAlert",lt="findKeyUp",dt="removeHighlight",ht="queryCellInfo",pt="count",ct="findCount",ut="protectSheet",ft="updateToggleItem",gt="protectsheetHandler",mt="replaceAllDialog",vt="unprotectsheetHandler",yt="editAlert",Ct="readonlyAlert",bt="setLockCells",xt="applyLockCells",St="setMerge",wt="applyMerge",It="mergedRange",Et="activeCellMergedRange",Nt="insertMerge",Rt="hideShow",At="setCFRule",kt="applyCF",Ot="clearCFRule",Ft="clear",Tt="clearCF",Dt="setImage",Lt="setChart",Pt="initiateChart",Mt="refreshRibbonIcons",Bt="refreshChart",Ht="refreshChartSize",Ut="deleteChartColl",Vt="initiateChartModel",zt="focusChartBorder",jt="saveError",_t="updateHighlight",qt="beforeInsert",Wt="beforeDelete",Gt="deleteHyperlink",Yt="moveOrDuplicateSheet",Xt="setAutoFill",Kt="refreshCell",$t="getFillInfo",Zt="getautofillDDB",Jt="rowFillHandler",Qt="getTextSpace",er="refreshClipboard",tr="updateView",rr="selectionComplete",nr="refreshInsertDelete",ir="getUpdatedFormulaOnInsertDelete",ar="beforeCellUpdate",or="duplicateSheetFilterHandler",sr="unMerge",lr="checkFormulaRef",dr="parseFormulaArgument",hr="getCellRefValue",pr="commputeFormulaValue",cr="getChartRowIdxFromClientY",ur="getChartColIdxFromClientX",fr="refreshChartCellOnInit",gr="localizedFormatAction",mr="moveSheetHandler",vr="addListValidationDropdown",yr="sheetRenameUpdate",Cr="updateSortCollection";function br(t,r,n,i,a,o,s){var l=t.value;if(l&&"string"==typeof l){if(l.includes("\n"))return{isNumber:!1,value:l};if(dn(l))return{isNumber:!0,value:l};if(a&&l.includes(a)&&(s||t.format.includes(a)||t.format.includes("$"))&&(l=l.replace(a,"").trim()),n&&l.includes(n)&&xr(l,r,n,i)&&(l=l.split(n).join("").trim()),i||(i=(0,e.getNumericObject)(r).decimal),"."!==i&&l.includes(i)&&(l=l.replace(i,".").trim()),dn(l))return{isNumber:!0,value:l};if(o&&2===l.split("/").length)try{var d=l.split(" ");if(2===d.length&&1===d[0].split("/").length)l=hn(d[0])+hn(d[1]);else l=hn(l);return{isNumber:!0,value:l}}catch(e){return{isNumber:!1,value:l}}}else if(dn(l))return{isNumber:!0,value:l};return{isNumber:!1,value:l}}function xr(t,r,n,i){for(var a=!1,o=123456..toLocaleString(r).split(n).reverse(),s=t.split(i)[0].split(n),l=0;l<s.length&&(a=l===s.length-1?s[l].length===o[0].length:!(0,e.isUndefined)(o[1])&&(0===l?s[l].length<=o[1].length:s[l].length===o[1].length));l++);return a}var Sr=u(74);function wr(e,t){return e&&"="===e[0]&&(e.length>1||t)}function Ir(e){var t=e;if((t=t.split("$").join("")).indexOf(":")>-1){var r=t.split(":");if(Dr(r[0])&&Dr(r[1]))return!0}else if(t.indexOf(":")<0&&Dr(t))return!0;return!1}function Er(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122}function Nr(e,t){return 0===t[1]&&t[3]===e.colCount-1}function Rr(e,t){return 0===t[0]&&t[2]===e.rowCount-1}function Ar(e,t,r){return e&&t>=e[0]&&t<=e[2]&&r>=e[1]&&r<=e[3]}function kr(e,r,n){for(var i,a=e.split(" "),o=0,s=a.length;o<s&&!(i=Ar(t(a[o]),r,n));o++);return i}function Or(e,t,r){var n=e[0]<=t[0]&&e[2]>=t[2]&&e[1]<=t[1]&&e[3]>=t[3];if(n)return!0;if(r){if(t[0]<e[0]&&t[2]<e[0]||t[0]>e[2]&&t[2]>e[2])return!1;if(t[0]<e[0]&&t[2]>e[0]&&(t[0]=e[0],n=!0),t[2]>e[2]&&(t[2]=e[2],n=!0),t[1]<e[1]&&t[3]<e[1]||t[1]>e[3]&&t[3]>e[3])return!1;t[1]<e[1]&&t[3]>e[1]&&(t[1]=e[1],n=!0),t[3]>e[3]&&(t[3]=e[3],n=!0)}return n}function Fr(e,r,n){var i=o(n+1);return e?e.split(" ").forEach((function(n){var a=t(n);if(Or(a,r))e=e.split(n).join(i+(a[0]+1)+":"+i+r[0]+" "+i+(r[2]+2)+":"+i+(a[2]+1));else if(Or(a,r,!0)){var o=void 0;o=r[0]>a[0]?i+(a[0]+1)+":"+i+r[0]:i+(r[2]+2)+":"+i+(a[2]+1),e=e.split(n).join(o)}})):e=i+"1:"+i+r[0]+" "+i+(r[2]+2)+":"+i+"1048576",e}function Tr(e,t){return e||(e={}),!!e.isLocked||!1!==e.isLocked&&(!(!t||!t.isLocked)||!(e.isLocked||!t||!1===t.isLocked))}function Dr(e){for(var t=e,r=0,n=t.length,i=0;i<n;i++)Er(t[i])&&r++;var a=t.substring(0,r),o=a.length;if(o!==n&&o<4&&1!==n&&isNaN(parseInt(t,10))){var s=Lr(a);if(s<1||s>16384)return!1;var l=parseFloat(t.substring(r,n));if(l>0&&l<1048577)return!0}return!1}function Lr(e){var t=0,r=0;if(t<(e=e.toUpperCase()).length&&"!"===e[t]){for(t++;t<e.length&&"!"!==e[t];)t++;t++}for(;t<e.length&&Er(e[t]);){r=26*r+e[t].charCodeAt(0)-64,t++}return 0===r?-1:r}function Pr(e,t,r,n,i){var a;if(void 0===n&&(n="rows"),e)if(r)for(var o=t;o<1/0;o++)if((a=e[""+n])[t]&&a[t].hidden)t++;else{if(!i)break;i--,t++}else for(o=t;o>-1&&((a=e[""+n])[t]&&a[t].hidden);o--)t--;return t}function Mr(e,t){var r=Object.keys(e);return(t?r.indexOf("fontSize")>-1:r.indexOf("fontSize")>-1&&Number(e.fontSize.split("pt")[0])>12)||r.indexOf("fontFamily")>-1||r.indexOf("borderTop")>-1||r.indexOf("borderBottom")>-1}function Br(e,r,n,a,o,s){var l,d;if(r&&(l=(d=o||zn(r[0],r[1],n,!1,!0)).formula||""),l){s&&a.notify(Re,{cellRef:i(r[0],r[1])}),0===l.indexOf("=")&&(l=l.slice(1));for(var h=["+","-","*","/",">=","<=","<>",">","<","=","%","&"],p=void 0,c=l=l.split("(").join(a.listSeparator).split(")").join(a.listSeparator),u=0;u<h.length;u++)p=c.split(h[u]),c=p.join(a.listSeparator);p=c.split(a.listSeparator);for(var f=[],g=void 0,m=void 0,v=void 0,y=void 0,C=void 0,b=0;b<p.length;b++){if(v=p[b].includes("!")){var x=p[b].lastIndexOf("!");y=p[b].substring(0,x),C=p[b].substring(x+1).toUpperCase()}else C=p[b].toUpperCase();if(Ir(C.trim())&&!C.includes("$")){var S=Hr(C),w=Ur(C),I=t(C),E=[e[0]-(r[0]-I[0]),e[1]-(r[1]-I[1]),e[0]-(r[0]-I[2]),e[1]-(r[1]-I[3])];E[1]<0||E[2]<0||E[3]<0||!s&&E[0]<0?g="#REF!":(s&&E[0]<0&&(E[0]=E[2]),g=i(E[0],E[1]),C.includes(":")&&(g+=":"+i(E[2],E[3])),g=Ir(g)?g:"#REF!"),v&&(g=y+"!"+g),(m={})[p[b]]=""+S+g+w,p[b].includes(":")?f.splice(0,0,m):f.push(m)}}var N=void 0,R=void 0,A=l=d.formula;for(b=0;b<f.length;b++){N=Object.keys(f[b])[0],R=f[b][""+N];for(var k=N.length,O=A.indexOf(N),F="",T=0;T<R.length;T++)F+=" ";l=l.slice(0,O)+R+l.slice(O+k),A=A.slice(0,O)+F+A.slice(O+k)}return l}return null}function Hr(e){for(var t="",r=0;r<e.length&&" "===e[r];r++)t+=" ";return t}function Ur(e){for(var t="",r=e.length-1;r>=0&&" "===e[r];r--)t=" "+t;return t}function Vr(e,t,r,n,a){var o={cell:r.cell,rowIndex:r.rowIdx,colIndex:r.colIdx,cancel:!1,sheet:t.name};if(r.preventEvt||e.trigger(ar,o),!r.eventOnly&&!o.cancel)if(r.valChange){var s=zn(o.rowIndex,o.colIndex,t),l=!r.preventEvt&&e.getDisplayText(s),d=!(!s||!s.formula);jn(o.rowIndex,o.colIndex,t,o.cell,!r.pvtExtend);var h=zn(o.rowIndex,o.colIndex,t,!1,!0);r.mergedCells&&(delete h.value,delete h.formula),h.formattedText&&delete h.formattedText;var p={action:"updateCellValue",address:[o.rowIndex,o.colIndex],sheetIndex:In(e,t.name),value:d&&!h.formula?h.value||(0===h.value?"0":""):h.formula||h.value||(0===h.value?"0":""),skipFormatCheck:r.skipFormatCheck,isRandomFormula:r.isRandomFormula,isDelete:r.isDelete,deletedRange:r.deletedRange,fillType:r.fillType,cellInformation:n,isRedo:!a,actionName:r.fillType,isPaste:"paste"===r.requestType};if(e.notify(ce,p),r.isFormulaDependent=p.isFormulaDependent,r.requestType&&null===o.cell&&jn(o.rowIndex,o.colIndex,t,o.cell,!r.pvtExtend),r.cellDelete&&(delete h.value,delete h.formula,delete h.hyperlink),r.uiRefresh&&e.serviceLocator.getService("cell").refresh(o.rowIndex,o.colIndex,r.lastCell,r.td,r.checkCF,r.checkWrap,r.skipFormatCheck,r.isRandomFormula,r.fillType),!r.preventEvt){var c=e.getDisplayText(h);if(c!==l){var u=zn(o.rowIndex,o.colIndex,t,!1,!0).value,f={value:u=u||(0===u?"0":""),oldValue:l,formula:h.formula||"",address:t.name+"!"+i(o.rowIndex,o.colIndex),displayText:c};r.requestType&&(f.requestType=r.requestType),e.trigger("cellSave",f)}}}else jn(o.rowIndex,o.colIndex,t,o.cell,!r.pvtExtend);return o.cancel}function zr(t,r,n){for(var i=t,a=t,o=r,s=r,l=n.usedRange.rowIndex,d=n.usedRange.colIndex,h=function(t){for(var r=0;r<=d;r++)if(!(0,e.isUndefined)(zn(t,r,n,null,!0).value))return!1;return!0},p=function(t){for(var r=i;r<=a;r++)if(!(0,e.isUndefined)(zn(r,t,n,null,!0).value))return!1;return!0},c=i;c<=l&&(!(0,e.isUndefined)(zn(c,r,n,null,!0).value)||!h(c));c++)a=c;for(c=i;c>=0&&(!(0,e.isUndefined)(zn(c,r,n,null,!0).value)||!h(c));c--)i=c;for(c=o;c<=d&&(!(0,e.isUndefined)(zn(t,c,n,null,!0).value)||!p(c));c++)s=c;for(c=o;c>=0&&(!(0,e.isUndefined)(zn(t,c,n,null,!0).value)||!p(c));c--)o=c;return[i,o,a,s]}function jr(e,r,n){var i=t(e.model.selectedRange),a=0,o=0;if("Column"===e.modelType){if((n||"before"===e.insertType&&e.isUndoRedo)&&(i=[0,e.start,0,e.end]),"before"===e.insertType)r[1]<=i[1]&&r[3]>=i[1]?(a=0,o=i[3]-i[1]+1):i[1]<r[1]&&(a=o=i[3]-i[1]+1);else{if(e.isUndoRedo){var s=e.end-e.start+1;i=[0,e.start-s,0,e.end-s]}r[1]<=i[3]&&r[3]>=i[3]?(a=0,o=i[3]-i[1]+1):i[3]<r[3]&&(a=o=i[3]-i[1]+1)}return[r[0],r[1]+a,r[2],r[3]+o]}if((n||"above"===e.insertType&&e.isUndoRedo)&&(i=[e.start,0,e.end,0]),"above"===e.insertType)r[0]<=i[0]&&r[2]>=i[0]?(a=0,o=i[2]-i[0]+1):i[0]<r[0]&&(a=o=i[2]-i[0]+1);else{if(e.isUndoRedo){s=e.end-e.start+1;i=[e.start-s,0,e.end-s,0]}r[0]<=i[2]&&r[2]>=i[2]?(a=0,o=i[2]-i[0]+1):i[2]<r[2]&&(a=o=i[2]-i[0]+1)}return[r[0]+a,r[1],r[2]+o,r[3]]}function _r(e,t){var r,n=0,i=0;return"Column"===e.modelType?((r=[0,e.start,e.model.usedRange.rowIndex,e.end])[3]<t[1]?n=i=r[3]-r[1]+1:r[1]>=t[1]&&r[3]<=t[3]?i=r[3]-r[1]+1:r[1]>=t[1]&&r[1]<=t[3]?i=t[3]-r[1]+1:r[1]<t[1]&&r[3]>=t[1]?(n=t[1]-r[1],i=r[3]-r[1]+1):r[1]<t[1]&&r[3]<t[3]&&(n=r[3]-t[1]+(r[3]-r[1])+1,i=r[3]-r[1]+1),[t[0],t[1]-n,t[2],t[3]-i]):((r=[e.start,0,e.end,e.model.usedRange.colIndex])[2]<t[0]?n=i=r[2]-r[0]+1:r[0]>=t[0]&&r[2]<=t[2]?i=r[2]-r[0]+1:r[0]>=t[0]&&r[0]<=t[2]?i=t[2]-r[0]+1:r[0]<t[0]&&r[2]>=t[0]?(n=t[0]-r[0],i=r[2]-r[0]+1):r[0]<t[0]&&r[2]<t[2]&&(n=r[2]-t[0]+(r[2]-r[0])+1,i=r[2]-r[0]+1),[t[0]-n,t[1],t[2]-i,t[3]])}function qr(e,r,n,i,o,s,l){for(var d,h,p=e.length-1;p>=0;p--){d=e[p].range.trim().split(",");for(var c=0;c<d.length;c++){if(n>=(h=t(d[c].includes(":")?d[c]:d[c]+":"+d[c]))[0]&&i>=h[1]&&n<=h[2]&&i<=h[3]){r.push(e[p]),e.splice(p,1);break}if(o&&o[0]>=h[0]&&o[1]>=h[1]&&o[0]<=h[2]&&o[1]<=h[3]){var u={action:"autofillWithCF",cFColor:e[p].cFColor,range:a(s),type:e[p].type,value:e[p].value};e.splice(p,1);for(var f=0,g=l.conditionalFormats;f<g.length&&("autofillWithCF"!==g[f].action||g[f].range!==u.range);f++)f===g.length-1&&(r.push(u),l.conditionalFormats.push(u));break}}}}function Wr(e,r){for(var n,i,a,o,s,l=r.trim().split(","),d=function(e){for(var r=0;r<l.length;r++){if(s=t(l[r].includes(":")?l[r]:l[r]+":"+l[r]),e[0]<=s[0]&&e[1]<=s[1]&&e[2]>=s[2]&&e[3]>=s[3])return!0;if(a=e[0]>=s[0]&&e[0]<=s[2],o=e[2]>=s[0]&&e[2]<=s[2],n=e[1]>=s[1]&&e[1]<=s[3],i=e[3]>=s[1]&&e[3]<=s[3],a&&o){if(n||i||e[1]<s[1]&&e[3]>s[3]){if(e[0]-s[0]>0)return!0;if(s[2]-e[2]>0)return!0}if(n&&e[1]!==s[1])return!0;if(i&&e[3]!==s[3])return!0}else if(n&&i){if(a||o||e[0]<s[0]&&e[2]>s[2]){if(e[1]-s[1]>0)return!0;if(s[3]-e[3]>0)return!0}if(a){if(e[0]!==s[0])return!0}else if(o&&e[2]!==s[2])return!0}else if(a||o){if(n){if(e[1]!==s[1])return!0;if(e[0]-s[0]>0)return!0;if(s[2]-e[2]>0)return!0}else if(i){if(e[3]!==s[3])return!0;if(e[0]-s[0]>0)return!0;if(s[2]-e[2]>0)return!0}else if(e[1]<s[1]&&e[3]>s[3])return!0}else if((n||i)&&e[0]<s[0]&&e[2]>s[2])return!0}return!1},h=0;h<e.length;h++)if(d(e[h]))return!0;return!1}function Gr(t,r,n){var i;n||(n=(0,e.getNumericObject)(r.locale));for(var a=0;a<t.length;a++)dn(t[a])?"."===n.group&&(t[a]=t[a].toString(),t[a].indexOf(".")&&xr(t[a],r.locale,n.group,n.decimal)&&(t[a]=t[a].split(n.group).join(""))):(i={formattedText:t[a],value:t[a],format:"General",cell:{value:t[a],format:"General"},isEdit:!0},r.notify(re,i),dn(i.value)&&(t[a]=i.value.toString()));return t}function Yr(e,t){var n=e.getActiveSheet(),i=[[t.topIndex+e.frozenRowCount(n),t.leftIndex+e.frozenColCount(n),t.bottomIndex,t.rightIndex]];if(n.frozenRows||n.frozenColumns){var a=e.frozenRowCount(n),o=e.frozenColCount(n),s=r(n.topLeftCell);if(a&&o){i.push([s[0],s[1],a-1,o-1]);var l=r(n.paneTopLeftCell);i.push([l[0],s[1],t.bottomIndex,o-1])}a&&i.push([s[0],t.leftIndex+o,a-1,t.rightIndex]),o&&i.push([t.topIndex+a,s[1],t.bottomIndex,o-1])}return i}function Xr(e){var t;ml(e.sheet,e.rowIdx)&&((t=Pr(e.sheet,e.rowIdx,!0))<e.rowIdx+e.cell.rowSpan&&(e.rowIdx=t,e.isMergedHiddenCell=!0));Al(e.sheet,e.colIdx)&&((t=Pr(e.sheet,e.colIdx,!0,"columns"))<e.colIdx+e.cell.colSpan&&(e.colIdx=t,e.isMergedHiddenCell=!0))}function Kr(e){return e.workbookOpenModule&&e.workbookOpenModule.preventFormatCheck}function $r(t){var r=new e.Internationalization,n={intl:r,updateValue:!0,value:"",curSymbol:(0,e.getNumberDependable)(t.locale,e.defaultCurrencyCode)},i={args:n,intl:r},a=(0,e.getNumericObject)(t.locale);return function(e){if(!e.format&&e.value&&!dn(e.value)&&(n.cell=e,n.value=e.value,t.notify(ue,n),!e.format)){var r=e.value.toString();r.includes(i.args.curSymbol)||r.includes(a.group)||r.includes("%")?(i.fResult=r,t.notify(fe,i)):"."===a.decimal||dn(r)||r.includes(a.decimal)&&dn(r=r.replace(a.decimal,"."))&&(e.value=r)}}}function Zr(e,t,r){var n=new Sr.Query;t.length&&n.where(Sr.Predicate.and(t));var i=e.executeLocal(n);if(r)for(var a=0,o=r.length;a<o&&i.length;a++)n=new Sr.Query,r[a].length&&n.where(Sr.Predicate.or(r[a])),i=new Sr.DataManager(i).executeLocal(n);return i}function Jr(e,t,r){return e&&e.isReadOnly||r&&r.isReadOnly||t&&t.isReadOnly}function Qr(r,n){for(var i,a=r.getActiveSheet(),o=(0,e.isNullOrUndefined)(n)?c(t(a.selectedRange)):n,s=o[0];s<=o[2];s++)for(var l=o[1];l<=o[3];l++){if(Jr(zn(s,l,a),Il(a,l),fl(a,s))){i=!0;break}}return i}function en(e,r){var n=r||e.selectedRange,i=t(n),a=e.colCount,o=e.rowCount;return i[2]===o-1&&0===i[0]?n=n.replace(/[0-9]/g,""):i[3]===a-1&&0===i[2]&&(n=n.replace(/\D/g,"")),n}function tn(e){if(window.devicePixelRatio%1>0){var t=e*window.devicePixelRatio%1;return e+(t?(t>.5?1-t:-1*t)/window.devicePixelRatio:0)}return e}function rn(e,t,n){if(t.length){var i,a=e.getActiveSheet(),o=e,s=e.frozenColCount(a),l=n&&n[0]||(s?r(a.topLeftCell)[1]:o.viewport.leftIndex),d=n&&n[1]||o.viewport.rightIndex;t.forEach((function(t){for(var r=l;r<=d;r++){r===s&&(r+=o.viewport.leftIndex);var n=zn(t-1,r,a,!1,!0);if(!(n.rowSpan&&1!==n.rowSpan&&n.colSpan&&1!==n.colSpan||n.style&&n.style.borderBottom&&"none"!==n.style.borderBottom)&&(i=zn(t,r,a,!1,!0).style)&&i.borderTop){var h=e.getCell(t-1,r);if(h&&h.style.borderBottom){var p=e.getCell(t,r);p&&(h.style.borderBottom="",p.style.borderTop=i.borderTop)}}}}))}}function nn(e){var t=e.toString();if(e===parseInt(t,10))return parseInt(t,10)+"  ";var r=t.indexOf(".")>-1?t.split(".")[1]:0,n=Math.pow(10,r.toString().replace("-","").length),i=Math.abs(an(r,n));return r/i+"/"+n/i}function an(e,t){return e=Number(e),(t=Number(t))?an(t,e%t):e}function on(e){(e=(e=Number(e))>0&&e<1?1+e:0===e?1:e)>60&&(e-=1);var t=new Date("01/01/1900"),r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());return new Date(new Date(864e5*(e-1)+r).toUTCString().replace(" GMT",""))}function sn(e,t,r){var n=new Date("01/01/1900"),i=ln(e)?e:new Date(e),a=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),o=(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())-a)/864e5;return(t?o:parseInt(o.toString(),10))+(r?0:o>60?2:1)}function ln(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())}function dn(e){return e-parseFloat(e)>=0}function hn(e){return Function('"use strict";return ('+e+")")()}function pn(t,r,n,i,a,o){var s,l=e.IntlBase.getDependables(e.cldrData,n,null).dateObject,d=l.dateTimeFormats.availableFormats,h={dateObj:null,isCustom:!1,type:""},p=function(){"time"===h.type&&(h.dateObj=new Date((s?s.toDateString():"01/01/1900")+" "+h.dateObj.toLocaleTimeString()))};if(i&&(h.dateObj=r.parseDate(t,{format:i}),h.dateObj&&(h.type=t.toString().indexOf(":")>-1?"time":"datetime",p(),h.isCustom=!0)),(0,e.isNullOrUndefined)(h.dateObj)){if((t=t.toString())&&t.indexOf("/")>-1||t.indexOf("-")>0){var c=a&&a.format||i;if(c){var u=c.toLowerCase().includes("dd-mm-yy");if((u||c.toLowerCase().includes("dd/mm/yy"))&&(c=u?"d-M-y":"d/M/y",h.dateObj=r.parseDate(t,{format:c,skeleton:"yMd"}),h.dateObj))return h.type="date",h}}var f=function(t){if(t.indexOf(":")<0)for(var n=0,i=Object.keys(l.dateFormats);n<i.length;n++){var a=i[n];if(h.dateObj=r.parseDate(t,{format:l.dateFormats[""+a],skeleton:a}),h.dateObj){h.type="date",h.isCustom=!1;break}}if((0,e.isNullOrUndefined)(h.dateObj))for(var o=void 0,s=0,c=Object.keys(d);s<c.length;s++){a=c[s];if(o=d[""+a],h.dateObj=r.parseDate(t,{format:o,skeleton:a}),!h.dateObj&&t.indexOf(":")>-1&&o.indexOf(":")>-1&&(h.dateObj=r.parseDate(t,{format:o.split(" ")[0]})),h.dateObj){h.type=t.toString().indexOf(":")>-1?"time":"datetime",p(),h.isCustom=!0;break}}if((0,e.isNullOrUndefined)(h.dateObj))for(var u=0,f=Object.keys(l.timeFormats);u<f.length;u++){a=f[u];if(h.dateObj=r.parseDate(t,{format:l.timeFormats[""+a],skeleton:a}),h.dateObj){h.type="time",p(),h.isCustom=!1;break}}};if(o){var g=t.split(" ");g.length>=2&&(f(g.shift()),h.dateObj&&(s=h.dateObj,h.dateObj=null,f(g.join(" ")),h.dateObj&&(h.type="datetime")))}else f(t)}return"#DIV/0!"===t||h.dateObj||"Invalid Date"===new Date(t).toString()||(h.dateObj=new Date(t),h.type="date"),h}function cn(e,t,r){if(e&&"."!==e&&"-"!==e){var n=e.toString(),i=Number.MAX_SAFE_INTEGER.toString().length;if(n.startsWith("-")&&(n=(n=n.slice(1)).includes("-")?e:n),/^\d*\.?\d*$/.test(n))return t&&(n.length>i||r&&(n.startsWith("0")||n.endsWith("0")))?e:parseFloat(e)}return e}var un="spreadsheetLocale",fn={SortOutOfRangeError:"Select a cell or range inside the used range and try again."};function gn(r,n,a,l,d,h,p,c,u,f,g,m){return void 0===u&&(u=!0),new Promise((function(v){v(function(){var v,y=n.lastIndexOf("!");y>-1?(v=In(r,n.substring(0,y)),n=n.substring(y+1)):v=r.activeSheetIndex;var C=Fn(r,v),b=s(f||n),x={sheet:C,indexes:b,formulaCellRef:p,sheetIndex:c,promise:new Promise((function(e){e(void 0)}))};return r.notify(_,x),x.promise.then((function(){var s,p,c,f=b[0],y=r.frozenRowCount(C),x=r.frozenColCount(C),S=!!m;if(a){var w,I,E,N,R,A,k,O;c=[],l?(A=(0,e.getNumericObject)(r.locale),k=new e.Internationalization(r.locale)):O=$r(r),n.split(",").forEach((function(n,i){for(b=t(n),w=0,f=b[0];f<=b[2];){for(I=c[w]||{},p=fl(C,f),s=b[1];s<=b[3];)if(!u||!ml(C,f)||h&&vl(C,f)){N=o(s+1);var a=p?zn(f,s,C):null;if(l){if(a&&(a.value||0===a.value||a.formula))a.formattedText&&a.format&&!a.format.includes("*")?Yn(a.format,!1)?I[N]=on(a.value):I[N]=a.formattedText.toString().trim():I[N]=mn(r,a,f,s,v,!1,k),"string"==typeof(R=a.value)&&("."!==A.decimal&&R.includes(A.decimal)?dn(E=R.replace(A.decimal,"."))&&(R=parseFloat(E)):dn(R)&&(R=parseFloat(R)));else if(a&&a.hyperlink){var d=a.hyperlink;"string"==typeof d?(I[N]=d,R=d):d.address?(I[N]=d.address,R=d.address):(I[N]="",R="")}else I[N]="",R=null;I[N+"_value"]=R}else if((a&&(a.formula||!(0,e.isNullOrUndefined)(a.value))||Object.keys(I).length)&&(s===g?((R={value:mn(r,a,f,s,v,!0)}).value&&"string"==typeof R.value&&(dn(R.value)&&!a.value.toString().includes("\n")?a.format&&"@"===a.format||(R.value=parseFloat(R.value)):a.format||(O(a),dn(a.value)&&!a.value.toString().includes("\n")&&(R.value=parseFloat(a.value)))),I[N]=(0,e.extend)({},a,R)):I[N]=a),a&&(a.rowSpan&&1!==a.rowSpan||a.colSpan&&1!==a.colSpan))return void(c=[{throwMergeAlert:!0}]);s===b[3]&&Object.keys(I).length&&(I.__rowIndex=(f+1).toString(),c[w]=I,S&&0===i&&!vl(C,f)&&m.push(I),w++),s++}else f++;f++}}))}else{c=new Map;for(var F=!(l||!d||!d.length);f<=b[2];)if(F&&f>=y&&f<d[0])f=d[0];else if(l||!ml(C,f)){for(p=fl(C,f),s=b[1];s<=b[3];){var T={cell:zn(f,s,C),address:i(f,s),rowIndex:f,colIndex:s};r.trigger(ht,T);var D=zn(f,s,C,!1,!0);if(D.formula&&D.formula.toUpperCase().includes("UNIQUE")&&r.notify(ne,{cell:D,rowIdx:f,colIdx:s,sheetIndex:r.activeSheetIndex,address:T.address}),D.colSpan>1&&D.rowSpan>1)for(var L=void 0,P=f,M=f+D.rowSpan;P<M;P++)for(var B=s,H=s+D.colSpan;B<H;B++)P===f&&B===s||(L=new Object,P!==f&&(L.rowSpan=f-P),B!==s&&(L.colSpan=s-B),C.rows[P]&&C.rows[P].cells&&C.rows[P].cells[B]&&(delete C.rows[P].cells[B].value,delete C.rows[P].cells[B].formula),jn(P,B,C,L,!0));else if(D.colSpan>1)for(P=s+1,M=s+D.colSpan;P<M;P++)jn(f,P,C,{colSpan:s-P},!0),C.rows[f]&&C.rows[f].cells&&C.rows[f].cells[P]&&(delete C.rows[f].cells[P].value,delete C.rows[f].cells[P].formula);else if(D.rowSpan>1)for(P=f+1,M=f+D.rowSpan;P<M;P++)jn(P,s,C,{rowSpan:f-P},!0),C.rows[P]&&C.rows[P].cells&&C.rows[P].cells[s]&&(delete C.rows[P].cells[s].value,delete C.rows[P].cells[s].formula);if(l||!Al(C,s))if(F&&s>=x&&s<d[1])s=d[1];else{if(D.style){var U={};Object.assign(U,D.style),D.style=U}c.set(T.address,D),s++}else s++}f++}else f++}return c}))}())}))}function mn(t,r,n,i,a,o,s){if(r){if(r.formula&&(0,e.isNullOrUndefined)(r.value)&&t.notify(ne,{cell:r,rowIdx:n,colIdx:i,sheetIndex:a}),(0,e.isNullOrUndefined)(r.value))return"";if(r.format){var l={value:r.value,formattedText:r.value,cell:r,format:r.format,checkDate:!o,rowIndex:n,colIndex:i,dataUpdate:!0};return t.notify(re,l),l.dateObj&&"Invalid Date"!==l.dateObj.toString()?l.dateObj:o?l.value:l.formattedText.toString().trim()}if(o)return r.value;var d=r.value;if(dn(d)&&((d=Number(r.value).toString()).includes(".")||d.length>11)){var h={args:{value:d,updateValue:!0},fResult:d,cellVal:d,intl:s};t.notify(ge,h),d=h.fResult}return d}return""}function vn(t,r){var n,i,a;if((0,e.isUndefined)(t[r])||!t[r]||t[r].index!==r)for(var o=0;o<=r;o++)if(t&&t[o]){if((n=t[o].index-o)>0){for(t.forEach((function(e,t){e&&e.index&&(a=e.index,i=1),e&&!e.index&&0!==t&&(e.index=a+i),i++}));n--;)t.splice(o,0,null);o+=n}}else t?t[o]=null:t=[];return t[r]}function yn(t,r,n,i){var a,o,s=0,l=t.length;i&&t.length>0&&t.sort((function(t,r){return(0,e.isNullOrUndefined)(t)||(0,e.isUndefined)(t.index)||(0,e.isNullOrUndefined)(r)||(0,e.isUndefined)(r.index)?0:t.index-r.index}));for(var d,h=function(i){if((0,e.isNullOrUndefined)(t[i])||(0,e.isUndefined)(t[i].index)||(o=s=t[i].index-i,delete t[i].index),s>0){for(a=0;s--;)r?(n.createSheet(i+a),a++):t.splice(i,0,null);i+=o,l+=o}if(r){t[i].id<1&&(t[i].id=Dn(n.sheets),t[i].properties&&(t[i].properties.id=t[i].id)),t[i].name||n.setSheetPropertyOnMute(t[i],"name","Sheet"+Tn(n));var h=0;t[i].rows.forEach((function(e){h=Math.max(h,e&&e.cells&&e.cells.length-1||0)})),n.setSheetPropertyOnMute(t[i],"usedRange",{rowIndex:t[i].rows.length?t[i].rows.length-1:0,colIndex:h})}d=i},p=0;p<l;p++)h(p),p=d}var Cn=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),bn=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},xn=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Cn(r,t),r.prototype.setProperties=function(e,r){var n=this;if(this.parentObj.isComplexArraySetter&&this.controlParent&&this.controlParent.isAngular)if(Object.keys(e).length){void 0===this.parentObj.currRangeIdx?this.parentObj.currRangeIdx=0:this.parentObj.currRangeIdx+=1;var i=this.parentObj.ranges[this.parentObj.currRangeIdx];i&&i.info&&(this.info=i.info),setTimeout((function(){void 0!==n.parentObj.currRangeIdx&&delete n.parentObj.currRangeIdx}))}else if(this.controlParent.tagObjects[0].instance&&this.controlParent.tagObjects[0].instance.hasChanges&&!this.controlParent.tagObjects[0].instance.isInitChanges){var a=this.controlParent.sheets.indexOf(this.parentObj);if(void 0===this.parentObj.changedRangeIdx){for(var o,s=this.controlParent.tagObjects[0].instance.list[a].tagObjects,l=0;l<s.length;l++)if("ranges"===s[l].name){s[l].instance.list.forEach((function(e,t){e.hasChanges&&(o=t)}));break}this.parentObj.changedRangeIdx=o}}t.prototype.setProperties.call(this,e,r)},bn([(0,e.Property)(null)],r.prototype,"dataSource",void 0),bn([(0,e.Property)("A1")],r.prototype,"startCell",void 0),bn([(0,e.Property)(null)],r.prototype,"query",void 0),bn([(0,e.Property)(null)],r.prototype,"fieldsOrder",void 0),bn([(0,e.Property)(!0)],r.prototype,"showFieldAsHeader",void 0),bn([(0,e.Property)("")],r.prototype,"template",void 0),bn([(0,e.Property)("A1")],r.prototype,"address",void 0),r}(e.ChildProperty),Sn=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Cn(r,t),bn([(0,e.Property)(0)],r.prototype,"rowIndex",void 0),bn([(0,e.Property)(0)],r.prototype,"colIndex",void 0),r}(e.ChildProperty),wn=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Cn(r,t),bn([(0,e.Property)(null)],r.prototype,"rows",void 0),bn([(0,e.Property)(null)],r.prototype,"columns",void 0),bn([(0,e.Complex)({},R)],r.prototype,"protectSettings",void 0),bn([(0,e.Collection)([],xn)],r.prototype,"ranges",void 0),bn([(0,e.Collection)([],F)],r.prototype,"conditionalFormats",void 0),bn([(0,e.Property)(0)],r.prototype,"index",void 0),bn([(0,e.Property)("")],r.prototype,"name",void 0),bn([(0,e.Property)(100)],r.prototype,"rowCount",void 0),bn([(0,e.Property)(100)],r.prototype,"colCount",void 0),bn([(0,e.Property)("A1:A1")],r.prototype,"selectedRange",void 0),bn([(0,e.Property)("A1")],r.prototype,"activeCell",void 0),bn([(0,e.Complex)({},Sn)],r.prototype,"usedRange",void 0),bn([(0,e.Property)("A1")],r.prototype,"topLeftCell",void 0),bn([(0,e.Property)(!0)],r.prototype,"showHeaders",void 0),bn([(0,e.Property)(!0)],r.prototype,"showGridLines",void 0),bn([(0,e.Property)(!1)],r.prototype,"isProtected",void 0),bn([(0,e.Property)("Visible")],r.prototype,"state",void 0),bn([(0,e.Property)(0)],r.prototype,"frozenRows",void 0),bn([(0,e.Property)(0)],r.prototype,"frozenColumns",void 0),bn([(0,e.Property)("A1")],r.prototype,"paneTopLeftCell",void 0),bn([(0,e.Property)("")],r.prototype,"password",void 0),bn([(0,e.Property)(null)],r.prototype,"standardHeight",void 0),bn([(0,e.Property)(!1)],r.prototype,"isSheetCalculated",void 0),r}(e.ChildProperty);function In(e,t){var r;t.startsWith("'")&&t.endsWith("'")&&(t=t.replace(/''/g,"'").replace(/^'|'$/g,""));for(var n=0;n<e.sheets.length;n++)if(e.sheets[n].name.toLowerCase()===t.toLowerCase()){r=n;break}return r}function En(e,t){for(var r,n=0;n<e.sheets.length;n++)if(e.sheets[n].id===t){r=n;break}return r}function Nn(e){var t=e.lastIndexOf("!");return t>-1?e.substring(0,t).replace(/'/gi,""):e.replace(/'/gi,"")}function Rn(e,t,r){for(var n=r.length,i=0;i<n;i++)if(r[i].sheet.toUpperCase()===t.toUpperCase())return r[i].index;return-1}function An(e,t,r,n){void 0===r&&(r={}),e.setSheetPropertyOnMute(r,"selectedRange",n?r.selectedRange+" "+t:t)}function kn(e){return e&&e.selectedRange||"A1"}function On(e){return e.selectedRange.split(" ")[0]}function Fn(e,t){return e.sheets[t]}function Tn(e){var t=[];e.sheets.forEach((function(e){t.push(e.name.toLowerCase())}));for(var r=0;r<t.length;r++){if(!(t.indexOf("sheet"+e.sheetNameCount)>-1))return e.sheetNameCount++;e.sheetNameCount++}return e.sheetNameCount++}function Dn(e){var t=0;return e.forEach((function(e){t=Math.max(e.id,t)})),t+1}function Ln(t,n,a){var o=n||t.sheets;o.forEach((function(n){if(n.id=n.id||0,n.name=n.name||"",t.setSheetPropertyOnMute(n,"rowCount",n.rowCount||100),t.setSheetPropertyOnMute(n,"colCount",n.colCount||100),t.setSheetPropertyOnMute(n,"topLeftCell",n.topLeftCell||"A1"),t.setSheetPropertyOnMute(n,"activeCell",n.activeCell||"A1"),t.setSheetPropertyOnMute(n,"selectedRange",n.selectedRange||n.activeCell+":"+n.activeCell),t.setSheetPropertyOnMute(n,"usedRange",n.usedRange||{rowIndex:0,colIndex:0}),t.setSheetPropertyOnMute(n,"ranges",n.ranges?n.ranges:[]),t.setSheetPropertyOnMute(n,"rows",n.rows&&(0,e.extend)([],n.rows,null,!0)||[]),t.setSheetPropertyOnMute(n,"columns",n.columns||[]),t.setSheetPropertyOnMute(n,"showHeaders",!!(0,e.isUndefined)(n.showHeaders)||n.showHeaders),t.setSheetPropertyOnMute(n,"showGridLines",!!(0,e.isUndefined)(n.showGridLines)||n.showGridLines),t.setSheetPropertyOnMute(n,"state",n.state||"Visible"),n.maxHgts=n.maxHgts||[],n.isImportProtected=n.isProtected&&a,n.protectSettings=n.protectSettings||{selectCells:!1,formatCells:!1,formatRows:!1,formatColumns:!1,insertLink:!1},n.isProtected=n.isProtected||!1,!n.paneTopLeftCell||"A1"===n.paneTopLeftCell){n.frozenRows=n.frozenRows?n.frozenRows:0,n.frozenColumns=n.frozenColumns?n.frozenColumns:0;var o=r(n.topLeftCell);t.setSheetPropertyOnMute(n,"paneTopLeftCell",i(n.frozenRows?o[0]+n.frozenRows:o[0],n.frozenColumns?o[1]+n.frozenColumns:o[1]))}yn(n.columns),function(e,t){e.forEach((function(e){e&&e.cells&&yn(e.cells,null,void 0,t)})),yn(e,null,void 0,t)}(n.rows,a)})),yn(o,!0,t)}function Pn(e,t){return void 0===t&&(t=e.activeSheetIndex),Fn(e,t).name}function Mn(e,t,r,n,i){var a=!!r;r=r||[e.activeSheetIndex];var o=Pn(e),s={action:"moveSheet",eventArgs:{position:t=function(e,t,r){for(var n=t;r?n>=0:n<e.length;r?n--:n++)if("Hidden"!==e[n].state&&"VeryHidden"!==e[n].state){t=n;break}return t}(e.sheets,t,e.activeSheetIndex>t),sheetIndexes:r,cancel:!1}};n&&e.trigger("actionBegin",s),s.eventArgs.cancel||(e.notify(mr,{prevIndex:e.activeSheetIndex,currentIndex:t}),r.forEach((function(r,n){e.sheets.splice(t+n,0,e.sheets.splice(r+(t>r?-1*n:0),1)[0])})),e.setProperties({activeSheetIndex:i?In(e,o):t>r[0]?t-(r.length-1):t},!0),e.notify(Yt,{refresh:a}),n&&(delete s.eventArgs.cancel,e.trigger("actionComplete",s)))}function Bn(t,r,n,i){var a={action:"duplicateSheet",eventArgs:{sheetIndex:r=(0,e.isUndefined)(r)?t.activeSheetIndex:r,cancel:!1}};if(n&&t.trigger("actionBegin",a),!a.eventArgs.cancel){var o=Fn(t,r),s=o.name,l=(0,e.extend)({},o.properties?o.properties:o,{},!0);l.id=Dn(t.sheets);var d=l.name;/^\(\d+\)$/.test("("+d.split(" (")[1])&&(d=d.split(" (")[0]);var h=[];t.sheets.forEach((function(e){h.push(e.name)}));for(var p=2;;p++){var c=" ("+p+")";if((d+c).length>31&&(d=d.slice(0,31-c.length)),-1===h.indexOf(d+c)){l.name=d+c;break}}t.notify(or,{sheetIndex:r,newSheetIndex:r+1}),t.notify(Cr,{isDuplicate:!0,curSheetIndex:r,newSheetIndex:r+1}),l.rows.forEach((function(r){r&&r.cells&&r.cells.forEach((function(r){if(r){if(r.image)r.image.forEach((function(r){r.id=(0,e.getUniqueID)(t.element.id+"_overlay_picture_")}));var n=r.chart;n&&n.forEach((function(t){var r=t.range.lastIndexOf("!"),n=t.range.substring(0,r),i=l.name;n.startsWith("'")&&n.endsWith("'")&&(n=n.slice(1,-1),i="'"+i+"'"),n===s&&(t.range=i+t.range.substring(r),t.id=(0,e.getUniqueID)(t.id||"e_spreadsheet_chart"))}))}}))})),t.createSheet(r+1,[l]),t.notify(pe,{action:"addSheet",sheetName:"Sheet"+l.id,visibleName:l.name,sheetId:l.id}),i||t.setProperties({activeSheetIndex:r+1},!0),t.notify(Yt,{refresh:!0,isDuplicate:!0}),n&&(delete a.eventArgs.cancel,t.trigger("actionComplete",a))}}var Hn=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Un=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Vn=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Hn(r,t),Un([(0,e.Property)("")],r.prototype,"notes",void 0),Un([(0,e.Collection)([],V)],r.prototype,"image",void 0),Un([(0,e.Collection)([],U)],r.prototype,"chart",void 0),Un([(0,e.Property)("")],r.prototype,"value",void 0),Un([(0,e.Property)("")],r.prototype,"formula",void 0),Un([(0,e.Property)(0)],r.prototype,"index",void 0),Un([(0,e.Property)("General")],r.prototype,"format",void 0),Un([(0,e.Complex)({},w)],r.prototype,"style",void 0),Un([(0,e.Property)("")],r.prototype,"hyperlink",void 0),Un([(0,e.Property)(!1)],r.prototype,"wrap",void 0),Un([(0,e.Property)(!0)],r.prototype,"isLocked",void 0),Un([(0,e.Property)("")],r.prototype,"validation",void 0),Un([(0,e.Property)(1)],r.prototype,"colSpan",void 0),Un([(0,e.Property)(1)],r.prototype,"rowSpan",void 0),Un([(0,e.Property)(!1)],r.prototype,"isReadOnly",void 0),r}(e.ChildProperty);function zn(e,t,r,n,i){var a=fl(r,e);if(!a||!a.cells){if(!n)return i?{}:null;a?r.rows[e].cells=[]:r.rows[e]={cells:[]}}return r.rows[e].cells[t]||(i?{}:null)}function jn(t,r,n,i,a){n.rows[t]?n.rows[t].cells||(n.rows[t].cells=[]):n.rows[t]={cells:[]},a&&n.rows[t].cells[r]?(0,e.extend)(n.rows[t].cells[r],i,null,!0):n.rows[t].cells[r]=i}function _n(e,t){var r,n={fontFamily:"Calibri",verticalAlign:"bottom",textIndent:"0pt",backgroundColor:"#ffffff",color:"#000000",textAlign:"left",fontSize:"11pt",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",border:"",borderLeft:"",borderTop:"",borderRight:"",borderBottom:""},i={};return Object.keys(t?n:e).forEach((function(t){(r=e[""+t])!==n[""+t]&&(i[""+t]=r)})),i}function qn(e,t,r,n,i){if(void 0===t&&(t=!0),r.allowWrap){for(var a=r.getAddressInfo(e),o=a.indices,s=Fn(r,a.sheetIndex),l=a.sheetIndex===r.activeSheetIndex,d=o[0];d<=o[2];d++)for(var h=o[1];h<=o[3];h++)!Vr(r,s,{cell:{wrap:t},rowIdx:d,colIdx:h,preventEvt:n})&&l&&r.notify(Ge,{range:[d,h,d,h],wrap:t,sheet:s,initial:!0,isPublic:i});r.setProperties({sheets:r.sheets},!0)}}function Wn(e){var t;if(e.indexOf("[")>-1){var r=e.split("[")[1].split("]")[0];["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"].indexOf(r)>-1&&(t=r)}return t}function Gn(){return["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"]}function Yn(e,t,r,n){var i;if(e.includes('"')){var a,o,s=e.split(";");s.forEach((function(e,t){for(var r=0;r<e.length;r++)if('"'===e[r]&&"\\"!==e[r-1]){a=r;do{a=e.indexOf('"',a+1),o=e[a-1]}while("\\"===o||"_"===o||"*"===o);if(-1===a)break;e=e.substring(0,r)+e.substring(a+1),r--}s[t]=e})),e=s.join(";")}return!e.includes("d")&&!e.includes("y")||e.includes("#")||Wn(e)||(r&&(r.type="date"),n&&e.includes(" ")&&2===e.split(" ").length?e=e.split(" ")[1]:t=!1,i=!0),t&&(e.includes("h")||e.includes("m")||e.includes("s"))&&!e.includes("#")&&!Wn(e)&&(r&&(r.type=r.type||"",r.type+="time"),i=!0),i}var Xn,Kn,$n,Zn=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Hn(r,t),Un([(0,e.Property)(0)],r.prototype,"chunkSize",void 0),Un([(0,e.Property)(3)],r.prototype,"retryCount",void 0),Un([(0,e.Property)(500)],r.prototype,"retryAfterDelay",void 0),r}(e.ChildProperty),Jn=function(){function n(e){this.parent=e,this.requestedInfo=[],this.addEventListener()}return n.prototype.addEventListener=function(){this.parent.on(_,this.updateSheetFromDataSourceHandler,this),this.parent.on(q,this.dataSourceChangedHandler,this),this.parent.on(W,this.dataChangedHandler,this),this.parent.on(G,this.triggerDataChangeHandler,this)},n.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(_,this.updateSheetFromDataSourceHandler),this.parent.off(q,this.dataSourceChangedHandler),this.parent.off(W,this.dataChangedHandler),this.parent.off(G,this.triggerDataChangeHandler))},n.prototype.updateSheetFromDataSourceHandler=function(e){var r,n,i,a,o,s,l,d,h,p,c,u,f=this,g=[],m=[],v=new Sr.Deferred;e.promise=v.promise;var y=e.autoDetectFormat,C=y&&$r(this.parent);if(e.sheet&&e.sheet.ranges.length)for(var b,x=function(x){var w=e.sheet.ranges[x];u=t(w.startCell),e.loadFromStartCell&&(e.indexes=u);var I=e.indexes[0],E=e.indexes[2];h=u[0],s=w.dataSource instanceof Sr.DataManager?w.dataSource:w.dataSource?new Sr.DataManager(w.dataSource):new Sr.DataManager,o=o||s.dataSource.url,e.sheet.isLocalData=!s.dataSource.url,h<=I?I-=h:h<=E?(E-=h,I=0):I=-1,w.showFieldAsHeader&&0!==I&&(I-=1);var N=!1,R=0;S.initRangeInfo(w);var A=S.getMaxCount(w);if(c=S.getLoadedInfo(I,E,w),I=c.unloadedRange[0],E=c.unloadedRange[1],w.info.insertRowRange&&(w.info.insertRowRange.forEach((function(e){R+=e[1]-e[0]+1})),I-=R,E-=R),I>=A?N=!0:E>A&&(E=A),e.loadComplete||S.requestedInfo.push({deferred:v,indexes:e.indexes,isNotLoaded:c.isNotLoaded}),I>=0&&c.isNotLoaded&&!N){var k;m[x]=I,g[x]=!1,w.fieldsOrder&&(k=[].slice.call(w.fieldsOrder));var O=(w.query?w.query:new Sr.Query).clone();e.loadFullData||(O=O.range(I,E>=A?E:E+1)),s.executeQuery(O.requiresCount()).then((function(o){if(f.parent&&!f.parent.isDestroyed){if(a=o.result&&o.result.result?o.result.result:o.result,i=t(w.startCell),h=i[0],p=i[1],a&&a.length){if(w.info.count||(A=o.count,w.info.count=o.count),n=w.info.flds||k||Object.keys(a[0]),w.info.fldLen||(w.info.fldLen=n.length,w.info.flds=n),w.info.insertColumnRange){var s=0;w.info.insertColumnRange.forEach((function(e){for(var t=e[0];t<=e[1];t++)t<=p?n.splice(0,0,"emptyCell"+s):n.splice(t-p,0,"emptyCell"+s),s++}))}0===m[x]&&w.showFieldAsHeader&&(l=h+m[x]+R,n.forEach((function(t,n){(r=zn(l,p+n,e.sheet,!0))?t.includes("emptyCell")||(r.value=t):e.sheet.rows[h+m[x]].cells[p+n]=t.includes("emptyCell")?{}:{value:t}}))),a.forEach((function(t,i){l=h+m[x]+i+(w.showFieldAsHeader?1:0)+R,n.forEach((function(n,i){(r=zn(l,d=p+i,e.sheet,!0))?(b=r.value,n.includes("emptyCell")||jn(l,d,e.sheet,f.getCellDataFromProp(t[n]),!0)):(b=void 0,r=e.sheet.rows[l].cells[d]=n.includes("emptyCell")?{}:f.getCellDataFromProp(t[n])),y&&C(r),e.updateDependentCellsCallback&&b!==r.value&&e.updateDependentCellsCallback(l,d)}))}))}else n=[];var u;u=h+(A||o.count)>0?h+(A||o.count)+(w.showFieldAsHeader?1:0)+R-1:e.sheet.usedRange.rowIndex;var v=p+n.length-1<0?e.sheet.usedRange.colIndex:p+n.length-1;e.loadFullData&&(E=u);var S={rowIndex:u,colIndex:v};if(f.parent.scrollSettings&&f.parent.scrollSettings.isFinite&&(S.rowIndex=u<e.sheet.rowCount?u:e.sheet.rowCount-1,S.colIndex=v<e.sheet.colCount?v:e.sheet.colCount-1),e.sheet.usedRange.rowIndex<S.rowIndex&&f.parent.setSheetPropertyOnMute(e.sheet,"usedRange",{rowIndex:S.rowIndex,colIndex:e.sheet.usedRange.colIndex}),e.sheet.usedRange.colIndex<S.colIndex&&f.parent.setSheetPropertyOnMute(e.sheet,"usedRange",{rowIndex:e.sheet.usedRange.rowIndex,colIndex:S.colIndex}),R?(c=f.getLoadedInfo(I,E,w),I=c.unloadedRange[0],E=c.unloadedRange[1],I>A&&(c.isNotLoaded=!1),c.isNotLoaded&&(E>A&&(E=A),w.info.loadedRange.push([I,E]))):w.info.loadedRange.push([I,E]),g[x]=!0,-1===g.indexOf(!1)){var N=void 0;if(E+h<h+w.info.count){e.rangeSettingCount||(e.rangeSettingCount=[]),e.rangeSettingCount.push(x),N=!0;var O={sheet:e.sheet,indexes:[0,0,u,v],promise:new Promise((function(e){e(void 0)})),rangeSettingCount:e.rangeSettingCount,loadComplete:e.loadComplete,autoDetectFormat:e.autoDetectFormat,resolveAfterFullDataLoaded:e.resolveAfterFullDataLoaded};f.updateSheetFromDataSourceHandler(O),O.promise.then((function(){"workbook"!==f.parent.getModuleName()&&(e.rangeSettingCount.pop(),e.rangeSettingCount.length||f.parent.notify("created",null),e.formulaCellRef?f.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex):e.loadComplete&&e.loadComplete())}))}else e.formulaCellRef?f.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex):e.loadComplete&&e.loadComplete();N&&e.resolveAfterFullDataLoaded||(f.checkResolve(e.indexes),e.resolveAfterFullDataLoaded&&f.checkResolve([0,0,0,0]))}}}))}else 0===x&&-1===g.indexOf(!1)&&(e.loadComplete&&e.loadComplete(),S.checkResolve(e.indexes))},S=this,w=e.sheet.ranges.length-1;w>=0;w--)x(w);else v.resolve()},n.prototype.notfyFormulaCellRefresh=function(e,r){this.parent.formulaRefCell=null,this.parent.notify(tr,{indexes:t(e),sheetIndex:r,refreshing:!0})},n.prototype.checkResolve=function(e){var t,r,n=0;this.requestedInfo.forEach((function(i,a){((r=JSON.stringify(i.indexes)===JSON.stringify(e))||t)&&(0===a?(i.deferred.resolve(),n++,t=!0):!t||!i.isLoaded&&i.isNotLoaded?r&&t?(i.deferred.resolve(),n++):r?i.isLoaded=!0:t=!1:(i.deferred.resolve(),n++))})),this.requestedInfo.splice(0,n)},n.prototype.getCellDataFromProp=function(t){var r={};return"[object Object]"===Object.prototype.toString.call(t)?t.formula?r.formula=t.formula:(0,e.isNullOrUndefined)(t.value)||("string"==typeof t.value&&(0===t.value.indexOf("http://")||0===t.value.indexOf("https://")||0===t.value.indexOf("ftp://")||0===t.value.indexOf("www."))?(r.hyperlink=t.value,r.style={textDecoration:"underline",color:"#00e"}):r.value=t.value):wr(t)?r.formula=t:"string"==typeof t&&(0===t.indexOf("http://")||0===t.indexOf("https://")||0===t.indexOf("ftp://")||0===t.indexOf("www."))?(r.hyperlink=t,r.style={textDecoration:"underline",color:"#00e"}):r.value=t,r},n.prototype.getLoadedInfo=function(e,t,r){var n=!0;return r.info.loadedRange.forEach((function(r){r[0]<=e&&e<=r[1]?r[0]<=t&&t<=r[1]?n=!1:e=r[1]+1:r[0]<=t&&t<=r[1]&&(t=r[0]-1)})),{isNotLoaded:n,unloadedRange:[e,t]}},n.prototype.getMaxCount=function(e){if(e.query)for(var t=e.query.queries,r=0;r<t.length;r++)if("onTake"===t[r].fn)return Math.min(t[r].e.nos,e.info.count||t[r].e.nos);return e.info.count},n.prototype.initRangeInfo=function(e){e.info||(e.info={loadedRange:[]})},n.prototype.dataSourceChangedHandler=function(e){var t,n=this,i=this.parent.sheets[e.sheetIdx],a=i.ranges[e.rangeIdx];if(a&&(this.checkRangeHasChanges(i,e.rangeIdx)||!a.info)){var o=a.showFieldAsHeader,s=r(a.startCell);a.info&&(a.info.loadedRange.forEach((function(e){for(var r=e[0];r<=e[1]&&r<a.info.count+(o?1:0);r++)if(t=i.rows[r+s[0]])for(var n=s[1];n<s[1]+a.info.fldLen;n++)t.cells&&t.cells[n]&&delete t.cells[n]})),a.info=null);var l={sheet:i,indexes:[0,0,i.rowCount-1,i.colCount-1],loadFullData:!0,promise:new Promise((function(e){e(void 0)}))};this.updateSheetFromDataSourceHandler(l),l.promise.then((function(){n.parent.trigger("dataSourceChanged",{data:e.changedData,action:"dataSourceChanged",rangeIndex:e.rangeIdx,sheetIndex:e.sheetIdx}),n.parent.notify(tr,{sheetIndex:e.sheetIdx,checkWrap:!0,checkCF:!0})}))}},n.prototype.checkRangeHasChanges=function(e,t){return!this.parent.isAngular||e.changedRangeIdx===t&&(delete e.changedRangeIdx,!0)},n.prototype.dataChangedHandler=function(e){var n,a,o,s,l,d,h,p,c,u=this,f=[{}],g=void 0===e.sheetIdx?this.parent.activeSheetIndex:e.sheetIdx,m=this.parent.sheets[g];m.ranges.forEach((function(v,y){if(v.dataSource){var C=void 0;if(s=r(v.startCell),o=s.concat([s[0]+v.info.count+(v.showFieldAsHeader?0:-1),s[1]+v.info.fldLen-1]),"Row"===e.modelType||"Column"===e.modelType){if("Column"===e.modelType){if(e.insertType)l=o[1]<e.index&&o[3]>=e.index,p=[e.index],l||o[3]+1===e.index&&"after"===e.insertType?(e.model.forEach((function(){v.info.flds.splice(e.index-s[1],0,"")})),v.info.fldLen+=e.model.length):o[1]>=e.index&&(v.startCell=i(s[0],s[1]+e.model.length));else if(l=o[1]<=e.startIndex&&o[3]>=e.startIndex)for(var b=e.startIndex;b<=e.endIndex;b++)b<=o[3]&&(v.info.flds.splice(e.startIndex,1),v.info.fldLen-=1);return}if(e.insertType){if(l=(v.showFieldAsHeader||"above"!==e.insertType&&!e.isMethod?o[0]<e.index:o[0]<=e.index)&&o[2]>=e.index,p=[e.index],l||o[2]+1===e.index&&"below"===e.insertType?(C=!0,v.info.count+=e.model.length):o[0]>=e.index&&(v.startCell=i(s[0]+e.model.length,s[1])),e.isMethod)return}else l=o[0]<=e.startIndex&&o[2]>=e.startIndex,e.isDataRequest?p=[e.startIndex,o[1],e.startIndex,o[1]]:n="delete"}else{var x=e.address||e.range||e.fillRange;p=t(e.requestType&&e.requestType.toLowerCase().includes("paste")?e.pastedRange.substring(e.pastedRange.lastIndexOf("!")+1):e.sheetIdx>-1?e.address:x.substring(x.lastIndexOf("!")+1));var S=[v.showFieldAsHeader?o[0]+1:o[0]].concat(o.slice(1,4));if(v.showFieldAsHeader&&p[0]===s[0])for(b=p[1];b<=p[3];b++)b>=S[1]&&b<=S[3]&&(v.info.flds[b-s[1]]=zn(s[0],b,m,!1,!0).value||"");if(l=Or(S,p,!0),"paste"===e.requestType&&e.copiedInfo.isCut){if(c=[].slice.call(e.copiedInfo.range),v.showFieldAsHeader&&c[0]===s[0]){for(b=c[1];b<=c[3];b++)b>=S[1]&&b<=S[3]&&(v.info.flds[b-s[1]]="");l=!1}d=Or(S,c,!0)}}if(l||C||d){if("Row"!==e.modelType||e.insertType||e.isDataRequest){n=C?"add":"edit";var w=0;if(d){w=c[2]-c[0]+1;var I=function(e){f[e]={},v.info.flds.forEach((function(t,r){t&&(a=zn(c[0]+e,s[1]+r,m),f[e][""+t]=u.getFormattedValue(a))}))};for(b=0;b<w;b++)I(b)}if(l||C)for(var E,N=!(e.isDataRequest||d||C||e.skipFilterCheck),R=function(e,t){if(N&&vl(m,p[0]+e))return E=t,"continue";f[t+w]={},v.info.flds.forEach((function(r,n){r&&(a=zn(p[0]+e,s[1]+n,m),f[t+w][""+r]=u.getFormattedValue(a))})),t++,E=t},A=(b=0,0);b<(C?e.model.length:p[2]-p[0]+1||1);b++)R(b,A),A=E}else{if(e.deletedModel.forEach((function(e,t){f[t]={},v.info.flds.forEach((function(r,n){e.cells?(a=e.cells[s[1]+n],f[t][""+r]=u.getFormattedValue(a)):f[t][""+r]=null})),v.info.count-=1})),e.isMethod)return;h={count:e.deletedModel.length,index:e.endIndex}}e.isDataRequest?e.data=f:u.parent.trigger("dataSourceChanged",{data:f,action:n,rangeIndex:y,sheetIndex:g})}else h&&h.count&&o[0]>h.index&&(v.startCell=i(s[0]-h.count,s[1]))}}))},n.prototype.getFormattedValue=function(e){var t=this.parent.getDisplayText(e);return""===t?null:e&&!e.format&&"number"==typeof e.value?e.value:t},n.prototype.triggerDataChangeHandler=function(t){var r=!0;if((("delete"===t.action||"insert"===t.action)&&["Sheet"].indexOf(t.eventArgs.modelType)>-1||"clear"===t.action&&["Clear Formats","Clear Hyperlinks"].indexOf(t.eventArgs.type)>-1||"clipboard"===t.action&&"Formats"===t.eventArgs.requestType)&&(r=!1),r&&["insert","delete","edit","cellDelete","cellSave","autofill","clipboard","clear"].indexOf(t.action)>-1){var n=void 0;!t.isUndo||"delete"!==t.action&&"insert"!==t.action?n=t.eventArgs:(n=(0,e.extend)({},t.eventArgs),"delete"===t.action?(n.index=n.startIndex,n.model=n.deletedModel,n.insertType="below"):(n.startIndex=n.index,n.endIndex=t.eventArgs.index+t.eventArgs.model.length-1,n.deletedModel=n.model,delete n.insertType)),this.parent.notify(W,n)}},n.prototype.getModuleName=function(){return"dataBind"},n.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.requestedInfo=[]},n}(),Qn="ribbon",ei="formulaBar",ti="sheetTabs",ri="refreshSheetTabs",ni="isFormulaBarEdit",ii="contentLoaded",ai="mouseDown",oi="spreadsheetDestroyed",si="editOperation",li="formulaOperation",di="formulaBarOperation",hi="click",pi="keyUp",ci="keyDown",ui="formulaKeyUp",fi="formulaBarUpdate",gi="verticalScroll",mi="horizontalScroll",vi="focusRenameInput",yi="beforeContentLoaded",Ci="beforeVirtualContentLoaded",bi="virtualContentLoaded",xi="contextMenuOpen",Si="cellNavigate",wi="mouseUpAfterSelection",Ii="contextmenuBeforeOpen",Ei="insertSheetTab",Ni="removeSheetTab",Ri="renameSheetTab",Ai="ribboClick",ki="ribbonRefresh",Oi="enableToolbarItems",Fi="tabSwitch",Ti="selectRange",Di="rangeSelectionByKeydown",Li="cut",Pi="copy",Mi="paste",Bi="clearCopy",Hi="dataBound",Ui="beforeDataBound",Vi="addContextMenuItems",zi="removeContextMenuItems",ji="enableContextMenuItems",_i="enableFileMenuItems",qi="hideFileMenuItems",Wi="addFileMenuItems",Gi="hideRibbonTabs",Yi="enableRibbonTabs",Xi="addRibbonTabs",Ki="addToolbarItems",$i="hideToolbarItems",Zi="beforeRibbonCreate",Ji="rowHeightChanged",Qi="colWidthChanged",ea="onContentScroll",ta="deInitProperties",ra="activeSheetChanged",na="initiateCustomSort",ia="applySort",aa="collaborativeUpdate",oa="autoFitRowsColumns",sa="refreshFilterCellsOnResize",la="updateToggleItem",da="initiateHyperlink",ha="editHyperlink",pa="openHyperlink",ca="addNote",ua="editNote",fa="deleteNote",ga="showNote",ma="createNoteIndicator",va="updateNoteContainer",ya="removeNoteContainer",Ca="removeHyperlink",ba="createHyperlinkElement",xa="sheetNameUpdate",Sa="hideSheet",wa="performUndoRedo",Ia="updateUndoRedoCollection",Ea="setActionData",Na="getBeforeActionData",Ra="clearUndoRedoCollection",Aa="initiateFilterUI",ka="renderFilterCell",Oa="refreshFilterRange",Fa="reapplyFilter",Ta="filterByCellValue",Da="clearFilter",La="getFilteredColumn",Pa="actionComplete",Ma="filterCellKeyDown",Ba="getFilterRange",Ha="setAutoFit",Ua="refreshFormulaDatasource",Va="initiatedatavalidation",za="validationError",ja="startEdit",_a="invalidData",qa="clearInvalid",Wa="protectSheet",Ga="applyProtect",Ya="unprotectSheet",Xa="protectCellFormat",Ka="renderGotoDlgt",$a="renderFindDlg",Za="findHandler",Ja="created",Qa="spreadsheetCreated",eo="editAlert",to="readonlyAlert",ro="finiteAlert",no="setUndoRedo",io="enableFormulaInput",ao="protectSelection",oo="hiddenMerge",so="checkPrevMerge",lo="checkMerge",ho="removeDataValidation",po="showAggregate",co="goToSheet",uo="showSheet",fo="renderCFDlg",go="clearViewer",mo="initiateFormulaReference",vo="initiateCur",yo="clearCellRef",Co="editValue",bo="addressHandle",xo="initiateEdit",So="forRefSelRender",wo="insertImage",Io="refreshOverlayElem",Eo="refreshImgCellObj",No="getRowIdxFromClientY",Ro="getColIdxFromClientX",Ao="createImageElement",ko="deleteImage",Oo="deleteChart",Fo="refreshChartCellObj",To="refreshChartCellModel",Do="refreshImagePosition",Lo="updateTableWidth",Po="focusBorder",Mo="clearChartBorder",Bo="insertChart",Ho="chartRangeSelection",Uo="insertDesignChart",Vo="removeDesignChart",zo="chartDesignTab",jo="addChartEle",_o="undoRedoForChartDesign",qo="protectWorkbook",Wo="unProtectWorkbook",Go="setProtectWorkbook",Yo="removeWorkbookProtection",Xo="importProtectWorkbook",Ko="selectionStatus",$o="freeze",Zo="overlayEleSize",Jo="updateScroll",Qo="positionAutoFillElement",es="hideAutoFillOptions",ts="performAutoFill",rs="selectAutoFillRange",ns="autoFill",is="hideAutoFillElement",as="unProtectSheetPassword",os="updateTranslate",ss="getUpdatedScrollPosition",ls="updateScrollValue",ds="beforeCheckboxfilterRenderer",hs="refreshCheckbox",ps="renderInsertDlg",cs="toggleProtect",us="propertyChange",fs="updateWrapCell",gs=function(){function r(e){this.loopIndex=0,this.processedLoopIndex=0,this.retryCount=0,this.currentDocumentId=null,this.parent=e,this.addEventListener()}return r.prototype.open=function(e){this.load(e)},r.prototype.load=function(t,r){var n=this;if(this.parent.allowOpen)if(t.jsonObject)this.fetchSuccess(t.jsonObject,t,null,!0,!0);else{var i=new FormData;if(t.file)i.append("file",t.file);else{if(!(t.sheetIndex>=0))return void(this.parent.isOpen=!1);i.append("sheetPassword",t.sheetPassword),i.append("sheetIndex",t.sheetIndex.toString())}var a={passWord:""};t.password&&t.password.length&&(a.passWord=t.password),a.passWord&&a.passWord.length&&(t.password=a.passWord),t.password&&i.append("password",t.password),i.append("IsManualCalculationEnabled",("Manual"===this.parent.calculationMode).toString());var o={file:t.file||null,cancel:!1,requestData:{method:"POST",body:i},password:a.passWord},s=t.guid;if((0,e.isNullOrUndefined)(t.sheetPassword)&&!s&&(0,e.isNullOrUndefined)(r)?(this.parent.trigger("beforeOpen",o),this.parent.notify(K,{eventArgs:o,action:"beforeOpen"})):s&&i.append("guid",s),o.cancel)this.parent.isOpen=!1;else{var l={chunkSize:null,documentId:null};this.parent.openSettings.chunkSize>0&&(0,e.isNullOrUndefined)(t.sheetPassword)&&(this.setToDefaults(r),(0,e.isNullOrUndefined)(this.parent.openSettings.chunkSize)||0===this.parent.openSettings.chunkSize||(l.chunkSize=this.parent.openSettings.chunkSize.toString()),(0,e.isNullOrUndefined)(this.currentDocumentId)||(l.documentId=this.currentDocumentId),(0,e.isNullOrUndefined)(l)||i.append("chunkPayload",JSON.stringify(l))),fetch(this.parent.openUrl,o.requestData).then((function(e){return e.ok?e.json():Promise.reject({status:e.status,statusText:e.statusText,url:e.url})})).then((function(e){return n.fetchSuccess(e,o,t.orginalFile,void 0,!0)})).catch((function(e){-1===e.toString().indexOf("Unexpected end of JSON input")&&n.parent.openSettings.chunkSize>0&&n.retryCount<n.parent.openSettings.retryCount?setTimeout((function(){n.retryCount++,n.load(t,!0)}),n.parent.openSettings.retryAfterDelay):(n.retryCount>=n.parent.openSettings.retryCount&&(n.retryCount=0),n.fetchFailure(e))}))}}},r.prototype.fetchFailure=function(t){(0,e.isUndefined)(t.status)&&(0,e.isUndefined)(t.statusText)&&(t.statusText="Improper response"),this.parent.notify(Ce,t),this.parent.isOpen=!1},r.prototype.fetchSuccess=function(t,r,n,i,a){var o=["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword","InCorrectSheetPassword","CorrectSheetPassword","DataLimitExceeded","FileSizeLimitExceeded","ExternalWorkbook"],s="string"==typeof t?JSON.parse(t):t,l=s.Workbook;if((0,e.isNullOrUndefined)(l)){var d=s.chunkTotalCount;this.currentDocumentId=s.documentId,this.chunkList=new Array(d);var h=0,p=d>this.parent.openSettings.chunkSize?this.parent.openSettings.chunkSize:d,c=0;this.processedLoopIndex=0;var u=this;if(!(0,e.isNullOrUndefined)(d))for(;h<d;)u.processChunk(h,p,c,"",r,n,i,a),p=(h+=u.parent.openSettings.chunkSize)+u.parent.openSettings.chunkSize<d?u.parent.openSettings.chunkSize:d-h,c++,u.processedLoopIndex++}else{if(o.indexOf(l)>-1)return n&&(r.file=n),this.parent.notify(ye,{context:this,data:l,guid:s.Guid,eventArgs:r,isOpenFromJson:i}),void(l===o[0]&&(this.parent.isOpen=!1));this.updateModel(l,i,a),this.parent.notify(ye,{context:this,data:l,isOpenFromJson:i,eventArgs:r}),this.parent.isOpen=!1,r&&r.password&&r.password.length>0&&(this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.parent.password="")}},r.prototype.processChunk=function(t,r,n,i,a,o,s,l){var d=this,h={currentChunk:t.toString(),chunkSize:r.toString(),loopIndex:n.toString(),documentId:this.currentDocumentId},p=new FormData;p.append("chunkPayload",JSON.stringify(h));var c={file:o||null,cancel:!1,requestData:{method:"POST",body:p},password:a.password};fetch(this.parent.openUrl,c.requestData).then((function(e){return e.ok?e.json():Promise.reject({status:e.status,statusText:e.statusText,url:e.url})})).then((function(e){if(""!==e){for(var t=atob(e.chunk),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);if(t=new TextDecoder("utf-8").decode(r),d.chunkList[e.loopIndex]=t,d.loopIndex++,d.loopIndex===d.processedLoopIndex){for(var h=d.chunkList.splice(0,d.loopIndex),p=0;p<h.length;p++)i+=h.slice(p,p+1).join("");e=JSON.parse(i),d.setToDefaults(),d.fetchSuccess(e,a,o,s,l)}}})).catch((function(h){if((0,e.isNullOrUndefined)(d.currentFailedChunkIndex)||d.currentFailedChunkIndex===t){if(d.currentFailedChunkIndex=t,!(d.retryCount<d.parent.openSettings.retryCount))return d.retryCount=0,d.fetchFailure(h);setTimeout((function(){d.processedLoopIndex=n,d.processChunk(t,r,n,i,a,o,s,l),d.retryCount++}),d.parent.openSettings.retryAfterDelay)}}))},r.prototype.setToDefaults=function(e){this.currentFailedChunkIndex=null,e||(this.retryCount=0),this.loopIndex=0,this.processedLoopIndex=0,this.chunkList=[]},r.prototype.updateModel=function(t,r,n){this.parent.notify(pe,{action:"unRegisterSheet"}),this.setSelectAllRange(t.sheets,r),this.parent.sheetNameCount=1,this.parent.sheets=[],this.parent.notify(xe,{}),this.parent.notify(Ra,null),t.activeSheetIndex=t.activeSheetIndex||t.sheets.findIndex((function(e){return"Hidden"!==e.state})),this.parent.setProperties({isProtected:t.isProtected||!1,password:t.password||"",sheets:t.sheets,activeSheetIndex:t.activeSheetIndex,definedNames:t.definedNames||[],filterCollection:t.filterCollection||[],sortCollection:t.sortCollection||[],listSeparator:t.listSeparator||this.parent.listSeparator},!0),(0,e.isNullOrUndefined)(t.showSheetTabs)||(this.parent.showSheetTabs=t.showSheetTabs),Ln(this.parent,void 0,n),this.parent.notify(be,null),this.parent.notify(pe,{action:"registerSheet",isImport:!0}),this.parent.notify(pe,{action:"initiateDefinedNames"}),this.parent.notify(ut,null)},r.prototype.setSelectAllRange=function(r,n){var i,o,s=this;r.forEach((function(r){if(r.selectedRange){var l=t(r.selectedRange),d=((0,e.isUndefined)(r.rowCount)?100:r.rowCount)-1,h=((0,e.isUndefined)(r.colCount)?100:r.colCount)-1;65535===l[2]&&(l[2]=d),255===l[3]&&(l[3]=h),65535===l[0]&&(l[0]=d),255===l[1]&&(l[1]=h),r.selectedRange=a(l)}if(n&&s.parent.isAngular)for(var p=0;p<s.parent.sheets.length;p++)if(i=Fn(s.parent,p),r.name===i.name){r.ranges&&r.ranges.forEach((function(e,t){(o=i.ranges[t])&&o.template&&(e.template=o.template)}));break}}))},r.prototype.sheetsDestroyHandler=function(t){(0,e.isNullOrUndefined)(t.sheetIndex)&&(this.preventFormatCheck=null)},r.prototype.addEventListener=function(){this.parent.on(Y,this.open.bind(this)),this.parent.on(xe,this.sheetsDestroyHandler,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Y,this.open.bind(this)),this.parent.off(xe,this.sheetsDestroyHandler))},r.prototype.destroy=function(){this.removeEventListener(),this.parent.refreshing||(this.preventFormatCheck=null),this.parent=null},r.prototype.getModuleName=function(){return"workbookOpen"},r}(),ms=function(){function e(e){this.parent=e}return e.prototype.processSheet=function(e,t){return[t,JSON.parse(e,(function(e,t){if(!Array.isArray(t)&&"string"!=typeof t||t.length)return t}))]},e.prototype.processSave=function(e,t,r,n,i){var a,o=this,s=new FormData,l=Object.keys(t);for(s.append("JSONData",JSON.stringify(e)),a=0;a<l.length;a++)s.append(l[a],t[l[a]]);for(l=Object.keys(r),a=0;a<l.length;a++)s.append(l[a],r[l[a]]);s.append("pdfLayoutSettings",JSON.stringify(n)),fetch(t.url,{method:"POST",body:s}).then((function(e){return e.ok?e.blob():Promise.reject({message:e.statusText})})).then((function(e){new Promise((function(t){var n=new FileReader;n.onload=function(){var a=n.result.toString(),s=r.customParams&&"string"==typeof r.customParams&&"saveashtml"===r.customParams.toLowerCase();if(a.indexOf("data:text/plain;base64,")>-1||!s&&a.indexOf("data:text/html;base64,")>-1||a.indexOf("data:application/json;base64,")>-1){var l=void 0;if((a=(a=a.replace("data:text/plain;base64,","")).replace("data:text/html;base64,","")).indexOf("data:application/json;base64,")>-1?(a=a.replace("data:application/json;base64,",""),l=atob(a).split(".")):l=atob(a).split(/(\r\n|\n|\r)/gm),l.length){var d=l[0].length>1&&'"'===l[0][0]?l[0].split('"')[1]+".":l[0];i?i.apply(o,[{dialog:d}]):postMessage({dialog:d})}}else i?i.apply(o,[e]):postMessage(e);t(n.result)},n.readAsDataURL(e)}))})).catch((function(e){i?i.apply(o,[{error:e.message}]):postMessage({error:e.message})}))},e}(),vs=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ys=function(){return ys=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ys.apply(this,arguments)},Cs=function(t){function r(e){var r=t.call(this,e)||this;return r.isProcessCompleted=!1,r.saveJSON={},r.isFullPost=!1,r.needBlobData=!1,r.customParams=null,r.pdfLayoutSettings={fitSheetOnOnePage:!1},r.addEventListener(),r}return vs(r,t),r.prototype.getModuleName=function(){return"workbookSave"},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.addEventListener=function(){this.parent.on(X,this.initiateSave,this),this.parent.on("getStringifyObject",this.performStringifyAction,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(X,this.initiateSave),this.parent.off("getStringifyObject",this.performStringifyAction))},r.prototype.initiateSave=function(e){var t=e.saveSettings;this.saveSettings={saveType:t.saveType,url:t.url,fileName:t.fileName||"Sample"},this.isFullPost=e.isFullPost,this.needBlobData=e.needBlobData,this.needBlobData&&(this.isFullPost=!1),this.customParams=e.customParams,this.pdfLayoutSettings=e.pdfLayoutSettings,this.updateBasicSettings(),this.processSheets(t.autoDetectFormat,e.jsonConfig)},r.prototype.updateBasicSettings=function(){var e=this.getStringifyObject(this.parent,["sheets","_isScalar","observers","closed","isStopped","hasError","__isAsync","beforeCellFormat","beforeCellRender","beforeDataBound","beforeOpen","beforeSave","beforeSelect","beforeSort","cellEdit","cellEdited","cellEditing","cellSave","beforeCellSave","contextMenuItemSelect","contextMenuBeforeClose","contextMenuBeforeOpen","created","dataBound","fileMenuItemSelect","fileMenuBeforeClose","fileMenuBeforeOpen","saveComplete","sortComplete","select","actionBegin","actionComplete","afterHyperlinkClick","afterHyperlinkCreate","beforeHyperlinkClick","beforeHyperlinkCreate","openComplete","openFailure","queryCellInfo","dialogBeforeOpen","dataSourceChanged","beforeConditionalFormat","beforeCellUpdate"]),t=JSON.parse(e);this.parent.sheets.length&&(t.sheets=[]),this.saveJSON=t,this.saveJSON.filterCollection=[]},r.prototype.processSheets=function(e,t){var r,n,i,a,o=this,s=["dataSource","startCell","query","showFieldAsHeader","result","preservePos"];if(this.parent.isAngular&&s.push("template"),t)if(t.onlyValues)s.push.apply(s,["style","formula","format","conditionalFormats","validation","hyperlink","wrap","chart","image","notes"]);else{var l={style:t.ignoreStyle,formula:t.ignoreFormula,format:t.ignoreFormat,conditionalFormats:t.ignoreConditionalFormat,validation:t.ignoreValidation,wrap:t.ignoreWrap,chart:t.ignoreChart,image:t.ignoreImage,notes:t.ignoreNote};for(var d in t.ignoreFreezePane&&s.push.apply(s,["frozenColumns","frozenRows"]),l)l[d]&&s.push(d)}for(var h=0,p=this.parent.sheets.length;h<p;h++){r=!1,n=!1;for(var c=0,u=(i=this.parent.sheets[h]).ranges.length;c<u;c++)if((a=i.ranges[c]).dataSource&&(n=!0,!a.info||!a.info.loadedRange||!a.info.loadedRange.length)){r=!0;break}if(r){this.parent.notify(_,{sheet:i,sheetIndex:h,loadComplete:function(e){v(o,o.processSheet,o.updateSheet,[o.getStringifyObject(o.parent.sheets[e],s,e,!1,!0),e],null,o.parent)}.bind(this,h),loadFromStartCell:!0,autoDetectFormat:e})}else v(this,this.processSheet,this.updateSheet,[this.getStringifyObject(i,s,h,e&&n,!0),h],null,this.parent)}},r.prototype.updateSheet=function(e){this.saveJSON.sheets[e[0]]=e[1],this.isProcessCompleted=this.getSheetLength(this.saveJSON.sheets)===this.parent.sheets.length,this.isProcessCompleted&&this.save(this.saveSettings)},r.prototype.getSheetLength=function(e){var t=0;return e.forEach((function(e){e&&t++})),t},r.prototype.save=function(e){var t={cancel:!1,jsonObject:this.saveJSON};this.parent.notify(Ye,t),t.cancel||(this.isFullPost?(this.initiateFullPostSave(),this.saveJSON={}):v(this,{workerTask:this.processSave},this.updateSaveResult,[this.saveJSON,e,this.customParams,this.pdfLayoutSettings],!0,this.parent))},r.prototype.updateSaveResult=function(e){if(e.isFormDataError)this.processSave(this.saveJSON,this.saveSettings,this.customParams,this.pdfLayoutSettings,this.updateSaveResult);else{this.saveJSON={};var t={status:"Success",message:"",url:this.saveSettings.url,fileName:this.saveSettings.fileName,saveType:this.saveSettings.saveType,blobData:null};"object"==typeof e&&e.error?(t.status="Failure",t.message=e.error.toString()):"object"==typeof e&&e.dialog?this.parent.notify(jt,{content:e.dialog}):this.needBlobData?t.blobData=e:this.ClientFileDownload(e),this.parent.trigger("saveComplete",t),this.parent.notify(ee,t)}},r.prototype.ClientFileDownload=function(e){var t=this.parent.createElement("a",{attrs:{download:this.getFileNameWithExtension()}}),r=URL.createObjectURL(e);t.href=r,document.body.appendChild(t),t.click(),URL.revokeObjectURL(r),document.body.removeChild(t)},r.prototype.initiateFullPostSave=function(){var t,r=Object.keys(this.saveSettings),n=this.parent.createElement("form",{attrs:{method:"POST",action:this.saveSettings.url}}),i=this.parent.createElement("input",{attrs:{type:"hidden",name:"JSONData"}});for(i.value=JSON.stringify(this.saveJSON),n.appendChild(i),t=0;t<r.length;t++)(i=this.parent.createElement("input",{attrs:{type:"hidden",name:r[t]}})).value=this.saveSettings[r[t]],n.appendChild(i);for(r=Object.keys(this.customParams),t=0;t<r.length;t++)(i=this.parent.createElement("input",{attrs:{type:"hidden",name:r[t]}})).value=this.customParams[r[t]],n.appendChild(i);(i=this.parent.createElement("input",{attrs:{type:"hidden",name:"pdfLayoutSettings"}})).value=JSON.stringify(this.pdfLayoutSettings),n.appendChild(i),document.body.appendChild(n),n.submit(),(0,e.detach)(n),this.parent.notify(ee,{})},r.prototype.performStringifyAction=function(e){e.model='{"jsonObject":{"Workbook":{"sheets":[';for(var t=0,r=this.parent.sheets.length-1;t<=r;t++)e.model+=this.getStringifyObject(this.parent.sheets[t],e.skipProps,t)+(t<r?",":"]}}}")},r.prototype.getStringifyObject=function(e,t,r,n,i){var a=this;void 0===t&&(t=[]),0===r&&this.parent.notify(Ie,{clearAll:!0}),i&&this.parent.notify(Q,{sheetIdx:r,isSaveAction:!0,saveJson:this.saveJSON});var o,s=[],l=n&&$r(this.parent),d=JSON.stringify(e,(function(i,d){if(!(t.indexOf(i)>-1)){if("cellStyle"===i)return a.parent.commonCellStyle;if(d&&d.cells)for(var h=0,p=d.cells.length;h<p;h++){var c=d.cells[h],u=[Number(i),h];if(c&&(c.value?n&&!c.formula&&l(c):c.formula&&c.formula.indexOf("=UNIQUE(")<0&&("Automatic"===a.parent.calculationMode&&a.parent.notify(pe,{action:"refreshCalculate",value:c.formula,rowIndex:u[0],colIndex:h,isFormula:wr(c.formula),sheetIndex:r,isRefreshing:!0}),c.value=zn(u[0],h,e).value),c.chart)){s.push({index:u,chart:c.chart}),o=[];for(var f=0,g=c.chart.length;f<g;f++){var m=Object.assign({},c.chart[f]);delete m.id,o.push(m)}c.chart=o}}if("validation"===i&&d&&"string"==typeof d.type&&"Time"===d.type&&["value1","value2"].forEach((function(e){var t=d[e]&&d[e].toString();t&&!dn(Number(t))&&(d[e]=a.getDateAsNumber({range:[],cell:{value:t}},t))})),d&&d.properties&&d.maxHgts&&(d.properties=ys({},d.properties,{maxHgts:d.maxHgts})),d&&"object"==typeof d&&d.hasOwnProperty("properties")){if(d.propName&&"conditionalFormats"===d.propName.toString()){var v=d.properties;if(v.format&&v.format.style){var y=v.format.style;y&&"#ffffff"===y.backgroundColor&&"#000000"===y.color&&"bold"!==y.fontWeight&&"italic"!==y.fontStyle&&"underline"!==y.textDecoration&&delete v.format}}return d.properties}return null!==d?d:void 0}})),h=Fn(this.parent,r);return s.forEach((function(e){jn(e.index[0],e.index[1],h,{chart:e.chart},!0)})),d},r.prototype.getDateAsNumber=function(e,t){var r={value:t,rowIndex:e.range[0],cell:e.cell,colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""};return this.parent.notify(ue,r),r.updatedVal||t},r.prototype.getFileNameWithExtension=function(e){e||(e=this.saveSettings.fileName);var t=this.getFileExtension(),r=e.lastIndexOf(".");return r>-1&&(e=e.substr(0,r)),e+t},r.prototype.getFileExtension=function(){return"."+this.saveSettings.saveType.toLowerCase()},r}(ms);!function(e){e[e.NA=0]="NA",e[e.Value=1]="Value",e[e.Ref=2]="Ref",e[e.DivZero=3]="DivZero",e[e.Num=4]="Num",e[e.Name=5]="Name",e[e.Null=6]="Null",e[e.Calc=7]="Calc"}(Xn||(Xn={})),function(e){e[e.OperatorsCannotStartWithExpression=0]="OperatorsCannotStartWithExpression",e[e.ReservedWordAND=1]="ReservedWordAND",e[e.ReservedWordXOR=2]="ReservedWordXOR",e[e.ReservedWordIf=3]="ReservedWordIf",e[e.NumberContains2DecimalPoints=4]="NumberContains2DecimalPoints",e[e.ReservedWordElse=5]="ReservedWordElse",e[e.ReservedWordNOT=6]="ReservedWordNOT",e[e.InvalidCharInNumber=7]="InvalidCharInNumber",e[e.InvalidCharactersFollowingWithOperator=6]="InvalidCharactersFollowingWithOperator",e[e.MismatchedParentheses=8]="MismatchedParentheses",e[e.UnknownFormulaName=9]="UnknownFormulaName",e[e.RequiresASingleArgument=10]="RequiresASingleArgument",e[e.Requires3Args=11]="Requires3Args",e[e.InvalidMathArgument=12]="InvalidMathArgument",e[e.Requires2Args=13]="Requires2Args",e[e.BadIndex=14]="BadIndex",e[e.TooComplex=15]="TooComplex",e[e.CircularReference=16]="CircularReference",e[e.MissingFormula=17]="MissingFormula",e[e.ImproperFormula=18]="ImproperFormula",e[e.InvalidExpression=19]="InvalidExpression",e[e.CellEmpty=20]="CellEmpty",e[e.BadFormula=21]="BadFormula",e[e.EmptyExpression=22]="EmptyExpression",e[e.VirtualModeRequired=23]="VirtualModeRequired",e[e.MismatchedTics=24]="MismatchedTics",e[e.WrongNumberArguments=25]="WrongNumberArguments",e[e.InvalidArguments=26]="InvalidArguments",e[e.IterationsDoNotConverge=27]="IterationsDoNotConverge",e[e.CalculationOverflow=29]="CalculationOverflow",e[e.AlreadyRegistered=28]="AlreadyRegistered",e[e.MissingSheet=30]="MissingSheet",e[e.CannotParse=31]="CannotParse",e[e.ExpressionCannotEndWithAnOperator=32]="ExpressionCannotEndWithAnOperator",e[e.Spill=33]="Spill",e[e.Div=34]="Div"}(Kn||(Kn={})),function(e){e.xlsx="xlsx",e.xlsm="xlsm",e.xlsb="xlsb",e.xltx="xltx",e.xltm="xltm",e.xls="xls",e.xml="xml",e.xlam="xlam",e.xla="xla",e.xlw="xlw",e.xlr="xlr",e.prn="prn",e.txt="txt",e.csv="csv",e.dif="dif",e.slk="slk"}($n||($n={}));var bs=function(){function e(e){this.parent=e}return e.prototype.getModuleName=function(){return"calc-common"},e}();function xs(e){return void 0===e}function Ss(e){switch(e){case"dd-MMM-yyyy":case"dd MMM yyyy":e="medium";break;case"MMM yyyy":e="yMMM";break;case"MM/dd/yyyy":case"dd/MM/yyyy":case"dd/MM/yy":e="short";break;case"dddd MMMM dd yyyy":case"dd MMMM yyyy":e="long";break;case"d MMMM yyyy":e="yMMMd";break;case"yyyy":e="y";break;case"h:mm":e="Hm";break;case"h:mm tt":e="hm";break;case"h":e="H";break;case"h tt":e="h";break;case"dddd":case"ddd":e="E";break;case"h:mm:ss tt":e="hms";break;case"h:mm:ss":e="Hms";break;case"d":e="d";break;case"d dddd":e="Ed";break;case"M":e="M";break;case"Md":e="Md";break;case"MMM":e="MMM";break;case"ddd MMM d":e="MMMEd";break;case"MMM d":e="MMMd";break;case"M/yyyy":e="yM";break;default:e=""}return e}function ws(e){var t=!1;for(var r in $n)if(e.indexOf("."+r+"]")>-1){t=!0;break}return t}var Is=function(){function t(e){this.formulas=[{formulaName:"SUM",category:"Math & Trig",description:"Sums individual values, cell references or ranges."},{formulaName:"SUMIFS",category:"Math & Trig",description:"Sums the cells specified by a given set of conditionsor criteria."},{formulaName:"SUMPRODUCT",category:"Math & Trig",description:"Returns sum of the product of given ranges of arrays."},{formulaName:"ABS",category:"Math & Trig",description:"Returns the absolute value of a number."},{formulaName:"RAND",category:"Math & Trig",description:"Return a random number between 0 and 1."},{formulaName:"FLOOR",category:"Math & Trig",description:"Returns the round a number down to the nearest integer."},{formulaName:"CEILING",category:"Math & Trig",description:"Returns a number rounded up to a multiple of another number."},{formulaName:"SUMIF",category:"Math & Trig",description:"It will sum up cells that meet the given criteria."},{formulaName:"PRODUCT",category:"Math & Trig",description:"Multiplies all the numbers given as arguments and returns the product."},{formulaName:"AVERAGE",category:"Statistical",description:"The sum of the numbers divided by how many numbers are being averaged."},{formulaName:"AVERAGEIF",category:"Statistical",description:"Computes the average of the numbers in a range that meet the supplied criteria."},{formulaName:"COUNT",category:"Statistical",description:"Counts the numbers in the list of arguments, exclude text entries."},{formulaName:"COUNTA",category:"Statistical",description:"Counts the non-empty values in the list of arguments."},{formulaName:"COUNTIF",category:"Statistical",description:"Counts the number of cells in a range that meet a specified condition."},{formulaName:"COUNTIFS",category:"Statistical",description:"Counts the number of times each cells in all the ranges that meet the specific conditions."},{formulaName:"AVERAGEA",category:"Statistical",description:"Calculates the average of values in the list of arguments.Arguments can be numbers, names, arrays or references."},{formulaName:"AVERAGEIFS",category:"Statistical",description:"Conditionally returns the average of the contents of cells for the set of ranges."},{formulaName:"MIN",category:"Statistical",description:"Returns the smaller number in set of arguments."},{formulaName:"MAX",category:"Statistical",description:"Returns the largest number in set of arguments."},{formulaName:"DATE",category:"Date",description:"Returns the date, given the year, month and day of the month."},{formulaName:"DAY",category:"Date",description:"Returns the day of a given date."},{formulaName:"TODAY",category:"Date",description:"Returns the current date as date value."},{formulaName:"DAYS",category:"Date",description:"Returns the number of days between two dates."},{formulaName:"WEEKDAY",category:"Date",description:"Returns the day of the week corresponding to a date."},{formulaName:"IF",category:"Logical",description:"Returns one value if a logical expression is TRUE and another if it is FALSE"},{formulaName:"AND",category:"Logical",description:"Returns TRUE if all the arguments are considered TRUE, and FALSE otherwise."},{formulaName:"IFS",category:"Logical",description:"Checks multiple conditions and returns a value corresponding to the first TRUE result."},{formulaName:"IFERROR",category:"Logical",description:"Returns a value you specify if a formula evaluates to an error; otherwise, it returns the result of the formula."},{formulaName:"CHOOSE",category:"Lookup & Reference",description:"Returns a value from a list, given an index number."},{formulaName:"INDEX",category:"Lookup & Reference",description:"Returns a value from a table, given a row and column number."},{formulaName:"FIND",category:"Text",description:"Returns the position of a string of text within another string."},{formulaName:"CONCATENATE",category:"Text",description:" Used to join two or more strings together."},{formulaName:"CONCAT",category:"Text",description:"Concatenates a list or range of text strings."},{formulaName:"SUBTOTAL",category:"Lookup & Reference",description:"Returns a subtotal in a list or database."},{formulaName:"RADIANS",category:"Math & Trig",description:"Converts degrees to radians."},{formulaName:"OR",category:"Logical",description:"Returns TRUE if any arguments considered TRUE, and all the arguments are FALSE it will return FALSE."},{formulaName:"NOT",category:"Logical",description:"Returns the inverse of a given logical expression."},{formulaName:"MATCH",category:"Lookup & Reference",description:"Returns the relative position of an checked item in range that matches a specified value in a specified order"},{formulaName:"RANDBETWEEN",category:"Math & Trig",description:"Returns an integer random number in a specified range."},{formulaName:"SLOPE",category:"Statistical",description:"Returns the slope of the line from linear regression of the data points."},{formulaName:"INTERCEPT",category:"Statistical",description:"Calculates the point of the Y-intercept line via linear regression."},{formulaName:"RSQ",category:"Statistical",description:"Returns the square of the Pearson product moment correlation coefficient based on data points in known_ys and known_xs"},{formulaName:"UNIQUE",category:"Lookup & Reference",description:"Returns a unique values from a range or array."},{formulaName:"ROUNDUP",category:"Math & Trig",description:"Rounds a number away from zero."},{formulaName:"ROUNDDOWN",category:"Math & Trig",description:"Rounds a number down, toward zero."},{formulaName:"INT",category:"Math & Trig",description:"Returns a number to the nearest integer."},{formulaName:"LN",category:"Math & Trig",description:"Returns the natural logarithm of a number."},{formulaName:"ISNUMBER",category:"Information",description:"Returns TRUE, if the argument is number and FALSE otherwise."},{formulaName:"ROUND",category:"Math & Trig",description:"Rounds a number to a specified number of digits."},{formulaName:"LOG",category:"Math & Trig",description:"Returns the logarithm of a number to the base that you specify."},{formulaName:"POWER",category:"Math & Trig",description:"Returns the result of a number raised to power."},{formulaName:"SQRT",category:"Math & Trig",description:"Returns the square root of a positive number."},{formulaName:"TRUNC",category:"Math & Trig",description:"Returns the truncated value of a number to a specified number of decimal places."},{formulaName:"EXP",category:"Math & Trig",description:"Returns e raised to the power of the given number."},{formulaName:"GEOMEAN",category:"Statistical",description:"Returns the geometric mean of an array or range of positive data."},{formulaName:"TEXT",category:"Lookup & Reference",description:"Converts a value to text in specified number format."},{formulaName:"SORT",category:"Lookup & Reference",description:"Sorts a range of an array."},{formulaName:"LOOKUP",category:"Lookup & Reference",description:"Looks for a value in a one-row or one-column range, then returns a value from the same position in a second one-row or one-column range."},{formulaName:"VLOOKUP",category:"Lookup & Reference",description:"Looks for a specific value in the first column of a lookup range and returns a corresponding value from a different column within the same row."},{formulaName:"HLOOKUP",category:"Lookup & Reference",description:"Looks for a value in the top row of the array of values and then returns a value in the same column from a row in the array that you specify."},{formulaName:"T",category:"Text",description:"Checks whether a value is text or not and returns the text."},{formulaName:"EXACT",category:"Text",description:"Checks whether a two text strings are exactly same and returns TRUE or FALSE."},{formulaName:"LEN",category:"Text",description:"Returns a number of characters in a given string."},{formulaName:"MOD",category:"Math & Trig",description:"Returns a remainder after a number is divided by divisor."},{formulaName:"ODD",category:"Math & Trig",description:"Rounds a positive number up and negative number down to the nearest odd integer."},{formulaName:"PI",category:"Math & Trig",description:"Returns the value of pi."},{formulaName:"COUNTBLANK",category:"Statistical",description:"Returns the number of empty cells in a specified range of cells."},{formulaName:"EVEN",category:"Math & Trig",description:"Rounds a positive number up and negative number down to the nearest even integer."},{formulaName:"FACT",category:"Math & Trig",description:"Returns the factorial of a number."},{formulaName:"DECIMAL",category:"Math & Trig",description:"Converts a text representation of a number in a given base into a decimal number."},{formulaName:"DEGREES",category:"Math & Trig",description:"Converts radians to degrees."},{formulaName:"ADDRESS",category:"Lookup & Reference",description:"Returns a cell reference as text, given specified row and column numbers."},{formulaName:"TIME",category:"Date & Time",description:"Converts hours, minutes, seconds to the time formatted text."},{formulaName:"CHAR",category:"Text",description:"Returns the character from the specified number."},{formulaName:"CODE",category:"Text",description:"Returns the numeric code for the first character in a given string."},{formulaName:"DOLLAR",category:"Text",description:"Converts the number to currency formatted text."},{formulaName:"SMALL",category:"Statistical",description:"Returns the k-th smallest value in a given array."},{formulaName:"LARGE",category:"Statistical",description:"Returns the k-th largest value in a given array."},{formulaName:"MEDIAN",category:"Statistical",description:"Returns the median of the given set of numbers."},{formulaName:"EDATE",category:"Date & Time",description:"Returns a date with given number of months before or after the specified date."},{formulaName:"EOMONTH",category:"Date & Time",description:"Returns the last day of the month that is a specified number of months before or after an initially supplied start date."},{formulaName:"DATEVALUE",category:"Date & Time",description:"Converts a date string into date value."},{formulaName:"HOUR",category:"Date & Time",description:"Returns the number of hours in a specified time string."},{formulaName:"MINUTE",category:"Date & Time",description:"Returns the number of minutes in a specified time string."},{formulaName:"SECOND",category:"Date & Time",description:"Returns the number of seconds in a specified time string."},{formulaName:"NOW",category:"Date & Time",description:"Returns the current date and time."},{formulaName:"MONTH",category:"Date & Time",description:"Returns the number of months in a specified date string."},{formulaName:"PROPER",category:"Text",description:"Converts a text to proper case; first letter to uppercase and other letters to lowercase."}],this.isConcat=!1,this.parent=e,this.init()}return t.prototype.init=function(){for(var t,r=0;r<this.formulas.length;r++)t=(0,e.getValue)("Compute"+this.formulas[r].formulaName,this).bind(this),this.addFormulaCollection(this.formulas[r].formulaName.toUpperCase(),t,this.formulas[r].category,this.formulas[r].description)},t.prototype.addFormulaCollection=function(e,t,r,n){this.parent.libraryFormulas={fName:e,handler:t,category:r,description:n}},t.prototype.ComputeSUM=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i,a,o=!1;if(t.length){var s=t[t.length-1];"isSubtotal"===s?(o=!0,t.pop()):"isAggregate"===s&&(a=this.parent.parentObject.getActiveSheet(),i=!0,t.pop())}if((0,e.isNullOrUndefined)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];var l,d,h,p=0,c=0;if(!(0,e.isNullOrUndefined)(t))for(var u=t,f=function(e){e.toString().indexOf(".")>-1&&(c=Math.max(c,e.split(".")[1].length))},g=0;g<u.length;g++){var m=u[g].toString();if(m.indexOf(":")>-1&&this.parent.isCellReference(m)){for(var v=this.parent.getCellCollection(m.split(this.parent.tic).join("")),y=0;y<v.length;y++)if(!(i&&(ml(a,(h=r(v[y]))[0])||Al(a,h[1]))||(l=o?this.parent.getValueFromArg(v[y],null,null,!0):this.parent.getValueFromArg(v[y]),o&&l.includes("SUBTOTAL(")))){if(this.parent.getErrorStrings().indexOf(l)>-1)return l;(0,e.isNullOrUndefined)(l[0])||isNaN(this.parent.parseFloat(l))||(f(l),p+=this.parent.parseFloat(l))}}else{if(u[g].indexOf(this.parent.tic)>-1&&(isNaN(this.parent.parseFloat(u[g].split(this.parent.tic).join("")))||""===u[g].split(this.parent.tic).join("").trim()))return this.parent.getErrorStrings()[Xn.Value];if(u[g].split(this.parent.tic).join("")===this.parent.trueValue&&(u[g]="1"),u[g].split(this.parent.tic).join("")===this.parent.falseValue&&(u[g]="0"),d=o?this.parent.getValueFromArg(u[g].split(this.parent.tic).join(""),null,null,!0):this.parent.getValueFromArg(u[g].split(this.parent.tic).join("")),o&&d.includes("SUBTOTAL("))continue;if(this.parent.getErrorStrings().indexOf(d)>-1)return d;if((0,e.isNullOrUndefined)(d)||isNaN(this.parent.parseFloat(d)))continue;d.length>0&&(f(d),p+=this.parent.parseFloat(d+""))}}return p.toString().indexOf(".")>-1?p.toFixed(c):p},t.prototype.ComputeINT=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=this.parent.getErrorStrings();return""===t[0]&&1===t.length?this.parent.formulaErrorStrings[Kn.InvalidArguments]:t.length>1?this.parent.formulaErrorStrings[Kn.WrongNumberArguments]:(e=this.parent.getValueFromArg(t[0]),n.indexOf(e)>-1?e:(e.toUpperCase()===this.parent.trueValue?e="1":e.toUpperCase()===this.parent.falseValue&&(e="0"),this.parent.isCellReference(t[0])||(-1===t[0].indexOf(this.parent.tic+this.parent.tic)&&(e=e.split(this.parent.tic).join("")),""!==e.trim())?(e.indexOf("%")>-1&&(e=(.01*Number(e.split("%")[0])).toString()),isNaN(this.parent.parseFloat(e))?n[Xn.Value]:(e=this.parent.parseFloat(e),e=Math.floor(e))):n[Xn.Value]))},t.prototype.ComputeTODAY=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(1!==t.length||""!==t[0])e=this.parent.formulaErrorStrings[Kn.InvalidArguments];else{var n=new Date(Date.now());"spreadsheet"===this.parent.parentObject.getModuleName()?(e=this.parent.parentObject.dateToInt(n),0===this.parent.parser.storedStringText.toUpperCase().indexOf("TODAY")&&""!==this.parent.cell&&this.parent.parentObject.setDateFormat(this.parent.getSheetId(this.parent.grid),this.parent.rowIndex(this.parent.cell)-1,this.parent.colIndex(this.parent.cell)-1)):e=n.getFullYear()+"/"+this.parent.calculateDate((n.getMonth()+1).toString())+"/"+this.parent.calculateDate(n.getDate().toString())}return e},t.prototype.ComputeWEEKDAY=function(){for(var t,r,n,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];if(""===i[0]&&(0,e.isNullOrUndefined)(i[1])||i.length>2)return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(""===i[0]&&""===i[1]||""===i[1])return this.parent.getErrorStrings()[Xn.Num].toString();if(1===i.length&&i.push("1"),i[0].indexOf(this.parent.tic)>-1&&""===i[0].split(this.parent.tic).join("").trim()||""===i[1].split(this.parent.tic).join("").trim()||i[1].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(i[1].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[Xn.Value];if(this.parent.isCellReference(i[0])){if((t=this.parent.getValueFromArg(i[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Xn.Value]}else t=i[0].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(i[0].split(this.parent.tic).join("")))?this.parent.getValueFromArg(i[0]):this.parent.getValueFromArg(i[0].split(this.parent.tic).join(""))||"0";if(r=this.parent.isCellReference(i[1])?this.parent.getValueFromArg(i[1].split(this.parent.tic).join(""))||"0":this.parent.getValueFromArg(i[1].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(t)>-1)return t;if(this.parent.getErrorStrings().indexOf(r)>-1)return r;if(t=t===this.parent.trueValue?"1":t===this.parent.falseValue?"0":t,r=r===this.parent.trueValue?"1":r===this.parent.falseValue?"0":r,n=this.parent.parseFloat(t),r=this.parent.parseFloat(r),isNaN(r)||isNaN(n))return this.parent.getErrorStrings()[Xn.Value];if(n<0||n>2958465)return this.parent.getErrorStrings()[Xn.Num].toString();switch(r=parseInt(r.toString(),10),n=n<1?0:Math.floor(n)%7,r){case 1:case 17:n=n<=0?n+7:n;break;case 2:case 11:n=(n-=1)<=0?n+7:n;break;case 3:n=(n-=2)<0?n+7:n;break;case 12:n=(n+=5)>7?n-7:n;break;case 13:n=(n+=4)>7?n-7:n;break;case 14:n=(n+=3)>7?n-7:n;break;case 15:n=(n+=2)>7?n-7:n;break;case 16:n=(n+=1)>7?n-7:n;break;default:n=this.parent.getErrorStrings()[Xn.Num].toString()}return n},t.prototype.ComputePROPER=function(){for(var t,r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=this.parent.getErrorStrings();return n.length&&"nestedFormulaTrue"===n[n.length-1]&&(r=!0,n.pop()),(0,e.isNullOrUndefined)(n)||""===n[0].trim()&&1===n.length?this.parent.formulaErrorStrings[Kn.InvalidArguments]:n.length>1?this.parent.formulaErrorStrings[Kn.WrongNumberArguments]:(t=this.parent.getValueFromArg(n[0]).trim(),a.indexOf(t)>-1||(n[0].indexOf(this.parent.tic)>-1?n[0]!==t&&n[0].startsWith("n")?t=this.parent.removeTics(t.trim()):(t=this.parent.removeTics(n[0].trim())).indexOf(this.parent.tic+this.parent.tic)>-1&&(t=t.replace(/""/g,this.parent.tic)):!n[0].startsWith("n")&&2===t.split("%").length&&this.parent.isNumber(t.split("%")[0])&&(t=(Number(t.split("%")[0])/100).toString()),t=t.toLowerCase().replace(/\b\w/g,(function(e){return e.toUpperCase()})).replace(/(\d)([a-z])/g,(function(e,t,r){return t+r.toUpperCase()})),r&&(t=this.parent.tic+t+this.parent.tic)),t)},t.prototype.ComputeSUMPRODUCT=function(){for(var t,r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if((0,e.isNullOrUndefined)(n)||1===n.length&&""===n[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];for(var a,o=0,s=0,l=null,d=n,h=[],p=0;p<d.length;p++){var c=this.parent.getCellCollection(d[p]);if("#REF!"===c[0])return this.parent.getErrorStrings()[Xn.Name];h.push(c.length)}for(var u=0;u<h.length;u++)if(h[u]&&h[u+1]&&h[u]!==h[u+1])return this.parent.getErrorStrings()[Xn.Value];for(var f=0;f<d.length;++f){var g=d[f];if(g.startsWith(this.parent.tic)||!this.parent.isCellReference(g)){var m=this.parent.getValueFromArg(g);return a=m.indexOf('"'),this.parent.getErrorStrings().indexOf(m)>-1?m:a>-1?0:this.parent.getErrorStrings()[Xn.Value]}p=g.indexOf(":");var v=this.parent.rowIndex(g.substr(0,p)),y=this.parent.rowIndex(g.substr(p+1));if(!(-1!==v||-1===y)==(-1===v||-1!==y))return this.parent.getErrorStrings()[Xn.Name];v>y&&(v=(t=[y,v])[0],y=t[1]);var C=this.parent.colIndex(g.substr(0,p)),b=this.parent.colIndex(g.substr(p+1));if(C>b&&(C=(r=[b,C])[0],b=r[1]),null===l)for(s=(y-v+1)*(b-C+1),l=[],p=0;p<s;++p)l[p]=1;p=0;for(var x=v;x<=y;++x)for(var S=C;S<=b;++S){var w=this.getSheetReference(g)+this.parent.convertAlpha(S)+x,I=this.parent.getValueFromArg(w);if(this.parent.getErrorStrings().indexOf(I)>-1)return I;if(isNaN(this.parent.parseFloat(I)))l[p]=0;else{if(isNaN(l[p]))return this.parent.getErrorStrings()[Xn.Name];l[p]=l[p]*this.parent.parseFloat(I)}p++}}for(p=0;p<s;++p)o+=l[p];return o},t.prototype.ComputeROUNDUP=function(){for(var t,r,n,i,a,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var l=o.length;if(!(0,e.isNullOrUndefined)(o)&&l>2&&(t=this.parent.formulaErrorStrings[Kn.InvalidArguments]),1===l&&""!==o[0])i=o[0].indexOf('"'),r="TRUE"===(r=(r=o[0].indexOf('"')>-1?o[0].replace('"',""):o[0]).indexOf('"')>-1?r.replace('"',""):r).toUpperCase()?"1":"FALSE"===r?"0":r,r=this.parent.getValueFromArg(r),(a=this.parent.parseFloat(r))>0?a+=.4999999999:a<0&&(a-=.4999999999),t=(a=this.parent.parseFloat(a.toFixed(0))).toString();else if(2===l){if(i=o[0].indexOf('"')>-1?o[0].indexOf('"'):o[1].indexOf('"')>-1?o[1].indexOf('"'):-1,this.parent.isCellReference(o[0]))r=this.parent.getValueFromArg(o[0])||"0";else{if(o[0].indexOf(this.parent.tic)>-1&&(o[0].split(this.parent.tic).join("")===this.parent.trueValue||o[0].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[Xn.Value];r=this.parent.getValueFromArg(o[0]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(r)>-1)return r;if(this.parent.isCellReference(o[1]))n=this.parent.getValueFromArg(o[1])||"0";else{if(o[1].indexOf(this.parent.tic)>-1&&(o[1].split(this.parent.tic).join("")===this.parent.trueValue||o[1].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[Xn.Value];n=this.parent.getValueFromArg(o[1]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(n)>-1)return n;r="TRUE"===r.toUpperCase()?"1":"FALSE"===r?"0":r,n="TRUE"===n.toUpperCase()?"1":"FALSE"===n?"0":n;var d=isNaN(Number(r))||""===r.trim(),h=isNaN(Number(n))||""===n.trim();if((o[0].indexOf('"')>-1||this.parent.isCellReference(o[0]))&&d||(o[1].indexOf('"')>-1||this.parent.isCellReference(o[1]))&&h)return this.parent.getErrorStrings()[Xn.Value];var p=Math.ceil(this.parent.parseFloat(n));if(a=this.parent.parseFloat(r),p>0){var c=r.split("."),u=2===c.length?c[1].length>=p?p:c[1].length:0;t=(a=this.parent.parseFloat(this.preciseRound(a,u,"ROUNDUP"))).toString(),isNaN(a)&&(t=p.toString().indexOf('"')>-1?this.parent.getErrorStrings()[Xn.Value]:this.parent.getErrorStrings()[Xn.Name])}else a>0?a=a/Math.pow(10,-p)+.49999:a<0&&(a=a/Math.pow(10,-p)-.49999),t=(a=a>0&&p<-9?1*Math.pow(10,-p):this.parent.parseFloat(a.toFixed(0))*Math.pow(10,-p)).toString(),isNaN(a)&&(t=p.toString().indexOf('"')>-1?this.parent.getErrorStrings()[Xn.Value]:t=this.parent.getErrorStrings()[Xn.Name])}else t=i>-1?this.parent.getErrorStrings()[Xn.Value]:this.parent.formulaErrorStrings[Kn.InvalidArguments];return t},t.prototype.ComputeROUNDDOWN=function(){for(var t,r,n,i,a,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var l=o.length;if(!(0,e.isNullOrUndefined)(o)&&l>2&&(t=this.parent.formulaErrorStrings[Kn.InvalidArguments]),1===l&&""!==o[0])i=o[0].indexOf('"'),r="TRUE"===(r=(r=o[0].indexOf('"')>-1?o[0].replace('"',""):o[0]).indexOf('"')>-1?r.replace('"',""):r).toUpperCase()?"1":"FALSE"===r?"0":r,r=this.parent.getValueFromArg(r),(a=this.parent.parseFloat(r))>0?a-=.4999999999:a<0&&(a+=.4999999999),t=(a=this.parent.parseFloat(a.toFixed(0))).toString();else if(2===l){if(i=o[0].indexOf('"')>-1?o[0].indexOf('"'):o[1].indexOf('"')>-1?o[1].indexOf('"'):-1,this.parent.isCellReference(o[0]))r=this.parent.getValueFromArg(o[0])||"0";else{if(o[0].indexOf(this.parent.tic)>-1&&(o[0].split(this.parent.tic).join("")===this.parent.trueValue||o[0].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[Xn.Value];r=this.parent.getValueFromArg(o[0]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(r)>-1)return r;if(this.parent.isCellReference(o[1]))n=this.parent.getValueFromArg(o[1])||"0";else{if(o[1].indexOf(this.parent.tic)>-1&&(o[1].split(this.parent.tic).join("")===this.parent.trueValue||o[1].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[Xn.Value];n=this.parent.getValueFromArg(o[1]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(n)>-1)return n;r="TRUE"===r.toUpperCase()?"1":"FALSE"===r?"0":r,n="TRUE"===n.toUpperCase()?"1":"FALSE"===n?"0":n;var d=isNaN(Number(r))||""===r.trim(),h=isNaN(Number(n))||""===n.trim();if((o[0].indexOf('"')>-1||this.parent.isCellReference(o[0]))&&d||(o[1].indexOf('"')>-1||this.parent.isCellReference(o[1]))&&h)return this.parent.getErrorStrings()[Xn.Value];var p=Math.ceil(this.parent.parseFloat(n));if(a=this.parent.parseFloat(r),p>0){var c=r.indexOf("."),u=0;-1!==c&&(u=(u=r.length-c-1)>=p?p:u),t=(a=this.parent.parseFloat(this.preciseRound(a,u,"ROUNDDOWN"))).toString(),isNaN(a)&&(t=p.toString().indexOf('"')>-1?this.parent.getErrorStrings()[Xn.Value]:this.parent.getErrorStrings()[Xn.Name])}else a>0?a=a/Math.pow(10,-p)-.49999:a<0&&(a=a/Math.pow(10,-p)+.49999),t=(a=a>0&&p<-9?1*Math.pow(10,-p):this.parent.parseFloat(a.toFixed(0))*Math.pow(10,-p)).toString(),isNaN(a)&&(t=p.toString().indexOf('"')>-1?this.parent.getErrorStrings()[Xn.Value]:t=this.parent.getErrorStrings()[Xn.Name])}else t=i>-1?this.parent.getErrorStrings()[Xn.Value]:this.parent.formulaErrorStrings[Kn.InvalidArguments];return t},t.prototype.ComputeCOUNT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=!1;if(t.length&&"isSubtotal"===t[t.length-1]&&(n=!0,t.pop()),(0,e.isNullOrUndefined)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];for(var i,a,o,s,l=t,d=0,h=0;h<l.length;h++)if(i=l[h],this.parent.isCellReference(i))if(i.indexOf(":")>-1){a=this.parent.getCellCollection(i.split(this.parent.tic).join(""));for(var p=0;p<a.length;p++)o=n?this.parent.getValueFromArg(a[p],null,null,!0):this.parent.getValueFromArg(a[p]),n&&o.includes("SUBTOTAL(")||isNaN(this.parent.parseFloat(o))||i.length>0&&""!==o.trim()&&d++}else{if(o=n?this.parent.getValueFromArg(i,null,null,!0):this.parent.getValueFromArg(i),n&&o.includes("SUBTOTAL("))continue;isNaN(this.parent.parseFloat(o))||i.length>0&&""!==o.trim()&&d++}else s=this.parent.getValueFromArg(i).split(this.parent.tic).join(""),0===i.length&&""===s.trim()?d++:isNaN(this.parent.parseFloat(s))&&i!==this.parent.trueValue&&i!==this.parent.falseValue||i.length>0&&""!==i.trim()&&""!==s.trim()&&d++;return d},t.prototype.ComputeDATE=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(r.length&&"nestedFormulaTrue"===r[r.length-1]&&(t=!0,r.pop()),(0,e.isNullOrUndefined)(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(3!==r.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];for(var i=[],a=0;a<r.length;++a)i[a]=this.parent.getValueFromArg(r[a]);i[0]=i[0]===this.parent.trueValue?"1":i[0]===this.parent.falseValue?"0":i[0],i[1]=i[1]===this.parent.trueValue?"1":i[1]===this.parent.falseValue?"0":i[1],i[2]=i[2]===this.parent.trueValue?"1":i[2]===this.parent.falseValue?"0":i[2];for(var o=0;o<i.length;o++){var s=i[o];if(this.parent.getErrorStrings().indexOf(s)>-1)return s;if('""'===s||'"0"'===s&&'"0"'!==r[o]||'"TRUE"'===s||'"FALSE"'===s)return this.parent.getErrorStrings()[Xn.Value].toString()}var l=Math.floor(this.parent.parseFloat(i[0].split(this.parent.tic).join(""))),d=Math.floor(this.parent.parseFloat(i[1].split(this.parent.tic).join(""))),h=Math.floor(this.parent.parseFloat(i[2].split(this.parent.tic).join(""))),p=0;if(isNaN(l)||isNaN(d)||isNaN(h))return this.parent.getErrorStrings()[Xn.Value].toString();if(l<0&&d<=12||l>=1e4&&d>0)return this.parent.getErrorStrings()[Xn.Num].toString();for(;d>12;)d-=12,l++;if(0===(p=this.parent.getSerialDateFromDate(l,d,h)))return this.parent.getErrorStrings()[Xn.Num].toString();var c=this.parent.fromOADate(p);if("Invalid Date"!==c.toString()){if(c.getFullYear()<1900||1e4<=c.getFullYear())return this.parent.getErrorStrings()[Xn.Num].toString();if(!t)return new e.Internationalization(this.parent.parentObject.locale||"en-US").formatDate(c,{type:"date",skeleton:"yMd"})}return p.toString()},t.prototype.ComputeFLOOR=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if((0,e.isNullOrUndefined)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];var n,i=t;if(2!==i.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(""===i[0]&&""===i[1]||""===i[0]&&!i[1].includes('"'))return 0;""!==i[1]||i[0].includes('"')||(i[1]="0");for(var a=0;a<i.length;a++){var o=i[a].split(this.parent.tic).join("").trim();if(""===o||i[a].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(o)))return this.parent.getErrorStrings()[Xn.Value];if(Ir(i[a])){if((n=(n=this.parent.getValueFromArg(i[a])||"0")===this.parent.trueValue?"1":n===this.parent.falseValue?"0":n).toUpperCase().match(/[A-Z]/)||n.includes('"')||!this.parent.isNumber(n))return this.parent.getErrorStrings()[Xn.Value]}else if((n=(n=this.parent.getValueFromArg(i[a].split(this.parent.tic).join("")))===this.parent.trueValue?"1":n===this.parent.falseValue?"0":n).toUpperCase().match(/[A-Z]/)||n.includes('"')||!this.parent.isNumber(n))return this.parent.getErrorStrings()[Xn.Value];i[a]=n}var s=this.parent.parseFloat(i[0]),l=this.parent.parseFloat(i[1]);return s>0&&l<0?this.parent.getErrorStrings()[Xn.Num]:(s>0||s<0)&&0===l?this.parent.getErrorStrings()[Xn.DivZero]:isNaN(s)?this.parent.getErrorStrings()[Xn.Name]:0===s&&0===l?0:Math.floor(s/l)*l},t.prototype.ComputeCEILING=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if((0,e.isNullOrUndefined)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];var n,i=t;if(2!==i.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(""===i[0]&&""===i[1]||""===i[0]&&!i[1].includes('"'))return 0;""!==i[1]||i[0].includes('"')||(i[1]="0");for(var a=0;a<i.length;a++){var o=i[a].split(this.parent.tic).join("").trim();if(""===o||i[a].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(o)))return this.parent.getErrorStrings()[Xn.Value];if(Ir(i[a])){if((n=(n=this.parent.getValueFromArg(i[a])||"0")===this.parent.trueValue?"1":n===this.parent.falseValue?"0":n).toUpperCase().match(/[A-Z]/)||n.includes('"')||!this.parent.isNumber(n))return this.parent.getErrorStrings()[Xn.Value]}else if((n=(n=this.parent.getValueFromArg(i[a].split(this.parent.tic).join("")))===this.parent.trueValue?"1":n===this.parent.falseValue?"0":n).toUpperCase().match(/[A-Z]/)||n.includes('"')||!this.parent.isNumber(n))return this.parent.getErrorStrings()[Xn.Value];i[a]=n}var s=this.parent.parseFloat(i[0]),l=this.parent.parseFloat(i[1]);return s>0&&l<0?this.parent.getErrorStrings()[Xn.Num]:isNaN(s)?this.parent.getErrorStrings()[Xn.Name]:(s>0||0===s)&&0===l?0:Math.ceil(s/l)*l},t.prototype.ComputeDAY=function(){for(var t,r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(n)||1===n.length&&""===n[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(n.length>1)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(n[0].startsWith(this.parent.tic)){if(""===(r=n[0].split(this.parent.tic).join(""))||r===this.parent.trueValue||r===this.parent.falseValue)return a[Xn.Value]}else if(r=this.parent.getValueFromArg(n[0].split(this.parent.tic).join("")),this.parent.isCellReference(n[0])&&r.indexOf(this.parent.tic)>-1)return a[Xn.Value];return a.indexOf(r)>-1?r:Number(r)<0?a[Xn.Num]:0===Math.floor(Number(r))||r===this.parent.falseValue?0:r===this.parent.trueValue?1:(t=this.parent.isNaN(Number(r))?this.parent.parseDate(r):this.parent.intToDate(r),"[object Date]"===Object.prototype.toString.call(t)&&(t=new Date(t).getFullYear()<1900||new Date(t).getFullYear()>9999?this.parent.isNumber(r)?"Num":"NaN":t.getDate()),"NaN"===t.toString()?a[Xn.Value]:"Num"===t.toString()?a[Xn.Num]:t)},t.prototype.ComputeIF=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(r.length&&"nestedFormulaTrue"===r[r.length-1]&&(t=!0,r.pop()),(0,e.isNullOrUndefined)(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(this.parent.getErrorStrings().indexOf(r[0])>0)return r[0];var i,a,o,s=r;if(4===s.length&&"nestedFormulaTrue"===s[3]&&(i=!0,s.pop()),s.length>3||1===s.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(s.length<=3){var l=void 0,d=void 0,h="";if(a=this.parent.getValueFromArg(s[0]),this.parent.getErrorStrings().indexOf(a)>-1)return a;var p=a.toUpperCase(),c=this.parent.parseFloat(a);if(p===this.parent.trueValue||c<0||c>0){if(t&&s[1].includes(":")){l=this.parent.getCellCollection(s[1]);for(var u=0;u<l.length;u++)d=this.parent.getValueFromArg(l[u]),isNaN(this.parent.parseFloat(d))||(h+=d+",");return h.slice(0,h.length-1)}o=""===s[1]?"0":this.parent.getValueFromArg(s[1])}else{if(p!==this.parent.falseValue&&0!==c)return this.parent.formulaErrorStrings[Kn.Requires3Args];if((0,e.isNullOrUndefined)(s[2]))return this.parent.falseValue;if(t&&s[2].includes(":")){l=this.parent.getCellCollection(s[2]);for(u=0;u<l.length;u++)d=this.parent.getValueFromArg(l[u]),isNaN(this.parent.parseFloat(d))||(h+=d+",");return h.slice(0,h.length-1)}o=""===s[2]?"0":this.parent.getValueFromArg(s[2])}}var f=o.indexOf(this.parent.tic);return!i&&f>-1?o.split(this.parent.tic).join(""):!i||dn(o)||-1!==f||o===this.parent.trueValue||o===this.parent.falseValue||this.parent.isCellReference(o)?""===o?"0":o:'"'+o+'"'},t.prototype.ComputeIFERROR=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if((0,e.isNullOrUndefined)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];var n,i=t;if(2!==i.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(this.parent.isCellReference(i[0])){if(n=this.parent.getValueFromArg(i[0])||"0",-1===this.parent.getErrorStrings().indexOf(n)&&"NaN"!==n)return n}else if(n=this.parent.getValueFromArg(i[0],null,!0)||"0",-1===this.parent.getErrorStrings().indexOf(n)&&"NaN"!==n)return n=n.split(this.parent.tic).join("").trim();return n=this.parent.isCellReference(i[1])?this.parent.getValueFromArg(i[1])||"0":(n=this.parent.getValueFromArg(i[1])||"0").split(this.parent.tic).join("").trim()},t.prototype.ComputePRODUCT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=!1;if(t.length&&"isSubtotal"===t[t.length-1]&&(n=!0,t.pop()),(0,e.isNullOrUndefined)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];var i,a,o,s=1,l=!0;if(!(0,e.isNullOrUndefined)(t))for(var d=t,h=0;h<d.length;h++){var p=d[h];if(p.indexOf(":")>-1&&this.parent.isCellReference(p)){for(var c=this.parent.getCellCollection(p),u=0;u<c.length;u++)if(i=n?this.parent.getValueFromArg(c[u],null,null,!0):this.parent.getValueFromArg(c[u]),(!n||!i.includes("SUBTOTAL("))&&dn(i)){if(this.parent.getErrorStrings().indexOf(i)>-1)return i;o=this.parent.parseFloat(i),isNaN(o)||i.length>0&&(s*=o,l=!1)}}else if(-1===p.indexOf(":")&&this.parent.isCellReference(p)){if(a=n?this.parent.getValueFromArg(d[h],null,null,!0):this.parent.getValueFromArg(d[h]),n&&a.includes("SUBTOTAL("))continue;if(!dn(a))continue;if(this.parent.getErrorStrings().indexOf(a)>-1)return a}else{if((a=d[h]).indexOf(this.parent.tic)>-1&&""===a.split(this.parent.tic).join("").trim()||d[h].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(a.split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[Xn.Value];if(a=(a=this.parent.getValueFromArg(d[h].split(this.parent.tic).join("")))===this.parent.trueValue?"1":a===this.parent.falseValue?"0":a.split(this.parent.tic).join(""),this.parent.getErrorStrings().indexOf(a)>-1)return a}o=this.parent.parseFloat(a),isNaN(o)||a.length>0&&(s*=o,l=!1)}return l?"0":s.toString()},t.prototype.ComputeDAYS=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(r)&&1===r.length&&""===r[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(2!==r.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var a=function(e){var r=t.parent.getValueFromArg(e).trim();if(r.indexOf(t.parent.tic)>-1&&(""===(r=r.split(t.parent.tic).join("").trim())||t.parent.isCellReference(e)||r.toUpperCase()===t.parent.trueValue||r.toUpperCase()===t.parent.falseValue))return i[Xn.Value];if((r=r.split(t.parent.tic).join("")).toUpperCase()===t.parent.trueValue)r="1";else if(""===r||r.toUpperCase()===t.parent.falseValue)r="0";else if(Number(r)<0)return i[Xn.Num];var n={value:r.toString()};return t.parent.parentObject.notify(ue,n),(n.isDate||n.isTime)&&(r=(t.parent.parseDate(r).getTime()/864e5).toString()),r},o=a(r[0]);if(i.indexOf(o)>-1)return o;var s=a(r[1]);if(i.indexOf(s)>-1)return s;var l=Math.floor(Number(o))-Math.floor(Number(s));return isNaN(l)?i[Xn.Value]:l},t.prototype.ComputeUNIQUE=function(){for(var t,r,n=this,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];var o=this.parent.getErrorStrings();if("isComputeExp"===i[i.length-1]&&(r=!0,i.pop()),(0,e.isNullOrUndefined)(i)||""===i[0]&&1===i.length)return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(i.length>3)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var s=function(t){if((0,e.isNullOrUndefined)(t))return n.parent.falseValue;var r=n.parent.getValueFromArg(t);return o.indexOf(r)>-1?r:0===Number(r)?n.parent.falseValue:Number(r)<0||Number(r)>0?n.parent.trueValue:(n.parent.isCellReference(t)||(r=n.parent.removeTics(r)),r.toUpperCase()===n.parent.trueValue||r.toUpperCase()===n.parent.falseValue?r.toUpperCase():r.indexOf(n.parent.tic)>-1||t.indexOf(n.parent.tic)>-1?o[Xn.Value]:o[Xn.Name])},l=s(i[1]);if(o.indexOf(l)>-1)return l;var d=s(i[2]);if(o.indexOf(d)>-1)return d;var h=[];if(i[0].indexOf(":")>-1){if((0,e.isNullOrUndefined)(i[0].match(/[0-9]/))){var p=i[0].split(":");i[0]=p[0]+"1:"+p[1]+(this.parent.spreadSheetUsedRange[0]+1)}else if((0,e.isNullOrUndefined)(i[0].toUpperCase().match(/[A-Z]/))){p=i[0].split(":");i[0]="A"+p[0]+":"+Ls(this.parent.spreadSheetUsedRange[1]+1)+p[1]}var c=i[0].split(":");if(this.parent.isCellReference(c[0])&&this.parent.isCellReference(c[1])){for(var u=this.parent.dependencyCollection,f=0;f<u.length&&!r;f++)u[f].split(":")[0]===i[0].split(":")[0]&&this.clearDependency(u[f]);-1===this.parent.dependencyCollection.indexOf(i[0])?r||this.parent.dependencyCollection.push(i[0]):this.clearDependency(i[0]);var g=i[0].indexOf(":"),m=void 0,v=this.parent.rowIndex(this.parent.substring(i[0],0,g)),y=this.parent.colIndex(this.parent.substring(i[0],0,g)),C=this.parent.rowIndex(this.parent.substring(i[0],g+1,g+i[0].length-g-1)),b=this.parent.colIndex(this.parent.substring(i[0],g+1,g+i[0].length-g-1));v>C&&(m=C,C=v,v=m),y>b&&(m=b,b=y,y=m);var x="";0===i[0].indexOf("!")&&(x=i[0].substring(0,i[0].replace("!","").indexOf("!")+2)),i[0]=x+Ls(y)+v+":"+Ls(b)+C;var S,w=b-y,I=this.parent.getCellCollection(i[0]),E=void 0;if(E=S=this.parent.actCell,l===this.parent.falseValue)if(0===w)for(f=0;f<I.length;f++){O=""===(O=this.parent.getValueFromArg(I[f]))?"0":O,h.push(O)}else{var N="",R=w;for(f=0;f<I.length;f++){if(f===I.length-1)N=N+(O=""===(O=this.parent.getValueFromArg(I[f]))?"0":O)+"++",h.push(N.substring(0,N.length-2));if(f<=R)N=N+(O=""===(O=this.parent.getValueFromArg(I[f]))?"0":O)+"++";else h.push(N.substring(0,N.length-2)),R=w+f,N=(O=""===(O=this.parent.getValueFromArg(I[f]))?"0":O)+"++"}}else{N="",R=w+1;var A=C-v;for(f=0;f<R;f++){for(var k=0;k<=A;k++){var O;N=N+(O=""===(O=this.parent.getValueFromArg(I[k*R+f]))?"0":O)+"++"}h.push(N.substring(0,N.length-2)),N=""}}var F,T=[],D=[],L=[],P=[];for(f=0;f<h.length;f++)-1===T.indexOf(h[f].toLowerCase())?(T.push(h[f].toLowerCase()),L.push(h[f])):(-1===D.indexOf(h[f].toLowerCase())&&D.push(h[f].toLowerCase()),P.push(h[f]));if(d===this.parent.trueValue){var M=[];for(f=0;f<L.length;f++)-1===D.indexOf(L[f].toLowerCase())&&M.push(L[f]);if(0===(L=M).length)return o[Xn.Calc]}if(r)return 0!==w?(F=[],L.forEach((function(e){F=F.concat(e.split("++"))}))):F=l===this.parent.falseValue?L:L[0].split("++"),F;E.indexOf("!")>-1&&(E=E.substring(E.lastIndexOf("!")+1));var B=this.parent.rowIndex(E),H=this.parent.colIndex(E);if(0===this.parent.dependencyLevel){var U=!1;if(l===this.parent.falseValue)for(f=B,R=L.length+B;f<R;f++)for(var V=H,z=(G=L[0].split("++")).length+H;V<z;V++)f===R-1&&V===z-1&&-1===this.parent.uniqueRange.indexOf(S+":"+Ls(V)+f)&&this.parent.uniqueRange.push(S+":"+Ls(V)+f),this.checkSpill(V,f)&&(U=!0);else for(f=H,R=L.length+H;f<R;f++){var j=B;for(z=(G=L[0].split("++")).length+B;j<z;j++)f===R-1&&j===z-1&&-1===this.parent.uniqueRange.indexOf(this.parent.actCell+":"+Ls(f)+j)&&this.parent.uniqueRange.push(this.parent.actCell+":"+Ls(f)+j),this.checkSpill(f,j)&&(U=!0)}if(U)return this.parent.formulaErrorStrings[Kn.Spill]}else if(this.parent.dependencyLevel>0&&this.parent.getValueFromArg(Ls(H)+B,!0).indexOf("#SPILL!")>-1)return this.parent.formulaErrorStrings[Kn.Spill];if(l===this.parent.falseValue){var _=this.parent.getSheetFamilyItem(this.parent.grid),q="",W=void 0;null!==_.sheetNameToParentObject&&_.sheetNameToParentObject.size>0&&(W=(q=_.parentObjectToToken.get(this.parent.grid))+E);for(f=0;f<L.length;f++){var G=L[f].split("++");f>0&&(B++,H=this.parent.colIndex(E));for(var Y=0;Y<G.length;Y++)this.setValueRefresh(G[Y],B,H),(f>0||Y>0)&&this.parent.refresh(q+Ls(H)+B.toString(),W),G[Y+1]&&H++}t=L[0].split("++")[0]}else{for(f=0;f<L.length;f++){G=L[f].split("++");for(var X=0;X<G.length;X++)this.setValueRefresh(G[X],B,H),G[X+1]?B++:(H++,B=this.parent.rowIndex(E))}t=L[0].split("++")[0]}}}else if(this.parent.isCellReference(i[0]))-1===this.parent.dependencyCollection.indexOf(i[0])?r||this.parent.dependencyCollection.push(i[0]):this.clearDependency(i[0]),t=this.parent.getValueFromArg(i[0]);else{if(t=this.parent.getValueFromArg(i[0].trim()),o.indexOf(t)>-1)return t;t=this.parent.removeTics(t)}return t},t.prototype.setValueRefresh=function(e,t,r){this.parent.parentObject.setValueRowCol(this.parent.getSheetId(this.parent.grid),e,t,r)},t.prototype.checkSpill=function(e,t){var r,n=!1,i=this.parent.getValueFromArg(Ls(e)+t,!0),a="!"+this.parent.getSheetID(this.parent.grid)+"!"+Ls(e)+t;return this.parent.getFormulaInfoTable().get(a)&&(r=this.parent.getFormulaInfoTable().get(a).formulaText),i&&(i.toUpperCase().indexOf("UNIQUE")<0||r&&!r.toUpperCase().includes("UNIQUE"))&&i!==this.parent.formulaErrorStrings[Kn.WrongNumberArguments]&&(n=!0),n},t.prototype.clearDependency=function(e){var t=this.parent.actCell,r="";if(t.lastIndexOf("!")>-1){var n=t;t=n.substring(n.lastIndexOf("!")+1),r=n.substring(0,n.lastIndexOf("!"))+"!"}for(var i=this.parent.rowIndex(t),a=this.parent.colIndex(t),o=e.indexOf(":"),s=this.parent.rowIndex(this.parent.substring(e,0,o)),l=this.parent.colIndex(this.parent.substring(e,0,o)),d=this.parent.rowIndex(this.parent.substring(e,o+1,o+e.length-o-1))-s+i,h=this.parent.colIndex(this.parent.substring(e,o+1,o+e.length-o-1))-l+a,p=this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+t)?this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+t).getFormulaText():"",c=i;c<=d;c++)for(var u=a;u<=h;u++)if(this.parent.dependencyLevel>0||p.indexOf("UNIQUE")>-1){if(this.parent.getValueFromArg("!"+this.parent.getSheetID(this.parent.grid)+"!"+Ls(a)+i,!0).indexOf("#SPILL!")>-1)return;this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,"",c,u),this.parent.refresh("!"+this.parent.getSheetID(this.parent.grid)+"!"+Ls(u)+c,t),this.parent.actCell=r+t}},t.prototype.ComputeT=function(){for(var t,r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=this.parent.getErrorStrings();if(n.length&&"nestedFormulaTrue"===n[n.length-1]&&(r=!0,n.pop()),(0,e.isNullOrUndefined)(n)||1===n.length&&""===n[0].trim())return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(n.length>1)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(t=this.parent.getValueFromArg(n[0]).trim(),a.indexOf(t)>-1)return t;if(n[0].indexOf(this.parent.tic)>-1)(t=this.parent.removeTics(n[0].trim())).indexOf(this.parent.tic+this.parent.tic)>-1&&(t=t.replace(/""/g,this.parent.tic));else if(2===t.split("%").length&&this.parent.isNumber(t.split("%")[0])&&(t=(Number(t.split("%")[0])/100).toString()),this.parent.isNumber(t)||t.toUpperCase()===this.parent.trueValue||t.toUpperCase()===this.parent.falseValue)return"";return r&&(t=this.parent.tic+t+this.parent.tic),t},t.prototype.ComputeHOUR=function(){for(var t,r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(1!==n.length||(0,e.isNullOrUndefined)(n)||""===n[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(""===n[0].split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[Xn.Value];if(this.parent.isCellReference(n[0])){if((t=this.parent.getValueFromArg(n[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Xn.Value]}else{if(n[0].indexOf(this.parent.tic)>-1&&(n[0].split(this.parent.tic).join("")===this.parent.trueValue||n[0].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[Xn.Value];t=this.parent.getValueFromArg(n[0]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(t)>-1)return t;if(t=t===this.parent.trueValue?"1":t===this.parent.falseValue?"0":t,this.parent.isNumber(t)){if(this.parent.parseFloat(t)<0||this.parent.parseFloat(t)>2958465)return this.parent.getErrorStrings()[Xn.Num];r=this.parent.intToTime(t)}else{var a={value:t.toString()};if(this.parent.parentObject.notify(ue,a),!a.isDate&&!a.isTime)return this.parent.getErrorStrings()[Xn.Value];r=a.dateObj}if("Invalid Date"===r.toString()&&(r=new Date(Date.parse(t))),"Invalid Date"===r.toString()){var o=new Date(Date.now()).toLocaleDateString()+" "+t;r=new Date(Date.parse(o))}return"Invalid Date"===r.toString()&&(r=this.parent.fromOADate(this.parent.parseFloat(t))),"Invalid Date"===r.toString()||r.getFullYear()<1900||r.getFullYear()>9999?this.parent.getErrorStrings()[Xn.Value]:r.getHours()},t.prototype.ComputeMINUTE=function(){for(var t,r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(1!==n.length||(0,e.isNullOrUndefined)(n)||""===n[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(""===n[0].split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[Xn.Value];if(this.parent.isCellReference(n[0])){if((t=this.parent.getValueFromArg(n[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Xn.Value]}else{if(n[0].indexOf(this.parent.tic)>-1&&(n[0].split(this.parent.tic).join("")===this.parent.trueValue||n[0].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[Xn.Value];t=this.parent.getValueFromArg(n[0]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(t)>-1)return t;if(t=t===this.parent.trueValue?"1":t===this.parent.falseValue?"0":t,this.parent.isNumber(t)){if(this.parent.parseFloat(t)<0||this.parent.parseFloat(t)>2958465)return this.parent.getErrorStrings()[Xn.Num];r=this.parent.intToTime(t)}else{var a={value:t.toString()};if(this.parent.parentObject.notify(ue,a),!a.isDate&&!a.isTime)return this.parent.getErrorStrings()[Xn.Value];r=a.dateObj}if("Invalid Date"===r.toString()&&(r=new Date(Date.parse(t))),"Invalid Date"===r.toString()){var o=new Date(Date.now()).toLocaleDateString()+" "+t;r=new Date(Date.parse(o))}return"Invalid Date"===r.toString()&&(r=this.parent.fromOADate(this.parent.parseFloat(t))),"Invalid Date"===r.toString()||r.getFullYear()<1900||r.getFullYear()>9999?this.parent.getErrorStrings()[Xn.Value]:r.getMinutes()},t.prototype.ComputeSECOND=function(){for(var t,r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(1!==n.length||(0,e.isNullOrUndefined)(n)||""===n[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(""===n[0].split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[Xn.Value];if(this.parent.isCellReference(n[0])){if((t=this.parent.getValueFromArg(n[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Xn.Value]}else{if(n[0].indexOf(this.parent.tic)>-1&&(n[0].split(this.parent.tic).join("")===this.parent.trueValue||n[0].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[Xn.Value];t=this.parent.getValueFromArg(n[0]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(t)>-1)return t;if(t=t===this.parent.trueValue?"1":t===this.parent.falseValue?"0":t,this.parent.isNumber(t)){if(this.parent.parseFloat(t)<0||this.parent.parseFloat(t)>2958465)return this.parent.getErrorStrings()[Xn.Num];r=this.parent.intToTime(t)}else{var a={value:t.toString()};if(this.parent.parentObject.notify(ue,a),!a.isDate&&!a.isTime)return this.parent.getErrorStrings()[Xn.Value];r=a.dateObj}if("Invalid Date"===r.toString()&&(r=new Date(Date.parse(t))),"Invalid Date"===r.toString()){var o=new Date(Date.now()).toLocaleDateString()+" "+t;r=new Date(Date.parse(o))}return"Invalid Date"===r.toString()&&(r=this.parent.fromOADate(this.parent.parseFloat(t))),"Invalid Date"===r.toString()||r.getFullYear()<1900||r.getFullYear()>9999?this.parent.getErrorStrings()[Xn.Value]:r.getSeconds()},t.prototype.ComputeMONTH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.parent.getErrorStrings();if(1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(1!==e.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var n=this.parent.getValueFromArg(e[0]).trim();if(r.indexOf(n)>-1)return n;if(this.parent.isCellReference(e[0])){if(n.indexOf(this.parent.tic)>-1)return r[Xn.Value];if(""===n)return 1}else{if('"TRUE"'===n.toUpperCase()||'"FALSE"'===n.toUpperCase())return r[Xn.Value];n=n.split(this.parent.tic).join("")}if(""===n)return r[Xn.Value];if(n===this.parent.trueValue||n===this.parent.falseValue||Number(n)>-1&&Number(n)<32)return 1;if(Number(n)<0)return r[Xn.Num];n.indexOf("%")>-1&&(n=(.01*Number(n.split("%")[0])).toString()),this.parent.isNumber(n)&&(n=parseInt(Math.floor(Number(n)).toString(),10));var i=this.parent.parseDate(n);return"Invalid Date"===i.toString()?this.parent.isNumber(n)?r[Xn.Num]:r[Xn.Value]:i.getFullYear()<1900||1e4<=i.getFullYear()?r[Xn.Num]:(i.getMonth()+1).toString()},t.prototype.ComputeNOW=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(1!==t.length||""!==t[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];var n=new Date(Date.now()),i=(new e.Internationalization).getDateFormat({format:"M/d/yyyy h:mm:ss a"});return this.parent.parentObject.dateToInt(i(n),!0).toString()},t.prototype.ComputeEXACT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,i,a=!1,o=e.length&&"nestedFormulaTrue"===e[e.length-1],s=this.parent.getErrorStrings();if(o&&e.pop(),!e||!e[0]&&1===e.length)return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(2!==e.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(e[0]){if(r=this.parent.getValueFromArg(e[0]),s.indexOf(r)>-1)return r;-1===r.indexOf(this.parent.tic)&&r.includes("%")&&(r=(Number(r.split("%")[0])/100).toString()),this.parent.isCellReference(e[0])?i=!0:r=r.split(this.parent.tic).join("")}if(e[1]){if(n=this.parent.getValueFromArg(e[1]),s.indexOf(n)>-1)return n;-1===n.indexOf(this.parent.tic)&&n.includes("%")&&(n=(Number(n.split("%")[0])/100).toString()),this.parent.isCellReference(e[1])?i||0!==r.trim().length||0!==n.trim().length||(a=!1):(n=n.split(this.parent.tic).join(""),i&&0===r.trim().length&&0===n.trim().length&&(a=!1))}return r===n&&(a=!0,o&&(a=this.parent.tic+a+this.parent.tic)),a},t.prototype.ComputeLEN=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();return(0,e.isNullOrUndefined)(r)||""===r[0].trim()&&1===r.length?this.parent.formulaErrorStrings[Kn.InvalidArguments]:r.length>1?this.parent.formulaErrorStrings[Kn.WrongNumberArguments]:(t=this.parent.getValueFromArg(r[0]).trim(),i.indexOf(t)>-1?t:(r[0].indexOf(this.parent.tic)>-1?r[0]!==t&&r[0].startsWith("n")?t=this.parent.removeTics(t.trim()):(t=this.parent.removeTics(r[0].trim())).indexOf(this.parent.tic+this.parent.tic)>-1&&(t=t.replace(/""/g,this.parent.tic)):!r[0].startsWith("n")&&2===t.split("%").length&&this.parent.isNumber(t.split("%")[0])&&(t=(Number(t.split("%")[0])/100).toString()),t.length))},t.prototype.ComputeMOD=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if((0,e.isNullOrUndefined)(r)||2!==r.length)return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(""===r[1]&&!r[0].includes('"'))return this.parent.formulaErrorStrings[Kn.Div];if(""===r[0]&&!r[1].includes('"'))return 0;for(var i=0;i<r.length;i++){var a=r[i].split(this.parent.tic).join("").trim();if(""===a||r[i].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(a)))return this.parent.getErrorStrings()[Xn.Value];if(Ir(r[i])){if((t=(t=this.parent.getValueFromArg(r[i])||"0")===this.parent.trueValue?"1":t===this.parent.falseValue?"0":t).toUpperCase().match(/[A-Z]/)||t.includes('"')||!this.parent.isNumber(t))return this.parent.getErrorStrings()[Xn.Value]}else if(t=(t=this.parent.getValueFromArg(r[i].split(this.parent.tic).join("")))===this.parent.trueValue?"1":t===this.parent.falseValue?"0":t,this.parent.getErrorStrings().indexOf(t)>-1)return t;r[i]=t}var o=r[0],s=r[1];if("0"===s||""===s)return this.parent.formulaErrorStrings[Kn.Div];if("0"===o||""===o)return 0;var l=((o=parseFloat(o))%(s=parseFloat(s))+s)%s;return isNaN(l)?this.parent.getErrorStrings()[Xn.Name]:l},t.prototype.ComputeODD=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if((0,e.isNullOrUndefined)(t)||1!==t.length||""===t[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];var n,i=t[0].split(this.parent.tic).join("").trim();if(""===i||t[0].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(i)))return this.parent.getErrorStrings()[Xn.Value];if(Ir(t[0])){if((n=this.parent.getValueFromArg(t[0]))===this.parent.trueValue)n="1";else if(""===n||n===this.parent.falseValue)n="0";else if(n.toUpperCase().match(/[A-Z]/)||n.includes('"')||!this.parent.isNumber(n))return this.parent.getErrorStrings()[Xn.Value]}else{if("#NAME?"===(n=this.parent.getValueFromArg(t[0].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[Xn.Name];if(n===this.parent.trueValue)n="1";else if(""===n||n===this.parent.falseValue)n="0";else if(n.toUpperCase().match(/[A-Z]/)||!this.parent.isNumber(n))return this.parent.getErrorStrings()[Xn.Value]}var a=Math.ceil(parseInt(n,10)),o=0===a;return a=a%2==0?a>0?a+1:a-1:a,Math.ceil(parseInt(n,10))%2!=0&&(parseInt(n,10)>0&&parseFloat(n)>parseInt(n,10)?a+=2:parseInt(n,10)<0&&parseFloat(n)<parseInt(n,10)&&(a-=2)),isNaN(a)?this.parent.getErrorStrings()[Xn.Name]:o?1:a},t.prototype.ComputeEVEN=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if((0,e.isNullOrUndefined)(t)||1!==t.length||""===t[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];var n,i=t[0].split(this.parent.tic).join("").trim();if(""===i||t[0].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(i)))return this.parent.getErrorStrings()[Xn.Value];if(Ir(t[0])){if((n=this.parent.getValueFromArg(t[0]))===this.parent.trueValue)n="1";else if(""===n||n===this.parent.falseValue)n="0";else if(n.toUpperCase().match(/[A-Z]/)||n.includes('"')||!this.parent.isNumber(n))return this.parent.getErrorStrings()[Xn.Value]}else{if("#NAME?"===(n=this.parent.getValueFromArg(t[0].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[Xn.Name];if(n===this.parent.trueValue)n="1";else if(""===n||n===this.parent.falseValue)n="0";else if(n.toUpperCase().match(/[A-Z]/)||!this.parent.isNumber(n))return this.parent.getErrorStrings()[Xn.Value]}var a=Math.ceil(parseInt(n,10));return a=a%2==0?a:a>0?a+1:a-1,Math.ceil(parseInt(n,10))%2==0&&(parseInt(n,10)>0&&parseFloat(n)>parseInt(n,10)?a+=2:parseInt(n,10)<0&&parseFloat(n)<parseInt(n,10)&&(a-=2)),isNaN(a)?this.parent.getErrorStrings()[Xn.Name]:a},t.prototype.ComputePI=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e&&""!==e[0]?this.parent.formulaErrorStrings[Kn.InvalidArguments]:Math.PI},t.prototype.ComputeMEDIAN=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=[];if((0,e.isNullOrUndefined)(r)||""===r[0]&&1===r.length)return this.parent.formulaErrorStrings[Kn.InvalidArguments];for(var a=0;a<r.length;a++)if(this.parent.isCellReference(r[a]))if(r[a].indexOf(":")>-1)for(var o=this.parent.getCellCollection(r[a]),s=0;s<o.length;s++){var l=this.parent.getValueFromArg(o[s]);if(this.parent.getErrorStrings().indexOf(l)>-1)return l;""!==l.trim()&&i.push(this.parent.parseFloat(l))}else{var d=this.parent.getValueFromArg(r[a]);if(this.parent.getErrorStrings().indexOf(d)>-1)return d;""!==d.trim()&&i.push(this.parent.parseFloat(d))}else if(""===r[a]||r[a]===this.parent.falseValue&&!this.parent.isCellReference(r[a]))i.push(0);else if(r[a]!==this.parent.trueValue||this.parent.isCellReference(r[a])){if(r[a].indexOf(this.parent.tic)>-1&&isNaN(parseFloat(r[a].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[Xn.Value];var h=this.parent.getValueFromArg(r[a]).split(this.parent.tic).join("");if(this.parent.getErrorStrings().indexOf(h)>-1)return h;i.push(this.parent.parseFloat(h))}else i.push(1);for(var p=(i=i.sort((function(e,t){return e-t}))).length,c=0;c<p&&(!isNaN(i[c])||(i.splice(c,1),p=i.length,c--,0!==i.length));c++);if(i.length%2==0||isNaN(i[parseInt((i.length/2).toString(),10)])){if(isNaN(i[i.length/2])||isNaN(i[i.length/2-1]))return this.parent.getErrorStrings()[Xn.Num];t=(i[i.length/2]+i[i.length/2-1])/2}else t=i[parseInt((i.length/2).toString(),10)];return t},t.prototype.ComputeEDATE=function(){for(var t,r,n,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];if(2!==i.length||(0,e.isNullOrUndefined)(i))return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(""===i[0]||""===i[1])return this.parent.getErrorStrings()[Xn.NA];if(""===i[0].split(this.parent.tic).join("")||""===i[1].split(this.parent.tic).join("")||i[1].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(i[1].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[Xn.Value];if(this.parent.isCellReference(i[0])){if(i[0].indexOf(":")>-1)return this.parent.getErrorStrings()[Xn.Value];if((t=this.parent.getValueFromArg(i[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Xn.Value]}else t=this.parent.getValueFromArg(i[0].split(this.parent.tic).join(""));if(this.parent.isCellReference(i[1])){if(i[1].indexOf(":")>-1)return this.parent.getErrorStrings()[Xn.Value];r=this.parent.getValueFromArg(i[1].split(this.parent.tic).join(""))||"0"}else r=this.parent.getValueFromArg(i[1].split(this.parent.tic).join(""));if(this.parent.getErrorStrings().indexOf(r)>-1)return r;if(r=parseInt(r,10),this.parent.isNumber(t)){if((t=parseInt(t,10))<0||t>2958465)return this.parent.getErrorStrings()[Xn.Num];n=this.parent.fromOADate(t)}else n=this.parent.checkDateFormat(t);if(isNaN(r)||(0,e.isNullOrUndefined)(this.parent.isDate(n))||n.getFullYear()>9999)return this.parent.getErrorStrings()[Xn.Value];var o=n.getDate();n.setMonth(n.getMonth()+r),o!==n.getDate()&&n.setDate(0);var s=this.parent.parentObject.dateToInt(n);return"0"===t.toString()&&(s-=1),s<0||s>2958465?this.parent.getErrorStrings()[Xn.Num]:s.toString()},t.prototype.ComputeEOMONTH=function(){for(var t,r,n,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];if(2!==i.length||(0,e.isNullOrUndefined)(i))return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(""===i[0]||""===i[1])return this.parent.getErrorStrings()[Xn.NA];if(""===i[0].split(this.parent.tic).join("")||""===i[1].split(this.parent.tic).join("")||i[1].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(i[1].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[Xn.Value];if(this.parent.isCellReference(i[0])){if(i[0].indexOf(":")>-1)return this.parent.getErrorStrings()[Xn.Value];if((t=this.parent.getValueFromArg(i[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Xn.Value]}else t=this.parent.getValueFromArg(i[0]).split(this.parent.tic).join("");if(this.parent.getErrorStrings().indexOf(t)>-1)return t;if(this.parent.isCellReference(i[1])){if(i[1].indexOf(":")>-1)return this.parent.getErrorStrings()[Xn.Value];r=this.parent.getValueFromArg(i[1].split(this.parent.tic).join(""))||"0"}else r=this.parent.getValueFromArg(i[1].split(this.parent.tic).join(""));if(this.parent.getErrorStrings().indexOf(r)>-1)return r;if(r=parseInt(r,10),this.parent.isNumber(t)){if((t=parseInt(t,10))<0||t>2958465)return this.parent.getErrorStrings()[Xn.Num];n=this.parent.fromOADate(t)}else n=this.parent.checkDateFormat(t);if(isNaN(r)||(0,e.isNullOrUndefined)(this.parent.isDate(n))||n.getFullYear()>9999)return this.parent.getErrorStrings()[Xn.Value];n=new Date(n.getFullYear(),n.getMonth()+(r+1),0);var o=this.parent.parentObject.dateToInt(n);return o<0||o>2958465||n.getFullYear()<1900?this.parent.getErrorStrings()[Xn.Num]:o.toString()},t.prototype.ComputeDATEVALUE=function(){for(var t,r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=this.parent.getErrorStrings();if(""===n[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(n.length>1)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(t=r=this.parent.getValueFromArg(n[0])||"0",a.indexOf(t)>-1)return t;if(this.parent.isCellReference(n[0])){if(n[0].indexOf(":")>-1||t.startsWith(this.parent.tic))return a[Xn.Value]}else t=n[0].split(this.parent.tic).join("")||"0";if(this.parent.isNumber(t)||(0,e.isNullOrUndefined)(this.parent.isDate(t))){if(this.parent.isNumber(r)||!this.parent.isDate(r))return a[Xn.Value];t=r}var o=this.parent.parseDate(t);return a.indexOf(t)>-1?t:(0,e.isNullOrUndefined)(o)||"Invalid Date"===o.toString()||o.getFullYear()<1900||o.getFullYear()>9999?this.parent.getErrorStrings()[Xn.Value]:(t=this.parent.toOADate(o).toString(),parseFloat(t).toFixed(0).toString())},t.prototype.ComputeCOUNTBLANK=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=0;if(1!==t.length||(0,e.isNullOrUndefined)(t)||!this.parent.isCellReference(t[0]))return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(""===t[0])return this.parent.getErrorStrings()[Xn.Value];for(var i=this.parent.getCellCollection(t[0]),a=0;a<i.length;a++)""===this.parent.getValueFromArg(i[a])&&n++;return n},t.prototype.ComputeFACT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=1,n=this.parent.getErrorStrings();if(""===e[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(1!==e.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var i=e[0];if(this.parent.isCellReference(e[0])||isNaN(Number(i.split(this.parent.tic).join("")))){if(i=this.parent.getValueFromArg(e[0]),n.indexOf(i)>-1)return i;if(i.startsWith(this.parent.tic)||i.match(/^(\d*\.\d+|\d+)\s*[+\-*/]\s*(\d*\.\d+|\d+)$/))return n[Xn.Value];if(""===i)return 1}if(i=i.split(this.parent.tic).join("").trim(),n.indexOf(i)>-1)return i;if(i.toUpperCase()===this.parent.trueValue||i.toUpperCase()===this.parent.falseValue)return 1;i.indexOf("%")>-1&&(i=(Number(i.split("%")[0])/100).toString());var a=parseInt(i,10);if(a<0||a>170)return n[Xn.Num];if(i.toUpperCase().match(/[A-Z]/)||""===i)return n[Xn.Value];if(i.indexOf(":")>-1)return 0;for(var o=1;o<=a;o++)r*=o;return r},t.prototype.ComputeDECIMAL=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if((0,e.isNullOrUndefined)(r)||2!==r.length)return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(r[0].match(/[@#$%^&*()?:{}|<>+-]/g))return this.parent.getErrorStrings()[Xn.Num];if(r[1].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(r[1].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[Xn.Value];var i=void 0,a=void 0;i=this.parent.isCellReference(r[0].toString())?this.parent.getValueFromArg(r[0]):this.parent.getValueFromArg(r[0]).split(this.parent.tic).join(""),a=this.parent.isCellReference(r[1].toString())?this.parent.getValueFromArg(r[1]):this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("");var o=parseInt(i,10),s=parseInt(a,10);return this.parent.getErrorStrings().indexOf(i)>-1?i:this.parent.getErrorStrings().indexOf(a)>-1?a:""===i&&""!==a?0:""===i||o<0||!isNaN(o)&&!Number.isInteger(parseFloat(i))||""===a||s<2||s>36||isNaN(s)||isNaN(this.parent.parseFloat(i))&&this.parent.parseFloat(a)<=10?this.parent.getErrorStrings()[Xn.Num]:(t=parseInt(i,parseInt(a,10)),isNaN(t)?this.parent.getErrorStrings()[Xn.Num]:t)},t.prototype.ComputeDEGREES=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(t)||""===t[0]&&1===t.length)return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(1!==t.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var i=this.parent.getValueFromArg(t[0]).trim();if(n.indexOf(i)>-1)return i;if(this.parent.isCellReference(t[0])){if(""===i||i.indexOf(":")>-1)return 0;if(i.indexOf(this.parent.tic)>-1||isNaN(Number(i))&&!isNaN(parseInt(i,10)))return n[Xn.Value]}else if(i.indexOf('"TRUE"')>-1)return n[Xn.Value];if((i=i.split(this.parent.tic).join("")).toUpperCase()===this.parent.trueValue)i="1";else if(i.toUpperCase()===this.parent.falseValue)i="0";else if(i.indexOf("%")>-1)i=(Number(i.split("%")[0])/100).toString();else if(i.toUpperCase().match(/[A-Z]/)||isNaN(parseInt(i,10)))return n[Xn.Value];return parseFloat(i)*(180/Math.PI)},t.prototype.ComputeADDRESS=function(){for(var t,r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(n)||1===n.length&&""===n[0].trim())return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(n.length<2||n.length>5)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(""===n[0].split(this.parent.tic).join("").trim()||""===n[1].split(this.parent.tic).join("").trim())return a[Xn.Value];var o=function(e){var t=r.parent.getValueFromArg(e).trim();return a.indexOf(t)>0?t:(t.toUpperCase()===r.parent.trueValue?t="1":t.toUpperCase()===r.parent.falseValue&&(t="0"),r.parent.isCellReference(e)&&t.indexOf(r.parent.tic)>-1?a[Xn.Value]:(2===(t=r.parent.removeTics(t)).split("%").length&&r.parent.isNumber(t.split("%")[0])&&(t=(Number(t.split("%")[0])/100).toString()),t))},s=o(n[0]);if(a.indexOf(s)>0)return s;if(s=Number(s),isNaN(s)||s<1)return a[Xn.Value];s=s.toString();var l,d,h,p=o(n[1]);if(a.indexOf(p)>0)return p;if(p=Number(p),isNaN(p)||p<1)return a[Xn.Value];if(p=p.toString(),(0,e.isNullOrUndefined)(n[2])||""===n[2].trim())l="1";else{if(l=o(n[2]),a.indexOf(l)>0)return l;if(l=Number(l),isNaN(l)||l<1||l>4)return a[Xn.Value];l=l.toString()}if((0,e.isNullOrUndefined)(n[3])||""===n[3].trim())d="1";else{if(d=o(n[3]),a.indexOf(d)>0)return d;d.toUpperCase()===this.parent.trueValue||Number(d)>1?d="1":""!==d&&d.toUpperCase()!==this.parent.falseValue||(d="0")}if("1"===d)"1"===l?t="$"+Ls(parseInt(p,10))+"$"+parseInt(s,10):"2"===l?t=Ls(parseInt(p,10))+"$"+parseInt(s,10):"3"===l?t="$"+Ls(parseInt(p,10))+parseInt(s,10):"4"===l&&(t=Ls(parseInt(p,10))+parseInt(s,10));else{if("0"!==d)return a[Xn.Name];"1"===l?t="R"+parseInt(s,10)+"C"+parseInt(p,10):"2"===l?t="R"+parseInt(s,10)+"C["+parseInt(p,10)+"]":"3"===l?t="R["+parseInt(s,10)+"]C"+parseInt(p,10):"4"===l&&(t="R["+parseInt(s,10)+"]C["+parseInt(p,10)+"]")}return!(0,e.isNullOrUndefined)(n[4])&&""!==n[4]&&(h=this.parent.getValueFromArg(n[4]).split(this.parent.tic).join(""),a.indexOf(h)>0)?h:((0,e.isNullOrUndefined)(h)||(t=h+"!"+t),t)},t.prototype.ComputeTIME=function(){for(var t,r,n,i,a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];if((0,e.isNullOrUndefined)(a)||3!==a.length)return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(a[0].indexOf(this.parent.tic)>-1&&""===a[0].split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[Xn.Value];if(a[1].indexOf(this.parent.tic)>-1&&""===a[1].split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[Xn.Value];if(a[2].indexOf(this.parent.tic)>-1&&""===a[2].split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[Xn.Value];if(this.parent.isCellReference(a[0])){if((r=this.parent.getValueFromArg(a[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Xn.Value]}else{if(a[0].indexOf(this.parent.tic)>-1&&(a[0].split(this.parent.tic).join("")===this.parent.trueValue||a[0].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[Xn.Value];r=this.parent.getValueFromArg(a[0]).split(this.parent.tic).join("")||"0"}if(this.parent.getErrorStrings().indexOf(r)>-1)return r;if(isNaN(this.parent.parseFloat(r))&&r!==this.parent.trueValue&&r!==this.parent.falseValue)return this.parent.getErrorStrings()[Xn.Value];if(this.parent.isCellReference(a[1])){if((n=this.parent.getValueFromArg(a[1].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Xn.Value]}else{if(a[1].indexOf(this.parent.tic)>-1&&(a[1].split(this.parent.tic).join("")===this.parent.trueValue||a[1].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[Xn.Value];n=this.parent.getValueFromArg(a[1]).split(this.parent.tic).join("")||"0"}if(this.parent.getErrorStrings().indexOf(n)>-1)return n;if(isNaN(this.parent.parseFloat(n))&&n!==this.parent.trueValue&&n!==this.parent.falseValue)return this.parent.getErrorStrings()[Xn.Value];if(this.parent.isCellReference(a[2])){if((i=this.parent.getValueFromArg(a[2].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Xn.Value]}else{if(a[2].indexOf(this.parent.tic)>-1&&(a[2].split(this.parent.tic).join("")===this.parent.trueValue||a[2].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[Xn.Value];i=this.parent.getValueFromArg(a[2]).split(this.parent.tic).join("")||"0"}if(this.parent.getErrorStrings().indexOf(i)>-1)return i;if(isNaN(this.parent.parseFloat(i))&&i!==this.parent.trueValue&&i!==this.parent.falseValue)return this.parent.getErrorStrings()[Xn.Value];if(r=r===this.parent.trueValue?"1":r===this.parent.falseValue?"0":r,n=n===this.parent.trueValue?"1":n===this.parent.falseValue?"0":n,i=i===this.parent.trueValue?"1":i===this.parent.falseValue?"0":i,r=parseInt(this.parent.parseFloat(r).toString(),10),n=parseInt(this.parent.parseFloat(n).toString(),10),i=parseInt(this.parent.parseFloat(i).toString(),10),isNaN(r)||isNaN(n)||isNaN(i))return this.parent.getErrorStrings()[Xn.Value];if(r>32767||n>32767||i>32767)return this.parent.getErrorStrings()[Xn.Num];var s=new Date(1900,0,1,r,n,i);if(s.getFullYear()<1900)return this.parent.getErrorStrings()[Xn.Num];var l=s.getHours(),d=s.getMinutes(),h=s.getSeconds(),p="AM",c=l;c>=12&&(c=l-12,p="PM"),0===c&&(c=12);var u={value:(t=(c=c<10?"0"+c:c)+":"+(d=d<10?"0"+d:d)+":"+(h=h<10?"0"+h:h)+" "+p).toString()};return this.parent.parentObject.notify(ue,u),u.isTime&&(t=u.updatedVal),t},t.prototype.ComputeCHAR=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(t)||""===t[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(1!==t.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var i=this.parent.getValueFromArg(t[0]).trim();if(n.indexOf(i)>-1)return i;if(i.indexOf('"TRUE"')>-1||this.parent.isCellReference(t[0])&&i.startsWith(this.parent.tic))return n[Xn.Value];if(i=i.split(this.parent.tic).join(""),this.parent.isNumber(i)?i=Math.floor(Number(i)).toString():i.indexOf("%")>-1?i=Math.floor(Number(i.split("%")[0])/100).toString():i===this.parent.trueValue&&(i="1"),!i.toUpperCase().match(/^[0-9]+$/))return n[Xn.Value];var a=parseInt(i,10);return a>255||a<=0?n[Xn.Value]:String.fromCharCode(a)},t.prototype.ComputeCODE=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();return(0,e.isNullOrUndefined)(r)||1===r.length&&""===r[0].trim()?this.parent.formulaErrorStrings[Kn.InvalidArguments]:r.length>1?this.parent.formulaErrorStrings[Kn.WrongNumberArguments]:(t=this.parent.getValueFromArg(r[0]).trim(),i.indexOf(t)>-1?t:(r[0].indexOf(this.parent.tic)>-1?t=r[0]!==t&&r[0].startsWith("n")?this.parent.removeTics(t.trim()):this.parent.removeTics(r[0].trim()):!r[0].startsWith("n")&&2===t.split("%").length&&this.parent.isNumber(t.split("%")[0])&&(t=(Number(t.split("%")[0])/100).toString()),""===t?i[Xn.Value]:t=t.charCodeAt(0)))},t.prototype.ComputeDOLLAR=function(){for(var t,r,n,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];if(i.length&&"nestedFormulaTrue"===i[i.length-1]&&(n=!0,i.pop()),1===i.length&&(""===i[0]&&(r=!0),i.push("2")),(0,e.isNullOrUndefined)(i)||2!==i.length||r)return this.parent.formulaErrorStrings[Kn.InvalidArguments];for(var o=0;o<i.length;o++)if(i[o].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(i[o])))return this.parent.getErrorStrings()[Xn.Value];var s=this.parent.getValueFromArg(i[0]).split(this.parent.tic).join(""),l=this.parent.getValueFromArg(i[1]).split(this.parent.tic).join("");if(s=""===s||s===this.parent.falseValue?"0":s===this.parent.trueValue?"1":s,l=""===l||l===this.parent.falseValue?"0":l===this.parent.trueValue?"1":l,"#NAME?"===s||"#NAME?"===l)return this.parent.getErrorStrings()[Xn.Name];if(!s.toUpperCase().match(/^[-]?[0-9.]+$/)||!l.toUpperCase().match(/^[-]?[0-9.]+$/))return this.parent.getErrorStrings()[Xn.Value];for(var d=new e.Internationalization,h=parseInt(l,10),p=Math.pow(10,-1*h),c="",u=1;u<=h;u++)c+="0";var f=Math.round(this.parent.parseFloat(s)/p)*p;return t=isNaN(f)?this.parent.getErrorStrings()[Xn.Value]:d.formatNumber(f,{format:"$#,##0."+c+";($#,##0."+c+");$0."+c}),n&&(t=this.parent.tic+t+this.parent.tic),t},t.prototype.ComputeSMALL=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(t)||1===t.length||""===t[0])return""===t[0]&&""===t[1]?n[Xn.Num]:this.parent.formulaErrorStrings[Kn.InvalidArguments];if(t.length>2)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var i,a=[],o=[],s=[];if(!(0,e.isNullOrUndefined)(t[0])){var l=void 0;if(this.parent.isCellReference(t[0])){a=this.parent.getCellCollection(t[0]);for(var d=0;d<a.length;d++){if(l=this.parent.getValueFromArg(a[d]),n.indexOf(l)>-1)return l;o.push(l)}}else{if(l=this.parent.getValueFromArg(t[0]).split(this.parent.tic).join(""),n.indexOf(l)>-1)return l;o.push(l)}for(d=0;d<o.length;d++)""===o[d]||isNaN(this.parent.parseFloat(o[d]))||s.push(this.parent.parseFloat(o[d]));if(0===s.length&&((0,e.isNullOrUndefined)(o[0])||t[0].indexOf(this.parent.tic)>-1))return n[Xn.Value]}if(s=s.sort((function(e,t){return e-t})),!(0,e.isNullOrUndefined)(t[1])){if(this.parent.isCellReference(t[1])){if(""===(i=this.parent.getValueFromArg(t[1])))return n[Xn.Num];if(""===i.trim())return n[Xn.Value];i.toUpperCase()===this.parent.trueValue?i="1":i.toUpperCase()===this.parent.falseValue&&(i="0")}else i=this.parent.getValueFromArg(t[1]).split(this.parent.tic).join("");if(n.indexOf(i)>-1)return i;if(""===i.trim())return t[1].length>0?n[Xn.Value]:n[Xn.Num];if(isNaN(this.parent.parseFloat(i)))if(t[1].toUpperCase()===this.parent.trueValue)i="1";else{if(t[1].toUpperCase()!==this.parent.falseValue)return n[Xn.Value];i="0"}}var h=Number(i)<1?0:Math.floor(Number(i));return(0,e.isNullOrUndefined)(s[h-1])&&!isNaN(Number(h))?n[Xn.Num]:s[h-1]},t.prototype.ComputeLARGE=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(t)||1===t.length||""===t[0])return""===t[0]&&""===t[1]?n[Xn.Num]:this.parent.formulaErrorStrings[Kn.InvalidArguments];if(t.length>2)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var i,a=[],o=[],s=[];if(!(0,e.isNullOrUndefined)(t[0])){var l=void 0;if(this.parent.isCellReference(t[0])){a=this.parent.getCellCollection(t[0]);for(var d=0;d<a.length;d++){if(l=this.parent.getValueFromArg(a[d]),n.indexOf(l)>-1)return l;o.push(l)}}else{if(l=this.parent.getValueFromArg(t[0]).split(this.parent.tic).join(""),n.indexOf(l)>-1)return l;o.push(l)}for(d=0;d<o.length;d++)""===o[d]||isNaN(this.parent.parseFloat(o[d]))||s.push(this.parent.parseFloat(o[d]));if(0===s.length&&((0,e.isNullOrUndefined)(o[0])||t[0].indexOf(this.parent.tic)>-1))return n[Xn.Value]}if(s=s.sort((function(e,t){return t-e})),!(0,e.isNullOrUndefined)(t[1])){if(this.parent.isCellReference(t[1])){if(""===(i=this.parent.getValueFromArg(t[1])))return n[Xn.Num];if(""===i.trim())return n[Xn.Value];i.toUpperCase()===this.parent.trueValue?i="1":i.toUpperCase()===this.parent.falseValue&&(i="0")}else i=this.parent.getValueFromArg(t[1]).split(this.parent.tic).join("");if(n.indexOf(i)>-1)return i;if(""===i.trim())return t[1].length>0?n[Xn.Value]:n[Xn.Num];if(isNaN(this.parent.parseFloat(i)))if(t[1].toUpperCase()===this.parent.trueValue)i="1";else{if(t[1].toUpperCase()!==this.parent.falseValue)return n[Xn.Value];i="0"}}var h=Number(i)<1?0:Math.ceil(Number(i));return(0,e.isNullOrUndefined)(s[h-1])&&!isNaN(Number(h))?n[Xn.Num]:s[h-1]},t.prototype.ComputeCHOOSE=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if((0,e.isNullOrUndefined)(r)||""===r[0]&&1===r.length)return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(r.length<2)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var i,a,o=this.parent.getErrorStrings();if(a=r[0],(a=t.parent.getValueFromArg(a)).toUpperCase()===t.parent.trueValue?a="1":a.toUpperCase()===t.parent.falseValue&&(a="0"),i=a,o.indexOf(i)>-1)return i;if(this.parent.isCellReference(r[0])){if(r[0].indexOf(":")>-1)return o[Xn.Value]}else 2===(i=this.parent.removeTics(i)).split("%").length&&this.parent.isNumber(i.split("%")[0])&&(i=(.01*Number(i.split("%")[0])).toString());return(i=Math.floor(this.parent.parseFloat(i)))<1||isNaN(i)||(0,e.isNullOrUndefined)(r[i])?o[Xn.Value]:(""===(i=r[i])&&(i="0"),this.parent.isCellReference(i)?i.indexOf(":")>-1?o[Xn.Value]:this.parent.getValueFromArg(i):(i.indexOf(this.parent.tic)>-1&&(o.indexOf(i.split(this.parent.tic).join(""))>-1||this.parent.removeTics(i).match(/^(\d*\.\d+|\d+)\s*[-*/]\s*(\d*\.\d+|\d+)$/))&&(i=this.parent.removeTics(i)),(i=this.parent.removeTics(this.parent.getValueFromArg(i))).indexOf(this.parent.tic+this.parent.tic)>-1?i.replace(/""/g,this.parent.tic):(2===i.split("%").length&&this.parent.isNumber(i.split("%")[0])&&(i=(.01*Number(i.split("%")[0])).toString()),i)))},t.prototype.ComputeSUMIF=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;if(r[0].indexOf(":")<0&&!this.parent.isCellReference(r[0])||r[2]&&r[2].indexOf(":")<0&&!this.parent.isCellReference(r[2]))return this.parent.formulaErrorStrings[Kn.ImproperFormula];if(r.length>3||r.length<2)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var n=this.parent.computeSumIfAndAvgIf(e,!1);return"string"==typeof n&&(this.parent.formulaErrorStrings.indexOf(n)||this.parent.getErrorStrings().indexOf(n))?n:n[0]},t.prototype.ComputeABS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n=e,i="";if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(""===n[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];var a=n[0].split(this.parent.tic).join("").trim();if(""===a||n[0].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(a)))return this.parent.getErrorStrings()[Xn.Value];if(this.parent.isCellReference(n[0])){if(i=this.parent.getValueFromArg(n[0]),this.parent.getErrorStrings().indexOf(i)>-1)return this.parent.getErrorStrings()[Xn.Value];if(i===this.parent.trueValue&&(i="1"),""!==i&&i!==this.parent.falseValue||(i="0"),r=this.parent.parseFloat(i),isNaN(r)&&!this.parent.isNumber(i))return this.parent.getErrorStrings()[Xn.Value]}else{if((i=this.parent.getValueFromArg(n[0]).split(this.parent.tic).join())===this.parent.trueValue&&(i="1"),i===this.parent.falseValue&&(i="0"),this.parent.getErrorStrings().indexOf(i)>-1)return i;if(r=this.parent.parseFloat(i),isNaN(r)&&!this.parent.isNumber(i))return this.parent.getErrorStrings()[Xn.Value]}return Math.abs(r)},t.prototype.ComputeAVERAGE=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=!1;if(t.length){var a=t[t.length-1];"isSubtotal"===a?(i=!0,t.pop()):"isAggregate"===a&&(n=!0,t.pop())}if((0,e.isNullOrUndefined)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];for(var o=t,s=0;s<o.length;s++)if(o[s].indexOf(":")>-1&&o[s].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Xn.Value];return this.parent.calculateAvg(o,i,n)},t.prototype.ComputeAVERAGEIF=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;if(r[0].indexOf(":")<0&&!this.parent.isCellReference(r[0]))return this.parent.formulaErrorStrings[Kn.ImproperFormula];var n=this.parent.computeSumIfAndAvgIf(e,!0);return 0===n[1]||"NaN"===n[0].toString()?this.parent.formulaErrorStrings[Kn.Div]:"string"==typeof n&&(this.parent.formulaErrorStrings.indexOf(n)||this.parent.getErrorStrings().indexOf(n))?n:this.parent.parseFloat(n[0])/this.parent.parseFloat(n[1])},t.prototype.ComputeCONCATENATE=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];for(var i=t,a="",o="",s=0;s<i.length;s++){var l=i[s];if(this.parent.isCellReference(l)){if(l.indexOf(":")>-1){if(!this.isConcat)return n[Xn.Value];for(var d=this.parent.getCellCollection(l),h=0;h<d.length;h++){a+=this.parent.getValueFromArg(d[h])}}else{if(1===i.length&&i[0].indexOf(this.parent.tic)<0&&!Dr(i[0]))return n[Xn.Name];o=this.parent.getValueFromArg(l)}if(n.indexOf(o)>-1)return o}else if(l.startsWith(this.parent.tic)&&l.endsWith(this.parent.tic)&&l.indexOf('""')>-1?o=(o=l.substring(1,l.length-1)).replace(/""/g,'"'):(o=l.split(this.parent.tic).join(""),(this.parent.isNumber(o)||(0,e.isNullOrUndefined)(this.parent.isDate(o))||l.startsWith(" n"))&&(o=this.parent.getValueFromArg(l).split(this.parent.tic).join(""))),n.indexOf(o)>-1)return o;a+=o}return this.isConcat=!1,a},t.prototype.ComputeCONCAT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.isConcat=!0,this.ComputeCONCATENATE.apply(this,e)},t.prototype.ComputeMAX=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeMinMax(e,"max")},t.prototype.ComputeMIN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeMinMax(e,"min")},t.prototype.ComputeRAND=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===e.length&&""===e[0]&&(e.length=0),e.length>0?this.parent.formulaErrorStrings[Kn.WrongNumberArguments]:Math.random().toString()},t.prototype.ComputeAND=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;return(0,e.isNullOrUndefined)(t)||1===n.length&&""===n[0]?this.parent.formulaErrorStrings[Kn.InvalidArguments]:this.parent.computeAndOrNot(n,"and")},t.prototype.ComputeOR=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;return(0,e.isNullOrUndefined)(t)||1===n.length&&""===n[0]?this.parent.formulaErrorStrings[Kn.InvalidArguments]:this.parent.computeAndOrNot(n,"or")},t.prototype.ComputeNOT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;return(0,e.isNullOrUndefined)(t)||t.length>1||""===t[0]?this.parent.formulaErrorStrings[Kn.WrongNumberArguments]:this.parent.computeAndOrNot(n,"not")},t.prototype.ComputeFIND=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(r)||1===r.length)return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(r.length>3)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var a,o,s=function(e){var r=t.parent.getValueFromArg(e);return i.indexOf(r)>-1||t.parent.isCellReference(e)||(2===r.split("%").length&&t.parent.isNumber(r.split("%")[0])?r=(.01*Number(r.split("%")[0])).toString():e.indexOf(t.parent.tic)>-1&&(t.parent.removeTics(e).match(/^(\d*\.\d+|\d+)\s*[-*/]\s*(\d*\.\d+|\d+)$/)?r=t.parent.getValueFromArg(t.parent.removeTics(e)):r.indexOf(t.parent.tic+t.parent.tic)>-1&&(r=r.replace(/""/g,t.parent.tic)))),r};if(!(0,e.isNullOrUndefined)(r[0])){if(a=s(r[0]),i.indexOf(a)>-1)return a;this.parent.isCellReference(r[0])||(a=this.parent.removeTics(a))}if(!(0,e.isNullOrUndefined)(r[1])){if(o=s(r[1]),i.indexOf(o)>-1)return o;this.parent.isCellReference(r[1])||(o=this.parent.removeTics(o))}var l=1;if(!(0,e.isNullOrUndefined)(r[2])){if(l=s(r[2]),i.indexOf(l)>-1)return l;if(l.toUpperCase()===this.parent.trueValue?l="1":l.toUpperCase()===this.parent.falseValue&&(l="0"),this.parent.isCellReference(r[2])||(l=this.parent.removeTics(l)),l=this.parent.parseFloat(l),isNaN(l)||l<=0)return i[Xn.Value]}return(l=o.indexOf(a,l-1))<0?i[Xn.Value]:(Number(l)+Number(1)).toString()},t.prototype.ComputeINDEX=function(){for(var t,r,n=this,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];var o,s,l=this.parent.getErrorStrings();if(i.length&&"nestedFormulaTrue"===i[i.length-1]&&(t=!0,i.pop()),(0,e.isNullOrUndefined)(i)||1===i.length&&""===i[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(i.length<2||i.length>4)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(""===i[0])return l[Xn.Value];if(-1===i[0].indexOf(":"))return l[Xn.Ref];var d=function(t){if((0,e.isNullOrUndefined)(t)||""===t)return 1;var r=n.parent.getValueFromArg(t);return l.indexOf(r)>-1?r:(r.toUpperCase()===n.parent.trueValue?r="1":r.toUpperCase()===n.parent.falseValue&&(r="0"),r.indexOf(n.parent.tic)>-1&&(r=n.parent.removeTics(r),-1===t.indexOf(n.parent.tic)||""===r.trim())?l[Xn.Value]:(2===r.split("%").length&&n.parent.isNumber(r.split("%")[0])&&(r=(Number(r.split("%")[0])/100).toString()),r=parseInt(Number(r).toString(),10),isNaN(r)||r<0?l[Xn.Value]:(0===r&&(r=1),r)))};if(r=i[0],o=d(i[1]),l.indexOf(o.toString())>-1)return o.toString();if(s=d(i[2]),l.indexOf(s.toString())>-1)return s.toString();var h=r.indexOf(":"),p=this.parent.rowIndex(r.substring(0,h)),c=this.parent.rowIndex(r.substring(h+1)),u=this.parent.colIndex(r.substring(0,h)),f=this.parent.colIndex(r.substring(h+1));return o>c-p+1||s>f-u+1?l[Xn.Ref]:(o=p+o-1,s=u+s-1,""===(r=this.parent.getValueFromArg(this.getSheetReference(r)+this.parent.convertAlpha(s)+o))?0:t&&-1===l.indexOf(r)&&!this.parent.isNumber(r)&&r!==this.parent.trueValue&&r!==this.parent.falseValue?this.parent.tic+r+this.parent.tic:r)},t.prototype.getSheetReference=function(e){return 0===e.indexOf(this.parent.sheetToken)&&e.lastIndexOf(this.parent.sheetToken)>e.indexOf(this.parent.sheetToken)?e.substring(0,e.lastIndexOf(this.parent.sheetToken)+1):""},t.prototype.ComputeIFS=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if((0,e.isNullOrUndefined)(t)||1===n.length&&""===n[0]||n.length%2!=0)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];for(var i="",a="",o=0;o<n.length;o++){if(i=this.parent.getValueFromArg(n[o]),""===n[o])return this.parent.getErrorStrings()[Xn.NA];if(this.parent.getErrorStrings().indexOf(i)>-1)return i;if(i!==this.parent.trueValue&&i!==this.parent.falseValue)return this.parent.getErrorStrings()[Xn.Value];if(i===this.parent.trueValue)return this.parent.isCellReference(n[o+1].split(this.parent.tic).join(""))||n[o+1].includes(this.parent.arithMarker)?a=""===(a=this.parent.getValueFromArg(n[o+1]))?"0":a:(a=""===n[o+1]?"0":this.parent.getValueFromArg(n[o+1])).indexOf(this.parent.tic)>-1&&(a=a.split(this.parent.tic).join("")),o+=1,a;i===this.parent.falseValue&&(o+=1)}return this.parent.getErrorStrings()[Xn.NA]},t.prototype.ComputeCOUNTA=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i,a,o=!1;if(t.length){var s=t[t.length-1];"isSubtotal"===s?(o=!0,t.pop()):"isAggregate"===s&&(a=this.parent.parentObject.getActiveSheet(),i=!0,t.pop())}if((0,e.isNullOrUndefined)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];for(var l,d,h,p,c=t,u=0,f=0;f<c.length;f++)if(this.parent.isCellReference(c[f]))if(c[f].indexOf(":")>-1){l=this.parent.getCellCollection(c[f].split(this.parent.tic).join(""));for(var g=0;g<l.length;g++)i&&(ml(a,(p=r(l[g]))[0])||Al(a,p[1]))||(d=o?this.parent.getValueFromArg(l[g],null,null,!0):this.parent.getValueFromArg(l[g]),o&&d.includes("SUBTOTAL(")||d.length>0&&u++)}else{if(d=o?this.parent.getValueFromArg(c[f],null,null,!0):this.parent.getValueFromArg(c[f]),o&&d.includes("SUBTOTAL("))continue;d.length>0&&u++}else((h=this.parent.getValueFromArg(c[f]).split(this.parent.tic).join("")).length>0||0===h.length&&""===h.trim())&&u++;return u},t.prototype.ComputeAVERAGEA=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if((0,e.isNullOrUndefined)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];for(var n,i,a,o,s=t,l=0,d=0,h=0;h<s.length;h++)if(this.parent.isCellReference(s[h]))if(s[h].indexOf(":")>-1){n=this.parent.getCellCollection(s[h].split(this.parent.tic).join(""));for(var p=0;p<n.length;p++){if(i=this.parent.getValueFromArg(n[p]),i=this.processLogicalCellValue(i),this.parent.getErrorStrings().indexOf(i)>-1)return i;(0,e.isNullOrUndefined)(i)||""===i||(o=this.parent.parseFloat(i),l+=i=isNaN(o)?0:o,d+=1)}}else{if(i=this.parent.getValueFromArg(s[h]),i=this.processLogicalCellValue(i),this.parent.getErrorStrings().indexOf(i)>-1)return i;if((0,e.isNullOrUndefined)(i)||""===i)continue;o=this.parent.parseFloat(i),l+=i=isNaN(o)?0:o,d+=1}else{if(s[h].indexOf(this.parent.tic)>-1&&(isNaN(this.parent.parseFloat(s[h].split(this.parent.tic).join("")))||""===s[h].split(this.parent.tic).join("").trim()))return this.parent.getErrorStrings()[Xn.Value];if(s[h]=this.processLogicalCellValue(s[h]),a=this.parent.getValueFromArg(s[h].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(a)>-1)return a;l+=this.parent.parseFloat(a),d+=1}return 0===d?this.parent.getErrorStrings()[Xn.DivZero]:l/d},t.prototype.processLogicalCellValue=function(e){var t=e;return t.toUpperCase()===this.parent.trueValue?t="1":t.toUpperCase()===this.parent.falseValue&&(t="0"),t},t.prototype.ComputeSORT=function(){for(var t,r,n=this,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];i.length&&"nestedFormulaTrue"===i[i.length-1]&&(t=!0,i.pop());var o,s,l=i,d=[];if((0,e.isNullOrUndefined)(i)||""===i[0]||l.length>4)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];l[1]=l[1]?l[1]:"1",l[2]=l[2]?l[2]:"1",l[3]=l[3]?l[3]:"FALSE",l[0]=l[0].split("$").join("");var h=[];if(l[0].indexOf(":")>-1){var p=l[0].split(":");if(this.parent.isCellReference(p[0])&&this.parent.isCellReference(p[1])){var c=l[0].indexOf(":"),u=void 0,f=this.parent.rowIndex(this.parent.substring(l[0],0,c)),g=this.parent.colIndex(this.parent.substring(l[0],0,c)),m=this.parent.rowIndex(this.parent.substring(l[0],c+1,c+l[0].length-c-1)),v=this.parent.colIndex(this.parent.substring(l[0],c+1,c+l[0].length-c-1));if(f>m&&(u=m,m=f,f=u),g>v&&(u=v,v=g,g=u),this.parent.isCellReference(l[3])){if(l[3]=this.parent.getValueFromArg(l[3]).toUpperCase(),l[3]!==this.parent.trueValue&&l[3]!==this.parent.falseValue)if(dn(l[3]))l[3]=0===Number(l[3])?this.parent.falseValue:this.parent.trueValue;else{if(""!==l[3])return this.parent.getErrorStrings()[Xn.Value];l[3]=this.parent.falseValue}}else if(r=l[3].startsWith(this.parent.tic)&&l[3].endsWith(this.parent.tic),l[3]=this.parent.getValueFromArg(l[3]),l[3]=dn(l[3])?0===Number(l[3])?this.parent.falseValue:this.parent.trueValue:l[3].split(this.parent.tic).join("").toUpperCase(),l[3]!==this.parent.trueValue&&l[3]!==this.parent.falseValue)return this.parent.getErrorStrings()[r?Xn.Value:Xn.Name];if(this.parent.isCellReference(l[2])?(l[2]=this.parent.getValueFromArg(l[2]),l[2]=l[2]===this.parent.trueValue?"1":l[2]):(l[2]=this.parent.getValueFromArg(l[2]),l[2]=l[2]===this.parent.trueValue?"1":l[2].split(this.parent.tic).join("")),l[2]=dn(l[2])?Math.floor(Number(l[2])).toString():l[2],"1"!==l[2]&&"-1"!==l[2])return this.parent.getErrorStrings().indexOf(l[2])>-1?this.parent.getErrorStrings()[Xn.Name]:this.parent.getErrorStrings()[Xn.Value];var y="1"===l[2]?"Ascending":"Descending";if(this.parent.isCellReference(l[1])){if(l[1]=this.parent.getValueFromArg(l[1]),l[1]=dn(l[1])?Math.floor(Number(l[1])).toString():l[1]===this.parent.trueValue?"1":l[1]===this.parent.falseValue?"0":l[1],isNaN(this.parseDouble(l[1]))||(this.parseDouble(l[1])<1||(l[3]===this.parent.trueValue?m-f+1<this.parseDouble(l[1]):v-g+1<this.parseDouble(l[1]))))return this.parent.getErrorStrings()[Xn.Value]}else if(r=l[1].startsWith(this.parent.tic)&&l[1].endsWith(this.parent.tic),l[1]=this.parent.getValueFromArg(l[1]),l[1]=dn(l[1])?Math.floor(Number(l[1])).toString():l[1]===this.parent.trueValue?"1":l[1]===this.parent.falseValue?"0":l[1].split(this.parent.tic).join(""),isNaN(this.parseDouble(l[1]))?r:this.parseDouble(l[1])<1||(l[3]===this.parent.trueValue?m-f+1<this.parseDouble(l[1]):v-g+1<this.parseDouble(l[1])))return this.parent.getErrorStrings()[Xn.Value];var C="";0===l[0].indexOf("!")&&(C=(C=(C=l[0]).replace("!","")).indexOf("!"),C=l[0].substring(0,C+2)),l[0]=C+Ls(g)+f+":"+Ls(v)+m,s=this.parent.getCellCollection(l[0]);for(var b=0;b<s.length;b++)h.push(this.parent.getValueFromArg(s[b]));var x=[],S=[],w=[],I=[],E=[],N=v-g+1,R=function(e){e?"TRUE"===e.toUpperCase()||"FALSE"===e.toUpperCase()?(I.push(e),x.push(e)):isNaN(n.parseDouble(e))?(w.push(e),x.push(e)):(S.push(n.parseDouble(e)),x.push(n.parseDouble(e))):""===e&&(E.push(n.parseDouble(e).toString()),x.push(n.parseDouble(e).toString()))};if("TRUE"===l[3])for(b=0;b<N;b++)R(h[b+(this.parseDouble(l[1])-1)*N]);if("FALSE"===l[3])for(b=0;b<h.length;b++)R(h[b*N+this.parseDouble(l[1])-1]);for(var A=S.length>0?Sr.DataUtil.sort(S,null,Sr.DataUtil.fnSort(y)):[],k=w.length>0?Sr.DataUtil.sort(w,null,Sr.DataUtil.fnSort(y)):[],O=I.length>0?Sr.DataUtil.sort(I,null,Sr.DataUtil.fnSort(y)):[],F="Ascending"===y?A.concat(k,O,E):O.concat(k,A,E),T=[],D=0;D<F.length;D++)for(var L=0;L<x.length;L++)JSON.stringify(F[D])===JSON.stringify(x[L])&&-1===T.indexOf(L)&&T.push(L);if("TRUE"===l[3]){for(var P=f,M=0;P<=m;P++,M++){D=0;for(var B=0;D<T.length;D++,B++){var H=this.parent.getValueFromArg(C+Ls(T[D]+g)+P);if(t&&""!==H)d.push(H);else{H=""===H?"0":H,_=(_=this.parent.actCell).indexOf("!")>-1?_.substring(_.lastIndexOf("!")+1):_;var U=this.parent.rowIndex(_),V=this.parent.colIndex(_);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,H,U+M,V+B)}}}o=this.parent.getValueFromArg(C+Ls(T[0]+g)+f)}if("FALSE"===l[3]){for(D=0,M=0;D<T.length;D++,M++){var z=g;for(B=0;z<=v;z++,B++){var j=this.parent.getValueFromArg(C+Ls(z)+(T[D]+f));if(t&&""!==j)d.push(j);else{var _;j=""===j?"0":j,_=(_=this.parent.actCell).indexOf("!")>-1?_.substring(_.lastIndexOf("!")+1):_;V=this.parent.colIndex(_),U=this.parent.rowIndex(_);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,j,U+M,V+B)}}}o=this.parent.getValueFromArg(C+Ls(g)+(T[0]+f))}}}return t?d.join(","):""===o?"0":o},t.prototype.ComputeCOUNTIF=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=t;if((0,e.isNullOrUndefined)(t)||""===t[0]||2!==i.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(i[0].indexOf(":")<0&&!this.parent.isCellReference(i[0]))return this.parent.getErrorStrings()[Xn.Name];var a,o=0,s=[],l="equal";if(""===i[1])return 0;var d=i[1].startsWith(this.parent.tic)&&i[1].endsWith(this.parent.tic),h=this.parent.getANDComputedValue(i[1]),p=h.includes("*"),c="*"===h||"<>*"===h,u=p&&!c?h.replace(/\*/g,"").trim():h,f=!1;if(!d&&this.parent.isCellReference(u)&&(u=this.parent.getValueFromArg(u),f=!0),p&&!c){var g=h.indexOf("*");"*"===h[0]&&(u="*"+u),"*"===h[h.length-1]&&(u+="*"),g>0&&g<h.length-1&&(u=h.substring(0,g)+"*"+h.substring(g+1))}(h=u).startsWith("<=")?(l="lessEq",h=h.substring(2)):h.startsWith(">=")?(l="greaterEq",h=h.substring(2)):h.startsWith("<>")?(l="notEq",h=h.substring(2)):h.startsWith("<")?(l="less",h=h.substring(1)):h.startsWith(">")?(l="greater",h=h.substring(1)):h.startsWith("=")&&(l="equal",h=h.substring(1));var m=h.indexOf("*")>-1||h.indexOf("?")>-1;if((!d&&this.parent.isCellReference(h)&&!f||h.includes(this.parent.arithMarker)||h.includes(this.parent.getParseDecimalSeparator())&&!m)&&(h=this.parent.getValueFromArg(h)),i[0].indexOf(":")>-1&&this.parent.isCellReference(i[0])){n=this.parent.getCellCollection(i[0].split(this.parent.tic).join(""));for(var v=0;v<n.length;v++)a=this.parent.getValueFromArg(n[v]),m&&(a=this.parent.findWildCardValue(h.toLowerCase(),a.toLowerCase())),s.push(a),s.push(h),this.parent.processLogical(s,l)===this.parent.trueValue&&o++}return o},t.prototype.ComputeSUMIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.calculateIFS(e)},t.prototype.calculateIFS=function(t,r){var n=this;if((0,e.isNullOrUndefined)(t)||""===t[0]||t.length<2||t.length>127)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(3===t.length&&t[2].includes(this.parent.tic+this.parent.tic)){var i,a="",o=this.parent.getParseArgumentSeparator();return t[2].split(this.parent.tic+this.parent.tic).forEach((function(e){(e=e.trim().split(n.parent.tic).join(""))&&(i=n.parent.computeIfsFormulas([t[0],t[1],e],n.parent.falseValue,r).toString(),a+=(a?o:"")+i)})),a}return this.parent.computeIfsFormulas(t,this.parent.falseValue,r)},t.prototype.ComputeTEXT=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];r.length&&"nestedFormulaTrue"===r[r.length-1]&&(t=!0,r.pop());var i=r.length,a=r[0],o=r[1];if(2!==i)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var s=a,l=o;if(""===o)return this.parent.getValueFromArg(s);var d=new Date(1900,0,1,0,0,0),h=s+","+l,p=new e.Internationalization;if(this.parent.getErrorStrings().indexOf(h)>-1)return h;if(dn((s=this.parent.getValueFromArg(s)).split(this.parent.tic).join(""))&&(s=s.split(this.parent.tic).join("")),""===(l=o.startsWith('"')&&o.endsWith('"')?l.split(this.parent.tic).join(""):this.parent.getValueFromArg(l)))return"";""===s&&(l.length>0&&(l.toUpperCase().indexOf("M")>-1||l.toUpperCase().indexOf("D")>-1||l.toUpperCase().indexOf("Y")>-1||l.toUpperCase().indexOf("S")>-1||l.toUpperCase().indexOf("T")>-1)||l.toUpperCase().indexOf("H")>-1)&&(s=d.toString());var c=this.parseDouble(s);if(isNaN(c)&&null!==this.parent.isDate(new Date(s))&&(c=this.parent.toOADate(new Date(s))),d=Date.parse(s.split(this.parent.tic).join("")),!isNaN(c)||!isNaN(d))if(l.length>0&&-1===l.indexOf("#")&&(l.toUpperCase().indexOf("M")>-1||l.toUpperCase().indexOf("D")>-1||l.toUpperCase().indexOf("Y")>-1||l.toUpperCase().indexOf("S")>-1||l.toUpperCase().indexOf("T")>-1)||l.toUpperCase().indexOf("H")>-1){var u=(l=(l=l.split("Y").join("y").split("D").join("d").split("H").join("h")).split("S").join("s").split("m").join("M").split("AM/PM").join("tt")).split(""),f=!1,g=!1,m=0,v=0,y=0;for(m=0;m<u.length;){var C=u[m];"s"===C&&"M"===u[v]&&(u[v]="m","M"===u[v-1]&&(u[v-1]="m")),this.parent.isChar(C)?(v=m,"M"===C&&y++):y>1&&y++,"M"===C&&f&&(u[m]="m",g=!0),"h"===C?f=!0:this.parent.isChar(C)&&"M"!==C&&"h"!==C&&!g&&(f=!1,g=!1),m++}l=(l=String(u)).split(",").join("").split("\n").join(" ");var b=this.parent.fromOADate(c);0===c&&(b=d);var x=Ss(l);if(""===x){var S=sn(b);return this.parent.parentObject.getDisplayText({format:l,value:S})}s=p.getDateFormat({skeleton:x,type:"date"})(new Date(b.toString()))}else s=this.parent.parentObject.getDisplayText({format:l,value:c});return t?this.parent.tic+s+this.parent.tic:s},t.prototype.ComputeCOUNTIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.trueValue)},t.prototype.ComputeAVERAGEIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.calculateIFS(e,this.parent.trueValue)},t.prototype.ComputeMATCH=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r.slice(),a=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(i)||1===i.length&&""===i[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(i.length<2||i.length>3)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];i[0]=this.parent.getValueFromArg(r[0]);var o,s=i[0].indexOf(this.parent.tic)>-1;if(i[0]=i[0].split(this.parent.tic).join(""),a.indexOf(i[0])>-1)return i[0];if(""===i[0])return a[Xn.NA];if(isNaN(Number(i[0]))&&(s=!0),(0,e.isNullOrUndefined)(r[2]))i[2]="1";else{if(i[2]=this.parent.getValueFromArg(i[2]),i[2].indexOf(this.parent.tic)>-1&&isNaN(Number(i[2].split(this.parent.tic).join(""))))return a[Xn.Value];i[2].toUpperCase()===this.parent.trueValue?i[2]="1":i[2].toUpperCase()===this.parent.falseValue&&(i[2]="0")}o=parseFloat(i[2]),-1===[-1,0,1].indexOf(o)&&(o=0);var l,d=[],h=!1;if(i[1].indexOf(":")>-1||this.parent.isCellReference(i[1])){if("#REF!"===(l=this.parent.getCellCollection(i[1]))[0])return this.parent.getErrorStrings()[Xn.Name];for(var p=0;p<l.length;p++){var c=this.parent.getValueFromArg(l[p]);(c.indexOf(this.parent.tic)>-1||isNaN(Number(c)))&&(h=!0),d[p]=c.split(this.parent.tic).join("")}if(s&&!h||!s&&h)return a[Xn.NA]}else if(!(0,e.isNullOrUndefined)(i[1])&&i[1].includes(this.parent.tic+this.parent.tic)){i[1].split(this.parent.tic+this.parent.tic).forEach((function(e){(e=e.trim().split(t.parent.tic).join(""))&&d.push(e)}))}for(var u=0,f="",g=!1,m=isNaN(Number(i[0]))?i[0]:Number(i[0]),v=0;v<d.length;v++)if(""!==d[v]){if(-1===o&&(s||h))break;var y=isNaN(Number(d[v]))?d[v]:Number(d[v]);if(1===o)m===y?(u=v+1,g=!0,isNaN(Number(i[0]))&&(s=!1)):m>y&&!s&&!g&&(!f||y>(isNaN(Number(f))?f:Number(f)))&&(u=v+1,f=d[v]);else if(0===o){if((i[0].indexOf("*")>-1||i[0].indexOf("?")>-1)&&(d[v]=this.parent.findWildCardValue(i[0],d[v])),i[0]===d[v])return v+1}else if(-1===o){if(!(Number(d[v])>Number(d[v+1])||v===d.length-1))return a[Xn.NA];m===y?(u=v+1,m=void 0):m<y&&(!f||y<(isNaN(Number(f))?f:Number(f)))&&(u=v+1,f=d[v])}}else v===d.length-1&&d.pop();return s&&h&&1===o?d.length:u||a[Xn.NA]},t.prototype.ComputeLOOKUP=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;return(0,e.isNullOrUndefined)(n)||1===n.length&&""===n[0]?this.parent.formulaErrorStrings[Kn.WrongNumberArguments]:this.parent.computeLookup(n)},t.prototype.ComputeVLOOKUP=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;return this.parent.computeVHLookup(r,!0)},t.prototype.ComputeHLOOKUP=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;return this.parent.computeVHLookup(r)},t.prototype.ComputeSUBTOTAL=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(r.length<2)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(t=this.parent.getValueFromArg(r[0]).trim(),i.indexOf(t)>-1)return t;if(""===t.split(this.parent.tic).join("").trim())return i[Xn.Value];if(this.parent.isCellReference(r[0])||(t=this.parent.removeTics(t)),t.toUpperCase()===this.parent.trueValue?t="1":t.toUpperCase()===this.parent.falseValue?t="0":2===t.split("%").length&&this.parent.isNumber(t.split("%")[0])&&(t=(Number(t.split("%")[0])/100).toString()),t=this.parent.parseFloat(t),isNaN(t)||(1>t||t>11)&&(101>t||t>111))return i[Xn.Value];var a=r.slice(1,r.length);switch(t){case 1:case 101:t=this.ComputeAVERAGE.apply(this,a.concat(["isSubtotal"]));break;case 2:case 102:t=this.ComputeCOUNT.apply(this,a.concat(["isSubtotal"]));break;case 3:case 103:t=this.ComputeCOUNTA.apply(this,a.concat(["isSubtotal"]));break;case 4:case 104:t=this.ComputeMAX.apply(this,a.concat(["isSubtotal"]));break;case 5:case 105:t=this.ComputeMIN.apply(this,a.concat(["isSubtotal"]));break;case 6:case 106:t=this.ComputePRODUCT.apply(this,a.concat(["isSubtotal"]));break;case 7:case 107:t=this.ComputeDAY.apply(this,a);break;case 8:case 108:t=this.ComputeCONCAT.apply(this,a);break;case 9:case 109:t=this.ComputeSUM.apply(this,a.concat(["isSubtotal"]));break;case 10:case 110:t=this.ComputeAVERAGEA.apply(this,a);break;case 11:case 111:t=this.ComputeABS.apply(this,a);break;default:t=i[Xn.Value]}return t},t.prototype.ComputeRADIANS=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();return(0,e.isNullOrUndefined)(r)||""===r[0]&&1===r.length||2===r[0].split("!").length&&-1===r[0].indexOf(this.parent.tic)?this.parent.formulaErrorStrings[Kn.InvalidArguments]:r.length>1?this.parent.formulaErrorStrings[Kn.WrongNumberArguments]:r[0].indexOf(":")>-1||""===r[0].split(this.parent.tic).join("").trim()||"!"===r[0].split(this.parent.tic).join("").trim()||2===r[0].split("!").length?i[Xn.Value]:(t=this.parent.getValueFromArg(r[0]).trim(),i.indexOf(t)>-1?t:t.indexOf(this.parent.tic)>-1&&-1===r[0].indexOf(this.parent.tic)||t.split(this.parent.tic).length>3?i[Xn.Value]:(t.toUpperCase()===this.parent.trueValue?t="1":t.toUpperCase()===this.parent.falseValue?t="0":2===t.split("%").length&&this.parent.isNumber(t.split("%")[0])&&(t=(Number(t.split("%")[0])/100).toString()),t=this.parent.parseFloat(t.split(this.parent.tic).join("")),isNaN(t)?this.parent.isCellReference(r[0])||r[0].indexOf(this.parent.tic)>-1?i[Xn.Value]:i[Xn.Name]:t=Math.PI*t/180))},t.prototype.ComputeRANDBETWEEN=function(){for(var e,t,r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(1===n.length&&""===n[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(2!==n.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var a=this.parent.getErrorStrings(),o=function(e){var t;if(t=r.parent.getValueFromArg(e),a.indexOf(t)>-1)return t;if(r.parent.isCellReference(e)){if(""===t)t="0";else if(e.indexOf(":")>-1||t.match(/^(\d*\.\d+|\d+)\s*[+\-*/]\s*(\d*\.\d+|\d+)$/))return a[Xn.Value]}else{if(""===t)return a[Xn.NA];if(e.indexOf(r.parent.tic)>-1&&r.parent.removeTics(e).match(/^(\d*\.\d+|\d+)\s*[+*]\s*(\d*\.\d+|\d+)$/))return a[Xn.Value];if(t.indexOf(r.parent.tic)>-1&&(t=r.parent.removeTics(t)).indexOf(":")>-1){var n=t.split(":");if(!(n.length<=3))return a[Xn.Value];if(!r.parent.isNumber(n[0])||!r.parent.isNumber(n[1]))return a[Xn.Value];var i=Number(n[0])+Number(Number(n[1])/60);if(3===n.length){if(!r.parent.isNumber(n[2]))return a[Xn.Value];i+=Number(Number(n[2])/3600)}t=(i/24).toString()}2===t.split("%").length&&r.parent.isNumber(t.split("%")[0])&&(t=(.01*Number(t.split("%")[0])).toString())}return t=parseFloat(t),isNaN(t)?a[Xn.Value]:t};return t=o(n[1]),a.indexOf(t)>-1?t:(e=o(n[0]),a.indexOf(e)>-1?e:0===e&&0===t?"0":t<e?a[Xn.Num]:(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1)+e)))},t.prototype.ComputeSLOPE=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(r)||1===r.length&&""===r[0].trim())return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(2!==r.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(""===r[0]||""===r[1])return i[Xn.Value];var a=function(e){return e=-1===e.indexOf(t.parent.tic)?t.parent.getCellCollection(e.split(t.parent.tic).join("")):void 0},o=a(r[0].trim()),s=a(r[1].trim());if((0,e.isNullOrUndefined)(o)||(0,e.isNullOrUndefined)(s)||o.length<2&&s.length<2)return i[Xn.DivZero];if(o.length!==s.length)return i[Xn.NA];var l=function(e){e=t.getDataCollection(e);for(var r=0;r<e.length;r++)if(i.indexOf(e[r])>-1)return e[r].toString();return e};if(o=l(o),i.indexOf(o.toString())>-1)return o.toString();if(s=l(s),i.indexOf(s.toString())>-1)return s.toString();for(var d=0,h=0,p=0,c=0,u=0,f=0,g=s.length;f<g;++f)""!==s[f]&&"NaN"!==Number(s[f]).toString()&&""!==o[f]&&"NaN"!==Number(o[f]).toString()&&(d+=Number(s[f])*Number(o[f]),p+=Number(s[f]),c+=Number(o[f]),h+=Number(s[f])*Number(s[f]),u++);var m=((d-p*c/u)/(h-p*p/u)).toString();return"NaN"===m?i[Xn.DivZero]:m},t.prototype.ComputeINTERCEPT=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(r)||1===r.length&&""===r[0].trim())return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(2!==r.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(""===r[0]||""===r[1])return i[Xn.Value];var a=function(e){return e=-1===e.indexOf(t.parent.tic)?t.parent.getCellCollection(e.split(t.parent.tic).join("")):void 0},o=a(r[0].trim()),s=a(r[1].trim());if((0,e.isNullOrUndefined)(o)||(0,e.isNullOrUndefined)(s)||o.length<2&&s.length<2)return i[Xn.DivZero];if(o.length!==s.length)return i[Xn.NA];var l=function(e){e=t.getDataCollection(e);for(var r=0;r<e.length;r++)if(i.indexOf(e[r])>-1)return e[r];return e};if(o=l(o),i.indexOf(o.toString())>-1)return o.toString();if(s=l(s),i.indexOf(s.toString())>-1)return s.toString();var d,h=0,p=0,c=0,u=0,f=0,g=function(e){for(var t=0,r=s.length;t<r;++t)""!==o[t]&&"NaN"!==Number(o[t]).toString()&&""!==s[t]&&"NaN"!==Number(s[t]).toString()&&(e?(h+=Number(o[t]),p+=Number(s[t]),c++):(d=Number(s[t])-p,u+=d*(Number(o[t])-h),f+=d*d))};g(!0),h/=c,p/=c,g(!1);var m=(h-u/f*p).toString();return"NaN"===m?i[Xn.DivZero]:m},t.prototype.ComputeLN=function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();return(0,e.isNullOrUndefined)(r)||""===r[0]&&1===r.length?this.parent.formulaErrorStrings[Kn.InvalidArguments]:0===r.length||r.length>1?this.parent.formulaErrorStrings[Kn.WrongNumberArguments]:(t=this.parent.getValueFromArg(r[0]),i.indexOf(t)>-1?t:(t.toUpperCase()===this.parent.trueValue?t="1":t.toUpperCase()===this.parent.falseValue&&(t="0"),this.parent.isCellReference(r[0])||""!==(t=this.parent.removeTics(t)).trim()?(2===t.split("%").length&&this.parent.isNumber(t.split("%")[0])&&(t=(.01*Number(t.split("%")[0])).toString()),(t=this.parent.parseFloat(t))<=0?i[Xn.Num]:isNaN(t)?i[Xn.Value]:Math.log(t)):i[Xn.Value]))},t.prototype.ComputeISNUMBER=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;if(1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(1!==e.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var n=this.parent.isCellReference(r[0])?this.parent.getValueFromArg(r[0]):this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""));if(""===n.toString()||e.toString().startsWith(this.parent.tic))return!1;var i=this.parent.parseFloat(n);return!isNaN(i)},t.prototype.ComputeROUND=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!e.length||1===e.length||e.length>2)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var r=e;if(1===e.length){var n="TRUE"===r[0].split(this.parent.tic).join("")?"1":"FALSE"===r[0].split(this.parent.tic).join("")?"0":r[0];return isNaN(this.parent.parseFloat(n))?this.parent.formulaErrorStrings[Kn.InvalidArguments]:Math.round(this.parent.parseFloat(n)).toString()}var i=this.parent.getValueFromArg(r[0]);if(this.parent.getErrorStrings().indexOf(i)>-1)return i;var a=this.parent.getValueFromArg(r[1]);if(this.parent.getErrorStrings().indexOf(a)>-1)return a;a="TRUE"===a?"1":"FALSE"===a?"0":a,i=(i="TRUE"===i?"1":"FALSE"===i?"0":i).split(this.parent.tic).join(""),a=a.split(this.parent.tic).join("");var o=isNaN(Number(i))||""===i.trim(),s=isNaN(Number(a))||""===a.trim();if((r[0].indexOf('"')>-1||this.parent.isCellReference(r[0]))&&o||(r[1].indexOf('"')>-1||this.parent.isCellReference(r[1]))&&s)return this.parent.getErrorStrings()[Xn.Value];if(""===i&&""===a||""===i)return 0;var l,d=this.parent.parseFloat(i),h=this.parent.parseFloat(a);if(!isNaN(h)&&!isNaN(d)&&h>0)l=this.parent.parseFloat(this.preciseRound(d,h,"ROUND"));else{var p=Math.pow(10,-h);l=Math.round(d/p)*p}return l.toString()},t.prototype.preciseRound=function(e,t,r){var n=Math.pow(10,t),i=Math.abs(e)*n;return((e>=0?1:-1)*(("ROUND"===r?Math.round(i):"ROUNDDOWN"===r?Math.floor(i):Math.ceil(i))/n)).toFixed(t)},t.prototype.ComputePOWER=function(){for(var t,r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(n)||1===n.length&&""===n[0].trim())return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(n.length>2)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(""===n[0].trim()&&""===n[1].trim())return a[Xn.Num];var o=function(e){var t=r.parent.getValueFromArg(e);if(a.indexOf(t)>-1)return t;if(t.toUpperCase()===r.parent.trueValue?t="1":t.toUpperCase()===r.parent.falseValue&&(t="0"),t.indexOf(r.parent.tic)>-1&&(t=r.parent.removeTics(t),-1===e.indexOf(r.parent.tic)||""===t.trim()))return a[Xn.Value];if(2===t.split("%").length&&r.parent.isNumber(t.split("%")[0]))t=(Number(t.split("%")[0])/100).toString();else if(t.indexOf("/")>-1&&r.parent.isNumber(t.split("/").join("")))return a[Xn.Num];return t=r.parent.parseFloat(t),isNaN(t)?a[Xn.Value]:t},s=o(n[0]);if(a.indexOf(s)>-1)return s;var l=o(n[1]);return a.indexOf(l)>-1?l:isNaN(s)||isNaN(l)?a[Xn.Value]:0===s&&l<0?a[Xn.DivZero]:0===s&&0===l?a[Xn.Num]:(t=Math.pow(s,l),isNaN(t)||t===1/0?a[Xn.Num]:t.toString())},t.prototype.ComputeSQRT=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t[0];if(0===t.length||t.length>1||""===n)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(""===n.split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[Xn.Value];if(this.parent.isCellReference(n)){if((e=this.parent.getValueFromArg(n)||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Xn.Value]}else{if(n.indexOf(this.parent.tic)>-1&&(n.split(this.parent.tic).join("")===this.parent.trueValue||n.split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[Xn.Value];e=this.parent.getValueFromArg(n).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(e)>-1)return e;if(e=e===this.parent.trueValue?"1":e===this.parent.falseValue?"0":e,this.parent.parseFloat(e)<0)return this.parent.getErrorStrings()[Xn.Num];if(isNaN(this.parent.parseFloat(e))){var i={value:e};if(this.parent.parentObject.notify(ue,i),!i.isDate&&!i.isTime)return this.parent.getErrorStrings()[Xn.Value];e=i.updatedVal}return Math.sqrt(this.parent.parseFloat(e))},t.prototype.ComputeLOG=function(){for(var t,r,n=this,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];var o=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(i)||1===i.length&&""===i[0])return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(i.length>2)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var s=function(e){var t=n.parent.getValueFromArg(e);if(t===n.parent.trueValue?t="1":t===n.parent.falseValue&&(t="0"),!n.parent.isCellReference(e)&&""!==t){if(t.indexOf(n.parent.tic)>-1&&-1===o.indexOf(t.split(n.parent.tic).join(""))){if(""===(t=n.parent.removeTics(t)).trim())return o[Xn.Value];if(t.indexOf(":")>-1){var r=t.split(":");if(!(r.length<=3))return o[Xn.Value];if(!n.parent.isNumber(r[0])||!n.parent.isNumber(r[1]))return o[Xn.Value];var i=Number(r[0])+Number(Number(r[1])/60);if(3===r.length){if(!n.parent.isNumber(r[2]))return o[Xn.Value];i+=Number(Number(r[2])/3600)}t=(i/24).toString()}}2===t.split("%").length&&n.parent.isNumber(t.split("%")[0])&&(t=(.01*Number(t.split("%")[0])).toString())}return t};if(!(0,e.isNullOrUndefined)(i[0])){if(t=s(i[0]),o.indexOf(t)>-1)return t;t=this.parent.parseFloat(t)}if(r=10,!(0,e.isNullOrUndefined)(i[1])){if(r=s(i[1]),o.indexOf(r)>-1)return r;r=this.parent.parseFloat(r)}return t=Number(t),isNaN(t)||isNaN(r)?o[Xn.Value]:t<=0||r<=0?o[Xn.Num]:1===r?o[Xn.DivZero]:(Math.log(t)/Math.LN10/(Math.log(r)/Math.LN10)).toString()},t.prototype.ComputeTRUNC=function(){for(var t,r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=0,o=this.parent.getErrorStrings();if((0,e.isNullOrUndefined)(n)||""===n[0]&&1===n.length)return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(0===n.length||n.length>2)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];var s=function(e){var t=r.parent.getValueFromArg(e);if(o.indexOf(t)>-1)return t;if(t===r.parent.trueValue)t="1";else if(t===r.parent.falseValue)t="0";else if(!r.parent.isCellReference(e)){if(e.indexOf(r.parent.tic)>-1&&r.parent.removeTics(e).match(/^(\d*\.\d+|\d+)\s*[*]\s*(\d*\.\d+|\d+)$/))t=r.parent.getValueFromArg(r.parent.removeTics(e));else if(t.indexOf(r.parent.tic)>-1){if(""===(t=r.parent.removeTics(t)).trim())return o[Xn.Value];if(t.indexOf(":")>-1){var n=t.split(":");if(!(n.length<=3))return o[Xn.Value];if(!r.parent.isNumber(n[0])||!r.parent.isNumber(n[1]))return o[Xn.Value];var i=Number(n[0])+Number(Number(n[1])/60);if(3===n.length){if(!r.parent.isNumber(n[2]))return o[Xn.Value];i+=Number(Number(n[2])/3600)}t=(i/24).toString()}}2===t.split("%").length&&r.parent.isNumber(t.split("%")[0])&&(t=(.01*Number(t.split("%")[0])).toString())}return t};if(!(0,e.isNullOrUndefined)(n[0])){if(t=s(n[0]),o.indexOf(t)>-1)return t;if(t=this.parent.parseFloat(t),isNaN(t))return o[Xn.Value]}if(!(0,e.isNullOrUndefined)(n[1])){if(a=s(n[1]),o.indexOf(a)>-1)return a;if(a=this.parent.parseFloat(a),isNaN(a))return o[Xn.Value]}return a=Math.pow(10,Math.floor(a)),(((t=Number(t))<0?-1:1)*Math.floor(a*Math.abs(t))/a).toString()},t.prototype.ComputeEXP=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=this.parent.getErrorStrings();if(""===t[0]&&1===t.length)return this.parent.formulaErrorStrings[Kn.InvalidArguments];if(1!==t.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(""===t[0].split(this.parent.tic).join("").trim())return n[Xn.Value];if(e=this.parent.getValueFromArg(t[0]),n.indexOf(e)>-1)return e;if(e.indexOf(this.parent.tic)>-1&&(this.parent.isCellReference(t[0])||isNaN(Number(e.split(this.parent.tic).join("")))))return n[Xn.Value];if((e=e.split(this.parent.tic).join(""))===this.parent.trueValue)e="1";else if(e===this.parent.falseValue||""===e)e="0";else if(e.indexOf("%")>-1)e=(Number(e.split("%")[0])/100).toString();else if(e.indexOf(":")>-1)return"0";var i=this.parent.parseFloat(e);return isNaN(i)?n[Xn.Value]:i>709?n[Xn.Num]:Math.exp(i).toString()},t.prototype.ComputeGEOMEAN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,i,a,o,s=e,l=1,d=0,h=0,p=0;if(0===e.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(1===s.length&&""===s[0])return l.toString();for(n=0;n<s.length;n++)if(s[n].indexOf(":")>-1){if(s[0]===this.parent.tic)return this.parent.getErrorStrings()[Xn.Value];for(a=this.parent.getCellCollection(s[n].split(this.parent.tic).join("")),i=0;i<a.length;i++){if(o=(p=(h=this.parent.getValueFromArg(a[i])).split(this.parent.tic).join(""))===this.parent.trueValue||p===this.parent.falseValue,(r=this.parent.parseFloat(h))<=0)return this.parent.getErrorStrings()[Xn.Num];o||this.parent.getErrorStrings().indexOf(h)>-1||(isNaN(r)||(d++,l*=r))}}else{if(h=this.parent.getValueFromArg(s[n]),this.parent.getErrorStrings().indexOf(h)>-1)return h;var c=h.split(this.parent.tic).join("");if(h.indexOf('"')>-1&&isNaN(this.parent.parseFloat(c)))return this.parent.getErrorStrings()[Xn.Value];if(s[n]=s[n].startsWith("n")?s[n].slice(1):s[n],""===h&&""===s[n])return this.parent.getErrorStrings()[Xn.Num];if(("TRUE"===c||"FALSE"===c)&&this.parent.isCellReference(s[n]))continue;if(h.length>0){if(h="TRUE"===(h=h.indexOf('"')>-1?c:h).split(this.parent.tic).join("")?"1":"FALSE"===h.split(this.parent.tic).join("")?"0":h,!this.parent.isCellReference(s[n])&&isNaN(this.parent.parseFloat(h)))return this.parent.getErrorStrings()[Xn.Value];if((r=this.parent.parseFloat(h))<=0)return this.parent.getErrorStrings()[Xn.Num];isNaN(r)||(d++,l*=r)}}return d>0&&(l=Math.pow(l,1/d)),l.toString()},t.prototype.ComputeRSQ=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=0,n=e;if(2!==n.length)return this.parent.formulaErrorStrings[Kn.WrongNumberArguments];if(""===n[0]||""===n[1])return this.parent.getErrorStrings()[Xn.Value];if(n[0].includes('"')||n[1].includes('"'))return this.parent.getErrorStrings()[Xn.NA];if(-1===n[0].indexOf(":")&&Ir(n[0])&&-1===n[1].indexOf(":")&&Ir(n[1]))return this.parent.getErrorStrings()[Xn.DivZero];var i=this.parent.getCellCollection(n[0]),a=this.parent.getCellCollection(n[1]);if(i.length!==a.length)return this.parent.getErrorStrings()[Xn.NA];for(var o=this.getDataCollection(a),s=0;s<o.length;s++)if(this.parent.getErrorStrings().indexOf(o[s])>-1)return o[s];for(var l,d,h=this.getDataCollection(i),p=0;p<h.length;p++)if(this.parent.getErrorStrings().indexOf(h[p])>-1)return h[p];for(var c=0;c<o.length;c++)l=Number(o[c]),d=Number(h[c]),dn(l)&&dn(d)&&r++;if(r<=1)return this.parent.getErrorStrings()[Xn.DivZero];if(2===r)return 1;var u=this.getMeanArray(o,h),f=u[0],g=u[1],m=this.getCorrelation(o,h,f,g);return Math.pow(m,2)},t.prototype.getCorrelation=function(e,t,r,n){for(var i,a,o=0,s=0,l=0,d=0;d<e.length;d++)dn(e[d])&&dn(t[d])&&(o+=(a=Number(e[d])-r)*(i=Number(t[d])-n),s+=Math.pow(a,2),l+=Math.pow(i,2));return o/Math.sqrt(s*l)},t.prototype.getMeanArray=function(e,t){for(var r=0,n=0,i=0,a=0;a<e.length;a++)dn(e[a])&&dn(t[a])&&(n+=Number(e[a]),i+=Number(t[a]),r++);return[n/r,i/r]},t.prototype.getDataCollection=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t.push(this.parent.getValueFromArg(e[r]));return t},t.prototype.parseDouble=function(e){var t=this.parent.parseFloat(e.toString());return isNaN(t)?NaN:t},t.prototype.spreadsheetDisplayText=function(e){if(this.parent.parentObject&&this.parent.parentObject.element&&this.parent.parentObject.element.classList.contains("e-spreadsheet")&&this.parent.isCellReference(e)){var t=this.parent.parentObject.getIndexes(e);e=this.parent.parentObject.getDisplayText(this.parent.parentObject.getActiveSheet().rows[t.startIdx].cells[t.endIdx])}return e},t.prototype.spreadsheetFormat=function(e){if(this.parent.parentObject&&this.parent.parentObject.element&&this.parent.parentObject.element.classList.contains("e-spreadsheet")&&this.parent.isCellReference(e)){var t=this.parent.parentObject.getIndexes(e);e=this.parent.parentObject.getActiveSheet().rows[t.startIdx].cells[t.endIdx].format}return e},t}(),Es=function(){function t(e){this.emptyStr="",this.storedStringText=this.emptyStr,this.sheetToken="!",this.tokenAdd="a",this.tokenSubtract="s",this.tokenMultiply="m",this.tokenDivide="d",this.tokenLess="l",this.charEm="r",this.charEp="x",this.tokenGreater="g",this.tokenEqual="e",this.tokenLessEq="k",this.tokenGreaterEq="j",this.tokenNotEqual="o",this.tokenAnd="c",this.tokenEm="v",this.tokenEp="t",this.tokenOr=String.fromCharCode(126),this.charAnd="i",this.charLess="<",this.charGreater=">",this.charEqual="=",this.charLessEq="f",this.charGreaterEq="h",this.charNoEqual="z",this.stringGreaterEq=">=",this.stringLessEq="<=",this.stringNoEqual="<>",this.stringAnd="&",this.stringOr="^",this.charOr="w",this.charAdd="+",this.charSubtract="-",this.charMultiply="*",this.charDivide="/",this.fixedReference="$",this.spaceString=" ",this.ignoreBracet=!1,this.isError=!1,this.isFormulaParsed=!1,this.findNamedRange=!1,this.stringsColl=new Map,this.tokens=[this.tokenAdd,this.tokenSubtract,this.tokenMultiply,this.tokenDivide,this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual,this.tokenAnd,this.tokenOr],this.charNOTop=String.fromCharCode(167),this.specialSym=["~","@","#","?"],this.isFailureTriggered=!1,this.parent=e}return t.prototype.parse=function(t,r){var n=this;if(this.parent.isTextEmpty(t))return t;if(ws(t))return this.parent.getErrorStrings()[Xn.Ref];this.parent.getFormulaCharacter()!==String.fromCharCode(0)&&this.parent.getFormulaCharacter()===t[0]&&(t=t.substring(1)),(this.parent.namedRanges.size>0||this.parent.storedData.size>0)&&(t=this.checkForNamedRangeAndKeyValue(t),this.findNamedRange=!1),t=(t=t.replace(/[-+*/&^]+/g,(function(e){for(var t="";1<e.length;)switch(e.substring(0,2)){case"++":case"--":e="+"+e.substring(2);break;case"+-":case"-+":e="-"+e.substring(2);break;case"*+":e="*"+e.substring(2);break;case"/+":e="/"+e.substring(2);break;case"^+":e="^"+e.substring(2);break;case"&+":e="&"+e.substring(2);break;case"*-":case"/-":case"^-":case"&-":t=e.substring(0,1),e=e.substring(1);break;default:throw new Fs(n.parent.formulaErrorStrings[Kn.InvalidExpression],!0)}return t+e}))).split("-(-").join("(");var i=this.storeStrings(t);t=this.storedStringText;var a=0;if((0,e.isNullOrUndefined)(i)&&(t=t.split(" ").join("")),(t=(t=t.split("=>").join(">=")).split("=<").join("<="))[t.length-1]===this.parent.arithMarker&&this.indexOfAny(t,this.tokens)===t.length-2||(t=t.toUpperCase()),t.indexOf(this.sheetToken)>-1){var o=this.parent.getSheetFamilyItem(this.parent.grid);if(null!=o.sheetNameToParentObject&&o.sheetNameToParentObject.size>0){t[0]!==this.sheetToken.toString()&&(t=this.parent.setTokensForSheets(t));var s=this.parent.getSheetToken(t.split(this.parent.tic).join(this.emptyStr)),l=this.checkScopedRange(t.split('"').join(this.emptyStr).split(this.sheetToken).join(""));(0,e.isNullOrUndefined)(s)&&""!==s&&this.parent.namedRanges.size>0&&""!==l&&(t=l)}}t=this.markLibraryFormulas(t);try{t=this.formulaAutoCorrection(t)}catch(e){if(!(p={message:e.message,exception:e,isForceCalculable:e.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[Kn.InvalidExpression];if(this.isFailureTriggered||(this.parent.trigger("onFailure",p),this.isFailureTriggered=!0),!p.isForceCalculable||!p.computeForceCalculate)throw this.parent.formulaErrorStrings[Kn.InvalidExpression];t=this.formulaAutoCorrection(t,p),this.parent.storedData.get(r).formulaText="="+t}if(!this.ignoreBracet)for(a=t.indexOf(")");a>-1;){var d=t.substring(0,a).lastIndexOf("(");if(-1===d)throw new Fs(this.parent.formulaErrorStrings[Kn.MismatchedParentheses]);if(d===a-1)throw new Fs(this.parent.formulaErrorStrings[Kn.EmptyExpression]);var h=this.emptyStr;h=this.ignoreBracet?this.parent.substring(t,d,a-d+1):this.parent.substring(t,d+1,a-d-1);try{t=t.substring(0,d)+this.parseSimple(h)+t.substring(a+1)}catch(e){if(e===this.parent.formulaErrorStrings[Kn.CircularReference])throw e;var p=this.exceptionArgs(e);this.isFailureTriggered||(this.parent.trigger("onFailure",p),this.isFailureTriggered=!0);var c="string"==typeof p.exception?p.exception:p.message;return(this.parent.getErrorLine(e)?"":"#"+this.parent.getErrorLine(e)+": ")+c}a=t.indexOf(")")}if(!this.ignoreBracet&&t.indexOf("(")>-1)throw new Fs(this.parent.formulaErrorStrings[Kn.MismatchedParentheses]);return t=this.parseSimple(t),null!==i&&i.size>0&&(t=this.setStrings(t,i)),t},t.prototype.exceptionArgs=function(e){return{message:e.message,exception:e,isForceCalculable:e.formulaCorrection,computeForceCalculate:!1}},t.prototype.formulaAutoCorrection=function(t,r,n){var i=["*","+","-","/","^","&"],a=[">","=","<"],o=0,s="",l="",d="",h="",p="",c="",u="",f=0;if(this.parent.formulaErrorStrings.indexOf(t)>-1)return t;if(this.indexOfAny(t,this.specialSym)>-1)throw new Fs(this.parent.formulaErrorStrings[Kn.InvalidExpression],!1);for(;o<t.length;)if(t=t.split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"),this.parent.isDigit(t[o])&&t.length>o+1&&this.indexOfAny(t[o+1],i)>-1&&t.length>o+2&&!(0,e.isNullOrUndefined)(t[o+2])&&this.indexOfAny(t[o+2],i)>-1&&("-"!==t[o+2]||"*"!==t[o+1]&&"/"!==t[o+1]&&"^"!==t[o+1]&&"&"!==t[o+1])){if(!r||!r.computeForceCalculate)throw this.parent.formulaErrorStrings[Kn.ImproperFormula];this.parent.isDigit(t[o])?(f<1?(c=t[o],d=t[o+1],(0,e.isNullOrUndefined)(d)&&(d=this.emptyStr),f+=1,s=s+c+(d="&"===d?"":d)):f<2&&(u=t[o],h=t[o-1],p=t[o+1],f=0,s="-"===h?s+h+u+(p="&"===(p=(0,e.isNullOrUndefined)(p)?this.emptyStr:p)?"":p):s+u+(p=(0,e.isNullOrUndefined)(p)?this.emptyStr:p)),o+=2):(s="-"===t[o]?s+t[o]:s,o+=1)}else if((this.parent.isDigit(t[o])||t[o]===this.parent.rightBracket||this.parent.storedData.has(t[o].toUpperCase()))&&((0,e.isNullOrUndefined)(t[o+1])||this.indexOfAny(t[o+1],i)>-1&&"&"!==t[o+1]))l="&"===(l=(0,e.isNullOrUndefined)(t[o+1])?this.emptyStr:t[o+1])&&"-"!==t[o+2]?"":l,s="-"===t[o-1]?s+t[o-1]+t[o]+l:s+t[o]+l,o+=2;else if(this.indexOfAny(t[o],a)>-1&&!(0,e.isNullOrUndefined)(t[o-1])&&!(0,e.isNullOrUndefined)(t[o+1]))s+=t[o],o+=1;else if("q"===t[o])for(;t[o]!==this.parent.leftBracket;)s+=t[o],o+=1;else t[o]===this.parent.leftBracket||t[o]===this.parent.rightBracket||"{"===t[o]||"}"===t[o]||"("===t[o]||")"===t[o]||this.parent.isUpperChar(t[o])||t[o].indexOf(":")>-1||t[o]===this.parent.getParseArgumentSeparator()||"%"===t[o]&&this.parent.isDigit(t[o-1])||t[o]===this.parent.tic||" "===t[o]||t[o]===this.parent.getParseDecimalSeparator()||t[o]===this.sheetToken||"$"===t[o]||"_"===t[o]?(s+=t[o],o+=1):(this.parent.isDigit(t[o])&&(s="-"===t[o-1]?s+t[o-1]+t[o]:s+t[o]),"-"!==t[o]&&"+"!==t[o]||(s=(s+=t[o]).split("++").join("+").split("+-").join("-").split("-+").join("-")),"/"!==t[o]&&"*"!==t[o]&&"^"!==t[o]||(s+=t[o]),"&"!==t[o]||!n&&"q"===t.substring(o+1).trim()[0]||(s+=t[o]),o+=1);return s=s===this.emptyStr?t:s,this.indexOfAny(s[s.length-1],i)>-1&&(s=s.substring(0,s.length-1)),s=s.split("--").join("-").split("-+").join("-").split("+-").join("-")},t.prototype.checkScopedRange=function(t){var r=this,n=this.emptyStr,i="NaN",a=this.parent.getSheetID(this.parent.grid),o=this.parent.getSheetFamilyItem(this.parent.grid);if(t[0]===this.sheetToken.toString()){var s=t.indexOf(this.sheetToken,1),l=parseInt(t.substr(1,s-1),10);s>1&&!this.parent.isNaN(l)&&(t=t.substring(s+1),a=l)}var d="!"+a.toString();return null===o||null==o.sheetNameToToken||o.sheetNameToToken.forEach((function(a,s){if(o.sheetNameToToken.get(s).toString()===d+"!"){var l=r.emptyStr;r.parent.namedRanges.forEach((function(a,s){l=(0,e.isNullOrUndefined)(r.parent.parentObject)?o.sheetNameToToken.get(s).toUpperCase():r.parent.parentObject.getActiveSheet().name+r.sheetToken+t.toUpperCase(),r.parent.getNamedRanges().has(l)&&(n=r.parent.getNamedRanges().get(l).toUpperCase(),i=n)}))}})),i},t.prototype.storeStrings=function(e){var t,r=0,n=0,i=0,a="",o=null;if(e.indexOf(this.parent.tic)>-1)for(r=e.indexOf(this.parent.tic);r>-1&&e.length>0;){if(null===o&&(o=this.stringsColl),-1===(n=r+1<e.length?e.indexOf(this.parent.tic,r+1):-1))throw new Fs(this.parent.formulaErrorStrings[Kn.MismatchedTics]);t=this.parent.substring(e,r,n-r+1),a=this.parent.tic+this.spaceString+i.toString()+this.parent.tic,o=o.set(a,t),e=e.substring(0,r)+a+e.substring(n+1),(r+=a.length)<=e.length&&(r=e.indexOf(this.parent.tic,r)),i++}return this.storedStringText=e,o},t.prototype.setStrings=function(e,t){for(var r=0;r<t.size;r++)t.forEach((function(t,r){e=e.split(r).join(t)}));return e},t.prototype.parseSimple=function(e){var t=e;if(t.length>0&&"+"===t[0]&&(t=t.substring(1)),"#DIV/0!"===t)return"#DIV/0!";if("#NAME?"===t)return"#NAME?";if(""===t)return t;if(this.parent.formulaErrorStrings.indexOf(t)>-1)return t;t=(t=(t=(t=(t=(t=t.split(this.stringLessEq).join(this.charLessEq)).split(this.stringGreaterEq).join(this.charGreaterEq)).split(this.stringNoEqual).join(this.charNoEqual)).split(this.stringAnd).join(this.charAnd)).split(this.stringOr).join(this.charOr)).split(this.fixedReference).join(this.emptyStr);var r=[this.tokenEp,this.tokenEm],n=[this.tokenMultiply,this.tokenDivide],i=[this.tokenAdd,this.tokenSubtract],a=[this.charMultiply,this.charDivide],o=[this.charAdd,this.charSubtract],s=[this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual],l=[this.charLess,this.charGreater,this.charEqual,this.charLessEq,this.charGreaterEq,this.charNoEqual],d=[this.charEp,this.charEm],h=[this.tokenAnd],p=[this.charAnd],c=[this.charOr],u=[this.tokenOr];return t=this.parseSimpleOperators(t,r,d),t=this.parseSimpleOperators(t,u,c),t=this.parseSimpleOperators(t,n,a),t=this.parseSimpleOperators(t,i,o),t=this.parseSimpleOperators(t,s,l),t=this.parseSimpleOperators(t,h,p)},t.prototype.parseSimpleOperators=function(t,r,n){if(this.parent.getErrorStrings().indexOf(t)>-1)return t;for(var i=t,a=0,o="",s=0;s<n.length;s++)o+=n[s];(i=(i=(i=i.split("---").join("-").split("--").join("+").split(this.parent.getParseArgumentSeparator()+"-").join(this.parent.getParseArgumentSeparator()+"u").split(this.parent.leftBracket+"-").join(this.parent.leftBracket+"u").split("=-").join("=u")).split(",+").join(",").split(this.parent.leftBracket+"+").join(this.parent.leftBracket).split("=+").join("=").split(">+").join(">").split("<+").join("<").split("/+").join("/").split("*+").join("*").split("++").join("+").split("*-").join("*u").split("/-").join("/u").split("w-").join("wu").split("i-").join("iu").toString()).split(">-").join(">u").split("<-").join("<u").split("h-").join("hu").split("f-").join("fu").split("z-").join("zu")).length>0&&"-"===i[0]?(i="0-"+(i=i.substring(1).split("-").join(this.tokenOr)),i=(i=this.parseSimpleOperators(i,[this.tokenSubtract],[this.charSubtract])).split(this.tokenOr).join("-")):i.length>0&&"+"===i[0]?i=i.substring(1):i.length>0&&"+"===i[i.length-1]&&(i=i.substring(0,i.length-1));try{if(this.indexOfAny(i,n)>-1){if(i.includes(" ")){for(var l="",d=0;d<i.length;d++){var h=i[d];if(n.indexOf(h)>=0)l=l.trim()+h;else{if(" "===h&&n.indexOf(l[l.length-1])>=0)continue;l+=h}}i=l}a=this.indexOfAny(i,n);for(var p=this.parent.getParseDecimalSeparator();a>-1;){var c="",u="",f=0,g=0,m=!1,v=["*","+","-","/","w","=","<",">"],y=i[a]===this.charNOTop,C=0;if(y)f=a;else if(i[C=a-1]===this.parent.arithMarker){if((x=this.findLeftMarker(i.substring(0,C-1)))<0)throw new Fs(this.parent.formulaErrorStrings[Kn.CannotParse]);c=this.parent.substring(i,x+1,C-x-1),f=x+1}else if(i[C]===this.parent.rightBracket){for(var b=0,x=C-1;x>0&&("q"!==i[x]||0!==b);)"q"===i[x]?b--:i[x]===this.parent.rightBracket&&b++,x--;if(x<0)throw new Fs(this.parent.formulaErrorStrings[Kn.CannotParse]);c=this.parent.substring(i,x,C-x+1),f=x}else if(i[C]===this.parent.tic[0]){var S=i.substring(0,C-1).lastIndexOf(this.parent.tic);if(S<0)throw new Fs(this.parent.formulaErrorStrings[Kn.CannotParse]);c=this.parent.substring(i,S,C-S+1),f=S}else{for(var w=!1;C>-1&&(this.parent.isDigit(i[C])||!w&&(i[C]===p||"%"===i[C]));)this.parent.isDigit(i[C])||"%"===i[C]||(w=!0),C-=1;if(C>-1&&w&&i[C]===p)throw new Fs(this.parent.formulaErrorStrings[Kn.NumberContains2DecimalPoints]);if(0===(C+=1)||C>0&&!this.parent.isUpperChar(i[C-1]))c="n"+this.parent.substring(i,C,a-C),f=C;else if(C>0&&"E"===i[C-1]&&("TRUE"===i.substring(C-4,C)&&((0,e.isNullOrUndefined)(i[C-5])||v.indexOf(i[C-5])>-1)||"FALSE"===i.substring(C-5,C)&&((0,e.isNullOrUndefined)(i[C-6])||v.indexOf(i[C-6])>-1))&&("TRUE"===i.substring(C+1,C+5)||"FALSE"===i.substring(C+1,C+6)))C="TRUE"===i.substring(C-4,C)?C-4:C-5,c="TRUE"===i.substring(C,a)?"n1":"FALSE"===i.substring(C,a)?"n0":c,f=C,m=!0;else{for(C-=1;C>-1&&(this.parent.isUpperChar(i[C])||this.parent.isDigit(i[C])||"_"===i[C]);)C-=1;if(C>-1&&i[C]===this.sheetToken){for(C-=1;C>-1&&i[C]!==this.sheetToken;)C-=1;C>-1&&i[C]===this.sheetToken&&(C-=1)}if(C>-1&&":"===i[C]){for(C-=1;C>-1&&this.parent.isDigit(i[C]);)C-=1;for(;C>-1&&this.parent.isUpperChar(i[C]);)C-=1;if(C>-1&&i[C]===this.sheetToken){for(C--;C>-1&&i[C]!==this.sheetToken;)C--;C>-1&&i[C]===this.sheetToken&&C--}C+=1,c=this.parent.substring(i,C,a-C),c=this.parent.getCellFrom(c)}else{var I=!1;C>0&&!this.parent.isUpperChar(i[C])&&(I="u"===i[C]&&i[C-1]===this.parent.getParseArgumentSeparator()),I||(C+=1),c=this.parent.substring(i,C,a-C)}this.parent.updateDependentCell(c),f=C}(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(c.toUpperCase())||this.parent.storedData.has(c.toUpperCase()))&&(c="n"+this.checkForNamedRangeAndKeyValue(c))}if(a===i.length-1)throw new Fs(this.parent.formulaErrorStrings[Kn.ExpressionCannotEndWithAnOperator]);if((I="u"===i[C=a+1])&&(C+=1),i[C]===this.parent.tic[0]){if((x=i.substring(C+1).indexOf(this.parent.tic))<0)throw this.parent.formulaErrorStrings[Kn.CannotParse];u=this.parent.substring(i,C,x+2),g=x+C+2}else if(i[C]===this.parent.arithMarker){if((x=this.findRightMarker(i.substring(C+1)))<0)throw new Fs(this.parent.formulaErrorStrings[Kn.CannotParse]);u=this.parent.substring(i,C+1,x),g=x+C+2}else if("q"===i[C]){for(b=0,x=C+1;x<i.length&&(i[x]!==this.parent.rightBracket||0!==b);)i[x]===this.parent.rightBracket?b++:"q"===i[x]&&b--,x++;if(x===i.length)throw this.parent.formulaErrorStrings[Kn.CannotParse];u=this.parent.substring(i,C,x-C+1),I&&(u="u"+u),g=x+1}else if(this.parent.isDigit(i[C])||i[C]===p){w=i[C]===p;for(C+=1;C<i.length&&(this.parent.isDigit(i[C])||!w&&i[C]===p);)i[C]===p&&(w=!0),C+=1;if(C<i.length&&"%"===i[C]&&(C+=1),w&&C<i.length&&i[C]===p)throw this.parent.formulaErrorStrings[Kn.NumberContains2DecimalPoints];u="n"+this.parent.substring(i,a+1,C-a-1),g=C}else if(this.parent.isUpperChar(i[C])||i[C]===this.sheetToken||"u"===i[C]){if(i[C]===this.sheetToken)for(C+=1;C<i.length&&i[C]!==this.sheetToken;)C+=1;C+=1;for(var E=0,N=!1;C<i.length&&(this.parent.isUpperChar(i[C])||"_"===i[C]||i[C]===p||"["===i[C]||"]"===i[C]||"#"===i[C]||" "===i[C]||"%"===i[C]||i[C]===p&&N);)C!==i.length-1&&"["===i[C]&&"["===i[C+1]&&(N=!0),C!==i.length-1&&"]"===i[C]&&"]"===i[C+1]&&(N=!1),C++,E++;var R=C===i.length||!this.parent.isDigit(i[C]);if(E>1){for(;C<i.length&&(this.parent.isUpperChar(i[C])||this.parent.isDigit(i[C])||" "===i[C]||"_"===i[C]);)C++;R=!0}for(;C<i.length&&this.parent.isDigit(i[C]);)C+=1;if(C<i.length&&":"===i[C]){if((C+=1)<i.length&&i[C]===this.sheetToken){for(C++;C<i.length&&i[C]!==this.sheetToken;)C+=1;C<i.length&&i[C]===this.sheetToken&&C++}for(;C<i.length&&this.parent.isUpperChar(i[C]);)C+=1;for(;C<i.length&&this.parent.isDigit(i[C]);)C+=1;C-=1,u=this.parent.substring(i,a+1,C-a),u=this.parent.getCellFrom(u)}else C-=1,u=this.parent.substring(i,a+1,C-a),(I="u"===i[C])&&(u="u"+u);R&&u.startsWith(this.sheetToken)&&(R=!this.parent.isCellReference(u)),R||this.parent.updateDependentCell(u),(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(u.toUpperCase())||this.parent.storedData.has(u.toUpperCase()))&&(u="n"+this.checkForNamedRangeAndKeyValue(u));var A=["*","+","-","/","w"].indexOf(i[C-u.length])>-1;u="TRUE"===u&&(m||A)?"n1":"FALSE"===u&&(m||A)?"n0":u,g=C+1}var k=o.indexOf(i[a]),O=this.parent.arithMarker+c+u+r[k]+this.parent.arithMarker;f>0&&(O=i.substring(0,f)+O),g<i.length&&(O+=i.substring(g)),i=O=O.split(this.parent.arithMarker2).join(this.parent.arithMarker.toString()),a=this.indexOfAny(i,n)}}else if(i.length>0&&(this.parent.isUpperChar(i[0])||i[0]===this.sheetToken)){var F=!0,T=!0,D=!1,L=i.length;for(x=0;x<L;++x)if(i[x]===this.sheetToken){if(x>0&&!D)throw this.parent.getErrorStrings()[Xn.Ref];for(D=!0,x++;x<L&&this.parent.isDigit(i[x]);)x++;if(x===L||i[x]!==this.sheetToken){F=!1;break}}else{if(!T&&this.parent.isChar(i[x])){F=!1;break}if(!this.parent.isChar(i[x])&&!this.parent.isDigit(i[x])&&i[x]!==this.sheetToken){F=!1;break}T=this.parent.isUpperChar(i[x])}F&&this.parent.updateDependentCell(i)}return i}catch(e){if(e===this.parent.formulaErrorStrings[Kn.CircularReference])throw e;return e}},t.prototype.indexOfAny=function(e,t){for(var r=0;r<e.length;r++)if(t.indexOf(e[r])>-1)return r;return-1},t.prototype.findLeftMarker=function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var r=0,n=e.length-1;n>=0;--n)if(e[n]===this.parent.rightBracket)r--;else if(e[n]===this.parent.leftBracket)r++;else if(e[n]===this.parent.arithMarker&&0===r){t=n;break}return t},t.prototype.findRightMarker=function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var r=0,n=0;n<e.length;++n)if(e[n]===this.parent.rightBracket)r--;else if(e[n]===this.parent.leftBracket)r++;else if(e[n]===this.parent.arithMarker&&0===r){t=n;break}return t},t.prototype.parseFormula=function(t,r){if(t.length>0&&t[0]===this.parent.getFormulaCharacter()&&(t=t.substring(1)),t.indexOf("#REF!")>-1)return this.parent.getErrorStrings()[Xn.Ref];t.length>0&&"+"===t[0]&&(t=t.substring(1));try{this.isFailureTriggered=!1,this.isError=!1,t=this.parse(t.trim(),r),this.isFormulaParsed=!0}catch(r){var n=this.exceptionArgs(r);this.isFailureTriggered||(this.parent.trigger("onFailure",n),this.isFailureTriggered=!0);var i="string"==typeof n.exception?n.exception:n.message;t=((0,e.isNullOrUndefined)(this.parent.getErrorLine(r))?"":"#"+this.parent.getErrorLine(r)+": ")+i,this.isError=!0}return t},t.prototype.markLibraryFormulas=function(t){var r=0,n=t.indexOf(")");if(-1===n)t=this.markNamedRanges(t);else for(;n>-1;){for(var i=0,a=n-1;a>-1&&("("!==t[a]||0!==i);)")"===t[a]&&i++,a--;if(-1===a)throw new Fs(this.parent.formulaErrorStrings[Kn.MismatchedParentheses]);for(var o=a-1;o>-1&&this.parent.isChar(t[o]);)o--;var s=a-o-1,l=this.parent.substring(t,o+1,s);if(s>0&&!(0,e.isNullOrUndefined)(this.parent.getFunction(l))){var d=this.parent.substring(t,a,n-a+1),h=this.parent.getParseArgumentSeparator();if("AREAS"===l)this.ignoreBracet=!0;else if(this.ignoreBracet=!1,(l.includes("IFS")&&"COUNTIFS"!==l||"MATCH"===l)&&d.includes("{")){var p=d.indexOf("{"),c=this.parent.substring(d,p,d.indexOf("}")-p+1);d=d.split(c).join(c.split(h).join(this.parent.tic+this.parent.tic))}try{var u=void 0;d=d.split("(").join("").split(")").join(""),d="("+this.formulaAutoCorrection(d,u,!0)+")"}catch(e){if(!(u={message:e.message,exception:e,isForceCalculable:e.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[Kn.ImproperFormula];if(this.isFailureTriggered||(this.parent.trigger("onFailure",u),this.isFailureTriggered=!0,r+=1),u.computeForceCalculate=r>0||u.computeForceCalculate,!u.isForceCalculable)throw this.parent.formulaErrorStrings[Kn.ImproperFormula];if(!u.computeForceCalculate)throw this.parent.formulaErrorStrings[Kn.ImproperFormula];d=d.split("(").join("").split(")").join(""),d="("+this.formulaAutoCorrection(d,u)+")"}d=this.markNamedRanges(d),d=this.swapInnerParens(d),-1===(d=this.addParensToArgs(d)).lastIndexOf(h)&&d.length>2&&"("===d[0]&&")"===d[d.length-1]&&"{"!==d[1]&&"("!==d[1]&&(d=(d=d.substring(0,d.length-1)+"}"+d.substring(d.length-1))[0]+"{"+d.substring(1)),t=t.substring(0,o+1)+"q"+this.parent.substring(t,o+1,s)+d.split("(").join(this.parent.leftBracket).split(")").join(this.parent.rightBracket)+t.substring(n+1)}else{if(s>0)return this.parent.getErrorStrings()[Xn.Name];var f=this.emptyStr;a>0&&(f=t.substring(0,a)),f=f+"{"+this.parent.substring(t,a+1,n-a-1)+"}",n<t.length&&(f+=t.substring(n+1)),t=f=this.markNamedRanges(f)}n=t.indexOf(")")}return t=t.split("{").join("(").split("}").join(")")},t.prototype.swapInnerParens=function(e){return e.length>2&&(e=e[0]+e.substr(1,e.length-2).split("(").join("{").split(")").join("}")+e[e.length-1]),e},t.prototype.addParensToArgs=function(e){if(0===e.length)return this.emptyStr;var t=[];t.push(this.parent.getParseArgumentSeparator()),t.push(this.parent.rightBracket);var r=e.lastIndexOf(this.parent.getParseArgumentSeparator()),n=0;if(-1===r){if(e.length>2&&"("===e[0]&&")"===e[e.length-1])if("{"!==e[1]&&"("!==e[1])e=(e=e.substring(0,e.length-1)+"}"+e.substring(e.length-1))[0]+"{"+e.substring(1);else{r=this.lastIndexOfAny(e,["+","-","*","/"]),0===n&&")"===e[e.length-1]&&(n=e.length-1),n>0&&"{"!==e[r+1]&&"}"===e[r-1]&&(e=(e=e.substr(0,n)+"}"+e.substr(n)).substr(0,r+1)+"{"+e.substr(r+1))}}else for(var i=!0;r>-1;){var a=this.indexOfAny(e.substring(r+1,e.length),t);a>=0?a=r+a+1:-1===a&&")"===e[e.length-1]&&(a=e.length-1),a>0&&"{"!==e[r+1]&&"}"!==e[a-1]&&""!==e[a-1]&&(e=(e=e.substr(0,a).trim()+"}"+e.substr(a)).substr(0,r+1)+"{"+e.substr(r+1).trim()),r=e.substr(0,r).lastIndexOf(this.parent.getParseArgumentSeparator()),i&&-1===r&&"("===e[0]&&(r=0,i=!1)}return e=e.split("{}").join(this.emptyStr)},t.prototype.lastIndexOfAny=function(e,t){for(var r=e.length-1;r>-1;r--)if(t.indexOf(e[r])>-1)return r;return-1},t.prototype.markNamedRanges=function(t){var r=[")",this.parent.getParseArgumentSeparator(),"}","+","-","*","/","<",">","=","&",":"],n=t.length>0&&("("===t[0]||"{"===t[0])?1:0;t.indexOf("#N/A")>-1&&(t=t.split("#N/A").join("#N~A")),t.indexOf("#DIV/0!")>-1&&(t=t.split("#DIV/0!").join("#DIV~0!"));for(var i=this.indexOfAny(t.substring(n),r);i>-1&&i+n<t.length;){var a=this.emptyStr,o=null;if(this.parent.substring(t,n,i).indexOf("[")>-1?o=this.getTableRange(this.parent.substring(t,n,i)):(this.parent.storedData.has(this.parent.substring(t,n,i))||this.parent.namedRanges.has(this.parent.substring(t,n,i)))&&(o=this.checkForNamedRangeAndKeyValue(this.parent.substring(t,n,i))),(0,e.isNullOrUndefined)(o)&&("NaN"!==(a=this.checkScopedRange(this.parent.substring(t,n,i)))?(this.findNamedRange=!0,o=a):this.parent.substring(t,n,i).startsWith(this.sheetToken.toString()),!(0,e.isNullOrUndefined)(o)&&this.findNamedRange&&o.indexOf(this.fixedReference)>-1&&(o=o.split(this.fixedReference).join(this.emptyStr))),(0,e.isNullOrUndefined)(o)||(o=o.toUpperCase(),o=this.parent.setTokensForSheets(o),o=this.markLibraryFormulas(o)),(0,e.isNullOrUndefined)(o)||o===this.emptyStr)for(n+=i+1;n<t.length&&!this.parent.isUpperChar(t[n])&&t[n]!==this.sheetToken;)n++;else t=t.substring(0,n)+o+t.substring(n+i),n+=o.length+1;for(i=n,n<t.length-1&&"{"===t[n]&&(n+=1),i=this.indexOfAny(t.substring(n),r);0===i&&n<t.length-1;)n++,i=this.indexOfAny(t.substring(n),r);if((-1===i||t.substring(n).indexOf("[")>-1)&&n<t.length){if(o=t.substring(n).indexOf("[")>-1?this.getTableRange(t.substring(n)):this.parent.storedData.has(t.substring(n))?this.parent.storedData.size>0?this.checkForNamedRangeAndKeyValue(t.substring(n)):o:this.parent.namedRanges.size>0?this.checkForNamedRangeAndKeyValue(t.substring(n)):o,(0,e.isNullOrUndefined)(o)&&"NaN"!==(a=this.checkScopedRange(t.substring(n)))&&(o=a),!(0,e.isNullOrUndefined)(o)&&o!==this.emptyStr&&(o=o.toUpperCase(),o=this.parent.setTokensForSheets(o),null!=(o=this.markLibraryFormulas(o)))){var s=t.substring(n);t=")"===s[s.length-1]?t.substring(0,n)+o+")":t.substring(0,n)+o,n+=o.toString().length+1}i=n<t.length?this.indexOfAny(t.substring(n),r):-1}}return t.indexOf("#N~A")>-1&&(t=t.split("#N~A").join("#N/A")),t.indexOf("#DIV~0!")>-1&&(t=t.split("#DIV~0!").join("#DIV/0!")),t},t.prototype.checkForNamedRangeAndKeyValue=function(t){var r=this.emptyStr;if(t.indexOf("[")>-1){var n=this.getTableRange(t);(0,e.isNullOrUndefined)(n)||(this.findNamedRange=!0,t=n)}if("NaN"!==(r=this.checkScopedRange(t)))this.findNamedRange=!0,t=r;else{if(t.indexOf(this.sheetToken)>-1){var i=this.parent.getSheetFamilyItem(this.parent.grid),a=t.split('"').join(this.emptyStr);if(a=a.substr(0,a.indexOf(this.sheetToken)),i.sheetNameToToken.has(a.toUpperCase()))parseInt(i.sheetNameToToken.get(a.toUpperCase()).split(this.sheetToken).join(this.emptyStr))}this.parent.storedData.size>0&&this.parent.storedData.has(t)&&(t="A"+this.parent.colIndex(t)),this.parent.namedRanges.size>0&&this.parent.namedRanges.has(t.toUpperCase())&&((0,e.isNullOrUndefined)(this.parent.parentObject)?(t=this.parse(this.parent.namedRanges.get(t.toUpperCase())),(t=this.parent.setTokensForSheets(t)).indexOf(this.fixedReference)>-1&&t.split(this.fixedReference).join(this.emptyStr),this.findNamedRange=!0):t=this.parse(this.parent.namedRanges.get(t.toUpperCase()))),this.findNamedRange&&"!"!==t[0]&&"q"!==t[0]&&"bq"!==t[0]&&(t=this.parent.setTokensForSheets(t)).indexOf(this.fixedReference)>-1&&(t=t.split(this.fixedReference).join(this.emptyStr))}return t},t.prototype.getTableRange=function(e){var t=(e=e.replace(" ",this.emptyStr).toUpperCase()).replace("]",this.emptyStr).replace("#DATA",this.emptyStr);t.indexOf(this.parent.getParseArgumentSeparator())>-1&&(t.substring(0,t.indexOf(this.parent.getParseArgumentSeparator())).replace("[",this.emptyStr),t=t.replace("[",this.emptyStr).replace(this.parent.getParseArgumentSeparator(),"_"));this.emptyStr;return t.toUpperCase()},t.prototype.findNextEndIndex=function(e,t){for(var r=0,n=t,i=!1;!i&&t<e.length;)"["===e[n]?r++:"]"===e[n]&&0===--r&&(i=!0),t++;return t-=n},t}(),Ns=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rs=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},As=1048576,ks=16384,Os=function(n){function a(t){var r=n.call(this,null,null)||this;return r.lFormulas=new Map,r.storedData=new Map,r.keyToRowsMap=new Map,r.rowsToKeyMap=new Map,r.rightBracket=String.fromCharCode(161),r.leftBracket=String.fromCharCode(162),r.sheetToken="!",r.emptyString="",r.leftBrace="{",r.rightBrace="}",r.cell=r.emptyString,r.cellPrefix="!0!A",r.treatEmptyStringAsZero=!1,r.tic='"',r.singleTic="'",r.trueValue="TRUE",r.falseValue="FALSE",r.parseDecimalSeparator=".",r.arithMarker=String.fromCharCode(180),r.arithMarker2=r.arithMarker+r.arithMarker,r.dependentCells=null,r.dependentFormulaCells=null,r.minValue=Number.MIN_SAFE_INTEGER,r.maxValue=Number.MAX_SAFE_INTEGER,r.categoryCollection=["All"],r.dependencyLevel=0,r.randomValues=new Map,r.isRandomVal=!1,r.randCollection=[],r.dependencyCollection=[],r.uniqueRange=[],r.formulaErrorStrings=["binary operators cannot start an expression","cannot parse","bad library","invalid char in front of","number contains 2 decimal points","expression cannot end with an operator","invalid characters following an operator","invalid character in number","mismatched parentheses","unknown formula name","requires a single argument","requires 3 arguments","invalid Math argument","requires 2 arguments","#NAME?","too complex","#CIRCULARREF!","missing formula","improper formula","invalid expression","cell empty","bad formula","empty expression","","mismatched string quotes","wrong number of arguments","invalid arguments","iterations do not converge","Control is already registered","Calculation overflow","Missing sheet","cannot_parse","expression_cannot_end_with_an_operator","#SPILL!","#DIV/0!"],r.errorStrings=null,r.parseArgumentSeparator=",",r.dateTime1900=new Date(1900,0,1,0,0,0),r.isParseDecimalSeparatorChanged=!1,r.isArgumentSeparatorChanged=!1,r.sheetFamilyID=0,r.defaultFamilyItem=null,r.sheetFamiliesList=null,r.modelToSheetID=null,r.tokenCount=0,r.sortedSheetNames=null,r.tempSheetPlaceHolder=String.fromCharCode(133),r.namedRanges=new Map,r.formulaInfoTable=null,r.millisecondsOfaDay=864e5,r.parseDateTimeSeparator="/",new Is(r),r.parentObject=(0,e.isNullOrUndefined)(t)?r:t,r.grid=r.parentObject,r.parser=new Es(r),r}return Ns(a,n),Object.defineProperty(a.prototype,"libraryFormulas",{get:function(){return this.lFormulas},set:function(e){this.lFormulas.set(e.fName,{handler:e.handler,category:e.category,description:e.description})},enumerable:!0,configurable:!0}),a.prototype.getParseArgumentSeparator=function(){return this.isArgumentSeparatorChanged||","===this.parseArgumentSeparator||(this.parseArgumentSeparator=","),this.parseArgumentSeparator},a.prototype.setParseArgumentSeparator=function(e){this.parseArgumentSeparator=e,this.isArgumentSeparatorChanged=!0},a.prototype.getParseDateTimeSeparator=function(){return this.parseDateTimeSeparator},a.prototype.setTreatEmptyStringAsZero=function(e){this.treatEmptyStringAsZero=e},a.prototype.getTreatEmptyStringAsZero=function(){return this.treatEmptyStringAsZero},a.prototype.setParseDateTimeSeparator=function(e){this.parseDateTimeSeparator=e},a.prototype.onPropertyChanged=function(e,t){},a.prototype.getModuleName=function(){return"calculate"},a.prototype.getFormulaCharacter=function(){return"="},a.prototype.isUpperChar=function(e){var t=e.charCodeAt(0);return t>64&&t<91},a.prototype.resetKeys=function(){this.storedData.clear(),this.keyToRowsMap.clear(),this.rowsToKeyMap.clear()},a.prototype.updateDependentCell=function(e){var t=this,r=this.cell;if(r!==this.emptyString){var n=this.getSheetFamilyItem(this.grid);if(n.sheetNameToParentObject&&(r.includes(this.sheetToken)||(r=n.parentObjectToToken.get(this.grid)+r),e.includes(this.sheetToken)||(e=n.parentObjectToToken.get(this.grid)+e)),r!==e){var i=this.getDependentCells();i.has(e)||i.set(e,[]);var a=i.get(e);if(-1===a.indexOf(r)){var o=this.getDependentFormulaCells(),s={},l=function(e){if(o.has(e)){var n=o.get(e);if(n.has(r))throw t.formulaErrorStrings[Kn.CircularReference];s[e]||(s[e]=!0,n.forEach((function(e){l(e)})))}};l(e),a.push(r),o.has(r)?o.get(r).has(e)||o.get(r).set(e,e):(o.set(r,new Map),o.get(r).set(e,e))}}}},a.prototype.getDependentCells=function(){return null==this.dependentCells&&(this.dependentCells=new Map),this.dependentCells},a.prototype.getDependentFormulaCells=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentFormulaCells&&(e.sheetDependentFormulaCells=new Map),e.sheetDependentFormulaCells}return null==this.dependentFormulaCells&&(this.dependentFormulaCells=new Map),this.dependentFormulaCells},a.prototype.getLibraryFormulas=function(){return this.lFormulas},a.prototype.getFunction=function(e){return this.getLibraryFormulas().has(e.toUpperCase())?this.getLibraryFormulas().get(e.toUpperCase()).handler:null},a.prototype.intToDate=function(e){var t=Number(e);(t=t>0&&t<1?1+t:0===t?1:t)>60&&(t-=1);var r=new Date("01/01/1900"),n=Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds());return new Date(new Date(864e5*(t-1)+n).toUTCString().replace(" GMT",""))},a.prototype.getFormulaInfoTable=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null===e.sheetFormulaInfotable&&(e.sheetFormulaInfotable=new Map),e.sheetFormulaInfotable}return null===this.formulaInfoTable&&(this.formulaInfoTable=new Map),this.formulaInfoTable},a.prototype.getParseDecimalSeparator=function(){return this.isParseDecimalSeparatorChanged||"."===this.parseDecimalSeparator||(this.parseDecimalSeparator="."),this.parseDecimalSeparator},a.prototype.setParseDecimalSeparator=function(e){this.parseDecimalSeparator=e,this.isParseDecimalSeparatorChanged=!0},a.prototype.getSheetToken=function(e){var t=0,r=this.emptyString;if(t<e.length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;r=e.substring(0,t+1)}if(t<e.length)return r;throw this.formulaErrorStrings[Kn.BadIndex]},a.prototype.getSheetID=function(e){var t=this.getSheetFamilyItem(e);if(null!=t.sheetNameToParentObject&&t.sheetNameToParentObject.size>0){var r=t.parentObjectToToken.get(e);if(r){r=r.split(this.sheetToken).join(this.emptyString);var n=this.parseFloat(r);if(!this.isNaN(n))return n}}return-1},a.prototype.parseFloat=function(e){var t=Number(e);return isNaN(t)&&"string"==typeof e&&e.includes(",")&&(t=Number(e.split(",").join(""))),t},a.prototype.rowIndex=function(e){var t=0,r=!1;if(t<e.length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;t++}for(;t<e.length&&this.isChar(e[t]);)r=!0,t++;var n=parseInt(e.substring(t),10);if(t<e.length&&!this.isNaN(n))return n;if(r)return-1;throw this.formulaErrorStrings[Kn.BadIndex]},a.prototype.colIndex=function(e){var t=0,r=0;if(t<(e=e.toUpperCase()).length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;t++}for(;t<e.length&&this.isChar(e[t]);){r=26*r+e[t].charCodeAt(0)-64,t++}return 0===r?-1:r},a.prototype.getErrorStrings=function(){return null===this.errorStrings&&(this.errorStrings=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!","#CALC!"]),this.errorStrings},a.prototype.substring=function(e,t,r){return e.substring(t,r+t)},a.prototype.isChar=function(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122},a.prototype.getSheetFamilyItem=function(e,t){return 0===this.sheetFamilyID?(null==this.defaultFamilyItem&&(this.defaultFamilyItem=new Ds),this.defaultFamilyItem):(null==this.sheetFamiliesList&&(this.sheetFamiliesList=new Map),void 0===t&&(t=this.modelToSheetID.get(e)),this.sheetFamiliesList.has(t)||this.sheetFamiliesList.set(t,new Ds),this.sheetFamiliesList.get(t))},a.prototype.setKeyValue=function(e,t){e=e.toUpperCase();var r=t.toString().trim();this.storedData.get(e)&&0!==r.indexOf(this.leftBrace)||(this.storedData.set(e,new Ts),this.keyToRowsMap.set(e,this.keyToRowsMap.size+1),this.rowsToKeyMap.set(this.rowsToKeyMap.size+1,e));var n=this.storedData.get(e);if(null!=n.getFormulaText()&&n.getFormulaText().length>0&&n.getFormulaText()!==r){var i=this.cellPrefix+this.keyToRowsMap.get(e).toString();null!=this.getDependentFormulaCells().get(i)&&this.clearFormulaDependentCells(i)}r.length>0&&r[0]===this.getFormulaCharacter()?n.setFormulaText(r):n.getFormulaValue()!==r&&(n.setFormulaText(""),n.setParsedFormula(""),n.setFormulaValue(r))},a.prototype.clearFormulaDependentCells=function(e){var t=this,r=this.getDependentFormulaCells().get(e);r&&(r.forEach((function(r,n){var i=n,a=t.getDependentCells().get(i);t.arrayRemove(a,e),0===a.length&&t.getDependentCells().delete(i)})),this.getDependentFormulaCells().delete(e))},a.prototype.arrayRemove=function(e,t){var r=e.indexOf(t);return-1!==r&&e.splice(r,1),e},a.prototype.getKeyValue=function(t){if(t=t.toUpperCase(),null!==this.storedData.has(t)){var r=this.storedData.get(t),n=r.getFormulaText();if(n.length>0&&n[0]===this.getFormulaCharacter()){this.cell=this.cellPrefix+this.keyToRowsMap.get(t).toString(),n=n.substring(1);try{r.setParsedFormula(this.parser.parseFormula(n,t))}catch(e){var i={message:e.message,exception:e,isForceCalculable:!1,computeForceCalculate:!1};return this.trigger("onFailure",i),r.setFormulaValue(i.message),this.storedData.get(t).getFormulaValue()}try{r.setFormulaValue(this.computeFormula(r.getParsedFormula()))}catch(t){i={message:t.message,exception:t,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",i);var a="string"==typeof i.exception?i.exception:i.message;return((0,e.isNullOrUndefined)(this.getErrorLine(t))?"":"#"+this.getErrorLine(t)+": ")+a}}return this.storedData.get(t).getFormulaValue()}return this.emptyString},a.prototype.getNamedRanges=function(){return this.namedRanges},a.prototype.addNamedRange=function(e,t){var r=e.split(this.sheetToken);if(r.length>1){var n=this.getSheetId(this.grid).toString();if(!this.getSheetFamilyItem(n).parentObjectToToken.get(n))return!1;e=r[0]+this.sheetToken+r[1].toUpperCase()}else e=e.toUpperCase();return this.namedRanges.set(e,t),!0},a.prototype.updateNamedRange=function(e,t){var r=new Map;this.namedRanges.forEach((function(n,i){var a=i;if(i.includes(e)){var o=i.split("!");o[0]=t,a=o.join("!")}r.set(a,n)})),this.namedRanges=r},a.prototype.removeNamedRange=function(e){return e=e.toUpperCase(),null!=this.namedRanges.get(e)&&(this.namedRanges.delete(e),!0)},a.prototype.convertAlpha=function(e){for(var t=[],r=0;e>0;){e--;var n="A".charCodeAt(0);t[r]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),r++}for(var i=[],a=0;a<r;a++)i[r-a-1]=t[a];return i.join("")},a.prototype.getCellCollection=function(e){if(e.indexOf(":")<0){if(!this.isCellReference(e))return e.split(this.getParseArgumentSeparator());e=e+":"+e}var t=this.emptyString,r=e.indexOf(this.sheetToken);if(r>-1)for(var n=r+1;n<e.length;){if(e[n]===this.sheetToken){t=e.substr(0,n+1);break}n++}var i,a,o,s,l=e.indexOf(":");if(l>0&&this.isChar(e[l-1]))for(var d=l-2;d>=0&&this.isDigit(e[d]);)d--;if(i=this.rowIndex(this.substring(e,0,l)),a=this.rowIndex(this.substring(e,l+1,l+e.length-l-1)),o=this.colIndex(this.substring(e,0,l)),s=this.colIndex(this.substring(e,l+1,l+e.length-l-1)),i>=As||a>=As||o>=ks||s>=ks)return[this.getErrorStrings()[Xn.Ref]];i>a&&(l=a,a=i,i=l),o>s&&(l=s,s=o,o=l);var h,p=[],c=0;for(l=i;l<=a;l++)for(h=o;h<=s;h++)p[c]=t+this.emptyString+this.convertAlpha(h)+l.toString(),c++;return p},a.prototype.computeFormula=function(e,t){return this.calculateFormula(e,!1,t)},a.prototype.calculateFormula=function(t,r,n){var i,a,o,s,l=this,d=!1;if(this.parser.isError)return t;i=this.parser.isFormulaParsed?t:this.parser.parseFormula(t),this.parser.isFormulaParsed=!1;try{if((a=this.findLastIndexOfq(i))>0&&(d=!0),i!==this.emptyString&&a>-1)for(var h=a+1,p=function(){if(i[h]!==c.rightBracket)return h++,"continue";var t=i.substring(a,h+1),p=t.split(c.leftBracket)[0].split("q").join(c.emptyString),u=void 0;if(c.getLibraryFormulas().get(p.toUpperCase()).isCustom){u=t.substring(t.indexOf(c.leftBracket)+1,t.indexOf(c.rightBracket)).split(c.getParseArgumentSeparator());var f=0,g=[],m=void 0;for(f=0;f<u.length;f++)u[f].includes(":")&&c.isCellReference(u[f])&&(m=c.getCellCollection(u[f])).length>1?(g.push(u[f]),m.forEach((function(e){l.updateDependentCell(e)}))):g.push(c.getValueFromArg(u[f]));u=g}else{var v=t.substring(t.indexOf(c.leftBracket)+1,t.indexOf(c.rightBracket));u=[];for(var y=c.getParseArgumentSeparator(),C="",b=void 0,x=0,S=v.length-1;x<=S;x++)'"'===v[x]&&(b=!b),v[x]!==y||b?(C+=v[x],x===S&&u.push(C)):(u.push(C),C="",x===S&&u.push(C));if(u.length||(u=[""]),d&&p){["IF","INDEX","SORT","T","EXACT","PROPER","DOLLAR","DATE","TEXT"].some((function(e){return e===p}))&&u.push("nestedFormulaTrue"),"IF"===p&&u.push("nestedFormulaTrue")}n&&"UNIQUE"===p&&u.push("isComputeExp")}if(o=(0,e.isNullOrUndefined)(c.getFunction(p))?c.getErrorStrings()[Xn.Name]:c.getFunction(p).apply(void 0,u),d){s=c.processNestedFormula(i,t,o);var w=c.findLastIndexOfq(s);return 0===w&&(d=!1),-1===w&&(o=c.computeValue(s,r)),a=h=w,i=s,"continue"}return"break"},c=this;h>-1;){if("break"===p())break}else this.formulaErrorStrings.indexOf(i)>-1?o=i:i!==this.emptyString&&-1===a&&(o=this.computeValue(i,r))}catch(t){var u={message:t.message,exception:t,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",u);var f="string"==typeof u.exception?u.exception:u.message;o=((0,e.isNullOrUndefined)(this.getErrorLine(t))?"":"#"+this.getErrorLine(t)+": ")+f}return o},a.prototype.computeSumIfAndAvgIf=function(t,r){if((0,e.isNullOrUndefined)(t)||t[0]===this.emptyString||0===t.length)return this.formulaErrorStrings[Kn.WrongNumberArguments];for(var n=t,i=0;i<n.length;i++)if(this.isCellReference(n[i])&&(0,e.isNullOrUndefined)(n[i].match(/[0-9]/))&&n[i].indexOf("!")<0){var a=n[i].split(":");n[i]=a[0]+"1:"+a[1]+this.spreadSheetUsedRange[0]}var o=n.length;if(2!==o&&3!==o&&0===o)return this.formulaErrorStrings[Kn.WrongNumberArguments];if(""===n[1])return r?this.getErrorStrings()[Xn.DivZero]:"0";var s=n[0],l=n[1].startsWith(this.tic)&&n[1].endsWith(this.tic),d=this.getANDComputedValue(n[1]);if(d.length>255)return this.getErrorStrings()[Xn.Value];var h=d.includes("*"),p=d.includes("?"),c=h?d.replace(/\*/g,"").trim():d,u=!1;if(!l&&this.isCellReference(c)&&(c=this.getValueFromArg(c),u=!0),h){var f=d.indexOf("*");"*"===d[0]&&(c="*"+c),"*"===d[d.length-1]&&(c+="*"),f>0&&f<d.length-1&&(c=d.substring(0,f)+"*"+d.substring(f+1))}d=c;var g=this.parser.tokenEqual;d.startsWith("<=")?(g=this.parser.tokenLessEq,d=d.substring(2)):d.startsWith(">=")?(g=this.parser.tokenGreaterEq,d=d.substring(2)):d.startsWith("<>")?(g=this.parser.tokenNotEqual,d=d.substring(2)):d.startsWith("<")?(g=this.parser.tokenLess,d=d.substring(1)):d.startsWith(">")?(g=this.parser.tokenGreater,d=d.substring(1)):d.startsWith("=")&&(g=this.parser.tokenEqual,d=d.substring(1)),(!l&&this.isCellReference(d)&&!u||d.includes(this.arithMarker)||d.includes(this.getParseDecimalSeparator())&&!h&&!p)&&(d=this.getValueFromArg(d));var m=this.parseFloat(d),v=n[0],y=this.getCellCollection(o>2?n[2]:s),C=this.getCellCollection(v);if("#REF!"===y[0]||"#REF!"===C[0])return this.getErrorStrings()[Xn.Name];if(C.length>y.length){var b=this.colIndex(y[y.length-1])+this.colIndex(C[C.length-1])-this.colIndex(C[0]),x=n[2].split(":");if(x[1]=(this.convertAlpha(b)+this.rowIndex(C[C.length-1])).toString(),"#REF!"===(y=this.getCellCollection(x.join(":")))[0])return this.getErrorStrings()[Xn.Name]}var S=this.getComputeSumIfValue(C,y,d.toLowerCase(),m,g,h,p);return[S[0],S[1]]},a.prototype.computeLookup=function(r){var n,i,a,o,s,l,d=[],h=[],p=[],c=[],u=[],f=r,g=f.length;if(1===g||g>3)return this.formulaErrorStrings[Kn.WrongNumberArguments];if(""===f[1]||""===f[2])return this.getErrorStrings()[Xn.Value];if(s=this.getValueFromArg(f[0]),f[0].indexOf(this.tic)>-1&&f[0].toUpperCase().split(this.tic).join("")!==this.trueValue&&f[0].toUpperCase().split(this.tic).join("")!==this.falseValue&&this.isNaN(this.parseFloat(f[0].split(this.tic).join("")))&&(s=s.split(this.tic).join("")),this.getErrorStrings().indexOf(s)>-1)return s;var m=f[1].split(":");if(2===m.length&&this.isCellReference(m[0])&&this.isCellReference(m[1])&&2===g){var v=f[1].indexOf(":"),y=this.rowIndex(this.substring(f[1],0,v)),C=this.colIndex(this.substring(f[1],0,v)),b=this.rowIndex(this.substring(f[1],v+1,v+f[1].length-v-1)),x=this.colIndex(this.substring(f[1],v+1,v+f[1].length-v-1));y>b&&(y=(n=[b,y])[0],b=n[1]),C>x&&(C=(i=[x,C])[0],x=i[1]);var S="";0===f[1].indexOf("!")&&(S=(S=(S=f[1]).replace("!","")).indexOf("!"),S=f[1].substring(0,S+2));var w=x-C+1,I=b-y+1;I>w||I===w?(a=S+Ls(C)+y+":"+Ls(C)+b,o=S+Ls(x)+y+":"+Ls(x)+b):I<w&&(a=S+Ls(C)+y+":"+Ls(x)+y,o=S+Ls(C)+b+":"+Ls(x)+b),y===b&&C===x||(l=!0)}if(l){if(d=this.getCellCollection(a),h=this.getCellCollection(o),"#REF!"===d[0]||"#REF!"===h[0])return this.getErrorStrings()[Xn.Name]}else{d=this.getCellCollection(f[1]);var E=2===g?f[1]:f[2];if(h=this.getCellCollection(E),"#REF!"===d[0]||"#REF!"===h[0])return this.getErrorStrings()[Xn.Name];var N=t(f[1]),R=t(E),A=N[1]===N[3]||N[0]===N[2],k=R[1]===R[3]||R[0]===R[2];if(!A||!k)return this.getErrorStrings()[Xn.NA]}for(var O=0;O<d.length;O++)c.push(this.getValueFromArg(d[O]).split(this.tic).join(""));var F=c.map((function(e){return""===e?NaN:Number(e)})).sort((function(e,t){return e-t})),T=F[F.length-1],D=F[0],L=this.parseFloat(s);if(this.isNaN(L)){for(var P=0;P<d.length;P++)if(p[P]=this.getValueFromArg(d[P]).split(this.tic).join(""),!(0,e.isNullOrUndefined)(h[P])&&""!==s&&""!==p[P])if(s.toUpperCase()===p[P].toUpperCase())u.push(this.getValueFromArg(h[P]).split(this.tic).join("")||"0");else if(s.indexOf("*")>-1||s.indexOf("?")>-1){var M=s;if(s.indexOf("*")>-1){M=M.replace(/\*/g,"").trim(),this.isCellReference(M)&&(M=this.getValueFromArg(M));var B=s.indexOf("*");"*"===s[0]&&(M="*"+M),"*"===s[s.length-1]&&(M+="*"),B>0&&B<s.length-1&&(M=s.substring(0,B)+"*"+s.substring(B+1))}var H=[],U=this.findWildCardValue(M.toLowerCase(),p[P].toLowerCase());H.push(U),H.push(s),this.processLogical(H,"equal")===this.trueValue&&u.push(this.getValueFromArg(h[P]).split(this.tic).join("")||"0")}}else for(var V=0;V<F.length;V++)p[V]=F[V].toString().split(this.tic).join(""),(0,e.isNullOrUndefined)(h[V])||""===p[V]||L!==this.parseFloat(p[V])||u.push(this.getValueFromArg(h[V]).split(this.tic).join("")||"0");if(u.length>0)return u[u.length-1];if(L>T&&!(0,e.isNullOrUndefined)(h[d.length-1]))return this.getValueFromArg(h[d.length-1]).split(this.tic).join("")||"0";if(L<D)return this.getErrorStrings()[Xn.NA];if(c.indexOf(s.split(this.tic).join(""))<0&&s!==this.trueValue&&s!==this.falseValue)if(this.isNaN(L)||this.isNaN(T)||this.isNaN(D)){if(this.isNaN(L)&&""!==s&&/^[a-zA-Z!@#$%^&*()_+{}[\]:;<>,.?~\\/-]/.test(s)){var z=c.sort();v=this.findClosestMatch(s.split(this.tic).join(""),z);if(!(0,e.isNullOrUndefined)(h[v])&&v>=0)return this.getValueFromArg(h[v]).split(this.tic).join("")||"0"}}else{for(var j=[],_=0;_<F.length;_++)L>F[_]&&j.push(F[_]);var v=j.length-1;if(!(0,e.isNullOrUndefined)(h[v])&&v>=0)return this.getValueFromArg(h[v]).split(this.tic).join("")||"0"}return this.getErrorStrings()[Xn.NA]},a.prototype.computeVHLookup=function(t,r){var n,i,a=this,o=t;if((0,e.isNullOrUndefined)(o)||o.length<3||o.length>4)return this.formulaErrorStrings[Kn.WrongNumberArguments];if(""===o[1])return this.getErrorStrings()[Xn.NA];var s=this.getValueFromArg(o[0]);if(s){if(s.includes(this.tic)){var l=s.split(this.tic).join("");if(l&&!this.isNumber(l)){var d=l.toUpperCase();d!==this.trueValue&&d!==this.falseValue&&(s=l)}}}else s="0";var h=this.getErrorStrings();if(h.indexOf(s)>-1)return s;var p,c=(this.getValueFromArg(o[2])||"0").split(this.tic).join("").toUpperCase(),u=this.parseFloat(c===this.trueValue?"1":c);if(u<1)return h[Xn.Value];if(o[3]){if(o[3]=this.getValueFromArg(o[3]).split(this.tic).join(""),h.indexOf(o[3])>-1)return o[3];var f=o[3].toUpperCase();if(f===this.falseValue||"0"===o[3])p=!0;else if(f!==this.trueValue&&"1"!==o[3])return h[Xn.Value]}var g,m,v,y,C,b,x=o[1].split(":");if(!this.isCellReference(x[0])||!this.isCellReference(x[1]))return h[Xn.Value];var S=this.rowIndex(x[0]),w=this.colIndex(x[0]),I=this.rowIndex(x[1]),E=this.colIndex(x[1]);if(S>I&&(S=(n=[I,S])[0],I=n[1]),w>E&&(w=(i=[E,w])[0],E=i[1]),!(S>0&&I<=As&&w>0&&E<=ks))return this.getErrorStrings()[Xn.Name];y=this.grid;var N="",R=this.getSheetFamilyItem(y);o[1].startsWith("!")?(N=o[1].substring(0,o[1].replace("!","").indexOf("!")+2),null!==R.tokenToParentObject&&(this.grid=R.tokenToParentObject.get(N))):null!==R.parentObjectToToken&&(N=R.parentObjectToToken.get(y));var A=this.getSheetId(this.grid),k={action:"getSheetInfo",sheetInfo:[]};if(this.parentObject.notify(pe,k),-1===Rn(this.parentObject,"Sheet"+A,k.sheetInfo))return this.grid=y,h[Xn.Ref];var O,F,T=this.getCellValueFn(y,this.cell,A,!0);if(r){var D=w+u-1;if(D>E)return h[Xn.Ref];g=S,m=I;var L=N+Ls(w);C=function(e){return T(e,w,L+e)};var P=N+Ls(D);b=function(){return T(v,D,P+v)||"0"}}else{var M,B=S+u-1;if(B>I)return h[Xn.Ref];g=w,m=E,C=function(e){return M=N+Ls(e),T(S,e,M+S)},b=function(){return T(B,v,M+B)||"0"}}var H=[];if(p){var U=void 0;if(this.isNumber(s)){var V=this.parseFloat(s);U=function(){return V===a.parseFloat(F)}}else if(s.includes("*")||s.includes("?")){var z=s,j=s.indexOf("*");j>-1&&(z=z.replace(/\*/g,"").trim(),this.isCellReference(z)&&(z=this.getValueFromArg(z)),0===j?z="*"+z:j===s.length-1?z+="*":z=s.substring(0,j)+"*"+s.substring(j+1)),z=z.toLowerCase(),U=function(){return a.processLogical([a.findWildCardValue(z,F.toLowerCase()),s],"equal")===a.trueValue}}else{var _=s.toUpperCase();U=function(){return _===F.toUpperCase()}}for(v=g;v<=m;v++)(F=C(v))&&U()&&H.push(b());O=H.length?H[0]:h[Xn.NA]}else if(s.indexOf("*")>-1||s.indexOf("?")>-1)O=h[Xn.NA];else{var q,W=void 0;if(this.isNumber(s)){var G=this.parseFloat(s),Y=Sr.DataUtil.fnSort("");W=function(){q=Y(a.isNumber(F)?a.parseFloat(F):F||null,G)}}else{var X=new Intl.Collator(this.parentObject.locale||"en-US",{sensitivity:"base"});W=function(){q=!F||a.isNumber(F)?null:X.compare(F,s)}}var K=void 0;for(v=g;v<=m;v++)F=C(v),K||(W(),0===q||q<0?H.push(b()):q>0&&H.length&&(K=!0));O=H.length?H[H.length-1]:h[Xn.NA]}return this.grid=y,O},a.prototype.findClosestMatch=function(e,t){for(var r=0,n=t.length-1;r<=n;){var i=Math.floor((r+n)/2),a=t[i],o=this.compareStrings(e.toLowerCase(),a.toLowerCase());if(0===o)return i;1===o?r=i+1:n=i-1}for(var s=r-1;s>=0;s--)if(-1!==this.compareStrings(e.toLowerCase(),t[s].toLowerCase()))return s;return-1},a.prototype.compareStrings=function(e,t){for(var r=Math.min(e.length,t.length),n=0;n<r;n++){var i=e.charCodeAt(n),a=t.charCodeAt(n);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0},a.prototype.findWildCardValue=function(e,t){var r="";if(e.indexOf("?")>-1){var n=RegExp(e.replace(/\?/g,"[\\s\\S]"));r=t.length===e.length&&this.isNaN(this.parseFloat(t))&&t.match(n)?e:t}else if(e.indexOf("*")>-1){for(var i=e.indexOf("*"),a="",o="",s=this.falseValue,l=this.falseValue,d=i-1;d>=0;d--)a+=e[d],l=this.trueValue;for(d=i+1;d<e.length;d++)o+=e[d],s=this.trueValue;var h=""===a?-1:t.indexOf(a.split("").reverse().join("")),p=""===o?-1:t.indexOf(o);if(h>-1||p>-1){var c=a.split("").reverse().join("")===t.substr(0,a.length),u=o===t.substring(t.length-o.length,t.length);l===this.trueValue&&s===this.trueValue&&this.isNaN(this.parseFloat(a))&&this.isNaN(this.parseFloat(o))?r=c&&u?e:t:l===this.trueValue&&this.isNaN(this.parseFloat(a))?r=c?e:t:s===this.trueValue&&this.isNaN(this.parseFloat(o))&&(r=u?e:t)}else r=t}return r},a.prototype.getComputeSumIfValue=function(e,t,r,n,i,a,o){var s=0,l=0;switch(i){case this.parser.tokenEqual:for(var d=a?r.replace(/\*/g,""):r,h=0;h<e.length;h++){var p=this.getValueFromRange(t,h),c=this.getValueFromArg(e[h].split(this.tic).join("")).toLowerCase(),u=this.parseFloat(c);if(c===r&&u===n){var f=this.getValueFromArg(t[h].split(this.tic).join("")),g=this.parseFloat(f);this.isNaN(g)||(s+=g,l+=1)}else if(c===r)this.isNaN(p)||(s+=p,l+=1);else if(a&&d&&c&&this.isNaN(this.parseFloat(c))){var m=r.indexOf("*");("*"===r[0]&&d.length<=c.length&&d===c.slice(c.length-d.length,c.length)||"*"===r[r.length-1]&&d.length<=c.length&&d===c.slice(0,d.length)||m>-1&&c.startsWith(r.substr(0,m))&&c.endsWith(r.substr(m+1)))&&(this.isNaN(p)||(s+=p,l+=1))}else if(a&&!d&&c&&this.isNaN(this.parseFloat(c)))this.isNaN(p)||(s+=p,l+=1);else if(o&&d&&c&&this.isNaN(this.parseFloat(c))){var v=RegExp(d.replace(/\?/g,"[\\s\\S]"));c.length===r.length&&c.match(v)&&(this.isNaN(p)||(s+=p,l+=1))}}break;case this.parser.tokenLess:for(h=0;h<e.length;h++){c=this.getValueFromArg(e[h].split(this.tic).join(""));if((u=this.parseFloat(c))<n){f=this.getValueFromArg(t[h].split(this.tic).join("")),g=this.parseFloat(f);this.isNaN(g)||(s+=g,l+=1)}}break;case this.parser.tokenGreater:for(h=0;h<e.length;h++){c=this.getValueFromArg(e[h].split(this.tic).join(""));if((u=this.parseFloat(c))>n){f=this.getValueFromArg(t[h].split(this.tic).join("")),g=this.parseFloat(f);this.isNaN(g)||(s+=g,l+=1)}}break;case this.parser.tokenLessEq:for(h=0;h<e.length;h++){c=this.getValueFromArg(e[h].split(this.tic).join(""));if((u=this.parseFloat(c))<=n){f=this.getValueFromArg(t[h].split(this.tic).join("")),g=this.parseFloat(f);this.isNaN(g)||(s+=g,l+=1)}}break;case this.parser.tokenGreaterEq:for(h=0;h<e.length;h++){c=this.getValueFromArg(e[h].split(this.tic).join(""));if((u=this.parseFloat(c))>=n){f=this.getValueFromArg(t[h].split(this.tic).join("")),g=this.parseFloat(f);this.isNaN(g)||(s+=g,l+=1)}}break;case this.parser.tokenNotEqual:for(d=a?r.replace(/\*/g,""):r,h=0;h<e.length;h++){p=this.getValueFromRange(t,h),c=this.getValueFromArg(e[h].split(this.tic).join("")).toLowerCase(),u=this.parseFloat(c);if(c===r||u===n||a||o)if(a&&d&&c&&this.isNaN(this.parseFloat(c))){m=r.indexOf("*");("*"===r[0]&&d.length<=c.length&&d!==c.slice(c.length-d.length,c.length)||"*"===r[r.length-1]&&d.length<=c.length&&d!==c.slice(0,d.length)||m>-1&&!c.startsWith(r.substr(0,m))||!c.endsWith(r.substr(m+1)))&&(this.isNaN(p)||(s+=p,l+=1))}else if(!a||d||this.isNaN(this.parseFloat(c))){if(o&&d&&c&&this.isNaN(this.parseFloat(c))){v=RegExp(d.replace(/\?/g,"[\\s\\S]"));c.length===r.length&&c.match(v)||this.isNaN(p)||(s+=p,l+=1)}}else this.isNaN(p)||(s+=p,l+=1);else{f=this.getValueFromArg(t[h].split(this.tic).join("")),g=this.parseFloat(f);this.isNaN(g)||(s+=g,l+=1)}}}return[s,l]},a.prototype.getValueFromRange=function(e,t){var r=e[t];return r=this.getValueFromArg(r),this.parseFloat(r.toString())},a.prototype.computeAndOrNot=function(e,t){for(var r,n,i=this,a="and"===t,o="or"===t,s="not"===t,l=!(!a&&!s),d=[],h=e,p=0;p<h.length;p++){if(h[p]===this.tic)return this.getErrorStrings()[Xn.Value];if(this.isCellReference(h[p]))for(var c=this.getCellCollection(h[p]),u=0;u<c.length;u++){if(this.getErrorStrings().indexOf(c[u])>-1)return c[u];if(c[u][0]===this.tic)return this.getErrorStrings()[Xn.Name];if(r=this.getValueFromArg(c[u]),this.getErrorStrings().indexOf(r)>-1)return r;n=this.parseFloat(r),r===this.falseValue||""!==r&&0===n||s&&""===r?d.push(this.falseValue):r===this.trueValue||!isNaN(n)&&""!==r?d.push(this.trueValue):(""===r||isNaN(n))&&d.push(this.getErrorStrings()[Xn.Value])}else{if(r=this.getValueFromArg(h[p]).split(this.tic).join("").toUpperCase(),this.getErrorStrings().indexOf(r)>-1)return r;n=this.parseFloat(r),r===this.falseValue||""===h[p]||""!==r&&0===n?d.push(this.falseValue):r===this.trueValue||!isNaN(n)&&""!==r?d.push(this.trueValue):(""===r||isNaN(n))&&d.push(this.getErrorStrings()[Xn.Value])}}if(d.every((function(e){return e===i.getErrorStrings()[Xn.Value]})))return this.getErrorStrings()[Xn.Value];for(u=0;u<d.length;u++){if((a||s)&&d[u]===this.falseValue){l=!1;break}if(o&&d[u]===this.trueValue){l=!0;break}}return(l=s?!l:l)?this.trueValue:this.falseValue},a.prototype.removeTics=function(e){return e.length>1&&e[0]===this.tic[0]&&e[e.length-1]===this.tic[0]&&(e=this.substring(e,1,e.length-2)),e},a.prototype.getCellFrom=function(e){var t,r="",n=e.indexOf(":")>-1?e.split(":"):[e],i=n.length-1,a=this.rowIndex(n[0]);if(a===this.rowIndex(n[i])){var o=this.colIndex(n[0]),s=this.colIndex(n[i]),l=this.colIndex(this.cell);l>=o&&l<=s&&(r=Ls(l).toString()+a.toString())}else if(this.colIndex(n[0])===this.colIndex(n[i])){t=this.colIndex(n[0]);var d=this.rowIndex(n[i]),h=this.rowIndex(this.cell);h>=a&&h<=d&&(r=Ls(t).toString()+h.toString())}return r},a.prototype.computeValue=function(e,t,r){try{var n=[],i=0,a="";n.length=0;for(var o=this.getParseDecimalSeparator();i<e.length;){var s="u"===e[i];if(s&&(i+=1),e[i]!==this.arithMarker){if(this.isDigit(e[i])){for(var l=this.emptyString;i<e.length&&(this.isDigit(e[i])||e[i]===o);)l+=e[i]===o?".":e[i],i+=1;if(n.push(l),!e[i])return n.toString()}if(e[i]===this.sheetToken){for(a=e[i],i+=1;i<e.length&&e[i]!==this.sheetToken;)a+=e[i],i+=1;i<e.length&&(a+=e[i],i+=1)}else if(this.isUpperChar(e[i])){l=this.emptyString;for(var d="";i<e.length&&this.isUpperChar(e[i]);){l+=e[i],i+=1}for(;i<e.length&&this.isDigit(e[i]);){l+=e[i],i+=1}if(i<e.length&&":"===e[i]){if(l+=e[i],(i+=1)<e.length&&e[i]===this.sheetToken)for(l+=e[i],i+=1;i<e.length&&e[i]!==this.sheetToken;)l+=e[i],i+=1;for(;i<e.length&&this.isUpperChar(e[i]);)l+=e[i],i+=1;for(;i<e.length&&this.isDigit(e[i]);)l+=e[i],i+=1;l=a+this.getCellFrom(l)}else l=a+l;if(d=this.getParentObjectCellValue(l,t).toString(),a="","string"==typeof d&&this.getErrorStrings().indexOf(d)>-1)return d;s&&(d=this.isNaN(this.parseFloat(d))?"-"+d:(-this.parseFloat(d)).toString()),n.push(d)}else if("q"===e[i]){var h=e.substring(i+1).indexOf(this.leftBracket),p=e.substring(i+h+1).indexOf(this.rightBracket);e=this.substring(e,i+h+2,p-1)}else if(e[i]===this.tic[0]){l=e[i].toString();for(i+=1;i<e.length&&e[i]!==this.tic[0];)l+=e[i],i+=1;(d=l.split(this.tic).join(this.emptyString))===this.trueValue||d===this.falseValue||!this.isNaN(this.parseFloat(d))&&""!==d?n.push(this.tic+d+this.tic):n.push(d),i+=1}else if("%"===e[i]&&n.length>0){var c=n[0],u=this.parseFloat(c);this.isNaN(u)||(n.pop(),n.push((u/100).toString())),i+=1}else if(0===e.substring(i).indexOf(this.trueValue))n.push(this.trueValue),i+=this.trueValue.length;else if(0===e.substring(i).indexOf(this.falseValue))n.push(this.falseValue),i+=this.falseValue.length;else if(e[i]===this.tic[0]||"|"===e[i]){l=e[i].toString();for(i++;i<e.length&&e[i]!==this.tic[0];)l+=e[i],i+=1;n.push(l+this.tic),i+=1}else{if(" "===e[i]&&i<e.length-1){i+=1;continue}switch(e[i]){case"#":var f=0;this.getErrorStrings().indexOf(e.substring(i))>-1?(f=-1===e.indexOf("!")||-1===e.substring(i).indexOf("!")?e.indexOf("#N/A")>-1?e.indexOf("#N/A")+4+i:e.indexOf("?")+1+i:e.indexOf("!")+1+i,n.push(this.substring(e,i,f-i))):(f=i+1,n.push(this.substring(e,i,f-i))),i=f;break;case"n":l="";if("n"===e[i+=1])continue;if(0===e.substring(i).indexOf("Infinity"))i+=(l="Infinity").length;else{for(("u"===e[i]||s||"-"===e[i])&&(l="-",s?s=!1:i+=1);i<e.length&&(this.isDigit(e[i])||e[i]===o||"."===e[i]);)l+=e[i]===o?".":e[i],i+=1;if(i<e.length&&"%"===e[i])if(i+=1,""===l){if(n.length>0){c=n[0],u=this.parseFloat(c);this.isNaN(u)||(n.pop(),n.push((u/100).toString()))}}else l=(this.parseFloat(l)/100).toString()}l&&n.push(l);break;case this.parser.tokenAdd:this.getValArithmetic(n,"add",r),i+=1;break;case this.parser.tokenSubtract:this.getValArithmetic(n,"sub",r),i+=1;break;case this.parser.tokenMultiply:this.getValArithmetic(n,"mul",r),i+=1;break;case this.parser.tokenDivide:this.getValArithmetic(n,"div",r),i+=1;break;case this.parser.tokenLess:this.processLogical(n,"less"),i+=1;break;case this.parser.tokenGreater:this.processLogical(n,"greater"),i+=1;break;case this.parser.tokenGreaterEq:this.processLogical(n,"greaterEq"),i+=1;break;case this.parser.tokenLessEq:this.processLogical(n,"lessEq"),i+=1;break;case this.parser.tokenNotEqual:this.processLogical(n,"notEq"),i+=1;break;case this.parser.tokenOr:this.processLogical(n,"or"),i+=1;break;case this.parser.tokenAnd:this.processLogical(n,"and"),i+=1;break;case this.parser.tokenEqual:this.processLogical(n,"equal"),i+=1;break;default:return this.getErrorStrings()[Xn.Value]}}}else i+=1}if(0===n.length)return this.emptyString;l=this.emptyString;for(var g=n.length;g>0;){var m=n.pop();if(this.getErrorStrings().indexOf(m)>-1)return m;if((l=m+l)===this.emptyString&&this.isCellReference(e)&&this.getTreatEmptyStringAsZero())return"0";g--}return l}catch(e){if(this.getErrorStrings().indexOf(e)>-1||this.formulaErrorStrings.indexOf(e)>-1)throw e;throw new Fs(this.formulaErrorStrings[Kn.InvalidExpression])}},a.prototype.getValArithmetic=function(e,t,r){var n=!1,i=e.pop(),a=-1!==i.indexOf(".")?i.split(".")[1].length:0,o=Math.pow(10,a),s=e.pop(),l=-1!==s.indexOf(".")?s.split(".")[1].length:0,d=Math.pow(10,l),h=o>=d?o:d,p=o*d;i=(i=i===this.trueValue?"1":i===this.falseValue?"0":i)===this.emptyString?"0":this.getErrorStrings().indexOf(i.toString())<0?this.parseFloat(i+"").toString():i;var c=Number(i);isNaN(c)&&!r&&(n=!0,i===this.getErrorStrings()[Xn.DivZero]?e.push(this.getErrorStrings()[Xn.DivZero]):e.push(this.getErrorStrings()[Xn.Value])),s=(s=s===this.trueValue?"1":s===this.falseValue?"0":s)===this.emptyString?"0":this.getErrorStrings().indexOf(s.toString())<0?this.parseFloat(s+"").toString():s,c=Number(s),isNaN(c)&&!r&&(n=!0,s===this.getErrorStrings()[Xn.DivZero]?e.push(this.getErrorStrings()[Xn.DivZero]):e.push(this.getErrorStrings()[Xn.Value])),"add"!==t||n||e.push(((Number(s)*h+Number(i)*h)/h).toString()),"sub"!==t||n||e.push(((Number(s)*h-Number(i)*h)/h).toString()),"mul"!==t||n||e.push((Number(s)*d*(Number(i)*o)/p).toString()),"div"!==t||n||(this.isNaN(this.parseFloat(i))||this.isNaN(this.parseFloat(s))?e.push(this.getErrorStrings()[Xn.Value]):0===this.parseFloat(i)?e.push(this.getErrorStrings()[Xn.DivZero]):e.push((Number(s)*p/(Number(i)*p)).toString()))},a.prototype.processLogical=function(t,r){var n,i,a,o,s,l,d=!1;return"and"!==r&&"equal"!==r&&(n=t.pop(),i=t.pop(),this.getErrorStrings().indexOf(n)>-1?(l=n,d=!0):this.getErrorStrings().indexOf(i)>-1&&(l=i,d=!0),this.isNaN(this.parseFloat(n))&&this.isNaN(this.parseFloat(i))&&(n=n.toString().toLowerCase(),i=i.toString().toLowerCase()),(0,e.isNullOrUndefined)(n)||(a=n.indexOf(this.tic)>-1?n:this.parseFloat(n)),(0,e.isNullOrUndefined)(i)||(o=i.indexOf(this.tic)>-1?i:this.parseFloat(i)),"*"===n&&this.isNaN(this.parseFloat(i))&&""!==i&&(s=!0)),"less"!==r||d||(l=this.isNaN(a)||this.isNaN(o)?i.toUpperCase().split(this.tic).join("").localeCompare(n.toUpperCase().split(this.tic).join(""))<0?this.trueValue:this.falseValue:o<a?this.trueValue:this.falseValue),"greater"!==r||d||(l=this.isNaN(a)||this.isNaN(o)?i.toUpperCase().split(this.tic).join("").localeCompare(n.toUpperCase().split(this.tic).join(""))>0?this.trueValue:this.falseValue:o>a?this.trueValue:this.falseValue),"lessEq"!==r||d||(l=this.isNaN(a)||this.isNaN(o)?i.toUpperCase().split(this.tic).join("").localeCompare(n.toUpperCase().split(this.tic).join(""))<=0?this.trueValue:this.falseValue:o<=a?this.trueValue:this.falseValue),"greaterEq"!==r||d||(l=this.isNaN(a)||this.isNaN(o)?i.toUpperCase().split(this.tic).join("").localeCompare(n.toUpperCase().split(this.tic).join(""))>=0?this.trueValue:this.falseValue:o>=a?this.trueValue:this.falseValue),"notEq"!==r||d||(l=i!==n?this.trueValue:this.falseValue,s&&(l=this.falseValue)),"and"!==r||d||(n=t.pop().toString(),i="",t.length>0&&(i=t.pop().toString()),l=this.getErrorStrings().indexOf(n)>-1?n:this.getErrorStrings().indexOf(i)>-1?i:(l=this.emptyString+i+n+this.emptyString).split(this.tic).join("")),"equal"!==r||d||(n=t.pop(),i=t.pop(),this.getErrorStrings().indexOf(n)>-1?l=n:this.getErrorStrings().indexOf(i)>-1?l=i:(this.isNaN(this.parseFloat(n))&&this.isNaN(this.parseFloat(i))&&(n=n.toString().toLowerCase(),i=i.toString().toLowerCase()),"*"===n&&this.isNaN(this.parseFloat(i))&&""!==i&&(s=!0),l=n===i||s?this.trueValue:this.falseValue)),"or"!==r||d||(l=Math.pow(this.parseFloat(o),this.parseFloat(a)).toString(),l=this.isNaN(this.parseFloat(l))?this.getErrorStrings()[Xn.Value]:l),t.push(l),l},a.prototype.computeStoreCells=function(e){for(var n,a=e.cellValue,o=e.cellRange,s=e.criteria,l=e.argArray,d=e.isCriteria,h=e.storedCells,p=e.isCountIfS===this.trueValue,c=e.countVal||0,u=d===this.trueValue?h:a,f=[],g=0;g<u.length;g++){var m=[],v=this.getValueFromArg(a[g]),y=l[p?1+2*c:2+c],C=y.startsWith(this.tic)&&y.endsWith(this.tic),b=(n=this.getANDComputedValue(y.trim())).includes("*"),x="*"===n||"<>*"===n,S=b&&!x?n.replace(/\*/g,"").trim():n,w=!1;if(!C&&this.isCellReference(S)&&(S=this.getValueFromArg(S),w=!0),b&&!x){var I=n.indexOf("*");"*"===n[0]&&(S="*"+S),"*"===n[n.length-1]&&(S+="*"),I>0&&I<n.length-1&&(S=n.substring(0,I)+"*"+n.substring(I+1))}n=S;var E="";if((d=p?this.trueValue:d)===this.trueValue){var N="",R=0,A=0,k=void 0,O=void 0,F=void 0,T=void 0;h[g]=p&&!c?a[g]:h[g],N=h[g],c&&(O=(k=o[c-1]).indexOf("!")>-1?t(k.substring(k.lastIndexOf("!")+1)):t(k),F=N.indexOf("!")>-1?r(N.substring(N.lastIndexOf("!")+1)):r(N),T=o[c].indexOf("!")>-1?t(o[c].substring(o[c].lastIndexOf("!")+1)):t(o[c]));var D=N.indexOf("!")>-1,L=void 0,P="",M="";for(D&&(M=N.substring(0,N.lastIndexOf("!")+1),N=N.substring(N.lastIndexOf("!")+1));!this.isDigit(N[R]);)R+=1;if(this.isCellReference(o[c])&&o[c].indexOf(":")>-1)for(E=p&&!c?u[g].indexOf("!")>-1?u[g].substring(u[g].lastIndexOf("!")+1):u[g]:i(T[0]+(F[0]-O[0]),T[1]+(F[1]-O[1])),(L=o[c].indexOf("!")>-1)&&(P=o[c].substring(0,o[c].lastIndexOf("!")+1));!this.isDigit(E[A]);)A+=1;var B=this.substring(N,R),H=this.substring(E,A),U=this.substring(N,R,N.length-R),V=this.substring(E,A,E.length-R);D&&(B=M+B,H=M+H),U!==V&&(h[g]=this.substring(h[g],D?M.length+R:R)+V),E=h[g].split(B).join(H),L?(E.indexOf("!")>-1&&(E=E.substring(E.lastIndexOf("!")+1)),E=P+E):E=E.substring(E.lastIndexOf("!")+1),v=this.getValueFromArg(E),n=p?n:this.getANDComputedValue(s[c-1])}var z="equal";n.startsWith("<=")?(z="lessEq",n=n.substring(2)):n.startsWith(">=")?(z="greaterEq",n=n.substring(2)):n.startsWith("<>")?(z="notEq",n=n.substring(2)):n.startsWith("<")?(z="less",n=n.substring(1)):n.startsWith(">")?(z="greater",n=n.substring(1)):n.startsWith("=")&&(z="equal",n=n.substring(1)),(!C&&this.isCellReference(n)&&(!w||""!==E&&!p)||n.includes(this.arithMarker))&&(n=this.getValueFromArg(n)),(n.indexOf("*")>-1||n.indexOf("?")>-1)&&(v=this.findWildCardValue(n.toLowerCase(),v.toLowerCase())),m.push(v.toLowerCase()),m.push(n.toLowerCase()),this.processLogical(m,z)===this.trueValue&&(d===this.falseValue?f.push(a[g]):f.push(E))}return h=f,f=[],h},a.prototype.computeIfsFormulas=function(n,a,o){if(a===this.trueValue&&((0,e.isNullOrUndefined)(n)||""===n[0]||n.length<2||n.length>127||n.length%2!=0))return this.formulaErrorStrings[Kn.WrongNumberArguments];for(var s=n,l=[],d=[],h=[],p=0,c=0;c<s.length;c++)s[c].indexOf(":")>-1&&this.isCellReference(s[c])?l.push(s[c].trim()):d.push(s[c].trim());var u,f,g=[];for(c=0;c<l.length;c++)g.push(this.getCellCollection(l[c]).length);for(var m=0;m<g.length;m++)if(g[m]&&g[m+1]&&g[m]!==g[m+1])return this.getErrorStrings()[Xn.Value];for(var v=0;v<d.length;v++)if(""===d[v])return o===this.trueValue?this.getErrorStrings()[Xn.DivZero]:0;if(a===this.falseValue){f=this.falseValue;var y={cellValue:u=this.getCellCollection(l[1]),cellRange:l,criteria:d,argArray:s,isCriteria:f,storedCells:h,isCountIfS:a};if(0===(h=this.computeStoreCells(y)).length)return o===this.trueValue?this.getErrorStrings()[Xn.DivZero]:0}for(c=a===this.trueValue?0:2;c<l.length;c++){f=this.trueValue,f=a===this.trueValue&&0===c?this.falseValue:this.trueValue;y={cellValue:u=this.getCellCollection(l[c]),cellRange:l,criteria:d,argArray:s,isCriteria:f,storedCells:h,isCountIfS:a,countVal:c};if(0===(h=this.computeStoreCells(y)).length)return o===this.trueValue?this.getErrorStrings()[Xn.DivZero]:0}var C=0,b=l[0].indexOf("!")>-1?t(l[0].substring(l[0].lastIndexOf("!")+1)):t(l[0]),x=l[l.length-1],S=x.indexOf("!")>-1?t(x.substring(x.lastIndexOf("!")+1)):t(x);for(m=0;m<h.length;m++){var w="",I="",E=0,N=0,R=(w=h[m]).indexOf("!")>-1,A=void 0,k="",O="";for(R&&(O=w.substring(0,w.lastIndexOf("!")+1),w=w.substring(w.lastIndexOf("!")+1));!this.isDigit(w[E]);)E+=1;if(this.isCellReference(l[0])&&l[0].indexOf(":")>-1)for(I=i(b[0]+(r(w)[0]-S[0]),b[1]+(r(w)[1]-S[1])),(A=l[0].indexOf("!")>-1)&&(k=l[0].substring(0,l[0].lastIndexOf("!")+1));!this.isDigit(I[N]);)N+=1;var F=this.substring(w,E),T=this.substring(I,N),D=this.substring(w,E,w.length-E),L=this.substring(I,N,I.length-E);if(R&&(F=O+F,T=O+T),D!==L&&(h[m]=this.substring(h[m],R?O.length+E:E)+L),u=h[m].split(F).join(T),A?(u.indexOf("!")>-1&&(u=u.substring(u.lastIndexOf("!")+1)),u=k+u):u=u.substring(u.lastIndexOf("!")+1),a===this.trueValue)p+=1;else{var P=this.getValueFromArg(u),M=parseFloat(""===P&&o!==this.trueValue?"0":P);this.isNumber(M)&&(C++,p+=M)}}return o===this.trueValue&&(p/=C),p},a.prototype.processNestedFormula=function(e,t,r){if(r&&!r.toString().includes('"')){var n=e.indexOf(t)+t.length;if('"'===e[n]&&this.getErrorStrings().indexOf(r.toString())<0&&!this.isNumber(r)&&r!==this.trueValue&&r!==this.falseValue)return e.split(t).join('"'+r+'"')}return e.split(t).join("n"+r)},a.prototype.isNaN=function(e){return"NaN"===e.toString()||"string"==typeof e},a.prototype.isNumber=function(e){return e-parseFloat(e)>=0},a.prototype.fromOADate=function(e){(e=e>0&&e<1?1+e:0===e?1:e)>60&&(e-=1);var t=new Date("01/01/1900"),r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());return new Date(new Date((e-1)*this.millisecondsOfaDay+r).toUTCString().replace(" GMT",""))},a.prototype.getSerialDateFromDate=function(e,t,r){var n=0;e<1900&&(e+=1900);for(var i=!1;!i;){for(;t>12;)e++,t-=12;for(;t<1;)t+=12,e--;i=!0;for(var a=new Date(e,t,1,-1).getDate();r>a;)a=new Date(e,t,1,-1).getDate(),t++,r-=a,i=!1;r<1&&(--t<1&&(t=12,e--),r=(a=new Date(e,t,1,-1).getDate())+r,i=!1)}var o=Date.parse(e+"/"+t+"/"+r);return this.isNaN(o)||(n=this.toOADate(new Date(o))),n},a.prototype.intToTime=function(t){var r=t.toString().split(".");return(0,e.isNullOrUndefined)(r[1])||(t=parseFloat(r[0]+1+"."+r[1])||t),this.intToDate(t.toString())},a.prototype.toOADate=function(e,t,r){var n=new Date("01/01/1900"),i=ln(e)?e:new Date(e),a=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),o=(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())-a)/864e5;return(t?o:parseInt(o.toString(),10))+(r?0:o>60?2:1)},a.prototype.calculateDate=function(e){return this.parseFloat(e)<10?"0"+e:e},a.prototype.isTextEmpty=function(e){return null===e||""===e},a.prototype.isDigit=function(e){var t=e.charCodeAt(0);return t>47&&t<58},a.prototype.getANDComputedValue=function(e){return e.startsWith(this.arithMarker)&&e.includes("c")&&(e=this.getValueFromArg(e)),e.split(this.tic).join(this.emptyString)},a.prototype.findLastIndexOfq=function(e){for(var t=e.lastIndexOf("q"),r=e.lastIndexOf(this.leftBracket);r<t;)t=e.substring(0,t).lastIndexOf("q");return t},a.prototype.getValueFromArg=function(e,t,r,n){if(!(e=e.trim())||this.getErrorStrings().indexOf(e)>-1)return e;var i=e[0];if(i===this.tic||i===this.singleTic){var a=e.split(this.tic).join("");if(this.isNaN(this.parseFloat(a))){var o=this.isDate(a);if(o&&!this.isNaN(o.getDate()))return this.toOADate(o,!0).toString()}if(e.endsWith(this.tic))"."!==(s=this.getParseDecimalSeparator())&&a.includes(s)&&(a=a.replace(s,"."),this.isNumber(a)&&(e=a));return e}if("u"===i&&e.includes(this.arithMarker))e=this.parser.parseSimpleOperators(e.split("u").join("0-"),[this.parser.tokenSubtract],["-"]);else if(!this.isUpperChar(i)){var s=this.getParseDecimalSeparator();if(this.isDigit(i)||i===s||"-"===i||"n"===i){if("n"===i&&(e=e.substring(1)).indexOf('"n')>-1&&(e=e.replace('"n','"')),"."!==s&&e.includes(s)){a=e.replace(s,".");this.isNumber(a)&&(e=a)}return e}}var l=i===this.sheetToken;if(l||this.isUpperChar(i)&&!["+","-","/","*",")",")","{"].some((function(t){return e.includes(t)}))){var d=this.isCellReference(e);if(d&&!l){var h=this.getSheetFamilyItem(this.grid);null!==h.sheetNameToParentObject&&h.parentObjectToToken.has(this.grid)&&(e=h.parentObjectToToken.get(this.grid)+e)}if(e===this.cell){var p=this.getDependentCells().get(e);if(null!=p&&p.indexOf(e)>-1&&this.arrayRemove(p,e),this.getDependentFormulaCells().has(this.cell)||this.clearFormulaDependentCells(this.cell),!t)throw new Fs(this.formulaErrorStrings[Kn.CircularReference])}var c=this.getParentObjectCellValue(e,!1,t,n).toString();return d&&this.updateDependentCell(e),c}return this.computeValue(e,!1,r)},a.prototype.isDate=function(e){if("object"==typeof e||null!==Date.parse(e)){var t=void 0;return(t="string"==typeof e?this.checkDateFormat(e):new Date(Date.parse(e)))>=this.dateTime1900?t:null}return null},a.prototype.isValidCellReference=function(t){var r=0,n=0,i=[89,71,69],a=this.emptyString;if(this.namedRanges.has(t))return!1;for(var o=0;o<t.length;o++)this.isChar(t[o])&&r++;if((a=t.substring(0,r)).length<4){for(;n<a.length;){if((0,e.isNullOrUndefined)(a[n])||!(a[n].charCodeAt(0)<i[n])){if((0,e.isNullOrUndefined)(a[n])&&n>0)break;return!1}n++}if(this.parseFloat(t.substring(r,t.length))<1048576)return!0}return!1},a.prototype.parseDate=function(e){if(!this.isNaN(e)){if(e instanceof Date)return new Date(e);var t=parseInt(e,10);return t<0?this.getErrorStrings()[Xn.Num]:t<=60?new Date(this.dateTime1900.getTime()+864e5*(t-1)):new Date(this.dateTime1900.getTime()+864e5*(t-2))}return"string"!=typeof e||(e=this.checkDateFormat(e,!0),this.isNaN(e))?this.getErrorStrings()[Xn.Value]:e},a.prototype.checkDateFormat=function(e,t){if("spreadsheet"===this.parentObject.getModuleName()&&"en-US"!==this.parentObject.locale){var r={value:e,cell:{value:e}};if(this.parentObject.notify("checkDateFormat",r),r.isDate)return r.dateObj}return t?new Date(e):new Date(Date.parse(e))},a.prototype.isCellReference=function(e){if((e=e.trim())===this.emptyString)return!1;e=this.setTokensForSheets(e);var t=this.getSheetToken(e),r=!1;""!==t&&(e=e.split(t).join(this.emptyString));var n=!1,i=!1;if(e.indexOf(":")!==e.lastIndexOf(":"))return!1;for(var a=e.split("").join(this.getParseArgumentSeparator()).split(this.getParseArgumentSeparator()),o=0;o<a.length;o++)if(this.isChar(a[o]))n=!0;else if(this.isDigit(a[o]))i=!0;else{if(":"!==a[o])return!1;n&&i&&(r=!0),n=!1,i=!1}return e.indexOf(":")>-1&&-1===e.indexOf(this.tic)?!!(r&&n&&i||(n&&!i||!n&&i)&&!r):!!(n&&i&&-1===e.indexOf(this.tic)&&this.isValidCell(e))},a.prototype.setTokensForSheets=function(e){var t=this.getSheetFamilyItem(this.grid),r=this.getSortedSheetNames();if(null!=r)for(var n=0;n<r.length;n++){var i=t.sheetNameToToken.get(r[n]);i=i.split(this.sheetToken).join(this.tempSheetPlaceHolder);var a=this.singleTic+"SHEET"+r[n]+this.singleTic+this.sheetToken;-1===e.indexOf(a)&&(a="SHEET"+r[n]+this.sheetToken),e=e.split(a).join(i),a=r[n]+this.sheetToken,e=e.split(a).join(i)}if((e=e.split(this.tempSheetPlaceHolder).join(this.sheetToken)).indexOf("!!")>-1){var o=(e=e.replace("!!","!")).split("!");o[1]=(parseInt(o[1],10)+1).toString(),e=o.join("!")}return e},a.prototype.getParentObjectCellValue=function(e,t,r,n){if(e===this.trueValue||e===this.falseValue)return e;var i,a=e.lastIndexOf(this.sheetToken),o=this.grid;if(a>-1){if(null===(s=this.getSheetFamilyItem(o)).tokenToParentObject)return this.getErrorStrings()[Xn.Value];this.grid=s.tokenToParentObject.get(e.substring(0,a+1)),i=e.substring(a+1)}else{for(var s,l=0;l<e.length&&this.isChar(e[l]);)l++;if(l===e.length)return""===e?this.getErrorStrings()[Xn.Value]:this.getErrorStrings()[Xn.Name];i=e,(s=this.getSheetFamilyItem(o)).isSheetMember&&null!=s.parentObjectToToken&&(e=s.parentObjectToToken.get(this.grid)+e)}if(this.isDigit(i[0])){var d=i.search(/[a-zA-Z]/);d>0&&(i=i.substring(d,i.length)+i.substring(0,d))}var h,p=this.rowIndex(i),c=this.colIndex(i);if(p>0&&p<=As&&c>0&&c<=ks){var u=this.getSheetId(this.grid);if(this.parentObject.notify){var f={action:"getSheetInfo",sheetInfo:[]};if(this.parentObject.notify(pe,f),-1===Rn(this.parentObject,"Sheet"+u,f.sheetInfo))return this.grid=o,this.getErrorStrings()[Xn.Ref]}h=this.getCellValueFn(o,this.cell,u,!1,t,r,n)(p,c,e)}else h=this.getErrorStrings()[Xn.Name];return this.grid=o,h},a.prototype.getCellValueFn=function(t,r,n,i,a,o,s){var l=this,d=r;d&&(d=t===this.grid?"":d+","+("string"==typeof t&&Number(t)>-1?t:this.getSheetID(t)));var h=this.parentObject.getValueRowCol.bind(this.parentObject)||this.getValueRowCol.bind(this);return function(t,p,c){if(r===c&&!o)throw l.formulaErrorStrings[Kn.CircularReference];l.cell=c;var u=h(n,t,p,d,a,o,s);if((0,e.isNullOrUndefined)(u))u=l.emptyString;else{u=u.toString();var f=l.getParseDecimalSeparator();if("."!==f&&u.includes(f)){var g=u.replace(f,".");l.isNumber(g)&&(u=g)}}return l.cell=r,i&&l.updateDependentCell(c),u}},a.prototype.isValidCell=function(e){if(0===e.search(/\d/)){var t=e.search(/[a-zA-Z]/);e=e.substring(t,e.length)+e.substring(0,t)}var r=this.rowIndex(e),n=this.colIndex(e);return r>0&&r<=As&&n>0&&n<=ks},a.prototype.getSheetId=function(e){return e&&"string"==typeof e&&Number(e)>-1?Number(e):this.getSheetID(e)+1},a.prototype.getValueRowCol=function(e,t,r){var n=this.rowsToKeyMap.get(t).toString(),i=this.getKeyValue(n).toString();if(null!=i&&"%"===i[i.length-1]&&i.length>1){var a=this.parseFloat(i.substring(0,i.length-1));this.isNaN(a)&&(i=(Number(a)/100).toString())}return i},a.prototype.defineFunction=function(t,r,n){"string"==typeof r&&(r=(0,e.getValue)(r,window)),t=t.toUpperCase(),this.libraryFormulas.set(t,{handler:r,isCustom:!0,description:n})},a.prototype.valueChanged=function(t,r,n,i,a,o,s,l,d,h,p,c){var u=t;this.spreadSheetUsedRange=i,this.grid=t;var f=!0,g=!0,m=this.getSheetFamilyItem(u),v=Ls(r.getColIndex())+r.getRowIndex().toString();(this.actCell=o+"!"+v,null!==m.sheetNameToParentObject&&m.sheetNameToParentObject.size>0)&&(v=m.parentObjectToToken.get(u)+v);var y=r.getFormulaValue().toUpperCase();if(y.indexOf("=RAND()")>-1||y.indexOf("=NOW()")>-1||y.indexOf("NOW()")>-1||y.indexOf("RAND()")>-1||y.indexOf("=RANDBETWEEN(")>-1||y.indexOf("RANDBETWEEN(")>-1||this.randomValues.has(v)){var C=this.randCollection.toString();this.randomValues.has(v)?this.randomValues.has(v)&&(y.indexOf("=RAND()")>-1||y.indexOf("=NOW()")>-1||y.indexOf("NOW()")>-1||y.indexOf("RAND()")>-1||y.indexOf("=RANDBETWEEN(")>-1||y.indexOf("RANDBETWEEN(")>-1?this.randomValues.set(v,r.getFormulaValue()):r.getFormulaValue().toUpperCase()!==this.randomValues.get(v.toUpperCase())&&(this.randomValues.delete(v),C=C.split(v+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+v).join("").split(v).join(""),this.randCollection=C.split(this.parseArgumentSeparator)),0===this.randomValues.size&&this.randCollection.length&&(this.isRandomVal=!1,this.randomValues.clear(),this.randCollection=[])):(this.randomValues.set(v,r.getFormulaValue()),this.randCollection.push(v),this.isRandomVal=!0)}if(r.getFormulaValue()&&r.getFormulaValue()[0]===this.getFormulaCharacter()){this.cell=v;var b=void 0;if((0,e.isNullOrUndefined)(g)||(g=n),this.getFormulaInfoTable().has(v)){if(b=this.getFormulaInfoTable().get(v),r.getFormulaValue()!==b.getFormulaText()||null==b.getParsedFormula()){b.setFormulaText(r.getFormulaValue()),this.getDependentFormulaCells().has(this.cell)&&this.clearFormulaDependentCells(this.cell);try{b.setParsedFormula(this.parser.parseFormula(r.getFormulaValue()))}catch(e){b.setFormulaValue(e),g=!1}}else this.parser.isError=!1;if(g)this.parser.isFormulaParsed=!0,f=(x=this.calculateFormula(b.getParsedFormula(),a))!==b.getFormulaValue()&&(!this.parentObject.isEdit||x!==this.formulaErrorStrings[Kn.CircularReference]),b.setFormulaValue(x)}else{(b=new Ts).setFormulaText(r.getFormulaValue()),this.getDependentFormulaCells().has(v)||this.getDependentFormulaCells().set(v,new Map),this.getFormulaInfoTable().set(v,b);try{b.setParsedFormula(this.parser.parseFormula(r.getFormulaValue()))}catch(e){b.setFormulaValue(e),g=!1}var x;if(g)f=(x=this.calculateFormula(b.getParsedFormula(),a))!==this.formulaErrorStrings[Kn.CircularReference],b.setFormulaValue(x)}g&&(void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(u)+1,b.getFormulaValue(),r.getRowIndex(),r.getColIndex()):this.parentObject.setValueRowCol(this.getSheetId(u),b.getFormulaValue(),r.getRowIndex(),r.getColIndex(),b.getFormulaText(),s))}else this.getFormulaInfoTable().has(v)&&(this.getFormulaInfoTable().delete(v),this.getDependentFormulaCells().has(v)&&this.clearFormulaDependentCells(v));g&&f&&this.getDependentCells().has(v)&&("Automatic"===this.parentObject.calculationMode||!this.parentObject.isEdit||p)&&this.getDependentCells().get(v).toString()!==v&&this.refresh(v,void 0,void 0,l,d,h,p,c)},a.prototype.setValueRowCol=function(e,t,r,n){},a.prototype.getSortedSheetNames=function(){var e=this.getSheetFamilyItem(this.grid);if(null!=e&&null!=e.sheetNameToToken){var t=[];e.sheetNameToToken.forEach((function(e,r){t.push(r),t.sort()})),this.sortedSheetNames=t,this.sortedSheetNames.sort(),this.sortedSheetNames.length>9&&this.sortedSheetNames[0].includes("1")&&this.sortedSheetNames[1].includes("10")&&(this.sortedSheetNames.splice(this.sortedSheetNames.indexOf("2"),0,this.sortedSheetNames[0]),this.sortedSheetNames.splice(0,1))}return this.sortedSheetNames},a.prototype.getErrorLine=function(e){var t=e.stack?e.stack.split("\n")[1].split(":"):null;return t?t[t.length-2]:null},a.prototype.createSheetFamilyID=function(){return this.sheetFamilyID===Number.MAX_SAFE_INTEGER&&(this.sheetFamilyID=Number.MIN_SAFE_INTEGER),this.sheetFamilyID++},a.prototype.computeMinMax=function(t,n){var i,a,o,s,l=!1;if(t.length){var d=t[t.length-1];"isSubtotal"===d?(l=!0,t.pop()):"isAggregate"===d&&(s=this.parentObject.getActiveSheet(),o=!0,t.pop())}if((0,e.isNullOrUndefined)(t)||0===t.length)return this.formulaErrorStrings[Kn.WrongNumberArguments];i="max"===n?this.minValue:this.maxValue;for(var h=0,p=t.length;h<p;h++)t[h].split(this.tic).join("").trim()===this.emptyString&&(i=0);var c,u=t;if(u.length>255)return this.getErrorStrings()[Xn.Value];for(var f=0;f<u.length;f++)if(u[f].indexOf(":")>-1&&this.isCellReference(u[f])){for(var g=this.getCellCollection(u[f]),m=0;m<g.length;m++)if(!(o&&(ml(s,(c=r(g[m]))[0])||Al(s,c[1]))||(a=l?this.getValueFromArg(g[m],null,null,!0):this.getValueFromArg(g[m]),l&&a.includes("SUBTOTAL(")))){var v=this.parseFloat(a);""===a||this.isNaN(this.parseFloat(v))||this.getErrorStrings().indexOf(a)>-1||(i="max"===n?Math.max(i,v):Math.min(i,v))}}else{var y=l?this.getValueFromArg(u[f],null,null,!0):this.getValueFromArg(u[f]);if(l&&y.includes("SUBTOTAL("))continue;v=0;var C=this.isCellReference(u[f]),b=""===y&&C,x=this.isNaN(this.parseFloat(y))&&C,S=y===(this.trueValue||this.falseValue)&&C;if(u[f]=u[f].startsWith("n")?u[f].slice(1):u[f],this.getErrorStrings().indexOf(y)>-1)return y;if(y===this.trueValue&&u[f]===this.trueValue)y="1";else if(y===this.falseValue&&u[f]===this.falseValue)y="0";else if(b||x||S)continue;if(y.indexOf('"')>-1&&(y=y.split(this.tic).join("")),this.isNaN(this.parseFloat(y)))return this.getErrorStrings()[Xn.Value];v=this.parseFloat(y),i="max"===n?Math.max(i,v):Math.min(i,v)}return i!==this.minValue&&i!==this.maxValue||(i=0),i.toString()},a.prototype.calculateAvg=function(t,n,i){var a,o,s,l,d=t,h=[],p=0,c=0;i&&(l=this.parentObject.getActiveSheet());for(var u=0;u<d.length;u++)if(this.isCellReference(d[u]))if(d[u].indexOf(":")>-1){h=this.getCellCollection(d[u]);for(var f=0;f<h.length;f++)if(!(i&&(ml(l,(s=r(h[f]))[0])||Al(l,s[1]))||(a=n?this.getValueFromArg(h[f],null,null,!0):this.getValueFromArg(h[f]),n&&a.includes("SUBTOTAL(")))){if(this.getErrorStrings().indexOf(a)>-1)return a;(0,e.isNullOrUndefined)(a)||isNaN(this.parseFloat(a))||""===a||(p+=this.parseFloat(a),c+=1)}}else{if(a=n?this.getValueFromArg(d[u],null,null,!0):this.getValueFromArg(d[u]),n&&a.includes("SUBTOTAL("))continue;if(this.getErrorStrings().indexOf(a)>-1)return a;if((0,e.isNullOrUndefined)(a)||isNaN(this.parseFloat(a))||""===a)continue;p+=this.parseFloat(a),c+=1}else{if(d[u].indexOf(this.tic)>-1&&(isNaN(this.parseFloat(d[u].split(this.tic).join("")))||""===d[u].split(this.tic).join("").trim()))return this.getErrorStrings()[Xn.Value];if(0!==d[u].length&&t[u]!==this.falseValue||(d[u]="0"),t[u]===this.trueValue&&(d[u]="1"),o=this.getValueFromArg(d[u].split(this.tic).join("")),this.getErrorStrings().indexOf(o)>-1)return o;p+=this.parseFloat(o),c+=1}return 0===c?this.getErrorStrings()[Xn.DivZero]:(p/c).toString()},a.prototype.registerGridAsSheet=function(t,r,n){(0,e.isNullOrUndefined)(this.modelToSheetID)&&(this.modelToSheetID=new Map),(0,e.isNullOrUndefined)(this.modelToSheetID.get(r))&&this.modelToSheetID.set(r,n);var i=this.getSheetFamilyItem(r);i.isSheetMember=!0;var a=t.toUpperCase();if(0===i.parentObjectToToken.size&&(i.parentObjectToToken=new Map),0===i.sheetNameToParentObject.size&&(i.sheetNameToParentObject=new Map),0===i.sheetNameToToken.size&&(i.sheetNameToToken=new Map),0===i.tokenToParentObject.size&&(i.tokenToParentObject=new Map),(0,e.isUndefined)(i.sheetNameToParentObject.get(a))){o=this.sheetToken+this.tokenCount.toString()+this.sheetToken;this.tokenCount++,i.tokenToParentObject.set(o,r),i.parentObjectToToken.set(r,o),i.sheetNameToToken.set(a,o),i.sheetNameToParentObject.set(a,r)}else{var o=i.sheetNameToToken.get(a);i.tokenToParentObject.set(o,r),i.parentObjectToToken.set(r,o)}return t},a.prototype.unregisterGridAsSheet=function(t,r,n){var i=this,a=[r];n&&(a=[],(0,e.isNullOrUndefined)(this.modelToSheetID)||this.modelToSheetID.forEach((function(e,t){a.push(t)}))),a.forEach((function(e){var r=i.getSheetFamilyItem(e),a=(n?e:t).toUpperCase();if(null!=r.sheetNameToParentObject&&r.sheetNameToParentObject.has(a)){r.sheetNameToParentObject.delete(a);var o=r.sheetNameToToken.get(a);r.sheetNameToToken.delete(a),r.tokenToParentObject.delete(o),r.parentObjectToToken.delete(e)}}))},a.prototype.computeExpression=function(e,t){var r=this.parser.parseFormula(e);return this.computeFormula(r,t)},a.prototype.isSheetMember=function(){var t=this.getSheetFamilyItem(this.grid);return!(0,e.isNullOrUndefined)(t)&&t.isSheetMember},a.prototype.dispose=function(){this.resetKeys(),this.namedRanges.clear(),this.lFormulas.clear()},a.prototype.refreshRandValues=function(e){var t,r,n,i,a="";if(this.randomValues.has(e)){this.randomValues.delete(e);var o=this.randCollection.indexOf(e);o>-1&&this.randCollection.splice(o,1),0!==this.randomValues.size||this.randCollection.length||(this.randomValues.clear(),this.randCollection=[])}for(var s=0;s<this.randomValues.size;s++)t=this.rowIndex(this.randCollection[s]),r=this.colIndex(this.randCollection[s]),a=(parseFloat(this.getSheetToken(this.randCollection[s]).split(this.sheetToken).join(""))+1).toString(),i=this.getSheetFamilyItem(a),this.grid=i.sheetNameToParentObject.get(a),n=this.randomValues.get(this.randCollection[s]),n=this.computeFormula(n),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,n,t,r):this.parentObject.setValueRowCol(this.getSheetId(this.grid),n,t,r)},a.prototype.refresh=function(e,t,r,n,a,o,s,l){var d,h=this;r||(d=!0,r=[]);var p=this.getSheetFamilyItem(this.grid);try{var c=this.getDependentCells().get(e);if(c&&0!==c.length&&("Automatic"===this.parentObject.calculationMode||s||"calculate"===l)){var u=void 0;for(u=0;u<c.length;u++){var f=c[u];if(!(t&&f.indexOf(t)>-1||f===e||r.indexOf(f)>-1)){var g=this.getSheetToken(f),m=this.parentObject.sheets,v=this.parentObject.activeSheetIndex;if(g.length){this.grid=p.tokenToParentObject.get(g);var y=Number(this.grid),C="";if(!this.isNaN(y)&&m)for(var b=0;b<m.length;b++)m[b].id===y&&(C=m[b].name,v=b);this.actCell=C+"!"+f.split(g)[1]}else this.actCell=f.split(g)[1];try{var x=function(e,t){t&&(h.cell=e,h.parser.isFormulaParsed=!0,t.setFormulaValue(h.calculateFormula(t.getParsedFormula(),!0)))},S=this.rowIndex(f),w=this.colIndex(f),I=this.getFormulaInfoTable().get(f);if(void 0===this.parentObject.setValueRowCol)x(f,I),this.setValueRowCol(this.getSheetID(this.grid)+1,I.getFormulaValue(),S,w);else{var E=m&&m[v].rows&&m[v].rows[S-1]&&m[v].rows[S-1].cells&&m[v].rows[S-1].cells[w-1],N=void 0;if(E&&E.formula&&E.formula.toLowerCase().includes("unique")){if(this.uniqueCells&&-1!==this.uniqueCells.indexOf(f))continue;this.uniqueCells||(this.uniqueCells=[]),this.uniqueCells.push(f),x(f,I),N=I.getFormulaValue(),this.uniqueCells.splice(this.uniqueCells.indexOf(f),1),this.uniqueCells.length||(this.uniqueCells=null)}else-1===r.indexOf(f)&&r.push(f),N=null;this.parentObject.setValueRowCol(this.getSheetId(this.grid),N,S,w,I.getFormulaText())}this.refresh(f,null,r,null,a)}catch(e){continue}}}}if(d){if(!a&&o&&4===o.length){g=this.getSheetToken(e);for(var R=[],A=o[0],k=o[2];A<=k;A++)for(var O=o[1],F=o[3];O<=F&&(A!==k||O!==F);O++){E=g+i(A,O);this.refresh(E,null,r,null,a),R.push(E)}var T=new Set(R);r&&(r=r.filter((function(e){return!T.has(e)})))}var D=this.parentObject.sheets;D||(r=[]),r.forEach((function(e){for(var t,r=h.getSheetId(p.tokenToParentObject.get(h.getSheetToken(e))),i=0;i<D.length;i++)if(D[i].id===r){t=i;break}var a=h.rowIndex(e)-1,o=h.colIndex(e)-1,s=D[t].rows[a]&&D[t].rows[a].cells[o];s&&h.parentObject.notify("calculateFormula",{cell:s,rowIdx:a,colIdx:o,sheetIndex:t,isDependentRefresh:!0,isRandomFormula:n,action:l})}))}}finally{this.getDependentCells().has(e)&&(this.grid=p.tokenToParentObject.get(this.getSheetToken(e)))}},Rs([(0,e.Event)()],a.prototype,"onFailure",void 0),a=Rs([e.NotifyPropertyChanges],a)}(e.Base),Fs=function(e,t){this.formulaCorrection=!1,this.message=e,this.formulaCorrection=t},Ts=function(){function e(){this.calcID=Number.MIN_VALUE+1,this.calcID1=Number.MIN_VALUE+1}return e.prototype.getFormulaText=function(){return this.formulaText},e.prototype.setFormulaText=function(e){this.formulaText=e},e.prototype.getFormulaValue=function(){return this.formulaValue},e.prototype.setFormulaValue=function(e){this.formulaValue=e},e.prototype.getParsedFormula=function(){return this.parsedFormula},e.prototype.setParsedFormula=function(e){this.parsedFormula=e},e}(),Ds=function(){this.isSheetMember=!1,this.parentObjectToToken=new Map,this.sheetDependentFormulaCells=new Map,this.sheetNameToParentObject=new Map,this.sheetNameToToken=new Map,this.tokenToParentObject=new Map,this.sheetFormulaInfotable=new Map};function Ls(e){for(var t=[],r=0;e>0&&r<9;){e--;var n="A".charCodeAt(0);t[r]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),r++}for(var i=[],a=0;a<r;a++)i[r-a-1]=t[a];return i.join("")}var Ps,Ms,Bs=function(e,t,r){return this.row=e,this.col=t,this.value=r,this.getRowIndex=function(){return e},this.setRowIndex=function(t){e=t},this.getColIndex=function(){return t},this.setColIndex=function(e){t=e},this.getFormulaValue=function(){return r},this},Hs=function(){function r(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.sheetInfo=[],this.parent=e,this.init()}return r.prototype.init=function(){var e=this;this.addEventListener(),this.initCalculate(),this.registerSheet(),this.parent.customFormulaCollection.forEach((function(t,r){e.addCustomFunction(t.handler,r,t.description)}))},r.prototype.destroy=function(){var e=this;(this.removeEventListener(),this.parent.refreshing)&&(this.clearAllUniqueFormulaValue(),this.calculateInstance.getLibraryFormulas().forEach((function(t,r){t.isCustom&&e.parent.customFormulaCollection.set(r,{handler:t.handler,description:t.description})})));this.calculateInstance.dispose(),this.calculateInstance=null,this.sheetInfo&&(this.sheetInfo=[]),this.parent=null},r.prototype.addEventListener=function(){this.parent.on(pe,this.performFormulaOperation,this),this.parent.on(Se,this.aggregateComputation,this),this.parent.on(we,this.getUniqueRange,this),this.parent.on(Ie,this.removeUniquecol,this),this.parent.on(Re,this.clearFormulaDependentCells,this),this.parent.on(Ae,this.formulaInValidation,this),this.parent.on(nr,this.refreshInsertDelete,this),this.parent.on(ir,this.getUpdatedFormulaOnInsertDelete,this),this.parent.on(lr,this.autoCorrectCellRef,this),this.parent.on(dr,this.parseFormulaArgument,this),this.parent.on(hr,this.getCellRefValue,this),this.parent.on(pr,this.commputeFormulaValue,this),this.parent.on(yr,this.renameUpdation,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(pe,this.performFormulaOperation),this.parent.off(Se,this.aggregateComputation),this.parent.off(we,this.getUniqueRange),this.parent.off(Ie,this.removeUniquecol),this.parent.off(Re,this.clearFormulaDependentCells),this.parent.off(Ae,this.formulaInValidation),this.parent.off(nr,this.refreshInsertDelete),this.parent.off(ir,this.getUpdatedFormulaOnInsertDelete),this.parent.off(lr,this.autoCorrectCellRef),this.parent.off(dr,this.parseFormulaArgument),this.parent.off(hr,this.getCellRefValue),this.parent.off(pr,this.commputeFormulaValue),this.parent.off(yr,this.renameUpdation))},r.prototype.getModuleName=function(){return"workbookFormula"},r.prototype.initCalculate=function(){this.calculateInstance=new Os(this.parent),this.calcID=this.calculateInstance.createSheetFamilyID(),this.calculateInstance.setTreatEmptyStringAsZero(!0),this.calculateInstance.grid=this.parent.getActiveSheet().id.toString(),this.calculateInstance.setParseArgumentSeparator(this.parent.listSeparator);var t=(0,e.getNumericObject)(this.parent.locale).decimal;"."!==t&&this.parent.listSeparator!==t&&this.calculateInstance.setParseDecimalSeparator(t)},r.prototype.clearFormulaDependentCells=function(t){if(t.isOpen)return this.calculateInstance.getDependentCells().clear(),this.calculateInstance.getFormulaInfoTable().clear(),void this.calculateInstance.getDependentFormulaCells().clear();var r=t.cellRef.split(":")[0],n=this.parent.getActiveSheet().id.toString(),i=this.calculateInstance.getSheetFamilyItem(n);i.isSheetMember&&!(0,e.isNullOrUndefined)(i.parentObjectToToken)&&(r=i.parentObjectToToken.get(n)+r),t.clearFormulaInfo&&this.calculateInstance.getFormulaInfoTable().has(r)&&this.calculateInstance.getFormulaInfoTable().delete(r),this.calculateInstance.clearFormulaDependentCells(r)},r.prototype.formulaInValidation=function(t){var r=this.calculateInstance.getLibraryFormulas().get(t.value);t.skip=(0,e.isNullOrUndefined)(r)},r.prototype.performFormulaOperation=function(t){var r,n,i,a=t.action;"refreshCalculate"!==a&&(r=this.calculateInstance.getLibraryFormulas(),n=Array.from(r.values()));var o=this.calculateInstance.getSheetFamilyItem(t.sheetId);switch(a){case"getLibraryFormulas":t.formulaCollection=Array.from(r.keys());break;case"getFormulaCategory":i=["All"];for(var s=1;s<Array.from(r.values()).length;s++)i.indexOf(n[s].category)<0&&i.push(n[s].category);t.categoryCollection=i;break;case"dropDownSelectFormulas":for(s=0;s<Array.from(r.values()).length;s++)t.selectCategory===n[s].category&&(t.formulaCollection[s]=Array.from(r.keys())[s]);break;case"getFormulaDescription":for(s=0;s<Array.from(r.values()).length;s++)t.selectedList===Array.from(r.keys())[s]&&(t.description=n[s].description,t.isCustom=n[s].isCustom);break;case"registerSheet":this.registerSheet(t.sheetIndex,t.sheetCount),t.isImport&&(this.calculateInstance.setParseArgumentSeparator(this.parent.listSeparator),this.updateSheetInfo());break;case"unRegisterSheet":this.unRegisterSheet(t.sheetIndex,t.sheetCount,t.propertyChange);break;case"initSheetInfo":this.updateSheetInfo();break;case"refreshCalculate":this.refreshCalculate(t);break;case"refreshRandomFormula":this.refreshRandomFormula(),this.calculateInstance.cell="";break;case"setArgumentSeparator":this.calculateInstance.setParseArgumentSeparator(this.parent.listSeparator);break;case"addDefinedName":t.isAdded=this.addDefinedName(t.definedName,!1,t.index,t.isEventTrigger);break;case"removeDefinedName":t.isRemoved=this.removeDefinedName(t.definedName,t.scope,t.isEventTrigger);break;case"initiateDefinedNames":this.initiateDefinedNames();break;case"addSheet":this.sheetInfo.push({visibleName:t.visibleName,sheet:t.sheetName,index:t.sheetId});break;case"getSheetInfo":t.sheetInfo=this.sheetInfo;break;case"deleteSheetTab":for(s=0;s<this.sheetInfo.length;s++)if(this.sheetInfo[s].index===t.sheetId){var l=this.sheetInfo[s].visibleName,d=this.sheetInfo[s].sheet;this.sheetInfo.splice(s,1);var h=t.sheetId.toString();this.sheetDeletion(d,h),this.calculateInstance.unregisterGridAsSheet(h,h),this.definedNamesDeletion(l);break}break;case"getReferenceError":t.refError=this.referenceError();break;case"getAlpha":t.col=Ls(t.col);break;case"addCustomFunction":this.addCustomFunction(t.functionHandler,t.functionName,t.formulaDescription);break;case"computeExpression":t.calcValue=this.calculateInstance.computeExpression(t.formula,t.isFromComputeExpression);break;case"registerGridInCalc":this.calculateInstance.grid=t.sheetID;break;case"dependentCellsAvailable":case"checkFormulaAdded":o.isSheetMember&&!(0,e.isNullOrUndefined)(o.parentObjectToToken)&&(t.address=o.parentObjectToToken.get(t.sheetId)+t.address),"checkFormulaAdded"===a?t.added=this.calculateInstance.getFormulaInfoTable().has(t.address):t.isAvailable=this.calculateInstance.getDependentCells().has(t.address);break;case"calculateNow":this.calculateNow(t);break;case"ClearDependentCellCollection":this.calculateInstance.getDependentFormulaCells().clear(),this.calculateInstance.getDependentCells().clear(),this.calculateInstance.getFormulaInfoTable().clear()}},r.prototype.definedNamesDeletion=function(e){var t=this.parent.definedNames;if(t&&t.length>0)for(var r=t.length-1;r>=0;r--)t[r].refersTo.substring(1,t[r].refersTo.lastIndexOf("!")).split("'").join("")===e&&this.removeDefinedName(t[r].name,t[r].scope)},r.prototype.referenceError=function(){return this.calculateInstance.getErrorStrings()[Xn.Ref]},r.prototype.getSheetInfo=function(){return this.sheetInfo},r.prototype.addCustomFunction=function(e,t,r){this.calculateInstance.defineFunction(t,e,r)},r.prototype.updateSheetInfo=function(){var e=this;this.sheetInfo=[],this.parent.sheets.forEach((function(t){e.sheetInfo.push({visibleName:t.name,sheet:"Sheet"+t.id,index:t.id})}))},r.prototype.getSheetRefUpdateOnDelete=function(){var e,t,r,n=this,i=this.calculateInstance.namedRanges;return i&&i.size&&(r=!0,e=Array.from(i.keys()),t=Array.from(i.values())),function(i,a){var o;r&&!a.includes(i)&&(a=a.replace(/\w+/g,(function(r){var n=e.indexOf(r);return-1!==n?(o=!0,t[n]):r})));for(var s=i.toUpperCase(),l=(a=a.toUpperCase()).indexOf(s);l>-1;)l=(a=a.split(("'"===a[l-1]&&"'"===a[l+s.length]?"'"+s+"'":s)+n.calculateInstance.sheetToken).join(n.referenceError())).indexOf(s);return{value:a,isNamedRange:o}}},r.prototype.sheetDeletion=function(t,r){var n,i,a,o=this,s=this.calculateInstance.getDependentCells(),l=this.calculateInstance.getSheetFamilyItem(r),d=this.getSheetRefUpdateOnDelete();s.forEach((function(s,h){s.forEach((function(s){n=o.calculateInstance.getFormulaInfoTable().get(s),(0,e.isNullOrUndefined)(n)||(a=d(t,n.formulaText)).value!==n.formulaText&&(i=s.slice(0,s.lastIndexOf(o.calculateInstance.sheetToken)+1),a.sheetId=l.tokenToParentObject.has(i)?Number(l.tokenToParentObject.get(i)):parseInt(s.split("!")[1],10)+1,o.updateDataContainer([o.calculateInstance.rowIndex(s)-1,o.calculateInstance.colIndex(s)-1],a),o.calculateInstance.refresh(n.getParsedFormula())),i=h.slice(0,h.lastIndexOf(o.calculateInstance.sheetToken)+1),r===(l.tokenToParentObject.has(i)?l.tokenToParentObject.get(i):h.split("!")[1])&&(o.calculateInstance.getFormulaInfoTable().delete(h),o.calculateInstance.clearFormulaDependentCells(h))}))}))},r.prototype.renameUpdation=function(e){var t,r,n=this,i=e.value,a=e.pName,o=e.pName.toUpperCase(),s=new RegExp("[!@#$%^&()+=';,.{}|\\\":<>~_-]","g"),l=new RegExp(a.replace(s,"\\$&")+'(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',"gi"),d=function(e){wr(e.value1)&&e.value1.toUpperCase().includes(o)&&e.value1.match(l)&&(e.value1=e.value1.replace(l,i)),wr(e.value2)&&e.value2.toUpperCase().includes(o)&&e.value2.match(l)&&(e.value2=e.value2.replace(l,i))};this.sheetInfo.forEach((function(e,s){if((t=Fn(n.parent,s))&&t.rows&&t.rows.length)for(var h=0,p=t.rows.length;h<p;h++)if(t.rows[h]&&t.rows[h].cells)for(var c=0,u=t.rows[h].cells.length;c<u;c++)(r=zn(h,c,t,!1,!0)).formula&&wr(r.formula)&&r.formula.toUpperCase().includes(o)&&r.formula.match(l)&&(r.formula=r.formula.replace(l,i)),r.validation&&d(r.validation),r.chart&&r.chart.length&&r.chart.forEach((function(e){if(e.range.includes("!")){var t=e.range.lastIndexOf("!"),r=e.range.substring(0,t).toUpperCase();r.startsWith("'")&&r.endsWith("'")&&(r=r.slice(1,-1)),r===o&&(e.range=i+e.range.substring(t))}}));if(t&&t.columns&&t.columns.length)for(var f=void 0,g=(h=0,t.columns.length);h<g;h++)(f=t.columns[h])&&f.validation&&d(f.validation);var m=n.parent.definedNames;for(h=0;h<m.length;h++)wr(m[h].refersTo)&&m[h].refersTo.includes(a)&&m[h].refersTo.match(l)&&(m[h].refersTo=m[h].refersTo.replace(l,i),m[h].scope.includes(a)&&(m[h].scope=i));n.calculateInstance.updateNamedRange(a,i),e.visibleName===a&&(e.visibleName=i)}))},r.prototype.updateDataContainer=function(e,t){for(var r,n,a,o=0,s=this.parent.sheets.length;o<s;o++)if((r=Fn(this.parent,o)).id===t.sheetId){e[0]in r.rows?(n=r.rows[e[0]],e[1]in n.cells?((a=n.cells[e[1]]).formula=t.isNamedRange?a.formula:t.value,t.visible?o===this.parent.activeSheetIndex&&r.activeCell===i(e[0],e[1])&&this.parent.notify(rr,{}):"Automatic"===this.parent.calculationMode&&(a.value=this.referenceError())):n.cells[e[1]]=a={}):(n=r.rows[e[0]]={})[e[1]]=a={};break}},r.prototype.parseSheetRef=function(e,t){var r,n,i,a,o,s,l=new RegExp("[!@#$%^&()+=';,.{}|\":<>~_-]","g"),d=0,h=this.getSheetInfo(),p=h.length,c=[];c.length=0;var u,f='(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',g=RegExp;for(d=0;d<p;d++)if(h[d].sheet!==h[d].visibleName&&(r=new g(h[d].visibleName.replace(l,"\\$&")+f,"gi"),a=d,e.match(r))){for(var m=d+1;m<p;m++)h[m].visibleName.includes(h[d].visibleName)&&(n=new g(h[m].visibleName.replace(l,"\\$&")+f,"gi"),i=e.search(n),o=e.search(r),i>-1&&(i<o||i===o&&h[m].visibleName.length>h[d].visibleName.length)&&(s=new RegExp("Sheet","gi"),0!==h[m].visibleName.search(s)&&(r=n,a=m)));e=e.replace(r,a+"/"),c.push(a)}for(d=0;d<c.length;)r=new g(c[d]+"/"+f,"gi"),u=t?"`"+h[c[d]].sheet+"`":h[c[d]].sheet,e=e.replace(r,u),d++;return e},r.prototype.registerSheet=function(e,t){var r;for(void 0===e&&(e=0),void 0===t&&(t=this.parent.sheets.length);e<t;)r=Fn(this.parent,e).id+"",this.calculateInstance.registerGridAsSheet(r,r,this.calcID),e++},r.prototype.unRegisterSheet=function(e,t,r){var n;if(void 0===e&&(e=0),void 0===t&&(t=this.parent.sheets.length),this.calculateInstance.tokenCount=0,r)this.calculateInstance.unregisterGridAsSheet(n,n,r);else for(;e<t;)n=Fn(this.parent,e).id+"",this.calculateInstance.unregisterGridAsSheet(n,n),e++},r.prototype.getUniqueRange=function(e){e.range=this.calculateInstance.uniqueRange},r.prototype.removeUniquecol=function(e){if(e&&e.clearAll)this.clearAllUniqueFormulaValue();else for(var r=this.parent.getActiveSheet(),n=0;n<this.calculateInstance.uniqueRange.length;n++){var i=this.calculateInstance.uniqueRange[n].split(":")[0].split("!");if(i[0]===r.name&&i[1]===r.activeCell){var o=t(this.calculateInstance.uniqueRange[n]);this.calculateInstance.uniqueRange.splice(n,1);for(var s=o[0];s<=o[2];s++)for(var l=o[1];l<=o[3];l++){zn(s,l,this.parent.getActiveSheet()).formula="",this.parent.updateCellDetails({value:"",formula:""},a([s,l]),void 0,void 0,!0)}}}},r.prototype.refreshCalculate=function(t){t.sheet=(0,e.isNullOrUndefined)(t.sheetIndex)?this.parent.getActiveSheet():Fn(this.parent,t.sheetIndex);var r=t.sheet.id+"",n=this.calculateInstance.getSheetFamilyItem(r),i=o(t.colIndex+1)+(t.rowIndex+1);n.isSheetMember&&!(0,e.isNullOrUndefined)(n.parentObjectToToken)&&(i=n.parentObjectToToken.get(r)+i),t.isFormula?this.calculateFormula(t,i):(this.calculateInstance.getFormulaInfoTable().has(i)&&(this.calculateInstance.getFormulaInfoTable().delete(i),this.calculateInstance.clearFormulaDependentCells(i)),this.calculateInstance.refresh(i,null,null,null,t.isDelete,t.deletedRange),"Automatic"===this.parent.calculationMode&&this.calculateInstance.refreshRandValues(i)),this.calculateInstance.cell="",t.isFormulaDependent=this.calculateInstance.getDependentCells().has(i),t.value&&(t.value=t.value.toString().split("^+").join("^").split("&+").join("&"))},r.prototype.calculateFormula=function(e,r){var n=this,i=e.sheet;this.autoCorrectFormula(e,i);var a=e.value;e.isClipboard&&a.toUpperCase().includes("UNIQUE")&&jn(e.rowIndex,e.colIndex,i,{value:""},!0);var o=a;a=this.parseSheetRef(a);var s=new Bs(e.rowIndex+1,e.colIndex+1,a),l=[i.usedRange.rowIndex,i.usedRange.colIndex];this.calculateInstance.valueChanged(i.id.toString(),s,!0,l,e.isRefreshing,i.name,e.isRandomFormula,null,e.isDelete,e.deletedRange,e.isDependentRefresh,e.action),!0!==this.calculateInstance.isRandomVal||e.isRandomFormula||"Automatic"!==this.parent.calculationMode||this.refreshRandomFormula();var d=zn(e.rowIndex,e.colIndex,i);if(d&&o&&!e.isDependentRefresh){var h=void 0;if(0===(o=o.toUpperCase()).indexOf("=SUM(")?h="=SUM(":0===o.indexOf("=AVERAGE(")?h="=AVERAGE(":0===o.indexOf("=ROUNDDOWN(")?h="=ROUNDDOWN(":0===o.indexOf("=ROUNDUP(")?h="=ROUNDUP(":0===o.indexOf("=MOD(")&&(h="=MOD("),h){if((o=o.replace(h,"")).includes(")")){o=o.slice(0,o.lastIndexOf(")"));for(var p=void 0,c=void 0;o.includes("(")&&o.includes(")");)c=o.indexOf("("),p=o.slice(c+1),o=o.slice(0,c)+(p.includes(")")?p.slice(p.indexOf(")")+1):p)}var u,f=o.split(this.calculateInstance.getParseArgumentSeparator()),g=void 0,m=void 0,v=void 0,y=void 0,C=void 0,b=function(r){if((u=f[r].split(":")[0]).includes("!")?(y=u.substring(0,u.lastIndexOf("!")).split("'").join(""),u=u.substring(u.lastIndexOf("!")+1)):y="",Ir(u)){y?(v=In(x.parent,y),m=void 0!==v?Fn(x.parent,v):i):m=i,C=t(u),g=zn(C[0],C[1],m);var n=zs(d.format);if(g&&g.format&&(!d.format||!e.fillType&&["Number","Currency","LongDate","Time"].every((function(e){return n!==e}))&&"Number"!==zs(g.format)))return d.format=g.format,"break"}},x=this;for(c=0;c<f.length;c++){if("break"===b(c))break}}else{var S=this.calculateInstance.getDependentFormulaCells().get(r);if(S&&S.size&&this.calculateInstance.getFormulaInfoTable().has(r)&&-1===this.calculateInstance.getFormulaInfoTable().get(r).getParsedFormula().lastIndexOf("q")&&!d.format){var w,I,E,N,R,A,k=this.calculateInstance.getSheetFamilyItem(null,this.calcID);S.forEach((function(e){w||(E=e.slice(0,e.lastIndexOf("!")+1),Ir(e=e.replace(E,""))&&(A=t(e),k.tokenToParentObject.has(E)?(R=En(n.parent,Number(k.tokenToParentObject.get(E))),N=void 0!==R?Fn(n.parent,R):i):N=i,(I=zn(A[0],A[1],N))&&I.format&&(w=I.format)))})),w&&(d.format=w)}}}},r.prototype.refreshRandomFormula=function(){var e,t,r="",n=this.calculateInstance.randCollection;if(this.calculateInstance.randomValues.size>1&&this.calculateInstance.randomValues.size===n.length)for(var i=0;i<this.calculateInstance.randomValues.size;i++){e=this.calculateInstance.rowIndex(n[i]),t=this.calculateInstance.colIndex(n[i]),r=this.calculateInstance.randomValues.get(n[i]);var a=(parseFloat(this.calculateInstance.getSheetToken(n[i]).split(this.calculateInstance.sheetToken).join(""))+1).toString(),o=Fn(this.parent,En(this.parent,Number(a)));if(o&&zn(e-1,t-1,o).formula){var s=new Bs(e,t,r);this.calculateInstance.valueChanged(a,s,!0,void 0,void 0,void 0,!1,!0)}}},r.prototype.autoCorrectFormula=function(t,r){if(!(0,e.isNullOrUndefined)(t.value)){var n=t.value;2===(n=(n=this.autoCorrectCellRef({formula:t.value})).toString()).split("(").length&&n.indexOf(")")<0&&(n+=")");var i=void 0;0===n.indexOf("=")&&(n=n.slice(1),i=!0);var a=n.match(/</g),o=n.match(/>/g),s=n.match(/=/g);if(a){for(var l="",d=0;d<a.length;d++)l+=a[d];n=n.replace(l,"<")}if(o){for(var h="",p=0;p<o.length;p++)h+=o[p];n=n.replace(h,">")}if(s){for(var c="",u=0;u<s.length;u++)c+=s[u];n=n.split(c).join("=")}n=i?"="+n:n,(a||o||s)&&(zn(t.rowIndex,t.colIndex,r).formula=n),t.value=n}},r.prototype.correctCellReference=function(e){var t,r,n,i,a,o=this,s=e.split(":");return s.forEach((function(l,d){if(r=l.split("!"),e=r[1]||l,a=null,e.includes("&"))t=e.split("&"),o.calculateInstance.isCellReference(t[1].split("$").join(""))&&(t[1]=o.getUpdatedCellRef(t[1]),a=t.join("&"));else if(o.calculateInstance.isCellReference(e.split("$").join("")))a=o.getUpdatedCellRef(e),r.length>1&&(a=r[0]+"!"+a);else if(n=l.match(/[/+\-*^><>=<=<>]+/g)){t=l.split(n[0]);for(var h=0;h<t.length;h++)r=t[h].split("!"),e=r[1]||r[0],o.calculateInstance.isCellReference(e.split("$").join(""))&&(t[h]=o.getUpdatedCellRef(e),r.length>1&&(t[h]=r[0]+"!"+t[h]));a=t.join(n[0])}a&&a!==l&&(i=!0,s[d]=a)})),{isInvalid:i,ref:s.join(":")}},r.prototype.autoCorrectCellRef=function(e){var t,r=e.formula.lastIndexOf(")");if(r>-1&&2===e.formula.split(")").length){for(var n=r-1;n>-1&&"("!==e.formula[n];){if(")"===e.formula[n])return e.formula;n--}if(n>-1){for(var i=e.formula.substring(n+1,r),a=this.calculateInstance.getParseArgumentSeparator(),o=i.split(a),s=void 0,l=0;l<o.length;l++)(t=this.correctCellReference(o[l])).isInvalid&&(s=!0,o[l]=t.ref);s&&(e.formula=e.formula.split(i).join(o.join(a)),e.isInvalid=!0)}}else e.formula.startsWith("=")&&!e.formula.includes(")")&&(t=this.correctCellReference(e.formula.substring(1,e.formula.length))).isInvalid&&(e.formula="="+t.ref,e.isInvalid=!0);return e.formula},r.prototype.getUpdatedCellRef=function(e){var t=e,r=0===(e=e.trim()).indexOf("$"),n=e.search(/[a-zA-Z]/),i=e.search(/\d/);return n=r?n-1:n,(r?i>1:i>0)&&dn(e.substring(i,e.length))?t:e.substring(n,e.length)+e.substring(0,n)},r.prototype.initiateDefinedNames=function(){for(var e=this.parent.definedNames,t=0;t<e.length;){var r=e[t],n=this.parseSheetRef(r.refersTo),i=l(n),a=!1,o=n.indexOf("http:")>-1||n.indexOf("https:")>-1;if((i=(i=i.split("$").join("")).split("=").join("")).indexOf(":")>-1){var s=i.split(":");(Ir(s[0])&&Ir(s[1])||s[0].match(/[0-9]/)&&s[1].match(/[0-9]/)||s[0].toUpperCase().match(/[A-Z]/)&&s[1].toUpperCase().match(/[A-Z]/))&&(a=!0)}else i.indexOf(":")<0&&Ir(i)&&(a=!0);o&&(a=!1),a?this.addDefinedName(r,!0,void 0,!0):(this.removeDefinedName(r.name,r.scope,!0),t--),t++}},r.prototype.addDefinedName=function(e,t,r,n){(void 0===r||r<-1)&&(r=this.parent.definedNames.length);var i,a=!0,o=e.name;if(e.refersTo.indexOf("!")<0){var s=Pn(this.parent);s=-1!==s.indexOf(" ")?"'"+s+"'":s,e.refersTo=s+"!"+(e.refersTo.indexOf("=")<0?e.refersTo:e.refersTo.split("=")[1])}var l=e.refersTo,d=this.parseSheetRef(e.refersTo);e.scope?(i=In(this.parent,e.scope))>-1&&(o=Pn(this.parent,i)+"!"+o):e.scope="Workbook",e.comment||(e.comment=""),!t&&this.checkIsNameExist(e.name,e.scope)?a=!1:(this.calculateInstance.addNamedRange(o,"="===d[0]?d.substr(1):d),"="!==d[0]&&(e.refersTo="="+l),this.parent.definedNames.indexOf(e)<0&&(this.parent.definedNames.splice(r,0,e),this.parent.notify(di,{action:"setNameBoxValue",definedName:e})));var h={name:e.name,scope:e.scope,comment:e.comment,refersTo:e.refersTo,cancel:!1};return n||this.parent.notify("actionComplete",{eventArgs:h,action:"addDefinedName"}),a},r.prototype.removeDefinedName=function(e,t,r){var n=!1,i=t||"Workbook",a=this.getIndexFromNameColl(e,i);if(a>-1){var o=e;if(t){var s=In(this.parent,t);s>-1&&(o=Pn(this.parent,s)+"!"+e)}this.calculateInstance.removeNamedRange(o);var l=this.parent.definedNames.splice(a,1);if(this.parent.notify(di,{action:"setNameBoxValue",definedName:l[0],isRemove:!0}),!r){var d={name:e,scope:i,cancel:!1};this.parent.notify("actionComplete",{eventArgs:d,action:"removeDefinedName"})}n=!0}return n},r.prototype.checkIsNameExist=function(e,t){return this.parent.definedNames.some((function(r){return r.name===e&&(t?r.scope===t:""===r.scope)}))},r.prototype.getIndexFromNameColl=function(e,t){void 0===t&&(t="");var r=-1;return this.parent.definedNames.filter((function(n,i){n.name===e&&n.scope===t&&(r=i)})),r},r.prototype.calculateNow=function(e){var t,r=this,n=new Sr.Deferred;e.promise=n.promise;var a=e.sheets.length,s=function(){if(! --a){p={isRefreshing:!0,action:"calculate"},c=r.calculateInstance.getFormulaInfoTable(),e.sheets.forEach((function(e){d=e.id.toString(),s=r.calculateInstance.getSheetFamilyItem(d),l=s.isSheetMember?s.parentObjectToToken.get(d):"",r.parent.setSheetPropertyOnMute(e,"isSheetCalculated",!0),p.sheet=e,e.rows.forEach((function(e,n){p.rowIndex=n,e&&e.cells&&e.cells.forEach((function(e,i){e&&wr(e.formula)&&(h=l+o(i+1)+(n+1),(void 0===e.value||null===e.value||!c.has(h)||t&&t[h])&&(p.colIndex=i,p.value=e.formula,r.calculateFormula(p,h)))}))}))})),n.resolve(),r.calculateInstance.cell="","Automatic"===r.parent.calculationMode&&"CalculateWorkbook"===e.scope&&r.parent.setProperties({calculationMode:"Manual"},!0);var i=r.parent.getActiveSheet();i.conditionalFormats&&i.conditionalFormats.length&&r.parent.notify(kt,{indexes:[],isAction:!0,refreshAll:!0,isEdit:!0})}var s,l,d,h,p,c},l=function(e){var n=e.id.toString(),a=r.calculateInstance.getSheetFamilyItem(n),o=a.isSheetMember?a.parentObjectToToken.get(n):"";t={};var s=r.calculateInstance.getDependentCells();return function(e,r){var n=o+i(e,r);s.has(n)&&s.get(n).forEach((function(e){t[e]||(t[e]=!0)}))}};e.sheets.forEach((function(e){e.ranges.some((function(e){return e.dataSource&&(!e.info||!e.info.loadedRange||!e.info.loadedRange.length)}))?r.parent.notify(_,{sheet:e,autoDetectFormat:!0,loadFromStartCell:!0,updateDependentCellsCallback:l(e),loadComplete:s}):s()}))},r.prototype.toFixed=function(e){var t=Number(e);return Math.round(t)!==t&&(e=t.toFixed(2)),e},r.prototype.commputeFormulaValue=function(e){var t=this.parseSheetRef(e.value);e.value=this.calculateInstance.computeExpression(t).toString()},r.prototype.getCellRefValue=function(e){var t,r=this.getSheetInfo(),n=r.length,i=this.calculateInstance.sheetToken,a=e.value,o=a.lastIndexOf(i);if(-1!==o){var s=a.substring(0,o);s.length>0&&s[0]===this.calculateInstance.getFormulaCharacter()&&(s=s.substring(1,e.value.length));for(var l=0;l<n;l++)if(s.toUpperCase()===r[l].visibleName.toUpperCase()){t=l;break}e.value=this.calculateInstance.getValueFromArg(i+t+i+a.substring(o+1).toUpperCase())}else a.length>0&&a[0]===this.calculateInstance.getFormulaCharacter()&&(e.value=this.calculateInstance.getValueFromArg(a.substring(1,e.value.length).toUpperCase()))},r.prototype.aggregateComputation=function(e){var r,n,a=this.parent.getActiveSheet(),o=On(a),s=t(o.split(":")[1]);s[0]+1===a.rowCount&&s[1]+1===a.colCount&&(o="A1:"+i(a.usedRange.rowIndex,a.usedRange.colIndex));var l=this.calculateInstance.getCellCollection(o);for(n=0;n<l.length;n++)if(dn(r=this.calculateInstance.getValueFromArg(l[n]))){e.countOnly=!1;break}if(e.Count=this.calculateInstance.getFunction("COUNTA")(o,"isAggregate"),e.Count&&!e.countOnly){var d=["SUM","AVERAGE","MIN","MAX"],h=[],p=t(a.activeCell),c=zn(p[0],p[1],a,!1,!0);for(n=0;n<4;n++){if(r=this.toFixed(this.calculateInstance.getFunction(d[n])(o,"isAggregate")),c.format){var u={formattedText:r,value:r,format:c.format,cell:{value:r,format:c.format}};this.parent.notify(re,u),r=u.formattedText}h.push(r)}e.Sum=h[0],e.Avg=h[1],e.Min=h[2],e.Max=h[3]}},r.prototype.refreshInsertDelete=function(e){var t=this;if("Sheet"!==e.modelType){var r,n=this.calculateInstance.getDependentFormulaCells(),i=En(this.parent,e.sheet.id);this.parent.sheets.forEach((function(n,a){for(var o=0,s=n.usedRange.rowIndex;o<=s;o++)for(var l=0,d=n.usedRange.colIndex;l<=d;l++)(r=zn(o,l,n,!1,!0)).formula&&wr(r.formula)&&(a===i?!e.isInsert&&("Row"===e.modelType?o>=e.startIndex&&o<=e.endIndex:l>=e.startIndex&&l<=e.endIndex)||t.updateFormula(e,r,o,l,i):r.formula.includes(e.sheet.name)&&t.updateFormula(e,r,o,l,i,!0,n))})),n.clear(),this.calculateInstance.getDependentCells().clear(),this.calculateInstance.getFormulaInfoTable().clear(),this.refreshNamedRange(e)}},r.prototype.getUpdatedFormulaOnInsertDelete=function(e){if(e.sheetNames){e.updateSheetRef||(e.updateSheetRef=this.getSheetRefUpdateOnDelete());var t=this.parseSheetRef(e.cell.formula,!1),r=t;e.sheetNames.forEach((function(t){r=e.updateSheetRef(t,r).value})),r!==t&&(e.cell.formula=r)}else this.updateFormula(e.insertDeleteArgs,e.cell,e.row,e.col,e.sheetIdx,e.otherSheet,e.formulaSheet)},r.prototype.updateFormula=function(r,n,i,s,l,d,h){var p,u,f,g,m,v,y=new RegExp(/^(?=.*[a-zA-Z])(?=.*\d)/g);n.formula&&n.formula.includes("UNIQUE")&&void 0!==i&&this.clearUniqueRange(i,s,h||r.sheet);for(var C,b,x,S=this.parseFormulaArgument({formula:this.parseSheetRef(n.formula,!0),rangeRef:!0}),w=this.getSheetInfo(),I=!n.formula.includes(this.parent.listSeparator),E=0;E<S.length;E++)if(p=S[E].trim(),(b=p.includes("$"))&&(p=p.replace(/[$]/g,"")),m=!0,this.calculateInstance.isCellReference(p)){if(g=p.includes(":"),(u=E&&S[E-1].trim())&&"!"===u[u.length-1]){if((u=u.replace(/['!]/g,""))!==(w[l].sheet===w[l].visibleName?r.sheet.name:"`"+w[l].sheet+"`"))continue}else if(d)continue;!y.test(p)&&p.indexOf(":")>-1&&(m=!1,v=!!(0,e.isNullOrUndefined)(p.match(/[0-9]/))),f=c(t(p)),this.parent.updateRangeOnInsertDelete(r,f,g,i,s,b,I)&&(S[E]=f[2]<f[0]||f[3]<f[1]?this.calculateInstance.getErrorStrings()[Xn.Ref]:m?(x=void 0,x=(b?"$":"")+o(f[1]+1)+(b?"$":"")+(f[0]+1),f[0]===f[2]&&f[1]===f[3]||(x+=":"+(b?"$":"")+o(f[3]+1)+(b?"$":"")+(f[2]+1)),x):v?a(f).replace(/\d/g,""):a(f).replace(/[a-zA-Z]/g,""),C=!0)}var N="="+S.join("");if(C){var R,A=RegExp;w.forEach((function(e){N.includes("`"+e.sheet+"`")&&(R=new A("`"+e.sheet+"`","gi"),N=N.replace(R,e.visibleName))})),n.formula!==N&&(n.formula=N,"Manual"===this.parent.calculationMode&&(r.isInsert||r.isDelete)||(n.value=null))}},r.prototype.clearUniqueRange=function(e,r,n){var i={cellIdx:[e,r,e,r],isUnique:!1,uniqueRange:"",sheetName:n.name};this.parent.notify(Ee,i);for(var a=t(i.uniqueRange),o=a[0];o<=a[2];o++)for(var s=a[1];s<=a[3];s++)delete zn(o,s,n,!1,!0).value},r.prototype.clearAllUniqueFormulaValue=function(){for(var e,r,n,i=this.calculateInstance.uniqueRange,a=0;a<i.length;a++){var o=i[a].lastIndexOf("!");if(r=Fn(this.parent,In(this.parent,i[a].substring(0,o))),!(e=zn((n=t(i[a].substring(o+1)))[0],n[1],r))||"#SPILL!"!==e.value)for(var s=n[0];s<=n[2];s++)for(var l=n[1];l<=n[3];l++)(e=zn(s,l,r))&&e.value&&delete e.value}},r.prototype.parseFormulaArgument=function(e){for(var t,r,n=0,i=[],a=this.markSpecialChar(e.formula.replace("=",""),e.rangeRef),o=RegExp,s=new o(e.rangeRef?/\(|\)|=|\^|>|<|\+|-|\*|\/|%|&/g:/\(|\)|=|\^|>|<|:|\+|-|\*|\/|%|&/g),l=new o(this.parent.listSeparator,"g"),d=(a=a.split(new o(s.source+"|"+l.source,"g"))).length;n<d;)(t=a[n])?(1===t.length?i.push(this.isUniqueChar(t)?this.getUniqueCharVal(t):t):(r=t[0],t.indexOf("!")>0?(this.isUniqueChar(r)&&(i.push(this.getUniqueCharVal(r)),t=t.substr(1)),r=t.indexOf("!")+1,i.push(t.substring(0,r)),(r=(t=t.substring(r)).indexOf(":"))>-1&&t.indexOf("!")>r?(i.push(t.substring(0,r)),i.push(":"),r=(t=t.substring(r+1)).indexOf("!")+1,i.push(t.substring(0,r)),i.push(t.substring(r))):i.push(t)):this.isUniqueChar(r)?(i.push(this.getUniqueCharVal(r)),i.push(t.substr(1))):i.push(t)),n++):n++;return e.formulaArr=i,i},r.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCSeparator:return this.parent.listSeparator;case this.uniqueCOperator:return":";case this.uniquePOperator:return"+";case this.uniqueSOperator:return"-";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueGTOperator:return">";case this.uniqueLTOperator:return"<"}return""},r.prototype.isUniqueChar=function(e){var t=e.charCodeAt(e);return t>=129&&t<=142},r.prototype.markSpecialChar=function(e,t){e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket);var r=RegExp;return(e=(e=(e=(e=(e=(e=(e=t?e.replace(new r(this.parent.listSeparator,"g"),this.parent.listSeparator+this.uniqueCSeparator):e.replace(new r(this.parent.listSeparator,"g"),this.parent.listSeparator+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator)).replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator)).replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator)).replace(/&/g,"&"+this.uniqueConcateOperator)).replace(/=/g,"="+this.uniqueEqualOperator)).replace(/\^/g,"^"+this.uniqueExpOperator)).replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},r.prototype.refreshNamedRange=function(r){var n=this;if(r.definedNames&&r.definedNames.length)r.definedNames.forEach((function(e){n.parent.removeDefinedName(e.name,e.scope),n.parent.addDefinedName(e)}));else{var i=this.parent.definedNames.length;if(i)for(var o,s,l,d,h,p,c,u,f,g=Object.assign({},this.parent.definedNames),m=new RegExp(/^(?=.*[a-zA-Z])(?=.*\d)/g),v=0;v<i;v++){u=!0;var y=(d=g[v]).refersTo.lastIndexOf("!");l=d.refersTo.substring(y+1),(p=s=d.refersTo.substring(1,y)).match(/'/g)&&(p=p.slice(1,-1)),p===r.sheet.name&&(!m.test(l)&&l.indexOf(":")>-1&&(u=!1,f=!!(0,e.isNullOrUndefined)(l.match(/[0-9]/))),o=t(l),h=this.parent.updateRangeOnInsertDelete(r,o),c=u?a(o):f?a(o).replace(/\d/g,""):a(o).replace(/[a-zA-Z]/g,""),r.isInsert?this.updateDefinedNames(d,s,c,h):"Row"===r.modelType?this.updateDefinedNames(d,s,c,h,[o[0],o[2]],r):"Column"===r.modelType&&this.updateDefinedNames(d,s,c,h,[o[1],o[3]],r))}}},r.prototype.updateDefinedNames=function(e,t,r,n,i,a){if(n){var o=this.parent.definedNames.indexOf(e),s={action:"removeDefinedName",isRemoved:!1,definedName:e.name,scope:e.scope,isEventTrigger:!0};if(this.parent.notify(pe,s),i){var l={name:e.name,comment:e.comment,refersTo:e.refersTo,scope:e.scope};if(l=new N(this.parent,"definedNames",l,!0),a.definedNames?a.definedNames.push(l):a.definedNames=[l],i[1]<i[0])return}e.refersTo=t+"!"+r,this.parent.notify(pe,{action:"addDefinedName",definedName:e,isAdded:!1,index:o,isEventTrigger:!0});var d={name:e.name,scope:e.scope,comment:e.comment,refersTo:e.refersTo,cancel:!1};this.parent.notify("actionComplete",{eventArgs:d,action:"refreshNamedRange"})}},r}(),Us=function(){function r(t){this.parent=t,this.localeObj=(0,e.getNumericObject)(this.parent.locale);var r=e.IntlBase.getDependables(e.cldrData,this.parent.locale,null).dateObject;r.dayPeriods&&r.dayPeriods&&r.dayPeriods.format&&r.dayPeriods.format.wide?(this.localeObj.am=r.dayPeriods.format.wide.am||"AM",this.localeObj.pm=r.dayPeriods.format.wide.pm||"PM"):(this.localeObj.am="AM",this.localeObj.pm="PM"),this.updateLocalizedFormats(r),this.addEventListener()}return r.prototype.numberFormatting=function(r){var n=this.parent.activeSheetIndex,i=!0;r.range&&r.range.indexOf("!")>-1&&(i=(n=In(this.parent,r.range.substring(0,r.range.lastIndexOf("!"))))===this.parent.activeSheetIndex);var a,o,s,l,d,h=Fn(this.parent,n),p=c(t(r.range?r.range.lastIndexOf("!")>-1?r.range.substring(r.range.lastIndexOf("!")+1):r.range:h.selectedRange));r.curSym=(0,e.getNumberDependable)(this.parent.locale,e.defaultCurrencyCode);for(var u=p[0];u<=p[2];u++){l=fl(h,u),d=i&&!ml(h,u);for(var f=p[1];f<=p[3];f++)s=(o=zn(u,f,h,!1,!0)).format,Jr(o,h.columns[f],l)||Vr(this.parent,h,{cell:{format:r.format},rowIdx:u,colIdx:f})||((o=zn(u,f,h)).rowSpan<0||o.colSpan<0||(a={value:o.value||0===o.value?o.value:o.hyperlink?"string"==typeof o.hyperlink?o.hyperlink:o.hyperlink.address:"",format:o.format,rowIndex:u,colIndex:f,sheetIndex:n,cell:o,refresh:i,curSymbol:r.curSym},this.getFormattedCell(a),d&&(this.setCell(a),a.td&&(this.parent.notify(ie,a),!o.wrap||l&&l.customHeight||s===r.format||this.parent.notify(Ge,{range:[u,f,u,f],wrap:!0,sheet:h,initial:!0,td:a.td,isOtherAction:!0})),s&&s!==r.format&&s.includes("[")&&-1===["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"].indexOf(Wn(r.format))&&this.removeFormatColor(a,{format:s,style:o.style}))),this.parent.setUsedRange(u,f))}h.conditionalFormats&&h.conditionalFormats.length&&this.parent.notify(kt,{indexes:p,isAction:!0,isEdit:!0}),this.parent.chartColl&&this.parent.chartColl.length&&this.parent.notify(Bt,{range:p})},r.prototype.isDigitPlaceHolder=function(e){return"#"===e||"0"===e||"?"===e||"."===e},r.prototype.parseToLocalizedFormat=function(e){if(e.decimalGroupSepsChanged&&(e.format.includes(".")||e.format.includes(","))){for(var t,r=void 0,n=void 0,i=e.format.split(""),a=0;a<i.length;a++)'"'===(r=i[a])?(n=e.format.indexOf('"',a+1))>-1&&(a=n):"_"===r||"*"===r||"\\"===r?a++:"["===r?(n=e.format.indexOf("]",a+1))>-1&&(a=n):","===r?this.isDigitPlaceHolder(i[a-1])&&(i[a]=this.localeObj.group):"."===r&&(i[a-1]?(t=i[a-1].toLowerCase(),["d","m","y","h"].some((function(e){return t===e}))||(i[a]=this.localeObj.decimal)):i[a]=this.localeObj.decimal);e.format=i.join("")}e.curChanged&&e.format.includes('"'+e.curSym+'"')&&(e.format=e.format.split('"'+e.curSym+'"').join(e.curSym))},r.prototype.updateLocalizedFormats=function(t,r){var n,i=this;Ms={currency:["$#,##0.00","$#,##0","$#,##0_);($#,##0)","$#,##0_);[Red]($#,##0)","$#,##0.00_);($#,##0.00)","$#,##0.00_);[Red]($#,##0.00)"],accounting:['_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)','_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)','_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)','_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)'],time:t.timeFormats&&"HH:mm:ss"===t.timeFormats.medium?"HH:mm:ss":"h:mm:ss AM/PM"};var a=(0,e.getNumberDependable)(this.parent.locale,e.defaultCurrencyCode),o={curChanged:"$"!==a,curSym:a,decimalGroupSepsChanged:"."!==this.localeObj.decimal&&","!==this.localeObj.group};if(o.curChanged){var s=new e.Internationalization(this.parent.locale).getNumberPattern({currency:"$",useGrouping:!0,format:"c0"},!0);if(s&&s.endsWith("$")){var l=s[s.indexOf("$")-1].trim().length?"":" ";Ms.currency.forEach((function(e,t){if(e.includes("$#,##0")){var r="",n=e.split("$#,##0.")[1];if(n)for(var i=0;"0"===n[i];)r+="0",i++;r&&(r="."+r),Ms.currency[t]=e.split("$#,##0"+r).join("#,##0"+r+l+'"'+a+'"')}})),Ms.accounting.forEach((function(e,t){if(e.slice(0,e.indexOf("#")).includes("$")){var r,n=e.split(";");n.forEach((function(e,t){e.includes("$")&&(e=e.replace("$",""),(r=e.includes("0)")?e.indexOf("0)")+2:e.lastIndexOf(e.includes("0")?"0":e.includes("?")?"?":e.includes('"-"')?'"':"#")+1)>0&&(n[t]=e.slice(0,r)+l+'"'+a+'"'+e.slice(r)))})),Ms.accounting[t]=n.join(";")}}))}else{var d=function(e,t,r){return r[t]=e.split("$").join('"'+a+'"')};Ms.currency.forEach(d),Ms.accounting.forEach(d)}}var h=["General","0","0.00","#,##0","#,##0.00","#,##0_);(#,##0)","#,##0_);[Red](#,##0)","#,##0.00_);(#,##0.00)","#,##0.00_);[Red](#,##0.00)",Ms.currency[2],Ms.currency[3],Ms.currency[4],Ms.currency[5],"0%","0.00%","0.00E+00","##0.0E+0","# ?/?","# ??/??","m/d/yyyy","d-mmm-yy","d-mmm","mmm-yy","h:mm AM/PM","h:mm:ss AM/PM","h:mm","h:mm:ss","m/d/yyyy h:mm","mm:ss","mm:ss.0","@","[h]:mm:ss"].concat(Ms.accounting);r?(n=this.customFormats).splice.apply(n,[0,h.length].concat(h)):(this.customFormats=h,this.localizedFormats=[]);var p,c=[0,1,2,3,4,37,38,39,40,5,6,7,8,9,10,11,48,12,13,14,15,16,17,18,19,20,21,22,45,47,49,46,42,41,44,43];c.forEach((function(e,t){Ps&&Ps.has(e)&&(i.customFormats[t]=Ps.get(e),(p=[5,6,7,8].indexOf(e))>-1?Ms.currency[p+2]=i.customFormats[t]:(p=[42,41,44,43].indexOf(e))>-1&&(Ms.accounting[p]=i.customFormats[t])),o.format=i.customFormats[t],i.parseToLocalizedFormat(o),i.localizedFormats[t]=o.format}));for(var u,f=function(e){g.localizedFormats.findIndex((function(t,r){return t===i.localizedFormats[e]&&r<c.length}))>-1&&(g.localizedFormats.splice(e,1),g.customFormats.splice(e,1),e--),u=e},g=this,m=c.length;m<this.localizedFormats.length;m++)f(m),m=u},r.prototype.localizedFormatAction=function(t){"getLocalizedFormats"===t.action?(t.defaultFormats=this.customFormats,t.localizedFormats=this.localizedFormats):"mapNumberFormatId"===t.action?this.updateLocalizedFormats(e.IntlBase.getDependables(e.cldrData,this.parent.locale,null).dateObject,!0):(t.curSym=(0,e.getNumberDependable)(this.parent.locale,e.defaultCurrencyCode),"parseToDefaultFormat"===t.action?this.parseToDefaultFormat(t):(t.decimalGroupSepsChanged="."!==this.localeObj.decimal&&","!==this.localeObj.group,t.curChanged="$"!==t.curSym,t.defaultFormat||(t.defaultFormat=t.format,this.parseToLocalizedFormat(t)),-1===this.localizedFormats.indexOf(t.format)&&(this.localizedFormats.push(t.format),this.customFormats.push(t.defaultFormat))))},r.prototype.parseToDefaultFormat=function(e){var t=this,r="."!==this.localeObj.decimal&&e.format.includes(this.localeObj.decimal),n=","!==this.localeObj.group&&e.format.includes(this.localeObj.group),i="$"!==e.curSym&&e.format.includes(e.curSym);if(r||n||i){var a,o,s,l=e.format.split(";");l.forEach((function(d,h){for(var p=d.split(""),c=0;c<p.length;c++)'"'===(s=p[c])?c=d.indexOf('"',c+1):"_"===s||"*"===s||"\\"===s?c++:"["===s?(a=d.indexOf("]",c+1))>-1&&(c=a):r&&s===t.localeObj.decimal?(o=p[c-1])?(o=o.toLowerCase(),["d","m","y","h"].some((function(e){return o===e}))||(p[c]=".")):p[c]=".":n&&s===t.localeObj.group?t.isDigitPlaceHolder(p[c-1])&&(p[c]=","):i&&(s===e.curSym?p[c]='"'+e.curSym+'"':e.curSym.startsWith(s)&&d.substring(c,c+e.curSym.length)===e.curSym&&p.splice(c,e.curSym.length,'"'+e.curSym+'"'));l[h]=p.join("")})),e.format=l.join(";")}},r.prototype.getFormattedCell=function(t){var r=void 0===t.value||null===t.value?"":t.value;t.sheetIndex=void 0===t.sheetIndex?this.parent.activeSheetIndex:t.sheetIndex;var n=Fn(this.parent,t.sheetIndex),i=t.cell||zn(t.rowIndex,t.colIndex,n,!1,!0),a=!1,o=new e.Internationalization;if(t.curSymbol||(t.curSymbol=(0,e.getNumberDependable)(this.parent.locale,e.defaultCurrencyCode)),t.format&&"General"!==t.format||t.skipFormatCheck||i.formula&&i.formula.toLowerCase().startsWith("=text("))t.type=zs(t.format),t.skipFormatCheck&&!t.format&&"General"===t.type&&(t.format="General");else if(t.type=t.format="General",!i.formula||i.formula&&-1===i.formula.indexOf("&-")){var s={value:r,updatedVal:r,cell:i,isEdit:t.isEdit,intl:o};this.checkDateFormat(s),(s.isDate||s.isTime)&&(a=!0,i.value=t.value=s.updatedVal,i.format&&"General"!==i.format?(t.format=i.format,t.type=zs(t.format)):i.format=t.format=Vs(s.isDate?"ShortDate":"Time"))}if(i.format&&this.isCustomType(i)){t.type="Custom";var l=i.format.indexOf("@")>-1;""!==r&&!l&&this.isPercentageValue(r.toString(),t,i)&&(r=t.value.toString());var d=void 0,h={};Ps&&Kr(this.parent)&&(i.format=t.format=this.getMatchingCustomFormat(i.format));var p=i.format;i.format=i.format.split("\\").join("");var c=i.format.split(";");if(Yn(c[0],!0,h,!0))""!==r&&(t.result=this.processCustomDateTime(t,i,"time"!==h.type,c),d=!t.formatApplied),t.result=t.result||i.value;else if(c.length>1){if(i.format.indexOf("<")>-1||i.format.indexOf(">")>-1)t.result=this.processCustomConditions(i,t);else(u=br(i,this.parent.locale,this.localeObj.group,this.localeObj.decimal,t.curSymbol)).isNumber?(i.value=u.value,this.processCustomAccounting(i,t,c,c[0]),d=!1):(t.result=this.processCustomText(i,t,c),d=!0);i.format=p}else if(l)d=!0,t.result=this.processCustomText(i,t);else{var u;if((u=br({value:r},this.parent.locale,this.localeObj.group,this.localeObj.decimal)).isNumber)if(i.value=t.value=u.value,i.format.includes("E+0")){t.format!==i.format&&(t.format=i.format),this.checkAndSetColor(t);var f=t.format.split("E")[0],g=f.split(".");"."!==this.localeObj.decimal&&1===g.length&&(g=f.split(this.localeObj.decimal)),t.result=g[0].length>1?this.scientificHashFormat(t,g):this.scientificFormat(t)}else t.result=this.processCustomNumberFormat(i,t),d=!dn(i.value);else i.format&&i.format.includes("[")&&this.removeFormatColor(t,{format:i.format,style:i.style}),d=t.dataUpdate=!0}t.dataUpdate?t.formattedText=t.result||((0,e.isNullOrUndefined)(t.value)?"":t.value.toString()):(t.value=t.result,t.formattedText=(0,e.isNullOrUndefined)(t.value)?"":t.value.toString()),t.isRightAlign=!d&&!(0,e.isNullOrUndefined)(t.value)}else{var m=this.processFormats(t,r,a,i,o,n);t.formattedText=m.fResult||(void 0===t.value||null===t.value?"":t.value.toString()),t.isRightAlign=m.rightAlign}return void 0!==t.rowIndex&&(i.format&&t.formattedText&&t.formattedText!==i.value&&"General"!==i.format?i.formattedText=t.formattedText:i.formattedText&&delete i.formattedText),t.formattedText},r.prototype.isCustomType=function(e){var t=zs(e.format);return"General"===t&&"General"!==e.format||"Time"===t&&this.parent.isEdit},r.prototype.processCustomFill=function(e,t,r,n){var i=e[e.indexOf("*")+1],a=e.split("*"+i);if(void 0===r.rowIndex||r.dataUpdate)n=n||this.processCustomNumberFormat({format:a.join(""),value:t.value},r);else{var o=void 0;if(a[1]){var s=parseFloat(t.value);s<0?(o=this.processCustomNumberFormat({format:a[1],value:Math.abs(s).toString()},r),n="-"+a[0].split("'").join("")):(o=this.processCustomNumberFormat({format:a[1],value:t.value},r),n=a[0].split("'").join("")),0===s&&(o=o.split("0").join(""))}else n=n||this.processCustomNumberFormat({format:a[0],value:t.value},r);r.isRowFill=!0,this.setCell(r),this.parent.notify(Jt,{cell:t,cellEle:r.td,rowIdx:r.rowIndex,colIdx:r.colIndex,beforeFillText:n,repeatChar:i,afterFillText:o}),n=this.parent.isPrintingProcessing?n+o:n}return n},r.prototype.processCustomDateTime=function(t,r,n,i){var a,o=this;if("."!==this.localeObj.decimal&&r.value&&r.value.toString().includes(this.localeObj.decimal)){var s=r.value.replace(this.localeObj.decimal,".");dn(s)&&(r.value=t.value=s)}var l;if(dn(r.value)){if(i.length>1&&parseFloat(r.value)<=0&&(t.formatApplied=this.processCustomAccounting(r,t,i),t.formatApplied))return t.result}else if(a=function(){var t=r.value.toString();if(t.includes(o.localeObj.dateSeparator)||t.indexOf("-")>0||t.includes(o.localeObj.timeSeparator))return!0;var n=e.IntlBase.getDependables(e.cldrData,o.parent.locale,null).dateObject,i=n.months["stand-alone"]&&n.months["stand-alone"].abbreviated;return i&&!!Object.keys(i).find((function(e){return t.includes(i[""+e])}))}(),!a)return this.processCustomText(r,t,i);var d=i[0],h=new e.Internationalization,p=function(i){var s,p;if(a){var u=void 0;if(r.format.includes("[h]")){var f=r.value.toString().split(":");f.length>1&&Number(f[0])>=24&&(u=Number(f[0])/24,f[0]="24",r.value=f.join(":"))}if(s=(p=pn(r.value,new e.Internationalization,o.parent.locale,d,r)).dateObj&&"Invalid Date"!==p.dateObj.toString()){if(p.dateObj.getFullYear()<1900)return"";var g=sn(p.dateObj,r.value.toString().includes(":"),"time"===p.type);u>=1&&(g+=u,p.dateObj=on(g)),r.value=g.toString()}}else{if(o.checkAndProcessNegativeValue(t,r.value))return t.formatApplied=!0,t.formattedText;s=(p={dateObj:on(parseFloat(r.value))}).dateObj&&"Invalid Date"!==p.dateObj.toString()}if(s){i&&n&&(t.dateObj=p.dateObj),t.formatApplied=!0;var m=void 0;if(d.startsWith("MM-dd-yyyy "))d=d.split(" ").splice(1).join(" "),m=h.formatDate(p.dateObj,{type:"date",skeleton:"yMd"})+(d?" "+h.formatDate(p.dateObj,{type:l,format:d}):"");else if(m=h.formatDate(p.dateObj,{type:l,format:d}),(d=d.toLowerCase()).startsWith("[h]"))m=(24*Number(r.value.toString().split(".")[0])+p.dateObj.getHours()).toString()+m.slice(m.indexOf("]")+1);else if(d.startsWith("[m")){m=(1440*Number(r.value.toString().split(".")[0])+60*p.dateObj.getHours()+p.dateObj.getMinutes()).toString()+m.slice(m.indexOf("]")+1)}else d.startsWith("[s")&&(m=(86400*Number(r.value.toString().split(".")[0])+60*(60*p.dateObj.getHours()+p.dateObj.getMinutes())+p.dateObj.getSeconds()).toString());return c?m.replace(o.localeObj.am,"A").replace(o.localeObj.pm,"P"):m}return""};d=d.split("_(").join(" ").split("_)").join(" "),r.format.indexOf("h")>-1&&(d=d.split("h").join("H"),l="time"),r.format.indexOf("s")>-1&&(l="time");var c=r.format.indexOf("A/P")>-1;if((r.format.indexOf("AM/PM")>-1||c)&&(d=(d=d.split("H").join("h")).split("A/P").join("AM/PM").split("AM/PM").join("a"),l="time"),r.format.indexOf("d")>-1){l="date";for(var u=d.split(" "),f=void 0,g=void 0,m=void 0,v=void 0,y=0;y<u.length;y++){v=u[y].includes(this.localeObj.dateSeparator)?this.localeObj.dateSeparator:"-",g=u[y].split(v);for(var C=0;C<g.length;C++)(f=(m=g[C]).match(/d/g))&&f.length>2&&(g[C]=m.split("d").join("E"));u[y]=g.join(v)}d=u.join(" ")}if(r.format.indexOf("m")>-1)if(r.format.indexOf("s")>-1||r.format.indexOf("h")>-1)l="time",r.format.includes(" ")&&((u=d.split(" "))[0].includes("d")||u[0].includes("y"))&&(u[0]=u[0].split("m").join("M"),d=u.join(" "));else if(l="date",(d=d.split("m").join("M")).includes("MMMMM")){var b=d;d="MMMM";var x=p()[0];return d=b.split("MMMMM").join("p"),p(t.checkDate).split("p").join(x)}return p(t.checkDate)},r.prototype.processCustomConditions=function(e,t){if(dn(e.value)){for(var r=e.format.split(";"),n=Number(e.value),i=void 0,a=void 0,o=void 0,s=0;s<r.length;s++){if(e.format=r[s],(o=Wn(e.format))&&(e.format=e.format.split("["+o+"]").join("")),!e.format.includes("[")){e.format=r[s],a=!1;break}var l=(i=e.format.split("[")[1].split("]")[0]).split("<="),d=i.split(">="),h=i.split("<"),p=i.split(">");if(2===l.length&&n<=Number(l[1])||2===d.length&&n>=Number(d[1])||2===h.length&&n<Number(h[1])||2===p.length&&n>Number(p[1])){e.format=r[s].split("["+i+"]").join(""),a=!1;break}a=2===i.split(/<=|>=|<|>/).length}return a?(this.removeFormatColor(t,{format:r.join(""),style:e.style}),this.processCustomFill("*#",e,t,"#####")):this.processCustomNumberFormat(e,t)}return e.value},r.prototype.processCustomAccounting=function(e,t,r,n){var i=parseFloat(e.value);return i<0?r[1].includes("@")||(n=r[1]):0===i&&r[2]&&!r[2].includes("@")&&(n=r[2].includes(t.curSymbol+"0")?r[2].split("0").join("#"):r[2]),!!n&&(t.result=this.processCustomNumberFormat({format:e.format,value:i<0?Math.abs(i).toString():e.value,style:e.style},t,n),!0)},r.prototype.processCustomText=function(e,t,r){var n,i=e.value||e.value?e.value.toString():"";if(r)if(r[3])n=r[3];else{if(!r[1]||!r[1].includes("@"))return i;n=r[1]}else n=e.format;var a=this.processCustomNumberFormat({format:n.split("@").join("#"),value:i.split(i).join("1")},t);return a&&(a=a.split("1").join(i),"."!==this.localeObj.decimal&&dn(a)&&a.includes(".")&&(a=a.replace(".",this.localeObj.decimal))),a},r.prototype.thousandSeparator=function(e,t){for(;e;)t/=1e3,e--;return t},r.prototype.getSeparatorCount=function(e){for(var t=0,r=["#","0"],n=0;n<e.format.length;n++)'"'===e.format[n]&&"\\"!==e.format[n-1]?n=e.format.indexOf('"',n+1):","!==e.format[n]||r.indexOf(e.format[n+1])>-1||t++;return t},r.prototype.processDigits=function(e,t){t=t.split("?").join("0");var r=e.value.toString();if((r=this.getFormattedNumber(t,parseFloat(r)))&&r.includes(this.localeObj.decimal)){var n=r.split(this.localeObj.decimal);r=n[0]+this.localeObj.decimal+n[1].split("0").join("  ")}return r||e.value},r.prototype.processFormatWithSpace=function(e,t,r){var n=" ",i={cell:t,char:n,width:0};this.parent.notify(Qt,i);for(var a,o=i.width,s={format:e,formattedText:""},l=0;l<e.length;l++)if("_"===e[l]){i.char=e[l+1],this.parent.notify(Qt,i);var d=i.width;a=Math.round(d/o),e=e.replace(e[l]+e[l+1],n.repeat(a))}var h=e.length-e.trim().length;if(h>0){if(s.formattedText=this.getFormattedNumber(e.trim(),r)," "===e[0]){for(var p=1,c=1;" "===e[c];)p++,c++;h-=p,s.formattedText=n.repeat(p)+s.formattedText}s.formattedText+=n.repeat(h)}else s.formattedText=this.getFormattedNumber(e,r);return s.format=e,s},r.prototype.removeFormatColor=function(e,t){["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"].indexOf(Wn(t.format))>-1&&(e.color=t.style&&t.style.color?t.style.color:"",this.applyColor(e))},r.prototype.processCustomNumberFormat=function(e,t,r){if(!e.format)return"";var n=e.value,i=br(e,this.parent.locale,this.localeObj.group,this.localeObj.decimal);if(i.isNumber){var a=void 0,o=void 0;e.value=i.value;var s=parseFloat(e.value.toString()),l=r||e.format;if(e.format.indexOf("[")>-1){var d=Wn(l);d?(l=l.split("["+d+"]").join(""),t.color=d.toLowerCase(),this.applyColor(t)):this.removeFormatColor(t,e)}(l.indexOf('"')>-1||l.indexOf("\\")>-1)&&(l=this.processText(l),(o=0===s&&!l.includes("#")&&!l.includes("0"))&&(l+="#"));var h=this.getSeparatorCount(e);if(h){a=!0;var p=this.thousandSeparator(h,s);-1===l.indexOf(".")&&(p=Math.round(p)),n=this.getFormattedNumber(l.split(",").join(""),p),0===p&&(n=n.replace("0",""))}if(l.indexOf("?")>-1&&(a=!0,n=this.processDigits(e,l),l=l.split("?").join("")),l.indexOf("_")>-1)a=!0,l=(p=this.processFormatWithSpace(l,e,s)).format,n=p.formattedText;if(n&&l.indexOf("?")>-1&&(n=n.replace("?"," ")),l.indexOf("*")>-1&&(a=!0,n=this.processCustomFill(l,e,t)),"General"===l&&(a=!0,n=s.toString()),a||(n=this.getFormattedNumber(l,s)),o&&n&&(n=n.replace("0","")),"#"===l[0]&&s>=0&&s<1){var c=l.split("#").join("").split(".");if(!c[0].includes("0")){0!==s||!l.includes(".")||c[1]&&c[1].includes("0")||(n=(n=this.getFormattedNumber(l,.1)).replace("1",""));var u=n.split(this.localeObj.decimal);u[0]=u[0].toString().replace(/^0+/,""),n=u.join(this.localeObj.decimal)}}"-0"===n&&(n="0")}return n},r.prototype.processText=function(e){var t=e;return t.indexOf('"')>-1?t=t.split('"').join("'"):t.indexOf("\\")>-1&&(t=t.split("\\").join("")),t},r.prototype.processFormats=function(e,t,r,n,i,a){var o;if(this.parent.isEdit&&"Scientific"===e.type&&!dn(e.value)&&(e.type="General"),""!==t){var s=void 0;switch("General"!==e.type&&"Text"!==e.type&&this.isPercentageValue(t.toString(),e,n)&&(t=e.value.toString()),e.type){case"General":(o={args:e,fResult:t,intl:i,isRightAlign:r,cell:n,rowIdx:Number(e.rowIndex),colIdx:Number(e.colIndex),sheet:a}).fResult.toString().startsWith("\n")||o.fResult.toString().endsWith("\n ")||this.autoDetectGeneralFormat(o),t=o.fResult,r=o.isRightAlign;break;case"Number":(s=br({value:t},this.parent.locale,this.localeObj.group,this.localeObj.decimal,e.curSymbol,!0,!0)).isNumber&&(n.value=e.value=s.value,t=this.applyNumberFormat(e,i),r=!0);break;case"Currency":(s=br({value:t,format:e.format},this.parent.locale,this.localeObj.group,this.localeObj.decimal,e.curSymbol)).isNumber&&(n.value=e.value=s.value,t=this.currencyFormat(e,i,n),r=!0);break;case"Percentage":(s=br({value:t},this.parent.locale,this.localeObj.group,this.localeObj.decimal,e.curSymbol,!0,!0)).isNumber&&(n.value=e.value=s.value,t=this.percentageFormat(e,i),r=!0);break;case"Accounting":t=this.accountingFormat(e,t,i,n),r=e.formatApplied;break;case"ShortDate":r=!!(t=this.checkAndProcessNegativeValue(e,e.value)?e.formattedText:this.shortDateFormat(e,i,n));break;case"LongDate":r=!!(t=this.checkAndProcessNegativeValue(e,e.value)?e.formattedText:this.longDateFormat(e,i));break;case"Time":r=!!(t=this.checkAndProcessNegativeValue(e,e.value)?e.formattedText:this.timeFormat(e,i,n));break;case"Fraction":(s=br({value:t},this.parent.locale,this.localeObj.group,this.localeObj.decimal,null,!0)).isNumber&&(n.value=e.value=s.value,t=this.fractionFormat(e),r=!0);break;case"Scientific":(s=br({value:t},this.parent.locale,this.localeObj.group,this.localeObj.decimal)).isNumber&&(n.value=e.value=s.value,t=this.scientificFormat(e),r=!0);break;case"Text":"."!==this.localeObj.decimal&&dn(t)&&t.toString().includes(".")&&(t=t.toString().replace(".",this.localeObj.decimal)),r=!1}}return{fResult:t,rightAlign:r}},r.prototype.autoDetectGeneralFormat=function(t){var r,n=t.fResult,i=t.args.cell&&t.args.cell.formula&&t.args.cell.formula.indexOf("ADDRESS(")>0,a=t.args.cell&&t.args.cell.formula&&t.args.cell.formula.indexOf("DOLLAR(")>0,o=t.args.cell&&t.args.cell.formula&&t.args.cell.formula.indexOf("TEXT(")>0;if(!(a&&t.fResult&&t.fResult.toString().includes(t.args.curSymbol)||o)){if(t.fResult&&"."!==this.localeObj.decimal)r=s=t.fResult.toString(),s.includes(this.localeObj.decimal)&&dn(s=s.replace(this.localeObj.decimal,"."))&&(s.includes("E")?t.fResult=s:(t.fResult=t.args.value=s=Number(s).toString(),jn(t.rowIdx,t.colIdx,t.sheet,{value:s},!0)),r=s.replace(".",this.localeObj.decimal));if(dn(t.fResult)){var s=Number(t.fResult).toString();if(t.fResult.toString().includes("E")?(t.args.format=Vs("Scientific"),jn(t.rowIdx,t.colIdx,t.sheet,{value:s,format:t.args.format},!0),t.args.value=s,t.fResult=this.scientificFormat(t.args)):t.args.format&&(t.args.format.indexOf("%")>-1?t.fResult=this.percentageFormat(t.args,t.intl):t.args.format.indexOf(t.args.curSymbol)>-1?t.fResult=this.currencyFormat(t.args,t.intl,t.args.cell):t.fResult=this.applyNumberFormat(t.args,t.intl)),"General"===t.args.format){if(t.args.cell&&t.args.cell.formula&&s.includes(".")&&s.length>11){var l=s.indexOf(".")+1;r=null,t.args.cell.formula.includes("RANDBETWEEN")&&(t.fResult=s=l<7?s:parseFloat(s).toFixed(0))}t.cellVal=s,t.prevVal=r,this.parseDecimalNumber(t),(0,e.isNullOrUndefined)(t.fResult)&&!(0,e.isNullOrUndefined)(t.cellVal)&&(t.fResult=t.cellVal)}t.isRightAlign=!0}t.fResult&&this.updateAutoDetectNumberFormat(t),i&&(t.isRightAlign=!1,t.fResult=n)}},r.prototype.parseDecimalNumber=function(e){var t=e.cellVal.split(".");if(t[0].length>11)e.cellVal=Math.abs(Number(t[0])).toString().substring(0,6).replace(/0+$/,""),(i=e.cellVal.length-1)>-1&&(e.fResult=this.scientificFormat(e.args,i>5?5:i));else if(t[1])if(e.cellVal.length>11){var r=10-(t[0].length-(Math.sign(Number(e.cellVal))<0?1:0));e.fResult=Number(Number(e.cellVal).toFixed(r>0?r:0)).toString()}else if(e.cellVal.includes("e-")){var n=e.cellVal.split("e-"),i=Number(n[1])+(n[0].includes(".")?n[0].split(".")[1].length:0);n[0]=n[0].replace(".",this.localeObj.decimal),1===n[1].length&&(n[1]="0"+n[1]),e.args.updateValue||jn(e.rowIdx,e.colIdx,e.sheet,{value:Number(e.cellVal).toFixed(i)},!0),e.fResult=n.join("E-")}else e.prevVal?e.fResult=e.prevVal:e.args.updateValue&&"."!==this.localeObj.decimal&&(e.fResult=e.cellVal.replace(".",this.localeObj.decimal))},r.prototype.updateAutoDetectNumberFormat=function(e){var t=e.fResult.toString(),r=e.args.cell||e.cell;if(this.isPercentageValue(t,e.args,r))r.format=t.includes(this.localeObj.decimal)?Vs("Percentage"):"0%",e.args.updateValue||(e.args.format=r.format,e.fResult=this.percentageFormat(e.args,e.intl),e.isRightAlign=!0);else if(!t.includes("\n")){var n=t?t.toString().split("/"):[],i=this.parent.isEdit&&"Scientific"===zs(r.format)&&2===n.length&&dn(n[0])&&dn(n[1]);if(t.includes(" ")||i){var a=i?n:t.split(" ");if(i||a[1].includes("/")&&dn(a[0])&&Number(a[0])%1==0){var o=i?n:a[1].split("/");if(dn(o[0])&&Number(o[0])%1==0&&dn(o[1])&&Number(o[1])%1==0)return r.format="# "+(o[0].length>1||o[1].length>1?"??/??":"?/?"),r.value=i?(Number(o[0])/Number(o[1])).toString():(Number(a[0])+Number(o[0])/Number(o[1])).toString(),void(e.args.updateValue||(e.args.value=r.value,e.args.format=r.format,e.fResult=this.fractionFormat(e.args),e.isRightAlign=!0))}}var s="";t.includes(e.args.curSymbol)&&(s=t.includes(this.localeObj.decimal)?Ms.currency[0]:Ms.currency[1],t=t.replace(e.args.curSymbol,"")),("."===this.localeObj.decimal||e.args.isEdit&&!r.formula)&&t.includes(this.localeObj.group)&&xr(t,this.parent.locale,this.localeObj.group,this.localeObj.decimal)&&(t=t.split(this.localeObj.group).join(""),s||(s=t.includes(this.localeObj.decimal)?"#,##0.00":"#,##0")),s?dn(t=t.replace(this.localeObj.decimal,"."))&&(e.args.value=Number(t).toString(),e.args.updateValue?(e.args.cell.value=e.args.value,e.args.cell.format=s):(e.args.format=s,jn(e.rowIdx,e.colIdx,e.sheet,{value:e.args.value,format:s},!0),s.includes('"')&&(s=this.processText(s)),e.fResult=this.getFormattedNumber(s,Number(e.args.value)),e.isRightAlign=!0)):"."!==this.localeObj.decimal&&"General"===e.args.format&&dn(t)&&t.includes(".")&&(e.fResult=Number(t).toString().replace(".",this.localeObj.decimal))}},r.prototype.isPercentageValue=function(e,t,r){if(e.includes("%")){var n=e.split("%");if(""!==n[0]&&""===n[1].trim()){var i=br({value:n[0]},this.parent.locale,this.localeObj.group,this.localeObj.decimal);if(i.isNumber)return t.value=Number(i.value)/100,r.value=t.value.toString(),!0}}return!1},r.prototype.findSuffix=function(e,t){var r=e.length-t.length;return e.substr(0,r<0?0:r)+t},r.prototype.applyNumberFormat=function(t,r){t.format=this.isCustomFormat(t.format);var n=t.format.split(";");if(Number(t.value)>0)t.format=n[0];else if(0===Number(t.value)){if(t.format=n[2]?n[2]:n[0],t.format.indexOf('"')>-1&&-1===t.format.indexOf("#"))return t.format=t.format.split("_").join(" ").split("*").join(" ").split("?").join(" ").split('"').join(""),t.format}else if(Number(t.value)<0)t.format=(0,e.isNullOrUndefined)(n[1])?n[0]:n[1].split("*").join(" "),t.format.indexOf("-")>-1&&(t.value=t.value.toString().split("-").join(""));else if(t.format=n[3]?n[3]:n[0],t.format=t.format.split("_").join(" ").split("*").join(" ").split("?").join(" "),t.format.indexOf("@")>-1)return t.format.split("@").join(t.value.toString());if(t.format=t.format.split("_").join(" ").split("*").join(" ").split('"').join(""),t.format.indexOf("?")>-1&&t.format.indexOf(this.localeObj.decimal)>-1){var i=t.format.split(this.localeObj.decimal)[1].length,a="";if(Number(t.value)%1)a=i>t.value.toString().split(".")[1].length?" ":"0";t.format=t.format.split("?").join(a)}else t.format=t.format.split("?").join(" ");return Number(t.value)<0&&t.cell&&t.cell.format&&(t.format=t.cell.format),r.formatNumber(Number(t.value),{format:t.format})},r.prototype.isCustomFormat=function(e){return'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-'!==e&&'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-'!==e||(e=""),e=(e=""===e?Vs("Number"):e).toString().split("_)").join(" ").split("_(").join(" ").split("[Red]").join("")},r.prototype.currencyFormat=function(t,r,n){t.format=t.format||Vs("Currency"),t.format=t.format.split("_(").join(" ").split("_)").join(" ");var i=t.format.split(";"),a=Wn(t.format),o=Number(t.value);return o>=0||(0,e.isNullOrUndefined)(i[1])?(a&&(t.color=n.style&&n.style.color?n.style.color:"",this.applyColor(t)),t.format=i[0]):(o=Math.abs(o),t.format=i[1].split("["+a+"]").join("").split("*").join(" "),a&&(t.color=a.toLowerCase(),this.applyColor(t))),t.format=this.getFormatForOtherCurrency(t.format),t.format.includes('"')&&(t.format=this.processText(t.format)),r.formatNumber(o,{format:t.format,currency:e.defaultCurrencyCode})},r.prototype.applyColor=function(e){e.refresh&&(this.setCell(e),e.td&&e.td.style.color!==e.color&&this.parent.notify(le,{style:{color:e.color},rowIdx:e.rowIndex,colIdx:e.colIndex,td:e.td}))},r.prototype.setCell=function(e){if(!e.td){var t={sheet:Fn(this.parent,e.sheetIndex),cell:e.cell,rowIdx:e.rowIndex,colIdx:e.colIndex};(e.cell.rowSpan>1||e.cell.colSpan>1)&&Xr(t),e.td=this.parent.getCell(t.rowIdx,t.colIdx)}},r.prototype.percentageFormat=function(e,t){return e.format=""===e.format?Vs("Percentage"):e.format,t.formatNumber(Number(e.value),{format:e.format})},r.prototype.accountingFormat=function(t,r,n,i){t.format=t.format||Vs("Accounting"),t.format=t.format.split("_(").join(" ").split("_)").join(" ").split("[Red]").join("").split("_").join("");var a=t.format.split(";"),o=br({value:r},this.parent.locale,this.localeObj.group,this.localeObj.decimal,t.curSymbol,!1,!0);if(o.isNumber){i.value=t.value=o.value;var s=Number(t.value);if(s>=0?t.format=0===s&&a[2]?a[2]:a[0]:(t.format=a[1].split("*").join(" "),s=Math.abs(s)),t.format.includes(t.curSymbol)&&t.format.includes('"')&&(t.format=this.processText(t.format)),t.format=this.getFormatForOtherCurrency(t.format),t.formatApplied=!0,0===s){if(t.format=this.processText(t.format.split("*").join(" ").split("?").join(" ")),!t.format.includes("#")&&!t.format.includes("0")){t.format+="#";var l=n.formatNumber(s,{format:t.format,currency:e.defaultCurrencyCode});return l.includes("0")&&(l=l.replace("0","")),t.dataUpdate?l.split(" ").join(""):l}var d=n.formatNumber(s,{format:t.format,currency:e.defaultCurrencyCode});return t.dataUpdate?d.split(" ").join(""):d}d=n.formatNumber(s,{format:t.format,currency:e.defaultCurrencyCode});return t.dataUpdate?d.split(" ").join(""):d}return a[3]?this.processCustomText(i,t,a):r},r.prototype.getFormatForOtherCurrency=function(e){if(e.indexOf("[$")>-1){var t=e.split("]")[0].split("[$")[1].split("-")[0];e=e.indexOf("0")>e.indexOf("[$")?t+e.slice(e.indexOf("]")+1,e.length):e.slice(0,e.indexOf("[$"))+t}return e},r.prototype.checkAndProcessNegativeValue=function(e,t){if(t&&dn(t)&&Number(t)<0){if(void 0===e.rowIndex||e.dataUpdate)return e.formattedText="#".repeat(e.dataUpdate?7:10),!0;e.isRowFill=!0,this.setCell(e);var r={cell:e.cell,cellEle:e.td,rowIdx:e.rowIndex,colIdx:e.colIndex,repeatChar:"#"};return this.parent.notify(Jt,r),e.formattedText=r.formattedText,!0}return!1},r.prototype.shortDateFormat=function(e,t,r){var n,i,a;Ps&&Kr(this.parent)&&r&&"m/d/yyyy"===r.format&&Ps.has(14)&&(r.format=e.format=Ps.get(14)),""===e.format||"General"===e.format||"mm-dd-yyyy"===e.format||"m/d/yyyy"===e.format?(i="MM-dd-yyyy",n={type:"date",skeleton:"yMd"}):(i=e.format,n=e.format===Vs("ShortDate")?{type:"date",skeleton:"yMd"}:{type:"date",format:e.format}),e.value=e.value.toString();var o=this.checkForDateFormat(e,r);if(e.value&&r&&(!dn(e.value)||o)){var s={value:e.value,updatedVal:e.value,cell:r,isEdit:e.isEdit,intl:t,skipCellFormat:!0,format:i};if(this.checkDateFormat(s),s.isDate||s.isTime)r.value=e.value=s.updatedVal,a=s.dateObj;else{if(!o)return"";a=on(e.value)}}else a=on(e.value);return a&&"Invalid Date"!==a.toString()?a.getFullYear()<1900||a.getFullYear()>9999?dn(e.value)?e.value.toString():"":(e.checkDate&&(e.dateObj=a),t.formatDate(a,n)):""},r.prototype.longDateFormat=function(e,t){var r;e.value=e.value.toString();var n=this.checkForDateFormat(e,e.cell);if(!(e.value.includes(this.localeObj.dateSeparator)||e.value.indexOf("-")>0)||dn(e.value)&&!n)r=on(e.value);else if(n){var i={value:e.value,updatedVal:e.value,cell:e.cell,isEdit:e.isEdit,intl:t};this.checkDateFormat(i),i.isDate||i.isTime?(r=i.dateObj,e.cell.value=e.value=sn(r).toString()):r=on(e.value)}else{if(!((r=pn(e.value,t,this.parent.locale,"",e.cell).dateObj)&&"Invalid Date"!==r.toString()&&r.getFullYear()>=1900))return dn(e.value)?e.value:"";e.cell.value=e.value=sn(r).toString()}return r&&"Invalid Date"!==r.toString()?r.getFullYear()<1900||r.getFullYear()>9999?dn(e.value)?e.value.toString():"":(e.checkDate&&(e.dateObj=r),t.formatDate(r,{type:"date",skeleton:"full"})):""},r.prototype.checkForDateFormat=function(e,t){var r,n=e.value;if("."===this.localeObj.decimal||e.isEdit&&!t.formula){if(n.includes(this.localeObj.group)&&xr(n,this.parent.locale,this.localeObj.group,this.localeObj.decimal))return n=n.replace(this.localeObj.group,""),"."!==this.localeObj.decimal&&n.includes(this.localeObj.decimal)&&(n=n.replace(this.localeObj.decimal,".")),dn(n)&&t&&(t.value=e.value=n),!1;r="."===this.localeObj.dateSeparator&&n.includes("."),"."!==this.localeObj.decimal&&!dn(n)&&n.includes(this.localeObj.decimal)&&dn(n=n.replace(this.localeObj.decimal,"."))&&t&&(t.value=e.value=n)}return r},r.prototype.timeFormat=function(t,r,n){if((0,e.isNullOrUndefined)(t.value))return"";var i,a=Vs("Time");""!==t.format&&"General"!==t.format||(i=a),i="h:mm:ss AM/PM"===t.format?"h:mm:ss a":t.format;var o=t.value.toString();if(!dn(o)&&n){var s={value:o,updatedVal:o,cell:n,isEdit:t.isEdit,intl:r,skipCellFormat:!0};if(this.checkDateFormat(s),!s.isDate&&!s.isTime)return"";n.value=o=s.updatedVal}var l=o.split(".");return(0,e.isNullOrUndefined)(l[1])||(o=parseFloat(l[0]+1+"."+l[1])||o),r.formatDate(on(o),{type:"time",skeleton:"medium",format:i})},r.prototype.scientificHashFormat=function(e,t){var r,n=this.findDecimalPlaces(e.format),i=t[0].split("0").length-1+(t[0].split("#").length-1),a=Number(e.value).toExponential(n+i);if(a.includes("e+"))r="e+";else{if(!a.includes("e-"))return a;r="e-"}var o,s=a.split(r),l=s[0].split("."),d=Number(s[1]);if("e-"===r){var h=d+Math.abs(d-i*(d>i?2:1));o=h-d,s[1]=h.toString()}else o=d%i,s[1]=(d-o).toString();o>0&&(l[0]+=l[1].substring(0,o),l[1]=l[1].slice(o),s[0]=l.join("."));var p=Number("1"+"0".repeat(n));return this.getFormattedNumber(t.join("."),Number((Math.round(Number(s[0])*p)/p).toFixed(n)))+r.toUpperCase()+this.findSuffix(e.format.split("+")[1],s[1])},r.prototype.scientificFormat=function(e,t){e.format||(e.format=Vs("Scientific"));var r=e.format.split("+")[1]||"00";void 0===t&&(t=this.findDecimalPlaces(e.format));var n=Number(e.value).toExponential(t);return n.indexOf("e+")>-1?n=n.split("e+")[0]+"E+"+this.findSuffix(r,n.split("e+")[1]):n.indexOf("e-")>-1&&(n=n.split("e-")[0]+"E-"+this.findSuffix(r,n.split("e-")[1])),n.replace(".",this.localeObj.decimal)},r.prototype.fractionFormat=function(e){var t,r,n;e.format=e.format||Vs("Fraction"),this.checkAndSetColor(e);var i=e.value.toString().split("."),a=e.format.split("?").length/2,o=e.format.split(" "),s=o[1]?o[1].split("/"):[];if(/^\?{1,3}\/\?{1,3}$|^\?\/[248]$|^\?\?\/16$/.test(o[1])){if(2===i.length&&!i[1].startsWith("0".repeat(s[1].trim().length||0))){for(var l=[0,1,Number.MAX_VALUE],d=l[0],h=l[1],p=l[2],c=s[1].includes("?")?Number("9".repeat(s[1].split("?").length-1)):Number(s[1]),u=parseFloat("0."+i[1]),f=1;f<=c;f++){var g=Math.round(u*f),m=Math.abs(u-g/f);m<p&&(d=(t=[g,f,m])[0],h=t[1],p=t[2])}var v=an(d,h);(d=(r=[d/v,h/v])[0])===(h=r[1])?i[0]=""+(parseInt(i[0],10)+1):0!==d&&(n=d+"/"+h)}}else 2!==i.length||i[1].startsWith("0".repeat(a))||(n=nn(Number(e.value)));var y=this.getFormattedNumber(o[0],Math.abs(Number(i[0])));return n?(y="0"===y?"":y,(Number(e.value)<0?"-":"")+y+" "+n):(Number(e.value)<0?"-":"")+y+" "+"  ".repeat(2*a)},r.prototype.checkAndSetColor=function(e){var t=Wn(e.format);t&&(e.format=e.format.split("["+t+"]").join(""),e.color=t.toLowerCase(),this.applyColor(e))},r.prototype.findDecimalPlaces=function(e){var t=e.toUpperCase().indexOf("E");if(t>-1){var r=e.indexOf(this.localeObj.decimal);return-1===r&&"."!==this.localeObj.decimal&&(r=e.indexOf(".")),r>0?e.substring(r+1,t).length:0}return 2},r.prototype.checkDateFormat=function(t){if(!(0,e.isNullOrUndefined)(t.value)){var r=t.cell||zn(t.rowIndex,t.colIndex,Fn(this.parent,(0,e.isNullOrUndefined)(t.sheetIndex)?this.parent.activeSheetIndex:t.sheetIndex),!1,!0),n=r.format;this.parent.isEdit&&"Scientific"===zs(r.format)&&(r.format="");var i=this.checkCustomDateFormat(t.value.toString(),r,t.isEdit);if("Invalid"!==i.val){var a=void 0;if(i.format.startsWith("[h]")){var o=i.val.split(":");o.length>1&&Number(o[0])>=24&&(a=Number(o[0])/24,o[0]="24",i.val=o.join(":"))}var s=pn(i.val,t.intl||new e.Internationalization(this.parent.locale),this.parent.locale,i.format||t.format,t.skipCellFormat&&r,i.isDateTime);if(s.dateObj&&"Invalid Date"!==s.dateObj.toString()){var l=s.dateObj.getFullYear();if(l>=1900&&l<=9999){t.isTime="time"===s.type;var d=sn(s.dateObj,i.val.includes(":"),t.isTime);if(a>=1&&(d+=a,s.dateObj=on(d)),i.val=d.toString(),(!r.format||"General"===r.format)&&(t.isTime?r.format=Vs("Time"):r.format=Vs("ShortDate"),t.updateValue))return void(r.value=i.val);t.isDate="date"===s.type||"datetime"===s.type,t.dateObj=s.dateObj}t.updatedVal=i.val}}else n&&(r.format=n)}},r.prototype.checkCustomTimeFormat=function(e,t){var r=this,n=[],i=" "+this.localeObj.am,a=" "+this.localeObj.pm,o=e.includes(i)||e.includes(a);o||(e.includes(i.toLowerCase())||e.includes(a.toLowerCase()))&&(e=e.replace(i.toLowerCase(),i).replace(a.toLowerCase(),a),o=!0);var s,l=e.split(this.localeObj.timeSeparator),d=3===l.length&&o;if(l.length<=3){var h,p,c=o?12:23;l.forEach((function(t,o){t=t.trim(),l[o]=t,t.includes(i)||t.includes(a)?(s=" AM/PM",t=t.replace(i,"").replace(a,"")):s="",dn(h=Number(t))&&h>=0?h>=24&&0===o&&l.length>1?n.push("[h]"):h<=c&&0===o?(n.push("h"+s),1===l.length&&(s?((p=e.split(" "))[0]+=r.localeObj.timeSeparator+"00",l[0]=p.join(" ")):(n=[],e="Invalid"))):h<=60&&(1===n.length||2===n.length)?(1===n.length?(n.push("mm"+s),2===l.length&&"[h]"===n[0]&&n.push("ss")):n.push("ss"),1===t.length&&(l[o]="0"+l[o])):(n=[],e="Invalid"):(n=[],e="Invalid")}))}else e="Invalid";if(n.length){e=l.join(this.localeObj.timeSeparator);var u=void 0;if(d?u=this.customFormats[24]:(u=n.join(":"),Ps&&(u=this.getMatchingCustomFormat(u))),!t.format||"General"===t.format)return t.format=u,{val:e,format:u}}return{val:e,format:""}},r.prototype.checkCustomDateFormat=function(t,r,n){var i,a,o=this,s=r.format;if(t.includes(this.localeObj.dateSeparator)&&(!t.includes(" "+this.localeObj.am)&&!t.includes(" "+this.localeObj.pm)||t.replace(" "+this.localeObj.am,"").replace(" "+this.localeObj.pm,"").includes(this.localeObj.dateSeparator)))i=this.localeObj.dateSeparator;else{if(!(t.indexOf("-")>0)){if(t.indexOf(",")>0){var l=new e.Internationalization(this.parent.locale).parseDate(t,{skeleton:"full"});return l&&!isNaN(l.getTime())?{val:t,format:"",isDateTime:!1}:{val:"Invalid",format:""}}return t.includes(this.localeObj.timeSeparator)||t.includes(" "+this.localeObj.am)||t.includes(" "+this.localeObj.pm)?this.checkCustomTimeFormat(t,r):{val:"Invalid",format:""}}i="-"}if(t.includes(this.localeObj.timeSeparator)&&t.includes(" ")){var d=t.split(" ");if(t=d.shift(),"Invalid"===(a=this.checkCustomTimeFormat(d.join(" "),r)).val)return{val:"Invalid",format:""}}var h,p,c=t.split(i),u="",f=[],g=function(e){u=f.join(i),s&&"General"!==s||(r.format=e)},m=e.IntlBase.getDependables(e.cldrData,this.parent.locale,null).dateObject,v=m.months["stand-alone"]?m.months["stand-alone"].wide:{},y=m.months["stand-alone"]?m.months["stand-alone"].abbreviated:{1:""},C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],b=function(e,t,r,n){y[""+t]&&y[""+t].toLowerCase()===r?h=C[Number(t)-1]:e.substring(0,n)===r&&(h=C[Number(t)-1])};if(2===c.length){var x=function(e){t=h,f[0]="MMM",Number(e)<=31&&Number(e)>0?(t=e+i+t,"/"!==o.localeObj.dateSeparator&&"-"!==i&&(t+=i+(new Date).getFullYear()),f.splice(0,0,"dd"),g(o.customFormats[21])):(2===e.length&&dn(e)&&Number(e)>-1&&(e=(Number(e)<30?(new Date).getFullYear().toString().slice(0,2):"19")+e),Number(e)>=1900&&Number(e)<=9999?(t="1"+i+t+i+e,f[1]="yyyy",g(o.customFormats[22])):t="Invalid")};c[0]=c[0].toLowerCase().trim(),c[1]=c[1].toLowerCase().trim(),!Number(c[0])&&c[0].length>=y[1].length?(Object.keys(v).find((function(e){return b(v[""+e].toLowerCase(),e,c[0],c[0].length)})),(0,e.isNullOrUndefined)(h)||c[0].includes(",")||x(c[1])):!Number(c[1])&&c[1].length>=y[1].length?(Object.keys(v).find((function(e){return b(v[""+e].toLowerCase(),e,c[1],c[1].length)})),(0,e.isNullOrUndefined)(h)||x(c[0])):Number(c[0])&&Number(c[0])<=12&&Number(c[1])&&("/"===this.localeObj.dateSeparator||"-"===i||n&&!r.formula)&&(h=C[Number(c[0])-1],x(c[1])),f.length||(t="Invalid")}else if(c.length>2)for(var S=function(r){dn(c[r])?4!==c[r].length&&2!==c[r].length&&1!==c[r].length&&(t="Invalid"):(c[r]=c[r].trim(),Object.keys(v).find((function(e){return b(v[""+e].toLowerCase(),e,c[r].trim().toLowerCase(),c[r].length)})),(0,e.isNullOrUndefined)(h)?t="Invalid":1===r&&(f[1]="MMM",c[2]=c[2].trim(),2===c[2].length&&dn(c[2])&&Number(c[2])>-1&&(c[2]=(Number(c[2])<30?(new Date).getFullYear().toString().slice(0,2):"19")+c[2]),Number(c[0])<=31&&Number(c[2])>=1900&&Number(c[2])<=9999&&(t=c[0]+i+h,t+=i+c[2],f[0]="d",f[2]="yy",g(w.customFormats[20]),f[2]="yyyy",u=f.join(i))))},w=this,I=0;I<c.length;I++)S(I);return a&&"Invalid"!==t&&(s&&"General"!==s||(r.format=this.customFormats[27]),u&&a.format&&(u+=" "+a.format),t+=" "+a.val,p=!0),{val:t,format:u,isDateTime:p}},r.prototype.formattedBarText=function(t){var r=this;if(""!==t.value&&!(0,e.isNullOrUndefined)(t.value)){var n={},i=t.cell&&t.cell.format||"",a=t.type||(i&&Yn(i,!0,n,!0)?n.type:""),o=new e.Internationalization,s=t.value,l=!t.showFormattedText||"dd-MM-yyyy"!==i&&"dd/MM/yyyy"!==i?Vs("ShortDate"):i,d=Vs("Time");"h:mm:ss AM/PM"===d&&(d="h:mm:ss a");var h=i.toLowerCase(),p=function(){"."!==r.localeObj.decimal&&t.value&&(t.value=t.value.toString(),dn(t.value)&&t.value.includes(".")&&(t.value=t.value.replace(".",r.localeObj.decimal)))};if("time"!==a||!h.includes("m")||h.includes(":m")||h.includes("m:")||h.includes("[m")||h.includes("am")||(a="date"),"date"===a){var c=t.value.toString();t.value=this.shortDateFormat({type:a,value:t.value,format:l},o,t.cell),t.value&&c.includes(".")&&(t.value+=" "+this.timeFormat({type:a,value:c,format:d},o))}else a.includes("time")?s&&Number(s)>=1||"datetime"===a?t.value=this.shortDateFormat({type:a,value:t.value,format:l},o)+" "+this.timeFormat({type:a,value:t.value,format:d},o):t.value=this.timeFormat({type:a,value:t.value,format:d},o):t.cell.format&&t.cell.format.includes("%")&&dn(t.cell.value)?(t.value=this.parent.getDisplayText(t.cell),t.value.includes("%")||(t.value=s,p())):p();(!t.value||t.value&&t.value.toString().indexOf("null")>-1)&&(t.value=s)}},r.prototype.getFormattedNumber=function(t,r){return(new e.Internationalization).formatNumber(Number(r),{format:t})||""},r.prototype.getMatchingCustomFormat=function(e){return"#,##0_);(#,##0)"===e&&Ps.has(37)?Ps.get(37):"#,##0_);[Red](#,##0)"===e&&Ps.has(38)?Ps.get(38):"#,##0.00_);(#,##0.00)"===e&&Ps.has(39)?Ps.get(39):"#,##0.00_);[Red](#,##0.00)"===e&&Ps.has(40)?Ps.get(40):"d-mmm-yy"===e&&Ps.has(15)?Ps.get(15):"d-mmm"===e&&Ps.has(16)?Ps.get(16):"mmm-yy"===e&&Ps.has(17)?Ps.get(17):"h:mm AM/PM"===e&&Ps.has(18)?Ps.get(18):"h:mm:ss AM/PM"===e&&Ps.has(19)?Ps.get(19):"h:mm"===e&&Ps.has(20)?Ps.get(20):"h:mm:ss"===e&&Ps.has(21)?Ps.get(21):"m/d/yyyy h:mm"===e&&Ps.has(22)?Ps.get(22):"mm:ss"===e&&Ps.has(45)?Ps.get(45):e},r.prototype.addEventListener=function(){this.parent.on(te,this.numberFormatting,this),this.parent.on(re,this.getFormattedCell,this),this.parent.on(ue,this.checkDateFormat,this),this.parent.on(me,this.formattedBarText,this),this.parent.on(fe,this.updateAutoDetectNumberFormat,this),this.parent.on(ge,this.parseDecimalNumber,this),this.parent.on(gr,this.localizedFormatAction,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(te,this.numberFormatting),this.parent.off(re,this.getFormattedCell),this.parent.off(ue,this.checkDateFormat),this.parent.off(me,this.formattedBarText),this.parent.off(fe,this.updateAutoDetectNumberFormat),this.parent.off(ge,this.parseDecimalNumber),this.parent.off(gr,this.localizedFormatAction))},r.prototype.destroy=function(){this.removeEventListener(),Ps&&!this.parent.refreshing&&(Ps.clear(),Ps=null),Ms=this.parent=this.localeObj=this.customFormats=this.localizedFormats=null},r.prototype.getModuleName=function(){return"workbookNumberFormat"},r}();function Vs(e){var t=e.split(" ").join("");if(!Ms)switch(t){case"Currency":return"$#,##0.00";case"Accounting":return'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)';case"Time":return"h:mm:ss AM/PM";default:return"General"}var r=function(e,t){return Ps&&Ps.has(t)?Ps.get(t):e},n="General";switch(t){case"Number":n=r("0.00",2);break;case"Currency":n=Ms.currency[0];break;case"Accounting":n=Ms.accounting[2];break;case"ShortDate":n=r("m/d/yyyy",14);break;case"LongDate":n="dddd, mmmm dd, yyyy";break;case"Time":n=Ms.time;break;case"Percentage":n=r("0.00%",10);break;case"Fraction":n=r("# ?/?",12);break;case"Scientific":n=r("0.00E+00",11);break;case"Text":n=r("@",49);break;case"CurrencyWithColorCode":n=Ms.currency[5]}return n}function zs(e,t){var r="General";switch(e){case"0":case"0.00":case"#,##0":case"#,##0.00":r="Number";break;case"$#,##0.00":case"$#,##0":case"$#,##0_);[Red]($#,##0)":case"$#,##0.00_);($#,##0.00)":case"$#,##0_);($#,##0)":case"$#,##0.00_);[Red]($#,##0.00)":r="Currency";break;case'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)':case'_ $ * #,##0.00_ ;_ $ * -#,##0.00_ ;_ $ * "-"??_ ;_ @_ ':case'_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)':r="Accounting";break;case"mm-dd-yyyy":case"m/d/yyyy":case"dd/MM/yyyy":r="ShortDate";break;case"dddd, mmmm dd, yyyy":r="LongDate";break;case"h:mm:ss AM/PM":r="Time";break;case"0.00%":case"0%":r="Percentage";break;case"0.00E+00":r="Scientific";break;case"@":r="Text";break;default:if(e){if(!Ms)break;if(e===Ms.time?r="Time":Ms.currency.indexOf(e)>-1?r="Currency":Ms.accounting.indexOf(e)>-1?t&&(r="Accounting"):(e.includes("?/?")||["2","4","8","16"].indexOf(e.split("?/")[1])>-1)&&(r="Fraction"),Ps&&"General"===r&&t){var n=function(t){return t.some((function(t){return Ps.has(t)&&Ps.get(t)===e}))};n([1,2,3,4])?r="Number":n([14])?r="ShortDate":n([9,10])?r="Percentage":n([11])?r="Scientific":n([49])&&(r="Text")}t=!1}}return t&&Ms&&("Currency"===r&&"$#,##0.00"!==Ms.currency[0]||"Accounting"===r&&'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)'!==Ms.accounting[2])&&(r="General"),r}function js(e,t){var r={action:"parseToDefaultFormat",format:t};return e.notify(gr,r),r.format}function _s(e,t,r){void 0===r&&(r=!0),r&&Ps&&(Ps.clear(),Ps=null),t&&t.length&&(Ps||(Ps=new Map),t.forEach((function(e){Ps.set(e.id,e.code)}))),e&&e.notify(gr,{action:"mapNumberFormatId"})}var qs=function(){function t(e){this.parent=e,this.addEventListener()}return t.prototype.destroy=function(){this.removeEventListener(),this.parent=null},t.prototype.addEventListener=function(){this.parent.on(Oe,this.initiateSortHandler,this),this.parent.on(Fe,this.updateSortedDataOnCell,this)},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Oe,this.initiateSortHandler),this.parent.off(Fe,this.updateSortedDataOnCell))},t.prototype.initiateSortHandler=function(t){var i=this,s=t.args,l=new Sr.Deferred,d=this.parent.getAddressInfo(s.range),h=Fn(this.parent,d.sheetIndex),p=c(d.indices),u=s.sortOptions||{sortDescriptors:{},containsHeader:!0},f=!1;if(t.promise=l.promise,p[0]>h.usedRange.rowIndex||p[1]>h.usedRange.colIndex)l.reject(this.parent.serviceLocator.getService(un).getConstant("SortOutOfRangeError"));else{var g=u.containsHeader,m=s.checkForHeader;if((p[0]===p[2]||m)&&(m||(p=zr(p[0],p[1],h)),f=!0,(0,e.isNullOrUndefined)(u.containsHeader)&&(g=typeof zn(p[0],p[1],h,null,!0).value!=typeof zn(p[0]+1,p[1],h,null,!0).value||(!this.isSameStyle(zn(p[0],p[1],h,null,!0).style,zn(p[0]+1,p[1],h,null,!0).style)||this.isHeaderRow(h,p)))),((0,e.isNullOrUndefined)(s.sortOptions)||(0,e.isNullOrUndefined)(s.sortOptions.containsHeader))&&!f){var v=zn(p[0],p[1],h),y=zn(p[0]+1,p[1],h);v&&y&&(g=typeof v.value!=typeof y.value||(!this.isSameStyle(v.style,y.style)||this.isHeaderRow(h,p)))}p[0]=g?p[0]+1:p[0];var C=o(r(h.activeCell)[1]+1);delete u.containsHeader;var b=u.sortDescriptors,x=new Sr.Query;if(Array.isArray(b)){b&&0!==b.length||(b=[{field:C}]);for(var S=b.length,w=S-1;w>-1;w--)if(b[S-1].field||(b[S-1].field=C),b[w].field){var I=b[w].sortComparer||this.sortComparer.bind(this,b[w],u.caseSensitive);x.sortBy(b[w].field,I),C=b[w].field}}else{b||(b={field:C}),b.field||(b.field=C);I=b.sortComparer||this.sortComparer.bind(this,b,u.caseSensitive);x.sortBy(b.field,I),C=b.field}var E=a(p);gn(this.parent,h.name+"!"+E,!0,null,null,null,null,null,void 0,null,n(C)).then((function(e){var r=new Sr.DataManager(e);if(1===e.length&&e[0].throwMergeAlert){var n=i.parent.sortCollection&&i.parent.sortCollection[i.parent.sortCollection.length-1];if(n){var a=void 0;if(t.previousSort&&t.previousSort.length)for(var o=0;o<t.previousSort.length;o++){var d=t.previousSort[o];n.sheetIndex===d.sheetIndex&&(a=d)}a?(n.columnIndex=a.columnIndex,n.order=a.order,n.sortRange=a.sortRange):i.parent.sortCollection.pop(),i.parent.notify(Oa,null)}l.reject(i.parent.serviceLocator.getService(un).getConstant("AutoFillMergeAlertMsg"))}else r.executeQuery(x).then((function(r){i.parent.notify("setActionData",{args:{action:"beforeSort",eventArgs:{range:E,cellDetails:e,sortedCellDetails:r.result}}}),i.updateSortedDataOnCell({result:r.result,range:p,sheet:h,jsonData:e});var n={range:h.name+"!"+E,sortOptions:s.sortOptions};t.previousSort&&(n.previousSort=t.previousSort),l.resolve(n)}))}))}},t.prototype.isHeaderRow=function(e,t){return!(!e.ranges||!e.ranges.length)&&e.ranges.some((function(e){if(!e.dataSource||!e.showFieldAsHeader)return!1;var n=r(e.startCell);return n[0]===t[0]&&n[1]>=t[1]&&n[1]<=t[3]}))},t.prototype.updateSortedDataOnCell=function(t){for(var r,n,a,s=this,l=[],d=function(n,a){for(var d=t.range[1],h=0;d<=t.range[3];d++,h++){if(l[h]||(l[h]=o(d+1)),a[l[h]])r=(0,e.extend)({},a[l[h]],null,!0);else{if(!zn(n,d,t.sheet))continue;r=null}(r=s.skipBorderOnSorting(n,d,t.sheet,r))&&r.validation&&delete r.validation;var p=zn(n,d,t.sheet);p&&(p.validation&&(r=Object.assign({},r,{validation:p.validation})),p.wrap&&qn(i(n,d),!1,s.parent)),r&&r.formula&&(r.formula=Br([n,d],[parseInt(a.__rowIndex,10)-1,d],t.sheet,s.parent,r,!0)),jn(n,d,t.sheet,r)}},h=t.isUndo&&{},p=t.range[0],c=0;p<=t.range[2];p++,c++)if(ml(t.sheet,p))c--;else if(a=t.result[c],t.isUndo){if(a&&(h[n=parseInt(a.__rowIndex,10)-1]=!0,d(n,a),p===n))continue;!h[p]&&t.sheet.rows[p]&&d(p,{})}else d(p,a||{})},t.prototype.skipBorderOnSorting=function(e,t,r,n){var i=zn(e,t,r),a=["borderBottom","borderTop","borderRight","borderLeft","border"];if(n&&n.style)for(var o=0,s=a;o<s.length;o++){var l=s[o];delete n.style[""+l]}if(i&&i.style)for(var d=0,h=a;d<h.length;d++){l=h[d];i.style[""+l]&&(n||(n={}),n.style||(n.style={}),n.style[""+l]=i.style[""+l])}return n},t.prototype.isSameStyle=function(e,t){e||(e={}),t||(t={});for(var r=!0,n=Object.keys(e),i=0;i<n.length;i++){if(e[n[i]]!==t[n[i]]&&this.parent.cellStyle[n[i]]!==e[n[i]]){r=!1;break}r=!0}return r},t.prototype.sortComparer=function(t,r,n,i){var a=t.order||"",o=Sr.DataUtil.fnSort(a),s=n?n.value:n,l=i?i.value:i;if(n&&i&&("string"==typeof s||"string"==typeof l)&&""!==s&&""!==l){var d=void 0,h=void 0;if(dn(n.value)&&(s=cn(n.value),"@"!==n.format&&(n.value=s),d=!0),dn(i.value)&&(l=cn(i.value),"@"!==i.format&&(i.value=l),h=!0),!d&&!h){var p={sensitivity:r?"case":"base"},c=new Intl.Collator(this.parent.locale,p);return a&&"ascending"!==a.toLowerCase()?-1*c.compare(s,l):c.compare(s,l)}}return(0,e.isNullOrUndefined)(l)||""===l?-1:(0,e.isNullOrUndefined)(s)||""===s?1:o(s,l)},t.prototype.getModuleName=function(){return"workbookSort"},t}(),Ws=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(je,this.initiateFilterHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(je,this.initiateFilterHandler)},e.prototype.initiateFilterHandler=function(e){var t=this,r=e.args,n=new Sr.Deferred,i=Fn(this.parent,p(this.parent,r.range)),o=r.filterOptions||{};if(e.promise=n.promise,o.datasource){this.setFilter(o.datasource,o.predicates,r.range,e.refresh,o.equalOrPredicates);var l={range:r.range,filterOptions:o};n.resolve(l)}else{var d=c(s(r.range));if(d[0]>i.usedRange.rowIndex||d[1]>i.usedRange.colIndex)return void n.reject("Select a cell or range inside the used range and try again.");d[0]===d[2]&&d[2]-d[0]===0&&(d[0]=0,d[1]=0,d[3]=i.usedRange.colIndex),d[2]=i.usedRange.rowIndex,d[0]=d[0]+1;var h=a(d);gn(this.parent,i.name+"!"+h,!0,!0,null,null,null,null,!1).then((function(i){var a=new Sr.DataManager(i);t.setFilter(a,o.predicates,r.range,e.refresh);var s={range:h,filterOptions:o};n.resolve(s)}))}},e.prototype.setFilter=function(e,r,n,i,a){var o=this;if(e&&r){var s,l,d=e.dataSource.json,h=Zr(e,r,a),p="__rowIndex";if(n.indexOf("!")>-1?(l=In(this.parent,n.substring(0,n.lastIndexOf("!"))),s=Fn(this.parent,l)):(s=this.parent.getActiveSheet(),l=In(this.parent,s.name)),"spreadsheet"===this.parent.getModuleName()){var c,u,f=this.parent;if(f.scrollSettings.enableVirtualization&&(s.rows||d).length>f.viewport.rowCount+2*f.getThreshold("row")||s.frozenRows||s.frozenColumns||i){d.forEach((function(e){c=h.indexOf(e)<0,gl(s,Number(e[""+p])-1,{hidden:c,isFiltered:c})})),u=l===f.activeSheetIndex;var g=t(s.paneTopLeftCell);this.parent.updateTopLeftCell(Pr(s,g[0],!0)-this.parent.frozenRowCount(s),null,"col")}else d.forEach((function(e){if(c=h.indexOf(e)<0,u)gl(s,Number(e[""+p])-1,{hidden:c,isFiltered:c});else{var t={startIndex:Number(e[""+p])-1,hide:c,isFiltering:!0,sheetIndex:l};t.endIndex=t.startIndex,o.parent.notify(Rt,t),u=t.refreshUI}}));u&&f.renderModule.refreshSheet(!1,!1,document.activeElement.id!==this.parent.element.id+"_SearchBox")}else{var m;d.forEach((function(e){m=h.indexOf(e)<0,gl(s,Number(e[""+p])-1,{hidden:m,isFiltered:m})}))}}},e.prototype.getModuleName=function(){return"workbookFilter"},e}(),Gs=function(){function r(e){this.parent=e,this.addEventListener()}return r.prototype.setImage=function(r){var n,i=r.range?r.range.lastIndexOf("!"):-1,a=r.range?i>-1?r.range.substring(i+1):r.range:this.parent.getActiveSheet().selectedRange,o=r.range&&i>-1?In(this.parent,r.range.substring(0,i)):this.parent.activeSheetIndex,s=t(a),l=(0,e.isUndefined)(o)?this.parent.getActiveSheet():Fn(this.parent,o),d=zn(s[0],s[1],l),h=r.options;if(d&&d.image)if(n=d.image,r.isPositionChanged)for(var p=0;p<n.length;p++)for(var c=0;c<h.length;c++)n[p]=h[c],document.getElementById(h[c].id)&&(r.isElementRemoved=!0,document.getElementById(h[c].id).remove());else{n=d.image;for(p=0;p<h.length;p++)n.push(h[p])}return jn(s[0],s[1],l,{image:d&&d.image?n:h},!0),r.isElementRemoved},r.prototype.addEventListener=function(){this.parent.on(Dt,this.setImage,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Dt,this.setImage)},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.getModuleName=function(){return"workbookImage"},r}(),Ys=function(){function r(e){this.parent=e,this.addEventListener()}return r.prototype.addEventListener=function(){this.parent.on(Lt,this.setChartHandler,this),this.parent.on(Ut,this.deleteChartColl,this),this.parent.on(Ht,this.refreshChartSize,this),this.parent.on(zt,this.focusChartBorder,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Lt,this.setChartHandler),this.parent.off(Ut,this.deleteChartColl),this.parent.off(Ht,this.refreshChartSize),this.parent.off(zt,this.focusChartBorder))},r.prototype.setChartHandler=function(r){var n=0,i=[];r.isInitCell=!(0,e.isNullOrUndefined)(r.isInitCell)&&r.isInitCell,r.isUndoRedo=!!(0,e.isNullOrUndefined)(r.isUndoRedo)||r.isUndoRedo,r.isPaste=!(0,e.isNullOrUndefined)(r.isPaste)&&r.isPaste;var o,s,l=r.chart;if(l.length>0)for(;n<l.length;){if(!1===r.isCut&&(l[n]={range:l[n].range,id:(0,e.getUniqueID)("e_spreadsheet_chart"),theme:l[n].theme,isSeriesInRows:l[n].isSeriesInRows,type:l[n].type,markerSettings:l[n].markerSettings,title:l[n].title,legendSettings:l[n].legendSettings,primaryXAxis:l[n].primaryXAxis,primaryYAxis:l[n].primaryYAxis,dataLabelSettings:l[n].dataLabelSettings}),document.getElementById(r.chart[n].id))return;if((o=l[n]).theme=o.theme||"Material",o.type=o.type||"Line",o.isSeriesInRows=o.isSeriesInRows||!1,(0,e.isNullOrUndefined)(o.range)){var d=this.parent.getActiveSheet();o.range=d.selectedRange,0===(i=c(t(o.range)))[0]&&i[2]===d.rowCount-1&&i[2]>d.usedRange.rowIndex&&(i[2]=d.usedRange.rowIndex),0===i[1]&&i[3]===d.colCount-1&&i[3]>d.usedRange.colIndex&&(i[3]=d.usedRange.colIndex)}else i=c(t(o.range));var h=a(i);if(o.range.indexOf("!")>0?o.range=o.range.substring(0,o.range.lastIndexOf("!"))+"!"+h:o.range=this.parent.getActiveSheet().name+"!"+h,(0,e.isNullOrUndefined)(o.id)&&(o.id=(0,e.getUniqueID)("e_spreadsheet_chart")),o.markerSettings&&o.markerSettings.visible&&(void 0===o.markerSettings.isFilled&&(o.markerSettings.isFilled=!0),void 0===o.markerSettings.shape&&(o.markerSettings.shape="Circle")),o.height=o.height||290,o.width=o.width||480,this.parent.notify(Pt,{option:o,isInitCell:r.isInitCell,triggerEvent:r.isUndoRedo,dataSheetIdx:r.dataSheetIdx,range:r.range,isPaste:r.isPaste}),this.parent.chartColl.every((function(e){return e.id!==o.id}))&&this.parent.chartColl.push(o),!r.isInitCell||r.isPaste||r.isUndo||r.isRedo){var p=void 0,u=void 0,f=void 0;if(r.range&&(r.isUndo||r.isRedo)){p=In(this.parent,r.range.substring(0,r.range.lastIndexOf("!")));var g=c(t(r.range));u=g[0],f=g[1]}else{p=void 0===r.sheetId?o.range&&o.range.lastIndexOf("!")>0?In(this.parent,o.range.substring(0,o.range.lastIndexOf("!"))):this.parent.activeSheetIndex:En(this.parent,r.sheetId);var m={clientY:Number(tn(o.top).toFixed(2)),isImage:!0},v={clientX:Number(tn(o.left).toFixed(2)),isImage:!0};this.parent.notify(cr,m),this.parent.notify(ur,v),u=m.clientY,f=v.clientX}var y=zn(u,f,d=(0,e.isUndefined)(p)?this.parent.getActiveSheet():this.parent.sheets[p]);this.parent.isPrintingProcessing||(y&&y.chart?y.chart.push(o):jn(u,f,d,{chart:[o]},!0))}else{var C=t(r.range);m={clientY:Number(tn(o.top).toFixed(2)),isImage:!0},v={clientX:Number(tn(o.left).toFixed(2)),isImage:!0};this.parent.notify(cr,m),this.parent.notify(ur,v);var b={prevTop:o.top,prevLeft:o.left,prevRowIdx:C[0],prevColIdx:C[1],prevHeight:o.height,prevWidth:o.width,currentTop:o.top,currentLeft:o.left,currentRowIdx:m.clientY,currentColIdx:v.clientX,currentHeight:o.height,currentWidth:o.width,id:o.id,requestType:"chartRefreshOnInit"};C[0]===m.clientY&&C[1]===v.clientX||(s=l.length,this.parent.notify(fr,b),n-=s-l.length)}n++}},r.prototype.refreshChartSize=function(t){for(var r,n=1,i=this.parent.sheets.length+1;n<i;){var a=this.parent.chartColl;if(r=a?a.length:0)for(;r--;){var o=this.parent.chartColl[r];if(t.overlayEle&&!(0,e.isNullOrUndefined)(t.overlayEle.querySelector("#"+o.id))){var s=this.parent.element.querySelector("."+o.id),l=(0,e.getComponent)(s,"chart")||(0,e.getComponent)(s,"accumulationchart");l&&(l.height=t.height,l.width=t.width)}}n++}},r.prototype.focusChartBorder=function(t){for(var r=0;r<this.parent.chartColl.length;r++){var n=document.getElementById(t.id),i=document.getElementById(this.parent.chartColl[r].id);n&&i&&(0,e.closest)(i,"."+n.classList[1])===n&&this.parent.notify(Pt,{option:this.parent.chartColl[r],isRefresh:!0})}},r.prototype.deleteChartColl=function(e){for(var t=0;t<this.parent.chartColl.length;t++)this.parent.chartColl[t].id+"_overlay"===e.id&&this.parent.chartColl.splice(t,1)},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.getModuleName=function(){return"workbookChart"},r}(),Xs=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.format=function(e){var r,n=this,i=e.range;if(i&&"string"==typeof i&&i.indexOf("!")>-1){var a=i.lastIndexOf("!");i=i.substring(a+1),r=this.parent.sheets[In(this.parent,e.range.substring(0,a))]}else r=this.parent.getActiveSheet();void 0===i&&(i=r.selectedRange);var o="object"!=typeof i&&e.onActionUpdate&&!e.isUndoRedo,s={range:i,style:Object.assign({},e.style),requestType:"CellFormat"};e.borderType&&(s.borderType=e.borderType);var l={},d="object"==typeof s.range?s.range:c(t(s.range)),h=[];if(Qr(this.parent,d))e.onActionUpdate&&this.parent.notify(Ct,null);else if(Object.assign(l,s.style,null,!0),o&&(this.parent.trigger("beforeCellFormat",s),this.parent.notify("actionBegin",{eventArgs:s,action:"format"}),s.cancel))e.cancel=!0;else{var p,u;e.borderType&&(this.setTypedBorder(r,e.style.border,d,e.borderType,e.onActionUpdate,h),delete e.style.border,delete s.style.border);var f,g,m={cell:null,rowIdx:0,colIdx:0,eventOnly:!0,preventEvt:!o},v=function(e){return m.cell={style:e},m.rowIdx=p,m.colIdx=u,Vr(n.parent,r,m)};if(void 0!==s.style.borderTop){for(u=d[1];u<=d[3];u++)p=d[0],v({borderTop:s.style.borderTop})||(e.isUndoRedo||(this.checkAdjacentBorder(r,"borderBottom",p-1,u),this.checkFullBorder(r,"borderBottom",p-1,u)),this.checkFullBorder(r,"borderTop",p,u),this.setCellBorder(r,m.cell.style,p,u,e.onActionUpdate,u===d[3],null,null,e.isUndoRedo,h));delete s.style.borderTop}if(void 0!==s.style.borderBottom){var y=void 0,C=void 0;for(u=d[1];u<=d[3];u++){C=(y=zn(p=d[0],u,r,!1,!0)).rowSpan>0?zn(d[2],d[1],r,!1,!0):zn(d[2],d[3],r,!1,!0),y.rowSpan>1&&C.rowSpan<0||(p=d[2]);var b={range:[p,u,p,u]};this.parent.notify(Et,b),p=b.range[0],v({borderBottom:s.style.borderBottom})||(e.isUndoRedo||(this.checkAdjacentBorder(r,"borderTop",d[2]+1,u),this.checkFullBorder(r,"borderTop",d[2]+1,u)),this.checkFullBorder(r,"borderBottom",d[2],u),this.setCellBorder(r,m.cell.style,p,u,e.onActionUpdate,u===d[3],null,null,e.isUndoRedo),this.setBottomBorderPriority(r,d[2],u))}delete s.style.borderBottom}if(void 0!==s.style.borderLeft){for(var x=d[0];x<=d[2];x++)u=d[1],v({borderLeft:s.style.borderLeft})||(e.isUndoRedo||(this.checkAdjacentBorder(r,"borderRight",x,u-1),this.checkFullBorder(r,"borderRight",x,u-1)),this.checkFullBorder(r,"borderLeft",x,u),this.setCellBorder(r,m.cell.style,x,u,e.onActionUpdate,null,null,null,e.isUndoRedo));delete s.style.borderLeft}if(void 0!==s.style.borderRight){for(var S=d[0];S<=d[2];S++){b={range:[S,u=d[3],S,u]};this.parent.notify(Et,b),u=b.range[1],v({borderRight:s.style.borderRight})||(e.isUndoRedo||(this.checkAdjacentBorder(r,"borderLeft",S,u+1),this.checkFullBorder(r,"borderLeft",S,u+1)),this.checkFullBorder(r,"borderRight",S,u),this.setCellBorder(r,m.cell.style,S,u,e.onActionUpdate,null,null,null,e.isUndoRedo))}delete s.style.borderRight}var w=Object.keys(s.style);if(w.length){var I=void 0,E=void 0,N=void 0,R=this.parent,A=R.viewport&&this.parent.getActiveSheet().id===r.id,k=this.parent.frozenRowCount(r),O=this.parent.frozenColCount(r),F=[k+R.viewport.topIndex,O+R.viewport.leftIndex,R.viewport.bottomIndex,R.viewport.rightIndex],T=void 0,D=void 0,L=void 0,P=void 0,M=w.indexOf("color")>-1,B=M||w.indexOf("backgroundColor")>-1;for(p=d[0];p<=d[2];p++)if(!(D=fl(r,p)||{}).isFiltered)for(T=p>=F[0]&&p<=F[2]||p<k,L=!1,u=d[1];u<=d[3];u++)if(!v(s.style)){if(void 0===g&&(void 0!==s.style.border?(f=s.style.border,delete s.style.border,g=!0):g=!1),I=zn(p,u,r,!1,!0),N=r.columns[u],I.rowSpan>1||I.colSpan>1)for(var H=p,U=I.rowSpan>1?p+(I.rowSpan-1):p;H<=U;H++)for(var V=u,z=I.colSpan>1?u+(I.colSpan-1):u;V<=z;V++)g&&this.setFullBorder(r,f,d,H,V,e.onActionUpdate,!0),this.setCellStyle(r,H,V,s.style);if(g&&this.setFullBorder(r,f,d,p,u,e.onActionUpdate,void 0,h),this.setCellStyle(r,p,u,s.style),A)if(T&&(u>=F[1]&&u<=F[3]||u<O)){if(P=null,M&&I.format&&I.format.includes("[")){var j=Wn(I.format);j&&(P=j.toLowerCase())}this.parent.notify(le,{style:s.style,rowIdx:p,colIdx:u,lastCell:u===d[3],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:e.onActionUpdate,formatColor:P}),B&&(E=I.validation||kl(N,p,u)&&N.validation)&&E.isHighlighted&&this.parent.notify(_t,{rowIdx:p,colIdx:u,cell:I,validation:E,col:I.validation&&N})}else D.customHeight||(L=L||Mr(s.style,e.onActionUpdate))&&this.parent.notify(le,{rowIdx:p,colIdx:u,lastCell:u===d[3],checkHeight:!0,outsideViewport:!T,onActionUpdate:e.onActionUpdate})}}g&&(s.style.border=f),rn(this.parent,h,[d[1],d[3]]),this.parent.setUsedRange(d[2],d[3]),e.refreshRibbon&&this.parent.notify(ve,null),r.conditionalFormats&&r.conditionalFormats.length&&this.parent.notify(kt,{indexes:d}),o&&(s.style=l,s.range=r.name+"!"+i,this.parent.notify("actionComplete",{eventArgs:s,action:"format"}))}},e.prototype.setBottomBorderPriority=function(e,t,r){if(ml(e,t+1)){var n=this.skipHiddenRows(e,t+1);""!==this.parent.getCellStyleValue(["borderTop"],[n,r]).borderTop&&(e.rows[t].cells[r].style.bottomPriority=!0)}},e.prototype.setFullBorder=function(e,t,r,n,i,a,o,s){var l={};n===r[0]&&(this.checkAdjacentBorder(e,"borderBottom",n-1,i),this.checkFullBorder(e,"borderBottom",n-1,i)),i===r[1]&&(this.checkAdjacentBorder(e,"borderRight",n,i-1),this.checkFullBorder(e,"borderRight",n,i-1)),i===r[3]?(this.checkAdjacentBorder(e,"borderLeft",n,i+1),this.checkFullBorder(e,"borderLeft",n,i+1)):this.checkAdjacentBorder(e,"border",n,i+1),l.borderRight=t,l.borderTop=t,l.borderLeft=t,l.borderBottom=t,this.setCellBorder(e,l,n,i,a,i===r[3],null,o,void 0,s),n===r[2]?(this.checkAdjacentBorder(e,"borderTop",n+1,i),this.checkFullBorder(e,"borderTop",n+1,i),this.setBottomBorderPriority(e,n,i)):this.checkAdjacentBorder(e,"border",n+1,i)},e.prototype.checkAdjacentBorder=function(e,t,r,n){var i={};""!==this.parent.getCellStyleValue([t],[r,n])[""+t]&&(i[""+t]=void 0,this.setCellStyle(e,r,n,i))},e.prototype.checkFullBorder=function(e,t,r,n){var i=this.parent.getCellStyleValue(["border"],[r,n]).border;if(""!==i){var a={border:void 0};["borderBottom","borderTop","borderLeft","borderRight"].forEach((function(e){e!==t&&(a[""+e]=i)})),this.setCellStyle(e,r,n,a)}},e.prototype.textDecorationActionUpdate=function(e){var r=this.parent.getActiveSheet(),n={range:r.selectedRange,style:e.style,requestType:"CellFormat"},i=c(t(r.selectedRange));if(Qr(this.parent,i))this.parent.notify(Ct,null);else if(this.parent.trigger("beforeCellFormat",n),this.parent.notify("actionBegin",{eventArgs:n,action:"format"}),n.cancel)e.cancel=!0;else{var a=e.style.textDecoration.toLowerCase(),o=a,s=t(r.activeCell),l=this.parent.getCellStyleValue(["textDecoration"],s).textDecoration.toLowerCase(),d=!1;"underline"===l?o="underline"===a?"none":"underline line-through":"line-through"===l?o="line-through"===a?"none":"underline line-through":"underline line-through"===l&&(o="underline"===a?"line-through":"underline",d=!0),"none"===o&&(d=!0);var h={textDecoration:o};this.format({style:h,range:s,refreshRibbon:e.refreshRibbon,onActionUpdate:!0});for(var p=i[0];p<=i[2];p++)for(var u=i[1];u<=i[3];u++)if(p!==s[0]||u!==s[1]){if(h={},"none"===(l=this.parent.getCellStyleValue(["textDecoration"],[p,u]).textDecoration.toLowerCase())){if(d)continue;h.textDecoration=a}else if("underline"===l||"line-through"===l)if(d){if(a!==l)continue;h.textDecoration="none"}else h.textDecoration=a!==l?"underline line-through":a;else if("underline line-through"===l){if(!d)continue;h.textDecoration="underline"===a?"line-through":"underline"}this.format({style:h,range:[p,u,p,u],refreshRibbon:e.refreshRibbon,onActionUpdate:!0})}n.range=r.name+"!"+n.range,n.style.textDecoration=o,this.parent.notify("actionComplete",{eventArgs:n,action:"format"})}},e.prototype.setTypedBorder=function(e,t,r,n,i,a){var o;if("Outer"===n){for(var s=r[1];s<=r[3];s++)this.checkAdjacentBorder(e,"borderBottom",r[0]-1,s),this.checkFullBorder(e,"borderBottom",r[0]-1,s),this.setCellBorder(e,{borderTop:t},r[0],s,i,s===r[3],void 0,void 0,void 0,a),this.checkAdjacentBorder(e,"borderTop",r[2]+1,s),this.checkFullBorder(e,"borderTop",r[2]+1,s),this.setCellBorder(e,{borderBottom:t},r[2],s,i,s===r[3],n),this.setBottomBorderPriority(e,r[2],s);for(var l=r[0];l<=r[2];l++)this.checkAdjacentBorder(e,"borderRight",l,r[1]-1),this.checkFullBorder(e,"borderRight",l,r[1]-1),this.setCellBorder(e,{borderLeft:t},l,r[1],i),this.checkAdjacentBorder(e,"borderLeft",l,r[3]+1),this.checkFullBorder(e,"borderLeft",l,r[3]+1),this.setCellBorder(e,{borderRight:t},l,r[3],i,null,n)}else if("Inner"===n){var d={range:[r[0],r[1],r[0],r[1]]};if(this.parent.notify(It,d),d.range[0]===r[0]&&d.range[1]===r[1]&&d.range[2]===r[2]&&d.range[3]===r[3])return;for(var h=r[0];h<=r[2];h++)for(var p=r[1];p<=r[3];p++){var c={};""!==(o=this.parent.getCellStyleValue(["border"],[h,p]).border)&&(c.border=void 0,p!==r[3]&&p!==r[1]&&h!==r[0]&&h!==r[2]||(h===r[0]&&(c.borderTop=o),h===r[2]&&(c.borderBottom=o),p===r[3]&&(c.borderRight=o),p===r[1]&&(c.borderLeft=o))),p!==r[3]&&(c.borderRight=t),h!==r[0]&&(c.borderTop=t),h!==r[2]&&(c.borderBottom=t),p!==r[1]&&(c.borderLeft=t),this.setCellBorder(e,c,h,p,i,p===r[3],void 0,void 0,void 0,a)}}else if("Vertical"===n)for(h=r[0];h<=r[2];h++)for(p=r[1];p<=r[3];p++){c={borderRight:t,borderLeft:t};p===r[1]&&(this.checkAdjacentBorder(e,"borderRight",h,p-1),this.checkFullBorder(e,"borderRight",h,p-1)),p===r[3]&&(this.checkAdjacentBorder(e,"borderLeft",h,p+1),this.checkFullBorder(e,"borderLeft",h,p+1)),this.setCellBorder(e,c,h,p,i)}else for(h=r[0];h<=r[2];h++)for(p=r[1];p<=r[3];p++){c={borderTop:t,borderBottom:t};h===r[0]&&(this.checkAdjacentBorder(e,"borderBottom",h-1,p),this.checkFullBorder(e,"borderBottom",h-1,p)),this.setCellBorder(e,c,h,p,i,p===r[3]),h===r[2]&&(this.checkAdjacentBorder(e,"borderTop",h+1,p),this.checkFullBorder(e,"borderTop",h+1,p),this.setBottomBorderPriority(e,h,p))}},e.prototype.setCellBorder=function(e,t,r,n,i,a,o,s,l,d){var h=zn(r,n,e),p=Il(e,n),c=fl(e,r);if(!(h&&h.isReadOnly||p&&p.isReadOnly||c&&c.isReadOnly||(this.setCellStyle(e,r,n,t),s||this.parent.getActiveSheet().id!==e.id))){if("Outer"===o&&(t.borderBottom||t.borderRight)){var u={range:[r,n,r,n]};this.parent.notify(Et,u),r=u.range[0],n=u.range[1]}l&&(""===t.borderTop&&""!==this.parent.getCellStyleValue(["borderBottom"],[r-1,n]).borderBottom&&(t.borderTop=this.parent.getCellStyleValue(["borderBottom"],[r-1,n]).borderBottom),""===t.borderLeft&&""!==this.parent.getCellStyleValue(["borderRight"],[r,n-1]).borderRight&&(t.borderLeft=this.parent.getCellStyleValue(["borderRight"],[r,n-1]).borderRight),""===t.borderRight&&""!==this.parent.getCellStyleValue(["borderLeft"],[r,n+1]).borderLeft&&(t.borderRight=this.parent.getCellStyleValue(["borderLeft"],[r,n+1]).borderLeft)),this.parent.notify(le,{style:t,rowIdx:r,colIdx:n,onActionUpdate:i,first:"",lastCell:a,isHeightCheckNeeded:!0,manualUpdate:!0,mergeBorderRows:d})}},e.prototype.setCellStyle=function(e,t,r,n){e.rows[t]?e.rows[t].cells||(e.rows[t].cells=[]):e.rows[t]={cells:[]},e.rows[t].cells[r]||(e.rows[t].cells[r]={}),e.rows[t].cells[r].style||(e.rows[t].cells[r].style={}),Object.assign(e.rows[t].cells[r].style,n,null,!0)},e.prototype.skipHiddenRows=function(e,t){return ml(e,++t)&&(t=this.skipHiddenRows(e,t)),t},e.prototype.addEventListener=function(){this.parent.on(ae,this.format,this),this.parent.on(se,this.textDecorationActionUpdate,this),this.parent.on(Ft,this.clearCellObj,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ae,this.format),this.parent.off(se,this.textDecorationActionUpdate),this.parent.off(Ft,this.clearCellObj))},e.prototype.clearCellObj=function(e){for(var t,r,n,i,a,o=e.range?e.range.lastIndexOf("!"):0,l=e.range?o>0?e.range.substring(o+1):e.range:this.parent.getActiveSheet().selectedRange,d=e.range&&o>0?In(this.parent,e.range.substring(0,o)):this.parent.activeSheetIndex,h=Fn(this.parent,d),p=c(s(l)),u=p[0],f=p[2],g=h.conditionalFormats&&h.conditionalFormats.length&&[].slice.call(h.conditionalFormats),m=[];u<=f;u++)for(n=p[1],i=p[3];n<=i;n++){var v=zn(u,n,h),y=Jr(v,Il(h,n),fl(h,u));if(v&&("Clear All"===e.type||"Clear Formats"===e.type)){if(v.rowSpan>1||v.colSpan>1){var C={range:[u,n,u,n]};this.parent.notify(It,C);var b=C.range;p[0]<=b[0]&&p[1]<=b[1]&&p[2]>=b[2]&&p[3]>=b[3]&&this.parent.notify(St,{merge:!1,range:b,type:"All",sheetIndex:d,preventRefresh:d!==this.parent.activeSheetIndex})}if(v.rowSpan&&1!==v.rowSpan||v.colSpan&&1!==v.colSpan)continue}if(v&&!y)switch(e.type){case"Clear Formats":delete v.format,delete v.rowSpan,delete v.style,delete v.wrap,delete v.colSpan,delete v.formattedText,v.hyperlink&&(v.style={textDecoration:"none",color:"inherit"});break;case"Clear Contents":v.hyperlink&&(this.parent.notify(Gt,{sheet:h,rowIdx:u,colIdx:n,preventRefresh:!0}),v.style={textDecoration:"underline",color:"#00e"}),a=!(!v.value&&!v.formula),delete v.value,delete v.formula,delete v.formattedText,a&&(r={action:"refreshCalculate",rowIndex:u,colIndex:n,sheetIndex:d},this.parent.notify(pe,r),g&&!t&&((t=r.isFormulaDependent)||qr(g,m,u,n)));break;case"Clear Hyperlinks":delete v.hyperlink;break;case"Clear All":a=!(!v.value&&!v.formula),jn(u,n,h,{},!1),a&&(r={action:"refreshCalculate",rowIndex:u,colIndex:n,sheetIndex:d},this.parent.notify(pe,r),g&&!t&&(t=r.isFormulaDependent))}}(m.length||t)&&d===this.parent.activeSheetIndex&&this.parent.notify(kt,{cfModel:!t&&m,refreshAll:t,isAction:!0})},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookcellformat"},e}(),Ks=function(){function r(e){this.parent=e,this.addEventListener()}return r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.addEventListener=function(){this.parent.on(ce,this.performEditOperation,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(ce,this.performEditOperation)},r.prototype.getModuleName=function(){return"workbookEdit"},r.prototype.performEditOperation=function(e){if("updateCellValue"===e.action)e.isFormulaDependent=this.updateCellValue(e.address,e.value,e.sheetIndex,e.isValueOnly,e.skipFormatCheck,e.isRandomFormula,e.skipCellFormat,e.isDelete,e.deletedRange,e.fillType,e.cellInformation,e.isRedo,e.isDependentUpdate,e.actionName,e.isPaste)},r.prototype.updateCellValue=function(r,n,a,o,s,l,d,h,p,c,u,f,g,m,v){var y,C;void 0===a&&(a=this.parent.activeSheetIndex),y="string"==typeof r?t(r):r;var b=Fn(this.parent,a),x=zn(y[0],y[1],b,!0);if(x||(x=b.rows[y[0]].cells[y[1]]={}),o)x.value=n,x.formattedText&&delete x.formattedText;else{var S=wr(n);S="#SPILL!"===n||S;var w=!1;x.formula&&x.formula.indexOf("UNIQUE")>-1&&""===n&&(w=!0);var I=!("Text"===zs(x.format)||S&&n.toLowerCase().startsWith("=text("));(S="Text"!==zs(x.format)&&S)||w||(x.formula&&(x.formula=""),x.value=I?cn(n,v):n);var E={action:"refreshCalculate",value:n,rowIndex:y[0],colIndex:y[1],sheetIndex:a,isFormula:S,isRandomFormula:l,isDelete:h,deletedRange:p,fillType:c,isDependentRefresh:g};if(I&&!s){var N={value:n,rowIndex:y[0],colIndex:y[1],sheetIndex:a,updatedVal:"",skipCellFormat:d};if(S)!(0,e.isNullOrUndefined)(n)&&n.toLowerCase().includes("unique(")&&n.length>0&&(x.value=n);else{var R=zs(x.format),A=n?n.toString().split("/"):[];if(("Number"!==R&&"Percentage"!==R&&"Fraction"!==R&&("Scientific"!==R||2!==A.length)||"Fraction"===R&&2!==A.length)&&this.parent.notify(ue,N),!(0,e.isNullOrUndefined)(N.updatedVal)&&N.updatedVal.length>0)x.value=N.updatedVal;else if(this.parent.isEdit&&n&&!dn(n)){var k=(0,e.getNumberDependable)(this.parent.locale,e.defaultCurrencyCode);if(x.format)if((n.includes("%")||n.includes(k))&&Yn(x.format)){var O={formattedText:n,value:n,format:"General",cell:{value:n,format:"General"},isEdit:!0};this.parent.notify(re,O),"General"!==O.format&&["Currency","Percentage"].indexOf(zs(O.format))>-1&&(x.format=O.format,x.value=O.value)}else{var F={value:x.value,format:x.format,formattedText:x.value,type:"General",cell:x,rowIndex:y[0],colIndex:y[1]};this.parent.notify(re,F)}else if(n.includes(k)||n.includes("%")||n.includes((0,e.getNumericObject)(this.parent.locale).group)){var T=new e.Internationalization,D={intl:T,updateValue:!0,value:"",curSymbol:k,cell:x};this.parent.notify(fe,{args:D,intl:T,fResult:n,cell:x})}}}}if("#SPILL!"===n)x.value=n;else{var L={cellIdx:y,isUnique:!1};if(this.parent.notify(Ee,L),"Manual"===this.parent.calculationMode&&S&&(0,e.isNullOrUndefined)(g)&&("autofill"!==m||""!==x.formula)&&!this.parent.isEdit&&(0,e.isNullOrUndefined)(this.parent.element.querySelector(".e-text-replaceInp"))&&(w=!0,f||void 0!==x.value||(w=!1)),w||h?n=x.value:(this.parent.notify(pe,E),C=E.isFormulaDependent),S){if(x.formula=E.value,!("Manual"===this.parent.calculationMode&&w&&f&&!this.parent.isEdit&&u&&u.cellDetails&&u.cellDetails.length>0&&0===u.cutCellDetails.length)||(0,e.isNullOrUndefined)(u.cellDetails[0].autoFillText)&&(0,e.isNullOrUndefined)(u.cellDetails[0].copyCellValue))n=x.value,"Manual"===this.parent.calculationMode&&u&&f&&u.displayText&&(n=x.value=u.displayText);else for(var P=0;P<u.cellDetails.length;P++)if(u.cellDetails[P].rowIndex===r[0]&&u.cellDetails[P].colIndex===r[1]){n=u.cellDetails[P].copyCellValue?x.value=u.cellDetails[P].copyCellValue:x.value=u.cellDetails[P].autoFillText;break}var M=x.formula.toLowerCase(),B="Scientific"===zs(x.format)&&!s&&this.parent.isEdit;"=now()"!==M||x.format&&"General"!==x.format&&!B?!M.includes("=time(")||x.format&&!B?M.includes("=date(")&&B&&(x.format=Vs("ShortDate")):x.format="h:mm AM/PM":x.format=Vs("ShortDate")+" h:mm"}else!x.value||"string"!=typeof x.value||0!==x.value.indexOf("www.")&&0!==x.value.indexOf("https://")&&0!==x.value.indexOf("http://")&&0!==x.value.indexOf("ftp://")||this.parent.notify(Ve,{hyperlink:x.value,cell:b.name+"!"+i(y[0],y[1])})}}return this.parent.setUsedRange(y[0],y[1],b),!this.parent.chartColl.length||this.parent.isEdit||l||this.parent.notify(Bt,{cell:x,rIdx:y[0],cIdx:y[1],sheetIdx:a,isRefreshChart:!0}),C},r}(),$s=function(){function r(e){this.parent=e,this.addEventListener()}return r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.addEventListener=function(){this.parent.on(Ve,this.setLinkHandler,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Ve,this.setLinkHandler)},r.prototype.setLinkHandler=function(r){var n,i=r.hyperlink,a=r.cell;if(a&&-1!==a.indexOf("!")){var o=a.lastIndexOf("!");if(n=Fn(this.parent,In(this.parent,a.substring(0,o))),a=a.substring(o+1),!n)return}else n=this.parent.getActiveSheet(),a=a||n.selectedRange;var s=!r.triggerEvt&&n.isProtected;if(!s||n.protectSettings.insertLink){var l,d=c(t(a));"string"==typeof i?0===i.toLowerCase().indexOf("www.")&&(i="http://"+i):0===i.address.toLowerCase().indexOf("www.")&&(i.address="http://"+i.address);for(var h=t(n.activeCell),p=d[0];p<=d[2];p++)for(var u=d[1];u<=d[3];u++)if(!s||!Tr(zn(p,u,n),Il(n,u))){var f=zn(p,u,n,null,!0);f.rowSpan<1||f.colSpan<1||(l={hyperlink:i},(0,e.isNullOrUndefined)(r.displayText)||(r.triggerEvt||r.isUndoRedo?p===h[0]&&u===h[1]&&(l.value=r.displayText,delete l.formattedText):(l.value=r.displayText,delete l.formattedText)),l.style={textDecoration:"underline",color:"#00e"},Vr(this.parent,n,{cell:l,rowIdx:p,colIdx:u,preventEvt:!r.triggerEvt}),(0,e.isNullOrUndefined)(r.triggerEvt)||this.parent.setUsedRange(p,u,n))}}},r.prototype.getModuleName=function(){return"workbookHyperlink"},r}(),Zs=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.insertModel=function(e){var r,n,i,a,o=this;if(e.model){var s,l,d,h,p=[];if("number"==typeof e.start){s=e.start,e.end=e.end||s,s>e.end&&(s=e.end,e.end=e.start),"Row"===e.modelType&&s<e.model.maxHgts.length&&(h=[]);for(var c=s;c<=e.end;c++)p.push({}),h&&h.push(null)}else e.start?(s=e.start[0].index||0,p=e.start,d=!0):(s=0,p.push({})),"Row"===e.modelType&&s<e.model.maxHgts.length&&(h=[],p.forEach((function(){h.push(null)})));var u={model:p,index:s,modelType:e.modelType,insertType:e.insertType,cancel:!1,isUndoRedo:e.isUndoRedo},f={eventArgs:u,action:"insert"};if(e.isAction){if(this.parent.notify(K,f),u.cancel)return;delete u.cancel,u.isAction=e.isAction}var g={startIndex:s,endIndex:s+p.length-1,modelType:e.modelType,sheet:e.model,isInsert:!0};if("Row"===e.modelType){if(void 0!==e.checkCount&&e.model.rows&&e.checkCount===e.model.rows.length)return;if(this.parent.notify(nr,g),e.model=e.model,e.model.rows||(e.model.rows=[]),d&&e.model.usedRange.rowIndex>-1&&s>e.model.usedRange.rowIndex)for(c=e.model.usedRange.rowIndex;c<s-1;c++)p.splice(0,0,{});var m=this.parent.frozenRowCount(e.model);if(s<m||s<=m&&e.freezePane){var v=e.model.frozenRows+p.length-(s===m&&m>0?1:0);this.parent.setSheetPropertyOnMute(e.model,"frozenRows",v),u.freezePane=!0}(r=e.model.rows).splice.apply(r,[s,0].concat(p)),h&&(n=e.model.maxHgts).splice.apply(n,[s,0].concat(h)),this.setRowColCount(g.startIndex,g.endIndex,e.model,"row"),s>e.model.usedRange.rowIndex?this.parent.setUsedRange(s+(p.length-1),e.model.usedRange.colIndex,e.model,!0):this.parent.setUsedRange(e.model.usedRange.rowIndex+p.length,e.model.usedRange.colIndex,e.model,!0);var y,C,b,x=s+p.length,S=void 0,w=void 0,I=function(t){e.model.rows[x]&&e.model.rows[x].cells&&e.model.rows[x].cells[t]&&void 0!==(S=e.model.rows[x].cells[t]).rowSpan&&S.rowSpan<0&&void 0===S.colSpan&&(w={range:[x,t,x,t],insertCount:p.length,insertModel:"Row"},E.parent.notify(Nt,w),!u.freezePane&&w.range[0]<m&&w.range[2]>m&&(u.freezePane=!0)),b=zn(s-1,t,e.model,!1,!0),y=b.style,S=zn(s+1,t,e.model,!1,!0),(y||b.wrap)&&(y&&(C={},Object.keys(y).forEach((function(e){"borderLeft"!==e&&"borderRight"!==e&&"borderTop"!==e&&"borderBottom"!==e&&(C[e]=y[e])})),S.style&&E.checkBorder(S.style,e.model.rows[s-1].cells[t].style,C)),e.isUndoRedo&&!e.isRedo||p.forEach((function(e){e.cells||(e.cells=[]),e.cells[t]||(e.cells[t]={}),y&&(e.cells[t].style||(e.cells[t].style={}),Object.assign(e.cells[t].style,C)),b.wrap&&(e.cells[t].wrap=!0)})))},E=this;for(c=0;c<=e.model.usedRange.colIndex;c++)I(c);u.sheetCount=e.model.rows.length}else if("Column"===e.modelType){if(void 0!==e.checkCount&&e.model.columns&&e.checkCount===e.model.columns.length)return;this.parent.notify(nr,g),e.model=e.model,e.model.columns||(e.model.columns=[]),s&&!e.model.columns[s-1]&&(e.model.columns[s-1]={}),(i=e.model.columns).splice.apply(i,[s,0].concat(p));var N=this.parent.frozenColCount(e.model);if(s<N||s<=N&&e.freezePane){var R=e.model.frozenColumns+p.length-(s===N&&N>0?1:0);this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",R),u.freezePane=!0}this.setRowColCount(g.startIndex,g.endIndex,e.model,"col"),s>e.model.usedRange.colIndex?this.parent.setUsedRange(e.model.usedRange.rowIndex,s+(p.length-1),e.model,!0):this.parent.setUsedRange(e.model.usedRange.rowIndex,e.model.usedRange.colIndex+p.length,e.model,!0),e.model.rows||(e.model.rows=[]);var A=[];e.columnCellsModel||(e.columnCellsModel=[]);for(c=0;c<p.length;c++)A.push(null);l=[];S=void 0;var k,O,F=void 0;for(c=0;c<=e.model.usedRange.rowIndex;c++){e.model.rows[c]?e.model.rows[c].cells||(e.model.rows[c].cells=[]):e.model.rows[c]={cells:[]},s&&!e.model.rows[c].cells[s-1]&&(e.model.rows[c].cells[s-1]={}),(a=e.model.rows[c].cells).splice.apply(a,[s,0].concat(e.columnCellsModel[c]&&e.columnCellsModel[c].cells?e.columnCellsModel[c].cells:A));x=s+p.length;if(e.model.rows[c].cells[x]&&void 0!==(S=e.model.rows[c].cells[x]).colSpan&&S.colSpan<0&&void 0===S.rowSpan&&l.push({range:[c,x,c,x],insertCount:A.length,insertModel:"Column"}),F=zn(c,s-1,e.model,!1,!0),k=F.style,S=zn(c,s+1,e.model,!1,!0),(k||F.wrap)&&(k&&(O={},Object.keys(k).forEach((function(e){"borderLeft"!==e&&"borderRight"!==e&&"borderTop"!==e&&"borderBottom"!==e&&(O[e]=k[e])})),S.style&&this.checkBorder(S.style,e.model.rows[c].cells[s-1].style,O)),!e.isUndoRedo||e.isRedo))for(var T=s;T<x;T++)e.model.rows[c].cells[T]||(e.model.rows[c].cells[T]={}),k&&(e.model.rows[c].cells[T].style||(e.model.rows[c].cells[T].style={}),Object.assign(e.model.rows[c].cells[T].style,O)),F.wrap&&(e.model.rows[c].cells[T].wrap=!0)}l.forEach((function(e){o.parent.notify(Nt,e),!u.freezePane&&e.range[1]<N&&e.range[3]>N&&(u.freezePane=!0)})),u.sheetCount=e.model.columns.length}else{if(void 0!==e.checkCount&&e.checkCount===this.parent.sheets.length)return;var D,L=p,P=Pn(this.parent),M=e.isFromUpdateAction;for(c=0;c<L.length;c++)if(L[c].name)for(T=0;T<this.parent.sheets.length;T++)if(L[c].name===this.parent.sheets[T].name){L.splice(c,1),c--;break}if(!L.length)return;delete p[0].index,this.parent.createSheet(s,p),e.activeSheetIndex?(u.activeSheetIndex=e.activeSheetIndex,this.parent.setProperties({activeSheetIndex:e.activeSheetIndex},!0)):!e.isAction&&e.start<this.parent.activeSheetIndex&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),M&&this.parent.setProperties({activeSheetIndex:In(this.parent,P)},!0),p.forEach((function(e){d&&o.updateRangeModel(e.ranges);var t=o.parent.viewport,r={sheet:e,resolveAfterFullDataLoaded:!0,indexes:[t.topIndex,t.leftIndex,t.bottomIndex,t.rightIndex],promise:new Promise((function(e){e(void 0)}))};o.parent.notify(_,r),D=e.id,o.parent.notify(pe,{action:"addSheet",visibleName:e.name,sheetName:"Sheet"+D,sheetId:D})})),u.activeSheetIndex=e.activeSheetIndex,u.sheetCount=this.parent.sheets.length}"Sheet"!==e.modelType&&(this.insertConditionalFormats(e),this.parent.notify(er,{start:s,end:s+p.length-1,modelType:e.modelType,model:e.model,isInsert:!0}),u.activeSheetIndex=In(this.parent,e.model.name),this.parent.chartColl&&this.parent.chartColl.length&&this.parent.notify(Bt,{range:t(e.model.selectedRange)})),this.parent.notify(Xe,f)}},e.prototype.setRowColCount=function(e,t,r,n){var i=n+"Count";this.parent.setSheetPropertyOnMute(r,i,r[""+i]+(t-e+1)),r.id===this.parent.getActiveSheet().id&&this.parent.notify(he,{index:r[""+i]-1,update:n,isInsert:!0,start:e,end:t})},e.prototype.updateRangeModel=function(e){e.forEach((function(e){e.dataSource&&(e.startCell=e.startCell||"A1",e.showFieldAsHeader=void 0===e.showFieldAsHeader||e.showFieldAsHeader,e.template=e.template||"",e.address=e.address||"A1")}))},e.prototype.checkBorder=function(e,t,r){e.borderLeft&&e.borderLeft===t.borderLeft&&(r.borderLeft=e.borderLeft),e.borderRight&&e.borderRight===t.borderRight&&(r.borderRight=e.borderRight),e.borderTop&&e.borderTop===t.borderTop&&(r.borderTop=e.borderTop),e.borderBottom&&e.borderBottom===t.borderBottom&&(r.borderBottom=e.borderBottom)},e.prototype.setInsertInfo=function(e,t,r,n,i){void 0===i&&(i="Row");var a=r=t+(r-1);e.ranges.forEach((function(e){e.info&&t<e.info[""+n]&&(e.info["insert"+i+"Range"]?e.info["insert"+i+"Range"].push([t,a]):e.info["insert"+i+"Range"]=[[t,a]],e.info[""+n]+=a-t+1)}))},e.prototype.insertConditionalFormats=function(e){var r=e.model.conditionalFormats;if("delete"===e.prevAction)this.parent.setSheetPropertyOnMute(e.model,"conditionalFormats",e.conditionalFormats);else if(r)for(var n=0,i=r.length;n<i;n++)r[n].range=a(jr(e,t(r[n].range),!e.isAction&&!e.isUndoRedo))},e.prototype.addEventListener=function(){this.parent.on($e,this.insertModel,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off($e,this.insertModel)},e.prototype.getModuleName=function(){return"workbookinsert"},e}(),Js=function(){function r(e){this.parent=e,this.addEventListener()}return r.prototype.deleteModel=function(e){var r=this,n=this.parent.sheets.length;if("Sheet"!==e.modelType||1!==n){var i=e.modelType.toLowerCase()+"s";if(e.start=e.start,e.start>e.end){var a=e.start;e.start=e.end,e.end=a}var o={startIndex:e.start,endIndex:e.end,modelType:e.modelType,cancel:!1,isUndoRedo:e.isUndoRedo},s={eventArgs:o,action:"delete"};if(!e.isAction||(this.parent.notify(K,s),!o.cancel)){var l,d,h=[],p=e.end-e.start+1,c={startIndex:e.start,endIndex:e.end,modelType:e.modelType,sheet:e.model,isDelete:!0},u=this.parent.scrollSettings.isFinite;if("Row"===e.modelType){if(void 0!==e.checkCount&&e.checkCount===e.model.usedRange.rowIndex)return;if(this.parent.notify(nr,c),e.model=e.model,u){if(e.start>=e.model.rowCount)return;e.end>=e.model.rowCount&&(e.end=e.model.rowCount-1)}else{if(e.start>e.model.usedRange.rowIndex)return;e.end>e.model.usedRange.rowIndex&&(e.end-=e.end-e.model.usedRange.rowIndex)}this.setRowColCount(e.start,e.end,e.model,"row"),e.start<=e.model.usedRange.rowIndex&&(this.parent.setSheetPropertyOnMute(e.model,"usedRange",{rowIndex:e.model.usedRange.rowIndex-(e.end-e.start+1),colIndex:e.model.usedRange.colIndex}),e.model.usedRange.rowIndex<0&&this.parent.setSheetPropertyOnMute(e.model,"usedRange",{rowIndex:0,colIndex:e.model.usedRange.colIndex}));var f=this.parent.frozenRowCount(e.model);e.start<f&&(f=e.end<f?e.end-e.start+1:f-e.start,f=e.model.frozenRows-f,this.parent.setSheetPropertyOnMute(e.model,"frozenRows",f),o.freezePane=!0);var g=e.end+1,m=void 0,v=void 0;if(e.model.rows[e.start]&&e.model.rows[e.start].cells)for(var y=0;y<=e.model.usedRange.colIndex;y++){if(e.model.rows[e.start].cells[y]&&void 0!==e.model.rows[e.start].cells[y].rowSpan&&e.model.rows[e.start].cells[y].rowSpan<0&&void 0===e.model.rows[e.start].cells[y].colSpan&&(v={range:[e.start,y,e.start,y]},this.parent.notify(Et,v),v.range=v.range,v.range[2]<=e.end&&((d=zn(v.range[0],y,e.model))&&d.rowSpan>1&&(d.rowSpan-(v.range[2]-e.start+1)>1?jn(v.range[0],y,e.model,{colSpan:d.rowSpan-(v.range[2]-e.start+1)},!0):delete e.model.rows[v.range[0]].cells[y].rowSpan),v=null)),e.model.rows[g]&&e.model.rows[g].cells&&e.model.rows[g].cells[y]&&void 0!==e.model.rows[g].cells[y].rowSpan&&e.model.rows[g].cells[y].rowSpan<0&&void 0===e.model.rows[g].cells[y].colSpan)if(v||(v={range:[g,y,g,y]},this.parent.notify(Et,v)),m=new Object,v.range=v.range,Object.assign(m,zn(v.range[0],v.range[1],e.model)),m&&m.rowSpan&&(m.rowSpan>1||m.colSpan>1))(x=[])[1]=y,x[3]=m.colSpan>1?y+(m.colSpan-1):y,v.range=v.range,v.range[0]<e.start?(x[0]=x[2]=v.range[0],m.rowSpan-p>1&&(x[2]+=m.rowSpan-p-1)):(x[0]=x[2]=e.start,m.rowSpan-(e.end-v.range[0]+1)>1&&(x[2]+=m.rowSpan-(e.end-v.range[0]+1)-1)),h.push({range:x,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0});v=null}o.sheetCount=e.model.usedRange.rowIndex}else if("Column"===e.modelType){if(void 0!==e.checkCount&&e.checkCount===e.model.usedRange.colIndex)return;if(this.parent.notify(nr,c),e.model=e.model,u){if(e.start>=e.model.colCount)return;e.end>=e.model.colCount&&(e.end=e.model.colCount-1)}else{if(e.start>e.model.usedRange.colIndex)return;e.end>e.model.usedRange.colIndex&&(e.end-=e.end-e.model.usedRange.colIndex)}this.setRowColCount(e.start,e.end,e.model,"col"),e.start<=e.model.usedRange.colIndex&&(this.parent.setSheetPropertyOnMute(e.model,"usedRange",{rowIndex:e.model.usedRange.rowIndex,colIndex:e.model.usedRange.colIndex-p}),e.model.usedRange.colIndex<0&&this.parent.setSheetPropertyOnMute(e.model,"usedRange",{rowIndex:e.model.usedRange.rowIndex,colIndex:0}));var C=this.parent.frozenColCount(e.model);e.start<C&&(C=e.end<C?e.end-e.start+1:C-e.start,C=e.model.frozenColumns-C,this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",C),this.parent.updateTopLeftCell(),o.freezePane=!0),l=[];for(g=e.end+1,m=void 0,v=void 0,y=0;y<=e.model.usedRange.rowIndex;y++)if(l.push({}),e.model.rows[y]&&e.model.rows[y].cells){if(e.model.rows[y].cells[e.start]&&void 0!==e.model.rows[y].cells[e.start].colSpan&&e.model.rows[y].cells[e.start].colSpan<0&&void 0===e.model.rows[y].cells[e.start].rowSpan&&(v={range:[y,e.start,y,e.start]},this.parent.notify(Et,v),v.range=v.range,v.range[3]<=e.end)){var b=zn(y,v.range[1],e.model);b&&b.colSpan>1&&(b.colSpan-(v.range[3]-e.start+1)>1?jn(y,v.range[1],e.model,{colSpan:b.colSpan-(v.range[3]-e.start+1)},!0):delete e.model.rows[y].cells[v.range[1]].colSpan),v=null}var x;if(e.model.rows[y].cells[g]&&void 0!==e.model.rows[y].cells[g].colSpan&&e.model.rows[y].cells[g].colSpan<0&&void 0===e.model.rows[y].cells[g].rowSpan)if(v||(v={range:[y,g,y,g]},this.parent.notify(Et,v)),m=new Object,v.range=v.range,Object.assign(m,zn(v.range[0],v.range[1],e.model)),m&&m.colSpan&&(m.colSpan>1||m.rowSpan>1))(x=[])[0]=y,x[2]=m.rowSpan>1?y+(m.rowSpan-1):y,v.range=v.range,v.range[1]<e.start?(x[1]=x[3]=v.range[1],m.colSpan-p>1&&(x[3]+=m.colSpan-p-1)):(x[1]=x[3]=e.start,m.colSpan-(e.end-v.range[1]+1)>1&&(x[3]+=m.colSpan-(e.end-v.range[1]+1)-1)),h.push({range:x,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0});l[y].cells=e.model.rows[y].cells.splice(e.start,p),v=null}o.sheetCount=e.model.usedRange.colIndex,o.deletedCellsModel=l}else{if(e.end-e.start===this.parent.sheets.length-1||void 0!==e.checkCount&&e.checkCount===this.parent.sheets.length)return;this.parent.notify(nr,c),o.sheetCount=this.parent.sheets.length,o.activeSheetIndex=this.parent.activeSheetIndex}var S=[],w="Row"===e.modelType&&e.start<e.model.maxHgts.length,I=e.model[""+i];for(y=e.start;y<=e.end;y++)"Sheet"===e.modelType&&I[y]&&this.parent.notify(pe,{action:"deleteSheetTab",sheetId:I[y].id}),I[e.start]||e.start<I.length?(S.push(I[e.start]||{}),I.splice(e.start,1)):S.push({}),y===e.start&&(S[0].index=e.start),w&&e.model.maxHgts.splice(e.start,1);h.forEach((function(e){return r.parent.notify(St,e)})),this.parent.notify(Wt,e),"Sheet"!==e.modelType&&(this.parent.notify(er,e),o.refreshSheet=e.refreshSheet,o.activeSheetIndex=In(this.parent,e.model.name),o.conditionalFormats=[],this.deleteConditionalFormats(e,o)),o.definedNames=c.definedNames,o.isAction=e.isAction,o.deletedModel=S,delete o.cancel,"Sheet"!==e.modelType&&this.parent.chartColl&&this.parent.chartColl.length&&this.parent.notify(Bt,{range:t(e.model.selectedRange)}),this.parent.notify(Ke,s)}}},r.prototype.setRowColCount=function(e,t,r,n){var i=n+"Count",a=r[""+i];t>=a&&(t=a-1),t<e||(this.parent.setSheetPropertyOnMute(r,i,a-(t-e+1)),r.id===this.parent.getActiveSheet().id&&this.parent.notify(he,{index:a-1,update:n,isDelete:!0,start:e,end:t}))},r.prototype.deleteConditionalFormats=function(r,n){var i=r.model.conditionalFormats;if(i)for(var o=0;o<i.length;o++){n.conditionalFormats.push((0,e.extend)({},i[o],null,!0));var s=t(i[o].range),l=t(r.model.selectedRange);"Column"===r.modelType&&l[1]<=s[1]&&l[3]>=s[3]||"Row"===r.modelType&&l[0]<=s[0]&&l[2]>=s[2]?(i.splice(i.indexOf(i[o]),1),o--):i[o].range=a(_r(r,s))}},r.prototype.addEventListener=function(){this.parent.on(Ze,this.deleteModel,this)},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Ze,this.deleteModel)},r.prototype.getModuleName=function(){return"workbookdelete"},r}(),Qs=function(){function r(e){this.parent=e,this.addEventListener()}return r.prototype.destroy=function(){this.removeEventListener(),this.highlightInvalidData=null,this.parent=null},r.prototype.addEventListener=function(){this.parent.on(Qe,this.updateValidationHandler,this),this.parent.on(et,this.addHighlightHandler,this),this.parent.on(dt,this.removeHighlightHandler,this),this.parent.on(qt,this.beforeInsertDeleteHandler,this),this.parent.on(Wt,this.beforeInsertDeleteHandler,this),this.parent.on(nr,this.beforeInsertDeleteHandler,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Qe,this.updateValidationHandler),this.parent.off(et,this.addHighlightHandler),this.parent.off(dt,this.removeHighlightHandler),this.parent.off(qt,this.beforeInsertDeleteHandler),this.parent.off(Wt,this.beforeInsertDeleteHandler),this.parent.off(nr,this.beforeInsertDeleteHandler))},r.prototype.updateValidationHandler=function(r){var n,i,a,o=this,s=r.range.lastIndexOf("!");if(s>-1){n=r.range.substring(0,s),r.range=r.range.substring(s+1);var l=In(this.parent,n);i=Fn(this.parent,l),a=l===this.parent.activeSheetIndex}else i=this.parent.getActiveSheet(),a=!0;var d=this.getRangeWhenColumnSelected(r.range,i);n&&(r.range=n+"!"+d.range);var h,p,u,f,g,m,v,y,C,b,x,S=c(t(d.range)),w={colIdx:S[1]};if(a){u=this.parent.frozenRowCount(i);var I=this.parent.frozenColCount(i),E=this.parent,N=E.viewport||{};if(g=E.scrollSettings&&E.scrollSettings.enableVirtualization?[u+N.topIndex,I+N.leftIndex,N.bottomIndex,N.rightIndex]:[0,0,i.rowCount-1,i.colCount-1],d.isFullCol){var R=[[g[0],g[2]]];u&&R.push([t(i.topLeftCell)[0],u-1]),v=function(e){e.isHighlighted&&(w.colIdx>=g[1]&&w.colIdx<=g[3]||w.colIdx<I)&&!Al(i,w.colIdx)&&R.forEach((function(t){for(w.rowIdx=t[0];w.rowIdx<=t[1];w.rowIdx++)ml(i,w.rowIdx)||(w.cell=zn(w.rowIdx,w.colIdx,i,!1,!0),w.validation=w.cell.validation?w.cell.validation:e,o.parent.notify(_t,w))}))}}m=function(e){e.isHighlighted&&f&&(w.colIdx>=g[1]&&w.colIdx<=g[3]||w.colIdx<I)&&!Al(i,w.colIdx)&&o.parent.notify(_t,w)}}if(r.isRemoveValidation){if(a){var A;if((b=t(i.activeCell))[0]>=S[0]&&b[1]>=S[1]&&b[0]<=S[2]&&b[1]<=S[3])C=(A=zn(b[0],b[1],i,!1,!0).validation||kl(i.columns[S[1]],b[0],b[1])&&i.columns[b[1]].validation)&&"List"===A.type;w.isRemoveValidation=!0,w.isRemoveHighlightedData=!0}}else{r.isAction&&this.highlightInvalidData&&(y={isHighlighted:this.highlightInvalidData}),"List"===r.rules.type?(b=t(i.activeCell),C=a&&b[0]>=S[0]&&b[1]>=S[1]&&b[0]<=S[2]&&b[1]<=S[3],r.rules.value1&&(r.rules.value1=r.rules.value1.trim(),r.rules.value1[r.rules.value1.length-1]===this.parent.listSeparator&&(r.rules.value1=r.rules.value1.substring(0,r.rules.value1.length-1)))):"Custom"!==r.rules.type||(0,e.isNullOrUndefined)(r.rules.value2)||delete r.rules.value2,a&&(w.removeOnValidData=!0);var k=wr(r.rules.value1),O=wr(r.rules.value2);x=function(e){k&&(w.validation.value1=Br([e,w.colIdx,e,w.colIdx],S,i,o.parent,{formula:r.rules.value1})),O&&(w.validation.value2=Br([e,w.colIdx,e,w.colIdx],S,i,o.parent,{formula:r.rules.value2}))}}for(w.colIdx;w.colIdx<=S[3];w.colIdx++){if(d.isFullCol){if(!r.isRemoveValidation){w.validation=Object.assign({},r.rules,y),x(0),i.columns[w.colIdx]||(i.columns[w.colIdx]={}),i.columns[w.colIdx].validation=w.validation,a&&v(w.validation);continue}(h=i.columns[w.colIdx])&&h.validation&&(a&&v(h.validation),delete h.validation)}for(w.rowIdx=S[0];w.rowIdx<=S[2];w.rowIdx++)f=a&&(w.rowIdx>=g[0]&&w.rowIdx<=g[2]||w.rowIdx<u)&&!ml(i,w.rowIdx),r.isRemoveValidation?((h=i.columns[w.colIdx])&&h.validation&&(w.rowIdx===S[2]&&(h.validation.address=Fr(h.validation.address,[S[0],w.colIdx,S[2],w.colIdx],w.colIdx)),a&&m(h.validation)),(p=zn(w.rowIdx,w.colIdx,i))&&p.validation&&!Vr(this.parent,i,{cell:{validation:{}},rowIdx:w.rowIdx,colIdx:w.colIdx})&&(a&&m(p.validation),delete p.validation)):(w.validation=Object.assign({},r.rules,y),x(w.rowIdx),Vr(this.parent,i,{cell:{validation:w.validation},rowIdx:w.rowIdx,colIdx:w.colIdx})||a&&(w.cell=zn(w.rowIdx,w.colIdx,i),m(w.validation)))}C&&((A=(p=zn(b[0],b[1],i,!1,!0)).validation)||(A=kl(i.columns[b[1]],b[0],b[1])?i.columns[b[1]].validation:{}),this.parent.notify(vr,{validation:A,cell:p,rowIdx:b[0],colIdx:b[1],isRefresh:!0}))},r.prototype.addHighlightHandler=function(e){e.isAction&&(this.highlightInvalidData=!0),this.invalidDataHandler(e.range)},r.prototype.removeHighlightHandler=function(e){e.isAction&&(this.highlightInvalidData=null),this.invalidDataHandler(e.range,!0)},r.prototype.invalidDataHandler=function(e,r){var n,i,a,o,s,d,h,u,f,g,m,v=this,y=this.parent,C=this.parent.getActiveSheet(),b=this.parent.frozenRowCount(C),x=this.parent.frozenColCount(C),S=y.scrollSettings&&y.scrollSettings.enableVirtualization?y.viewport?[b+y.viewport.topIndex,x+y.viewport.leftIndex,y.viewport.bottomIndex,y.viewport.rightIndex]:[]:[0,0,C.rowCount-1,C.colCount-1],w=function(e,t){d&&(o>=S[1]&&o<=S[3]||o<x)&&!Al(C,o)&&v.parent.notify(_t,{isRemoveHighlightedData:r,rowIdx:a,colIdx:o,cell:n,validation:e,removeOnValidData:!0,col:t})};m=r?function(e,t){e.isHighlighted&&(t&&delete e.isHighlighted,w(e))}:function(e,t,r){t&&(e.isHighlighted=!0),w(e,r)};var I=function(){for(a=s[0];a<=s[2];a++)for(d=h&&(a>=S[0]&&a<=S[2]||a<b)&&!ml(C,a),u&&(g=fl(C,a),f=Math.max(g&&g.cells?g.cells.length-1:null,C.columns.length-1,s[3])),o=s[1];o<=f;o++)n=zn(a,o,C,!1,!0),i=C.columns[o],n.validation?m(n.validation,!0,i):kl(i,a,o)&&m(i.validation,a===s[2])};if(e){if(e.includes("!")){var E=p(this.parent,e);C=Fn(this.parent,E),e=l(e),h=E===this.parent.activeSheetIndex}else h=!0;s=c(t(this.getRangeWhenColumnSelected(en(C,e),C).range)),f=s[3],I()}else u=!0,this.parent.sheets.forEach((function(e,t){C=e,s=[0,0,Math.max(C.rows.length-1,S[2]),Math.max(C.usedRange.colIndex,S[3])],h=t===v.parent.activeSheetIndex,I()}))},r.prototype.beforeInsertDeleteHandler=function(t){var r,n=this;if("Sheet"===t.modelType){if(t.name!==nr)return;r=!0}else if(t.name===nr)return;var i,a,o,s,l=t.name===qt;if(l)o=Fn(this.parent,t.activeSheetIndex),a=t.index+(t.model.length-1),i={insertDeleteArgs:{startIndex:t.index,endIndex:a,modelType:t.modelType,isInsert:!0,sheet:o},sheetIdx:t.activeSheetIndex},s=t.index-1;else if(r){var d=[],h=void 0,p={action:"getSheetInfo",sheetInfo:[]};this.parent.notify(pe,p);for(var c=t.startIndex;c<=t.endIndex;c++){h=this.parent.sheets[c].id;for(var u=0;u<p.sheetInfo.length;u++)if(p.sheetInfo[u].index===h){d.push(p.sheetInfo[u].sheet);break}}i={sheetNames:d}}else o=t.model,i={insertDeleteArgs:{startIndex:t.start,modelType:t.modelType,endIndex:t.end,sheet:o},sheetIdx:En(this.parent,o.id)};var f,g,m,v,y,C,b,x=function(e){!wr(e.value1)||i.otherSheet&&!e.value1.includes(o.name)||(i.cell={formula:e.value1},n.parent.notify(ir,i),e.value1=i.cell.formula),!wr(e.value2)||i.otherSheet&&!e.value2.includes(o.name)||(i.cell={formula:e.value2},n.parent.notify(ir,i),e.value2=i.cell.formula)},S="Column"===t.modelType,w=function(r,n){if(r){i.insertDeleteArgs.forceUpdate=!0;for(var s=t.index;s<=a;s++)r=(0,e.extend)({},r),x(r),n?El(o,s,{validation:r}):S?jn(y,s,o,{validation:r},!0):jn(s,C,o,{validation:r},!0);delete i.insertDeleteArgs.forceUpdate}};this.parent.sheets.forEach((function(e,n){if(r){if(n>=t.startIndex&&n<=t.endIndex)return}else n===i.sheetIdx?(b=l,delete i.otherSheet,delete i.formulaSheet):(i.otherSheet=!0,i.formulaSheet=e,b=!1);for(m=e.usedRange.rowIndex+1,C=0,v=e.usedRange.colIndex+1;C<v;C++)if(!(b&&S&&C>=t.index&&C<=a))for((g=e.columns&&e.columns[C])&&g.validation&&(x(g.validation),b&&S&&s===C&&w(g.validation,!0)),y=0;y<m;y++)(f=zn(y,C,e,!1,!0)).validation&&(!b||S||y<t.index||y>a)&&(x(f.validation),b&&s===(S?C:y)&&w(f.validation))}))},r.prototype.getRangeWhenColumnSelected=function(e,t){var r,n=e.split(":");return e.match(/\D/g)&&!e.match(/[0-9]/g)?(n[0]+=1,n[1]+=t.rowCount,e=n[0]+":"+n[1],r=!0):!e.match(/\D/g)&&e.match(/[0-9]/g)&&(n[0]="A"+n[0],n[1]=i(0,t.colCount-1).replace(/[0-9]/g,"")+n[1],e=n[0]+":"+n[1]),{range:e,isFullCol:r}},r.prototype.getModuleName=function(){return"workbookDataValidation"},r}(),el=function(){return el=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},el.apply(this,arguments)},tl=function(){function n(e){this.parent=e,this.addEventListener()}return n.prototype.destroy=function(){this.removeEventListener(),this.parent=null},n.prototype.addEventListener=function(){this.parent.on(rt,this.find,this),this.parent.on(at,this.replace,this),this.parent.on(ot,this.replaceAll,this),this.parent.on(pt,this.totalCount,this),this.parent.on(oe,this.findAllValues,this)},n.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(rt,this.find),this.parent.off(at,this.replace),this.parent.off(ot,this.replaceAll),this.parent.off(pt,this.totalCount),this.parent.off(oe,this.findAllValues))},n.prototype.find=function(r){r.sheetIndex=(0,e.isUndefined)(r.sheetIndex)?this.parent.activeSheetIndex:r.sheetIndex;var n,i=this.parent.sheets[r.sheetIndex],a=t(i.activeCell),o={startRow:a[0],startCol:a[1],findVal:r.isCSen?r.value:r.value.toLowerCase(),activeCell:a};("By Row"===r.searchBy?o.startRow>i.usedRange.rowIndex:o.startCol>i.usedRange.colIndex)?"next"===r.findOpt?o.startRow=o.startCol=0:(o.startRow=i.usedRange.rowIndex,o.startCol=i.usedRange.colIndex):"By Row"===r.searchBy?o.startCol>i.usedRange.colIndex&&("next"===r.findOpt?(o.startRow++,o.startRow>i.usedRange.rowIndex&&(o.startRow=0),o.startCol=0):(o.startRow--,o.startRow<0&&(o.startRow=i.usedRange.rowIndex),o.startCol=i.usedRange.colIndex)):o.startRow>i.usedRange.rowIndex&&("next"===r.findOpt?(o.startCol++,o.startCol>i.usedRange.colIndex&&(o.startRow=0),o.startRow=0):(o.startCol--,o.startCol<0&&(o.startCol=i.usedRange.colIndex),o.startRow=i.usedRange.colIndex)),"Workbook"===r.mode?(o.sheets=this.parent.sheets,o.sheetIdx=r.sheetIndex):(o.sheets=[i],o.sheetIdx=0);var s=r.showDialog&&this.parent.element&&this.parent.element.querySelector(".e-header-panel");s&&(n=(s.offsetHeight||(i.showHeaders?30:0))+1),r.localeObj=(0,e.getNumericObject)(this.parent.locale),"next"===r.findOpt?this.findNext(r,o):this.findPrevious(r,o),r.showDialog&&this.parent.notify(Z,{findValue:r.value,isPublic:!0,headerHgt:n})},n.prototype.findNext=function(e,t){var r=this,n=function(n,i,a){for(var o,s,l=n;l<=i&&(o=t.sheets[l],!(s=l===t.sheetIdx?a?r.findNextOnSheet(e,t.startRow,t.startCol,t.findVal,o,void 0,t.activeCell):r.findNextOnSheet(e,0,0,t.findVal,o,"By Row"===e.searchBy?t.startRow:t.startCol):r.findNextOnSheet(e,0,0,t.findVal,o)));l++);return s},i=n(t.sheetIdx,t.sheets.length-1,!0);i||(i=n(0,t.sheetIdx)),i?this.parent.notify(nt,{address:i}):this.parent.notify(st,null)},n.prototype.findNextOnSheet=function(e,t,r,n,i,a,o){var s,l,d;if("By Row"===e.searchBy){void 0===a&&(a=i.rows.length-1);var h=void 0;for(l=t;l<=a;l++)if(!ml(i,l))for(d=o&&l===t?r:0,h=i.rows[l]&&i.rows[l].cells&&i.rows[l].cells.length;d<h;d++)if(!Al(i,d)&&(s=this.checkMatch(e,n,l,d,i,o)))return s}else{void 0===a&&(a=i.usedRange.colIndex);var p=i.rows&&i.rows.length-1;for(d=r;d<=a;d++)if(!Al(i,d))for(l=o&&d===r?t:0;l<=p;l++)if(!ml(i,l)&&(s=this.checkMatch(e,n,l,d,i,o)))return s}return s},n.prototype.findPrevious=function(e,t){var r,n=this,i=function(r,i,a){for(var o,s,l=r;l>=i&&(o=t.sheets[l],!(s=l===t.sheetIdx?a?n.findPrevOnSheet(e,t.startRow,t.startCol,0,0,t.findVal,o,t.activeCell):"By Row"===e.searchBy?n.findPrevOnSheet(e,o.usedRange.rowIndex,o.usedRange.colIndex,t.startRow,0,t.findVal,o):n.findPrevOnSheet(e,o.usedRange.rowIndex,o.usedRange.colIndex,0,t.startCol,t.findVal,o):n.findPrevOnSheet(e,o.usedRange.rowIndex,o.usedRange.colIndex,0,0,t.findVal,o)));l--);return s};(r=i(t.sheetIdx,0,!0))||(r=i(t.sheets.length-1,t.sheetIdx)),r?this.parent.notify(nt,{address:r}):this.parent.notify(st,null)},n.prototype.findPrevOnSheet=function(e,t,r,n,i,a,o,s){var l,d,h;if("By Row"===e.searchBy){for(h=t;h>=n;h--)if(!ml(o,h))for(d=s&&h===t?r:o.rows[h]&&o.rows[h].cells&&o.rows[h].cells.length-1;d>=i;d--)if(!Al(o,d)&&(l=this.checkMatch(e,a,h,d,o,s)))return l}else for(d=r;d>=i;d--)if(!Al(o,d))for(h=s&&d===r?t:o.rows&&o.rows.length-1;h>=n;h--)if(!ml(o,h)&&(l=this.checkMatch(e,a,h,d,o,s)))return l;return l},n.prototype.checkMatch=function(e,t,r,n,a,o){if(o&&r===o[0]&&n===o[1])return null;var s=zn(r,n,a,!1,!0);if(a.isProtected&&!a.protectSettings.selectCells&&a.protectSettings.selectUnLockedCells&&Tr(s,Il(a,n)))return null;var l=function(o){if(o)if(e.isCSen||(o=o.toLowerCase()),e.isEMatch){if(o===t)return a.name+"!"+i(r,n)}else if(o.includes(t))return a.name+"!"+i(r,n);return null},d=this.getDisplayText(s,r,n,e.localeObj),h=l(d);return h||!(s=zn(r,n,a,!1,!0)).format||Yn(s.format,!0)||d.includes("%")||(h=l(this.getCellVal(s,e.localeObj))),h},n.prototype.replace=function(n){var a=this,o=(0,e.isUndefined)(n.sheetIndex)?this.parent.activeSheetIndex:n.sheetIndex,s=Fn(this.parent,n.sheetIndex);if(s.isProtected)this.parent.notify(yt,null);else{var l,d=t(n.address||s.activeCell),h=zn(d[0],d[1],s,!1,!0),p=this.parent.getDisplayText(h).toString();n.value=n.value.toString(),n.isCSen||(l=n.value.toLowerCase());var c=(0,e.getNumericObject)(this.parent.locale),u=function(e){var t;if(n.isCSen)t=n.isEMatch?p===n.value&&n.replaceValue:p.indexOf(n.value)>-1&&p.replace(n.value,n.replaceValue);else if(n.isEMatch)t=p.toLowerCase()===l&&n.replaceValue;else{var r=RegExp;t=p.toLowerCase().includes(l)&&p.replace(new r(n.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),n.replaceValue)}return e||f||!h.format||Yn(h.format,!0)||p.includes("%")||(p=a.getCellVal(h,c))&&(t=u(!0)),t},f=u();if(f||(n.findOpt="next",this.find(n),d=r(s.activeCell),h=zn(d[0],d[1],s,!1,!0),p=this.parent.getDisplayText(h).toString(),f=u()))if(Jr(zn(d[0],d[1],s),Il(s,d[1]),fl(s,d[0])))this.parent.notify(Ct,null);else{var g={address:s.name+"!"+i(d[0],d[1]),cancel:!1,compareValue:n.value,replaceValue:n.replaceValue,sheetIndex:o};if(n.isAction){if(this.parent.notify(K,{action:"beforeReplace",eventArgs:g}),g.cancel)return;delete g.cancel}Vr(this.parent,s,{cell:{value:f},rowIdx:d[0],colIdx:d[1],uiRefresh:!0,checkCF:!0,valChange:!0}),n.isAction&&this.parent.notify("actionComplete",{action:"replace",eventArgs:g})}}},n.prototype.replaceAll=function(t){for(var n,a,o,s,l=this,d="Sheet"===t.mode?t.sheetIndex:0,h=this.parent.sheets[d],c=h.usedRange.rowIndex,u=0,f=h.usedRange.colIndex,g=0,m=[],v=t.isAction,y=r(h.activeCell),C=el({addressCollection:m,cancel:!1},t),b=0,x=function(e,n,i){requestAnimationFrame?requestAnimationFrame((function(){if(!C.cancel&&C.addressCollection[n]){var i=r(C.addressCollection[n].substring(C.addressCollection[n].lastIndexOf("!")+1)),a=p(l.parent,C.addressCollection[n]);Vr(l.parent,l.parent.sheets[a],{cell:{value:e},rowIdx:i[0],uiRefresh:!0,checkCF:!0,colIdx:i[1],valChange:!0,skipFormatCheck:t.skipFormatCheck}),y[0]===i[0]&&y[1]===i[1]&&l.parent.notify("formulaBarOperation",{action:"refreshFormulabar",cell:zn(i[0],i[1],l.parent.sheets[a],!1,!0)}),n===C.addressCollection.length-1&&v&&l.parent.notify("actionComplete",{action:"replaceAll",eventArgs:C})}})):l.parent.updateCellDetails({value:e},C.addressCollection[n],void 0,void 0,!0),i.formula||b++},S=function(e,r){var n;if(e)if(t.isCSen)t.isEMatch?e===t.value&&(x(t.replaceValue,m.length,r),m.push(h.name+"!"+i(u,g)),n=!0):e.indexOf(t.value)>-1&&(x(e.replace(t.value,t.replaceValue),m.length,r),m.push(h.name+"!"+i(u,g)),n=!0);else if(t.isEMatch)e.toLowerCase()===t.value&&(x(t.replaceValue,m.length,r),m.push(h.name+"!"+i(u,g)),n=!0);else{var a=e.toLowerCase();if(e===t.value||a.indexOf(t.value.toString().toLowerCase())>-1||a===t.value||e===t.value||a.indexOf(t.value)>-1){var s=RegExp;o=new s(t.value.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),x(e.replace(o,t.replaceValue),m.length,r),m.push(h.name+"!"+i(u,g)),n=!0}}return n},w=(0,e.getNumericObject)(this.parent.locale);u<=c+1;u++){if(g>f&&u>c&&"Workbook"===t.mode){if(d++,!(h=this.parent.sheets[d]))break;g=0,u=0,f=h.usedRange.colIndex,c=h.usedRange.rowIndex}if(a=h.rows[u])for(g===f+1&&(g=0);g<=f;g++)if(a&&(s=a.cells&&a.cells[g])){if(Jr(s,Il(h,g),a))continue;S(n=this.getDisplayText(s,u,g,w).toString(),s)||!s.format||Yn(s.format,!0)||n.includes("%")||S(this.getCellVal(a.cells[g],w),s)}}m.length&&v?(this.parent.notify("actionBegin",{action:"beforeReplaceAll",eventArgs:C}),C.cancel||this.parent.notify(mt,{count:b,replaceValue:C.replaceValue})):this.parent.notify(mt,{count:b,replaceValue:C.replaceValue})},n.prototype.getDisplayText=function(e,t,r,n){if(!e)return"";if(!e.value&&0!==e.value)return e.hyperlink?"string"==typeof e.hyperlink?e.hyperlink:e.hyperlink.address||"":"";var i=e.value.toString();if(e.format||i.includes(n.dateSeparator)){var a={value:e.value,format:e.format,formattedText:e.value,cell:e,rowIndex:t,colIndex:r};return this.parent.notify(re,a),a.formattedText}return i},n.prototype.getCellVal=function(e,t){return dn(e.value)?"."!==t.decimal?e.value.toString().split(".").join(t.decimal):e.value.toString():e.value?e.value.toString().toLowerCase():""},n.prototype.totalCount=function(t){var n,i=this,a=this.parent.sheets[t.sheetIndex],o=r(a.activeCell),s=0,l=0,d=t.value.toLowerCase(),h=(0,e.getNumericObject)(this.parent.locale);a.rows.filter((function(e,t){return e&&e.cells&&!e.isFiltered&&!e.hidden&&e.cells.filter((function(e,r){!e||!e.value&&0!==e.value&&!e.hyperlink||Al(a,r)||a.isProtected&&!a.protectSettings.selectCells&&Tr(e,Il(a,r))||((n=e.format||e.hyperlink?i.parent.getDisplayText(e):e.value.toString().toLowerCase()).includes(d)||e.format&&!Yn(e.format,!0)&&!n.includes("%")&&i.getCellVal(e,h).includes(d))&&(s++,(t===o[0]&&r>=o[1]||t>o[0])&&l++)}))}));var p=s;(s=p-(l-=1))>p&&(s=p),0===s||this.parent.getDisplayText(zn(o[0],o[1],a)).toLowerCase().includes(d)||(s-=1),t.findCount=s+" of "+p},n.prototype.findAllValues=function(t){for(var r,n=t.sheetIndex,a=this.parent.sheets[n],o=a.usedRange.rowIndex,s=0,l=a.usedRange.colIndex,d=0,h=this.parent.sheets.length,p=t.sheetIndex;s<=o+1;s++){if(1!==p&&t.sheetIndex===h&&(n=1),s>o&&d>l&&"Workbook"===t.mode){if(++n>h-1&&(n=0),p===n)return void 0;(a=this.parent.sheets[n])&&(s=0,d=0,l=a.usedRange.colIndex,o=a.usedRange.rowIndex)}if(!(0,e.isNullOrUndefined)(a)&&a.rows[s]){var c=a.rows[s];for(d===l+2&&(d=0);d<=l+1;d++)if(c&&c.cells&&c.cells[d]){var u=a.rows[s].cells[d];if(u&&!(0,e.isNullOrUndefined)(u.value)&&""!==u.value&&(!a.isProtected||a.protectSettings.selectCells||a.protectSettings.selectUnLockedCells&&!Tr(u,Il(a,d)))){var f=void 0;if(u.format)f=this.parent.getDisplayText(a.rows[s].cells[d]).toString();else f=u.value.toString();if(t.isCSen&&t.isEMatch)f===t.value&&(r=a.name+"!"+i(s,d),t.findCollection.push(r));else if(t.isCSen&&!t.isEMatch){var g=f.indexOf(t.value)>-1;(f===t.value||g)&&(r=a.name+"!"+i(s,d),t.findCollection.push(r))}else if(!t.isCSen&&t.isEMatch){(m=f.toString().toLowerCase())===t.value.toLowerCase()&&(r=a.name+"!"+i(s,d),t.findCollection.push(r))}else if(!t.isCSen&&!t.isEMatch){var m;g=(m=f.toString().toLowerCase()).indexOf(t.value.toLowerCase())>-1;(m===t.value||f===t.value||g||f===t.value)&&(r=a.name+"!"+i(s,d),t.findCollection.push(r))}}}}}},n.prototype.getModuleName=function(){return"workbookfindAndReplace"},n}(),rl=function(){function t(e){this.parent=e,this.addEventListener()}return t.prototype.protectsheetHandler=function(t){var r=(0,e.isNullOrUndefined)(t.sheetIndex)?this.parent.activeSheetIndex:t.sheetIndex,n=Fn(this.parent,r);this.parent.setSheetPropertyOnMute(n,"isProtected",!0),this.parent.setSheetPropertyOnMute(n,"protectSettings",{selectCells:t.protectSettings.selectCells,formatCells:t.protectSettings.formatCells,formatColumns:t.protectSettings.formatColumns,formatRows:t.protectSettings.formatRows,insertLink:t.protectSettings.insertLink,selectUnLockedCells:t.protectSettings.selectUnLockedCells}),this.parent.notify(ut,{sheetIndex:r,triggerEvent:t.triggerEvent}),this.parent.notify(ft,{props:"Protect"}),n.password=t.password?t.password:"",n.columns.forEach((function(t){t&&(0,e.isUndefined)(t.isLocked)&&(t.isLocked=!0)}))},t.prototype.unprotectsheetHandler=function(t){var r=this.parent.getActiveSheet();(0,e.isNullOrUndefined)(t.sheet)||(r=this.parent.sheets[t.sheet]),r.isImportProtected&&(r.isImportProtected=!1),r.protectSettings.formatCells=r.protectSettings.formatColumns=!1,r.protectSettings.formatRows=r.protectSettings.selectCells=!1,this.parent.setSheetPropertyOnMute(r,"isProtected",!1),this.parent.notify(ut,r.protectSettings),this.parent.notify(ft,{props:"Protect"})},t.prototype.destroy=function(){this.removeEventListener(),this.parent=null},t.prototype.addEventListener=function(){this.parent.on(gt,this.protectsheetHandler,this),this.parent.on(vt,this.unprotectsheetHandler,this),this.parent.on(bt,this.lockCells,this)},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(gt,this.protectsheetHandler),this.parent.off(bt,this.lockCells),this.parent.off(gt,this.unprotectsheetHandler))},t.prototype.lockCells=function(e){var t=this.parent.getAddressInfo(e.range),r=c(t.indices),n=Fn(this.parent,t.sheetIndex),i=!!e.isLocked&&e.isLocked;if(0===r[0]&&r[2]===n.rowCount-1)for(var a=r[1];a<=r[3];a++)El(n,a,{isLocked:e.isLocked});for(a=r[0];a<=r[2];a++)for(var o=r[1];o<=r[3];o++)jn(a,o,n,{isLocked:i},!0);e.triggerEvent&&this.parent.notify("actionComplete",{action:"lockCells",eventArgs:e})},t.prototype.getModuleName=function(){return"workbookProtectSheet"},t}(),nl=function(){function r(e){this.parent=e,this.addEventListener()}return r.prototype.merge=function(r){r.sheetIndex=(0,e.isUndefined)(r.sheetIndex)?this.parent.activeSheetIndex:r.sheetIndex,r.isAction&&(this.parent.notify("actionBegin",{eventArgs:r,action:"merge"}),r.model||(r.model=[])),"string"==typeof r.range&&(r.range=t(r.range));var n=r.range=c(r.range);if(r.skipChecking||this.mergedRange(r),r.merge&&"All"!==r.type){if("Horizontally"===r.type)for(var i=r.range[0],a=r.range[2];i<=a;i++)r.range=[i,n[1],i,n[3]],this.mergeAll(r,i-n[0]);else if("Vertically"===r.type){var o=r.range[1];for(a=r.range[3];o<=a;o++)r.range=[n[0],o,n[2],o],this.mergeAll(r,0,o-n[1])}}else this.mergeAll(r),r.refreshRibbon&&this.parent.notify(ve,null);r.range=n,this.parent.setUsedRange(r.range[2],r.range[3]),r.isAction&&this.parent.notify("actionComplete",{eventArgs:r,action:"merge"}),r.sheetIndex===this.parent.activeSheetIndex&&(this.parent.notify("selectRange",{address:Fn(this.parent,r.sheetIndex).selectedRange,skipChecking:!0}),this.parent.chartColl&&this.parent.chartColl.length&&this.parent.notify(Bt,{range:r.range}))},r.prototype.mergeAll=function(t,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i,a,o,s,l,d,h=0;t.range=t.range;for(var p=(0,e.isUndefined)(t.sheetIndex)?this.parent.getActiveSheet():Fn(this.parent,t.sheetIndex),c={cell:new Object,rowIdx:t.range[0],colIdx:t.range[1],valChange:!t.merge,preventEvt:!0,uiRefresh:!t.preventRefresh,skipFormatCheck:!0},u=t.range[0],f=r;u<=t.range[2];u++,f++){a=0,t.isAction&&!t.model[f]&&t.model.push({cells:[]});for(var g=t.range[1],m=n;g<=t.range[3];g++,m++){if((i=zn(u,g,p))&&(i.value||0===i.value||i.formula)&&!o&&(o=i.formula||i.value,l=i.format),t.isAction&&t.merge&&(d=t.model[f].cells[m]={},(0,e.extend)(d,i,null,!0)),i){delete i.rowSpan,delete i.colSpan,d=!t.merge&&!t.isAction&&t.model&&t.model[f]&&t.model[f].cells[m];var v="Manual"===this.parent.calculationMode&&this.parent.getActiveSheet().isSheetCalculated&&!(0,e.isNullOrUndefined)(i.value)&&""!==i.value;d?(v&&(d.value=i.value),jn(u,g,p,d)):t.model&&t.model[f].cells[m]&&v&&(t.model[f].cells[m].value=i.value)}if(u===t.range[0]&&g===t.range[1]){if(t.merge){t.range[3]-t.range[1]>0&&(c.cell.colSpan=t.range[3]-t.range[1]+1),t.range[2]-t.range[0]>0&&(c.cell.rowSpan=t.range[2]-t.range[0]+1),Vr(this.parent,p,c),c.valChange=c.mergedCells=!0;continue}}else c.rowIdx=u,c.colIdx=g,c.cell={},t.merge&&(u!==t.range[0]&&(c.cell.rowSpan=-h),g!==t.range[1]&&(a++,c.cell.colSpan=-a));Vr(this.parent,p,c),s||(s=c.isFormulaDependent)}h++}if(t.merge)if(o||0===o){delete c.mergedCells,c.cell={};var y=zn(t.range[0],t.range[1],p);y&&(y.value||y.formula)||(wr(o)?c.cell.formula=o:c.cell.value=o,l&&(c.cell.format=l)),c.rowIdx=t.range[0],c.colIdx=t.range[1],Vr(this.parent,p,c)}else t.preventRefresh||this.parent.notify(wt,{rowIdx:t.range[0],colIdx:t.range[1]});t.preventRefresh||this.refreshCF(p,t.range.slice(),s,t.merge)},r.prototype.refreshCF=function(e,t,r,n){e.conditionalFormats&&e.conditionalFormats.length&&(n?this.parent.notify(kt,{indexes:[t[0],t[1]],refreshAll:r,isAction:!0}):this.parent.notify(kt,{indexes:t,refreshAll:r,isAction:!0}))},r.prototype.activeCellRange=function(t){t.range=t.range;var r=this.parent.getActiveSheet(),n=zn(t.range[0],t.range[1],r);n&&(!(0,e.isNullOrUndefined)(n.rowSpan)&&n.rowSpan<0&&(t.range[0]+=n.rowSpan,t.insertCount&&(t.range[0]-=t.insertCount)),!(0,e.isNullOrUndefined)(n.colSpan)&&n.colSpan<0&&(t.range[1]+=n.colSpan,t.insertCount&&(t.range[1]-=t.insertCount)),(n=zn(t.range[0],t.range[1],r))&&(n.rowSpan>1&&(t.range[0]+(n.rowSpan-1)>=t.range[2]||t.insertCount)&&(t.range[2]=t.range[0]+(n.rowSpan-1)),n.colSpan>1&&(t.range[1]+(n.colSpan-1)>=t.range[3]||t.insertCount)&&(t.range[3]=t.range[1]+(n.colSpan-1))))},r.prototype.mergedRange=function(e){"string"==typeof e.range&&(e.range=t(e.range)),e.range[0]<=e.range[2]&&e.range[1]<=e.range[3]?this.forward(e):e.range[0]>=e.range[2]&&e.range[1]>=e.range[3]?this.reverse(e):e.range[0]<e.range[2]&&e.range[1]>e.range[3]?this.forwardReverse(e):e.range[0]>e.range[2]&&e.range[1]<e.range[3]&&this.reverseForward(e)},r.prototype.forward=function(t){t.range=t.range;var r,n,i=(0,e.isUndefined)(t.sheetIndex)?this.parent.getActiveSheet():Fn(this.parent,t.sheetIndex),a=zn(t.range[0],t.range[1],i),o=r=t.range[0],s=n=t.range[1];if(a&&(!(0,e.isNullOrUndefined)(a.rowSpan)&&a.rowSpan<0&&(o=r=t.range[0]+a.rowSpan),!(0,e.isNullOrUndefined)(a.colSpan)&&a.colSpan<0&&(s=n=t.range[1]+a.colSpan),(a=zn(o,s,i))&&(a.rowSpan>1&&(r+=a.rowSpan-1,o+(a.rowSpan-1)>=t.range[2]&&(t.range[2]=t.range[0],t.range[2]=o+(a.rowSpan-1))),a.colSpan>1&&(n+=a.colSpan-1,s+(a.colSpan-1)>=t.range[3]&&(t.range[3]=t.range[1],t.range[3]=s+(a.colSpan-1))))),t.range[0]=o,t.range[1]=s,t.range[0]===o&&t.range[1]===s&&t.range[2]===r&&t.range[3]===n&&(t.isActiveCell=!0),!t.skipChecking){for(var l=t.range[1];l<=t.range[3];l++)(a=zn(t.range[2],l,i))&&(o=t.range[2],s=l,!(0,e.isNullOrUndefined)(a.colSpan)&&a.colSpan<0&&(s+=a.colSpan)<t.range[1]&&(t.range[1]=s),!(0,e.isNullOrUndefined)(a.rowSpan)&&a.rowSpan<0&&(o+=a.rowSpan)<t.range[0]&&(t.range[0]=o),(a=zn(o,s,i))&&(a.colSpan>1&&s+(a.colSpan-1)>t.range[3]&&(t.range[3]=s,t.range[3]=s+(a.colSpan-1)),a.rowSpan>1&&o+(a.rowSpan-1)>t.range[2]&&(t.range[2]=o,t.range[2]=o+(a.rowSpan-1))));var d,h;for(l=t.range[1];l<=t.range[3];l++)(a=zn(t.range[0],l,i))&&(h=l,d=t.range[0],!(0,e.isNullOrUndefined)(a.colSpan)&&a.colSpan<0&&(h+=a.colSpan)<t.range[1]&&(t.range[1]=h),!(0,e.isNullOrUndefined)(a.rowSpan)&&a.rowSpan<0&&(d+=a.rowSpan)<t.range[0]&&(t.range[0]=d));for(l=t.range[0];l<=t.range[2];l++)(a=zn(l,t.range[3],i))&&(o=l,s=t.range[3],!(0,e.isNullOrUndefined)(a.rowSpan)&&a.rowSpan<0&&(o+=a.rowSpan)<t.range[0]&&(t.range[0]=o),!(0,e.isNullOrUndefined)(a.colSpan)&&a.colSpan<0&&(s+=a.colSpan)<t.range[1]&&(t.range[1]=s),(a=zn(o,s,i))&&(a.rowSpan>1&&o+(a.rowSpan-1)>t.range[2]&&(t.range[2]=o,t.range[2]=o+(a.rowSpan-1)),a.colSpan>1&&s+(a.colSpan-1)>t.range[3]&&(t.range[3]=s,t.range[3]=s+(a.colSpan-1))))}},r.prototype.forwardReverse=function(t){var r=this.parent.getActiveSheet();t.range=t.range;var n=t.range[1],i=zn(t.range[0],t.range[1],r),a=t.range[0];if(i&&(!(0,e.isNullOrUndefined)(i.colSpan)&&i.colSpan<0&&(n+=i.colSpan,t.range[3]>=n&&(t.range[3]=n)),!(0,e.isNullOrUndefined)(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan)<t.range[0]&&(t.range[0]=a),(i=zn(a,n,r))&&(i.rowSpan>1&&a+(i.rowSpan-1)>=t.range[2]&&(t.range[2]=a+(i.rowSpan-1)),i.colSpan>1&&n+(i.colSpan-1)>=t.range[1]&&(t.range[1]=n+(i.colSpan-1)))),t.range[0]=a,!t.skipChecking){for(var o,s,l,d,h=t.range[3];h<=t.range[1];h++)(i=zn(t.range[2],h,r))&&(s=h,o=t.range[2],!(0,e.isNullOrUndefined)(i.rowSpan)&&i.rowSpan<0&&(o+=i.rowSpan)<t.range[0]&&(t.range[0]=o),!(0,e.isNullOrUndefined)(i.colSpan)&&i.colSpan<0&&(s+=i.colSpan)<t.range[3]&&(t.range[3]=s),(i=zn(o,s,r))&&(i.rowSpan>1&&o+(i.rowSpan-1)>t.range[2]&&(t.range[2]=o+(i.rowSpan-1)),i.colSpan>1&&s+(i.colSpan-1)>t.range[1]&&(t.range[1]=s+(i.colSpan-1))));for(h=t.range[3];h<=t.range[1];h++)(i=zn(t.range[0],h,r))&&(s=h,l=t.range[0],!(0,e.isNullOrUndefined)(i.rowSpan)&&i.rowSpan<0&&(l+=i.rowSpan)<t.range[0]&&(t.range[0]=l),!(0,e.isNullOrUndefined)(i.colSpan)&&i.colSpan<0&&(s+=i.colSpan),(i=zn(l,s,r))&&(i.rowSpan>1&&l+(i.rowSpan-1)>t.range[2]&&(t.range[2]=l+(i.rowSpan-1)),i.colSpan>1&&s+(i.colSpan-1)>t.range[1]&&(t.range[1]=s,t.range[1]=s+(i.colSpan-1))));for(h=t.range[0];h<=t.range[2];h++)(i=zn(h,t.range[3],r))&&(l=h,d=t.range[3],!(0,e.isNullOrUndefined)(i.rowSpan)&&i.rowSpan<0&&(l+=i.rowSpan)<t.range[0]&&(t.range[0]=l),!(0,e.isNullOrUndefined)(i.colSpan)&&i.colSpan<0&&(d+=i.colSpan)<t.range[3]&&(t.range[3]=d),(i=zn(l,d,r))&&(i.rowSpan>1&&l+(i.rowSpan-1)>t.range[2]&&(t.range[2]=l,t.range[2]=l+(i.rowSpan-1)),i.colSpan>1&&d+(i.colSpan-1)>t.range[1]&&(t.range[1]=d,t.range[1]=d+(i.colSpan-1))))}},r.prototype.reverse=function(t){t.range=t.range;var r=t.range[1],n=(0,e.isUndefined)(t.sheetIndex)?this.parent.getActiveSheet():Fn(this.parent,t.sheetIndex),i=zn(t.range[0],t.range[1],n),a=t.range[0];i&&(!(0,e.isNullOrUndefined)(i.colSpan)&&i.colSpan<0&&(r+=i.colSpan),!(0,e.isNullOrUndefined)(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan),t.range[2]>=a&&(t.range[2]=a,t.isActiveCell=!0),t.range[3]>=r?(t.range[3]=r,t.range[2]===a&&(t.isActiveCell=!0)):t.isActiveCell&&(t.isActiveCell=!1),(i=zn(a,r,n))&&(i.rowSpan>1&&a+(i.rowSpan-1)>=t.range[0]&&(t.range[0]=a,t.range[0]=a+(i.rowSpan-1)),i.colSpan>1&&r+(i.colSpan-1)>=t.range[1]&&(t.range[1]=r,t.range[1]=r+(i.colSpan-1))));var o=t.range[3];if(!t.skipChecking){for(var s=t.range[3];s<=t.range[1];s++)(i=zn(t.range[2],s,n))&&(o=s,a=t.range[2],!(0,e.isNullOrUndefined)(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan)<t.range[2]&&(t.range[2]=a),!(0,e.isNullOrUndefined)(i.colSpan)&&i.colSpan<0&&(o+=i.colSpan)<t.range[3]&&(t.range[3]=o),(i=zn(a,o,n))&&(i.rowSpan>1&&a+(i.rowSpan-1)>t.range[0]&&(t.range[0]=a,t.range[0]=a+(i.rowSpan-1)),i.colSpan>1&&o+(i.colSpan-1)>t.range[1]&&(t.range[1]=o,t.range[1]=o+(i.colSpan-1))));o=t.range[3];for(s=t.range[3];s<=t.range[1];s++)(i=zn(t.range[0],s,n))&&(o=s,a=t.range[0],!(0,e.isNullOrUndefined)(i.colSpan)&&i.colSpan<0&&(o+=i.colSpan),!(0,e.isNullOrUndefined)(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan),(i=zn(a,o,n))&&(i.colSpan>1&&o+(i.colSpan-1)>t.range[1]&&(t.range[1]=o,t.range[1]=o+(i.colSpan-1)),i.rowSpan>1&&a+(i.rowSpan-1)>t.range[0]&&(t.range[0]=a,t.range[0]=a+(i.rowSpan-1))));var l,d;for(s=t.range[2];s<=t.range[0];s++)(i=zn(s,t.range[3],n))&&(d=s,l=t.range[3],!(0,e.isNullOrUndefined)(i.rowSpan)&&i.rowSpan<0&&(d+=i.rowSpan)<t.range[2]&&(t.range[2]=d),!(0,e.isNullOrUndefined)(i.colSpan)&&i.colSpan<0&&(l+=i.colSpan)<t.range[3]&&(t.range[3]=l),(i=zn(d,l,n))&&(i.rowSpan>1&&d+(i.rowSpan-1)>t.range[0]&&(t.range[0]=d,t.range[0]=d+(i.rowSpan-1)),i.colSpan>1&&l+(i.colSpan-1)>t.range[1]&&(t.range[1]=l,t.range[1]=l+(i.colSpan-1))))}},r.prototype.reverseForward=function(t){t.range=t.range;var r=(0,e.isUndefined)(t.sheetIndex)?this.parent.getActiveSheet():Fn(this.parent,t.sheetIndex),n=t.range[0],i=t.range[1],a=zn(t.range[0],t.range[1],r);if(a&&(!(0,e.isNullOrUndefined)(a.rowSpan)&&a.rowSpan<0&&(n+=a.rowSpan,t.range[2]>=n&&(t.range[2]=n)),!(0,e.isNullOrUndefined)(a.colSpan)&&a.colSpan<0&&(i+=a.colSpan),(a=zn(n,i,r))&&(a.rowSpan>1&&n+(a.rowSpan-1)>=t.range[0]&&(t.range[0]=n,t.range[0]=n+(a.rowSpan-1)),a.colSpan>1&&i+(a.colSpan-1)>=t.range[3]&&(t.range[3]=t.range[1],t.range[3]=i+(a.colSpan-1)))),!t.skipChecking){for(var o,s,l,d,h=t.range[3],p=t.range[1];p<=t.range[3];p++)(a=zn(t.range[2],p,r))&&(o=t.range[2],h=p,!(0,e.isNullOrUndefined)(a.rowSpan)&&a.rowSpan<0&&(o+=a.rowSpan)<t.range[2]&&(t.range[2]=o),!(0,e.isNullOrUndefined)(a.colSpan)&&a.colSpan<0&&(h+=a.colSpan)<t.range[1]&&(t.range[1]=h),(a=zn(o,h,r))&&(a.colSpan>1&&h+(a.colSpan-1)>t.range[3]&&(t.range[3]=h+(a.colSpan-1)),a.rowSpan>1&&a.rowSpan-1+o>t.range[0]&&(t.range[0]=a.rowSpan-1+o)));for(p=t.range[1];p<=t.range[3];p++)(a=zn(t.range[0],p,r))&&(l=p,s=t.range[0],!(0,e.isNullOrUndefined)(a.colSpan)&&a.colSpan<0&&(l+=a.colSpan)<t.range[1]&&(t.range[1]=l),!(0,e.isNullOrUndefined)(a.rowSpan)&&a.rowSpan<0&&(s+=a.rowSpan),(a=zn(s,l,r))&&a.rowSpan>1&&s+(a.rowSpan-1)>t.range[0]&&(t.range[0]=s+(a.rowSpan-1)));for(p=t.range[2];p<=t.range[0];p++)(a=zn(p,t.range[3],r))&&(o=p,d=t.range[3],!(0,e.isNullOrUndefined)(a.rowSpan)&&a.rowSpan<0&&(o+=a.rowSpan)<t.range[2]&&(t.range[2]=o),!(0,e.isNullOrUndefined)(a.colSpan)&&a.colSpan<0&&(d+=a.colSpan)<t.range[1]&&(t.range[1]=d),(a=zn(o,d,r))&&(a.rowSpan>1&&a.rowSpan-1+o>t.range[0]&&(t.range[0]=a.rowSpan-1+o),a.colSpan>1&&a.colSpan-1+d>t.range[3]&&(t.range[3]=d,t.range[3]=a.colSpan-1+d)))}},r.prototype.insertHandler=function(e){this.activeCellRange(e),e.range=e.range,"Row"===e.insertModel?e.range[2]+=e.insertCount:e.range[3]+=e.insertCount,e.preventRefresh=!0,e.merge=!0,this.mergeAll(e)},r.prototype.addEventListener=function(){this.parent.on(St,this.merge,this),this.parent.on(It,this.mergedRange,this),this.parent.on(Et,this.activeCellRange,this),this.parent.on(Nt,this.insertHandler,this)},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(St,this.merge),this.parent.off(It,this.mergedRange),this.parent.off(Et,this.activeCellRange),this.parent.off(Nt,this.insertHandler))},r.prototype.getModuleName=function(){return"workbookmerge"},r}(),il=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(At,this.setCFRule,this),this.parent.on(Ot,this.clearCFRule,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(At,this.setCFRule),this.parent.off(Ot,this.clearCFRule))},e.prototype.setCFRule=function(e){var r=e.cfModel,n=void 0===e.sheetIdx?p(this.parent,r.range):e.sheetIdx,i=Fn(this.parent,n),o=c(t(r.range||i.selectedRange));if(r.range=a(o),e.isAction){var s={range:r.range,type:r.type,cancel:!1,cFColor:r.cFColor,value:r.value,sheetIdx:n};if(this.parent.notify(K,{eventArgs:s,action:"conditionalFormat"}),s.cancel)return;r.type=s.type,r.cFColor=s.cFColor,r.value=s.value,s.range!==r.range&&(r.range=s.range,o=c(t(s.range))),delete s.cancel}i.conditionalFormats||this.parent.setSheetPropertyOnMute(i,"conditionalFormats",[]),i.conditionalFormats.push(r),n!==this.parent.activeSheetIndex?e.isUndoRedo&&!e.isFromUpdateAction&&this.parent.notify(nt,{address:i.name+"!"+r.range}):this.parent.notify(kt,{cfModel:[r],isAction:!0}),this.parent.setUsedRange(o[2],o[3]),e.isAction&&this.parent.notify("actionComplete",{eventArgs:{range:r.range,type:r.type,cFColor:r.cFColor,value:r.value,sheetIdx:n},action:"conditionalFormat"})},e.prototype.clearCFRule=function(e){void 0===e.sheetIdx&&(e.sheetIdx=this.parent.activeSheetIndex);var r=Fn(this.parent,e.sheetIdx),n=r.conditionalFormats,i=n&&n[n.length-1]&&"autofillWithCF"!==n[n.length-1].action;if(e.isUndo)return e.updatedCFModel&&e.updatedCFModel.forEach((function(e){for(var t=0;t<n.length;t++)if(n[t].type===e.type&&n[t].cFColor===e.cFColor&&n[t].range===e.range&&n[t].value===e.value){n.splice(t,1);break}})),n.push.apply(n,e.oldCFModel.map((function(e){return Object.assign({},e)}))),this.parent.notify(kt,{cfModel:e.oldCFModel,isAction:!0}),void(e.sheetIdx!==this.parent.activeSheetIndex&&this.parent.notify(nt,{address:r.name+"!"+e.range}));if(n&&n.length){var o,s,l,d,h,p,u,f,g,m=e.range&&("string"==typeof e.range?t(e.range):e.range);m=m?c(m):m,e.oldCFModel=[],e.updatedCFModel=[];for(var v=[],y=[],C=[],b=0;b<n.length;b++){s=(o=n[b]).range.split(",");for(var x=0;x<s.length;x++){if(l=t(s[x]),e.range)if(m[0]<=l[0]&&m[1]<=l[1]&&m[2]>=l[2]&&m[3]>=l[3])s.splice(x,1),x--;else{if(u=m[0]>=l[0]&&m[0]<=l[2],f=m[2]>=l[0]&&m[2]<=l[2],h=m[1]>=l[1]&&m[1]<=l[3],p=m[3]>=l[1]&&m[3]<=l[3],d=[],u&&f?((h||p||m[1]<l[1]&&m[3]>l[3])&&(m[0]-l[0]>0&&d.push(a([l[0],l[1],m[0]-1,l[3]])),l[2]-m[2]>0&&d.push(a([m[2]+1,l[1],l[2],l[3]]))),h&&m[1]!==l[1]&&d.push(a([m[0],l[1],m[2],m[1]-1])),p&&m[3]!==l[3]&&d.push(a([m[0],m[3]+1,m[2],l[3]]))):h&&p?((u||f||m[0]<l[0]&&m[2]>l[2])&&(m[1]-l[1]>0&&d.push(a([l[0],l[1],l[2],m[1]-1])),l[3]-m[3]>0&&d.push(a([l[0],m[3]+1,l[2],l[3]]))),u?m[0]!==l[0]&&d.push(a([l[0],m[1],m[0]-1,m[3]])):f&&m[2]!==l[2]&&d.push(a([m[2]+1,m[1],l[2],m[3]]))):(u||f)&&(h?(m[1]!==l[1]&&d.push(a([l[0],l[1],l[2],m[1]-1])),m[0]-l[0]>0?d.push(a([l[0],m[1],m[0]-1,l[3]])):l[2]-m[2]>0&&d.push(a([m[2]+1,m[1],l[2],l[3]]))):p&&(m[3]!==l[3]&&d.push(a([l[0],m[3]+1,l[2],l[3]])),m[0]-l[0]>0?d.push(a([l[0],l[1],m[0]-1,m[3]])):l[2]-m[2]>0&&d.push(a([m[2]+1,l[1],l[2],m[3]])))),!d.length)continue;s[x]=d.join(",")}else m=l,s.splice(x,1),x--;e.sheetIdx===this.parent.activeSheetIndex&&this.parent.notify(Tt,{indexes:m.slice()})}if((g=s.join(","))!==o.range){if(e.cfModel&&(e.cfModel.cFColor!==o.cFColor||e.cfModel.type!==o.type||e.cfModel.value!==o.value)){C.push(o);continue}y.push(o.range),g?(e.oldCFModel.push({type:o.type,cFColor:o.cFColor,format:o.format,range:o.range,value:o.value}),o.range=g,o.result&&(delete o.result,this.parent.notify(kt,{cfModel:[o],isAction:!0})),e.updatedCFModel.push(o),v.push(o)):(e.oldCFModel.push(o),v.concat(n.splice(b,1)),b--)}}if(e.sheetIdx!==this.parent.activeSheetIndex?e.isUndoRedo&&!e.isFromUpdateAction&&this.parent.notify(nt,{address:r.name+"!"+e.range}):C.length&&this.parent.notify(kt,{cfModel:C,isAction:!0}),(e.isAction||e.isClear)&&e.oldCFModel.length){var S={cFormats:v,oldRange:y,previousConditionalFormats:e.oldCFModel,sheetIdx:e.sheetIdx,selectedRange:e.range};e.updatedCFModel.length&&(S.conditionalFormats=e.updatedCFModel),e.isClear?e.cfClearActionArgs=S:i&&this.parent.notify("actionComplete",{eventArgs:S,action:"clearCF"})}}},e.prototype.getModuleName=function(){return"workbookConditionalFormatting"},e}(),al=function(){function r(e){this.parent=e,this.addEventListener()}return r.prototype.getFillInfo=function(t){for(var r=this.parent.serviceLocator.getService(un),n="",i=!0,a="CopyCells",o=[],s=["Down","Up"].indexOf(t.direction)>-1,l=this.getRangeData({range:t.dataRange,sheetIdx:this.parent.activeSheetIndex}),d=l.join().replace(/,/g,"").length,h=this.isRange(t.dataRange)&&d?l.length:1;h--;)if(dn(n=l[h]&&!(0,e.isNullOrUndefined)(l[h].value)?l[h].value:"")||wr(n)||dn(n[n.length-1])){i=!1,a=this.parent.autoFillSettings.fillType;break}return d&&!i||(o.push(r.getConstant("FillSeries")),a="FillSeries"===t.fillType?a:t.fillType),(!s||s&&t.dataRange[1]!==t.dataRange[3])&&o.push("Flash Fill"),{fillType:a,disableItems:o}},r.prototype.isRange=function(e){return e&&(e[0]!==e[2]||e[1]!==e[3])},r.prototype.autoFill=function(e){if(e.dataRange&&e.fillRange&&e.direction&&this.parent.allowEditing&&(!this.parent.getActiveSheet().isProtected||!e.isLockedCell)){var r=c(t(e.dataRange)),n=c(t(e.fillRange)),i={dataRange:r,fillRange:n,direction:e.direction,fillType:e.fillType||this.fillInfo.fillType,dataSheetIndex:p(this.parent,e.dataRange),fillSheetIndex:p(this.parent,e.fillRange),cells:e.cells};switch(this.fillInfo=this.getFillInfo({dataRange:r,fillRange:n,fillType:e.fillType,direction:e.direction}),this.fillInfo.fillType=e.isFillOptClick?e.fillType:this.fillInfo.fillType,e.fillType){case"FillSeries":case"FillWithoutFormatting":this.fillSeries(i);break;case"CopyCells":case"FillFormattingOnly":this.copyCells(i)}}},r.prototype.fillSeries=function(t){var r,n,i,a,s,l,d,h,p,c,u,f,g,m,v,y,C,b,x,S,w,I,E,N,R,A,k={},O=0,F=(0,e.isUndefined)(t.dataSheetIndex)?this.parent.activeSheetIndex:t.dataSheetIndex,T=Fn(this.parent,F);(0,e.isUndefined)(t.fillSheetIndex)?(R=this.parent.activeSheetIndex,A=!0):A=(R=t.fillSheetIndex)===this.parent.activeSheetIndex;for(var D,L,P=Fn(this.parent,R),M=t.dataRange[0],B=t.dataRange[1],H=t.dataRange[2],U=t.dataRange[3],V=t.fillRange[0],z=t.fillRange[1],j=t.fillRange[2],_=t.fillRange[3],q=["Down","Up"].indexOf(t.direction)>-1,W=["Up","Left"].indexOf(t.direction)>-1,G=q?U-B:H-M,Y="FillSeries"===t.fillType,X=T.conditionalFormats&&T.conditionalFormats.length&&[].slice.call(T.conditionalFormats),K=[],$=A&&this.applyWrapToOuterCells(P),Z="FillWithoutFormatting"!==t.fillType&&A&&q;O<=G;){l=(s=this.updateFillValues(q,M,B,H,U,V,z,j,_,O)).patternRange,d=s.fillRange,i=this.getPattern(l,{isReverseFill:W,isVFill:q},F),h=this.getRangeData({range:l,sheetIdx:F}),q||(h=this.getRangeData({range:l,sheetIdx:F},!0));var J=!1;h[0]&&h[0].formula&&h[0].formula.match(/=[A-Za-z]+\(([^:]+):([^:]+)\)/)&&(J=!0),f=h.length;for(var Q=0;Q<f;Q++)if(h[Q]&&h[Q].isReadOnly)return void this.parent.notify(Ct,null);if(!i||!i.length)return;for(n=i.length,S=(x=this.getSelectedRange(P,{rowIndex:d[0],colIndex:d[1]},{rowIndex:d[2],colIndex:d[3]})).length,W&&(x=x.reverse(),i=i.reverse(),i=this.ensurePattern(i),h=h.reverse()),g=0;g<S;){switch(w=x[g],dn(a=i[g%n])&&(a=i[a]),v=g%f,a.type){case"number":case"date":if(a.isStartWithMonth&&1===f?(E=on(a.regVal.a),N=new Date(E),E.setMonth(E.getMonth()+a.regVal.b*a.i),N.getDate()>28&&N.getDate()!==E.getDate()&&(N.setDate(1),N.setMonth(N.getMonth()+a.regVal.b*a.i),N.setDate(new Date(N.getFullYear(),N.getMonth()+1,0).getDate()),E=N),r=sn(E).toString()):(r=this.round(a.regVal.a+a.regVal.b*a.i,5).toString(),a.val&&(c="string"==typeof a.val[0]&&a.val[0].match(/^0+/))&&(p=this.getNextFormattedValue(a.val[0],Number(r)))),a.dataVal){if(void 0===a.copy&&!c&&(a.copy=a.val.length>2,a.copy))for(var ee=2;ee<a.val.length&&(a.copy=Math.abs(this.round(a.regVal.a+a.regVal.b*ee,5))!==a.val[ee],!a.copy);ee++);r=a.copy?h[v]&&!(0,e.isNullOrUndefined)(h[v].value)?h[v].value:"":a.start?Math.abs(Number(r))+a.dataVal:c?a.dataVal+p:a.dataVal+Math.abs(Number(r))}W?a.i--:a.i++;break;case"string":var te=a.i%a.val.length;r=a.val[te],a.i++;break;case"formula":for(b=!1,r="=",m=0,y=a.val.length;m<y;)"object"==typeof(u=a.val[m])?(b=!0,(C=this.round(u.a+u.b*a.i,5))<1?(r+="#REF!",J&&(m=y-1,r+=a.val[m])):r+=q?u.c+(u.b?C:"$"+C):(u.b?o(C):u.c.substring(0,u.c.search(/\d/))+"$"+o(C))+u.c.trim()):r+=u,m++;b&&W?a.i--:a.i++;break;case"time":r=(a.regVal.a+a.regVal.b*a.i).toString(),Number(r)<0&&W&&(r=(a.regVal.a+Math.ceil(Math.abs(a.i/24))+a.regVal.b*a.i).toString()),W?a.i--:a.i++}if((I=zn(w.rowIndex,w.colIndex,P,!1,!0))&&I.isReadOnly)return void this.parent.notify(Ct,null);if(Y?Object.assign(k,h[v],null,!0):("FillWithoutFormatting"===t.fillType&&h[v]&&h[v].hyperlink?(k.hyperlink=h[v].hyperlink,k.style={textDecoration:"none",color:"inherit"}):k.style=I.style,k.format=I.format,k.wrap=I.wrap,k.rowSpan=I.rowSpan,k.colSpan=I.colSpan),h[v]&&h[v].validation){k.validation=Object.assign({},h[v].validation);var re=[w.rowIndex,w.colIndex,w.rowIndex,w.colIndex],ne=[t.dataRange[0],t.dataRange[1],t.dataRange[2],t.dataRange[3]],ie=this.parent.sheets[this.parent.activeSheetIndex],ae=Br(re,ne,ie,this.parent,{formula:k.validation.value1});k.validation.value1=ae,""!==k.validation.value2&&(ae=Br(re,ne,ie,this.parent,{formula:k.validation.value2}),k.validation.value2=ae)}var oe=wr(r);oe&&(k.formula=r),("0"!==r||"0"===r&&"FillWithoutFormatting"!==t.fillType)&&(k.value=oe&&"Manual"===this.parent.calculationMode?h[v]?h[v].value:"0":r),(0,e.isNullOrUndefined)(k.notes)||delete k.notes,D={cell:k,rowIdx:w.rowIndex,colIdx:w.colIndex,valChange:!0,uiRefresh:A,pvtExtend:!0,skipFormatCheck:!0,fillType:t.fillType},!A||ml(P,w.rowIndex)||Al(P,w.colIndex)||(D.td=this.parent.getCell(w.rowIndex,w.colIndex),D.td&&(D.uiRefresh=!0)),Vr(this.parent,P,D,t.cells)||(A&&$(D),X&&!L&&((L=D.isFormulaDependent)||qr(X,K,w.rowIndex,w.colIndex,t.dataRange,t.fillRange,T)),Z&&k.style&&Mr(k.style)&&this.parent.notify(le,{rowIdx:w.rowIndex,colIdx:w.colIndex,style:k.style,lastCell:!0,isHeightCheckNeeded:!0,onActionUpdate:!0,manualUpdate:!0})),k={},g++}O++}(K.length||L)&&this.parent.notify(kt,{cfModel:!L&&K,refreshAll:L,isAction:!0,isEdit:!0})},r.prototype.copyCells=function(t){var r,n,i,a,o,s,l,d,h,p,c,u,f=0,g={},m=t.dataRange[0],v=t.dataRange[1],y=t.dataRange[2],C=t.dataRange[3],b=t.fillRange[0],x=t.fillRange[1],S=t.fillRange[2],w=t.fillRange[3],I=["Down","Up"].indexOf(t.direction)>-1,E=["Up","Left"].indexOf(t.direction)>-1,N=I?C-v:y-m,R=(0,e.isUndefined)(t.dataSheetIndex)?this.parent.activeSheetIndex:t.dataSheetIndex,A=Fn(this.parent,R);(0,e.isUndefined)(t.fillSheetIndex)?(u=!0,c=this.parent.activeSheetIndex):(u=t.fillSheetIndex===this.parent.activeSheetIndex,c=t.fillSheetIndex);for(var k,O,F,T=Fn(this.parent,c),D="FillFormattingOnly"===t.fillType,L=A.conditionalFormats&&A.conditionalFormats.length&&[].slice.call(A.conditionalFormats),P=u&&this.applyWrapToOuterCells(T),M=[],B=u&&I;f<=N;){i=(o=this.updateFillValues(I,m,v,y,C,b,x,S,w,f)).patternRange,a=o.fillRange,l=(s=this.getRangeData({range:i,sheetIdx:R})).length;for(var H=0;H<l;H++)if(s[H]&&s[H].isReadOnly)return void this.parent.notify(Ct,null);for(h=(d=this.getSelectedRange(T,{rowIndex:a[0],colIndex:a[1]},{rowIndex:a[2],colIndex:a[3]})).length,r=0,E&&(d=d.reverse());r<h;){if(n=r%l,p=d[r],D&&(k=zn(p.rowIndex,p.colIndex,T)),Object.assign(g,s[n],null,!0),D&&(g.value=k.value,g.formula=k.formula,(0,e.isNullOrUndefined)(g.notes)||delete g.notes,g.validation&&delete g.validation),g&&g.isReadOnly)return void this.parent.notify(Ct,null);(0,e.isNullOrUndefined)(g.notes)||(0,e.isNullOrUndefined)(g.isNoteEditable)||(delete g.notes,delete g.isNoteEditable),F={cell:g,rowIdx:p.rowIndex,colIdx:p.colIndex,valChange:!0,pvtExtend:!0,fillType:t.fillType},!u||ml(T,p.rowIndex)||Al(T,p.colIndex)||(F.td=this.parent.getCell(p.rowIndex,p.colIndex),F.uiRefresh=!!F.td),Vr(this.parent,T,F,t.cells)||(u&&P(F),L&&!O&&((O=F.isFormulaDependent)||qr(L,M,p.rowIndex,p.colIndex,t.dataRange,t.fillRange,A)),B&&g.style&&Mr(g.style)&&this.parent.notify(le,{rowIdx:p.rowIndex,colIdx:p.colIndex,style:g.style,lastCell:!0,isHeightCheckNeeded:!0,onActionUpdate:!0,manualUpdate:!0})),g={},r++}f++}(M.length||O)&&this.parent.notify(kt,{cfModel:!O&&M,refreshAll:O,isAction:!0,isEdit:!0})},r.prototype.applyWrapToOuterCells=function(e){var t,r,n,i=this,a=this.parent.frozenRowCount(e),o=this.parent.frozenColCount(e),s=this.parent.viewport;return s&&(t=s.topIndex+a,r=s.leftIndex+o),function(s){!s.td&&zn(s.rowIdx,s.colIdx,e,!1,!0).wrap&&(s.rowIdx>=a&&s.rowIdx<t||s.colIdx>=o&&s.colIdx<r)&&(n||(n={range:null,wrap:!0,sheet:e,initial:!0,outsideViewport:!0}),n.range=[s.rowIdx,s.colIdx,s.rowIdx,s.colIdx],i.parent.notify(Ge,n))}},r.prototype.updateFillValues=function(e,t,r,n,i,a,o,s,l,d){var h,p,c,u;return e?(h={rowIndex:t,colIndex:r+d},p={rowIndex:n,colIndex:r+d},c={rowIndex:a,colIndex:o+d},u={rowIndex:s,colIndex:o+d}):(h={rowIndex:t+d,colIndex:r},p={rowIndex:t+d,colIndex:i},c={rowIndex:a+d,colIndex:o},u={rowIndex:a+d,colIndex:l}),{patternRange:[h.rowIndex,h.colIndex,p.rowIndex,p.colIndex],fillRange:[c.rowIndex,c.colIndex,u.rowIndex,u.colIndex]}},r.prototype.getDataPattern=function(t,r){var n,i,a,o,s,l=0,d={val:null,type:null},h=[],p=this.getRangeData({range:t,sheetIdx:(0,e.isUndefined)(r)?this.parent.activeSheetIndex:r}),c=p.length;if(c){for(var u=void 0,f=void 0,g=void 0,m=void 0,v=function(e){return!o&&e&&"-"===e[e.length-1]?e.slice(0,e.length-1):e};l<c;){if(s=!1,p[l])if(p[l].formula&&wr(p[l].formula))n=p[l].formula,a="formula";else{n=(0,e.isNullOrUndefined)(p[l].value)?"":p[l].value;var y={};if(g=p[l].format,m=dn(n),g&&Yn(g,!0,y)){if(a=y.type,n&&!m){var C={value:n,updatedVal:n,cell:p[l]};this.parent.notify(ue,C),C.isDate||C.isTime?p[l].value=n=C.updatedVal:a="string"}s="date"===a&&g.toLowerCase().startsWith("mmm")}else a=m?"number":"string"}else n="",a="string";if(f="","string"===a){if(o=!1,dn(n[0])){u=0;do{u++}while(dn(n[u]));" "===n[u]&&(o=!0,a="number",f=n.slice(u,n.length),n=Number(n.slice(0,u)))}if(!o&&dn(n[n.length-1])){u=1;do{u++}while(dn(n[n.length-u]));a="number",u-=1,f=n.slice(0,n.length-u),i=n.slice(n.length-u,n.length),n=i.match(/^0+/)?i:Number(i),d.dataVal&&d.dataVal!==f&&d.dataVal===v(f)&&(f=d.dataVal)}}0===l?(d={val:[n],type:a,isStartWithMonth:s},f&&(d.dataVal=f,d.start=o)):a!==d.type||d.dataVal&&v(d.dataVal)!==v(f)?(h.push(d),d={val:[n],type:a},f&&(d.dataVal=f,d.start=o)):d.val.push(n),l++}return h.push(d),h}return[{val:null,type:null}]},r.prototype.getPredictionValue=function(e,t){for(var r=0,n=0,i=0,a=0,o=0,s=0,l=0,d=e.length;r<d;)n+=r,i+=Number(e[r]),a+=r*Number(e[r]),o+=r*r,r++;return t?(s=(i*o-n*a)/(d*o-n*n),l=(d*a-n*i)/(d*o-n*n)):(s=this.round((i*o-n*a)/(d*o-n*n),5),l=this.round((d*a-n*i)/(d*o-n*n),5)),{a:s,b:l}},r.prototype.getPattern=function(e,t,r){var n,i,a,o,s,l,d=0,h=[],p=this.getDataPattern(e,r),c=p.length;if(p){for(;d<c;){switch((l=p[d]).type){case"number":case"date":if(i=h.length,s=l.val.length,o=t.isReverseFill?-1:s,1===s){var u=parseFloat(l.val[0])+1;"string"==typeof l.val[0]&&l.val[0].match(/^0+/)?l.val.push(this.getNextFormattedValue(l.val[0],u)):l.val.push(u)}for(a={regVal:this.getPredictionValue(l.dataVal?l.val.slice(0,2):l.val),type:l.type,i:o,isStartWithMonth:l.isStartWithMonth},l.dataVal&&(a.dataVal=l.dataVal,a.val=l.val,a.start=l.start),h.push(a),n=1;n<s;)h.push(i),n++;break;case"string":for(i=h.length,a={val:l.val,type:l.type,i:0},h.push(a),n=1,s=l.val.length;n<s;)h.push(i),n++;break;case"formula":if(s=l.val.length,l=this.getFormulaPattern(l.val,t),o=t.isReverseFill?-1:s,l.isInPattern)for(i=h.length,a={val:l.val,type:"formula",i:o},h.push(a),n=1;n<s;)h.push(i),n++;else for(n=0,o=t.isReverseFill?-1:1;n<s;)h.push({val:l.val[n],type:"formula",i:o}),n++;break;case"time":if(i=h.length,s=l.val.length,o=t.isReverseFill?-1:s,1===s){var f=on(l.val[0]),g=Number(l.val[0]),m=g>=0&&g<1,v=sn(new Date(f.getTime()+36e5),!0,m);l.val.push(v)}for(a={regVal:this.getPredictionValue(l.val,!0),type:l.type,i:o},h.push(a),n=1;n<s;)h.push(i),n++}d++}return h}return[{regVal:null}]},r.prototype.getNextFormattedValue=function(t,r){var n=(new e.Internationalization).formatNumber(Math.abs(r),{minimumIntegerDigits:t.length,useGrouping:!1}),i=br({value:n},this.parent.locale);return i.isNumber?i.value:n},r.prototype.isCellReference=function(e){return/^[a-z]{1,3}\d{1,7}$/gi.test(e)?"relative":/^\$[a-z]{1,3}\$\d{1,7}$/gi.test(e)?"absolute":!!/^((\$[a-z]{1,3})\d{1,7}|[a-z]{1,3}(\$\d{1,7}))$/gi.test(e)&&"mixed"},r.prototype.round=function(e,t){return Number(Math.round(parseFloat(e+"e"+t))+"e-"+t)||Number(e)},r.prototype.getRangeData=function(t,r){for(var n,i,a=[],o=(0,e.isUndefined)(t.sheetIdx)?this.parent.getActiveSheet():Fn(this.parent,t.sheetIdx),s=t.range[0],l=t.range[1],d=t.range[2],h=t.range[3],p=l;s<=d;)if(ml(o,s))s++;else{for(l=p;l<=h;)if(Al(o,l))l++;else{if(n=zn(s,l,o),r&&(n=Object.assign({},zn(s,l,o)),i=Object.assign({},Il(o,l)),n&&!n.validation&&i&&i.validation)){n.validation=Object.assign({},Il(o,l).validation);var c=[s,l,s,l],u=[0,l,0,l],f=Br(c,u,o,this.parent,{formula:i.validation.value1});n.validation.value1=f,""!==n.validation.value2&&(f=Br(c,u,o,this.parent,{formula:i.validation.value2}),n.validation.value2=f)}a.push(n),l++}s++}return a},r.prototype.getFormulaPattern=function(e,t){for(var r,n,i,a,o=[],s=0,l=e.length,d={};s<l;)d.formula=e[s],this.parent.notify(dr,d),o.push(d.formulaArr),s++;var h=this.isInPattern(o,t.isVFill);if(h){for(s=(i=o[0]).length;s--;)n=i[s],(a=this.isCellReference(n))&&"absolute"!==a&&(i[s]=this.getCellRefPrediction(n,t,null,a));return{isInPattern:h,val:i}}for(s=0;s<l;){for(r=(i=o[s]).length;r--;)n=i[r],(a=this.isCellReference(n.trim()))&&"absolute"!==a&&(o[s][r]=this.getCellRefPrediction(n,t,l,a));s++}return{isInPattern:h,val:o}},r.prototype.generateColCount=function(e){for(var t=0,r=0;r<e.length;r++){t=26*t+(e.charCodeAt(r)-64)}return t},r.prototype.getCellRefPrediction=function(e,t,r,n){e=e.toUpperCase();var i=new RegExp("[a-z$]","gi"),a=new RegExp("[0-9$]","g"),o=t.isVFill?e.replace(a,""):e.replace(i,""),s=t.isVFill?Number(e.replace(i,"")):this.generateColCount(e.replace(a,"").trim()),l=null,d=[s],h="$"===e[0];if(!h&&e.includes("$")&&"$"===e.trim()[0])for(var p=1;p<e.length;p++)if("$"===e[p]){l=p,h=!0;break}return r&&1!==r?d.push(s+r):d.push(s+1),s=this.getPredictionValue(d),n&&"mixed"===n&&(h===t.isVFill?o=l?o.substring(0,l)+"$"+o.substring(l):"$"+o:s.b=0),s.c=o,s},r.prototype.isInPattern=function(e,t){var r,n,i,a,o,s,l,d=0,h=1,p=e.length,c=new RegExp("[0-9$]","g"),u=new RegExp("[a-z$]","gi");if(1===p)return!1;for(;h<p;){if(r=e[d],i=e[h],(n=r.length)!==i.length)return!1;for(;n--;)if(a=r[n],o=i[n],this.isCellReference(a)===this.isCellReference(o)){if(t?(s=Number(a.replace(u,"")),l=Number(o.replace(u,""))):(s=this.generateColCount(a.replace(c,"")),l=this.generateColCount(o.replace(c,""))),s!==l-1)return!1}else if(a!==o)return!1;d++,h++}return!0},r.prototype.ensurePattern=function(e){for(var t,r=-1,n=e.length;n--;)"object"==typeof(t=e[n])?(r=n,"string"===t.type&&(t.val=t.val.reverse())):e[n]=r;return e},r.prototype.getSelectedRange=function(e,t,r){var n,i,a,o=[],s=c([t.rowIndex,t.colIndex,r.rowIndex,r.colIndex]);n=s[0];for(var l=s[2];n<=l;)if(vl(e,n))n++;else{for(i=s[1],a=s[3];i<=a;)o.push({rowIndex:n,colIndex:i}),i++;n++}return o},r.prototype.getFillType=function(e){return e.fillType=this.fillInfo.fillType,e.disableItems=this.fillInfo.disableItems,e},r.prototype.addEventListener=function(){this.parent.on(Xt,this.autoFill,this),this.parent.on($t,this.getFillType,this)},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Xt,this.autoFill),this.parent.off($t,this.getFillType))},r.prototype.getModuleName=function(){return"workbookautofill"},r}(),ol=function(){function t(){this.services={}}return t.prototype.getService=function(t){if((0,e.isNullOrUndefined)(this.services[""+t]))throw"The service "+t+" is not registered";return this.services[""+t]},t.prototype.register=function(t,r){(0,e.isNullOrUndefined)(this.services[""+t])&&(this.services[""+t]=r)},t}(),sl=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ll=function(){return ll=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ll.apply(this,arguments)},dl=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},hl=function(n){function a(e){var t=n.call(this,e)||this;return t.isEdit=!1,t.sheetNameCount=1,t.dataValidationRange="",t.isOpen=!1,t.chartColl=[],t.isPrintingProcessing=!1,t.currentPrintSheetIndex=0,t.customFormulaCollection=new Map,o.Inject(Jn,Cs,gs,Us,Xs,Ks,Hs,qs,$s,Ws,Zs,tl,Qs,rl,nl,il,Gs,Ys,al),t.commonCellStyle={},e&&e.cellStyle&&(t.commonCellStyle=e.cellStyle),"workbook"===t.getModuleName()&&(t.serviceLocator=new ol,t.initWorkbookServices(),t.dataBind(),t.initEmptySheet()),t}var o;return sl(a,n),o=a,a.prototype.preRender=function(){Object.keys(this.commonCellStyle).length||(this.commonCellStyle=_n(this.cellStyle,!0)),"spreadsheet"!==this.getModuleName()||this.refreshing||this.initEmptySheet()},a.prototype.initWorkbookServices=function(){this.serviceLocator.register(un,new e.L10n(this.getModuleName(),fn,this.locale))},a.prototype.render=function(){},a.prototype.requiredModules=function(){return C(this)},a.prototype.getPersistData=function(){return this.addOnPersist([])},a.prototype.cellFormat=function(e,t){var r=this.getActiveSheet();!r||r.isProtected&&!r.protectSettings.formatCells||(t=t||r.selectedRange,this.notify(ae,{style:e,range:t,refreshRibbon:t.indexOf(r.activeCell)>-1}))},a.prototype.lockCells=function(e,t){var r=this.getActiveSheet();e=e||r.selectedRange,this.notify(bt,{range:e,isLocked:t,triggerEvent:!0})},a.prototype.getCellStyleValue=function(e,t){var r=this,n=zn(t[0],t[1],this.getActiveSheet()),i={};return e.forEach((function(e){i[""+e]=r.cellStyle[""+e],n&&n.style&&n.style[""+e]&&(i[""+e]=n.style[""+e])})),i},a.prototype.numberFormat=function(e,t){this.notify(te,{format:e,range:t}),this.notify(gr,{action:"addToCustomFormats",format:e})},a.prototype.createSheet=function(e,t){var r;void 0===e&&(e=this.sheets.length),void 0===t&&(t=[{}]),(r=this.sheets).splice.apply(r,[e,0].concat(t)),Ln(this,t),this.notify(be,{sheetIndex:e||0,sheets:t}),this.notify(pe,{action:"registerSheet",sheetIndex:e||0,sheetCount:e+t.length})},a.prototype.removeSheet=function(e){this.sheets.splice(e,1)},a.prototype.destroy=function(){this.notify(j,null),n.prototype.destroy.call(this)},a.prototype.onPropertyChanged=function(t,r){for(var n=0,i=Object.keys(t);n<i.length;n++){switch(i[n]){case"cellStyle":(0,e.merge)(this.commonCellStyle,t.cellStyle);break;case"sheets":t.sheets===this.sheets?(this.notify(pe,{action:"unRegisterSheet",propertyChange:!0}),this.sheetNameCount=1,this.notify(xe,{}),Ln(this),this.notify(be,null),this.notify(pe,{action:"registerSheet"})):Ln(this);break;case"listSeparator":this.notify(pe,{action:"setArgumentSeparator"})}}},a.prototype.appendTo=function(e){n.prototype.appendTo.call(this,e)},a.prototype.hideRow=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!0);for(var n=this.getActiveSheet(),i=e;i<=t;i++)gl(n,i,{hidden:r})},a.prototype.hideColumn=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!0);for(var n=this.getActiveSheet(),i=e;i<=t;i++)El(n,i,{hidden:r})},a.prototype.setBorder=function(e,t,r,n){this.notify(ae,{style:e,borderType:r,range:t||this.getActiveSheet().selectedRange,isUndoRedo:n})},a.prototype.insertRow=function(e,t,r){this.notify($e,{model:this.getSheetModel(r),start:e,end:t,modelType:"Row",insertType:"below"})},a.prototype.insertColumn=function(e,t,r){this.notify($e,{model:this.getSheetModel(r),start:e,end:t,modelType:"Column",insertType:"after"})},a.prototype.insertSheet=function(e,t){this.isProtected||this.notify($e,{model:this,start:e,end:t,modelType:"Sheet"})},a.prototype.delete=function(t,r,n,i){if(!this.isProtected){var a;if(t=t||0,r=(0,e.isNullOrUndefined)(r)?t:r,n&&"Sheet"!==n){if(!(a=this.getSheetModel(i)))return}else if(a=this,Math.abs(r-t)>=this.sheets.length)return;this.notify(Ze,{model:a,start:t,end:r,modelType:n||"Sheet"})}},a.prototype.moveSheet=function(e,t){this.isProtected||Mn(this,e,t)},a.prototype.duplicateSheet=function(e){this.isProtected||Bn(this,e)},a.prototype.getSheetModel=function(t){if((0,e.isNullOrUndefined)(t))return this.getActiveSheet();var r="string"==typeof t?In(this,t):t;return(0,e.isNullOrUndefined)(r)||r>=this.sheets.length?null:this.sheets[r]},a.prototype.merge=function(e,t){var r,n;e?n=Fn(this,r=this.isPrintingProcessing?this.currentPrintSheetIndex:p(this,e)):(e=(n=this.getActiveSheet()).selectedRange,r=this.activeSheetIndex),n.isProtected||this.notify(St,{merge:!0,range:e,type:t||"All",sheetIndex:r,refreshRibbon:e.indexOf(n.activeCell)>-1,preventRefresh:this.activeSheetIndex!==r})},a.prototype.unMerge=function(e){var t,r;e?r=Fn(this,t=p(this,e)):(e=(r=this.getActiveSheet()).selectedRange,t=this.activeSheetIndex),r.isProtected||this.notify(St,{merge:!1,range:e,sheetIndex:t,type:"All",refreshRibbon:e.indexOf(r.activeCell)>-1,preventRefresh:this.activeSheetIndex!==t})},a.prototype.computeExpression=function(e){var t={action:"computeExpression",formula:e,isFromComputeExpression:!0};return this.notify(pe,t),t.calcValue},a.prototype.initEmptySheet=function(){this.sheets.length?Ln(this):this.createSheet()},a.prototype.getActiveSheet=function(){return this.sheets[this.activeSheetIndex]},a.prototype.skipHiddenSheets=function(e,t,r){return void 0===r&&(r=0),this.sheets[e]&&"Visible"!==this.sheets[e].state&&(void 0===t&&(t=e),e=e&&e+1===this.sheets.length?t-1:e<t?--e:++e,e=this.skipHiddenSheets(e,t,++r)),r===this.sheets.length?(this.setSheetPropertyOnMute(this.sheets[0],"state","Visible"),0):e},a.prototype.setUsedRange=function(e,t,r,n,i){void 0===r&&(r=this.getActiveSheet()),i?this.setSheetPropertyOnMute(r,"usedRange",{rowIndex:e,colIndex:t}):(e>r.usedRange.rowIndex&&(this.setSheetPropertyOnMute(r,"usedRange",{rowIndex:e,colIndex:r.usedRange.colIndex}),r!==this.getActiveSheet()||n||this.notify(he,{index:e,update:"row"})),t>r.usedRange.colIndex&&(this.setSheetPropertyOnMute(r,"usedRange",{rowIndex:r.usedRange.rowIndex,colIndex:t}),r!==this.getActiveSheet()||n||this.notify(he,{index:t,update:"col"})))},a.prototype.getData=function(e){return gn(this,e)},a.prototype.getModuleName=function(){return"workbook"},a.prototype.goTo=function(e){},a.prototype.getValueRowCol=function(t,r,n,a,o,s,l){var d=En(this,t),h=Fn(this,d),p=zn(r-1,n-1,h);if(a&&a.includes("!")&&!p&&h.ranges&&h.ranges.length){var c;if(this.formulaRefCell&&this.formulaRefCell===a)return p&&p.value;if(h.ranges.forEach((function(e){e.info&&e.info.loadedRange&&e.info.loadedRange.length||(c=!0)})),c){if(this.formulaRefCell=a,d=En(this,Number(a.substring(a.lastIndexOf(",")+1,a.length))),(0,e.isNullOrUndefined)(d))return p&&p.value;a=a.substring(a.lastIndexOf("!")+1,a.lastIndexOf(",")),gn(this,h.name+"!A1:"+i(r-1,n-1),null,null,null,null,a,d)}}else p&&p.formula&&(o||(0,e.isNullOrUndefined)(p.value))&&!s&&"Automatic"===this.calculationMode&&this.notify(ne,{cell:p,rowIdx:r-1,colIdx:n-1,sheetIndex:d,formulaRefresh:!0});if(p&&!dn(p.value)&&!this.isEdit){var u={formattedText:p.value,value:p.value,format:p.format,cell:p,skipFormatCheck:!1};this.notify(re,u),p=u.cell}return l&&p&&p.formula&&p.formula.includes("SUBTOTAL(")?p.formula:p&&p.value},a.prototype.setValueRowCol=function(e,t,r,n,i,a){this.notify(ce,{action:"updateCellValue",address:[r-1,n-1],value:t,sheetIndex:En(this,e),isValueOnly:!0,formula:i,isRandomFormula:a})},a.prototype.open=function(e){this.notify(Y,e)},a.prototype.openFromJson=function(e,t){this.isOpen=!0;var r="object"==typeof e.file?JSON.stringify(e.file):e.file;if(""!==r&&t){var n=[];if(t.onlyValues)n.push.apply(n,["style","formula","format","conditionalFormats","validation","hyperlink","wrap","chart","image","notes"]);else{var i={style:t.ignoreStyle,formula:t.ignoreFormula,format:t.ignoreFormat,conditionalFormats:t.ignoreConditionalFormat,validation:t.ignoreValidation,wrap:t.ignoreWrap,chart:t.ignoreChart,image:t.ignoreImage,notes:t.ignoreNote};for(var a in t.ignoreFreezePane&&n.push.apply(n,["frozenColumns","frozenRows"]),i)i[a]&&n.push(a)}r=JSON.stringify(JSON.parse(r),(function(e,t){if(!(n.indexOf(e)>-1))return t}))}this.notify(Y,{jsonObject:r,triggerEvent:e.triggerEvent})},a.prototype.save=function(e,t){if(void 0===e&&(e={}),this.allowSave){var r={url:this.saveUrl,fileName:e.fileName||"Sample",saveType:"Xlsx"},n=ll({},r,e,{customParams:{},isFullPost:!0,needBlobData:!1,cancel:!1,autoDetectFormat:!1,pdfLayoutSettings:{fitSheetOnOnePage:!1,orientation:"Portrait"}});this.trigger("beforeSave",n),this.notify(K,{eventArgs:n,action:"beforeSave"}),n.cancel||this.notify(X,{saveSettings:n,isFullPost:n.isFullPost,needBlobData:n.needBlobData,customParams:n.customParams,pdfLayoutSettings:n.pdfLayoutSettings,jsonConfig:t})}},a.prototype.saveAsJson=function(e){var t=this;return new Promise((function(r){t.on(Ye,(function(e){e.cancel=!0,t.off(Ye),r({jsonObject:{Workbook:e.jsonObject}}),t.notify(ee,e)})),t.save({},e)}))},a.prototype.addHyperlink=function(e,t){var r={hyperlink:e,cell:t};this.notify(Ve,r)},a.prototype.findHandler=function(e){this.notify(rt,e)},a.prototype.replaceHandler=function(e){"replace"===e.replaceBy?this.notify(at,e):this.notify(ot,e)},a.prototype.protectSheet=function(t,r,n){(0,e.isNullOrUndefined)(t)?t=this.activeSheetIndex:"string"==typeof t&&(t=In(this,t));var i=this.sheets[t];i&&(this.setSheetPropertyOnMute(i,"isProtected",!0),this.setSheetPropertyOnMute(i,"password",n||""),this.setSheetPropertyOnMute(i,"protectSettings",r||{}),this.notify(gt,{protectSettings:i.protectSettings,password:i.password,sheetIndex:t}))},a.prototype.unprotectSheet=function(t){if((0,e.isNullOrUndefined)(t)?t=this.activeSheetIndex:"string"==typeof t&&(t=In(this,t)),this.sheets[t]){var r={sheet:t};this.notify(vt,r)}},a.prototype.sort=function(e,t,r){if(!this.allowSorting)return Promise.reject();var n={args:{range:t||this.getActiveSheet().selectedRange,sortOptions:e||{sortDescriptors:{}},cancel:!1},promise:new Promise((function(e){e(void 0)})),previousSort:r};return this.notify(Oe,n),n.promise},a.prototype.addDataValidation=function(t,r){(0,e.isNullOrUndefined)(t.value1)||("List"===t.type?t.value1.length>256&&(t.value1=t.value1.substring(0,255)):(t.value1=Gr([t.value1],this)[0],t.value2&&(t.value2=Gr([t.value2],this)[0])),this.notify(Qe,{rules:t,range:r||en(this.getActiveSheet())}))},a.prototype.removeDataValidation=function(e){this.notify(Qe,{range:e||en(this.getActiveSheet()),isRemoveValidation:!0})},a.prototype.addInvalidHighlight=function(e){this.notify(et,{range:e})},a.prototype.removeInvalidHighlight=function(e){this.notify(dt,{range:e})},a.prototype.isValidCell=function(e){var t,n,i;if(e){var a=h(this,e);n=a.sheetIndex,i=a.indices,t=Fn(this,n)}else i=r((t=this.getActiveSheet()).activeCell),n=this.activeSheetIndex;var o=zn(i[0],i[1],t,!1,!0);if(o.validation||kl(t.columns[i[1]],i[0],i[1])){var s={value:o.value?o.value:"",range:i,sheetIdx:n,td:null,isValid:!0};return this.notify(Je,s),s.isValid}return!0},a.prototype.conditionalFormat=function(e){var t=this;if(e.range?","!==this.listSeparator&&e.range.includes(this.listSeparator)&&(e.range=e.range.split(this.listSeparator).join(",")):e.range=this.getActiveSheet().selectedRange,e.value){var r,n=void 0;if("Between"===e.type)if(","!==this.listSeparator&&e.value.includes(this.listSeparator))n=(r=e.value.split('"').filter((function(e){return e.trim()&&e.trim()!==t.listSeparator}))).length>1?r:e.value.split(this.listSeparator);else n=(r=e.value.split('"').filter((function(e){return e.trim()&&","!==e.trim()}))).length>1?r:e.value.split(",");else n=[e.value];Gr(n,this),e.value=n.join(",")}this.notify(At,{cfModel:e})},a.prototype.clearConditionalFormat=function(e){var t={};if(e&&e.includes("!")){var r=e.lastIndexOf("!");t.range=e.substring(r+1),t.sheetIdx=In(this,e.substring(0,r))}else t.range=e||this.getActiveSheet().selectedRange,t.sheetIdx=this.activeSheetIndex;this.notify(Ot,t)},a.prototype.updateCell=function(t,r,n){(0,e.isNullOrUndefined)(n)&&(n=!0),this.updateCellDetails(t,r,void 0,void 0,n)},a.prototype.updateCellDetails=function(n,i,a,o,l,d,h){var p,c;if(i||(i=this.getActiveSheet().activeCell),i.includes("!")){if(p=s(i),void 0===(c=In(this,i.substring(0,i.lastIndexOf("!")))))return}else p=t(i),c=this.activeSheetIndex;var u=Fn(this,c);if(!d||u.rowCount>p[0]&&u.rowCount>p[2]&&u.colCount>p[1]&&u.colCount>p[3]){Vr(this,u,{cell:n,rowIdx:p[0],colIdx:p[1],preventEvt:!0});var f=h?n.formula||((0,e.isNullOrUndefined)(n.value)?null:n.value):(0,e.isNullOrUndefined)(n.value)?n.formula||null:n.value,g=null!==f,m=zn(p[0],p[1],u,!1,!0);if(a&&a.format&&o&&(m.format=a.format),g?(delete m.formattedText,this.notify(ce,{action:"updateCellValue",address:p,value:f,sheetIndex:c,cellInformation:a,isRedo:o,isDependentUpdate:l}),this.isEdit&&"#CIRCULARREF!"===m.value&&(m.value="0")):!(0,e.isNullOrUndefined)(n.format)&&m.formattedText&&delete m.formattedText,c===this.activeSheetIndex){var v={sheet:u,cell:m,rowIdx:p[0],colIdx:p[1]};(m.rowSpan>1||m.colSpan>1)&&Xr(v);var y=!ml(u,v.rowIdx)&&!Al(u,v.colIdx)&&this.getCell(v.rowIdx,v.colIdx);y&&this.serviceLocator.getService("cell").refresh(v.rowIdx,v.colIdx,!0,y,g,g);var C=r(u.activeCell);p[0]===C[0]&&p[1]===C[1]&&(this.notify(Mt,null),this.notify(di,{action:"refreshFormulabar",cell:m}),y&&n.validation&&(v.validation=m.validation,v.td=y,v.isRefresh=!0,this.notify(vr,v)))}}else this.notify(ro,null)},a.prototype.getRowData=function(t,r){(0,e.isNullOrUndefined)(t)&&(t=0),(0,e.isNullOrUndefined)(r)&&(r=this.activeSheetIndex);var n={sheetIdx:r,startIndex:t,modelType:"Row",isDataRequest:!0};return this.notify(W,n),n.data},a.prototype.updateRange=function(e,t){void 0===t&&(t=this.activeSheetIndex);var r=Fn(this,t);r&&(e.startCell||(e.startCell="A1"),void 0===e.showFieldAsHeader&&(e.showFieldAsHeader=!0),e.template&&!e.address&&(e.address=e.startCell),r.ranges.push(e),this.setSheetPropertyOnMute(r,"ranges",r.ranges),e.dataSource&&this.notify(q,{sheetIdx:t,rangeIdx:r.ranges.length-1,changedData:e.dataSource}))},a.prototype.wrap=function(e,t){void 0===t&&(t=!0),qn(e,t,this,null,!0)},a.prototype.addDefinedName=function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify(pe,t),t.isAdded},a.prototype.removeDefinedName=function(e,t){void 0===t&&(t="");var r={action:"removeDefinedName",isRemoved:!1,definedName:e,scope:t};return this.notify(pe,r),r.isRemoved},a.prototype.insertImage=function(e,t){this.notify(Dt,{options:e,range:t||this.getActiveSheet().selectedRange})},a.prototype.autoFill=function(e,t,r,n){var i={dataRange:t||this.getActiveSheet().selectedRange,fillRange:e,direction:r||"Down",fillType:n||"FillSeries"};this.notify(Xt,i)},a.prototype.insertChart=function(e){this.notify(Lt,{chart:e})},a.prototype.deleteChart=function(e){this.notify(Oo,{id:e})},a.prototype.filter=function(e,t){if(!this.allowFiltering)return Promise.reject();var r={args:{range:t||this.getActiveSheet().selectedRange,filterOptions:e,cancel:!1},promise:new Promise((function(e){e(void 0)}))};return this.notify(je,r),r.promise},a.prototype.addCustomFunction=function(e,t,r){t=t||("string"==typeof e?e:e.name.replace("bound ",""));var n={action:"addCustomFunction",functionHandler:e,functionName:t,formulaDescription:r};this.notify(pe,n)},a.prototype.clear=function(e){this.notify(Ft,e)},a.prototype.getDisplayText=function(t){if(!t)return"";if(t.format&&!(0,e.isNullOrUndefined)(t.value)){var r={formattedText:t.value,value:t.value,format:t.format,cell:t,skipFormatCheck:!0};return this.notify(re,r),r.formattedText}return!t.value&&t.hyperlink?"string"==typeof t.hyperlink?t.hyperlink:t.hyperlink.address:t.value||"number"==typeof t.value?t.value.toString():""},a.prototype.freezePanes=function(e,t,r){void 0===e&&(e=1),void 0===t&&(t=1);var n=this.getSheetModel(r);!this.allowFreezePane||n.frozenRows===e&&n.frozenColumns===t||(this.setSheetPropertyOnMute(n,"frozenRows",e),this.setSheetPropertyOnMute(n,"frozenColumns",t),this.updateTopLeftCell(),n.id===this.getActiveSheet().id&&"spreadsheet"===this.getModuleName()&&this.renderModule.refreshSheet())},a.prototype.Unfreeze=function(e){this.freezePanes(0,0,e)},a.prototype.unfreezePanes=function(e){this.freezePanes(0,0,e)},a.prototype.calculateNow=function(t,r){"Workbook"===t&&"Manual"===this.calculationMode&&(t="CalculateWorkbook",this.setProperties({calculationMode:"Automatic"},!0));var n={action:"calculateNow",scope:t,sheets:"Workbook"===t||"CalculateWorkbook"===t?this.sheets:[Fn(this,r="string"==typeof r?In(this,r):(0,e.isNullOrUndefined)(r)?this.activeSheetIndex:r)],promise:new Promise((function(e){e(void 0)}))};return this.notify(pe,n),n.promise},a.prototype.updateTopLeftCell=function(t,n,a,o){o||(o=this.getActiveSheet());var s=r(o.topLeftCell);o.frozenRows||o.frozenColumns?(((0,e.isNullOrUndefined)(t)||t<0)&&(t=o.frozenRows?0:s[0]),((0,e.isNullOrUndefined)(n)||n<0)&&(n=o.frozenColumns?0:s[1]),t+=this.frozenRowCount(o),n+=this.frozenColCount(o),a&&("row"===a?t=r(o.paneTopLeftCell)[0]:n=r(o.paneTopLeftCell)[1]),this.setSheetPropertyOnMute(o,"paneTopLeftCell",i(t,n)),o.frozenRows&&(t=s[0]),o.frozenColumns&&(n=s[1])):((0,e.isNullOrUndefined)(t)&&(t=s[0]),(0,e.isNullOrUndefined)(n)&&(n=s[1]),this.setSheetPropertyOnMute(o,"paneTopLeftCell",i(t,n))),this.setSheetPropertyOnMute(o,"topLeftCell",i(t,n))},a.prototype.getAddressInfo=function(e){return h(this,e)},a.prototype.setSheetPropertyOnMute=function(e,t,r){this.isProtectedOnChange=!0,e[""+t]=r,this.isProtectedOnChange=!1},a.prototype.frozenRowCount=function(e){return e.frozenRows?"A1"===e.topLeftCell?e.frozenRows:r(e.topLeftCell)[0]+e.frozenRows:0},a.prototype.frozenColCount=function(e){return e.frozenColumns?"A1"===e.topLeftCell?e.frozenColumns:r(e.topLeftCell)[1]+e.frozenColumns:0},a.prototype.updateRangeOnInsertDelete=function(e,t,r,n,i,a,o){var s,l=!1;if(e.isInsert)if(s=e.endIndex-e.startIndex+1,"Row"===e.modelType)if(e.forceUpdate)t[0]+=1,t[2]+=1,l=!0;else{var d=!a&&o&&t[2]===e.startIndex-1&&n===e.startIndex&&t[1]===t[3];e.startIndex<=t[0]&&(t[0]+=s,l=!0),(e.startIndex<=t[2]||r&&e.startIndex===t[2]+1&&d)&&(t[2]+=s,l=!0)}else if(e.forceUpdate)t[1]+=1,t[3]+=1,l=!0;else{d=!a&&o&&t[3]===e.startIndex-1&&i===e.startIndex&&t[0]===t[2];e.startIndex<=t[1]&&(t[1]+=s,l=!0),(e.startIndex<=t[3]||r&&e.startIndex===t[3]+1&&d)&&(t[3]+=s,l=!0)}else"Row"===e.modelType?((s=t[0]-e.startIndex)>0&&(t[0]>e.endIndex?(s=e.endIndex-e.startIndex+1)>0&&(t[0]-=s,l=!0):(t[0]-=s,l=!0)),e.startIndex<=t[2]&&(e.endIndex<=t[2]?t[2]-=e.endIndex-e.startIndex+1:t[2]-=t[2]-e.startIndex+1,l=!0)):((s=t[1]-e.startIndex)>0&&(t[1]>e.endIndex?(s=e.endIndex-e.startIndex+1)>0&&(t[1]-=s,l=!0):(t[1]-=s,l=!0)),e.startIndex<=t[3]&&(e.endIndex<=t[3]?t[3]-=e.endIndex-e.startIndex+1:t[3]-=t[3]-e.startIndex+1,l=!0));return l},a.prototype.getCell=function(e,t,r){return null},a.prototype.dateToInt=function(e,t){return sn(e,t)},a.prototype.setDateFormat=function(e,t,r){var n=Fn(this,En(this,e)),i=zn(t,r,n,null,!0).format;i&&"General"!==i||jn(t,r,n,{format:Vs("ShortDate")},!0)},dl([(0,e.Collection)([],wn)],a.prototype,"sheets",void 0),dl([(0,e.Property)(0)],a.prototype,"activeSheetIndex",void 0),dl([(0,e.Property)("100%")],a.prototype,"height",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowFindAndReplace",void 0),dl([(0,e.Property)()],a.prototype,"filterCollection",void 0),dl([(0,e.Property)()],a.prototype,"sortCollection",void 0),dl([(0,e.Property)("100%")],a.prototype,"width",void 0),dl([(0,e.Property)(!0)],a.prototype,"showRibbon",void 0),dl([(0,e.Property)(!0)],a.prototype,"showFormulaBar",void 0),dl([(0,e.Property)(!0)],a.prototype,"showSheetTabs",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowEditing",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowOpen",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowSave",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowSorting",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowFiltering",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowNumberFormatting",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowCellFormatting",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowHyperlink",void 0),dl([(0,e.Property)(!0)],a.prototype,"enableNotes",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowInsert",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowDelete",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowMerge",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowDataValidation",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowImage",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowChart",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowAutoFill",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowPrint",void 0),dl([(0,e.Property)("Automatic")],a.prototype,"calculationMode",void 0),dl([(0,e.Complex)({},z)],a.prototype,"autoFillSettings",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowConditionalFormat",void 0),dl([(0,e.Complex)({},w)],a.prototype,"cellStyle",void 0),dl([(0,e.Property)("")],a.prototype,"openUrl",void 0),dl([(0,e.Complex)({},Zn)],a.prototype,"openSettings",void 0),dl([(0,e.Property)("")],a.prototype,"saveUrl",void 0),dl([(0,e.Property)("")],a.prototype,"password",void 0),dl([(0,e.Property)(!1)],a.prototype,"isProtected",void 0),dl([(0,e.Collection)([],N)],a.prototype,"definedNames",void 0),dl([(0,e.Event)()],a.prototype,"beforeOpen",void 0),dl([(0,e.Event)()],a.prototype,"openFailure",void 0),dl([(0,e.Event)()],a.prototype,"beforeSave",void 0),dl([(0,e.Event)()],a.prototype,"saveComplete",void 0),dl([(0,e.Event)()],a.prototype,"beforeCellFormat",void 0),dl([(0,e.Event)()],a.prototype,"queryCellInfo",void 0),dl([(0,e.Event)()],a.prototype,"beforeCellUpdate",void 0),dl([(0,e.Property)(!0)],a.prototype,"allowFreezePane",void 0),dl([(0,e.Property)(",")],a.prototype,"listSeparator",void 0),a=o=dl([e.NotifyPropertyChanges],a)}(e.Component),pl=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),cl=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},ul=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return pl(r,t),cl([(0,e.Collection)([],Vn)],r.prototype,"cells",void 0),cl([(0,e.Property)(0)],r.prototype,"index",void 0),cl([(0,e.Property)(20)],r.prototype,"height",void 0),cl([(0,e.Property)(!1)],r.prototype,"customHeight",void 0),cl([(0,e.Property)(!1)],r.prototype,"hidden",void 0),cl([(0,e.Complex)({},O)],r.prototype,"format",void 0),cl([(0,e.Property)(!1)],r.prototype,"isReadOnly",void 0),r}(e.ChildProperty);function fl(e,t){return e.rows[t]}function gl(e,t,r){e.rows[t]||(e.rows[t]={}),Object.keys(r).forEach((function(n){e.rows[t][""+n]=r[""+n]}))}function ml(e,t){return e.rows[t]&&e.rows[t].hidden}function vl(e,t){return e.rows[t]&&e.rows[t].isFiltered}function yl(e,t,r,n){var i,a;if(e&&e.standardHeight&&(a=e.standardHeight),e&&e.rows&&e.rows[t]){if(!n&&e.rows[t].hidden)return 0;i=void 0===e.rows[t].height?void 0===a?20:a:e.rows[t].height}else i=void 0===a?20:a;if(r&&window.devicePixelRatio%1>0){var o=i*window.devicePixelRatio%1;return i+(o?(o>.5?1-o:-1*o)/window.devicePixelRatio:0)}return i}function Cl(e,t,r){e&&e.rows&&(e.rows[t]||(e.rows[t]={}),e.rows[t].height=r)}function bl(e,t,r,n,i){void 0===r&&(r=t);var a,o=0;t>r&&(a=t,t=r,r=a);for(var s=t;s<=r;s++)o+=yl(e,s,n,i);return o}var xl=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Sl=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},wl=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return xl(r,t),Sl([(0,e.Property)(0)],r.prototype,"index",void 0),Sl([(0,e.Property)(64)],r.prototype,"width",void 0),Sl([(0,e.Property)(!1)],r.prototype,"customWidth",void 0),Sl([(0,e.Property)(!1)],r.prototype,"hidden",void 0),Sl([(0,e.Complex)({},O)],r.prototype,"format",void 0),Sl([(0,e.Property)(!0)],r.prototype,"isLocked",void 0),Sl([(0,e.Property)("")],r.prototype,"validation",void 0),Sl([(0,e.Property)(!1)],r.prototype,"isReadOnly",void 0),r}(e.ChildProperty);function Il(e,t){return e.columns?e.columns[t]||(e.columns[t]={}):(e.columns=[],e.columns[t]={}),e.columns[t]}function El(e,t,r){var n=Il(e,t);Object.keys(r).forEach((function(e){n[""+e]=r[""+e]}))}function Nl(e,t,r,n){var i;if(e&&e.columns&&e.columns[t]){if(!r&&e.columns[t].hidden)return 0;i=e.columns[t].width||e.columns[t].customWidth?e.columns[t].width:64}else i=64;if(n&&window.devicePixelRatio%1>0){var a=i*window.devicePixelRatio%1;return i+(a?(a>.5?1-a:-1*a)/window.devicePixelRatio:0)}return i}function Rl(e,t,r,n){void 0===r&&(r=t);var i=0;if(t>r){var a=t;t=r,r=a}for(var o=t;o<=r;o++)i+=Nl(e,o,null,n);return i}function Al(e,t){return e.columns[t]&&e.columns[t].hidden}function kl(e,t,r){return e&&e.validation&&(!e.validation.address||kr(e.validation.address,t,r))}function Ol(e){var t=[];return function(e,t){e.showRibbon&&t.push({member:"ribbon",args:[e]});e.showFormulaBar&&t.push({member:"formulaBar",args:[e]});e.showSheetTabs&&t.push({member:"sheetTabs",args:[e]});e.allowEditing&&(t.push({member:"edit",args:[e]}),t.push({member:"formula",args:[e]}));e.allowOpen&&t.push({member:"open",args:[e]});e.allowSave&&t.push({member:"save",args:[e]});e.enableContextMenu&&t.push({member:"contextMenu",args:[e]});e.allowAutoFill&&t.push({member:"autofill",args:[e]});"None"!==e.selectionSettings.mode&&t.push({member:"selection",args:[e]});e.enableKeyboardNavigation&&t.push({member:"keyboardNavigation",args:[e]});e.allowNumberFormatting&&t.push({member:"numberFormat",args:[e]});e.enableKeyboardShortcut&&t.push({member:"keyboardShortcut",args:[e]});e.enableClipboard&&t.push({member:"clipboard",args:[e]});e.allowCellFormatting&&t.push({member:"cellformat",args:[e]});e.allowSorting&&t.push({member:"sort",args:[e]});e.allowResizing&&t.push({member:"resize",args:[e]});t.push({member:"protectSheet",args:[e]}),t.push({member:"workbookFormula",args:[e]}),t.push({member:"workbookEdit",args:[e]}),e.allowHyperlink&&t.push({member:"spreadsheetHyperlink",args:[e]});e.enableNotes&&t.push({member:"spreadsheetNote",args:[e]});e.allowUndoRedo&&t.push({member:"undoredo",args:[e]});e.allowFiltering&&t.push({member:"filter",args:[e]});e.allowWrap&&t.push({member:"wrapText",args:[e]});e.allowInsert&&t.push({member:"insert",args:[e]});e.allowDelete&&t.push({member:"delete",args:[e]});e.allowDataValidation&&t.push({member:"dataValidation",args:[e]});e.allowFindAndReplace&&t.push({member:"findAndReplace",args:[e]});e.allowMerge&&t.push({member:"merge",args:[e]});e.allowConditionalFormat&&t.push({member:"conditionalFormatting",args:[e]});e.allowImage&&t.push({member:"spreadsheetImage",args:[e]});e.allowChart&&t.push({member:"spreadsheetChart",args:[e]})}(e,t),C(e,t),t}var Fl="e-disabled",Tl="e-wraptext",Dl="spreadsheetLocale",Ll="dialog",Pl="actionEvents",Ml="shape",Bl={Custom:["#ffffff","#000000","#e7e6e6","#44546a","#4472c4","#ed7d31","#a5a5a5","#ffc000","#70ad47","#ff0000","#f2f2f2","#808080","#cfcdcd","#d5dce4","#d9e2f3","#fbe4d5","#ededed","#fff2cc","#e2efd9","#ffcccc","#d9d9d9","#595959","#aeaaaa","#acb9ca","#b4c6e7","#f7caac","#dbdbdb","#ffe599","#c5e0b3","#ff8080","#bfbfbf","#404040","#747070","#8496b0","#8eaadb","#f4b083","#c9c9c9","#ffd966","#a8d08d","#ff3333","#a6a6a6","#262626","#3b3838","#323e4f","#2f5496","#c45911","#7b7b7b","#bf8f00","#538135","#b30000","#7f7f7f","#0d0d0d","#161616","#212934","#1f3763","#823b0b","#525252","#7f5f00","#375623","#660000"]},Hl={Custom:["#ffffff","#000000","#ffff00","#00ff00","#00ffff","#0000ff","#ff0000","#000080","#800080","#996633","#f2f2f2","#808080","#ffffcc","#b3ffb3","#ccffff","#ccccff","#ffcccc","#ccccff","#ff80ff","#f2e6d9","#d9d9d9","#595959","#ffff80","#80ff80","#b3ffff","#8080ff","#ff8080","#8080ff","#ff00ff","#dfbf9f","#bfbfbf","#404040","#ffff33","#33ff33","#33ffff","#3333ff","#ff3333","#0000b3","#b300b3","#c68c53","#a6a6a6","#262626","#e6e600","#00b300","#009999","#000099","#b30000","#000066","#660066","#86592d","#7f7f7f","#0d0d0d","#999900","#006600","#006666","#000066","#660000","#00004d","#4d004d","#734d26"]},Ul={UP:38,DOWN:40,LEFT:37,RIGHT:39,FIRSTALPHABET:65,LASTALPHABET:90,SPACE:32,BACKSPACE:8,TAB:9,DELETE:46,ENTER:13,ESC:27},Vl={FindValue:"Find value",ReplaceValue:"Replace value",FindReplaceTooltip:"Find & Replace",InsertingEmptyValue:"Reference value is not valid.",ReplaceAllEnd:" matches replaced with ",ByRow:"By Rows",ByColumn:"By Columns",MatchCase:"Match case",MatchExactCellElements:"Match entire cell contents",EnterCellAddress:"Enter cell address",FindAndReplace:"Find and Replace",FindNextBtn:"Find Next",FindPreviousBtn:"Find Previous",ReplaceBtn:"Replace",ReplaceAllBtn:"Replace All",GotoHeader:"Go To",Sheet:"Sheet",Workbook:"Workbook",NoElements:"We couldn't find what you were looking for.",FindWhat:"Find what",ReplaceWith:"Replace with",Cut:"Cut",Copy:"Copy",Paste:"Paste",PasteSpecial:"Paste Special",Link:"Link",Spreadsheet:"Spreadsheet",AddNote:"Add Note",EditNote:"Edit Note",DeleteNote:"Delete Note",Hyperlink:"Hyperlink",EditHyperlink:"Edit Hyperlink",OpenHyperlink:"Open Hyperlink",RemoveHyperlink:"Remove Hyperlink",InvalidHyperlinkAlert:"The address of this site is not valid. Check the address and try again.",InsertLink:"Insert Link",EditLink:"Edit Link",All:"All",Values:"Values",Formats:"Formats",Bold:"Bold",Font:"Font",FontSize:"Font Size",Italic:"Italic",Underline:"Underline",Strikethrough:"Strikethrough",TextColor:"Text Color",FillColor:"Fill Color",HorizontalAlignment:"Horizontal Alignment",AlignLeft:"Align Left",AlignCenter:"Center",AlignRight:"Align Right",VerticalAlignment:"Vertical Alignment",AlignTop:"Align Top",AlignMiddle:"Align Middle",AlignBottom:"Align Bottom",WrapText:"Wrap Text",MergeCells:"Merge Cells",MergeAll:"Merge All",MergeHorizontally:"Merge Horizontally",MergeVertically:"Merge Vertically",Unmerge:"Unmerge",UnmergeCells:"Unmerge Cells",SelectMergeType:"Select Merge Type",MergeCellsAlert:"Merging cells will only preserve the top-leftmost(Uppermost) value. Merge anyway?",Borders:"Borders",TopBorders:"Top Borders",LeftBorders:"Left Borders",RightBorders:"Right Borders",BottomBorders:"Bottom Borders",AllBorders:"All Borders",HorizontalBorders:"Horizontal Borders",VerticalBorders:"Vertical Borders",OutsideBorders:"Outside Borders",InsideBorders:"Inside Borders",NoBorders:"No Borders",BorderColor:"Border Color",BorderStyle:"Border Style",InsertFunction:"Insert Function",CalcOptions:"Calculation Options",CalcOptionsTip:"Choose to calculate formulas either automatically or manually",CalcActiveSheet:"Calculate Sheet",CalcWorkbook:"Calculate Workbook",Automatic:"Automatic",Manual:"Manual",CalcSheetTip:"Calculate the active sheet",CalcWorkbookTip:"Calculate the entire workbook",Insert:"Insert",Delete:"Delete",DuplicateSheet:"Duplicate",MoveRight:"Move Right",MoveLeft:"Move Left",Rename:"Rename",Hide:"Hide",FileName:"File Name",PROPER:"Converts a text to proper case; first letter to uppercase and other letters to lowercase.",NameBox:"Name Box",ShowHeaders:"Show Headers",HideHeaders:"Hide Headers",ShowGridLines:"Show Gridlines",ExtendValidation:"The selection contains some cells without data validation. Do you want to extend validation to these cells?",Yes:"Yes",No:"No",HideGridLines:"Hide Gridlines",FreezePanes:"Freeze Panes",FreezeRows:"Freeze Rows",FreezeColumns:"Freeze Columns",UnfreezePanes:"Unfreeze Panes",UnfreezeRows:"Unfreeze Rows",UnfreezeColumns:"Unfreeze Columns",AddSheet:"Add Sheet",ListAllSheets:"List All Sheets",CollapseToolbar:"Collapse Toolbar",ExpandToolbar:"Expand Toolbar",CollapseFormulaBar:"Collapse Formula Bar",ExpandFormulaBar:"Expand Formula Bar",File:"File",Home:"Home",Formulas:"Formulas",View:"View",New:"New",Open:"Open",SaveAs:"Save As",Print:"Print",Update:"Update",ExcelXlsx:"Microsoft Excel",ExcelXls:"Microsoft Excel 97-2003",CSV:"Comma-separated values",FormulaBar:"Formula Bar",Sort:"Sort",SortAscending:"Ascending",SortDescending:"Descending",CustomSort:"Custom Sort",AddColumn:"Add Column",ContainsHeader:"Data contains header",CaseSensitive:"Case sensitive",SortBy:"Sort by",ThenBy:"Then by",SelectAColumn:"Select a column",SortEmptyFieldError:"All sort criteria must have a column specified. Check the selected sort criteria and try again.",SortDuplicateFieldError:"  is being sorted by values more than once. Delete the duplicate sort criteria and try again.",SortOutOfRangeError:"Select a cell or range inside the used range and try again.",MultiRangeSortError:"This can't be done on a multiple range selection. Select a single range and try again.",SortAndFilter:"Sort & Filter",Filter:"Filter",ClearAllFilter:"Clear",ClearFilterFrom:"Clear Filter From ",ReapplyFilter:"Reapply",FilterCellValue:"Filter by Value of Selected Cell",FilterOutOfRangeError:"Select a cell or range inside the used range and try again.",HideRow:"Hide Row",HideRows:"Hide Rows",UnhideRows:"Unhide Rows",HideColumn:"Hide Column",HideColumns:"Hide Columns",UnhideColumns:"Unhide Columns",InsertRow:"Insert Row",InsertRows:"Insert Rows",Above:"Above",Below:"Below",InsertColumn:"Insert Column",InsertColumns:"Insert Columns",Before:"Before",After:"After",DeleteRow:"Delete Row",DeleteRows:"Delete Rows",DeleteColumn:"Delete Column",DeleteColumns:"Delete Columns",Ok:"OK",Close:"Close",MoreOptions:"More Options",Cancel:"Cancel",Apply:"Apply",MoreColors:"More Colors",StandardColors:"Standard Colors",General:"General",Number:"Number",Currency:"Currency",Accounting:"Accounting",ShortDate:"Short Date",LongDate:"Long Date",Time:"Time",Percentage:"Percentage",Fraction:"Fraction",Scientific:"Scientific",Text:"Text",Custom:"Custom",MobileFormulaBarPlaceHolder:"Enter value or Formula",NumberFormat:"Number Format",PasteAlert:"You can't paste this here, because the copy area and paste area aren't in the same size. Please try pasting in a different range.",DestroyAlert:"Are you sure you want to destroy the current workbook without saving and create a new workbook?",SheetRenameInvalidAlert:"Sheet name contains invalid character.",SheetRenameEmptyAlert:"Sheet name cannot be empty.",SheetRenameAlreadyExistsAlert:"Sheet name already exists. Please enter another name.",DeleteSheetAlert:"You can't undo deleting sheets, and you might be removing some data. If you don't need it, click OK to delete.",DeleteSingleLastSheetAlert:"A Workbook must contain at least one visible worksheet.",PickACategory:"Pick a category",Description:"Description",UnsupportedFile:"Unsupported File",DataLimitExceeded:"File data is too large and it takes more time to process, do you want to continue?",FileSizeLimitExceeded:"File size is too large and it takes more time to process, do you want to continue?",InvalidUrl:"Invalid URL",SUM:"Adds a series of numbers and/or cells.",SUMIF:"Adds the cells based on specified condition.",SUMIFS:"Adds the cells based on specified conditions.",ABS:"Returns the value of a number without its sign.",RAND:"Returns a random number between 0 and 1.",RANDBETWEEN:"Returns a random integer based on specified values.",FLOOR:"Rounds a number down to the nearest multiple of a given factor.",CEILING:"Rounds a number up to the nearest multiple of a given factor.",PRODUCT:"Multiplies a series of numbers and/or cells.",INT:"Returns a number to the nearest integer.",ROUNDUP:"Rounds a number away from zero.",SUMPRODUCT:"Returns sum of the product of given ranges of arrays.",SORT:"Sorts a range of an array",T:"Checks whether a value is text or not and returns the text.",EXACT:"Checks whether a two text strings are exactly same and returns TRUE or FALSE.",LEN:"Returns a number of characters in a given string.",MOD:"Returns a remainder after a number is divided by divisor.",ODD:"Rounds a positive number up and negative number down to the nearest odd integer.",PI:"Returns the value of pi.",COUNTBLANK:"Returns the number of empty cells in a specified range of cells.",EVEN:"Rounds a positive number up and negative number down to the nearest even integer.",DECIMAL:"Converts a text representation of a number in a given base into a decimal number.",DEGREES:"Converts radians to degrees.",ADDRESS:"Returns a cell reference as text, given specified row and column numbers.",TIME:"Converts hours, minutes, seconds to the time formatted text.",CHAR:"Returns the character from the specified number.",CODE:"Returns the numeric code for the first character in a given string.",DOLLAR:"Converts the number to currency formatted text.",SMALL:"Returns the k-th smallest value in a given array.",LARGE:"Returns the k-th largest value in a given array.",FACT:"Returns the factorial of a number.",MEDIAN:"Returns the median of the given set of numbers.",EDATE:"Returns a date with given number of months before or after the specified date.",DATEVALUE:"Converts a date string into date value.",HOUR:"Returns the number of hours in a specified time string.",SECOND:"Returns the number of seconds in a specified time string.",MINUTE:"Returns the number of minutes in a specified time string.",NOW:"Returns the current date and time.",MONTH:"Returns the number of months in a specified date string.",TODAY:"Returns the current date as date value.",WEEKDAY:"Returns the day of the week corresponding to a date.",AVERAGE:"Calculates average for the series of numbers and/or cells excluding text.",AVERAGEIF:"Calculates average for the cells based on specified criterion.",AVERAGEIFS:"Calculates average for the cells based on specified conditions.",AVERAGEA:"Calculates the average for the cells evaluating TRUE as 1, text and FALSE as 0.",COUNT:"Counts the cells that contain numeric values in a range.",COUNTIF:"Counts the cells based on specified condition.",COUNTIFS:"Counts the cells based on specified conditions.",COUNTA:"Counts the cells that contains values in a range.",MIN:"Returns the smallest number of the given arguments.",MAX:"Returns the largest number of the given arguments.",DATE:"Returns the date based on given year, month, and day.",DAY:"Returns the day from the given date.",DAYS:"Returns the number of days between two dates.",IF:"Returns value based on the given expression.",IFS:"Returns value based on the given multiple expressions.",CalculateAND:"Returns TRUE if all the arguments are TRUE, otherwise returns FALSE.",CalculateOR:"Returns TRUE if any of the arguments are TRUE, otherwise returns FALSE.",IFERROR:"Returns value if no error found else it will return specified value.",CHOOSE:"Returns a value from list of values, based on index number.",INDEX:"Returns a value of the cell in a given range based on row and column number.",FIND:"Returns the position of a string within another string, which is case sensitive.",TEXT:"Converts a value to text in specified number format.",CONCATENATE:"Combines two or more strings together.",CONCAT:"Concatenates a list or a range of text strings.",SUBTOTAL:"Returns subtotal for a range using the given function number.",RADIANS:"Converts degrees into radians.",MATCH:"Returns the relative position of a specified value in given range.",LN:"Returns the natural logarithm of a number.",INTERCEPT:"Calculates the point of the Y-intercept line via linear regression.",UNIQUE:"Returns a unique values from a range or array",SLOPE:"Returns the slope of the line from linear regression of the data points.",LOOKUP:"Looks for a value in a one-row or one-column range, then returns a value from the same position in a second one-row or one-column range.",HLOOKUP:"Looks for a value in the top row of the array of values and then returns a value in the same column from a row in the array that you specify.",VLOOKUP:"Looks for a specific value in the first column of a lookup range and returns a corresponding value from a different column within the same row.",NOT:"Returns the inverse of a given logical expression.",EOMONTH:"Returns the last day of the month that is a specified number of months before or after an initially supplied start date.",SQRT:"Returns the square root of a positive number.",ROUNDDOWN:"Rounds a number down, toward zero.",RSQ:"Returns the square of the Pearson product moment correlation coefficient based on data points in known_y's and known_x's.",DefineNameExists:"This name already exists, try different name.",DefineNameInValid:"The name that you entered is not valid.",CircularReference:"When a formula refers to one or more circular references, this may result in an incorrect calculation.",OR:"OR",AND:"AND",CustomFilterDatePlaceHolder:"Choose a date",CustomFilterPlaceHolder:"Enter the value",CustomFilter:"Custom Filter",Between:"Between",DateTimeFilter:"DateTime Filters",Undo:"Undo",Redo:"Redo",DateFilter:"Date Filters",TextFilter:"Text Filters",NumberFilter:"Number Filters",ClearFilter:"Clear Filter",NoResult:"No Matches Found",FilterFalse:"False",FilterTrue:"True",Blanks:"Blanks",SelectAll:"Select All",GreaterThanOrEqual:"Greater Than Or Equal",GreaterThan:"Greater Than",LessThanOrEqual:"Less Than Or Equal",LessThan:"Less Than",NotEqual:"Not Equal",Equal:"Equal",Contains:"Contains",NotContains:"Does Not Contains",EndsWith:"Ends With",NotEndsWith:"Does Not End With",StartsWith:"Starts With",NotStartsWith:"Does Not Start With",IsEmpty:"Empty",IsNotEmpty:"Not Empty",ClearButton:"Clear",FilterButton:"Filter",CancelButton:"Cancel",OKButton:"OK",Search:"Search",ProtectSheet:"Protect Sheet",UnprotectSheet:"Unprotect Sheet",SelectCells:"Select locked cells",SelectUnlockedCells:"Select unlocked cells",FormatCells:"Format cells",FormatRows:"Format rows",FormatColumns:"Format columns",InsertLinks:"Insert links",ProtectContent:"Protect the contents of locked cells",ProtectAllowUser:" Allow all users of this worksheet to:",EditAlert:"The cell you're trying to change is protected. To make change, unprotect the sheet.",ReadonlyAlert:"You are trying to modify a cell that is in read-only mode. To make changes, please disable the read-only status.",FiniteAlert:"Finite mode is active: Cannot access the specified cell range outside the defined limits.",Alert:"Alert",SearchWithin:"Search within",SearchBy:"Search by",Reference:"Reference",DataValidation:"Data Validation",CellRange:"Cell Range",Allow:"Allow",Data:"Data",Minimum:"Minimum",Maximum:"Maximum",IgnoreBlank:"Ignore blank",WholeNumber:"Whole Number",Decimal:"Decimal",Date:"Date",TextLength:"Text Length",List:"List",NotBetween:"Not Between",EqualTo:"Equal To",NotEqualTo:"Not Equal To",GreaterThanOrEqualTo:"Greater Than Or Equal To",LessThanOrEqualTo:"Less Than Or Equal To",InCellDropDown:"In-cell-dropdown",Sources:"Sources",Value:"Value",Formula:"Formula",Retry:"Retry",DialogError:"The list source must be a reference to single row or column.",NamedRangeError:"A named range you specified cannot be found.",MinMaxError:"The Maximum must be greater than or equal to the Minimum.",InvalidNumberError:"Please enter a valid number.",InvalidFormula:"Please enter a valid formula.",MoreValidation:"This selection contains more than one validation. \n Erase current settings and continue?",FileNameError:"A file name can't contain characters like \\ / : * ? \" < > [ ] |",ListLengthError:"The list values allows only upto 256 characters",ValidationError:"This value doesn't match the data validation restrictions defined for the cell.",EmptyError:"You must enter a value",ClearHighlight:"Clear Highlight",HighlightInvalidData:"Highlight Invalid Data",ClearValidation:"Clear Validation",HighlightCellsRules:"Highlight Cells Rules",CFEqualTo:"Equal To",TextThatContains:"Text that Contains",Save:"Save",EmptyFileName:"File name cannot be empty.",LargeName:"The name is too long.",ADateOccuring:"A Date Occuring",DuplicateValues:"Duplicate Values",TopBottomRules:"Top/Bottom Rules",Directional:"Directional",Shapes:"Shapes",Indicators:"Indicators",Ratings:"Ratings",Top10Items:"Top 10 Items",Top10:"Top 10",Bottom10Items:"Bottom 10 Items",Bottom10:"Bottom 10",AboveAverage:"Above Average",BelowAverage:"Below Average",FormatCellsGreaterThan:"Format cells that are GREATER THAN:",FormatCellsLessThan:"Format cells that are LESS THAN:",FormatCellsBetween:"Format cells that are BETWEEN:",FormatCellsEqualTo:"Format cells that are EQUAL TO:",FormatCellsThatContainTheText:"Format cells that contain the text:",FormatCellsThatContainADateOccurring:"Format cells that contain a date occurring:",FormatCellsDuplicate:"Format cells that contain:",FormatCellsTop:"Format cells that rank in the TOP:",FormatCellsBottom:"Format cells that rank in the BOTTOM:",FormatCellsAbove:"Format cells that are ABOVE AVERAGE:",FormatCellsBelow:"Format cells that are BELOW AVERAGE:",With:"with",DataBars:"Data Bars",ColorScales:"Color Scales",IconSets:"Icon Sets",ClearRules:"Clear Rules",SelectedCells:"Clear Rules from Selected Cells",EntireSheet:"Clear Rules from Entire Sheet",ISNUMBER:"Returns true when the value parses as a numeric value.",ROUND:"Rounds a number to a specified number of digits.",GEOMEAN:"Returns the geometric mean of an array or range of positive data.",POWER:"Returns the result of a number raised to power",LOG:"Returns the logarithm of a number to the base that you specify.",TRUNC:"Returns the truncated value of a number to a specified number of decimal places.",EXP:"Returns e raised to the power of the given number.",Clear:"Clear",ClearContents:"Clear Contents",ClearAll:"Clear All",ClearFormats:"Clear Formats",ClearHyperlinks:"Clear Hyperlinks",LightRedFillWithDarkRedText:"Light Red Fill with Dark Red Text",YellowFillWithDarkYellowText:"Yellow Fill with Dark Yellow Text",GreenFillWithDarkGreenText:"Green Fill with Dark Green Text",RedFill:"Red Fill",RedText:"Red Text",Duplicate:"Duplicate",Unique:"Unique",And:"and",WebPage:"Web Page",ThisDocument:"This Document",DisplayText:"Display Text",Url:"URL",CellReference:"Cell Reference",DefinedNames:"Defined Names",EnterTheTextToDisplay:"Enter the text to display",EnterTheUrl:"Enter the URL",Image:"Image",ConditionalFormatting:"Conditional Formatting",BlueDataBar:"Blue Data Bar",GreenDataBar:"Green Data Bar",RedDataBar:"Red Data Bar",OrangeDataBar:"Orange Data Bar",LightBlueDataBar:"Light blue Data Bar",PurpleDataBar:"Purple Data Bar",GYRColorScale:"Green - Yellow - Red Color Scale",RYGColorScale:"Red - Yellow - Green Color Scale",GWRColorScale:"Green - White - Red Color Scale",RWGColorScale:"Red - White - Green Color Scale",BWRColorScale:"Blue - White - Red Color Scale",RWBColorScale:"Red - White - Blue Color Scale",WRColorScale:"White - Red Color Scale",RWColorScale:"Red - White Color Scale",GWColorScale:"Green - White Color Scale",WGColorScale:"White - Green Color Scale",GYColorScale:"Green - Yellow Color Scale",YGColorScale:"Yellow - Green Color Scale",ThreeArrowsColor:"3 Arrows (Colored)",ThreeArrowsGray:"3 Arrows (Gray)",ThreeTriangles:"3 Triangles",FourArrowsColor:"4 Arrows (Gray)",FourArrowsGray:"4 Arrows (Colored)",FiveArrowsColor:"5 Arrows (Gray)",FiveArrowsGray:"5 Arrows (Colored)",ThreeTrafficLights1:"3 Traffic Lights (Unrimmed)",ThreeTrafficLights2:"3 Traffic Lights (Rimmed)",ThreeSigns:"3 Signs",FourTrafficLights:"4 Traffic Lights",RedToBlack:"Red To Black",ThreeSymbols1:"3 Symbols (Circled)",ThreeSymbols2:"3 Symbols (Uncircled)",ThreeFlags:"3 Flags",ThreeStars:"3 Stars",FourRatings:"4 Ratings",FiveQuarters:"5 Quarters",FiveRatings:"5 Ratings",FiveBoxes:"5 Boxes",Chart:"Chart",Column:"Column",Bar:"Bar",Area:"Area",Pie:"Pie",Doughnut:"Doughnut",PieAndDoughnut:"Pie/Doughnut",Line:"Line",LineMarker:"Line with Markers",Radar:"Radar",Scatter:"Scatter",ChartDesign:"Chart Design",ClusteredColumn:"Clustered Column",StackedColumn:"Stacked Column",StackedColumn100:"100% Stacked Column",ClusteredBar:"Clustered Bar",StackedBar:"Stacked Bar",StackedBar100:"100% Stacked Bar",StackedArea:"Stacked Area",StackedArea100:"100% Stacked Area",StackedLine:"Stacked Line",StackedLineMarker:"Stacked Line with Markers",StackedLine100:"100% Stacked Line",StackedLine100Marker:"100% Stacked Line with Markers",AddChartElement:"Add Chart Element",Axes:"Axes",AxisTitle:"Axis Title",ChartTitle:"Chart Title",DataLabels:"Data Labels",Gridlines:"Gridlines",Legends:"Legends",PrimaryHorizontal:"Primary Horizontal",PrimaryVertical:"Primary Vertical",None:"None",AboveChart:"Above Chart",Center:"Center",InsideEnd:"Inside End",InsideBase:"Inside Base",OutsideEnd:"OutSide End",PrimaryMajorHorizontal:"Primary Major Horizontal",PrimaryMajorVertical:"Primary Major Vertical",PrimaryMinorHorizontal:"Primary Minor Horizontal",PrimaryMinorVertical:"Primary Minor Vertical",Right:"Right",Left:"Left",Bottom:"Bottom",Top:"Top",SwitchRowColumn:"Switch Row/Column",ChartTheme:"Chart Theme",ChartType:"Chart Type",Material:"Material",Fabric:"Fabric",Bootstrap:"Bootstrap",HighContrastLight:"HighContrast Light",MaterialDark:"Material Dark",FabricDark:"Fabric Dark",HighContrast:"HighContrast",BootstrapDark:"Bootstrap Dark",Bootstrap4:"Bootstrap4",Bootstrap5Dark:"Bootstrap5 Dark",Bootstrap5:"Bootstrap5",Tailwind:"Tailwind",TailwindDark:"Tailwind Dark",Tailwind3:"Tailwind 3",Tailwind3Dark:"Tailwind 3 Dark",VerticalAxisTitle:"Vertical Axis Title",HorizontalAxisTitle:"Horizontal Axis Title",EnterTitle:"Enter Title",ProtectWorkbook:"Protect Workbook",Password:"Password (optional):",EnterThePassword:"Enter the password",ConfirmPassword:"Confirm Password",EnterTheConfirmPassword:"Re-enter your password",PasswordAlert:"Confirmation password is not identical",UnprotectWorkbook:"Unprotect Workbook",UnprotectPasswordAlert:"The password you supplied is not correct.",IncorrectPassword:"Unable to open the file or worksheet with the given password",PasswordAlertMsg:"Please enter the password",ConfirmPasswordAlertMsg:"Please enter the confirm password",IsProtected:"is protected",PDF:"PDF Document",AutoFillMergeAlertMsg:"To do this, all the merged cells need to be the same size.",FillSeries:"Fill Series",CopyCells:"Copy Cells",FillFormattingOnly:"Fill Formatting Only",FillWithoutFormatting:"Fill Without Formatting",CustomFormat:"Custom Number Formats",CustomFormatPlaceholder:"Type or Select a custom format",CustomFormatTypeList:"Type",UnprotectWorksheet:"Unprotect Sheet",ReEnterPassword:"Re-enter password to proceed",SheetPassword:"Password to unprotect sheet:",Fluent:"Fluent",FluentDark:"Fluent Dark",Fluent2:"Fluent 2",Fluent2Dark:"Fluent 2 Dark",Fluent2HighContrast:"Fluent 2 HighContrast",Material3:"Material 3",Material3Dark:"Material 3 Dark",CellReferenceTypoError:"We found a typo in your cell reference. Do you want to correct this reference as follows?",InvalidFormulaError:"We found that you typed a formula which is invalid.",InvalidArguments:"We found that you typed a formula with an invalid arguments.",EmptyExpression:"We found that you typed a formula with an empty expression.",MismatchedParenthesis:"We found that you typed a formula with one or more missing opening or closing parenthesis.",ImproperFormula:"We found that you typed a formula which is improper.",WrongNumberOfArguments:"We found that you typed a formula with a wrong number of arguments.",Requires3Arguments:"We found that you typed a formula which requires 3 arguments.",MismatchedStringQuotes:"We found that you typed a formula with a mismatched quotes.",FormulaCircularRef:"We found that you typed a formula with a circular reference.",AddCurrentSelection:"Add current selection to filter",ExternalWorkbook:"An imported excel file contains an external workbook reference. Do you want to import that file?"};function zl(e,t){if(t){t.rafIds.length>0&&(t.rafIds.forEach((function(e){return cancelAnimationFrame(e)})),t.rafIds.length=0);var r=requestAnimationFrame((function(){e();var n=t.rafIds.indexOf(r);-1!==n&&t.rafIds.splice(n,1)}));t.rafIds.push(r)}else requestAnimationFrame((function(){e()}))}function jl(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function _l(e){var t=30;return e.toString().length>3&&(t=10*e.toString().length),t}var ql=null,Wl=1.24;function Gl(){if(null!==ql)return ql;var e,t=document.createElement("div");return t.style.cssText="width:100px;height: 100px;overflow: scroll;position: absolute;top: -9999px;",document.body.appendChild(t),e=t.offsetWidth-t.clientWidth|0,document.body.removeChild(t),ql=e}function Yl(e,t,r){return void 0===r&&(r=1),Xl(e,"previous",t=t||["e-ribbon","e-formula-bar-panel","e-sheet-tab-panel","e-header-toolbar"],r)+Xl(e,"next",t,r)}function Xl(e,t,r,n){for(var i=e[t+"ElementSibling"],a=0;i;)r.some((function(e){return i.classList.contains(e)}))&&(a+=i.getBoundingClientRect().height*n),i=i[t+"ElementSibling"];return a}function Kl(e,t,r){if(e.scrollSettings.enableVirtualization){var n=e.getActiveSheet(),i=e.frozenRowCount(n),a=e.frozenColCount(n),o=e.viewport.topIndex+i,s=e.viewport.leftIndex+a,l=e.viewport.bottomIndex,d=e.viewport.rightIndex;if(n.frozenRows||n.frozenColumns){if(e.insideViewport(t[0],t[1])||e.insideViewport(t[2],t[3]))return!0}else if(o<=t[0]&&l>=t[2]&&s<=t[1]&&d>=t[3])return!0;var h=!1;if(r){if(t[0]<o&&t[2]<o||t[0]>l&&t[2]>l)return!1;if(t[0]<o&&t[2]>o&&t[0]>=i&&(t[0]=o,h=!0),t[2]>l&&(t[2]=l,h=!0),t[1]<s&&t[3]<s||t[1]>d&&t[3]>d)return!1;t[1]<s&&t[3]>s&&t[1]>=a&&(t[1]=s,h=!0),t[3]>d&&(t[3]=d,h=!0)}return h}return!0}function $l(e,t,r,n,i,a,o,s){var l,d={idx:0,size:0},h={idx:0,size:0},p=h.size,c=d.size;for(l=h.idx;l<t[0];l++)r&&r-1<t[0]&&l<r||(p+=yl(e,l,!s));for(l=d.idx;l<t[1];l++)n&&n-1<t[1]&&l<n||(c+=Nl(e,l,null,!s));return r&&t[0]<r&&(e.showHeaders&&(p+=30),i&&(p-=i)),n&&t[1]<n&&(e.showHeaders&&(c+=o||30),a&&(c-=a)),{top:p,left:c}}function Zl(t,r,n,i,a,o,s){void 0===i&&(i="e-selection");var l=t.getActiveSheet();if(!l.frozenRows&&!l.frozenColumns){var d=Ql(t,r,n,l,t.enableRtl,0,0,a);return r&&!t.getMainContent().querySelector("."+i)&&t.getMainContent().appendChild(r),d}var h,p=t.frozenRowCount(l),u=t.frozenColCount(l);if("e-active-cell"===i){if(n[0]<p||n[1]<u)r.style.display="none",(v=(h=n[0]<p&&n[1]<u?t.getSelectAllContent():n[0]<p?t.getColumnHeaderContent():t.getRowHeaderContent()).querySelector("."+i))||(v=r.cloneNode(!0),h.appendChild(v)),Ql(t,r=v,n,l,t.enableRtl,p,u,a,!0,t.viewport.beforeFreezeHeight,t.viewport.beforeFreezeWidth,t.sheetModule.colGroupWidth);else Ql(t,r,n,l,t.enableRtl,p,u,a);r.style.display&&(r.style.display=""),Jl(t.getSelectAllContent(),h,"e-active-cell"),Jl(t.getColumnHeaderContent(),h,"e-active-cell"),Jl(t.getRowHeaderContent(),h,"e-active-cell")}else if("e-autofill"===i){var f=void 0,g=t.frozenRowCount(l),m=t.frozenColCount(l);if(n[0]<g||n[1]<m)r.style.display="none",(v=(f=n[0]<g&&n[1]<m?t.getSelectAllContent():n[0]<g?t.getColumnHeaderContent():t.getRowHeaderContent()).querySelector("."+i))||(v=r.cloneNode(!0),f.appendChild(v)),Ql(t,r=v,n,l,t.enableRtl,g,m,a,!0,t.viewport.beforeFreezeHeight,t.viewport.beforeFreezeWidth,t.sheetModule.colGroupWidth,"e-autofill");else Ql(t,r,n,l,t.enableRtl,g,m,a,!1,0,0,0,"e-autofill");r.style.display&&(r.style.display=""),Jl(t.getSelectAllContent(),f,"e-autofill"),Jl(t.getColumnHeaderContent(),f,"e-autofill"),Jl(t.getRowHeaderContent(),f,"e-autofill")}else if("e-filloption"===i){f=void 0,g=t.frozenRowCount(l),m=t.frozenColCount(l);if(n[0]<g||n[1]<m)if(n[3]+1===m&&n[2]+1>g)Ql(t,t.getMainContent().querySelector(".e-filloption"),n,l,t.enableRtl,g,m,a,!1,0,0,0,"e-filloption",!0,{left:-4});else if(n[2]+1===g&&n[3]+1>m)Ql(t,t.getMainContent().querySelector(".e-filloption"),n,l,t.enableRtl,g,m,a,!1,0,0,0,"e-filloption",!0,{top:-4});else if(n[3]+1===m&&n[2]+1<g){(f=t.getColumnHeaderContent()).querySelector("."+i)||t.notify(Zt,{id:t.element.id+"_autofilloptionbtn",appendElem:f}),r=t.autofillModule.autoFillDropDown.element,Ql(t,r,n,l,t.enableRtl,g,m,a,!1,0,0,0,"e-filloption",!0,{left:-4})}else if(n[2]+1===g&&n[3]+1===m)Ql(t,t.getMainContent().querySelector(".e-filloption"),n,l,t.enableRtl,g,m,a,!1,0,0,0,"e-filloption",!0,{top:-4,left:-4});else{var v;(v=(f=n[0]<g&&n[1]<m?t.getSelectAllContent():n[0]<g?t.getColumnHeaderContent():t.getRowHeaderContent()).querySelector("."+i))||t.notify(Zt,{id:t.element.id+"_autofilloptionbtn",appendElem:f}),r=t.autofillModule.autoFillDropDown.element,Ql(t,r,n,l,t.enableRtl,g,m,a,!0,t.viewport.beforeFreezeHeight,t.viewport.beforeFreezeWidth,t.sheetModule.colGroupWidth,"e-filloption",!0)}else Ql(t,t.getMainContent().querySelector(".e-filloption"),n,l,t.enableRtl,g,m,a,!1,0,0,0,"e-filloption",!0);r.style.display&&(r.style.display=""),Jl(t.getSelectAllContent(),f,"e-filloption"),Jl(t.getColumnHeaderContent(),f,"e-filloption"),Jl(t.getRowHeaderContent(),f,"e-filloption")}else{var y=c(n);if(y[0]<p||y[1]<u){r&&!r.classList.contains("e-multi-range")&&r.classList.add("e-hide");var C,b=[];y[0]<p&&y[1]<u?y[2]<p&&y[3]<u?(b.push(n),o||(Jl(t.getColumnHeaderContent(),h,i,!0),Jl(t.getRowHeaderContent(),h,i,!0))):y[2]>p-1?y[3]<u?(o||Jl(t.getColumnHeaderContent(),h,i,!0),b.push([y[0],y[1],p-1,y[3]]),b.push([p,y[1],y[2],y[3]])):(b.push([y[0],y[1],p-1,u-1]),b.push([p,y[1],y[2],u-1]),b.push([y[0],u,p-1,y[3]]),b.push([p,u,y[2],y[3]])):y[2]<p?(b.push([y[0],y[1],y[2],u-1]),b.push([y[0],u,y[2],y[3]]),o||Jl(t.getRowHeaderContent(),h,i,!0)):(b.push([p,y[1],y[2],u-1]),b.push([y[0],y[1],p-1,u-1]),b.push([p,u,y[2],y[3]]),b.push([y[0],u,p-1,y[3]])):y[0]<p?y[2]<p?(b.push(n),o||Jl(t.getRowHeaderContent(),h,i,!0)):(b.push([y[0],y[1],p-1,y[3]]),b.push([p,y[1],y[2],y[3]]),o||(Jl(t.getSelectAllContent(),h,i,!0),Jl(t.getRowHeaderContent(),h,i,!0))):y[3]<u?(b.push(n),o||Jl(t.getSelectAllContent(),h,i,!0)):(b.push([y[0],y[1],y[2],u-1]),b.push([y[0],u,y[2],y[3]]),o||(Jl(t.getSelectAllContent(),h,i,!0),Jl(t.getColumnHeaderContent(),h,i,!0))),b.forEach((function(n){var d,c;if(n[2]<p&&n[3]<u)h=t.getSelectAllContent();else{if(p||u){var f=t.getSelectAllContent();f&&(d=f.style.zIndex)}if(n[2]<p)h=t.getColumnHeaderContent();else if(n[3]<u)h=t.getRowHeaderContent();else{if(h=t.getMainContent(),p&&!d){var g=t.getColumnHeaderContent();g&&(d=g.style.zIndex)}if(u&&!d){var m=t.getRowHeaderContent();m&&(d=m.style.zIndex)}}}"e-copy-indicator"===i||"e-range-indicator"===i?(c=r.cloneNode(!0),h.appendChild(c),p&&(n[2]+1===p&&b.forEach((function(t){t!==n&&(C=c.getElementsByClassName("e-bottom")[0])&&t[0]===p&&(0,e.detach)(C)})),n[0]===p&&h.parentElement.classList.contains("e-main-panel")&&b.forEach((function(t){t!==n&&(C=c.getElementsByClassName("e-top")[0])&&t[2]+1===p&&(0,e.detach)(C)}))),u&&(n[3]+1===u&&b.forEach((function(t){t!==n&&(C=c.getElementsByClassName("e-right")[0])&&t[1]===u&&(0,e.detach)(C)})),n[1]===u&&(h.classList.contains("e-sheet-content")||h.classList.contains("e-column-header"))&&b.forEach((function(t){t!==n&&(C=c.getElementsByClassName("e-left")[0])&&t[3]+1===u&&(0,e.detach)(C)})))):((c=h.querySelector("."+i))||(c=r.cloneNode(!0),o&&!c.classList.contains("e-multi-range")&&c.classList.add("e-multi-range"),h.appendChild(c)),s&&c.classList.remove(i)),(p||u)&&(d?c.style.zIndex=d:c.style.zIndex&&(c.style.zIndex="")),Ql(t,c,n,l,t.enableRtl,p,u,a,!1,t.viewport.beforeFreezeHeight,t.viewport.beforeFreezeWidth,t.sheetModule.colGroupWidth),c.classList.contains("e-hide")&&c.classList.remove("e-hide")}))}else o||(Jl(t.getSelectAllContent(),null,i,!0),Jl(t.getColumnHeaderContent(),null,i,!0),Jl(t.getRowHeaderContent(),null,i,!0)),Ql(t,r,n,l,t.enableRtl,p,u,a),"e-range-indicator"!==i&&t.getMainContent().querySelector("."+i)||t.getMainContent().appendChild(r),r.classList.contains("e-hide")&&r.classList.remove("e-hide"),s&&r.classList.remove(i)}}function Jl(t,r,n,i,a){if(i||t!==r)if(a)for(var o=t.querySelectorAll("."+n),s=0;s<o.length;)o[s].classList.remove(n),s++;else{var l=t.querySelector("."+n);l&&!l.classList.contains("e-multi-range")&&(0,e.detach)(l)}}function Ql(t,r,n,i,a,o,s,l,d,h,p,u,f,g,m){var v,y,C=c(n),b=$l(i,C,o,s,h,p,u),x=[Pr(i,0,!0),Pr(i,0,!0,"columns")];t.scrollSettings.isFinite?(v=C[0]>=i.rowCount?0:bl(i,C[0],C[2]<i.rowCount?C[2]:i.rowCount-1,!0),y=C[1]>=i.colCount?0:Rl(i,C[1],C[3]<i.colCount?C[3]:i.colCount-1,!0)):(v=bl(i,C[0],C[2],!0),y=Rl(i,C[1],C[3],!0));var S=0===C[1]&&C[3]===i.colCount-1,w=0===C[0]&&C[2]===i.rowCount-1,I=0,E=-5,N=-5,R=0,A=6,k=6;if((0,e.isNullOrUndefined)(f)){if((O={top:(C[0]===x[0]?b.top:b.top-gd(1))+"px",height:v&&v+(C[0]===x[0]?0:gd(1))+"px",width:y&&y+(C[1]===x[1]?0:gd(1))+(d&&s&&C[1]<s&&C[3]>=s?1:0)+"px"})[a?"right":"left"]=(C[1]===x[1]?b.left:b.left-1)+"px",r)return ed([{element:r,attrs:O}],l)}else{S&&(E=-5,N=-2,A=6,k=3),w&&(N=-5,E=0,A=1,k=6),w||(I+=v),S||(R+=y),I+=Math.round(b.top)+E,R+=Math.round(b.left)+N;var O={};g?((0,e.removeClass)([r],"e-hide"),I=m&&m.top?m.top:I,R=m&&m.left?m.left:R,(O={top:I+A+"px"})[a?"right":"left"]=R+k+"px",r&&ed([{element:r,attrs:O}],l)):((O={top:I+"px"})[a?"right":"left"]=R+"px",r&&ed([{element:r,attrs:O}],l))}}function ed(t,r){return new Promise((function(n){var i=function(){t.forEach((function(t){(0,e.setStyleAttribute)(t.element,t.attrs),n()}))};r?i():requestAnimationFrame((function(){return i()}))}))}function td(){return e.Browser.isPointer?"pointerdown":"mousedown touchstart"}function rd(){return e.Browser.isPointer?"pointermove":"mousemove touchmove"}function nd(){return e.Browser.isPointer?"pointerup":"mouseup touchend"}function id(e){return"touchstart"===e.type||"pointerdown"===e.type&&"touch"===e.pointerType}function ad(e){return"touchmove"===e.type||"pointermove"===e.type&&"touch"===e.pointerType}function od(e){return"touchend"===e.type||"pointerup"===e.type&&"touch"===e.pointerType}function sd(e){return e&&("mousedown"===e.type||"pointerdown"===e.type)}function ld(e){return e&&("mousemove"===e.type||"pointermove"===e.type)}function dd(e){return e&&("mouseup"===e.type||"pointerup"===e.type)}function hd(e){return e===Ul.UP||e===Ul.DOWN||e===Ul.LEFT||e===Ul.RIGHT}function pd(e){return e.changedTouches?e.changedTouches[0].clientX:e.clientX}function cd(e){return e.changedTouches?e.changedTouches[0].clientY:e.clientY}function ud(e){return e.changedTouches?e.changedTouches[0].pageX:e.pageX}function fd(e){return e.changedTouches?e.changedTouches[0].pageY:e.pageY}function gd(e,t){if(window.devicePixelRatio%1>0){var r=e*window.devicePixelRatio%1;return e+(r?(r>.5||t?1-r:-1*r)/window.devicePixelRatio:0)}return e}var md={role:"role",selected:"aria-selected",multiselectable:"aria-multiselectable",busy:"aria-busy",colcount:"aria-colcount"};function vd(e,t){Object.keys(t).forEach((function(r){e&&e.setAttribute(md[""+r],t[""+r])}))}function yd(t,r){if(t){var n=(0,e.getComponent)(t,r);n&&n.destroy()}}function Cd(e,t,r,n,i){var a,o,s,l,d,h,p,c,u,f=i.getActiveSheet(),g=i.frozenRowCount(f),m=i.frozenColCount(f);if(n){var v=e<m?i.getSelectAllContent():i.getColumnHeaderContent();a=v.getElementsByTagName("th")[t],o=v.getElementsByTagName("col")[t],s=(e<m?i.getRowHeaderContent():i.getMainContent()).getElementsByTagName("col")[t]}else{a=o=g||m?i.getRow(e,null,m-1):i.getRow(e,i.getRowHeaderTable()),o.style.height=parseInt(r,10)>0?gd(parseInt(r,10))+"px":"2px",(s=i.getRow(e,null,m)).style.height=parseInt(r,10)>0?gd(parseInt(r,10))+"px":"0px";var y=void 0;if(f.showHeaders){var C=i.getRowHeaderContent().getElementsByClassName("e-row"),b=[];b[0]=C[t].getElementsByTagName("td")[0].cloneNode(!0),y=Sd(i.getRowHeaderTable(),b,!1,i)+1}for(var x=i.getMainContent().getElementsByClassName("e-row"),S=[],w=0,I=0,E=e,N=0;N<x[t].getElementsByTagName("td").length;N++){var R=x[t].getElementsByTagName("td")[N];S[N]=R.cloneNode(!0);var A=zn(E,N,f,!1,!0);if(I=I<(w=A.value?Nd(i,A.style):w)?w:I,R.getElementsByClassName("e-cf-databar")[0]){var k=Number(s.style.height.split("px")[0]);i.notify(kt,{indexes:[E,N],cell:A,ele:R,isRender:!0,resizedRowHeight:k})}}var O=I+1,F=y>=O?y:O;parseInt(s.style.height,10)<F||a&&a.classList.contains("e-reach-fntsize")&&parseInt(s.style.height,10)===F?(f.showHeaders&&(a.classList.add("e-reach-fntsize"),o.style.lineHeight=parseInt(r,10)>=4?parseInt(r,10)-4+"px":parseInt(r,10)>0?parseInt(r,10)-1+"px":"0px"),s.style.lineHeight=parseInt(r,10)>0?parseInt(r,10)-1+"px":"0px"):(o&&o.style.removeProperty("line-height"),s.style.removeProperty("line-height"),a&&a.classList.contains("e-reach-fntsize")&&a.classList.remove("e-reach-fntsize"))}if(h=s.previousElementSibling,u=s.nextElementSibling,h&&(f.showHeaders&&(l=a.previousElementSibling,d=o.previousElementSibling),h=s.previousElementSibling),u&&(f.showHeaders&&(p=a.nextElementSibling,c=o.nextElementSibling),u=s.nextElementSibling),parseInt(r,10)<=0&&!s.classList.contains("e-zero")&&!s.classList.contains("e-zero-start")){if(h&&u)if(n?(f.showHeaders&&(o.style.width="2px"),s.style.width="0px"):(f.showHeaders&&(o.style.height="2px"),s.style.height="0px"),h.classList.contains("e-zero-start")?(f.showHeaders&&a.classList.add("e-zero-start"),s.classList.add("e-zero-start")):(f.showHeaders&&a.classList.add("e-zero"),s.classList.add("e-zero")),!p||p.classList.contains("e-zero")||p.classList.contains("e-zero-last")||(f.showHeaders&&a.classList.add("e-zero-last"),s.classList.add("e-zero-last")),h.classList.contains("e-zero-last")&&(f.showHeaders&&l.classList.remove("e-zero-last"),h.classList.remove("e-zero-last")),f.showHeaders&&l.classList.contains("e-zero")?(a.classList.contains("e-zero-end"),bd(d,-2,n)):f.showHeaders&&bd(d,-1,n),f.showHeaders&&l.classList.contains("e-zero-start")&&bd(o,-1,n),f.showHeaders&&p.classList.contains("e-zero"))if(a.classList.contains("e-zero-start"))for(;p;){if(p.classList.contains("e-zero")&&0!==parseInt(c.style.height,10)&&!n||0!==parseInt(c.style.width,10)&&n){n?(o.style.width=parseInt(o.style.width,10)-1+"px",c.style.width=parseInt(c.style.width,10)-1+"px"):(o.style.height=parseInt(o.style.height,10)-1+"px",c.style.height=parseInt(c.style.height,10)-1+"px"),p.classList.remove("e-zero"),p.classList.add("e-zero-start");break}var T=void 0;p.classList.remove("e-zero"),p.classList.add("e-zero-start"),n?(T=parseInt(p.getAttribute("aria-colindex"),10)-1,p=i.getColHeaderTable().getElementsByTagName("th")[T+1],c=i.getColHeaderTable().getElementsByTagName("col")[T+1]):(T=parseInt(p.getAttribute("aria-rowindex"),10)-1,p=i.getRowHeaderTable().getElementsByTagName("tr")[T+1],c=i.getRowHeaderTable().getElementsByTagName("tr")[T+1])}else bd(o,-2,n);else f.showHeaders&&(p.classList.contains("e-zero-end")?n?o.style.width="0px":o.style.height="0px":bd(c,-1,n));else if(h)n?(f.showHeaders&&(o.style.width="1px"),s.style.width="0px"):(f.showHeaders&&(o.style.height="1px"),s.style.height="0px"),f.showHeaders&&a.classList.add("e-zero-end"),s.classList.add("e-zero-end"),f.showHeaders&&a.classList.add("e-zero-last"),s.classList.add("e-zero-last"),f.showHeaders&&l.classList.contains("e-zero")?bd(d,-2,n):bd(d,-1,n);else if(p)if(a.classList.add("e-zero-start"),s.classList.add("e-zero-start"),p.classList.contains("e-zero")||(a.classList.add("e-zero-last"),s.classList.add("e-zero-last")),n?(o.style.width="1px",s.style.width="0px"):(o.style.height="1px",s.style.height="0px"),f.showHeaders&&p.classList.contains("e-zero"))for(;p;){if(p.classList.contains("e-zero")&&0!==parseInt(c.style.width,10)&&n||0!==parseInt(c.style.height,10)&&!n){n?(c.style.width=parseInt(c.style.width,10)-1+"px",o.style.width=parseInt(o.style.width,10)-1+"px"):(c.style.height=parseInt(c.style.height,10)-1+"px",o.style.height=parseInt(o.style.height,10)-1+"px"),p.classList.add("e-zero-start"),p.classList.remove("e-zero");break}T=void 0;p.classList.add("e-zero-start"),p.classList.remove("e-zero"),n?(T=parseInt(p.getAttribute("aria-colindex"),10)-1,c=i.getColHeaderTable().getElementsByTagName("col")[T+1],p=i.getColHeaderTable().getElementsByTagName("th")[T+1]):(T=parseInt(p.getAttribute("aria-rowindex"),10)-1,c=i.getRowHeaderTable().getElementsByTagName("tr")[T+1],p=i.getRowHeaderTable().getElementsByTagName("tr")[T+1])}else f.showHeaders&&bd(c,-1,n)}else if(parseInt(r,10)>0){var D=gd(parseInt(r,10))+"px";n?(o.style.width=D,s.style.width=D):(o.style.height=D,s.style.height=D),f.showHeaders&&l&&p?(l.classList.contains("e-zero")?a.classList.contains("e-zero")?n?(d.style.width=parseInt(d.style.width,10)+2+"px",o.style.width=parseInt(o.style.width,10)-1+"px"):(d.style.height=parseInt(d.style.height,10)+2+"px",o.style.height=parseInt(o.style.height,10)-1+"px"):bd(o,-1,n):a.classList.contains("e-zero")?bd(d,1,n):a.classList.contains("e-zero-start")&&(n?(d.style.width=parseInt(d.style.width,10)+1+"px",o.style.width=parseInt(o.style.width,10)-1+"px"):(d.style.height=parseInt(d.style.height,10)+1+"px",o.style.height=parseInt(o.style.height,10)-1+"px")),p.classList.contains("e-zero")?bd(o,-1,n):(a.classList.contains("e-zero")||a.classList.contains("e-zero-start"))&&bd(c,1,n),a.classList.contains("e-zero")&&a.classList.remove("e-zero"),a.classList.contains("e-zero-start")&&a.classList.remove("e-zero-start"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),s.classList.contains("e-zero-start")&&s.classList.remove("e-zero-start"),a.classList.contains("e-zero-last")&&a.classList.remove("e-zero-last"),s.classList.contains("e-zero-last")&&s.classList.remove("e-zero-last"),(l.classList.contains("e-zero")||l.classList.contains("e-zero-start"))&&(l.classList.add("e-zero-last"),h.classList.add("e-zero-last"))):f.showHeaders&&l?(l.classList.contains("e-zero")?a.classList.contains("e-zero")?n?(o.style.width=parseInt(o.style.width,10)-1+"px",d.style.width=parseInt(d.style.width,10)+2+"px"):(o.style.height=parseInt(o.style.height,10)-1+"px",d.style.height=parseInt(d.style.height,10)+2+"px"):bd(o,-1,n):a.classList.contains("e-zero")?bd(d,1,n):bd(o,-1,n),a.classList.contains("e-zero")&&a.classList.remove("e-zero"),a.classList.contains("e-zero-end")&&a.classList.remove("e-zero-end"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),s.classList.contains("e-zero-end")&&s.classList.remove("e-zero-end")):f.showHeaders&&p&&(p.classList.contains("e-zero")?bd(o,-1,n):a.classList.contains("e-zero-start")&&(bd(c,1,n),a.classList.remove("e-zero-start")),a.classList.contains("e-zero")&&a.classList.remove("e-zero"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),a.classList.contains("e-zero-start")&&a.classList.remove("e-zero-start"),s.classList.contains("e-zero-start")&&s.classList.remove("e-zero-start"))}}function bd(e,t,r){r?e.style.width=parseInt(e.style.width,10)+t+"px":e.style.height=parseInt(e.style.height,10)+t+"px"}function xd(e){Wl=e}function Sd(e,t,r,n,i,a){var o,s,l=n.createElement("div",{className:n.element.className,styles:"display: block"}),d=n.createElement("table",{className:e.className+"e-resizetable",styles:"width: auto;height: auto"}),h=n.createElement("tr");r?t.forEach((function(e){var t=h.cloneNode();t.appendChild(e),d.appendChild(t)})):(t.forEach((function(e){h.appendChild(e.cloneNode(!0))})),d.appendChild(h)),l.appendChild(d),document.body.appendChild(l);var p=d.getBoundingClientRect().width,c=d.getBoundingClientRect().height;return a?(o=r&&parseInt(i,10)>p?p:parseInt(i,10),s=!r&&parseInt(i,10)>c?c:parseInt(i,10)):(s=c,o=p),document.body.removeChild(l),r?Math.ceil(o):Math.ceil(s)}function wd(t,r,n,i,a,o){var l,d,c,u,f,g,m,v,y,C,b,x,S,w,I,E=t.eventArgs,N=t.isFromUpdateAction||(0,e.isUndefined)(n);if(t.isUndoRedo)return N=t.isFromUpdateAction=!0,delete t.isUndoRedo,void r.notify(wa,t);if(N&&!o){var R=E.address||E.range||E.pastedRange||E.addressCollection&&E.addressCollection[0]||E.dataRange,A=(0,e.isUndefined)(E.sheetIndex)?(0,e.isUndefined)(E.sheetIdx)?(0,e.isUndefined)(E.activeSheetIndex)?R?p(r,R):r.activeSheetIndex:E.activeSheetIndex:E.sheetIdx:E.sheetIndex;if(A!==r.activeSheetIndex){var k={sheet:Fn(r,A),resolveAfterFullDataLoaded:!0,indexes:[0,0,0,0],promise:new Promise((function(e){e(void 0)}))};return r.notify(_,k),void k.promise.then((function(){wd(t,r,n,i,a,!0)}))}}var O,F=En(r,E.index);switch(t.action){case"sorting":u={args:{range:t.eventArgs.range,sortOptions:t.eventArgs.sortOptions,cancel:!1},promise:c=new Promise((function(e){e(void 0)}))},r.notify(Oe,u),u.promise.then((function(e){r.serviceLocator.getService("cell").refreshRange(s(e.range))}));break;case"cellSave":g=(S={element:(f=t.eventArgs).element,value:f.value,oldValue:f.oldValue,address:f.address,displayText:f.displayText,formula:f.formula,originalEvent:f.originalEvent,format:f.format}).formula?{formula:S.formula}:{value:S.value},r.updateCellInfo(g,S.address,!1,t.eventArgs,n),!0===n&&r.trigger("cellSave",S);break;case"addNote":case"editNote":case"deleteNote":O=s(t.eventArgs.address),n&&(Vr(r,r.getActiveSheet(),{rowIdx:O[0],colIdx:O[1],preventEvt:!0,cell:{notes:t.eventArgs.notes}}),r.serviceLocator.getService("cell").refreshRange(s(E.address),!1,!1,!0,!0,Kr(r)));break;case"cellDelete":w=h(r,t.eventArgs.address),Ud(r,w.indices,w.sheetIndex);break;case"format":if("CellFormat"===E.requestType){if(E.style&&E.style.border&&!(0,e.isNullOrUndefined)(E.borderType)){var T={};Object.assign(T,E.style,null,!0),E.style.border=void 0,r.notify(ae,{style:E.style,refreshRibbon:!0,range:E.range,onActionUpdate:!0,isUndoRedo:!0}),E.style.border=T.border,r.setBorder(E.style,E.range,E.borderType),E.style=T}else r.notify(ae,{style:E.style,refreshRibbon:!0,range:E.range,onActionUpdate:!0,isUndoRedo:!0});zl((function(){return r.selectRange(r.getActiveSheet().selectedRange)}))}else r.numberFormat(E.format,E.range);break;case"clipboard":m=new Promise((function(e){e(void 0)})),x=r.getAddressInfo(E.copiedRange),r.notify(E.copiedInfo.isCut?Li:Pi,{range:x.indices,sId:Fn(r,x.sheetIndex).id,promise:c,invokeCopy:!0,isPublic:!0,isFromUpdateAction:!0}),m.then((function(){return r.notify(Mi,{range:s(E.pastedRange),sIdx:In(r,Nn(E.pastedRange)),type:E.type,isAction:!1,isInternal:!0,isFromUpdateAction:!0})}));break;case"gridLines":r.setSheetPropertyOnMute(r.sheets[E.sheetIdx],"showGridLines",E.isShow),r.serviceLocator.getService("sheet").toggleGridlines(),r.notify(Mt,null);break;case"headers":r.setSheetPropertyOnMute(r.sheets[E.sheetIdx],"showHeaders",E.isShow),r.serviceLocator.getService("sheet").showHideHeaders(),r.notify(Mt,null);break;case"resize":case"resizeToFit":N&&(C=Il(y=r.sheets[E.sheetIndex],E.index),b=fl(y,E.index),(E.isCol&&C&&C.hidden||b&&b.hidden)&&r.notify(Rt,{startIndex:E.index,endIndex:E.index,hide:!1,isCol:E.isCol,sheetIndex:E.sheetIndex})),E.isCol?void 0===E.hide?r.setColWidth(N&&!(0,e.isUndefined)(n)?E.oldWidth:E.width,E.index,E.sheetIndex):r.hideColumn(E.index,E.index,E.hide):(void 0===E.hide?r.setRowHeight(N&&!(0,e.isUndefined)(n)?E.oldHeight:E.height,E.index,E.sheetIndex):r.hideRow(E.index,E.index,E.hide),r.notify(sa,{rowIndex:E.index}));break;case"renameSheet":r.setSheetPropertyOnMute(r.sheets[F],"name",E.value),r.notify(xa,{items:r.element.querySelector(".e-sheet-tabs-items"),value:E.value,idx:F});break;case"hideSheet":r.notify(Sa,{sheetIndex:E.sheetIndex});break;case"showSheet":r.notify(uo,E);break;case"removeSheet":r.notify(Ni,{index:E.index,isAction:!0,count:E.sheetCount,clicked:!0});break;case"gotoSheet":r.notify(co,{selectedIndex:E.currentSheetIndex,previousIndex:E.previousSheetIndex});break;case"moveSheet":Mn(r,E.position,E.sheetIndexes,null,N);break;case"wrap":qn(t.eventArgs.address,t.eventArgs.wrap,r);break;case"hideShow":E.isCol?r.notify(Rt,{startIndex:E.startIndex,endIndex:E.endIndex,isCol:!0,hide:!1===n?!E.hide:E.hide,sheetIndex:E.sheetIndex,hiddenIndexes:E.hiddenIndexes}):r.notify(Rt,{startIndex:E.startIndex,endIndex:E.endIndex,hide:!1===n?!E.hide:E.hide,sheetIndex:E.sheetIndex});break;case"replace":r.notify(at,{value:E.compareValue,replaceValue:E.replaceValue,sheetIndex:E.sheetIndex,address:E.address});break;case"replaceAll":r.notify(ot,E);break;case"filter":c=new Promise((function(e){e(void 0)})),!1===n?r.notify(Aa,{predicates:E.previousPredicates,range:E.range,sIdx:E.sheetIndex,promise:c,isInternal:!0}):r.notify(Aa,{predicates:E.predicates,range:E.range,sIdx:E.sheetIndex,promise:c,isInternal:!0,useFilterRange:E.useFilterRange,allowHeaderFilter:E.allowHeaderFilter}),a&&!N&&c.then((function(){r.notify(Pa,(0,e.extend)({isUndo:!n,isUndoRedo:!N},a))}));break;case"insert":if("Sheet"===t.eventArgs.modelType)y=r;else if(!(y=Fn(r,t.eventArgs.activeSheetIndex)))break;!1===n?r.notify(Ze,{model:y,start:t.eventArgs.index,isUndoRedo:!0,end:t.eventArgs.index+(t.eventArgs.model.length-1),modelType:t.eventArgs.modelType}):r.notify($e,{model:y,start:t.eventArgs.index,end:t.eventArgs.index+(t.eventArgs.model.length-1),modelType:t.eventArgs.modelType,checkCount:void 0===n?t.eventArgs.sheetCount:null,activeSheetIndex:t.eventArgs.activeSheetIndex,isUndoRedo:!0,insertType:t.eventArgs.insertType,isFromUpdateAction:N,isRedo:n});break;case"delete":if("Sheet"===t.eventArgs.modelType)y=r;else if(!(y=Fn(r,t.eventArgs.activeSheetIndex)))break;!1===n?r.notify($e,{model:y,start:t.eventArgs.deletedModel,modelType:t.eventArgs.modelType,columnCellsModel:t.eventArgs.deletedCellsModel,definedNames:t.eventArgs.definedNames,activeSheetIndex:t.eventArgs.activeSheetIndex,isUndoRedo:!0,insertType:"Row"===t.eventArgs.modelType?"above":"before",conditionalFormats:t.eventArgs.conditionalFormats,prevAction:t.action,freezePane:E.freezePane}):r.notify(Ze,{model:y,start:t.eventArgs.startIndex,checkCount:t.eventArgs.sheetCount,end:t.eventArgs.endIndex,modelType:t.eventArgs.modelType,isUndoRedo:!0,insertType:"Row"===t.eventArgs.modelType?"above":"before"});break;case"validation":!1===n?r.notify(ho,{range:E.range}):r.notify(Qe,{rules:{type:E.type,operator:E.operator,value1:E.value1,value2:E.value2,ignoreBlank:E.ignoreBlank,inCellDropDown:E.inCellDropDown},range:E.range,isAction:!0});break;case"removeHighlight":case"addHighlight":r.notify(_a,{isRemoveHighlight:"removeHighlight"===t.action,isPublic:!0});break;case"merge":t.eventArgs.isAction=!1,v=[];for(var D=0,L=E.model.length;D<L;D++){v.push({cells:[]});for(var P=0,M=E.model[D].cells.length;P<M;P++)v[D].cells[P]={},Object.assign(v[D].cells[P],E.model[D].cells[P])}if(!1===n&&E.mergeCollection)for(var B=void 0,H=0;H<E.mergeCollection.length;H++)B={range:null},Object.assign(B,E),B.range=E.mergeCollection[H],r.notify(St,B);else r.notify(St,t.eventArgs);if("Manual"===r.calculationMode&&n&&r.getActiveSheet().isSheetCalculated)for(H=0;H<E.model.length;H++)for(var U=E.model[H].cells,V=0;V<U.length;V++){var z=E.model[H].cells[V].value;v[H].cells[V].value=(0,e.isNullOrUndefined)(z)||""===z?v[H].cells[V].value:z}E.model=v;break;case"clear":I={options:t.eventArgs,isFromUpdateAction:N},r.notify(go,I),!N&&I.cfClearActionArgs&&(E.cfClearActionArgs.previousConditionalFormats=I.cfClearActionArgs.previousConditionalFormats,E.cfClearActionArgs.conditionalFormats=I.cfClearActionArgs.conditionalFormats);break;case"conditionalFormat":!1===n?r.notify(Ot,{range:E.range,cfModel:{type:E.type,cFColor:E.cFColor,value:E.value},sheetIdx:E.sheetIdx,isUndoRedo:!E.cancel,isFromUpdateAction:N}):r.notify(At,{cfModel:{type:E.type,cFColor:E.cFColor,value:E.value,range:E.range},sheetIdx:E.sheetIdx,isUndoRedo:!0,isFromUpdateAction:N});break;case"clearCF":if(!1===n)r.notify(Ot,{oldCFModel:E.previousConditionalFormats,updatedCFModel:E.conditionalFormats,range:E.selectedRange,isUndo:!0,sheetIdx:E.sheetIdx});else{var j={range:E.selectedRange,sheetIdx:E.sheetIdx,isUndoRedo:!0,isFromUpdateAction:N};r.notify(Ot,j),N||(E.previousConditionalFormats=j.oldCFModel,j.updatedCFModel.length?E.conditionalFormats=j.updatedCFModel:delete E.conditionalFormats)}break;case"insertImage":!1===n?r.notify(ko,{id:t.eventArgs.id,sheetIdx:t.eventArgs.sheetIndex+1,range:t.eventArgs.range,preventEventTrigger:!0}):r.notify(Ao,{options:{src:t.eventArgs.imageData,height:t.eventArgs.imageHeight,width:t.eventArgs.imageWidth,id:t.eventArgs.id},range:t.eventArgs.range,isPublic:!1,isUndoRedo:!0});break;case"deleteImage":!1===n?r.notify(Ao,{options:{src:t.eventArgs.imageData,height:t.eventArgs.imageHeight,width:t.eventArgs.imageWidth,id:t.eventArgs.id},range:t.eventArgs.address,isPublic:!1,isUndoRedo:!0}):r.notify(ko,{id:t.eventArgs.id,range:t.eventArgs.address,preventEventTrigger:!0});break;case"imageRefresh":d=document.getElementById(t.eventArgs.id),!1===n?r.notify(Eo,{prevTop:t.eventArgs.currentTop,prevLeft:t.eventArgs.currentLeft,currentTop:t.eventArgs.prevTop,currentLeft:t.eventArgs.prevLeft,id:t.eventArgs.id,currentHeight:t.eventArgs.prevHeight,currentWidth:t.eventArgs.prevWidth,requestType:"imageRefresh",prevHeight:t.eventArgs.currentHeight,prevWidth:t.eventArgs.currentWidth,prevRowIdx:t.eventArgs.prevRowIdx,prevColIdx:t.eventArgs.prevColIdx,currentRowIdx:t.eventArgs.currentRowIdx,currentColIdx:t.eventArgs.currentColIdx,isUndoRedo:!0}):(t.eventArgs.isUndoRedo=!0,r.notify(Eo,t.eventArgs)),d&&(d.style.height=!1===n?t.eventArgs.prevHeight+"px":t.eventArgs.currentHeight+"px",d.style.width=!1===n?t.eventArgs.prevWidth+"px":t.eventArgs.currentWidth+"px",d.style.top=!1===n?t.eventArgs.prevTop+"px":t.eventArgs.currentTop+"px",d.style.left=!1===n?t.eventArgs.prevLeft+"px":t.eventArgs.currentLeft+"px");break;case"insertChart":if(!1===n)r.notify(Oo,{id:E.id,range:E.posRange||E.range,isUndoRedo:!0});else{var q=[{type:E.type,theme:E.theme,markerSettings:E.markerSettings,isSeriesInRows:E.isSeriesInRows,range:E.range,id:E.id,height:E.height,width:E.width,top:E.top,left:E.left}];r.notify(Lt,{chart:q,isUndoRedo:!1,range:E.posRange||E.range,isInitCell:!0,isRedo:!0})}break;case"deleteChart":if(!1===n){var W=[{type:E.type,theme:E.theme,markerSettings:E.markerSettings,dataLabelSettings:E.dataLabelSettings,title:E.title,legendSettings:E.legendSettings,primaryXAxis:E.primaryXAxis,primaryYAxis:E.primaryYAxis,isSeriesInRows:E.isSeriesInRows,range:E.range,id:E.id,height:E.height,width:E.width,top:E.top,left:E.left}];r.notify(Lt,{chart:W,isUndoRedo:!1,range:E.posRange,isInitCell:!0,isUndo:!0})}else r.notify(Oo,{id:E.id,range:E.range,isUndoRedo:!0});break;case"chartRefresh":(l=document.getElementById(t.eventArgs.id))&&(l.style.height=!1===n?t.eventArgs.prevHeight+"px":t.eventArgs.currentHeight+"px",l.style.width=!1===n?t.eventArgs.prevWidth+"px":t.eventArgs.currentWidth+"px",l.style.top=!1===n?t.eventArgs.prevTop+"px":t.eventArgs.currentTop+"px",l.style.left=!1===n?t.eventArgs.prevLeft+"px":t.eventArgs.currentLeft+"px"),!1===n?(r.notify(Fo,(0,e.extend)({},t.eventArgs,{currentColIdx:t.eventArgs.prevColIdx,currentHeight:t.eventArgs.prevHeight,currentLeft:t.eventArgs.prevLeft,currentRowIdx:t.eventArgs.prevRowIdx,currentTop:t.eventArgs.prevTop,currentWidth:t.eventArgs.prevWidth,prevColIdx:t.eventArgs.currentColIdx,prevHeight:t.eventArgs.currentHeight,prevLeft:t.eventArgs.currentLeft,prevRowIdx:t.eventArgs.currentRowIdx,prevTop:t.eventArgs.currentTop,prevWidth:t.eventArgs.currentWidth,isUndoRedo:!0})),r.notify(Ht,{height:t.eventArgs.prevHeight.toString(),width:t.eventArgs.prevWidth.toString(),overlayEle:l})):(t.eventArgs.isUndoRedo=!0,r.notify(Fo,t.eventArgs),r.notify(Ht,{height:t.eventArgs.currentHeight.toString(),width:t.eventArgs.currentWidth.toString(),overlayEle:l}));break;case"chartDesign":r.notify(zo,t.eventArgs);break;case"autofill":N&&E.undoArgs&&(E.undoArgs.isFromUpdateAction=E.undoArgs.isUndo=E.undoArgs.preventEvt=!0,E.undoArgs.isPublic=!0,r.notify(wa,E.undoArgs)),r.notify(Xt,{fillRange:t.eventArgs.fillRange,dataRange:t.eventArgs.dataRange,fillType:t.eventArgs.fillType,direction:t.eventArgs.direction,cells:t.eventArgs.beforeActionData});break;case"removeValidation":!1!==n&&r.notify(ho,{range:E.range,isCol:E.isColSelected});break;case"addDefinedName":if(!1===n)r.notify(pe,{action:"removeDefinedName",isRemoved:!1,definedName:E.name,scope:E.scope,isEventTrigger:!0});else{var G={name:E.name,refersTo:E.refersTo,scope:E.scope,comment:E.comment};r.notify(pe,{action:"addDefinedName",isAdded:!1,definedName:G,isEventTrigger:!0})}break;case"hyperlink":r.notify(Ve,{hyperlink:E.hyperlink,cell:E.address,displayText:E.displayText,isUndoRedo:!0}),r.serviceLocator.getService("cell").refreshRange(s(E.address),!1,!1,!1,!0,Kr(r));break;case"removeHyperlink":r.notify(Ca,{range:E.address,preventEventTrigger:!0});break;case"freezePanes":r.freezePanes(E.row,E.column,E.sheetIndex);break;case"duplicateSheet":Bn(r,E.sheetIndex,null,N);break;case"protectSheet":E.isProtected?r.notify(gt,E):(r.setSheetPropertyOnMute(Fn(r,E.sheetIndex),"password",""),r.notify(Ga,{isActive:!0,sheetIndex:E.sheetIndex}));break;case"protectWorkbook":E.isProtected?r.notify(Go,E):r.notify(Yo,null);break;case"lockCells":r.notify(bt,E)}}function Id(e,r,n,i){for(var a,o=e.sheets[i].ranges,s=0,l=o.length;s<l;s++)if(o[s].template&&(a=t(o[s].address.length?o[s].address:o[s].startCell))[0]<=r&&a[1]<=n&&a[2]>=r&&a[3]>=n)return!0;return!1}function Ed(e,t,r,n,i,a,o,s){void 0===o&&(o=!0);var l=yl(t,n,!0),d=gd(r);if(!s){var h=e.frozenColCount(t);if((i=i||(t.frozenRows?e.getRow(n,null,h):e.getRow(n)))&&(i.style.height=d+"px"),t.frozenColumns)a=a||e.getRow(n,null,h-1);else{var p=e.frozenRowCount(t);a=a||e.getRow(n,n<p?e.sheetModule.getSelectAllTable():e.getRowHeaderTable())}a&&(a.style.height=d+"px")}Cl(t,n,r),e.setProperties({sheets:e.sheets},!0),o&&e.notify(Ji,{rowIdx:n,threshold:d-l})}function Nd(e,t,r,n){void 0===r&&(r=1);var i=t&&t.fontSize||e.cellStyle.fontSize,a=(i.indexOf("pt")>-1?parseInt(i,10)/.75:parseInt(i,10))*(n||Rd(t&&t.fontFamily?t:e.cellStyle))*r;return Math.ceil(a%1>.9?a+1:a)}function Rd(e){var t=Wl;return e&&("Arial Black"===e.fontFamily||"Comic Sans MS"===e.fontFamily?t=1.44:'"Segoe UI", sans-serif'===e.fontFamily&&(t=1.36)),t}function Ad(e,t,r,n){t||(t=r);var i=document.createElement("canvas").getContext("2d");return i.font=(t.fontStyle||r.fontStyle)+" "+(t.fontWeight||r.fontWeight)+" "+(t.fontSize||r.fontSize)+" "+(t.fontFamily||r.fontFamily),n?i.measureText(e).width:gd(i.measureText(e).width,!0)}function kd(e,t,r,n){var i,a,o,s,l,d=0,h=e.toString().split(" "),p=Ad(" ",r,n),c=0,u=0,f=0,g=function(e,a){d&&c++,i/t>=1&&(e.split("").forEach((function(e){s=Ad(e,r,n,!0),(o+=s)>t&&(c++,o=s)})),i=gd(o,!0)),a||m(i),d=i},m=function(e){i+=(e+p)/t>=1?0:p};return h.forEach((function(e){if(o=0,s=0,i=Ad(e,r,n),(d+i)/t>1)if((a=e.split("-")).length>1){var p=a.length-1;a.forEach((function(a,c){o=0,s=0,l||(l=Ad("-",r,n)),i=Ad(a,r,n),c<p&&(i+=l),(d+i)/t>=1?g(a,c!==p):(c===p&&h[h.length-1]!==e&&m(d+i),d+=i)}))}else g(e,!1);else m(d+i),d+=i})),d&&(u=(d-p)/t,f=parseFloat(u.toString().split(".")[0]),c+=u+.05>=f+1?Math.ceil(u)+1:Math.ceil(u)),c}function Od(e,t,r){var n=0,i=zn(e,t,r,null,!0),a=zn(e,t+1,r,null,!0);return i.style&&(i.style.border?n=(0===t?2:1)*parseFloat(i.style.border.split("px")[0]):(0===t&&i.style.borderLeft&&(n=parseFloat(i.style.borderLeft.split("px")[0])),i.style.borderRight&&(n+=parseFloat(i.style.borderRight.split("px")[0])))),i.style&&(i.style.border||i.style.borderRight)||!a.style||!a.style.borderLeft||(n+=parseFloat(a.style.borderLeft.split("px")[0])),n>0&&n<1?1:n}function Fd(e,t,r){var n=0,i=zn(e,t,r,null,!0);i.style&&(i.style.border?n=(0===e?2:1)*parseFloat(i.style.border.split("px")[0]):(0===e&&i.style.borderTop&&(n=parseFloat(i.style.borderTop.split("px")[0])),i.style.borderBottom&&(n+=parseFloat(i.style.borderBottom.split("px")[0]))));var a=zn(e+1,t,r,null,!0);return i.style&&(i.style.border||i.style.borderBottom)||!a.style||!a.style.borderTop||(n+=parseFloat(a.style.borderTop.split("px")[0])),Math.ceil(n)||1}function Td(e,t,r,n){return void 0===n&&(n=r),Rl(e,r,n,!0)-gd(4+(Od(t,r,e)||1))}function Dd(e,t,r,n,i,a,o){return Nd(e,i,a,o)+Fd(t,r,n)}function Ld(e,t,r,n){e.maxHgts[t]||(e.maxHgts[t]={}),e.maxHgts[t][r]=n}function Pd(e,t){var r=0,n=e.maxHgts[t];return n&&Object.keys(n).forEach((function(e){n[""+e]>r&&(r=n[""+e])})),r}function Md(t){if(!document.activeElement.classList.contains("e-text-findNext-short"))if(e.Browser.isIE){var r=window.scrollX,n=window.scrollY;t.focus(),window.scrollTo(r,n)}else{if(t.classList.contains("e-input")){var i=t,a=i.value.length;i.setSelectionRange(a,a)}t.focus({preventScroll:!0})}}function Bd(r,n){for(var i,a=r.getActiveSheet(),o=(0,e.isNullOrUndefined)(n)?c(t(a.selectedRange)):n,s=o[0];s<=o[2];s++)for(var l=o[1];l<=o[3];l++){if(Tr(zn(s,l,a),Il(a,l))){i=!0;break}}return i}function Hd(e){return e.includes(" ")}function Ud(t,r,n){for(var i,a,o,l,d,h,p=Fn(t,n),c=n===t.activeSheetIndex,u=p.conditionalFormats&&p.conditionalFormats.length&&[].slice.call(p.conditionalFormats),f=[],g=!1,m=r[0],v=r[2];m<=v;m++)if(!vl(p,m))for(var y=r[1],C=r[3];y<=C;y++){var b={cellIdx:[m,y],isUnique:!1,uniqueRange:""};if(t.notify(Ee,b),i=!1,""!==b.uniqueRange){var x=s(b.uniqueRange);i="#SPILL!"===zn(x[0],x[1],p).value}var S=m===v&&y===C;if(!b.isUnique||i)if((a=zn(m,y,p))&&0===a.value||a&&a.value&&((0,e.isNullOrUndefined)(a.value)||""!==a.value)){g=!1,o={},a.formula&&(o.formula=""),(a.value||0===a.value)&&(o.value=""),a.hyperlink&&(o.hyperlink="");var w={sheet:p,cell:a,rowIdx:m,colIdx:y};if((a.colSpan>1||a.rowSpan>1)&&Xr(w),d={cell:o,rowIdx:m,colIdx:y,valChange:!0,uiRefresh:c,td:l=t.getCell(w.rowIdx,w.colIdx),cellDelete:!0,isDelete:!S,deletedRange:r},!Object.keys(o).length||Vr(t,p,d))continue;u&&!h&&((h=d.isFormulaDependent)||qr(u,f,m,y)),l&&(l.querySelector(".e-cf-databar")&&l.removeChild(l.querySelector(".e-cf-databar")),l.querySelector(".e-iconsetspan")&&l.removeChild(l.querySelector(".e-iconsetspan")))}else if(!g&&d&&(g=S,d.isDelete=!S,!Object.keys(o).length||Vr(t,p,d)))continue}(f.length||h)&&c&&t.notify(kt,{cfModel:!h&&f,refreshAll:h,isAction:!0,isEdit:!0})}function Vd(e,t){for(var r=0,n=e.getActiveSheet(),i=(n.frozenRows?e.viewport.height-e.sheetModule.getColHeaderHeight(n,!0):e.viewport.height)-17||20,a=t;;a++)if((r+=yl(n,a,!0))>=i)return{index:a,height:r}}function zd(e,t){for(var r=0,n=e.getActiveSheet(),i=e.getMainContent().parentElement.offsetWidth-e.sheetModule.getRowHeaderWidth(n)-e.sheetModule.getScrollSize(),a=t;;a++)if((r+=Nl(n,a,null,!0))>=i)return a}function jd(e,t){e.renderModule.setSheetPanelSize(t)}function _d(e,t){var r=[];if(t){var n=Object.getPrototypeOf(new Vn(e,"cells",{},!0)).constructor.prototype.propList,i=n.colPropNames.concat(n.complexPropNames).concat(n.propNames);i.push("formattedText");var a,o=(n=Object.getPrototypeOf(new ul(e,"rows",{},!0)).constructor.prototype.propList).colPropNames.concat(n.complexPropNames).concat(n.propNames),s=(n=Object.getPrototypeOf(new wl(e,"columns",{},!0)).constructor.prototype.propList).colPropNames.concat(n.complexPropNames).concat(n.propNames),l=(n=Object.getPrototypeOf(new wn(e,"sheets",{},!0)).constructor.prototype.propList).colPropNames.concat(n.complexPropNames).concat(n.propNames);l.splice(l.indexOf("rows"),1),l.splice(l.indexOf("columns"),1),l.splice(l.indexOf("cells"),1),o.splice(o.indexOf("cells"),1),r.push.apply(r,l),-1===t.indexOf("rows")&&r.push.apply(r,o),-1===t.indexOf("columns")&&r.push.apply(r,s),-1===t.indexOf("cells")&&r.push.apply(r,i),t.forEach((function(e){a=r.indexOf(e),r.indexOf(e)>-1&&r.splice(a,1)}))}else r.push("ranges");var d={skipProps:r};return e.notify("getStringifyObject",d),d.model}function qd(e){for(var t,r=[],n=e.getActiveSheet().name,i=0,a=e.chartColl.length;i<a;i++)if(n===Nn((t=e.chartColl[i]).range)){var o={clientY:t.top,isImage:!0},s={clientX:t.left,isImage:!0};e.notify(No,o),e.notify(Ro,s),r.push({chart:t,chartRowIdx:o.clientY,chartColIdx:s.clientX})}return r}function Wd(e){return/^[A-Za-z]+:[A-Za-z]+$/.test(e)}function Gd(e){return/^[0-9]+:[0-9]+$/.test(e)}function Yd(e,t,r){var n=e.sheets[t];n&&(n.standardHeight=r,e.dataBind())}function Xd(e,t){return e.sheets[t].standardHeight}function Kd(e){e.forEach((function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}))}var $d=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Zd=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Jd=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return $d(r,t),Zd([(0,e.Property)(!1)],r.prototype,"isFinite",void 0),Zd([(0,e.Property)(!0)],r.prototype,"enableVirtualization",void 0),r}(e.ChildProperty),Qd=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return $d(r,t),Zd([(0,e.Property)("Multiple")],r.prototype,"mode",void 0),r}(e.ChildProperty),eh=function(){function n(e){this.colGroupWidth=30,this.parent=e,this.col=e.createElement("col"),this.rowRenderer=e.serviceLocator.getService("row"),this.cellRenderer=e.serviceLocator.getService("cell"),this.addEventListener()}return n.prototype.refreshSelectALLContent=function(){var e,t=this.parent.getActiveSheet();if(t.frozenColumns||t.frozenRows){var r=this.getSelectAllTable().querySelector("thead"),n=this.rowRenderer.render();r.appendChild(n),e=this.parent.createElement("th",{className:"e-select-all-cell"}),n.appendChild(e)}else(e=this.headerPanel.firstElementChild).classList.add("e-select-all-cell");e.appendChild(this.parent.createElement("button",{className:"e-selectall",id:this.parent.element.id+"_select_all",attrs:{"aria-label":this.parent.serviceLocator.getService(Dl).getConstant("SelectAll"),type:"button"}}))},n.prototype.updateLeftColGroup=function(e,t){e&&(this.colGroupWidth=e),t||(t=this.getRowHeaderPanel());var r,n=t.querySelector("table"),i=this.parent.getActiveSheet(),a=document.createDocumentFragment();if(e)n.querySelector("colgroup").firstElementChild.style.width=this.colGroupWidth+"px";else{r=this.parent.createElement("colgroup");var o=this.col.cloneNode();o.style.width=this.colGroupWidth+"px",a.appendChild(o),r.appendChild(a),n.insertBefore(r,n.querySelector("tbody"))}(i.frozenRows||i.frozenColumns)&&(n=this.getSelectAllTable(),e?n.querySelector("colgroup").firstElementChild.style.width=this.colGroupWidth+"px":n.insertBefore(r.cloneNode(!0),n.querySelector("thead"))),this.setPanelWidth(i,t),this.setPanelHeight(i)},n.prototype.setPanelWidth=function(t,r,n){var i,a=this.getScrollSize(!0),o=this.getRowHeaderWidth(t),s=this.parent.enableRtl,l=s?"right":"left",d=this.getColHeaderPanel(),h=this.getContentPanel();if(n&&(i=s?"left":"right",h.style[""+i]=d.style[""+i]=""),t.frozenColumns){var p=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-column")[0];p.style.height="calc(100% - "+a+"px)",n&&(p.style[""+i]=""),p.style[""+l]=o-gd(1)+"Px",p.style.display=""}var c="calc(100% - "+o+"px)";this.setHeaderPanelWidth(this.getSelectAllContent(),o),d.style.width=c,d.style[""+l]=o+"px",this.setHeaderPanelWidth(r,o),h.style.width=c,h.style[""+l]=o+"px";var u=this.contentPanel.nextElementSibling?this.contentPanel.nextElementSibling:null;u&&(a?u.style.height=a+1+"px":(u.style.height="1px",u.style.borderTopWidth="0px"),u=u.firstElementChild,n&&(u.style[""+i]=""),u.style[""+l]=o+"px",u.style.width=c,e.Browser.userAgent.indexOf("Mac OS")>-1&&"safari"===e.Browser.info.name&&(u.style.height="7px",u.style.top="-7px"))},n.prototype.getScrollSize=function(e){var t=parseInt(this.headerPanel.style[this.parent.enableRtl?"margin-left":"margin-right"],10);return t?t+(e?1:0):0},n.prototype.setHeaderPanelWidth=function(e,t){[].slice.call(e.querySelectorAll("col.e-empty")).forEach((function(e){t+=parseInt(e.style.width,10)})),e.style.width=t+"px"},n.prototype.setPanelHeight=function(t){var r=this.getScrollSize(!0),n=this.contentPanel,i=this.headerPanel;if(t.frozenRows){var a=this.getColHeaderHeight(t);t.showHeaders||t.frozenColumns?i.style.height="":i.style.height=a+"px",n.style.height="calc(100% - "+(a+r)+"px)";var o=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-row")[0];o.style.width=e.Browser.isDevice?"100%":"calc(100% - "+r+"px)",o.style.top=a-1-(t.showHeaders?1:0)+"px",o.style.display=""}else n.style.height="calc(100% - "+((t.showHeaders?gd(31):0)+r)+"px)"},n.prototype.renderPanel=function(){this.contentPanel=this.parent.createElement("div",{className:"e-main-panel",attrs:{tabindex:"0"}});var t=this.parent.getActiveSheet(),r=this.parent.element.id,n=document.createDocumentFragment(),i=this.parent.createElement("div",{className:"e-row-header",id:r+"_row_header"});n.appendChild(i),this.initHeaderPanel(),this.parent.allowScrolling&&this.parent.scrollModule.setPadding();var a=document.getElementById(this.parent.element.id+"_sheet");t.frozenColumns&&a.classList.add("e-frozen-columns"),t.frozenRows&&a.classList.add("e-frozen-rows"),this.updateHideHeaders(t,a),t.showGridLines||a.classList.add("e-hide-gridlines");var o=this.parent.createElement("div",{className:"e-sheet-content",id:r+"_main_content"});n.appendChild(o),this.parent.allowScrolling||(o.style.overflow="hidden"),t.frozenRows&&a.appendChild(this.parent.createElement("div",{className:"e-frozen-row",styles:"display: none"})),t.frozenColumns&&a.appendChild(this.parent.createElement("div",{className:"e-frozen-column",styles:"display: none"})),e.Browser.userAgent.indexOf("Mac OS")>-1&&"safari"===e.Browser.info.name&&a.classList.add("e-mac-safari"),this.contentPanel.appendChild(n)},n.prototype.initHeaderPanel=function(){var e=this.parent.element.id,t=document.createDocumentFragment();this.headerPanel=this.parent.createElement("div",{className:"e-header-panel"});var r=this.parent.createElement("div",{className:"e-selectall-container",id:e+"_selectall"});t.appendChild(r);var n=this.parent.createElement("div",{className:"e-column-header",id:e+"_col_header"});t.appendChild(n),this.headerPanel.appendChild(t)},n.prototype.createHeaderTable=function(){var e=this.contentPanel.querySelector(".e-row-header"),t=this.parent.getActiveSheet();(t.frozenRows||t.frozenColumns)&&this.updateTable(t.frozenRows?["thead","tbody"]:["thead"],"selectall",this.headerPanel.querySelector(".e-selectall-container")),this.updateTable(t.frozenRows?["thead","tbody"]:["thead"],"colhdr",this.headerPanel.querySelector(".e-column-header")),this.updateTable(["tbody"],"rowhdr",e),this.updateLeftColGroup(null,e)},n.prototype.updateTable=function(e,t,r){var n=this,i=document.createDocumentFragment(),a=this.parent.createElement("table",{className:"e-table e-"+t+"-table",attrs:{role:"grid"}});e.forEach((function(e){i.appendChild(n.parent.createElement(e))})),a.appendChild(i),r.appendChild(a)},n.prototype.renderTable=function(r){var n,i,a,o,s,l=this,d=this.parent.getActiveSheet(),h=[],p=document.createDocumentFragment();if(p.appendChild(this.headerPanel),p.appendChild(this.contentPanel),this.parent.allowScrolling){var c=this.parent.createElement("div",{className:"e-scrollbar"});c.appendChild(this.parent.createElement("div",{className:"e-scroller"})),p.appendChild(c)}this.createHeaderTable(),this.updateTable(["tbody"],"content",this.contentPanel.lastElementChild);var u,f=this.parent.createElement("colgroup"),g=this.contentPanel.querySelector(".e-sheet-content tbody");this.refreshSelectALLContent();var m=this.getSelectAllContent().querySelector("colgroup"),v=this.getRowHeaderPanel().querySelector("colgroup"),y=this.getSelectAllContent().querySelector("thead .e-header-row"),C=this.contentPanel.querySelector(".e-row-header tbody"),b=this.getSelectAllContent().querySelector("tbody"),x=this.headerPanel.querySelector(".e-column-header thead"),S=this.headerPanel.querySelector(".e-column-header tbody"),w=this.rowRenderer.render();x.appendChild(w),this.getColHeaderTable().insertBefore(f,x);var I=this.parent.frozenRowCount(d),E=this.parent.frozenColCount(d),N=Pr(d,E-1,!1,"columns");this.parent.notify(yi,{top:r.top,left:r.left});var R,A=d.colCount.toString(),k=d.colCount.toString(),O=r.top&&r.left?"RowColumn":r.top?"Row":r.left?"Column":"";this.parent.getColHeaderTable().setAttribute("aria-colcount",A),this.parent.getRowHeaderTable().setAttribute("aria-rowcount",k),(0,e.attributes)(this.parent.getContentTable(),{"aria-rowcount":k,"aria-colcount":A}),r.cells.forEach((function(e,p){(n=t(p))[1]!==r.indexes[1]&&i||(n[1]===r.indexes[1]&&(a=l.rowRenderer.render(n[0],!0)),E&&I&&n[1]<E&&n[0]<I?((R=b.querySelector(".e-empty"))?b.insertBefore(a,R):b.appendChild(a),i=a):E&&n[1]<E?(C.appendChild(a),i=a):(i=l.rowRenderer.render(n[0]),I&&n[0]<I?(R=S.querySelector(".e-empty"))?S.insertBefore(i,R):S.appendChild(i):g.appendChild(i),n[1]===r.indexes[1]&&(I&&n[0]<I?b.appendChild(a):C.appendChild(a))),n[1]===r.indexes[1]&&l.cellRenderer.renderRowHeader(n[0],a)),s={colIdx:n[1],rowIdx:n[0],cell:e,mergeBorderRows:h,address:p,lastCell:n[1]===r.indexes[3],isHeightCheckNeeded:!0,row:i,hRow:a,pRow:i.previousSibling,pHRow:a.previousSibling,isRefreshing:r.isRefreshing,first:O?O.includes("Row")?n[0]===r.indexes[0]?"Row":O.includes("Column")&&n[1]===r.indexes[1]?"Column":"":n[1]===r.indexes[1]?"Column":"":""},o=l.cellRenderer.render(s);var c=l.parent.scrollSettings.enableVirtualization&&l.parent.viewport.topIndex!==Pr(d,0,!0),x=l.parent.scrollSettings.enableVirtualization&&l.parent.viewport.leftIndex!==Pr(d,0,!0,"columns");if(c&&l.checkRowMerge(n,r.indexes,o,e,d),x&&l.checkColMerge(n,r.indexes,o,e,d),E&&n[1]===N&&(i=null),n[0]===r.indexes[0])if(E&&n[1]<E){u=l.updateCol(d,n[1],m);var A=v.querySelector(".e-empty");A?v.insertBefore(u.cloneNode(!0),A):v.appendChild(u.cloneNode(!0)),l.cellRenderer.renderColHeader(n[1],y)}else l.updateCol(d,n[1],f),l.cellRenderer.renderColHeader(n[1],w)})),this.parent.isReact&&this.parent.renderReactTemplates(),rn(this.parent,h),g.parentElement.insertBefore(f.cloneNode(!0),g);var F=r.openOptions&&r.openOptions.eventArgs&&r.openOptions.eventArgs.triggerEvent;zl((function(){if(l.parent){var e=l.parent.getMainContent(),t=document.getElementById(l.parent.element.id+"_sheet");if(t.childElementCount&&t.querySelector(".e-header-panel")!==l.headerPanel)for(var n=t.children,i=0;i<n.length;i++)n[i].classList.contains("e-frozen-row")||n[i].classList.contains("e-frozen-column")||n[i].classList.contains("e-ss-overlay")||t.removeChild(n[i]);if(t.appendChild(p),t.style.backgroundColor="",d.conditionalFormats&&d.conditionalFormats.length&&l.parent.notify(kt,{indexes:r.indexes}),l.checkRowHeightChanged(r,d),r.top&&(e.parentElement.scrollTop=r.top),r.left&&(e.scrollLeft=r.left,l.parent.getColumnHeaderContent().scrollLeft=r.left),l.parent.notify(ii,r),l.checkTableWidth(d),l.parent.notify(si,{action:"renderEditor",initLoad:r.initLoad&&!l.parent.isOpen}),r.initLoad||l.parent.isOpen||l.parent.hideSpinner(),vd(e,{busy:!1}),l.parent.trigger(Hi,{}),l.parent.isEdit&&l.parent.notify(xo,null),F&&l.parent.trigger("openComplete",{response:r.openOptions}),r.initLoad){var a=!0;if(l.parent.scrollSettings.enableVirtualization)for(i=0;i<d.ranges.length;i++)if(d.ranges[i].info.count-1>l.parent.viewport.bottomIndex){a=!1;break}a?l.parent.isReact?setTimeout((function(){l.parent&&l.triggerCreatedEvent()})):l.triggerCreatedEvent():l.parent.isOpen||l.parent.hideSpinner()}}}),r.initLoad||F?void 0:this.parent)},n.prototype.triggerCreatedEvent=function(){this.parent.isOpen||this.parent.hideSpinner(),this.parent.createdHandler&&(this.parent.createdHandler.observers?(this.parent.created.observers=this.parent.createdHandler.observers,this.parent.isAngular&&this.parent.createdHandler.currentObservers&&(this.parent.created.currentObservers=this.parent.createdHandler.currentObservers)):this.parent.setProperties({created:this.parent.createdHandler},!0),this.parent.createdHandler=void 0,this.parent.trigger(Ja,null),this.parent&&this.parent.notify(Ra,null)),this.parent&&this.parent.notify(Qa,null)},n.prototype.checkRowHeightChanged=function(e,t){var r={top:e.top,left:e.left,sheet:t};this.parent.notify(ss,r),e.top!==r.top&&(this.parent.scrollModule&&this.parent.scrollModule.offset.top.idx&&r.top-e.top<yl(t,this.parent.scrollModule.offset.top.idx)&&(this.parent.scrollModule.offset.top.size=r.top),e.top=r.top),e.left!==r.left&&(this.parent.scrollModule&&this.parent.scrollModule.offset.left.idx&&r.left-e.left<Nl(t,this.parent.scrollModule.offset.left.idx)&&(this.parent.scrollModule.offset.left.size=r.left),e.left=r.left)},n.prototype.checkTableWidth=function(e){if(this.parent.scrollSettings.isFinite&&!this.parent.scrollSettings.enableVirtualization&&e.colCount-1===this.parent.viewport.rightIndex){var t=Rl(e,this.parent.viewport.leftIndex+this.parent.frozenColCount(e),this.parent.viewport.rightIndex),r=this.getRowHeaderWidth(e),n=this.getScrollSize();t<this.contentPanel.getBoundingClientRect().width-r-n?(this.getContentPanel().style.width=t+"px",this.getColHeaderPanel().style.width=t+"px"):this.getContentPanel().style.width.includes("calc")||(this.getContentPanel().style.width="calc(100% - "+r+"px)",this.getColHeaderPanel().style.width="calc(100% - "+r+"px)")}},n.prototype.clearCFResult=function(e){e.conditionalFormats&&e.conditionalFormats.length&&e.conditionalFormats.forEach((function(e){delete e.result}))},n.prototype.refreshColumnContent=function(e){var r,n,i=this,a=0,o=this.parent.getActiveSheet(),s=[],l=document.createDocumentFragment(),d=document.createDocumentFragment(),h=this.parent.element.querySelector(".e-sheet-content tbody"),p=this.parent.element.querySelector(".e-column-header tbody"),c=this.parent.element.querySelector(".e-sheet-content colgroup");c=c.cloneNode(),l.appendChild(c),h=l.appendChild(h.cloneNode(!0));var u=c.cloneNode();d.appendChild(u);var f=this.parent.element.querySelector(".e-column-header thead"),g=(f=d.appendChild(f.cloneNode(!0))).querySelector("tr");g.innerText="";var m=this.parent.frozenRowCount(o),v=this.parent.frozenColCount(o);m&&(p=d.appendChild(p.cloneNode(!0)));var y=Pr(o,m-1,!1),C=this.parent.scrollSettings.enableVirtualization&&this.parent.viewport.topIndex!==Pr(o,0,!0);this.clearCFResult(o),e.cells.forEach((function(l,d){var f=t(d);if(f[0]===e.indexes[0]){var b=i.updateCol(o,f[1],u);c.appendChild(b.cloneNode()),i.cellRenderer.renderColHeader(f[1],g)}if(f[1]-v===e.indexes[1]){if(!(r=f[0]<m?p.children[a]:h.children[a]))return;r.innerText="",a++}if(r){n={colIdx:f[1],rowIdx:f[0],cell:l,address:d,row:r,pRow:r.previousSibling,first:e.skipUpdateOnFirst||f[1]!==e.indexes[1]?C&&f[0]===e.indexes[0]?"Row":"":"Column",isRefreshing:!0,mergeBorderRows:s};var x=i.cellRenderer.render(n);i.checkColMerge(f,e.indexes,x,l,o),m&&f[0]===y&&(a=0)}}));var b=function(){var t=i.getColHeaderTable();jl(t),t.appendChild(d),jl(t=i.getContentTable()),t.appendChild(l),i.parent.notify(bi,{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),rn(i.parent,s),o.conditionalFormats&&o.conditionalFormats.length&&i.parent.notify(kt,{indexes:e.indexes,isRender:!0}),i.parent.isEdit&&i.parent.notify(So,{}),i.parent.allowChart&&i.parent.notify(Ho,null),i.parent.isOpen||i.parent.hideSpinner(),vd(i.parent.getMainContent(),{busy:!1})};e.insertDelete?b():zl((function(){return b()}))},n.prototype.refreshRowContent=function(r){var n,i,a,o,s=this,l=this.colGroupWidth,d=this.parent.getActiveSheet(),h=[],p=document.createDocumentFragment(),c=document.createDocumentFragment(),u=this.parent.createElement("tbody"),f=u.cloneNode();c.appendChild(f),p.appendChild(u);var g=this.parent.frozenColCount(d),m=Pr(d,g-1,!1,"columns"),v=this.parent.scrollSettings.enableVirtualization&&this.parent.viewport.leftIndex!==Pr(d,0,!0,"columns");this.clearCFResult(d),r.cells.forEach((function(e,p){var c=t(p);c[1]!==r.indexes[1]&&n||(c[1]===r.indexes[1]&&(i=s.rowRenderer.render(c[0],!0)),g&&c[1]<g?(f.appendChild(i),n=i):(c[1]===r.indexes[1]&&f.appendChild(i),n=s.rowRenderer.render(c[0]),u.appendChild(n)),c[1]===r.indexes[1]&&(s.cellRenderer.renderRowHeader(c[0],i),l=_l(c[0]+1))),g&&(i=f.lastElementChild||i),o={rowIdx:c[0],colIdx:c[1],cell:e,address:p,lastCell:c[1]===r.indexes[3],row:n,hRow:i,pRow:n.previousSibling,pHRow:i.previousSibling,isHeightCheckNeeded:!0,first:r.skipUpdateOnFirst||c[0]!==r.indexes[0]?v&&c[1]===r.indexes[1]?"Column":"":"Row",isRefreshing:!0,mergeBorderRows:h},a=s.cellRenderer.render(o),s.checkRowMerge(c,r.indexes,a,e,d),g&&c[1]===m&&(n=null)})),this.colGroupWidth!==l&&this.updateLeftColGroup(l);var y=this.contentPanel.querySelector(".e-row-header tbody");y&&((0,e.detach)(y),this.getRowHeaderTable().appendChild(c));var C=this.contentPanel.querySelector(".e-sheet-content tbody");C&&((0,e.detach)(C),this.getContentTable().appendChild(p)),this.parent.notify(bi,{refresh:"Row",prevRowColCnt:r.prevRowColCnt}),rn(this.parent,h),d.conditionalFormats&&d.conditionalFormats.length&&this.parent.notify(kt,{indexes:r.indexes,isRender:!0}),this.parent.allowChart&&this.parent.notify(Ho,{}),this.parent.isEdit&&this.parent.notify(So,null),this.parent.isOpen||this.parent.hideSpinner(),vd(this.parent.getMainContent(),{busy:!1})},n.prototype.updateCol=function(t,r,n){var i=this.col.cloneNode();if(i.style.width=(0,e.formatUnit)(Nl(t,r,null,!0)),n){var a=n.querySelector(".e-empty");return a?n.insertBefore(i,a):n.appendChild(i)}return i},n.prototype.updateColContent=function(r){var n=this;zl((function(){var i,a,o,s,l,d,h=0,p=n.parent.getActiveSheet(),c=[],u=n.parent.element.querySelector(".e-column-header .e-header-row"),f=n.parent.element.querySelector(".e-sheet-content colgroup"),g=n.parent.element.querySelector(".e-column-header colgroup"),m=u.firstElementChild,v=f.firstElementChild,y=g.firstElementChild,C=n.parent.element.querySelector(".e-sheet-content tbody"),b=n.parent.element.querySelector(".e-column-header tbody"),x=n.parent.frozenRowCount(p),S=n.parent.frozenColCount(p),w=Pr(p,x-1,!1),I=Pr(p,r.indexes[0],!0);n.clearCFResult(p),r.cells.forEach((function(E,N){if(!l){var R=t(N);if("first"===r.direction&&R[1]===r.indexes[1]&&n.checkColMerge([R[0],n.parent.viewport.leftIndex+S],r.indexes,((R[0]<x?b:C).rows[h]||{cells:[]}).cells[r.indexes[3]-r.indexes[1]+1],zn(R[0],n.parent.viewport.leftIndex+S,p)||{},p),R[0]===I&&("last"===r.direction?((s=n.col.cloneNode()).style.width=(0,e.formatUnit)(Nl(p,R[1],null,!0)),f.insertBefore(s,v),g.insertBefore(s.cloneNode(),y),n.cellRenderer.renderColHeader(R[1],u,m)):(s=n.updateCol(p,R[1],f),g.appendChild(s.cloneNode()),n.cellRenderer.renderColHeader(R[1],u)),n.parent.scrollSettings.enableVirtualization&&r.direction&&((0,e.detach)(f[r.direction+"ElementChild"]),(0,e.detach)(g[r.direction+"ElementChild"]),(0,e.detach)(u[r.direction+"ElementChild"]))),R[1]===r.indexes[1]){if(R[0]<x)i=b.children[h];else if(!(i=C.children[h]))return void(l=!0);h++,a=i.firstElementChild}d={colIdx:R[1],rowIdx:R[0],cell:E,address:N,row:i,pRow:i.previousSibling,lastCell:R[1]===r.indexes[3],isHeightCheckNeeded:"first"===r.direction,first:"last"!==r.direction||r.skipUpdateOnFirst||R[1]!==r.indexes[1]?"":"Column",checkNextBorder:"last"===r.direction&&R[3]===r.indexes[3]?"Column":"",isRefreshing:"first"===r.direction,mergeBorderRows:c},"last"===r.direction?(d.refChild=a,o=n.cellRenderer.render(d),n.checkColMerge(R,r.indexes,o,E,p,((R[0]<x?b:C).rows[h-1]||{cells:[]}).cells[1])):o=n.cellRenderer.render(d),n.parent.scrollSettings.enableVirtualization&&r.direction&&(0,e.detach)(i[r.direction+"ElementChild"]),x&&R[0]===w&&(h=0)}})),n.parent.notify(bi,{refresh:"Column",prevRowColCnt:r.prevRowColCnt}),rn(n.parent,c),p.conditionalFormats&&p.conditionalFormats.length&&n.parent.notify(kt,{indexes:r.indexes,isRender:!0}),n.parent.allowChart&&n.parent.notify(Ho,null),n.parent.isEdit&&n.parent.notify(So,{}),n.parent.isOpen||n.parent.hideSpinner(),vd(n.parent.getMainContent(),{busy:!1})}))},n.prototype.updateRowContent=function(r){var n=this,i=this.parent.getMainContent();if(""!==r.direction||i.children.length){var a,o,s,l,d,h=[],p=0,c=this.colGroupWidth,u=this.parent.getActiveSheet(),f=i.querySelector("tbody"),g=this.parent.getRowHeaderContent().querySelector("tbody"),m=document.createDocumentFragment(),v=document.createDocumentFragment();this.parent.showSpinner();var y=this.parent.frozenColCount(u),C=this.parent.frozenRowCount(u),b=Pr(u,r.indexes[1],!0,"columns"),x=Pr(u,y-1,!1,"columns");this.clearCFResult(u),r.cells.forEach((function(i,S){var w,I,E=t(S);"first"===r.direction&&E[0]===r.indexes[0]&&(w=g.rows[g.rows.length-1],I=f.rows[f.rows.length-1],void 0===l&&(l=(E[1]<y?g:f).rows[r.indexes[2]-r.indexes[0]+1]||null),n.checkRowMerge([n.parent.viewport.topIndex+C,E[1]],r.indexes,(l||{cells:[]}).cells[E[1]<y?p+1:p],zn(n.parent.viewport.topIndex+C,E[1],u)||{},u)),E[1]!==b&&a||(E[1]===b&&(o=n.rowRenderer.render(E[0],!0)),y&&E[1]<y?(m.appendChild(o),a=o):(a=n.rowRenderer.render(E[0]),v.appendChild(a),E[1]===b&&m.appendChild(o),n.parent.scrollSettings.enableVirtualization&&r.direction&&(0,e.detach)(f[r.direction+"ElementChild"])),E[1]===b&&(n.cellRenderer.renderRowHeader(E[0],o),c=_l(E[0]+1),n.parent.scrollSettings.enableVirtualization&&r.direction&&(0,e.detach)(g[r.direction+"ElementChild"]))),y&&(o=m.lastElementChild||o),d={colIdx:E[1],rowIdx:E[2],cell:i,address:S,row:a,lastCell:E[1]===r.indexes[3],pHRow:o.previousSibling||w,checkNextBorder:"last"===r.direction&&E[2]===r.indexes[2]?"Row":"",pRow:a.previousSibling||I,isHeightCheckNeeded:"first"===r.direction||""===r.direction,hRow:o,first:"last"!==r.direction||r.skipUpdateOnFirst||E[0]!==r.indexes[0]?"":"Row",isRefreshing:"first"===r.direction,mergeBorderRows:h},s=n.cellRenderer.render(d),"last"===r.direction&&f.rows.length&&n.checkRowMerge(E,r.indexes,s,i,u,(E[1]<y?g:f).rows[0].cells[E[1]<y?p+1:p]),p++,y&&E[1]===x&&(a=null,l=void 0,p=0)})),this.colGroupWidth!==c&&this.updateLeftColGroup(c),"last"===r.direction?(g.insertBefore(m,g.firstElementChild),f.insertBefore(v,f.firstElementChild)):(g.appendChild(m),f.appendChild(v)),this.parent.scrollSettings.enableVirtualization&&this.parent.notify(bi,{refresh:"Row",prevRowColCnt:r.prevRowColCnt}),rn(this.parent,h),u.conditionalFormats&&u.conditionalFormats.length&&this.parent.notify(kt,{indexes:r.indexes,isRender:!0}),this.parent.isEdit&&this.parent.notify(So,null),this.parent.allowChart&&this.parent.notify(Ho,{}),this.parent.isOpen||this.parent.hideSpinner(),vd(this.parent.getMainContent(),{busy:!1})}},n.prototype.checkRowMerge=function(t,r,n,i,a,o){if(this.parent.scrollSettings.enableVirtualization&&n&&(!(0,e.isNullOrUndefined)(i.rowSpan)||!(0,e.isNullOrUndefined)(i.colSpan))){var s=this.parent.frozenRowCount(a),l=this.parent.viewport.topIndex+s;if(t[0]===l){if(i.rowSpan<0){var d={td:n,rowIdx:t[0],colIdx:t[1],isRow:!0,isFreezePane:!0};if(this.parent.notify(lo,d),d.insideFreezePane)return;l>=r[2]&&this.refreshPrevMerge(r[2]+1,t[1])}o&&this.refreshFirstCell(t[0]+(r[2]-r[0])+1,t[1],a,o)}else if(i.rowSpan>1){var h=r[2]+1;t[0]+i.rowSpan-1>=h&&t[0]<h&&this.refreshPrevMerge(h,t[1],l)}}},n.prototype.refreshPrevMerge=function(e,t,r){var n=this.parent.getCell(e,t,this.parent.getRow(r||0,null,t));n&&this.cellRenderer.refresh(e,t,null,n)},n.prototype.refreshFirstCell=function(e,t,r,n){var i=zn(e,t,r,!1,!0);(i.rowSpan<0||i.colSpan<0)&&this.cellRenderer.refresh(e,t,null,n)},n.prototype.checkColMerge=function(t,r,n,i,a,o){if(this.parent.scrollSettings.enableVirtualization&&n&&(!(0,e.isNullOrUndefined)(i.rowSpan)||!(0,e.isNullOrUndefined)(i.colSpan))){var s=this.parent.frozenColCount(a),l=this.parent.viewport.leftIndex+s;if(t[1]===l){if(i.colSpan<0){var d={td:n,colIdx:t[1],rowIdx:t[0],isFreezePane:!0};if(this.parent.notify(lo,d),d.insideFreezePane)return;if(l>=r[3])(h=this.parent.getCell(t[0],t[3]+1,this.parent.getRow(t[0],null,t[3]+1)))&&this.cellRenderer.refresh(t[0],r[3]+1,null,h)}o&&this.refreshFirstCell(t[0],t[1]+(r[3]-r[1])+1,a,o)}else if(i.colSpan>1){var h;if(t[1]+i.colSpan-1>=r[3]+1&&t[1]<r[3]+1)(h=this.parent.getCell(t[0],t[3]+1,this.parent.getRow(t[0],null,t[3]+1)))&&this.cellRenderer.refresh(t[0],r[3]+1,null,h)}}},n.prototype.toggleGridlines=function(){var e=document.getElementById(this.parent.element.id+"_sheet");this.parent.getActiveSheet().showGridLines?e.classList.remove("e-hide-gridlines"):e.classList.add("e-hide-gridlines")},n.prototype.showHideHeaders=function(){var e=this,t=this.parent.getActiveSheet();zl((function(){if(t.showHeaders){var r=e.getContentPanel();e.setPanelWidth(t,e.getRowHeaderPanel()),e.setPanelHeight(t),document.getElementById(e.parent.element.id+"_sheet").classList.remove("e-hide-headers"),e.getColHeaderPanel().scrollLeft=r.scrollLeft,e.parent.selectRange(t.selectedRange)}else e.updateHideHeaders(t,document.getElementById(e.parent.element.id+"_sheet")),e.setPanelHeight(t),e.parent.frozenColCount(t)||e.parent.frozenRowCount(t)?(e.setPanelWidth(t,e.getRowHeaderPanel()),e.parent.selectRange(t.selectedRange)):(e.getContentPanel().style.width="",e.getContentPanel().style[e.parent.enableRtl?"right":"left"]=""),e.getScrollElement().style.left=e.getRowHeaderWidth(t)+"px"}))},n.prototype.updateHideHeaders=function(e,t){e.showHeaders||t.classList.add("e-hide-headers")},n.prototype.rowHeightChanged=function(e){if(e.threshold||e.isHideShow){var t=this.parent.getActiveSheet();e.rowIdx<this.parent.frozenRowCount(t)&&this.setPanelHeight(t)}},n.prototype.colWidthChanged=function(e){if(e.threshold||e.isHideShow){var t=this.parent.getActiveSheet();e.colIdx<this.parent.frozenColCount(t)&&this.setPanelWidth(t,this.getRowHeaderPanel()),this.checkTableWidth(t)}},n.prototype.getRowHeaderWidth=function(e,t,n){var i=0,a=n?this.parent.viewport.scaleX:1;if(!t&&e.frozenColumns){var o=r(e.topLeftCell)[1];i=Rl(e,o,o+e.frozenColumns-1,!0)/a}return i+=e.showHeaders?gd(this.colGroupWidth)/a:0},n.prototype.getColHeaderHeight=function(e,t){var n=r(e.topLeftCell)[0];return(e.showHeaders&&!t?gd(31):0)+bl(e,n,n+e.frozenRows-1,!0)},n.prototype.getSelectAllContent=function(){return this.headerPanel.getElementsByClassName("e-selectall-container")[0]},n.prototype.getScrollElement=function(){var e;return this.contentPanel&&(e=this.contentPanel.parentElement||this.contentPanel.nextElementSibling),e&&e.querySelector(".e-scroller")},n.prototype.getSelectAllTable=function(){return this.headerPanel.getElementsByClassName("e-selectall-table")[0]},n.prototype.getColHeaderTable=function(){return this.headerPanel.getElementsByClassName("e-colhdr-table")[0]},n.prototype.getRowHeaderTable=function(){return this.contentPanel.getElementsByClassName("e-rowhdr-table")[0]},n.prototype.getContentTable=function(){return this.contentPanel.getElementsByClassName("e-content-table")[0]},n.prototype.getRowHeaderPanel=function(){return this.contentPanel.getElementsByClassName("e-row-header")[0]},n.prototype.getColHeaderPanel=function(){return this.headerPanel.getElementsByClassName("e-column-header")[0]},n.prototype.getContentPanel=function(){return this.contentPanel.getElementsByClassName("e-sheet-content")[0]},n.prototype.addEventListener=function(){this.parent.on(Ja,this.triggerCreatedEvent,this),this.parent.on(Ji,this.rowHeightChanged,this),this.parent.on(Qi,this.colWidthChanged,this),this.parent.on(oi,this.removeEventListener,this)},n.prototype.destroy=function(){this.headerPanel&&(jl(this.headerPanel),this.headerPanel.remove()),this.headerPanel=null,this.contentPanel&&(jl(this.contentPanel),this.contentPanel.remove()),this.contentPanel=null,this.col&&(jl(this.col),this.col.remove()),this.col=null,this.rowRenderer=null,this.cellRenderer=null,this.colGroupWidth=null,this.parent=null},n.prototype.removeEventListener=function(){this.parent.off(Ja,this.triggerCreatedEvent),this.parent.off(Ji,this.rowHeightChanged),this.parent.off(Qi,this.colWidthChanged),this.parent.off(oi,this.removeEventListener)},n}(),th=function(){function t(e){this.parent=e,this.element=this.parent.createElement("tr"),this.cellRenderer=e.serviceLocator.getService("cell"),this.parent.on(ta,this.initProps,this)}return t.prototype.render=function(t,r,n){var i=this.element.cloneNode(),a=this.parent.getActiveSheet();if(void 0===t)return i.classList.add("e-header-row"),i;if(i.classList.add("e-row"),!this.bottomBorderWidth){var o=1;if(window.devicePixelRatio%1>0){var s=1*window.devicePixelRatio%1;o=1+(s?(s>.5?1-s:-1*s)/window.devicePixelRatio:0)}this.bottomBorderWidth=o}var l=yl(a,t,!0),d=yl(a,t),h={height:l+"px",lineHeight:d<20?l>this.bottomBorderWidth?l-this.bottomBorderWidth+"px":"0px":""};if(Object.assign(i.style,h),(0,e.attributes)(i,{"aria-rowindex":(t+1).toString()}),r&&!n){if(d<20){o=this.bottomBorderWidth-1+4;i.style.lineHeight=l>=o?l-o+"px":l>this.bottomBorderWidth?l-this.bottomBorderWidth+"px":"0px",i.classList.contains("e-reach-fntsize")||i.classList.add("e-reach-fntsize")}ml(a,t+1)&&!ml(a,t-1)&&i.classList.add("e-hide-start"),0!==t&&ml(a,t-1)&&!ml(a,t+1)&&i.classList.add("e-hide-end")}return i},t.prototype.refresh=function(e,t,n,a,o){var s,l=this,d=this.parent.getActiveSheet();if(a)s=this.render(e,a,o),this.cellRenderer.renderRowHeader(e,s);else{var h,p,c=function(){for(;h<=p;)Al(d,h)||l.cellRenderer.render({colIdx:h,rowIdx:e,cell:zn(e,h,d),address:i(e,h),lastCell:h===p,row:s,hRow:n,isHeightCheckNeeded:!0,pRow:t,first:e===l.parent.viewport.topIndex&&Pr(d,e,!0)!==Pr(d,0,!0)?"Row":"",skipFormatCheck:Kr(l.parent),checkCF:!0}),h++},u=this.parent.frozenColCount(d);u&&(s=n,h=r(d.topLeftCell)[0],p=u-1,c()),s=this.render(e,a,o),h=this.parent.viewport.leftIndex+u,p=this.parent.viewport.rightIndex,c()}return s},t.prototype.initProps=function(){this.bottomBorderWidth=null},t.prototype.destroy=function(){this.parent.off(ta,this.initProps),this.element&&this.element.remove(),this.bottomBorderWidth&&(this.bottomBorderWidth=null),this.parent=null,this.element=null},t}(),rh=function(){function n(e){this.parent=e,this.element=this.parent.createElement("td"),this.th=this.parent.createElement("th",{className:"e-header-cell"}),this.tableRow=e.createElement("tr",{className:"e-row"}),this.parent.on(tr,this.updateView,this),this.parent.on(ne,this.calculateFormula,this)}return n.prototype.renderColHeader=function(t,r,n){var i=this.th.cloneNode(),a=o(t+1);i.innerText=a;var s=this.parent.getActiveSheet();Al(s,t+1)&&i.classList.add("e-hide-start"),0!==t&&Al(s,t-1)&&i.classList.add("e-hide-end"),n?r.insertBefore(i,n):r.appendChild(i),this.parent.trigger("beforeCellRender",{cell:null,element:i,address:a,colIndex:t}),this.parent.notify(ka,{td:i,rowIndex:0,colIndex:t}),(0,e.attributes)(i,{"aria-colindex":(t+1).toString(),tabindex:"-1"})},n.prototype.renderRowHeader=function(t,r,n){var i=this.element.cloneNode();(0,e.addClass)([i],"e-header-cell"),(0,e.attributes)(i,{role:"rowheader",tabindex:"-1"}),i.innerText=(t+1).toString(),n?r.insertBefore(i,n):r.appendChild(i),this.parent.trigger("beforeCellRender",{cell:null,element:i,address:""+(t+1),rowIndex:t})},n.prototype.render=function(t){var r=this.parent.getActiveSheet();if(t.td=this.element.cloneNode(),t.td.className="e-cell",(0,e.attributes)(t.td,{"aria-colindex":(t.colIdx+1).toString(),tabindex:"-1"}),this.checkMerged(t))return this.createImageAndChart(t),t.refChild?t.row.insertBefore(t.td,t.refChild):t.row.appendChild(t.td),t.td;t.isRefresh=!1,t.skipFormatCheck=Kr(this.parent);var n=this.update(t);t.checkCF&&t.cell&&r.conditionalFormats&&r.conditionalFormats.length&&this.parent.notify(kt,{indexes:[t.rowIdx,t.colIdx],cell:t.cell,ele:t.td,isRender:!0}),t.td.classList.contains("e-cell-template")||this.parent.notify(ka,{td:t.td,rowIndex:t.rowIdx,colIndex:t.colIdx}),t.refChild?t.row.insertBefore(t.td,t.refChild):t.row.appendChild(t.td);var i={cell:t.cell,element:t.td,address:t.address,rowIndex:t.rowIdx,colIndex:t.colIdx,needHeightCheck:!1,row:t.row};if(this.parent.trigger("beforeCellRender",i),!r.rows[t.rowIdx]||!r.rows[t.rowIdx].customHeight){if(i.needHeightCheck||n&&i.element&&i.element.children.length){var a=i.element.cloneNode(!0);a.style.width=Nl(r,t.colIdx,!0)+"px",this.tableRow.appendChild(a)}if(t.lastCell&&this.tableRow.childElementCount){var o=this.getRowHeightOnInit();o>yl(r,t.rowIdx)&&Ed(this.parent,r,o,t.rowIdx,t.row,t.hRow),this.tableRow.innerText=""}}return this.setWrapByValue(r,t),i.element},n.prototype.setWrapByValue=function(t,r){r.cell&&(0,e.isNullOrUndefined)(r.cell.wrap)&&r.cell.value&&r.cell.value.toString().includes("\n")&&(jn(r.rowIdx,r.colIdx,t,{wrap:!0},!0),this.parent.notify(Ge,{range:[r.rowIdx,r.colIdx,r.rowIdx,r.colIdx],wrap:!0,initial:!0,sheet:t,td:r.td,row:r.row,hRow:r.hRow}))},n.prototype.update=function(t){var r,n=this.parent.getActiveSheet();if(!t.isRefresh||t.cell&&t.cell.template){var i=this.processTemplates(t.cell,t.rowIdx,t.colIdx);i&&("string"==typeof i?t.td.innerHTML=i:(jl(t.td),(0,e.append)(i,t.td)),t.td.classList.add("e-cell-template"),r=!0)}if(t.isRefresh){if(t.td.rowSpan&&(this.mergeFreezeRow(n,t.rowIdx,t.colIdx,t.td.rowSpan,t.row,!0),t.td.removeAttribute("rowSpan")),t.td.colSpan&&(this.mergeFreezeCol(n,t.rowIdx,t.colIdx,t.td.colSpan,!0),t.td.removeAttribute("colSpan")),this.checkMerged(t))return!1;if(t.cell&&!t.cell.hyperlink){var a=t.td.querySelector(".e-hyperlink");a&&(0,e.detach)(a)}if(t.cell&&t.td.children.length>0&&t.td.children[t.td.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1){var o=t.td.querySelector(".e-addNoteIndicator");o&&(0,e.detach)(o)}t.cell&&this.parent.allowWrap||!t.td.classList.contains("e-wraptext")||t.td.classList.remove("e-wraptext")}t.cell&&t.cell.formula&&!t.isRandomFormula&&"Automatic"===this.parent.calculationMode&&(this.calculateFormula(t),t.fillType&&"FillWithoutFormatting"===t.fillType&&delete t.cell.format,t.isRefresh||(this.isFormulaCell=!0));var s={value:t.cell&&t.cell.value,type:t.cell&&zs(t.cell.format),format:t.cell&&t.cell.format,formattedText:t.cell&&t.cell.value,isRightAlign:!1,cell:t.cell,rowIndex:t.rowIdx,colIndex:t.colIdx,td:t.td,skipFormatCheck:t.skipFormatCheck,refresh:!0};"Manual"===this.parent.calculationMode&&t.cell&&!t.cell.value&&""!==t.cell.value&&t.cell.formula&&(s.value=0,t.cell.value="0"),t.cell&&this.parent.notify(re,s),this.parent.refreshNode(t.td,s);var l,d,h={};if(t.cell){if(t.cell.style&&(h=t.cell.style.properties?_n(t.cell.style,!0):t.cell.style),void 0!==s.color&&((h=Object.assign({},h)).color=s.color),this.createImageAndChart(t),t.cell.hyperlink&&("FillFormattingOnly"===t.fillType?(t.td.style.textDecoration="underline",t.td.style.color="#00e"):this.parent.notify(ba,{cell:t.cell,style:h,td:t.td,rowIdx:t.rowIdx,colIdx:t.colIdx,fillType:t.fillType,action:t.action})),t.cell.rowSpan>1){var p=t.rowSpan||t.cell.rowSpan-this.parent.hiddenCount(t.rowIdx,t.rowIdx+(t.cell.rowSpan-1));p>1&&(t.td.rowSpan=p,this.mergeFreezeRow(n,t.rowIdx,t.colIdx,p,t.row))}if(t.cell.colSpan>1){var c=t.colSpan||t.cell.colSpan-this.parent.hiddenCount(t.colIdx,t.colIdx+(t.cell.colSpan-1),"columns");c>1&&(t.td.colSpan=c,this.mergeFreezeCol(n,t.rowIdx,t.colIdx,c))}(0,e.isNullOrUndefined)(t.cell.notes)||t.fillType?!(0,e.isNullOrUndefined)(t.td)&&t.td.children.length>0&&t.td.children[t.td.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1&&this.parent.notify(fa,{rowIndex:t.rowIdx,columnIndex:t.colIdx}):this.parent.notify(ma,{targetElement:t.td,rowIndex:t.rowIdx,columnIndex:t.colIdx}),t.cell.isNoteEditable&&this.parent.notify(ga,{rowIndex:t.rowIdx,columnIndex:t.colIdx,isNoteEditable:!0,isScrollWithNote:!0,cellElement:t.td})}if(t.isRefresh&&(0,e.isNullOrUndefined)(t.cell)&&!(0,e.isNullOrUndefined)(t.td)&&t.td.children.length>0&&t.td.children[t.td.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1&&this.parent.notify(fa,{rowIndex:t.rowIdx,columnIndex:t.colIdx}),t.isRefresh&&this.removeStyle(t.td,t.rowIdx,t.colIdx),t.lastCell&&(this.isFormulaCell||t.isRefresh)&&this.parent.chartColl&&this.parent.chartColl.length&&(this.parent.notify(Bt,{cell:t.cell,rIdx:t.rowIdx,cIdx:t.colIdx,sheetIdx:this.parent.activeSheetIndex,isSelectAll:t.isSelectAll}),t.isRefresh||(this.isFormulaCell=!1)),this.applyStyle(t,h),"Row"===t.checkNextBorder){var u=this.parent.getCellStyleValue(["borderTop"],[Number(this.parent.getContentTable().rows[0].getAttribute("aria-rowindex"))-1,t.colIdx]).borderTop;""===u||t.cell&&t.cell.style&&t.cell.style.bottomPriority||(t.style={borderBottom:u},this.parent.notify(le,t))}if("Column"===t.checkNextBorder){var f=this.parent.getCellStyleValue(["borderLeft"],[t.rowIdx,t.colIdx+1]).borderLeft;""===f||t.cell&&t.cell.style&&(t.cell.style.borderRight||t.cell.style.border)||(t.style={borderRight:f},this.parent.notify(le,t))}return t.cell&&!(0,e.isNullOrUndefined)(t.cell.wrap)&&this.parent.notify(Ge,{range:[t.rowIdx,t.colIdx,t.rowIdx,t.colIdx],wrap:t.cell.wrap,sheet:n,initial:!0,td:t.td,row:t.row,hRow:t.hRow,isCustomHgt:!t.isRefresh&&yl(n,t.rowIdx)>(n&&n.standardHeight?n.standardHeight:20)}),t.cell&&t.cell.validation?(l=t.cell.validation,d=n.columns&&n.columns[t.colIdx]):l=kl(n.columns&&n.columns[t.colIdx],t.rowIdx,t.colIdx)&&n.columns[t.colIdx].validation,l&&(l.isHighlighted&&(t.validation=l,t.col=d,this.parent.notify(_t,t)),"List"!==l.type||t.isRefresh||t.address!==n.activeCell||(t.validation=l,this.parent.notify(vr,t))),r},n.prototype.applyStyle=function(t,r){(Object.keys(r).length||Object.keys(this.parent.commonCellStyle).length||t.lastCell)&&(t.style=(0,e.extend)({},this.parent.commonCellStyle,r),this.parent.notify(le,t))},n.prototype.createImageAndChart=function(e){if(e.cell.chart&&e.cell.chart.length>0&&this.parent.notify(Lt,{chart:e.cell.chart,isInitCell:!0,range:i(e.rowIdx,e.colIdx),isUndoRedo:!1}),e.cell.image&&e.cell.image.length>0)for(var t=0;t<e.cell.image.length;t++)e.cell.image[t]&&this.parent.notify(Ao,{options:{src:e.cell.image[t].src,id:e.cell.image[t].id,height:e.cell.image[t].height,width:e.cell.image[t].width,top:e.cell.image[t].top,left:e.cell.image[t].left,preservePos:e.cell.image[t].preservePos},range:a([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]),isPublic:!1})},n.prototype.calculateFormula=function(t){if(void 0!==t.cell.value&&null!==t.cell.value){var r={action:"checkFormulaAdded",added:!0,address:t.address,sheetId:(void 0===t.sheetIndex?this.parent.getActiveSheet():Fn(this.parent,t.sheetIndex)).id.toString()};if(this.parent.notify(pe,r),r.added)return}else t.formulaRefresh&&(t.cell.value="");var n=wr(t.cell.formula),i={action:"refreshCalculate",value:t.cell.formula,rowIndex:t.rowIdx,colIndex:t.colIdx,isFormula:n,sheetIndex:t.sheetIndex,isRefreshing:t.isRefreshing,isDependentRefresh:t.isDependentRefresh,isRandomFormula:t.isRandomFormula,fillType:t.fillType};("Automatic"===this.parent.calculationMode||t.isSortAction||"calculate"===t.action||t.isDependentRefresh)&&this.parent.notify(pe,i),(void 0===t.cell.value&&"Manual"===this.parent.calculationMode&&!this.parent.getActiveSheet().isSheetCalculated||this.parent.isEdit&&"#CIRCULARREF!"===t.cell.value)&&(t.cell.value="0"),t.cell.value=zn(t.rowIdx,t.colIdx,(0,e.isNullOrUndefined)(t.sheetIndex)?this.parent.getActiveSheet():Fn(this.parent,t.sheetIndex)).value,n&&(t.cell.formula.indexOf("^+")>-1||t.cell.formula.indexOf("&+")>-1)&&(t.cell.formula=i.value)},n.prototype.checkMerged=function(e){if(e.cell&&(e.cell.colSpan<0||e.cell.rowSpan<0)){var t=this.parent.getActiveSheet();if(t.frozenRows||t.frozenColumns){var r={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(Et,r);var n=this.parent.frozenRowCount(t),i=this.parent.frozenColCount(t);r.range=r.range,(t.frozenRows&&t.frozenColumns?r.range[0]<n&&r.range[1]<i?e.rowIdx<n&&e.colIdx<i:r.range[0]<n?e.rowIdx<n:!(r.range[1]<i)||e.colIdx<i:n?r.range[0]>=n||e.rowIdx<n:r.range[1]>=i||e.colIdx<i)&&(e.td.style.display="none")}else e.td.style.display="none";e.isMerged=!0;var a=e.cell.rowSpan,o=e.cell.colSpan;return(o<0||a<0)&&(this.parent.notify(so,e),o<0&&e.cell.style&&e.cell.style.borderTop&&this.applyStyle(e,{borderTop:e.cell.style.borderTop}),a<0&&e.cell.style&&e.cell.style.borderLeft&&this.applyStyle(e,{borderLeft:e.cell.style.borderLeft})),e.isMerged}return!1},n.prototype.mergeFreezeRow=function(t,n,i,a,o,s){var l=this.parent.frozenRowCount(t);if(l&&n<l&&n+(a-1)>=l){var d=void 0,h=0,p=void 0,c=this.parent.frozenColCount(t),u=o||this.parent.getRow(n,null,i),f=[].slice.call(u.parentElement.querySelectorAll(".e-empty"));if(s){var g=n+a-l;if(g<f.length)return;var m=0;if(g===f.length){var v=void 0,y=void 0,C=void 0;for(c&&i<c?(y=r(t.topLeftCell)[1],C=c):(y=this.parent.viewport.leftIndex+c,C=this.parent.viewport.rightIndex);y<C;y++)y!==i&&(v=zn(n,y,t,!1,!0)).rowSpan&&n+v.rowSpan-l>m&&(m=n+v.rowSpan-l);if(m===g)return}else m=g;var b=n+(a-1);for(y=m,C=f.length;y<C;y++)h+=yl(t,b),b--,(0,e.detach)(f.pop());return this.updateSpanTop(i,c,h,!0),void(f.length||this.updateColZIndex(i,c,!0))}this.updateColZIndex(i,c);for(y=l,C=n+(a-1);y<=C;y++)h+=-(p=yl(t,Pr(t,y,!0),!0)),l+f.length>y||((d=u.cloneNode()).classList.add("e-empty"),d.style.visibility="hidden",d.style.height=p+"px",u.parentElement.appendChild(d));this.updateSpanTop(i,c,h)}},n.prototype.updateSpanTop=function(e,t,r,n){var i=this.parent.serviceLocator.getService("sheet").contentPanel;if(n){if(!parseInt(i.style.top,10))return;r=parseInt(i.style.top,10)+r}if(t&&e<t&&(n||!parseInt(i.style.top,10)||r<parseInt(i.style.top,10))){i.style.top=r+"px";var a=i.nextElementSibling;a&&(a.style.top=r+"px")}},n.prototype.mergeFreezeCol=function(t,n,i,a,o){var s=this.parent.frozenColCount(t);if(s&&i<s&&i+(a-1)>=s){var l=void 0,d=void 0,h=this.parent.frozenRowCount(t),p=(n<h?this.parent.getSelectAllContent():this.parent.getRowHeaderContent()).querySelector("colgroup"),c=[].slice.call(p.querySelectorAll(".e-empty"));if(o){var u=i+a-s;if(u<c.length)return;var f=0;if(u===c.length){var g=void 0,m=void 0,v=void 0;for(h&&n<h?(m=h,v=r(t.topLeftCell)[0]):(m=this.parent.viewport.bottomIndex,v=this.parent.viewport.topIndex+h);v<m;v++)v!==n&&(g=zn(v,i,t,!1,!0)).colSpan&&i+g.colSpan-s>f&&(f=i+g.colSpan-s);if(f===u)return}else f=u;for(v=f,m=c.length;v<m;v++)(0,e.detach)(c.pop());return this.parent.serviceLocator.getService("sheet").setPanelWidth(t,this.parent.getRowHeaderContent()),void(c.length||this.updateRowZIndex(n,h,!0))}this.updateRowZIndex(n,h);for(v=s,m=i+(a-1);v<=m;v++)s+c.length>v||((l=p.childNodes[0].cloneNode()).classList.add("e-empty"),l.style.visibility="hidden",d=Nl(t,Pr(t,v,!0,"columns"),null,!0),l.style.width=d+"px",p.appendChild(l),v===m&&this.parent.serviceLocator.getService("sheet").setPanelWidth(t,this.parent.getRowHeaderContent()))}},n.prototype.updateColZIndex=function(e,t,r){e<t?this.updateSelectAllZIndex(r):(this.parent.getColumnHeaderContent().style.zIndex=r?"":"2",this.updatedHeaderZIndex(r))},n.prototype.updateSelectAllZIndex=function(e){var t=this.parent.element.querySelector(".e-frozen-row"),r=this.parent.element.querySelector(".e-frozen-column");if(e)this.parent.getSelectAllContent().style.zIndex="",t&&(t.style.zIndex=""),r&&(r.style.zIndex="");else{var n=this.parent.getRowHeaderContent(),i=this.parent.getColumnHeaderContent();if(n.style.zIndex||i.style.zIndex){this.parent.getSelectAllContent().style.zIndex="3",t&&(t.style.zIndex="4"),r&&(r.style.zIndex="4");var a=n.querySelector(".e-selection");a&&(a.style.zIndex="3");var o=i.querySelector(".e-selection");o&&(o.style.zIndex="3")}else this.parent.getSelectAllContent().style.zIndex="2"}},n.prototype.updatedHeaderZIndex=function(e){if(!e&&"2"===this.parent.getSelectAllContent().style.zIndex){this.parent.getSelectAllContent().style.zIndex="3";var t=this.parent.element.querySelector(".e-frozen-row"),r=this.parent.element.querySelector(".e-frozen-column");r&&(r.style.zIndex="4"),t&&(t.style.zIndex="4");var n=this.parent.getRowHeaderContent().querySelector(".e-selection");n&&(n.style.zIndex="3");var i=this.parent.getColumnHeaderContent().querySelector(".e-selection");i&&(i.style.zIndex="3")}},n.prototype.updateRowZIndex=function(e,t,r){e<t?this.updateSelectAllZIndex(r):(this.parent.getRowHeaderContent().style.zIndex=r?"":"2",this.updatedHeaderZIndex(r))},n.prototype.processTemplates=function(e,r,n){for(var i,a=this.parent.getActiveSheet(),o=a.ranges,s=0,l=o.length;s<l;s++)if(o[s].template&&(i=t(o[s].address.length?o[s].address:o[s].startCell))[0]<=r&&i[1]<=n&&i[2]>=r&&i[3]>=n){if(e)return this.compileCellTemplate(o[s].template,Object.assign({rowIndex:r,colIndex:n},e));if(!zn(r,n,a,!0))return this.compileCellTemplate(o[s].template,Object.assign({rowIndex:r,colIndex:n},zn(r,n,a,null,!0)))}return""},n.prototype.compileCellTemplate=function(t,r){var n;if("string"==typeof t){var i=void 0;return i=0===t.trim().indexOf("#")?document.querySelector(t).innerHTML.trim():t,n=(0,e.compile)(i),!this.parent.isVue||this.isSelector(t)?n(r,this.parent,"ranges","",!0)[0].outerHTML:n(r,this.parent,"ranges","")}var a=(n=(0,e.compile)(t))(r,this.parent,"ranges","");return a[0]?a:[a]},n.prototype.isSelector=function(e){try{return!!document.querySelector(e)}catch(e){return!1}},n.prototype.getRowHeightOnInit=function(){var e=this.parent.createElement("table",{className:"e-table e-test-table"});e.appendChild(this.parent.createElement("tbody")).appendChild(this.tableRow),this.parent.element.appendChild(e);var t=this.tableRow.getBoundingClientRect().height;return this.parent.element.removeChild(e),t<20?20:t},n.prototype.removeStyle=function(e,t,r){var n;if(e.style.length){var i=(n=this.parent.getCellStyleValue(["borderLeft","border"],[t,r+1])).borderLeft||n.border,a=(n=this.parent.getCellStyleValue(["borderTop","border"],[t+1,r])).borderTop||n.border;i||a?[].slice.call(e.style).forEach((function(t){i&&a?t.includes("border-right")||t.includes("border-bottom")||e.style.removeProperty(t):(!i||t.indexOf("border-right")>-1||a&&"none"!==a)&&(!a||t.indexOf("border-bottom")>-1||i&&"none"!==i)||e.style.removeProperty(t)})):e.removeAttribute("style")}var o=this.parent.getCell(t-1,r);if(o&&o.style.borderBottom){var s=Number(o.parentElement.getAttribute("aria-rowindex"))-1;(n=this.parent.getCellStyleValue(["borderBottom","border"],[s,r])).borderBottom||n.border||(o.style.borderBottom="")}var l=e.previousElementSibling;l&&l.style.borderRight&&(r=Number(l.getAttribute("aria-colindex"))-1,(n=this.parent.getCellStyleValue(["borderRight","border"],[t,r])).borderRight||n.border||(l.style.borderRight=""))},n.prototype.refreshRange=function(e,t,r,n,a,o,s,l,d,h,p,c){void 0===d&&(d=!0);var u,f,g=this.parent.getActiveSheet(),m=e.slice();if(Kl(this.parent,m,!0))for(var v=0,y=m[0];y<=m[2];y++)if(!ml(g,y))for(var C=m[1];C<=m[3];C++)Al(g,C)||((f=this.parent.getCell(y,C))&&(u={rowIdx:y,colIdx:C,td:f,cell:zn(y,C,g),isRefreshing:t,lastCell:C===m[3],isRefresh:!0,isHeightCheckNeeded:d,manualUpdate:!0,first:"",onActionUpdate:n,skipFormatCheck:o,isFromAutoFillOption:l,isSelectAll:p,rowHeight:c&&c[v]&&c[v].rowHeight},v++,s&&(u.address=i(y,C)),this.update(u),a&&g.conditionalFormats&&g.conditionalFormats.length&&this.parent.notify(kt,{indexes:[y,C],isAction:!0}),this.parent.notify(ka,{td:f,rowIndex:y,colIndex:C}),r&&this.setWrapByValue(g,u)),"Manual"===this.parent.calculationMode&&h&&(f?u.isSortAction=h:u={rowIdx:y,colIdx:C,td:f,cell:zn(y,C,g),isRefreshing:t,lastCell:C===m[3],isRefresh:!0,isHeightCheckNeeded:d,manualUpdate:!0,first:"",onActionUpdate:n,skipFormatCheck:o,isFromAutoFillOption:l,isSortAction:h},u.cell&&u.cell.formula&&g.isSheetCalculated&&this.calculateFormula(u)))},n.prototype.refresh=function(e,t,r,n,i,a,o,s,l){var d=this.parent.getActiveSheet();if((n||!ml(d,e)&&!Al(d,t))&&(n||!this.parent.scrollSettings.enableVirtualization||this.parent.insideViewport(e,t))){var h=n||this.parent.getCell(e,t);if(!h)return;var p={rowIdx:e,colIdx:t,td:h,cell:zn(e,t,d),isRefresh:!0,lastCell:r,isHeightCheckNeeded:!0,manualUpdate:!0,first:"",skipFormatCheck:o,isRandomFormula:s,fillType:l};this.update(p),i&&d.conditionalFormats&&d.conditionalFormats.length&&this.parent.notify(kt,{indexes:[e,t],isAction:!0}),this.parent.notify(ka,{td:h,rowIndex:e,colIndex:t}),a&&this.setWrapByValue(d,p)}},n.prototype.updateView=function(r){if((0,e.isNullOrUndefined)(r.sheetIndex)||r.sheetIndex===this.parent.activeSheetIndex){if(!r.indexes){var n=this.parent.getActiveSheet(),i=this.parent.frozenRowCount(n),a=this.parent.frozenColCount(n),o=t(n.topLeftCell);i&&a&&this.refreshRange([o[0],o[1],i-1,a-1],r.refreshing,r.checkWrap,!1,r.checkCF),i&&this.refreshRange([o[0],this.parent.viewport.leftIndex+a,i-1,this.parent.viewport.rightIndex],r.refreshing,r.checkWrap,!1,r.checkCF),a&&this.refreshRange([this.parent.viewport.topIndex+i,o[1],this.parent.viewport.bottomIndex,a-1],r.refreshing,r.checkWrap,!1,r.checkCF),r.indexes=[this.parent.viewport.topIndex+i,this.parent.viewport.leftIndex+a,this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex]}this.refreshRange(r.indexes,r.refreshing,r.checkWrap,!1,r.checkCF)}else r.refreshing&&this.calculateFormula({cell:zn(r.indexes[0],r.indexes[1],Fn(this.parent,r.sheetIndex),!0,!0),rowIdx:r.indexes[0],colIdx:r.indexes[1],sheetIndex:r.sheetIndex})},n.prototype.destroy=function(){this.parent.off(tr,this.updateView),this.parent.off(ne,this.calculateFormula),this.element&&this.element.remove(),this.element=null,this.th&&this.th.remove(),this.th=null,this.tableRow&&this.tableRow.remove(),this.tableRow=null,this.parent=null},n}(),nh=function(){function t(e){this.parent=e,this.addEventListener(),this.instantiateRenderer()}return t.prototype.render=function(){this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),this.parent.isMobileView()||(this.parent.notify(Qn,null),this.parent.notify(ei,null));var e=this.parent.createElement("div",{id:this.parent.element.id+"_sheet_panel",className:"e-sheet-panel"});this.parent.enableRtl&&e.classList.add("e-rtl"),this.parent.element.appendChild(e),this.parent.showSheetTabs?this.parent.notify(ti,null):(this.parent.notify(pe,{action:"initSheetInfo"}),this.parent.notify(pe,{action:"initiateDefinedNames"})),this.parent.isMobileView()&&(this.parent.notify(ei,null),this.parent.notify(Qn,null)),this.parent.password&&(this.parent.password.length>0||this.parent.isProtected)&&(this.parent.isProtected=!0,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"))),"None"===this.parent.selectionSettings.mode&&(this.parent.allowAutoFill=!1),this.setSheetPanelSize(),this.renderSheet(e),this.checkTopLeftCell(!this.parent.refreshing)},t.prototype.checkTopLeftCell=function(e,t,n,i,a,o){var s=this.parent.getActiveSheet();this.parent.showSpinner();var l,d="A1"===s.topLeftCell,h=r(s.topLeftCell);if(s.topLeftCell!==s.paneTopLeftCell&&(s.frozenRows||s.frozenColumns)){var p=r(s.paneTopLeftCell);l=this.parent.scrollSettings.enableVirtualization,d=s.frozenRows&&s.frozenColumns?h[0]+s.frozenRows===p[0]&&h[1]+s.frozenColumns===p[1]:s.frozenRows?h[0]+s.frozenRows===p[0]&&0===h[1]:h[1]+s.frozenColumns===p[1]&&0===h[0],h[0]&&p[0]>h[0]?this.parent.viewport.beforeFreezeHeight=bl(s,0,h[0]-1,!0):this.parent.viewport.beforeFreezeHeight=0,h[1]&&p[1]>h[1]?this.parent.viewport.beforeFreezeWidth=Rl(s,0,h[1]-1,!0):this.parent.viewport.beforeFreezeWidth=0}else this.parent.viewport.beforeFreezeHeight=this.parent.viewport.beforeFreezeWidth=0;var c=this.parent.frozenRowCount(s),u=this.parent.frozenColCount(s);if(!this.parent.scrollSettings.enableVirtualization||d)this.refreshUI({rowIndex:h[0],colIndex:h[1],refresh:"All"},null,e,t,a,o),l&&(this.parent.viewport.topIndex=Pr(s,c,!0)-c,this.parent.viewport.leftIndex=Pr(s,u,!0,"columns")-u);else{var f=s.paneTopLeftCell===s.topLeftCell?h:r(s.paneTopLeftCell),g={preventScroll:!0};g.scrollTop=n||(f[0]>c?bl(s,c,f[0]-1,!0):0),g.scrollLeft=i||(f[1]>u?Rl(s,u,f[1]-1,!0):0),this.parent.notify(ea,g);var m=this.parent.getThreshold("row"),v=s.frozenRows?h[0]:h[0]>m?Pr(s,h[0]-m,!0):0,y=[];s.frozenRows&&y.push(f[0]-m>c?f[0]-m:c),m=this.parent.getThreshold("col");var C=s.frozenColumns?h[1]:h[1]>m?Pr(s,h[1]-m,!0,"columns"):0;s.frozenColumns?(y.length||y.push(c),y.push(f[1]-m>u?f[1]-m:u)):y.length&&y.push(u),this.refreshUI({rowIndex:v,colIndex:C,refresh:"All",top:g.scrollTop,left:g.scrollLeft,frozenIndexes:y},null,e,t,a,o),l&&(c&&y[0]>=c&&(this.parent.viewport.topIndex=Pr(s,y[0],!0)-c),u&&y[1]>=u&&(this.parent.viewport.leftIndex=Pr(s,y[1],!0,"columns")-u))}},t.prototype.renderSheet=function(e){void 0===e&&(e=document.getElementById(this.parent.element.id+"_sheet_panel")),e.appendChild(this.parent.createElement("div",{className:"e-sheet",id:this.parent.element.id+"_sheet",styles:"background-color: #fff"})),this.parent.serviceLocator.getService("sheet").renderPanel()},t.prototype.refreshUI=function(t,n,a,o,s,l){var d=this;"All"!==t.refresh&&this.parent.showSpinner();var h=this.parent.serviceLocator.getService("sheet"),p=this.parent.getActiveSheet(),c=Pn(this.parent),u={rowCount:p.rowCount,colCount:p.colCount};if(t.frozenIndexes=t.frozenIndexes?t.frozenIndexes:[],!n)if(this.parent.scrollSettings.enableVirtualization){var f=t.rowIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),g=t.colIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col"),m=this.parent.frozenRowCount(p),v=this.parent.frozenColCount(p);t.frozenIndexes.length&&(f+=t.frozenIndexes[0]-m,g+=t.frozenIndexes[1]-v),"Row"===t.refresh?f+=m:f+=p.frozenRows,"Column"===t.refresh?g+=v:g+=p.frozenColumns;var y=t.frozenIndexes[0]>m?t.frozenIndexes[0]:t.rowIndex+("Row"===t.refresh?m:p.frozenRows),C=this.parent.skipHidden(y,f,"rows",!1);if(f=C[1],y!==C[0])(w=r(p.paneTopLeftCell))[0]===y&&this.parent.updateTopLeftCell(C[0]-m,w[1],"col");C[0]-=m;var b=p.rowCount-1,x=0,S=t.rowIndex;if(this.parent.scrollSettings.isFinite&&f>b)if(x=f-b,f=Pr(p,b,!1),C[0]+m>Pr(p,m,!0))E=(E=t.rowIndex-x)<0?0:E,E=this.decreaseHidden(E,t.rowIndex-1,m),t.top&&E<t.rowIndex&&this.parent.notify(os,{height:bl(p,E+m,t.rowIndex-1+m,!0),isRender:!0}),this.parent.viewport.topIndex=C[0]=E,S="Row"===t.refresh?E:S;"Row"===t.refresh?t.rowIndex=Pr(p,S+m,!0)-m:S=t.rowIndex=m?Pr(p,S,!0):C[0];var w,I=t.frozenIndexes[1]>v?t.frozenIndexes[1]:t.colIndex+("Column"===t.refresh?v:p.frozenColumns);if(g=(C=this.parent.skipHidden(I,g,"columns",!1))[1],I!==C[0])(w=r(p.paneTopLeftCell))[1]===I&&this.parent.updateTopLeftCell(w[0],C[0]-v,"row");C[0]-=v,b=p.colCount-1,x=0;var E,N=t.colIndex;if(this.parent.scrollSettings.isFinite&&g>b)if(x=g-b,g=Pr(p,b,!1,"columns"),C[0]+v>Pr(p,v,!0,"columns"))E=(E=t.colIndex-x)>-1?E:0,E=this.decreaseHidden(E,t.colIndex-1,v,"columns"),t.left&&E<t.colIndex&&this.parent.notify(os,{width:Rl(p,E+v,t.colIndex-1+v,!0),isRender:!0}),this.parent.viewport.leftIndex=C[0]=E,N="Column"===t.refresh?E:N;"Column"===t.refresh?t.colIndex=Pr(p,N+v,!0,"columns")-v:N=t.colIndex=v?Pr(p,N,!0,"columns"):C[0],"Row"===t.refresh&&(S+=m,m&&(f+=r(p.topLeftCell)[0]),g=this.parent.viewport.rightIndex),"Column"===t.refresh&&(N+=v,v&&(g+=r(p.topLeftCell)[1]),f=this.parent.viewport.bottomIndex),this.parent.viewport.topIndex=t.rowIndex,this.parent.viewport.bottomIndex=f,this.parent.viewport.leftIndex=t.colIndex,this.parent.viewport.rightIndex=g,n=i(S,N)+":"+i(f,g)}else"All"===t.refresh&&this.updateTopLeftScrollPosition((0,e.extend)(t,{sheet:p})),this.parent.viewport.bottomIndex=p.rowCount-1,this.parent.viewport.rightIndex=p.colCount-1,n=i(t.rowIndex,t.colIndex)+":"+i(this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex);"All"===t.refresh&&this.parent.trigger(Ui,{});var R=this.parent.isOpen||this.parent.refreshing;vd(this.parent.getMainContent(),{busy:!0});var A=this.parent.sheets.length;gn(this.parent,c+"!"+n,null,null,t.frozenIndexes).then((function(e){if(d.parent&&!(A<d.parent.sheets.length)){var i=En(d.parent,p.id);if(s||void 0!==i&&i===d.parent.activeSheetIndex){var c,f=[t.rowIndex,t.colIndex].concat(r(n.split(":")[1]));switch(t.refresh){case"All":h.renderTable({cells:e,indexes:f,top:t.top,left:t.left,initLoad:a,isRefreshing:o,isOpen:R,openOptions:l});break;case"Row":h.refreshRowContent({cells:e,indexes:f,skipUpdateOnFirst:t.skipUpdateOnFirst,prevRowColCnt:u}),c={isEdit:false},d.parent.notify(ni,c),c.isEdit&&d.parent.notify(si,{action:"startEdit",refreshCurPos:!1});break;case"Column":h.refreshColumnContent({cells:e,indexes:f,skipUpdateOnFirst:t.skipUpdateOnFirst,prevRowColCnt:u,insertDelete:t.insertDelete});break;case"RowPart":h.updateRowContent({cells:e,indexes:f,direction:t.direction,skipUpdateOnFirst:t.skipUpdateOnFirst,prevRowColCnt:u});break;case"ColumnPart":h.updateColContent({cells:e,indexes:f,direction:t.direction,skipUpdateOnFirst:t.skipUpdateOnFirst,prevRowColCnt:u})}d.parent&&d.parent.isReact&&d.parent.renderReactTemplates()}else i>-1&&d.checkTopLeftCell()}})),this.parent.notify(Ci,{refresh:t.refresh,skipTranslate:t.skipTranslate})},t.prototype.updateTopLeftScrollPosition=function(e){var t=r(e.sheet.topLeftCell),n=r(e.sheet.paneTopLeftCell);if(e.sheet.frozenRows){var i=this.parent.frozenRowCount(e.sheet);n[0]>i&&(e.top=bl(e.sheet,i,n[0]-1,!0))}else e.rowIndex&&(e.rowIndex=0),0!==t[0]&&(e.top=bl(e.sheet,0,t[0]-1,!0));if(e.sheet.frozenColumns){var a=this.parent.frozenColCount(e.sheet);n[1]>a&&(e.left=Rl(e.sheet,a,n[1]-1,!0))}else e.colIndex&&(e.colIndex=0),0!==t[1]&&(e.left=Rl(e.sheet,0,t[1]-1,!0))},t.prototype.removeSheet=function(){document.getElementById(this.parent.element.id+"_sheet")&&(0,e.remove)(document.getElementById(this.parent.element.id+"_sheet"))},t.prototype.refreshSheet=function(e,t,r,n,i){var a=0,o=0;if(t){var s=this.parent.element.getElementsByClassName("e-main-panel")[0];s&&(a=s.scrollTop);var l=this.parent.getMainContent();l&&(o=l.scrollLeft)}this.removeSheet(),this.renderSheet(),this.parent.notify(ta,{}),this.checkTopLeftCell(!1,e,a,o,n,i),r&&Md(this.parent.element)},t.prototype.setSheetPanelSize=function(e){var t,r=document.getElementById(this.parent.element.id+"_sheet_panel"),n=this.parent.element.getBoundingClientRect();if(this.parent.viewport.scaleY=this.parent.viewport.scaleX=1,this.parent.enableScaling){var i=this.parent.element.offsetHeight,a=i/n.height;1!==a&&Math.abs(i-n.height)>=.1*i&&(this.parent.viewport.scaleY=a);var o=this.parent.element.offsetWidth,s=o/n.width;1!==s&&Math.abs(o-n.width)>=.1*o&&(this.parent.viewport.scaleX=s)}"auto"===this.parent.height?(r.style.height="260px",t=230):(t=n.height*this.parent.viewport.scaleY-Yl(r,null,this.parent.viewport.scaleY),r.style.height=t+"px",t-=32/this.parent.viewport.scaleY),void 0!==e&&(this.colMinWidth=e),this.parent.viewport.height=t;var l=n.width*this.parent.viewport.scaleX;this.parent.viewport.width=l-32/this.parent.viewport.scaleX,this.parent.viewport.rowCount=this.roundValue(t,20),this.parent.viewport.colCount=this.roundValue(l,this.colMinWidth||64)},t.prototype.roundValue=function(e,t){var r=e/t,n=Math.round(r);return Math.abs(r-n)<.5?n:n-1},t.prototype.moveOrDuplicateSheetHandler=function(e){this.parent.notify(ri,null),e.refresh&&this.refreshSheet(e.isDuplicate)},t.prototype.decreaseHidden=function(e,t,r,n){void 0===n&&(n="rows"),e+=r,t+=r;for(var i=this.parent.getActiveSheet(),a=t;a>=e;a--)if(i[""+n][a]&&i[""+n][a].hidden&&--e<r){e=Pr(i,r,!0,n);break}return e-r},t.prototype.instantiateRenderer=function(){this.parent.serviceLocator.register("cell",new rh(this.parent)),this.parent.serviceLocator.register("row",new th(this.parent)),this.parent.serviceLocator.register("sheet",new eh(this.parent))},t.prototype.destroy=function(){this.removeEventListener(),this.parent.serviceLocator.getService("row").destroy(),this.parent.serviceLocator.getService("cell").destroy(),this.colMinWidth&&(this.colMinWidth=null),this.parent=null},t.prototype.addEventListener=function(){this.parent.on(oi,this.destroy,this),this.parent.on(Yt,this.moveOrDuplicateSheetHandler,this),this.parent.on(ss,this.updateTopLeftScrollPosition,this)},t.prototype.removeEventListener=function(){this.parent.off(oi,this.destroy),this.parent.off(Yt,this.moveOrDuplicateSheetHandler),this.parent.off(ss,this.updateTopLeftScrollPosition)},t}(),ih=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):new r((function(t){t(e.value)})).then(o,s)}l((n=n.apply(e,t||[])).next())}))},ah=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},oh=function(){function n(e){this.parent=e,this.init(),this.addEventListener()}return n.prototype.init=function(){this.parent.element.appendChild(this.parent.createElement("input",{className:"e-clipboard",attrs:{contenteditable:"true",tabindex:"-1","aria-hidden":"true"}}))},n.prototype.addEventListener=function(){var t=this.getClipboardEle();this.parent.on(Li,this.cut,this),this.parent.on(Pi,this.copy,this),this.parent.on(Mi,this.paste,this),this.parent.on(Bi,this.clearCopiedInfo,this),this.parent.on(Fi,this.tabSwitchHandler,this),this.parent.on(Ii,this.cMenuBeforeOpenHandler,this),this.parent.on(Ai,this.ribbonClickHandler,this),this.parent.on(ii,this.initCopyIndicator,this),this.parent.on(Ji,this.rowHeightChanged,this),this.parent.on(Qi,this.colWidthChanged,this),this.parent.on(er,this.refreshOnInsertDelete,this),e.EventHandler.add(t,"cut",this.cut,this),e.EventHandler.add(t,"copy",this.copy,this),e.EventHandler.add(t,"paste",this.paste,this)},n.prototype.removeEventListener=function(){var t=this.getClipboardEle();this.parent.isDestroyed||(this.parent.off(Li,this.cut),this.parent.off(Pi,this.copy),this.parent.off(Mi,this.paste),this.parent.off(Bi,this.clearCopiedInfo),this.parent.off(Fi,this.tabSwitchHandler),this.parent.off(Ii,this.cMenuBeforeOpenHandler),this.parent.off(Ai,this.ribbonClickHandler),this.parent.off(ii,this.initCopyIndicator),this.parent.off(Ji,this.rowHeightChanged),this.parent.off(Qi,this.colWidthChanged),this.parent.off(er,this.refreshOnInsertDelete)),e.EventHandler.remove(t,"cut",this.cut),e.EventHandler.remove(t,"copy",this.copy),e.EventHandler.remove(t,"paste",this.paste)},n.prototype.ribbonClickHandler=function(e){var t=this.parent.element.id;switch(e.item.id){case t+"_cut":this.cut({invokeCopy:!0});break;case t+"_copy":this.copy({invokeCopy:!0})}},n.prototype.tabSwitchHandler=function(e){0!==e.activeTab||this.copiedInfo||this.copiedShapeInfo||this.hidePaste()},n.prototype.cMenuBeforeOpenHandler=function(e){var t=this.parent.getActiveSheet(),n=this.parent.serviceLocator.getService(Dl),i=[],a=[],o=[],s=[],l=r(t.activeCell),d=zn(l[0],l[1],t),h=t.isProtected&&Tr(d,Il(t,l[1])),p=Jr(d,Il(t,l[1]),fl(t,l[0]));"Content"!==e.target&&"RowHeader"!==e.target&&"ColumnHeader"!==e.target&&"SelectAll"!==e.target||(this.parent.enableContextMenuItems([n.getConstant("Paste"),n.getConstant("PasteSpecial")],!!(this.copiedInfo||this.copiedShapeInfo&&!h)),this.parent.enableContextMenuItems([n.getConstant("Cut")],!h)),"Content"===e.target&&(t.isProtected&&this.parent.enableContextMenuItems([n.getConstant("Filter"),n.getConstant("Sort"),n.getConstant("AddNote")],!1),h?this.parent.enableContextMenuItems([n.getConstant("Cut"),n.getConstant("Hyperlink"),n.getConstant("EditNote"),n.getConstant("DeleteNote")],!1):p?this.parent.enableContextMenuItems([n.getConstant("Cut"),n.getConstant("Paste"),n.getConstant("PasteSpecial"),n.getConstant("Filter"),n.getConstant("Sort"),n.getConstant("Hyperlink"),n.getConstant("EditHyperlink"),n.getConstant("OpenHyperlink"),n.getConstant("RemoveHyperlink"),n.getConstant("AddNote")],!1):t.isProtected&&!t.protectSettings.insertLink&&this.parent.enableContextMenuItems([n.getConstant("Hyperlink")],!1)),t.isProtected&&("ColumnHeader"===e.target&&(o=[n.getConstant("DeleteColumn"),n.getConstant("DeleteColumns"),n.getConstant("InsertColumn"),n.getConstant("InsertColumns")],s=[n.getConstant("HideColumn"),n.getConstant("HideColumns"),n.getConstant("UnhideColumns")],this.parent.enableContextMenuItems(o,!1),this.parent.enableContextMenuItems(s,t.protectSettings.formatColumns)),"RowHeader"===e.target&&(i=[n.getConstant("DeleteRow"),n.getConstant("DeleteRows"),n.getConstant("InsertRow"),n.getConstant("InsertRows")],a=[n.getConstant("HideRow"),n.getConstant("HideRows"),n.getConstant("UnhideRows")],this.parent.enableContextMenuItems(i,!1),this.parent.enableContextMenuItems(a,t.protectSettings.formatRows)))},n.prototype.rowHeightChanged=function(e){if(this.copiedInfo){var t=this.getCopyIndicator();t&&(this.copiedInfo.range[0]>e.rowIdx?t.style.top=parseFloat(t.style.top)+e.threshold+"px":Ar(this.copiedInfo.range,e.rowIdx,this.copiedInfo.range[1])&&(t.style.height=parseFloat(t.style.height)+e.threshold+"px"))}},n.prototype.colWidthChanged=function(e){if(this.copiedInfo){var t=this.getCopyIndicator();t&&(this.copiedInfo.range[1]>e.colIdx?t.style.left=parseFloat(t.style.left)+e.threshold+"px":Ar(this.copiedInfo.range,this.copiedInfo.range[0],e.colIdx)&&(t.style.width=parseFloat(t.style.width)+e.threshold+"px"))}},n.prototype.cut=function(e){this.setCopiedInfo(e,!0)},n.prototype.copy=function(e){this.setCopiedInfo(e,!1)},n.prototype.paste=function(r){var n=this;if(this.parent.isEdit||this.parent.element.getElementsByClassName("e-dlg-overlay").length>0){this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0].style.height="auto"}else{var i,o=r&&r.clipboardData||window.clipboardData;if(!(o&&r.clipboardData&&r.clipboardData.getData("isInternalCut").length)||this.copiedInfo)if(o||this.copiedShapeInfo||r.isInternal&&this.copiedInfo){r.isInternal=!o;var s=void 0,l=this.getCopiedIdx();r.isAction=!!o||r.isAction;var d=r&&r.sIdx>-1?r.sIdx:this.parent.activeSheetIndex,h=Fn(this.parent,d),p=c(r&&r.range||t(h.selectedRange)),u=void 0,f=void 0;if(o){if(f=(u=this.getExternalCells(r)).model,!r.isInternal&&u.internal&&(o=!1,!this.copiedInfo))return;if(!f||!f.length){if(u.file)return void this.parent.notify(wo,{file:u.file});if(!this.copiedInfo)return;o=!1}}var g,v,y,C=Object.assign({isExternal:o},this.copiedInfo),b=void 0,x=void 0,S=void 0,w=void 0,I=void 0,E=void 0;o?(v=d,y=Fn(this.parent,v),b={},S="Sheet"!==(w=u.selection)&&(p[2]-p[0]+1)%u.rowCount==0&&(p[3]-p[1]+1)%u.colCount==0,g=[0,0,u.usedRowIndex,u.usedColIndex]):(g=c(this.copiedShapeInfo?t(h.selectedRange):this.copiedInfo.range),v=l,b=Il(h,g[1]),x=m(g)&&this.isRangeMerged(p,h),y=Fn(this.parent,v),S=!x&&(p[2]-p[0]+1)%(g[2]-g[0]+1)==0&&(p[3]-p[1]+1)%(g[3]-g[1]+1)==0,y&&(I=0===g[1]&&g[3]===y.colCount-1,E=0===g[0]&&g[2]===y.rowCount-1,I?E?(w="Sheet",g[2]=y.usedRange.rowIndex,g[3]=y.usedRange.colIndex):(w="Row",g[3]=y.usedRange.colIndex):E&&(w="Column",g[2]=y.usedRange.rowIndex))),i=S?p:[p[0],p[1]].concat([p[0]+g[2]-g[0],p[1]+g[3]-g[1]||p[1]]),w&&(("Sheet"===w||"Column"===w)&&i[2]<h.usedRange.rowIndex&&(i[2]=h.usedRange.rowIndex),("Sheet"===w||"Row"===w)&&i[3]<h.usedRange.colIndex&&(i[3]=h.usedRange.colIndex));var N=r&&r.type||"All";if(Qr(this.parent,i))return void this.parent.notify(to,null);if(h.isProtected&&Bd(this.parent,i))return void this.parent.notify(eo,null);if(r.isAction&&!this.copiedShapeInfo){var R={requestType:"paste",copiedInfo:this.copiedInfo,copiedRange:a(g),pastedRange:a(i),type:N,cancel:!1};if(this.parent.notify(K,{eventArgs:R,action:"clipboard"}),R.cancel)return;p=t(R.pastedRange),i=(S=o?"Sheet"!==u.selection&&(p[2]-p[0]+1)%u.rowCount==0&&(p[3]-p[1]+1)%u.colCount==0:!x&&!I&&(p[2]-p[0]+1)%(g[2]-g[0]+1)==0&&!E&&(p[3]-p[1]+1)%(g[3]-g[1]+1)==0)?p:[p[0],p[1]].concat([p[0]+g[2]-g[0],p[1]+g[3]-g[1]||p[1]]),N=R.type}var A=void 0;w?(A=[].concat(i),"Sheet"!==w&&"Column"!==w||(i[2]<h.usedRange.rowIndex&&(i[2]=h.usedRange.rowIndex),g[2]<h.usedRange.rowIndex&&(g[2]+=h.usedRange.rowIndex-g[2]),A[2]<h.rowCount&&(A[2]=h.rowCount-1)),"Sheet"!==w&&"Row"!==w||(i[3]<h.usedRange.colIndex&&(g[3]+=h.usedRange.colIndex-i[3],i[3]=h.usedRange.colIndex),g[3]<h.usedRange.colIndex&&(g[3]+=h.usedRange.colIndex-g[3]),A[3]<h.colCount&&(A[3]=h.colCount-1))):A=i;var k=void 0,O=void 0,F=void 0,T=p[0],D=[];if(h.isProtected&&Bd(this.parent,i))return void this.parent.notify(eo,null);if(this.copiedShapeInfo&&!this.copiedInfo){var L=this.copiedShapeInfo.pictureElem;L.classList.contains("e-datavisualization-chart")?(this.copiedShapeInfo.chartInfo.top=null,this.copiedShapeInfo.chartInfo.left=null,this.parent.notify(Lt,{chart:[this.copiedShapeInfo.chartInfo],isInitCell:!0,isUndoRedo:!0,isPaste:!0,dataSheetIdx:this.copiedShapeInfo.sheetIdx,isCut:this.copiedShapeInfo.isCut,sheetId:h.id,range:r.range||h.name+"!"+h.selectedRange})):this.parent.notify(Ao,{options:{src:L.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:this.copiedShapeInfo.height,width:this.copiedShapeInfo.width,id:this.copiedShapeInfo.isCut?L.id:""},range:a([T,p[1],T,p[1]]),isPublic:!1,isUndoRedo:!0});var P=zn(T,p[1],h);if(P&&!(0,e.isNullOrUndefined)(P.image)&&P.image.length>0){var M={requestType:"imagePaste",copiedShapeInfo:this.copiedShapeInfo,pasteSheetIndex:this.parent.activeSheetIndex,pastedRange:Pn(this.parent)+"!"+a([T,p[1],T,p[1]]),pastedPictureElement:document.getElementById(P.image[P.image.length-1].id)};this.parent.notify(Pa,{eventArgs:M,action:"clipboard"})}}else{var B=[],H=this.isInRange(g,p,l),U=!1,V=!1,z=0,j=[],_=void 0;S||"Values"===N||(_=this.setCF(g,i,y,h,j,_));for(var q=!1,W=[],G={sheet:h,isExternal:!!o},Y=this.setCell(G),X=!o&&this.copiedInfo.isCut&&this.setCell({sheet:y}),$=[],Z=[],J=g[0],Q=0;J<=g[2];J++,Q++)if(o||C.isCut||!vl(y,J)){H&&(B[p[0]+Q]={cells:[]});for(var ee=g[1],te=0;ee<=g[3];ee++,te++){if(H&&(B[p[0]+Q].cells[p[1]+te]=zn(p[0]+Q,p[1]+te,y,!1,!0)),k=o?f[J]&&f[J].cells[ee]||{}:(0,e.extend)({},H&&B[J]&&B[J].cells[ee]?B[J].cells[ee]:zn(J,ee,y),null,!0),b=Il(y,ee),!k.validation&&kl(b,J,ee)){var re=Object.assign({},b.validation),ne=[0,g[1],0,g[3]],ie=re.value1,ae=re.value2;wr(ie)&&(re.value1=Br([J,ee],ne,y,this.parent,{formula:ie})),wr(ae)&&(re.value2=Br([J,ee],ne,y,this.parent,{formula:ae})),k.validation=re}if(k&&k.isReadOnly&&delete k.isReadOnly,I||E){if(k&&k.rowSpan)if(k.rowSpan>0)k.rowSpan+J-1<=g[2]?U=!0:k={};else if(U){if(k.rowSpan<0){var oe=k.rowSpan,se=k.colSpan?k.colSpan:0,le=zn(T+oe,p[1]+te+se,h);le&&!le.rowSpan&&(k={})}}else k={};k&&k.colSpan&&(k.colSpan>0?k.colSpan+ee-1<=g[3]?V=!0:k={}:V||(k={}))}if(k&&N){var de=void 0;switch(N){case"Formats":de={format:k.format,style:k.style},this.copiedInfo&&!this.copiedInfo.isCut&&(k.rowSpan&&(de.rowSpan=k.rowSpan),k.colSpan&&(de.colSpan=k.colSpan)),k=de;break;case"Values":if((k={value:k.value}).value&&k.value.toString().indexOf("\n")>-1)this.parent.getCell(p[0],p[1]).classList.add("e-alt-unwrap")}O=["Formats","Values"].indexOf(N)>-1}if(!this.parent.scrollSettings.isFinite&&(g[2]-g[0]>1048575-p[0]||g[3]-g[1]>16383-p[1])||this.parent.scrollSettings.isFinite&&(g[2]-g[0]>h.rowCount-1-p[0]||g[3]-g[1]>h.colCount-1-p[1]))return void this.showDialog();if(S){for(var he=p[0];he<=p[2];he+=g[2]-g[0]+1)if(C.isCut||z||!vl(h,he+Q))for(var ce=p[1];ce<=p[3];ce+=g[3]-g[1]+1){if(J!==g[0]||ee!==g[1]||void 0!==_&&!_.length||"Values"===N||(_=this.setCF(g,[he,ce,he+(g[2]-g[0]),ce+(g[3]-g[1])],y,h,j,_)),F=zn(he+Q,ce+te,h,!1,!0),!(o||(0,e.isNullOrUndefined)(F.colSpan)&&(0,e.isNullOrUndefined)(F.rowSpan))){if(I||E)continue;var ue={range:[he+Q,ce+te,he+Q,ce+te],merge:!1,isAction:!1,type:"All",sheetIndex:d,preventRefresh:d!==this.parent.activeSheetIndex};D.push(ue),this.parent.notify(St,ue)}var fe=ce+te;if(k=(0,e.extend)({},k||{},null,!0),!O&&this.copiedInfo&&!this.copiedInfo.isCut&&k.formula){var ge=Br([he+Q,fe],[J,ee],y,this.parent,H?k:null);(0,e.isNullOrUndefined)(ge)||(k.formula=ge)}if(this.copiedInfo&&!this.copiedInfo.isCut&&k.validation){var me=p,ve=Br(me,ne=g,y,this.parent,{formula:k.validation.value1});k.validation.value1=ve,""!==k.validation.value2&&(ve=Br(me,ne,y,this.parent,{formula:k.validation.value2}),k.validation.value2=ve)}h.isProtected&&k&&!1!==k.isLocked&&(k.isLocked=F.isLocked),F&&F.formula&&F.formula.indexOf("=UNIQUE(")>-1&&this.parent.notify(Ie,null);var ye={cellIdx:[J,ee],isUnique:!1,uniqueRange:"",sheetName:y.name};this.parent.notify(Ee,ye),ye.isUnique&&(k.value=null),q=!1,k&&k.formula&&k.formula.indexOf("=UNIQUE(")>-1&&(q=!0,W.push([he,fe]),k.value=null),Y(he+Q,fe,k,fe===p[3],O,q,r.beforeActionData,r.isUndo)||k.formula&&this.copiedInfo&&this.copiedInfo.isCut&&this.parent.notify(Re,{cellRef:a([J,ee,J,ee])})}}else!o&&Id(this.parent,J,ee,l)||(x?Y(T,p[1]+te,{value:k.value},ee===g[3],!0):Y(T,p[1]+te,k,ee===g[3],O));if(!o&&this.copiedInfo.isCut&&(!Ar(p,J,ee)||l!==this.parent.activeSheetIndex)){var Ce=zn(J,ee,y);if(Ce){if(Ce.isReadOnly)continue;if(Ce.isLocked||(0,e.isNullOrUndefined)(Ce.isLocked))if(!I&&!E||void 0===Ce.rowSpan&&void 0===Ce.colSpan)!Ce.validation&&y.columns[ee]&&y.columns[ee].validation&&-1===Z.indexOf(ee)&&Z.push(ee),Ce=null;else{if(!(Ce.rowSpan>1||Ce.colSpan>1))continue;$.push({range:[J,ee,J,ee],rowSpan:Ce.rowSpan,colSpan:Ce.colSpan}),Ce=null}else!1===Ce.isLocked&&(Ce=y.isProtected?{isLocked:!1}:null)}X(J,ee,Ce,ee===g[3])}}T++}else Q--,z++;if($.length&&$.forEach((function(e){jn(e.range[0],e.range[1],y,{rowSpan:e.rowSpan,colSpan:e.colSpan});var t={range:e.range};n.parent.notify(It,t),n.parent.notify(St,{merge:!1,range:t.range,type:"All",sheetIndex:v,preventRefresh:v!==n.parent.activeSheetIndex}),t.range=t.range;for(var r=t.range[0];r<=t.range[2];r++)for(var i=t.range[1];i<=t.range[3];i++)X(r,i,null)})),Z.length&&Z.forEach((function(e){n.parent.notify(Qe,{range:y.name+"!"+a([g[0],e,g[2],e]),isRemoveValidation:!0})})),W.length)for(J=0;J<W.length;J++)this.parent.serviceLocator.getService("cell").refresh(W[J][0],W[J][1]);G.isRandFormula&&"Automatic"===this.parent.calculationMode&&this.parent.notify(pe,{action:"refreshRandomFormula"}),this.parent.notify(Mt,null);var be=i[2]-z,xe=A[2]-z;i[2]=be,A[2]=xe,this.parent.setUsedRange(i[2],i[3]);var Se=a(A);d!==this.parent.activeSheetIndex||r.isFromUpdateAction||this.parent.notify(Ti,{address:Se}),!o&&this.copiedInfo.isCut&&(s=this.copiedInfo.isCut,l===this.parent.activeSheetIndex&&this.parent.serviceLocator.getService("cell").refreshRange(g),this.clearCopiedInfo()),(o||H)&&this.copiedInfo&&this.clearCopiedInfo();var we=void 0;if(s){_&&_.length&&"Values"!==N&&(we={range:g,sheetIdx:v,isClear:!0},this.parent.notify(Ot,we)),Ld(y,g[0],g[1],(this.parent.getRow(g[0],null,this.parent.frozenColCount(y))||{offsetHeight:20}).offsetHeight);var Ne=Pd(y,g[0]);Ed(this.parent,y,Ne,g[0])}j.length&&d===this.parent.activeSheetIndex&&this.parent.notify(kt,{cfModel:j,isAction:!0});var Ae=Fn(this.parent,l);if(!o&&g[0]===g[2]&&"Row"===w){for(Ne=Ae.rows[g[0]].height,J=p[0];J<=p[2];J++)Ed(this.parent,this.parent.getActiveSheet(),Ne,J);if(s){var ke=Ae&&Ae.standardHeight?Ae.standardHeight:20;Ed(this.parent,Ae,ke,g[0])}}if(r.isAction){M={requestType:"paste",copiedInfo:C,mergeCollection:D,pasteSheetIndex:this.parent.activeSheetIndex,copiedRange:y.name+"!"+(C.range?a(C.range):y.selectedRange),pastedRange:h.name+"!"+a(i),type:N||"All",selectedRange:Se};z&&(M.skipFilterCheck=!0),we&&we.cfClearActionArgs&&(M.cfClearActionArgs=we.cfClearActionArgs),j.length&&(M.cfActionArgs={cfModel:j,sheetIdx:d}),this.parent.notify(Pa,{eventArgs:M,action:"clipboard"})}r.focus&&Md(this.parent.element)}}else this.getClipboardEle().select()}},n.prototype.setCF=function(e,r,n,i,o,s){var l,d,h=this,p=function(t){l=[r[0]+(d[0]<=e[0]?0:d[0]-e[0]),r[1]+(d[1]<=e[1]?0:d[1]-e[1]),r[2]-(d[2]>=e[2]?0:e[2]-d[2]),r[3]-(d[3]>=e[3]?0:e[3]-d[3])],i.conditionalFormats||h.parent.setSheetPropertyOnMute(i,"conditionalFormats",[]);var n={range:a(l),type:t.type,cFColor:t.cFColor,value:t.value,format:t.format};i.conditionalFormats.push(n),o.push(n)};if(s)for(var c=0,u=s.length;c<u;c++)d=t(s[c].range),p(s[c]);else if(s=[],n.conditionalFormats)for(c=0,u=n.conditionalFormats.length;c<u;c++)d=t(n.conditionalFormats[c].range),Wr([e],n.conditionalFormats[c].range)&&(s.push(n.conditionalFormats[c]),p(n.conditionalFormats[c]));return s},n.prototype.isRangeMerged=function(e,t){var r=zn(e[0],e[1],t);if(r&&(r.colSpan>1||r.rowSpan>1)){var n={range:e.slice(2,4).concat(e.slice(2,4))};return this.parent.notify(Et,n),n.range[0]===e[0]&&n.range[1]===e[1]&&n.range[2]===e[2]&&n.range[3]===e[3]}return!1},n.prototype.updateFilter=function(e,r){var n,i;this.parent.notify(Q,null);for(var o=0;o<this.parent.sheets.length;o++)if(this.parent.filterCollection&&this.parent.filterCollection[o]&&this.parent.filterCollection[o].sheetIndex===En(this.parent,e.sId)){var s=e.range,l=t(this.parent.filterCollection[o].filterRange);s=c(s),l[0]===s[0]&&l[2]===s[2]&&l[1]===s[1]&&l[3]===s[3]&&(n=!0,i=[Math.abs(s[0]-l[0]),Math.abs(s[1]-l[1]),Math.abs(s[2]-l[2]),Math.abs(s[3]-l[3])])}var d=this.parent.getCell(e.range[0],e.range[1]),h=(d=d?d.querySelector(".e-filter-icon")?d:this.parent.getCell(e.range[2],e.range[3]):d)?d.querySelector(".e-sortasc-filter"):d,p=d?d.querySelector(".e-sortdesc-filter"):d;if(n)for(var u=0;u<this.parent.filterCollection.length;u++){var f=this.parent.filterCollection[u],g=e&&e.sId?En(this.parent,e.sId):this.parent.activeSheetIndex;if(f.sheetIndex===g&&this.parent.notify(Aa,{predicates:null,range:f.filterRange,sIdx:g,isCut:!0}),f.sheetIndex===g&&g===this.parent.activeSheetIndex&&(i=[r[0]+i[0],r[1]+i[1],Math.abs(r[2]-i[2]),Math.abs(r[3]-i[3])],this.parent.notify(Aa,{predicates:null,range:a(i),sIdx:null,isCut:!0}),e.range[3]===e.range[1])){var m=this.parent.getCell(r[0],r[1]);h&&m&&m.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"),p&&m&&m.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter")}}},n.prototype.isInRange=function(e,t,r){var n=this.parent.activeSheetIndex;return Ar(e,t[0],t[1])&&r===n||Ar(e,t[2],t[3])&&r===n},n.prototype.setCell=function(e){var t=this,r=e.sheet,n=r.name===this.parent.getActiveSheet().name;return function(i,a,o,s,l,d,h,p){o&&o.formula&&(o.formula.indexOf("RANDBETWEEN(")>-1||o.formula.indexOf("RAND(")>-1||o.formula.indexOf("NOW(")>-1)&&(e.isRandFormula=!0);var c=Vr(t.parent,r,{cell:o,rowIdx:i,colIdx:a,pvtExtend:!l,valChange:!d,lastCell:s,uiRefresh:n,requestType:"paste",skipFormatCheck:!e.isExternal,isRandomFormula:e.isRandFormula},h,p);if(!c&&o&&o.style&&e.isExternal){var u=Dd(t.parent,i,a,r,o.style||t.parent.cellStyle,o.wrap?kd(t.parent.getDisplayText(o),Td(r,i,a,o.colSpan>1?a+o.colSpan-1:a),o.style,t.parent.cellStyle):1);(u=Math.round(u))<20&&(u=20),Ld(r,i,a,u);var f=bl(r,i),g=Pd(r,i);g>f&&Ed(t.parent,r,g,i)}return c}},n.prototype.getCopiedIdx=function(){if(this.copiedInfo){for(var e=0;e<this.parent.sheets.length;e++)if(this.parent.sheets[e].id===this.copiedInfo.sId)return e;this.clearCopiedInfo()}return-1},n.prototype.setCopiedInfo=function(r,n){var i=this;if(!this.parent.isEdit){var o=new Sr.Deferred;r.promise=o.promise;var s,l=this.parent.getActiveSheet();if(r&&r.range){var d=0===r.range[1]&&r.range[3]===l.colCount-1,h=0===r.range[0]&&r.range[2]===l.rowCount-1,p={range:r.range};d||h||this.parent.notify(It,p),s=p.range}else s=t(l.selectedRange);if(n&&Qr(this.parent,s))this.parent.notify(to,null);else{if(r&&!r.isPublic&&!r.clipboardData){var c={copiedRange:l.name+"!"+a(s),cancel:!1,action:n?"cut":"copy"};if(this.parent.notify(K,c),c.cancel)return}var u={sheet:l,indexes:[0,0,l.rowCount-1,l.colCount-1],isFinite:this.parent.scrollSettings.isFinite,promise:new Promise((function(e){e(void 0)}))},f=document.getElementsByClassName("e-ss-overlay-active"),g=f.length;!l.isLocalData||r&&r.clipboardData||0!==s[0]||s[2]!==l.rowCount-1||g||(this.parent.showSpinner(),this.parent.notify("updateSheetFromDataSource",u)),this.checkForUncalculatedFormula(s,r&&r.sId?r.sId:l.id),u.promise.then((function(){if(g>0){var t={clientY:f[0].offsetTop,isImage:!0};i.parent.notify(No,t);var d={clientX:f[0].offsetLeft,isImage:!0};if(i.parent.notify(Ro,d),i.copiedShapeInfo={sId:r&&r.sId?r.sId:l.id,sheetIdx:l.index,isCut:n,pictureElem:f[0],copiedRange:a([t.clientY,d.clientX,t.clientY,d.clientX]),height:f[0].offsetHeight,width:f[0].offsetWidth,chartInfo:i.getChartElemInfo(f[0])},!f[0].classList.contains("e-datavisualization-chart")){var h=window.getComputedStyle(f[0]).backgroundImage.slice(5,-2);i.addImgToClipboard(h,i.copiedShapeInfo.height,i.copiedShapeInfo.width)}i.hidePaste(!0),n&&(f[0].classList.contains("e-datavisualization-chart")?i.parent.deleteChart(i.copiedShapeInfo.chartInfo.id):i.parent.notify(ko,{id:i.copiedShapeInfo.pictureElem.id,sheetIdx:i.copiedShapeInfo.sId,range:i.copiedShapeInfo.copiedRange}))}else r&&r.clipboardData||(i.copiedInfo&&i.clearCopiedInfo(),i.copiedInfo={range:s,sId:r&&r.sId?r.sId:l.id,isCut:n},i.hidePaste(!0),r.isFromUpdateAction||i.initCopyIndicator(),e.Browser.isIE||i.getClipboardEle().select(),r&&r.invokeCopy&&document.execCommand(n?"cut":"copy"),i.parent.hideSpinner());e.Browser.isIE&&i.setExternalCells(r,n),o.resolve()})),r&&r.clipboardData&&(this.setExternalCells(r,n),this.getClipboardEle().setAttribute("aria-label",l.selectedRange+" "+this.parent.serviceLocator.getService(Dl).getConstant(n?"Cut":"Copy")))}}},n.prototype.imageToCanvas=function(e,t,r){return new Promise((function(n){var i=document.createElement("canvas"),a=i.getContext("2d"),o=new Image;o.src=e,o.crossOrigin="anonymous",o.onload=function(){i.width=r,i.height=t,a.drawImage(o,0,0,r,t),i.toBlob((function(e){n(e)}),"image/png")}}))},n.prototype.addImgToClipboard=function(e,t,r){return ih(this,void 0,void 0,(function(){var n,i,a;return ah(this,(function(o){switch(o.label){case 0:return i=window.navigator,[4,this.imageToCanvas(e,t,r)];case 1:return a=o.sent(),[4,i.clipboard.write([new ClipboardItem((n={},n[a.type]=a,n))])];case 2:return o.sent(),[2]}}))}))},n.prototype.checkForUncalculatedFormula=function(t,r){for(var n,i=En(this.parent,r),a=Fn(this.parent,i),o=t[0];o<=t[2];o++)for(var s=t[1];s<=t[3];s++)(n=zn(o,s,a,null,!0)).formula&&(0,e.isUndefined)(n.value)&&this.parent.notify(pe,{action:"refreshCalculate",value:n.formula,rowIndex:o,colIndex:s,isFormula:wr(n.formula),sheetIndex:i})},n.prototype.getChartElemInfo=function(e){var t=this.parent.chartColl;if(e.classList.contains("e-datavisualization-chart"))for(var r=e.getElementsByClassName("e-control")[0].id,n=0;n<t.length;n++){if(t[n].id===r)return t[n]}return null},n.prototype.clearCopiedInfo=function(){this.copiedInfo&&(this.parent.getActiveSheet().id===this.copiedInfo.sId&&(this.removeIndicator(this.parent.getSelectAllContent()),this.removeIndicator(this.parent.getColumnHeaderContent()),this.removeIndicator(this.parent.getRowHeaderContent()),this.removeIndicator(this.parent.getMainContent())),this.copiedInfo=null,this.hidePaste()),this.copiedShapeInfo&&(this.copiedShapeInfo=null,this.hidePaste())},n.prototype.removeIndicator=function(t){if(t){var r=t.getElementsByClassName("e-copy-indicator")[0];r&&(0,e.detach)(r)}},n.prototype.initCopyIndicator=function(){if(this.copiedInfo&&this.parent.getActiveSheet().id===this.copiedInfo.sId){var e=this.parent.createElement("div",{className:"e-copy-indicator"});e.appendChild(this.parent.createElement("div",{className:"e-top"})),e.appendChild(this.parent.createElement("div",{className:"e-bottom"})),e.appendChild(this.parent.createElement("div",{className:"e-left"})),e.appendChild(this.parent.createElement("div",{className:"e-right"})),Zl(this.parent,e,this.copiedInfo.range,"e-copy-indicator")}},n.prototype.showDialog=function(){var e=this;this.parent.serviceLocator.getService(Ll).show({header:"Spreadsheet",height:205,width:340,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(Dl).getConstant("PasteAlert"),beforeOpen:function(t){var r={dialogName:"PasteDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0)}})},n.prototype.hidePaste=function(e){this.parent.getActiveSheet().isProtected&&(e=!1),this.parent.notify(Oi,[{items:[this.parent.element.id+"_paste"],enable:e||!1}])},n.prototype.setExternalCells=function(t,r){var n,i,a,o="",s=this.parent.getActiveSheet(),l=c(this.copiedInfo.range),d=0===l[1]&&l[3]===s.colCount-1,h=0===l[0]&&l[2]===s.rowCount-1,p='<html><body><table class="e-spreadsheet" xmlns="http://www.w3.org/1999/xhtml" style="border-collapse:collapse;"';(d||h)&&(p+=' aria-rowcount="'+s.usedRange.rowIndex+'" aria-colcount="'+s.usedRange.colIndex+'"',p+=' aria-label="'+(d&&h?"Sheet":d?"Row":"Column")+'"'),p+="><tbody>";for(var u=l[0];u<=l[2];u++)if(r||!vl(s,u)){p+='<tr style="height:'+yl(s,u)+'px;">';for(var f=l[1];f<=l[3];f++)if(!((n=zn(u,f,s,!1,!0)).colSpan<0||n.rowSpan<0)){if(p+="<td",n.colSpan&&(p+=' colspan="'+n.colSpan+'"'),n.rowSpan&&(p+=' rowspan="'+n.rowSpan+'"'),p+=' style="width:'+Nl(s,f)+"px;",n.style?(a="",n.style.whiteSpace||(a+="white-space:"+(n.wrap?"normal":"nowrap")+";"),n.style.verticalAlign||(a+="vertical-align:bottom;"),n.style.fontFamily||(a+="font-family:Calibri;"),n.style.fontSize||(a+="font-size:11pt;"),Object.keys(n.style).forEach((function(e){var t=n.style[""+e];e.includes("border")&&t.includes("dashed")&&t.includes("1px")&&(t=t.replace("1px","thin"));var r=e.match(/[A-Z]/);a+=("backgroundColor"===e?"background":r?e.replace(r[0],"-"+r[0].toLowerCase()):e)+":"+("backgroundColor"===e||"color"===e?n.style[""+e].slice(0,7):t)+";"})),p+=a.includes('"')?"'"+a+"'":a+'"'):p+="white-space:"+(n.wrap?"normal":"nowrap")+';vertical-align:bottom;font-family:Calibri;font-size:11pt;"',(0,e.isNullOrUndefined)(n.value))p+="></td>";else{if(i=n.value,n.format&&"General"!==n.format){p+=n.value.toString().includes('"')?" cell-value='"+i+"'":' cell-value="'+n.value+'"',p+=n.format.includes('"')?" num-format='"+n.format+"'":' num-format="'+n.format+'"';var g={formattedText:i,value:i,format:n.format,cell:n,rowIndex:u,colIndex:f,dataUpdate:!0};this.parent.notify(re,g),i=g.formattedText}p+=">","string"==typeof i&&i.includes("\n")?p+=i.split("\n").join("<br>"):p+=i,o+=i,p+="</td>"}o+=f===l[3]?"":"\t"}p+="</tr>",o+=u===l[2]?"":"\n"}p+="</tbody></table></body></html>",e.Browser.isIE?(window.clipboardData.setData("text",o),r&&window.clipboardData.setData("isInternalCut",o)):(t.clipboardData.setData("text/html",p),t.clipboardData.setData("text/plain",o),r&&t.clipboardData.setData("isInternalCut",o),t.preventDefault())},n.prototype.getExternalCells=function(t){var r,n,i=this,a=[],o={model:a},s=this.parent.createElement("span"),l=function(){return setTimeout((function(){i.getClipboardEle().innerHTML=""}),0)};if(e.Browser.isIE)n=window.clipboardData.getData("text");else{if(r=t.clipboardData.getData("text/html"),n=t.clipboardData.getData("text/plain"),this.copiedInfo&&r.includes('<table class="e-spreadsheet"')){var d=!1;if(!this.copiedInfo.isCut){var h={sheetIdx:En(this.parent,this.copiedInfo.sId)};if(this.parent.notify(Ba,h),h.isFiltered){var p=h.filterRange,c=this.copiedInfo.range;d=p[0]===c[0]&&p[1]===c[1]&&p[2]===c[2]&&p[3]===c[3]}}if(!d)return l(),{internal:!0}}s.innerHTML=r}if(s.querySelector("table"))this.generateCells(s,o);else if(s.querySelector("img")){var u=s.querySelector("img");this.parent.notify(Ao,{options:{src:u.src,height:u.height,width:u.width},isPublic:!0})}else if(n){var f,g,m,v=[];r&&(g=[].slice.call(s.children));var y=this.cellStyle(s);o.colCount=1,n.split("\n").forEach((function(e){f=null,r&&(m=g.filter((function(t){return t.textContent&&t.textContent.replace(/(\r\n|\n|\r|\s)/gm," ").trim()===e.trim()}))[0])&&(f=y(m),g.splice(g.indexOf(m),1)),e.split("\t").forEach((function(e,t){(e||f)&&(v[t]={},f&&(f.whiteSpace&&"nowrap"!==f.whiteSpace?(v[t].wrap=!0,delete f.whiteSpace,Object.keys(f).length&&(v[t].style=f)):v[t].style=f),e&&(wr(e)?v[t].formula=e:v[t].value=cn(e.trim(),!0,!0)))})),a.push({cells:v}),o.colCount=Math.max(o.colCount,v.length),v=[]})),o.rowCount=a.length,o.usedRowIndex=a.length-1,o.usedColIndex=o.colCount-1}else if(t.clipboardData.files&&t.clipboardData.files[0]&&t.clipboardData.files[0].type.includes("image"))return l(),{file:t.clipboardData.files[0]};return l(),o},n.prototype.generateCells=function(t,r){var n=r.model,i=t.querySelector("table"),a=i.classList.contains("e-spreadsheet"),o={},s={};r.usedRowIndex=i.rows.length-1,r.rowCount=i.rows.length,a&&(r.selection=i.getAttribute("aria-label"),r.selection&&("Sheet"===r.selection?(r.usedRowIndex=Number(i.getAttribute("aria-rowcount")),r.usedColIndex=Number(i.getAttribute("aria-colcount"))):"Row"===r.selection?r.usedColIndex=Number(i.getAttribute("aria-colcount")):r.usedRowIndex=Number(i.getAttribute("aria-rowcount"))));var l=[];(0,e.isNullOrUndefined)(i)||(0,e.isNullOrUndefined)(i.getAttribute("style"))||(l.push(i.getAttribute("style")),this.generateStyles(l,o));var d,h,p,c,u,f,g,m=this.cellStyle(t,a),v=1;r.colCount=1;for(var y=[],C=0,b=r.usedRowIndex;C<=b;C++){d=i.rows[C],(0,e.isNullOrUndefined)(d.getAttribute("style"))||(y.push(d.getAttribute("style")),this.generateStyles(y,s)),n[C]||(n[C]={cells:[]}),h=n[C].cells,r.colCount=Math.max(r.colCount,d.cells.length),u=r.usedColIndex<d.cells.length?r.usedColIndex:d.cells.length-1;for(var x=0;x<=u;x++){if(c=d.cells[x],g=x,h[x]&&(x=this.getNewIndex(h,x)),h[x]={},p=m(c,s,o),c.textContent=c.textContent.replace(/(\r\n|\n|\r)/gm,""),c.textContent=c.textContent.replace(/\s+/g," "),p.whiteSpace&&"nowrap"!==p.whiteSpace&&(h[x].wrap=!0,delete p.whiteSpace),Object.keys(p).length&&(p.border&&(["borderBottom","borderTop","borderLeft","borderRight"].forEach((function(e){p[""+e]=p.border})),delete p.border),h[x].style=p),c.textContent&&(h[x].value=cn(c.textContent.trim(),!0,!0)),f=a?"num-format":"number-format",c.getAttribute(f)&&(h[x].format=c.getAttribute(f),h[x].value&&c.getAttribute("cell-value")&&(h[x].value=cn(c.getAttribute("cell-value").trim(),!0,!0))),c.getAttribute("colspan")&&parseInt(c.getAttribute("colspan"),10)>1&&(h[x].colSpan=parseInt(c.getAttribute("colspan"),10)),c.getAttribute("rowspan")&&parseInt(c.getAttribute("rowspan"),10)>1&&(h[x].rowSpan=parseInt(c.getAttribute("rowspan"),10)),h[x].colSpan>1&&h[x].rowSpan>1)for(var S=void 0,w=C,I=C+h[x].rowSpan;w<I;w++)for(var E=x,N=x+h[x].colSpan;E<N;E++)w===C&&E===x||(S=h[x].style?{style:(0,e.extend)({},h[x].style)}:{},w!==C&&(S.rowSpan=C-w),E!==x&&(S.colSpan=x-E),n[w]||(n[w]={cells:[]}),n[w].cells[E]=S);else if(h[x].colSpan>1)for(w=x+1,I=x+h[x].colSpan;w<I;w++)h[w]={colSpan:x-w,style:(0,e.extend)({},p)};else if(h[x].rowSpan>1)for(w=C+1,I=C+h[x].rowSpan;w<I;w++)n[w]||(n[w]={cells:[]}),n[w].cells[x]={rowSpan:C-w,style:(0,e.extend)({},p)};x=g}v=Math.max(v,h.length)}r.usedColIndex=v-1},n.prototype.getNewIndex=function(e,t){return e[t]&&(t++,t=this.getNewIndex(e,t)),t},n.prototype.cellStyle=function(e,t){var r,n,i=this;if(!t){r=e.querySelector("style")&&e.querySelector("style").innerHTML;var a=Object.keys(this.parent.commonCellStyle);if(a&&a.length&&r){var o=r.includes("td")?r.split("td")[1]:r;o=o.includes("{")?o.split("{")[1].split("}")[0]:o.split("}")[0],n={};for(var s=0;s<a.length;s++){var l=a[s],d=l.match(/[A-Z]/);d&&(l=l.replace(d[0],"-"+d[0].toLowerCase())),o.indexOf(l)>-1&&(n[a[s]]=o.split(l+":")[1].split(";")[0].trim())}}}return function(e,a,o){var s,l={};if(t){if(!e.getAttribute("style"))return l;s=e.getAttribute("style").split(";")}else{if(s=[],r&&e.className&&r.includes(e.classList[0])){var d=r.split(e.classList[0]);s.push(d[d.length-1].split("{")[1].split("}")[0])}var h=[].slice.call(e.querySelectorAll("*"));h.unshift(e),h.forEach((function(e){e.getAttribute("style")&&s.push(e.getAttribute("style")),"B"===e.tagName&&s.push("font-weight:bold"),"I"===e.tagName&&s.push("font-style:italic"),"U"===e.tagName&&s.push("text-decoration:underline")})),Object.assign(l,o,a,n)}return s.length&&i.generateStyles(s,l),e.querySelector("S")&&(l.textDecoration=l.textDecoration?"underline line-through":"line-through"),l.textDecoration&&-1===["underline","line-through","underline line-through","none"].indexOf(l.textDecoration)&&(l.textDecoration="none"),l.textAlign&&-1===["left","center","right"].indexOf(l.textAlign)&&(l.textAlign="left"),l.verticalAlign&&-1===["bottom","middle","top"].indexOf(l.verticalAlign)&&(l.verticalAlign="bottom"),l.fontSize&&(l.fontSize=Math.round(parseFloat(l.fontSize.indexOf("px")>-1?(.75*parseFloat(l.fontSize)).toString():l.fontSize.indexOf("em")>-1?(16*parseFloat(l.fontSize)/1.3333).toString():l.fontSize))+"pt"),l.fontWeight&&-1===["bold","normal"].indexOf(l.fontWeight)&&(l.fontWeight=l.fontWeight>"599"?"bold":"normal"),l}},n.prototype.generateStyles=function(e,t){var r,n,i,a,o,s=["font-family","vertical-align","text-align","text-indent","color","white-space","font-weight","font-style","font-size","text-decoration","background","background-color"],l=["fontFamily","verticalAlign","textAlign","textIndent","color","whiteSpace","fontWeight","fontStyle","fontSize","textDecoration","backgroundColor","backgroundColor"],d=["border-bottom","border-top","border-right","border-left","border"],h=["borderBottom","borderTop","borderRight","borderLeft","border"];e&&e.length&&e.forEach((function(e){e.split(";").forEach((function(e){if(n=e.split(":")[0].trim(),(r=s.indexOf(n))>-1)n=e.split(":")[1].trim(),t[l[r]]=n;else if((r=d.indexOf(n))>-1){if("none"===(n=e.split(":")[1].trim()))n=void 0;else if(n.includes("pt")){i=n.split("pt"),a=i[0].split(" ");for(var p=0;p<a.length;p++)if(o=parseFloat(a[p])){a.splice(p,1),a.unshift((o/.75).toFixed(2)+"px"),i[0]=a.join(" ");break}n=i.join("")}t[h[r]]=n}}))}))},n.prototype.refreshOnInsertDelete=function(e){if(this.copiedInfo){if(e.model.id!==this.copiedInfo.sId)return;var t=this.copiedInfo.range;if(e.isInsert){if("Column"===e.modelType){if(e.start<=t[3]){if(e.start<=t[1]){var r=e.end-e.start+1;t[1]+=r,t[3]+=r}else t[3]=t[1]+(e.start-t[1]-1);this.performAction()}}else if(e.start<=t[2]){if(e.start<=t[0]){r=e.end-e.start+1;t[0]+=r,t[2]+=r}else t[2]=t[1]+(e.start-t[1]-1);this.performAction()}}else this.clearCopiedInfo()}},n.prototype.performAction=function(){var e=this.getCopyIndicator();e&&Zl(this.parent,e,this.copiedInfo.range,"e-copy-indicator")},n.prototype.getClipboardEle=function(){return this.parent.element.getElementsByClassName("e-clipboard")[0]},n.prototype.getCopyIndicator=function(){return this.parent.element.getElementsByClassName("e-copy-indicator")[0]},n.prototype.getModuleName=function(){return"clipboard"},n.prototype.destroy=function(){this.removeEventListener();var t=this.getClipboardEle();(0,e.detach)(t),this.parent=null},n}(),sh=function(){function n(e){this.editorElem=null,this.editCellData={},this.isEdit=!1,this.isCellEdit=!0,this.isNewValueEdit=!0,this.isAltEnter=!1,this.curEndPos=null,this.curStartPos=null,this.uniqueColl="",this.uniqueActCell="",this.isSpill=!1,this.keyCodes={BACKSPACE:8,SPACE:32,TAB:9,DELETE:46,ESC:27,ENTER:13,FIRSTALPHABET:65,LASTALPHABET:90,FIRSTNUMBER:48,LASTNUMBER:59,FIRSTNUMPAD:96,LASTNUMPAD:111,SYMBOLSETONESTART:186,SYMBOLSETONEEND:192,SYMBOLSETTWOSTART:219,SYMBOLSETTWOEND:222,FIREFOXEQUALPLUS:61,FIREFOXMINUS:173,F2:113},this.formulaErrorStrings=["mismatched parentheses","requires 3 arguments","improper formula","empty expression","mismatched string quotes","wrong number of arguments","invalid arguments"],this.parent=e,this.addEventListener()}return n.prototype.destroy=function(){this.isEdit&&this.cancelEdit(!0,!1),this.removeEventListener(),this.editorElem=null,this.formulaErrorStrings&&(this.formulaErrorStrings=[]),this.editCellData&&(this.editCellData={}),this.keyCodes&&(this.keyCodes={}),this.parent=null},n.prototype.addEventListener=function(){e.Browser.isDevice&&"safari"===e.Browser.info.name&&(e.Browser.isIos||e.Browser.isIos7)?e.EventHandler.add(this.parent.element,"touchend",this.tapHandler,this):e.EventHandler.add(this.parent.element,"dblclick",this.dblClickHandler,this),this.parent.on(ai,this.mouseDownHandler,this),this.parent.on(pi,this.keyUpHandler,this),this.parent.on(ci,this.keyDownHandler,this),this.parent.on(si,this.performEditOperation,this),this.parent.on(vo,this.initiateCurPosition,this),this.parent.on(Co,this.updateFormulaBarValue,this),this.parent.on(bo,this.addressHandler,this),this.parent.on(xo,this.initiateRefSelection,this),this.parent.on(So,this.refSelectionRender,this),this.parent.on(Ee,this.checkUniqueRange,this),this.parent.on(Ne,this.reApplyFormula,this),this.parent.on(ra,this.sheetChangeHandler,this),this.parent.on(to,this.readOnlyAlertHandler,this),this.parent.on(ro,this.finiteAlertHandler,this)},n.prototype.removeEventListener=function(){e.Browser.isDevice&&"safari"===e.Browser.info.name&&(e.Browser.isIos||e.Browser.isIos7)?e.EventHandler.remove(this.parent.element,"touchend",this.tapHandler):e.EventHandler.remove(this.parent.element,"dblclick",this.dblClickHandler),this.parent.isDestroyed||(this.parent.off(ai,this.mouseDownHandler),this.parent.off(pi,this.keyUpHandler),this.parent.off(ci,this.keyDownHandler),this.parent.off(si,this.performEditOperation),this.parent.off(vo,this.initiateCurPosition),this.parent.off(Co,this.updateFormulaBarValue),this.parent.off(bo,this.addressHandler),this.parent.off(xo,this.initiateRefSelection),this.parent.off(So,this.refSelectionRender),this.parent.off(Ee,this.checkUniqueRange),this.parent.off(Ne,this.reApplyFormula),this.parent.off(ra,this.sheetChangeHandler),this.parent.off(to,this.readOnlyAlertHandler),this.parent.off(ro,this.finiteAlertHandler))},n.prototype.getModuleName=function(){return"edit"},n.prototype.performEditOperation=function(t){switch(t.action){case"renderEditor":if(this.renderEditor(),t.initLoad&&e.Browser.isDevice&&"safari"===e.Browser.info.name&&(e.Browser.isIos||e.Browser.isIos7)){var r=this.parent.createElement("div",{className:"e-ss-focus-edit",attrs:{contentEditable:"true",inputmode:"none",tabindex:"-1"}}),n=this.parent.element.querySelector(".e-sheet-panel");n&&(n.style.position="relative",n.appendChild(r)),this.parent.element.onfocus=function(){Md(r)}}break;case"refreshEditor":this.refreshEditor(t.value,t.refreshFormulaBar,t.refreshEditorElem,t.isAppend,t.trigEvent),t.refreshCurPos&&this.setCursorPosition();break;case"startEdit":if(this.isEdit){var i={isEdit:!1};this.parent.notify(ni,i),i.isEdit&&(this.isNewValueEdit=t.isNewValueEdit,this.startEdit(t.address,t.value,t.refreshCurPos))}else this.isNewValueEdit=t.isNewValueEdit,this.startEdit(t.address,t.value,t.refreshCurPos);break;case"endEdit":this.isEdit&&this.endEdit(t.refreshFormulaBar,null,t.isPublic);break;case"cancelEdit":this.isEdit&&this.cancelEdit(t.refreshFormulaBar);break;case"getCurrentEditValue":t.editedValue=this.editCellData.value,void 0!==t.endFormulaRef&&(t.endFormulaRef=this.endFormulaRef);break;case"refreshDependentCellValue":this.refreshDependentCellValue(t.rowIdx,t.colIdx,t.sheetIdx);break;case"getElement":t.element=this.getEditElement(this.parent.getActiveSheet());break;case"focusEditorElem":this.editorElem.focus();break;case"getCurrentEditSheetIdx":t.sheetIndex=this.editCellData.sheetIndex}},n.prototype.keyUpHandler=function(e){if(this.isEdit){var t=this.getEditElement(this.parent.getActiveSheet());if(e.altKey&&13===e.keyCode?(t.focus(),this.altEnter(),this.isAltEnter=!0):this.isCellEdit&&this.editCellData.value!==t.textContent&&16!==e.keyCode&&(!e.shiftKey||e.shiftKey&&!hd(e.keyCode))&&this.refreshEditor(t.textContent,this.isCellEdit),wr(this.editCellData.value,!0)&&(!e||16!==e.keyCode&&17!==e.keyCode&&(!e.shiftKey||!hd(e.keyCode)))&&(this.updateFormulaReference(t),this.endFormulaRef)){var r=this.getCurPosition(),n=["+","-","*","/",this.parent.listSeparator,"(","=","&",":"];r.end&&n.indexOf(this.editCellData.value[r.end-1])>-1&&(this.endFormulaRef=!1)}}},n.prototype.updateFormulaReference=function(e){var t=this.parent.element.querySelector(".e-formularef-indicator");t&&t.parentElement.removeChild(t),this.editCellData.value!==e.textContent&&this.refreshEditor(e.textContent,!0);var r=this.editCellData.sheetIndex,n=this.editCellData.value;this.parent.notify(mo,{range:n,formulaSheetIdx:r})},n.prototype.keyDownHandler=function(t){var n=t.target,i=t.keyCode,a=this.parent.getActiveSheet(),o=r(a.activeCell),s=zn(o[0],o[1],a,!1,!0),l=this.parent.enableKeyboardShortcut;if(!(0,e.closest)(n,".e-spreadsheet .e-dialog"))if(!a.isProtected||n.classList.contains("e-sheet-rename")||!Tr(s,Il(a,o[1]))||(n.classList.contains("e-formula-bar")||n.classList.contains("e-combobox"))&&!n.disabled){if(this.isEdit){var d=this.getEditElement(a),h=wr(this.editCellData.value,!0);if((this.isCellEdit||h&&this.editCellData.value!==d.textContent&&16!==t.keyCode&&17!==t.keyCode)&&(o[1]<this.parent.frozenColCount(a)&&(!a.frozenRows||o[0]>=this.parent.frozenRowCount(a))&&d&&"auto"!==d.style.height&&Ad(d.textContent,s.style,this.parent.cellStyle)>parseInt(d.style.maxWidth,10)&&(d.style.height="auto"),Ad(d.textContent,s.style,this.parent.cellStyle)>parseInt(d.style.maxWidth,10)-5&&(d.style.height="auto"),o[0]<this.parent.frozenRowCount(a)&&d&&!d.style.overflow&&Ad(d.textContent,s.style,this.parent.cellStyle)>parseInt(d.style.maxWidth,10)&&(d.style.overflow="auto"),(!t.shiftKey||t.shiftKey&&!hd(t.keyCode))&&this.refreshEditor(d.textContent,this.isCellEdit,!1,!1,!1)),!t.altKey)switch(i){case this.keyCodes.ENTER:if(e.Browser.isWindows&&t.preventDefault(),h){var p=this.parent.element.querySelector(".e-formularef-indicator");p&&p.parentElement.removeChild(p),Fn(this.parent,this.editCellData.sheetIndex).id===a.id||this.parent.goTo(this.editCellData.fullAddr),this.endEdit(!1,t)}else this.endEdit(!1,t);break;case this.keyCodes.TAB:this.hasFormulaSuggSelected()||this.endEdit(!1,t);break;case this.keyCodes.ESC:this.cancelEdit(!0,!0,t)}}else if(n.classList.contains("e-spreadsheet")||(0,e.closest)(n,".e-sheet-panel")){13===i&&"true"===n.contentEditable&&t.preventDefault();var c=String.fromCharCode(i),u=i>=this.keyCodes.FIRSTALPHABET&&i<=this.keyCodes.LASTALPHABET||c.toLowerCase()!==c.toUpperCase()&&!(i>=112&&i<=123),f=i>=this.keyCodes.FIRSTNUMBER&&i<=this.keyCodes.LASTNUMBER,g=i>=this.keyCodes.FIRSTNUMPAD&&i<=this.keyCodes.LASTNUMPAD,m=i>=this.keyCodes.SYMBOLSETONESTART&&i<=this.keyCodes.SYMBOLSETONEEND;m||(m=i>=this.keyCodes.SYMBOLSETTWOSTART&&i<=this.keyCodes.SYMBOLSETTWOEND);var v=i===this.keyCodes.FIREFOXEQUALPLUS||i===this.keyCodes.FIREFOXMINUS,y=!t.shiftKey&&!t.ctrlKey&&!t.metaKey&&i===this.keyCodes.F2&&l,C=i===this.keyCodes.BACKSPACE&&l,b=/(Macintosh|MacIntel|MacPPC|Mac68K|Mac|Mac OS|iPod|iPad)/i.test(navigator.userAgent)&&C,x=this.parent.element.querySelector(".e-readonly-alert-dlg"),S=this.parent.element.getElementsByClassName("e-ss-overlay-active");if((!t.ctrlKey&&!t.metaKey&&!t.altKey&&(!t.shiftKey&&i===this.keyCodes.SPACE||u||f||g||m||"mozilla"===e.Browser.info.name&&v)||y||C)&&(y&&(this.isNewValueEdit=!1),x||(Qr(this.parent)&&0===S.length?this.parent.notify(to,null):S.length?C&&!b&&this.editingHandler("delete"):(this.startEdit(null,null,!0,!0),Md(this.getEditElement(a))))),(i===this.keyCodes.DELETE||b)&&l){var w=a.isProtected&&Bd(this.parent);x||(w?this.parent.notify(eo,null):Qr(this.parent)&&0===S.length?this.parent.notify(to,null):(this.editingHandler("delete"),this.parent.notify(ve,null)))}}}else if((i>=this.keyCodes.FIRSTALPHABET&&i<=this.keyCodes.LASTALPHABET||i>=this.keyCodes.FIRSTNUMBER&&i<=this.keyCodes.LASTNUMBER||i===this.keyCodes.DELETE||i===this.keyCodes.BACKSPACE||i===this.keyCodes.SPACE||i>=this.keyCodes.FIRSTNUMPAD&&i<=this.keyCodes.LASTNUMPAD||i>=this.keyCodes.SYMBOLSETONESTART&&i<=this.keyCodes.SYMBOLSETONEEND||i>=219&&i<=222||!t.shiftKey&&!t.ctrlKey&&!t.metaKey&&i===this.keyCodes.F2)&&67!==i&&89!==i&&90!==i){if(a.protectSettings.insertLink&&75===i)return;if(t.altKey&&(65===i||70===i||72===i||77===i||78===i||87===i))return;t.ctrlKey||70===t.keyCode||this.parent.element.querySelector(".e-editAlert-dlg")||n.parentElement.classList.contains("e-unprotectpwd-content")||n.parentElement.classList.contains("e-password-content")||n.parentElement.classList.contains("e-sheet-password-content")||n.parentElement.classList.contains("e-unprotectsheetpwd-content")||n.parentElement.classList.contains("e-reenterpwd-content")||this.parent.notify(eo,null)}},n.prototype.renderEditor=function(){if(!this.editorElem||!(0,e.select)("#"+this.parent.element.id+"_edit",this.parent.element)){var t=this.parent.createElement("div",{id:this.parent.element.id+"_edit",className:"e-spreadsheet-edit",attrs:{contentEditable:"true",role:"textbox",spellcheck:"false","aria-multiline":"true"}});this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0]&&this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0].remove();var r=this.parent.element.querySelector(".e-sheet-content");if(!r)return;r.appendChild(t),this.editorElem=t}this.parent.notify(li,{action:"renderAutoComplete"})},n.prototype.refreshEditor=function(e,t,r,n,i,a){void 0===i&&(i=!0),n?e=this.editCellData.value=this.editCellData.value+e:this.editCellData.value=a||e;var o=this.getEditElement(this.parent.getActiveSheet());r&&o&&(o.textContent=e),t&&this.parent.notify(di,{action:"refreshFormulabar",value:e}),this.parent.isEdit&&o&&i&&this.editCellData.value===o.textContent&&this.triggerEvent("cellEditing").cancel&&this.cancelEdit(!1,!1,null,!0)},n.prototype.startEdit=function(e,t,n,i){void 0===n&&(n=!0),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true");var a=this.parent.getActiveSheet(),o=r(a.activeCell),s=zn(o[0],o[1],a,!1,!0);if("Manual"===this.parent.calculationMode&&wr(s.formula)&&(this.editCellData.prevFormulaValue=s.value),Id(this.parent,o[0],o[1],this.parent.activeSheetIndex)){var l=this.parent.getCell(o[0],o[1]),d=!1,h=l.innerHTML;if(l&&h.indexOf("<")>-1&&h.indexOf(">")>-1&&h.indexOf("input")>-1&&(d=!0),d)return}var p=this.updateEditCellDetail(e,t);this.initiateEditor(n,p),this.positionEditor(),this.parent.isEdit=this.isEdit=!0,this.parent.notify(Bi,null),this.parent.notify(Oi,[{enable:!1}]),s.formula&&!i&&this.parent.notify(mo,{range:s.formula,formulaSheetIdx:this.editCellData.sheetIndex})},n.prototype.setCursorPosition=function(){var e=this.getEditElement(this.parent.getActiveSheet()),t=e.textContent.length;if(t){var r=document.getSelection(),n=document.createRange();n.setStart(e.firstChild,t),n.collapse(!0),r.removeAllRanges(),r.addRange(n)}e.focus()},n.prototype.hasFormulaSuggSelected=function(){var e=document.getElementById(this.parent.element.id+"_ac_popup");return e&&"visible"===e.style.visibility&&e.querySelectorAll(".e-item-focus").length>0},n.prototype.editingHandler=function(r){var n,i=document.getElementsByClassName("e-ss-overlay-active"),o=i.length;if("delete"===r)if(o>0)i[0].classList.contains("e-datavisualization-chart")?this.parent.notify(Oo,{id:i[0].id,sheetIdx:this.parent.activeSheetIndex+1}):this.parent.notify(ko,{id:i[0].id,sheetIdx:this.parent.activeSheetIndex+1});else{var d=this.parent.getActiveSheet(),h=d.selectedRange,p=s(h);h=a(p=p[0]>p[2]||p[1]>p[3]?c(p):p);var u={address:d.name+"!"+h,cancel:!1};if(this.parent.notify(K,{action:"cellDelete",eventArgs:u}),u.cancel)return;p=t(h=l(u.address)),Ud(this.parent,p,this.parent.activeSheetIndex),this.parent.notify(rr,{}),0===p[0]&&0===p[1]&&p[2]>=d.usedRange.rowIndex&&p[3]>=d.usedRange.colIndex&&this.parent.setUsedRange(0,0,d,!1,!0);var f={cellIdx:p,isUnique:!1};if(this.checkUniqueRange(f),f.isUnique){var g=t(this.uniqueColl);(S=zn(g[0],g[1],this.parent.getActiveSheet()))&&S.value&&(n=S.value.toString().indexOf("#SPILL!")>-1)}if(f.isUnique&&this.uniqueColl.split(":")[0]===h.split(":")[0]){for(var m=t(this.uniqueColl),v=m[0];v<=m[2];v++)for(var y=m[1];y<=m[3];y++)this.parent.updateCellInfo({value:"",formula:""},a([v,y]),!0);this.parent.notify(Ie,null),this.uniqueColl=""}else if(f.isUnique){var C=t(this.uniqueColl);if("#SPILL!"===zn(C[0],C[1],d).value){var b=!1;for(y=C[0];y<=C[2];y++)for(var x=C[1];x<=C[3];x++){var S=zn(y,x,d);y===C[0]&&x===C[1]?b=!1:S&&!(0,e.isNullOrUndefined)(S.value)&&""!==S.value&&(b=!0)}b||this.reApplyFormula()}}f.isUnique?this.parent.notify(Pa,{action:"cellDelete",eventArgs:{address:d.name+"!"+h,isSpill:n}}):this.parent.notify(Pa,{action:"cellDelete",eventArgs:{address:d.name+"!"+h}})}},n.prototype.getCurPosition=function(){var e={},t=window.getSelection();if(t&&t.focusNode&&t.focusNode.classList&&t.focusNode.classList.contains("e-formula-bar-panel")){var r=t.focusNode.getElementsByClassName("e-formula-bar e-css")[0];r.value===this.editCellData.value&&(e.start=r.selectionStart,e.end=r.selectionEnd)}else if(this.getEditElement(this.parent.getActiveSheet()).textContent===this.editCellData.value&&(e.start=t.anchorOffset,e.end=t.focusOffset,e.start>e.end)){var n=e.start;e.start=e.end,e.end=n}return e},n.prototype.mouseDownHandler=function(t){if(!(0,e.closest)(t.target,".e-findtool-dlg")&&!(0,e.closest)(t.target,".e-validation-error-dlg")&&this.isEdit){var n=this.getCurPosition(),i=void 0,a=void 0;n.start&&(this.curStartPos=i=n.start),n.end&&(this.curEndPos=a=n.end);var o=t.target,s=this.parent.getActiveSheet(),l=this.parent.element.querySelector(".e-formularef-indicator");this.isCellEdit=o.classList.contains("e-spreadsheet-edit");var d=wr(this.editCellData.value,!0),h=this.getEditElement(s),p=["+","-","*","/",this.parent.listSeparator,"(","=","&",":"];if(o.classList.contains("e-cell")||o.classList.contains("e-header-cell")||o.classList.contains("e-selectall")||(0,e.closest)(o,".e-toolbar-item.e-active")||(0,e.closest)(o,".e-table"))if(!d||this.endFormulaRef)this.endFormulaRef=!1,this.endEdit(!1,t);else{var c=r(s.activeCell),u=zn(c[0],c[1],s),f=document.activeElement.classList.contains("e-formula-bar")?document.activeElement.value:h.textContent;if(this.editCellData.value===f)if(i===a){if(this.editCellData.sheetIndex!==In(this.parent,s.name)){if(-1===p.indexOf(f.substring(i-1,i)))return l&&l.parentElement.removeChild(l),this.parent.goTo(this.editCellData.fullAddr),void this.endEdit(!1,t)}else if(-1===p.indexOf(h.textContent.substring(i-1,i)))return l&&l.parentElement.removeChild(l),void this.endEdit(!1,t)}else-1!==p.indexOf(f.substring(i-1,i))&&Ir(f.substring(i,a))&&f.indexOf(":")!==a&&(this.editCellData.value=f.substring(0,i)+f.substring(a,f.length));if(!u)return;if((d=u.formula&&(wr(u.formula)||this.editCellData.value&&0===this.editCellData.value.toString().indexOf("=")))&&this.parent.isEdit){var g=a;this.editCellData.value.length===g?(")"===this.editCellData.value.substring(this.editCellData.value.length-1)||dn(this.editCellData.value.substring(this.editCellData.value.length-1)))&&(l&&l.parentElement.removeChild(l),this.endEdit(!1,t)):this.editCellData.value===f&&-1===p.indexOf(f.substring(g-1,g))&&(l&&l.parentElement.removeChild(l),this.endEdit(!1,t))}}else if(d&&this.editCellData.value===h.textContent&&h.textContent.indexOf("(")!==h.textContent.length-1&&!this.isCellEdit&&!o.classList.contains("e-formula-bar")&&-1===p.indexOf(this.editCellData.value.substring(i-1,i))&&Fn(this.parent,this.editCellData.sheetIndex).id===s.id){g=window.getSelection().focusOffset;if(-1===p.indexOf(h.textContent.substring(g-1,g)))return l&&l.parentElement.removeChild(l),this.parent.goTo(this.editCellData.fullAddr),void(this.isEdit&&this.endEdit(!1,t))}}},n.prototype.tapHandler=function(e){var t=this;if(!this.tapedTwice)return this.tapedTwice=!0,void setTimeout((function(){if(t.tapedTwice=!1,!t.parent.isEdit&&e.target.classList.contains("e-cell")){var r=t.parent.element.querySelector(".e-ss-focus-edit");r&&Md(r)}}),300);e.preventDefault(),this.dblClickHandler(e)},n.prototype.dblClickHandler=function(t){var n=t.target;if(!(0,e.closest)(n,".e-datavisualization-chart")&&!n.classList.contains("e-ss-overlay")&&(n.classList.contains("e-active-cell")||n.classList.contains("e-cell")||n.classList.contains("e-wrap-content")||(0,e.closest)(n,".e-sheet-content")||n.classList.contains("e-table"))){var i=this.parent.getActiveSheet(),a=r(i.activeCell),o=zn(a[0],a[1],i,!1,!0);if(Jr(o,Il(i,a[1]),fl(i,a[0])))this.parent.notify(to,null);else if(i.isProtected&&Tr(o,Il(i,a[1])))this.parent.notify(eo,null);else if(this.isEdit){if(!n.classList.contains("e-spreadsheet-edit"))if(wr(this.editCellData.value)){var s=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.lastIndexOf("!"));this.parent.getActiveSheet().name===s&&this.endEdit()}else this.endEdit()}else this.isNewValueEdit=!1,this.startEdit(),Md(this.getEditElement(i))}},n.prototype.updateEditCellDetail=function(r,n){var i,a,o;if(i=(0,e.isNullOrUndefined)(this.editCellData.sheetIndex)?r&&r.lastIndexOf("!")>-1?In(this.parent,Nn(r)):this.parent.activeSheetIndex:this.editCellData.sheetIndex,this.editCellData.addr?wr(this.editCellData.value,!0)&&(a=Fn(this.parent,i),this.isNewValueEdit=!1):(a=Fn(this.parent,i),r=r?l(r):a.activeCell),r){var s=t(r),d=s[0],h=s[1],p=zn(d,h,a,!1,!0);if(p.colSpan>1||p.rowSpan>1){var c={sheet:a,cell:p,rowIdx:d,colIdx:h};Xr(c),d=c.rowIdx,h=c.colIdx,o=c.isMergedHiddenCell}var u=this.parent.getCell(d,h),f=$l(a,s,this.parent.frozenRowCount(a),this.parent.frozenColCount(a),this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth);this.editCellData={addr:r,fullAddr:Pn(this.parent,i)+"!"+r,rowIndex:d,colIndex:h,sheetIndex:i,element:u,value:n||"",position:f,prevFormulaValue:this.editCellData.prevFormulaValue}}return o},n.prototype.initiateEditor=function(t,r){var n=this;gn(this.parent,this.editCellData.fullAddr,!1,r).then((function(r){n.parent&&r.forEach((function(r){var i,a=function(){var e={cell:r,value:r?r.value:"",showFormattedText:n.editCellData.showFormattedText};n.parent.notify(me,e),i=r?r.formula||e.value:"",n.editCellData.oldValue=i};a();var o,s=n.triggerEvent("cellEdit",null,i);s.cancel?n.cancelEdit(!0,!1,null,!0):(s.showFormattedText&&(n.editCellData.showFormattedText=!0,a()),n.editCellData.value?i=n.editCellData.value:n.editCellData.value=i,n.isNewValueEdit?(o=i,i=""):n.isNewValueEdit=!0,(0,e.isUndefined)(i)&&(i=""),n.refreshEditor(i,!1,!0,!1,!1,o),t&&n.setCursorPosition())}))}))},n.prototype.positionEditor=function(t){var r,n=this.editCellData.element,i={isEdit:!1};if(this.parent.notify(ni,i),i.isEdit&&(0,e.isNullOrUndefined)(n)&&(n=r=this.parent.getCell(this.editCellData.rowIndex,this.editCellData.colIndex),this.editCellData.element=r),n){n.classList.add("e-ss-edited");var a=this.parent.getActiveSheet(),o=zn(this.editCellData.rowIndex,this.editCellData.colIndex,a,!1,!0),s=this.editCellData.position.left+1,l=this.editCellData.position.top+1,d={range:[this.editCellData.rowIndex,this.editCellData.colIndex,this.editCellData.rowIndex,this.editCellData.colIndex]};this.parent.notify(Et,d);var h=bl(a,d.range[0],d.range[2])-3,p=Rl(a,d.range[1],d.range[3])-3,c=this.parent.getMainContent(),u=c.parentElement,f=void 0,g=this.parent.frozenColCount(a),m=void 0,v=void 0,y=this.parent.frozenRowCount(a),C=void 0;if(this.editCellData.colIndex<g)f=Math.abs(this.parent.getRowHeaderContent().getBoundingClientRect()[this.parent.enableRtl?"left":"right"]-n.getBoundingClientRect()[this.parent.enableRtl?"right":"left"])-1,this.editCellData.rowIndex<y?"2"===this.parent.getRowHeaderContent().style.zIndex&&(m="3"):Ad(o.value,o.style,this.parent.cellStyle)>f&&(C=!0);else{f=u.offsetWidth-(s-c.scrollLeft)-28-this.parent.sheetModule.getRowHeaderWidth(a);var b=n.getBoundingClientRect(),x=u.getBoundingClientRect(),S=this.parent.enableRtl?b.left:b.right,w=this.parent.enableRtl?x.left:x.right,I=this.parent.getScrollElement(),E=this.parent.sheetModule.getScrollSize();this.parent.enableRtl?w+E>S&&(I.scrollLeft-=b.width):w-E<S&&(I.scrollLeft+=b.width)}this.editCellData.rowIndex<y&&(v=!0);var N=!v&&(o&&o.wrap||n&&t||C)?"auto;":h+"px;",R="display:block;top:"+l+"px;"+(this.parent.enableRtl?"right:":"left:")+s+"px;min-width:"+p+"px;max-width:"+(o&&o.wrap?p:f)+"px;height:"+N+(o&&o.wrap?"width:"+p+"px;":"")+"min-height:"+h+"px;"+(m?"z-index: "+m+";":"")+(v&&(o&&!o.wrap||n&&t)&&(Ad(o.value,o.style,this.parent.cellStyle)>f||n&&t)?"overflow: auto;":"");n.style.cssText.split(";").forEach((function(e){e.includes("border")||(R+=e+";")}));var A=this.getEditElement(a,!0);A.style.cssText=R,Ad(A.textContent,o.style,this.parent.cellStyle)>f&&(A.style.height="auto");var k=this.parent.element.querySelector(".e-active-cell");k&&(k.style.height=h+4+"px"),n.classList.contains("e-right-align")?A.classList.add("e-right-align"):n.classList.contains("e-center-align")&&A.classList.add("e-center-align")}},n.prototype.updateEditedValue=function(e,r,n,i){var a=this,o=this.editCellData.oldValue;r&&(this.editCellData.value=r);var s=this.editCellData.value;this.parent.notify(Ea,{args:{action:"beforeCellSave",eventArgs:{address:this.editCellData.addr}}});var l=!0;if(this.parent.allowDataValidation){var d=this.parent.getActiveSheet(),h=t(d.activeCell),p=zn(h[0],h[1],d,!1,!0),c=Il(d,h[1]);if(p.validation||kl(c,h[0],h[1])){var u=this.editCellData.value||this.getEditElement(d).innerText,f=this.parent.activeSheetIndex,g={value:u,range:"string"==typeof this.editCellData.addr?t(this.editCellData.addr):this.editCellData.addr,sheetIdx:f,isEdit:!0,td:null,isValid:!0},m=Object.assign({},p,{value:u});jn(h[0],h[1],d,m),this.parent.notify(Je,g),jn(h[0],h[1],d,p),(l=g.isValid)?wr(u)||!p.format?this.editCellData.value||(this.editCellData.value=u):(u!==g.value||!this.editCellData.value&&g.value)&&(this.editCellData.value=g.value):this.isCellEdit=!0}}if(!i&&wr(this.editCellData.value)){var v={formula:this.editCellData.value};if(this.parent.notify(lr,v),v.isInvalid){var y;this.isCellEdit=!0,l=!1;var C=this.parent.serviceLocator.getService(Dl),b=this.parent.serviceLocator.getService(Ll);b.show({width:400,isModal:!0,showCloseIcon:!0,target:this.parent.element,cssClass:"e-validation-error-dlg",content:C.getConstant("CellReferenceTypoError")+"<br>"+v.formula,beforeOpen:function(){return a.editCellData.element.focus()},buttons:[{buttonModel:{content:C.getConstant("Yes"),isPrimary:!0},click:function(){y=!0,b.hide()}},{buttonModel:{content:C.getConstant("No")},click:function(){return b.hide()}}],close:function(){if(y)r=a.editCellData.value=v.formula,a.updateCell(o,e,r,s,n),a.parent.notify(di,{action:"refreshFormulabar",value:v.formula});else{var t=a.getEditElement(a.parent.getActiveSheet());t.innerText&&window.getSelection().selectAllChildren(t)}}},!1)}}l?this.updateCell(o,e,r,s,n):n&&n.preventDefault()},n.prototype.updateCell=function(r,n,i,a,o){var s=r?r.toString().toUpperCase():"",l=this.parent.getActiveSheet();(r||0===r)&&(r=r.toString());var d=this.editCellData.value;if(d&&(d=d.toString()),r!==d||wr(s)){this.isAltEnter&&d&&d.includes("\n")&&(qn(l.activeCell,!0,this.parent,!0),this.refreshEditor(d,this.isCellEdit,!1,!1,!1));var h=t(l.activeCell);r&&r.indexOf("=UNIQUE(")>-1&&""===this.editCellData.value&&this.parent.notify(Ie,null);var p={cellIdx:h,isUnique:!1};this.checkUniqueRange(p);var c=p.isUnique;if(c&&""!==r&&""===this.editCellData.value)if(-1===zn((b=t(this.uniqueColl))[0],b[1],l).value.toString().indexOf("#SPILL!"))return;r&&r.indexOf("UNIQUE")>-1&&this.editCellData.value&&this.editCellData.value.toString().indexOf("UNIQUE")>-1&&c&&this.updateUniqueRange("");var u={action:"updateCellValue",address:this.editCellData.addr,value:this.editCellData.value,skipCellFormat:this.editCellData.showFormattedText};this.parent.notify(ce,u);var f=zn(h[0],h[1],l,!0),g=void 0;(0,e.isNullOrUndefined)(f)||(g=f.value.toString());var m="#CIRCULARREF!"===g;if(this.formulaErrorStrings.indexOf(g)>-1||m){var v=void 0;if(o){var y=o.target;["e-toolbar-item","e-tab-wrap","e-text-wrap","e-tab-text","e-caret"].some((function(e){return y.classList.contains(e)}))&&(0,e.closest)(y,".e-ribbon")||["e-scroller","e-main-panel","e-autofill"].some((function(e){return y.classList.contains(e)}))||(v=this.showFormulaAlertDlg(g,m)),v||o.preventDefault()}if(!v)return delete f.value,delete f.formula,this.parent.notify(Re,{cellRef:l.activeCell,clearFormulaInfo:!0}),void(wr(s)?this.parent.updateCellInfo({formula:s},l.activeCell):r&&this.parent.updateCellInfo({value:r},l.activeCell));f.value="0"}var C=void 0;u.isFormulaDependent&&(C=Yr(this.parent,this.parent.viewport));var b,x=zn(h[0],h[1],l,!0),S=this.getRefreshNodeArgs(x,this.editCellData.element,this.editCellData.rowIndex,this.editCellData.colIndex);if(this.editCellData.value=S.value,this.parent.notify(Bt,{cell:null,rIdx:this.editCellData.rowIndex,cIdx:this.editCellData.colIndex,viewportIndexes:C}),x&&x.formula&&(this.editCellData.formula=x.formula),n&&this.parent.refreshNode(this.editCellData.element,S),x&&x.hyperlink&&this.parent.serviceLocator.getService("cell").refreshRange(h),l.conditionalFormats&&l.conditionalFormats.length&&this.parent.notify(kt,{indexes:[this.editCellData.rowIndex,this.editCellData.colIndex],isAction:!0,refreshAll:u.isFormulaDependent,isEdit:!0}),x&&x.wrap&&this.parent.notify(Ge,{range:h,wrap:!0,sheet:l}),c)if(zn((b=t(this.uniqueColl))[0],b[1],l).value.toString().indexOf("#SPILL!")>-1&&(this.isSpill=!0),""!==r&&""===this.editCellData.value||this.editCellData.formula&&this.editCellData.formula.length>1&&r!==this.editCellData.formula){for(var w=!1,I=b[0];I<=b[2];I++)for(var E=b[1];E<=b[3];E++){var N=zn(I,E,l);I===b[0]&&E===b[1]?w=!1:N&&!(0,e.isNullOrUndefined)(N.value)&&""!==N.value&&(w=!0)}w||this.reApplyFormula()}else this.updateUniqueRange(a)}else{if(this.editCellData.value&&this.editCellData.value.toString().includes("\n"))(x=zn(this.editCellData.rowIndex,this.editCellData.colIndex,l,!1,!0))&&!x.wrap&&qn(l.activeCell,!0,this.parent,!0)}this.triggerEvent("cellSave",o,i),this.resetEditState(),this.focusElement(o)},n.prototype.checkUniqueRange=function(e){var r={range:[]};this.parent.notify(we,r);var n=r.range;e.sheetName||(e.sheetName=this.parent.getActiveSheet().name);for(var i=0;i<n.length;i++)if(n[i].substring(0,n[i].lastIndexOf("!"))===e.sheetName)for(var o=t(n[i]),s=o[0];s<=o[2];s++)for(var l=o[1];l<=o[3];l++)if(e.cellIdx[0]===s&&e.cellIdx[1]===l){e.isUnique=!0,this.uniqueCell=!0;var d=""!==this.uniqueColl?t(this.uniqueColl):[0,0,0,0],h=t(n[i]);if(d[0]===h[0]&&d[1]===h[1]){var p=[d[0],h[1],d[0],h[1]];p[2]=d[2]>h[2]?d[2]:h[2],p[3]=d[3]>h[3]?d[3]:h[3],this.uniqueColl=a(p),e.uniqueRange=a(p)}else this.uniqueColl=n[i],e.uniqueRange=n[i]}},n.prototype.updateUniqueRange=function(e){var r=t(this.uniqueColl),n=!1;"#SPILL!"!==zn(r[0],r[1],this.parent.getActiveSheet()).value&&(n=!0);for(var i=r[0];i<=r[2];i++)for(var o=r[1];o<=r[3];o++)n&&(i===r[0]&&o===r[1]?this.parent.updateCellInfo({value:"#SPILL!"},a([i,o]),!0):a([i,o]).split(":")[0]===this.editCellData.addr?this.parent.updateCellInfo({value:e},a([i,o]),!0):this.parent.updateCellInfo({value:""},a([i,o]),!0))},n.prototype.reApplyFormula=function(){var e=t(this.uniqueColl),r=zn(e[0],e[1],this.parent.getActiveSheet());this.parent.updateCellInfo({value:""},a([e[0],e[1]]),!0);for(var n=this.parent.sheets,i=r.formula,o=0;o<n.length;o++)i.indexOf(n[o].name)>-1&&(i=i.replace(n[o].name,"!"+o));this.parent.notify(pe,{action:"computeExpression",formula:i}),this.uniqueCell=!1,""!==this.uniqueActCell&&(this.editCellData.value=this.uniqueActCell,this.uniqueActCell="")},n.prototype.refreshDependentCellValue=function(e,r,n){if(e&&r&&(e--,r--,(this.editCellData.rowIndex!==e||this.editCellData.colIndex!==r)&&this.parent.activeSheetIndex===n||this.uniqueCell&&this.parent.activeSheetIndex===n)){var i=Fn(this.parent,n),a=void 0;if(ml(i,e)||Al(i,r)||(a=this.parent.getCell(e,r)),a){if(a.parentElement){var o=a.parentElement.getAttribute("aria-rowindex");if(o&&Number(o)-1!==e)return}var s=zn(e,r,i),l=t(i.activeCell);l[0]===e&&l[1]===r&&(this.uniqueActCell=s.value);var d=this.getRefreshNodeArgs(s,a,e,r);this.parent.refreshNode(a,d)}}},n.prototype.getRefreshNodeArgs=function(e,t,r,n){var i={value:(e=e||{}).value,format:e.format,formattedText:e.formattedText&&""!==e.formattedText?e.formattedText:e.value,isRightAlign:!1,type:"General",cell:e,rowIndex:r,td:t,colIndex:n,refresh:!0,isEdit:!0};return this.parent.notify(re,i),i},n.prototype.endEdit=function(e,t,r){void 0===e&&(e=!1),e&&this.refreshEditor(this.editCellData.oldValue,!1,!0,!1,!1);var n=this.triggerEvent("beforeCellSave");if(n.cancel)this.parent.isEdit&&t&&t.preventDefault();else{if(!this.isAltEnter&&n.value&&n.value.toString().indexOf("\n")>-1){var i=zn(this.editCellData.rowIndex,this.editCellData.colIndex,this.parent.getActiveSheet());qn(this.parent.getActiveSheet().activeCell,!i||!1!==i.wrap,this.parent),this.refreshEditor(n.value,this.isCellEdit,!1,!1,!1)}this.updateEditedValue(!0,n.value,t,r)}},n.prototype.cancelEdit=function(e,t,r,n){void 0===e&&(e=!0),void 0===t&&(t=!0),this.refreshEditor(this.editCellData.oldValue,e,!1,!1,!1),n||(t?this.triggerEvent("cellSave",r,void 0,!0):this.triggerEvent("cellEdited")),this.resetEditState(),this.focusElement()},n.prototype.focusElement=function(e){if(e&&9===e.keyCode&&document.activeElement.classList.contains("e-formula-bar")){var t=this.parent.element.querySelector(".e-formula-bar-panel "+(e.shiftKey?".e-insert-function":".e-combobox"));t&&Md(t)}else Md(this.parent.element);this.parent.notify(Oi,[{enable:!0}])},n.prototype.triggerEvent=function(e,r,n,i){var a=this.parent.getActiveSheet(),o=zn(this.editCellData.rowIndex,this.editCellData.colIndex,a),s={element:this.editCellData.element,value:n||this.editCellData.value,oldValue:this.editCellData.oldValue,address:this.editCellData.fullAddr,displayText:this.parent.getDisplayText(o),previousFormulaValue:this.editCellData.prevFormulaValue};if(s.address){var l={cellIdx:t(s.address),isUnique:!1};this.checkUniqueRange(l),l.isUnique&&(s.isSpill=this.isSpill)}var d=(s.value?s.value.toString():s.value)!==(s.oldValue||0===s.oldValue?s.oldValue.toString():s.oldValue);if(!d&&(i||!wr(s.value)||o&&o.format&&"Text"===zs(o.format)))"beforeCellSave"!==e&&("cellSave"===e?this.parent.trigger("cellEdited",s):this.parent.trigger(e,s));else{if("cellSave"!==e&&(s.cancel=!1),"beforeCellSave"===e)if(this.parent.notify(K,{eventArgs:s,action:"cellSave",preventAction:!0}),o=wr(s.value)?{formula:s.value}:{value:s.value},Vr(this.parent,a,{cell:o,rowIdx:this.editCellData.rowIndex,colIdx:this.editCellData.colIndex,eventOnly:!0}))return this.cancelEdit(!1,!1,null,!0),s.cancel=!0,s;this.parent.trigger(e,s),"cellSave"===e&&(this.parent.trigger("cellEdited",s),this.editCellData.formula?s.formula=this.editCellData.formula:d||(s.formula=s.value),o.format&&(s.format=o.format),s.originalEvent=r,this.parent.notify(Pa,{eventArgs:s,action:"cellSave"}))}return s},n.prototype.altEnter=function(){this.positionEditor(!0);var e,t=window.getSelection(),r=t.anchorNode,n=document.createRange();0===(e=3===r.nodeType?t.anchorOffset:r.textContent.length)&&r.textContent.length>0&&(e=r.textContent.length);var i=r.textContent,a=i.slice(0,e),o=i.slice(e)||" ";r.textContent=a+"\n"+o,n=document.createRange(),3===r.nodeType?(n.setStart(r,e+1),n.setEnd(r,e+1)):1===r.nodeType&&(n.setStart(r.firstChild,e+1),n.setEnd(r.firstChild,e+1)),t.removeAllRanges(),t.addRange(n)},n.prototype.resetEditState=function(t){if(void 0===t&&(t=!0),t){var r=this.getEditElement(this.parent.getActiveSheet());(wr(r.textContent)||""===r.textContent)&&this.parent.notify(yo,null),this.editCellData.element&&(this.editCellData.element.classList.remove("e-ss-edited"),this.editorElem.textContent="",r===this.editorElem?(this.editorElem.removeAttribute("style"),this.editorElem.classList.remove("e-right-align")):(0,e.detach)(r))}if(this.editCellData={},this.parent.isEdit=this.isEdit=!1,this.isCellEdit=!0,this.isAltEnter=!1,this.parent.notify(li,{action:"endEdit"}),this.parent.showSheetTabs&&!this.parent.isProtected){var n=this.parent.element.querySelector(".e-add-sheet-tab");n&&n.removeAttribute("disabled")}},n.prototype.refSelectionRender=function(){var e=this.getEditElement(this.parent.getActiveSheet());e&&(wr(e.textContent)&&this.parent.notify(mo,{range:e.textContent,formulaSheetIdx:this.editCellData.sheetIndex}),(e=this.parent.getCell(this.editCellData.rowIndex,this.editCellData.colIndex))&&(this.editCellData.element=e))},n.prototype.initiateRefSelection=function(){var e=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.lastIndexOf("!")),t=this.editCellData.value;this.parent.getActiveSheet().name===e&&wr(this.editCellData.value,!0)?(this.startEdit(this.editCellData.addr,t,!1),this.parent.notify(mo,{range:this.editCellData.value,formulaSheetIdx:this.editCellData.sheetIndex}),this.getEditElement(this.parent.getActiveSheet()).textContent=t,this.initiateCurPosition()):this.initiateCurPosition()},n.prototype.addressHandler=function(e){var t=this.parent.serviceLocator.getService(Ll).dialogInstance;if(t&&t.element&&t.element.classList.contains("e-validation-error-dlg"))e.isAlertDlgOpen=!0;else{if(!this.curStartPos){var r=this.getCurPosition();r.start&&(this.curStartPos=r.start),r.end&&(this.curEndPos=r.end)}var n=e.range,i=this.editCellData.sheetIndex,a=this.getEditElement(this.parent.getActiveSheet());this.parent.activeSheetIndex!==i&&(n="'"+this.parent.getActiveSheet().name+"'!"+n,e.isNameBoxSelect&&(i=this.parent.activeSheetIndex));var o=this.editCellData.value;if(e.isSelect)this.parent.notify(mo,{range:o+n,formulaSheetIdx:i});else if(this.parent.activeSheetIndex===i){var s=document.activeElement.classList.contains("e-formula-bar")?document.activeElement.value:a.textContent;e.isNameBoxSelect&&(this.parent.notify(mo,{range:o+n,formulaSheetIdx:i}),this.curStartPos=o.length);var l=void 0,d=void 0;e.isMouseDown&&s!==o?(l=s.substring(0,this.curEndPos)+this.parent.listSeparator,d=s.substring(this.curEndPos),this.refreshEditor(l+d,!1,!0),this.parent.notify(mo,{range:a.textContent,formulaSheetIdx:i}),this.curEndPos+=this.parent.listSeparator.length,this.curStartPos=this.curEndPos,l+=n):(l=o.substring(0,this.curStartPos)+n,d=o.substring(this.curStartPos),e.isNameBoxSelect&&this.refreshEditor(l+d,!0,!0)),a.textContent=l+d,this.curEndPos=l.length}}},n.prototype.updateFormulaBarValue=function(e){var t=this.editCellData.value,r=this.parent.getActiveSheet().selectedRange.split(" "),n=r[r.length-1];n=m(s(n))?n.split(":")[0]:n;var i=this.parent.element.querySelector(".e-formula-bar");if(t&&wr(t,!0)){var a=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.lastIndexOf("!")),o=this.parent.getActiveSheet().name!==a;o&&(n="'"+this.parent.getActiveSheet().name+"'!"+n);var l=void 0,d=void 0;o&&e.isMouseDown&&r.length>1&&e.formulaBarVal&&e.formulaBarVal!==t?(l=e.formulaBarVal.substring(0,this.curEndPos)+this.parent.listSeparator,d=e.formulaBarVal.substring(this.curEndPos),this.refreshEditor(l+d,!0),this.curEndPos+=this.parent.listSeparator.length,this.curStartPos=this.curEndPos,l+=n):(l=t.substring(0,this.curStartPos)+n,d=t.substring(this.curStartPos)),i.value=l+d,this.curEndPos=l.length}},n.prototype.setFormulaBarCurPosition=function(e,t,r){e.setSelectionRange&&(e.focus(),e.selectionStart=t,e.selectionEnd=t,e.setSelectionRange(t,r))},n.prototype.initiateCurPosition=function(e){void 0===e&&(e={isCellEdit:!1});var t=this.getEditElement(this.parent.getActiveSheet(),!0);if(e.isCellEdit){var r=this.getCurPosition();if(!this.endFormulaRef&&r.start===r.end){this.updateFormulaReference(t);var n=["+","-","*","/",this.parent.listSeparator,"(","=","&",":"];r.end&&-1===n.indexOf(this.editCellData.value[r.end-1])&&(this.endFormulaRef=!0)}}else{var i=t.innerText,a=window.getSelection();if(a&&a.focusNode&&a.focusNode.classList&&a.focusNode.classList.contains("e-formula-bar-panel")){var o=this.parent.element.querySelector(".e-formula-bar");this.setFormulaBarCurPosition(o,this.curEndPos,this.curEndPos)}else{if(i){var s=document.createRange();i.indexOf(")"),i.length,s.setStart(t.childNodes[0],this.curEndPos),s.setEnd(t.childNodes[0],this.curEndPos),a.removeAllRanges(),a.addRange(s)}if(this.editCellData.sheetIndex!==this.parent.activeSheetIndex){var l=this.parent.element.querySelector(".e-formula-bar");l.value&&(l.value.indexOf(")")===this.curEndPos-1?this.setFormulaBarCurPosition(l,this.curEndPos-1,this.curEndPos-1):this.setFormulaBarCurPosition(l,this.curEndPos,this.curEndPos))}}}},n.prototype.getEditElement=function(e,t){if((this.isEdit||t)&&(e.frozenRows||e.frozenColumns)){var n=this.parent.frozenRowCount(e),i=this.parent.frozenColCount(e),a=r(e.activeCell),o=void 0;if(a[0]<n&&a[1]<i)o=this.parent.getSelectAllContent();else if(a[0]<n)o=this.parent.getColumnHeaderContent();else{if(!(a[1]<i))return this.editorElem;o=this.parent.getRowHeaderContent()}var s=o.getElementsByClassName("e-spreadsheet-edit")[0];return!s&&t&&(s=o.appendChild(this.editorElem.cloneNode())),s}return this.editorElem},n.prototype.sheetChangeHandler=function(){this.isEdit||(this.editCellData.value=null)},n.prototype.showFormulaAlertDlg=function(e,t){var r,n,i=this,a=this.parent.serviceLocator.getService(Dl),o=this.parent.serviceLocator.getService("dialog"),s=this.getFormulaErrorKey(e),l=a.getConstant(s),d=o.dialogInstance;return d&&d.visible&&d.element.classList.contains("e-circularref-dlg")||o.show({width:400,isModal:!0,showCloseIcon:!0,target:this.parent.element,cssClass:"e-validation-error-dlg e-circularref-dlg",content:l,beforeOpen:function(e){if(t){var a=i.parent.getActiveSheet(),s={dialogName:"CircularReferenceDialog",element:e.element,target:e.target,cancel:e.cancel,cellAddress:a.name+"!"+a.activeCell,content:l};if(i.parent.trigger("dialogBeforeOpen",s),s.cancel)return void(e.cancel=n=!0);s.content!==l&&(o.dialogInstance.content=s.content,o.dialogInstance.dataBind())}if(window.getSelection().rangeCount>0){var d=window.getSelection().getRangeAt(0);r=d.endOffset}},buttons:[{buttonModel:{content:a.getConstant("Ok"),isPrimary:!0},click:function(){return o.hide()}}],close:function(){if(!n){var e=i.getEditElement(i.parent.getActiveSheet());if(e.childElementCount){var t=e.textContent;r=t.length,e.textContent=t}var a=document.getSelection(),o=document.createRange();o.setStart(e.firstChild,r),o.collapse(!0),a.removeAllRanges(),a.addRange(o),e.focus()}}},!1),n},n.prototype.getFormulaErrorKey=function(e){var t;switch(e){case"invalid arguments":t="InvalidArguments";break;case"improper formula":t="ImproperFormula";break;case"empty expression":t="EmptyExpression";break;case"mismatched parentheses":t="MismatchedParenthesis";break;case"mismatched string quotes":t="MismatchedStringQuotes";break;case"wrong number of arguments":t="WrongNumberOfArguments";break;case"requires 3 arguments":t="Requires3Arguments";break;case"#CIRCULARREF!":t="FormulaCircularRef";break;default:t="InvalidFormulaError"}return t},n.prototype.readOnlyAlertHandler=function(){var t,r=this,n=this.parent.serviceLocator.getService(Dl),i=this.parent.serviceLocator.getService("dialog"),a=this.parent.element.querySelector(".e-find-dlg");(0,e.isNullOrUndefined)(a)||(t=(0,e.getComponent)(a,"dialog")),i.show({content:n.getConstant("ReadonlyAlert"),isModal:!0,closeOnEscape:!0,showCloseIcon:!0,width:"400px",cssClass:"e-readonly-alert-dlg",beforeOpen:function(e){var t={dialogName:"ReadOnlyAlertDialog",content:n.getConstant("ReadonlyAlert"),element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel?e.cancel=!0:(i.dialogInstance.content=t.content,Md(r.parent.element))},close:function(){(0,e.isNullOrUndefined)(a)||(i.dialogInstance=t),Md(r.parent.element)}})},n.prototype.finiteAlertHandler=function(){var e=this.parent.serviceLocator.getService(Dl);this.parent.serviceLocator.getService("dialog").show({header:e.getConstant("Alert"),content:e.getConstant("FiniteAlert"),isModal:!0,closeOnEscape:!0,showCloseIcon:!0,width:"400px",cssClass:"e-finite-alert-dlg"})},n}(),lh=function(){function n(e){this.invalidOperators=["%"],this.formulaRange=[],this.isNoteActiveElement=!1,this.isNoteTouch=!1,this.parent=e,this.addEventListener(),this.mouseMoveEvt=this.mouseMoveHandler.bind(this)}return n.prototype.addEventListener=function(){this.parent.on(ii,this.init,this),this.parent.on(ai,this.mouseDownHandler,this),this.parent.on(bi,this.virtualContentLoadedHandler,this),this.parent.on(Si,this.cellNavigateHandler,this),this.parent.on(Ti,this.selectRange,this),this.parent.on(Ji,this.rowHeightChanged,this),this.parent.on(Qi,this.colWidthChanged,this),this.parent.on(ao,this.protectHandler,this),this.parent.on(mo,this.initiateFormulaSelection,this),this.parent.on(yo,this.clearBorder,this),this.parent.on(No,this.getRowIdxFromClientY,this),this.parent.on(Ro,this.getColIdxFromClientX,this),this.parent.on(cr,this.getRowIdxFromClientY,this),this.parent.on(ur,this.getColIdxFromClientX,this),this.parent.on(Po,this.chartBorderHandler,this),this.parent.on(Ko,this.isTouchSelectionStarted,this),this.parent.on(Di,this.selectionByKeydown,this)},n.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ii,this.init),this.parent.off(ai,this.mouseDownHandler),this.parent.off(bi,this.virtualContentLoadedHandler),this.parent.off(Si,this.cellNavigateHandler),this.parent.off(Ti,this.selectRange),this.parent.off(Ji,this.rowHeightChanged),this.parent.off(Qi,this.colWidthChanged),this.parent.off(ao,this.protectHandler),this.parent.off(mo,this.initiateFormulaSelection),this.parent.off(yo,this.clearBorder),this.parent.off(No,this.getRowIdxFromClientY),this.parent.off(Ro,this.getColIdxFromClientX),this.parent.off(cr,this.getRowIdxFromClientY),this.parent.off(ur,this.getColIdxFromClientX),this.parent.off(Po,this.chartBorderHandler),this.parent.off(Ko,this.isTouchSelectionStarted),this.parent.off(Di,this.selectionByKeydown))},n.prototype.isTouchSelectionStarted=function(e){e.touchSelectionStarted=this.touchSelectionStarted},n.prototype.selectionByKeydown=function(e){this.selectRangeByIdx(e.range,e.e,!1,!1,!1,!1,void 0,!1)},n.prototype.rowHeightChanged=function(e){var n=this;e.threshold&&zl((function(){if(n.parent){var i=n.parent.getActiveSheet(),a=n.getActiveCell();if(a&&(i.frozenRows||i.frozenColumns||i.selectedRange.includes(" ")))n.selectRange({address:i.selectedRange,isRowHeightChanged:!0});else{var o,s=c(t(i.selectedRange)),l={range:s,isActiveCell:!1,skipChecking:!0};if(a){var d=r(i.activeCell)[0];if(n.parent.notify(It,l),l.isActiveCell)o=zn(s[0],s[1],i,!1,!0).rowSpan>1&&s[0]<=e.rowIdx&&s[2]>=e.rowIdx;d===e.rowIdx||o?a.style.height=parseFloat(a.style.height)+e.threshold+"px":d>e.rowIdx&&(a.style.top=parseFloat(a.style.top)+e.threshold+"px")}if(a=n.getSelectionElement()){if(o||s[0]===s[2]&&s[1]===s[3])return;var h=s[0],p=s[2];h<=e.rowIdx&&p>=e.rowIdx&&a?a.style.height=parseFloat(a.style.height)+e.threshold+"px":h>e.rowIdx&&a&&(a.style.top=parseFloat(a.style.top)+e.threshold+"px")}}}}))},n.prototype.colWidthChanged=function(e){var n=this;e.threshold&&zl((function(){if(n.parent){var i=n.parent.getActiveSheet(),a=n.getActiveCell(),o=n.parent.enableRtl;if(a&&(i.frozenRows||i.frozenColumns||i.selectedRange.includes(" ")))n.selectRange({address:i.selectedRange});else{var s,l=c(t(i.selectedRange)),d={range:l,isActiveCell:!1,skipChecking:!0};if(a){n.parent.notify(It,d);var h=r(i.activeCell)[1];if(d.isActiveCell){var p=zn(l[0],l[1],i,!1,!0);s=p.rowSpan>1||p.colSpan>1}h===e.colIdx||s?a.style.width=parseFloat(a.style.width)+e.threshold+"px":h>e.colIdx&&(o?a.style.right=parseFloat(a.style.right)+e.threshold+"px":a.style.left=parseFloat(a.style.left)+e.threshold+"px")}if((a=n.getSelectionElement())&&!s&&(l[0]!==l[2]||l[1]!==l[3])){var u=l[1],f=l[3];u<=e.colIdx&&f>=e.colIdx&&a?a.style.width=parseFloat(a.style.width)+e.threshold+"px":u>e.colIdx&&a&&(o?a.style.right=parseFloat(a.style.right)+e.threshold+"px":a.style.left=parseFloat(a.style.left)+e.threshold+"px")}}}}))},n.prototype.selectRange=function(e){e.address="Single"===this.parent.selectionSettings.mode?a(r(e.address)):e.address,this.selectMultiRange(e.address,null,null,e.skipChecking,e.isRowHeightChanged)},n.prototype.init=function(){this.createSelectionElement();var e=this.parent.getActiveSheet(),n=c(t(e.selectedRange)),i=r(e.activeCell),a=n[0]<=i[0]&&n[2]>=i[0]&&n[1]<=i[1]&&n[3]>=i[1];this.selectMultiRange(e.selectedRange,!0,a)},n.prototype.selectMultiRange=function(e,r,n,i,a){var o=this,s=this.parent.activeSheetIndex;e.indexOf("!")>-1&&(s=In(this.parent,Nn(e)),e=e.substring(e.lastIndexOf("!")+1)),this.parent.activeSheetIndex===s?e.split(" ").forEach((function(e,s){o.selectRangeByIdx(t(e),{type:"mousedown",ctrlKey:0!==s},null,n,r,i,void 0,!1,a)})):An(this.parent,e,this.parent.sheets[s])},n.prototype.createSelectionElement=function(){var e=this.parent.getMainContent(),t=this.parent.createElement("div",{className:"e-selection"});e.appendChild(t),t=this.parent.createElement("div",{className:"e-active-cell"}),e.appendChild(t)},n.prototype.isMergeActiveCell=function(e,t,r,n){var i=zn(r,n,e,!1,!0);if(i.rowSpan&&1!==i.rowSpan||i.colSpan&&1!==i.colSpan){var a={range:[r,n,r,n]};this.parent.notify(Et,a);var o=a.range;return o[0]===t[0]&&o[1]===t[1]}return!1},n.prototype.mouseDownHandler=function(n){var i=this;if(this.isNoteActiveElement=!(0,e.isNullOrUndefined)(document)&&!(0,e.isNullOrUndefined)(document.activeElement)&&"string"==typeof document.activeElement.className&&document.activeElement.className.indexOf("e-addNoteContainer")>-1,!((0,e.closest)(n.target,".e-scrollbar")||n.target.classList.contains("e-main-panel")||n.target.classList.contains("e-sheet"))){var o={action:"getCurrentEditValue",editedValue:""},l=this.parent.getActiveSheet();this.parent.notify(si,o);var d=wr(o.editedValue,!0),h=this.parent.enableNotes&&!(0,e.isNullOrUndefined)(this.parent.spreadsheetNoteModule.noteCellIndexes)?this.parent.spreadsheetNoteModule.noteCellIndexes:r(this.parent.getActiveSheet().activeCell),p=this.parent.getCell(h[0],h[1]);if(!(0,e.isNullOrUndefined)(p)&&null!==p.children&&p.children.length>0&&this.isNoteActiveElement&&p.children[p.children.length-1].classList.contains("e-addNoteIndicator")){var c=zn(h[0],h[1],l),u=!(0,e.isNullOrUndefined)(c)&&c.notes?"editNote":"addNote",f=document.getElementsByClassName("e-addNoteContainer")[0],g=Pn(this.parent,this.parent.activeSheetIndex)+"!"+a(h);if((0,e.isNullOrUndefined)(f)||(0,e.isNullOrUndefined)(f.value)||"e-addNoteContainer"===n.target.className||!(0,e.isNullOrUndefined)(c)&&!(0,e.isNullOrUndefined)(c.notes)&&c.notes===f.value)"e-addNoteContainer"!==n.target.className&&Vr(this.parent,this.parent.getActiveSheet(),{rowIdx:h[0],colIdx:h[1],preventEvt:!0,cell:{isNoteEditable:!1}});else{this.parent.notify(Ea,{args:{action:"beforeCellSave",eventArgs:{address:g}}}),Vr(this.parent,this.parent.getActiveSheet(),{rowIdx:h[0],colIdx:h[1],preventEvt:!0,cell:{notes:f.value,isNoteEditable:!1}});var v={notes:f.value,address:g};this.parent.notify(Pa,{eventArgs:v,action:u})}this.parent.spreadsheetNoteModule.isShowNote=null}if(!this.isNoteTouch&&"e-addNoteContainer"!==n.target.className&&document.getElementsByClassName("e-addNoteContainer")&&document.getElementsByClassName("e-addNoteContainer").length>0&&this.parent.notify(ya,""),this.isNoteTouch&&n.type.indexOf("mouse")>-1&&(this.isNoteTouch=!1),!this.parent.isEdit||d){var y=document.getElementById(this.parent.element.id+"_overlay");if("string"==typeof n.target.className){if(n.target.className.indexOf("e-ss-overlay")>-1)return}else y&&y.classList.remove("e-ss-overlay-active");if((0,e.closest)(n.target,".e-datavisualization-chart"))return;if(l.isProtected&&!l.protectSettings.selectCells&&!l.protectSettings.selectUnLockedCells)return;if(!(0,e.closest)(n.target,".e-findtool-dlg")&&!(0,e.closest)(n.target,".e-dragfill-ddb")&&this.getSheetElement().contains(n.target)&&!n.target.classList.contains("e-colresize")&&!n.target.classList.contains("e-rowresize")){var C,b=this.parent.getActiveSheet(),x=this.parent.selectionSettings.mode,S=pd(n),w=cd(n),I=this.getRowIdxFromClientY({clientY:w,target:n.target}),E=this.getColIdxFromClientX({clientX:S,target:n.target}),N=r(b.activeCell),R=void 0;if(b.showHeaders){var A=n.target;if(b.frozenColumns||b.frozenRows){var k=this.parent.getSelectAllContent().querySelector("thead");R=k?(this.parent.getColumnHeaderContent().contains(A)||k.contains(A))&&A.classList.contains("e-header-cell")||A.classList.contains("e-selectall-table")&&I<0&&E>=this.parent.frozenColCount(b):this.parent.getColumnHeaderContent().contains(A)&&A.classList.contains("e-header-cell"),C=(k=this.parent.getSelectAllContent().querySelector("tbody"))?(this.parent.getRowHeaderContent().contains(A)||k.contains(A))&&A.classList.contains("e-header-cell")||A.classList.contains("e-selectall-table")&&E<0&&I>=this.parent.frozenRowCount(b):this.parent.getRowHeaderContent().contains(A)&&A.classList.contains("e-header-cell"),-1===I&&(I=0),-1===E&&(E=0)}else C=this.parent.getRowHeaderContent().contains(n.target),R=this.parent.getColumnHeaderContent().contains(n.target)}if((b.frozenRows||b.frozenColumns)&&!R&&!C){var O=n.target,F=["e-rowhdr-table","e-selectall-table","e-colhdr-table"].findIndex((function(e){return O.classList.contains(e)}));if(F>-1){var T=[".e-row-header",".e-selectall-container",".e-column-header"][F],D=(0,e.closest)(O,T);if(D&&D.style.zIndex)if((c=zn(I,E,b))&&c.validation&&"List"===c.validation.type||kl(b.columns[E],I,E)&&"List"===b.columns[E].validation.type){var L=this.parent.getCell(I,E);if(L){var P=L.querySelector(".e-validation-list");if(P){var M=P.getBoundingClientRect();if(S>=M.left&&S<=M.right&&w>=M.top&&w<=M.bottom){var B=P.querySelector(".e-dropdownlist");if(B){var H=(0,e.getComponent)(B,"dropdownlist");H&&H.showPopup()}}}}}}}if(3===n.which&&this.isSelected(I,E))return;if(n.target.classList.contains("e-autofill")){this.isautoFillClicked=!0;var U=n.target.parentElement.querySelector(".e-dragfill-ddb");U&&!U.classList.contains("e-hide")||(this.dAutoFillCell=b.selectedRange)}var V=t(b.topLeftCell),z=void 0;if(C?(this.isRowSelected=!0,n.shiftKey&&"Single"!==x?this.startCell||(this.startCell=[V[0],0]):this.startCell=[I,0],z=[this.startCell[0],b.frozenColumns?V[1]:0,I,b.colCount-1]):R?(this.isColSelected=!0,n.shiftKey&&"Single"!==x?this.startCell||(this.startCell=[0,V[1]]):this.startCell=[0,E],z=[b.frozenRows?V[0]:0,this.startCell[1],b.rowCount-1,E]):(0,e.closest)(n.target,".e-select-all-cell")?(this.startCell=[b.frozenRows?V[0]:0,b.frozenColumns?V[1]:0],z=[].concat(this.startCell,[b.rowCount-1,b.colCount-1])):n.target.classList.contains("e-sheet-content")||(n.shiftKey&&"Single"!==x||(this.startCell=[I,E]),this.isautoFillClicked||(0,e.closest)(n.target,".e-filloption")||(z=[].concat(this.startCell?this.startCell:r(b.activeCell),[I,E]))),id(n)&&!C&&!R&&z){var j=this.isRowColSelected(z);this.isRowSelected=j.isRowSelected,this.isColSelected=j.isColSelected}var _=n.ctrlKey&&z&&b.selectedRange.includes(a(z));if(!_&&"Multiple"===x&&(!od(n)&&(!id(n)||id(n)&&(N[0]===I&&N[1]===E||this.isMergeActiveCell(b,N,I,E)))||R||C)?(document.addEventListener(rd().split(" ")[0],this.mouseMoveEvt),e.Browser.isPointer||(e.Browser.isIos&&id(n)&&n.target&&n.target.classList.contains("e-cell")&&n.preventDefault(),document.addEventListener(rd().split(" ")[1],this.mouseMoveEvt,{passive:!1})),this.touchSelectionStarted=!0):this.touchSelectionStarted=!1,!od(n))if(_){if(this.parent.isEdit){var q=function(t){e.EventHandler.remove(document,nd(),q),i.updateFormulaCursorPosition(t)};e.EventHandler.add(document,nd(),q,this)}}else e.EventHandler.add(document,nd(),this.mouseUpHandler,this);var W="e-addNoteIndicator"===n.target.className||n.target.children.length>0&&n.target.children[n.target.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1;if(id(n)&&W){var G=r(a(z).split(":")[0]);this.parent.notify(ga,{rowIndex:G[0],columnIndex:G[1],isNoteEditable:!1}),this.isNoteTouch=!0,this.parent.spreadsheetNoteModule.isNoteVisibleOnTouch=!0}if(id(n)&&!R&&!C)return void(this.touchEvt=n);if(z&&this.selectRangeByIdx(z,n),!this.isNoteTouch&&n.type.indexOf("mouse")>-1&&W){var Y=r(a(z).split(":")[0]);this.parent.notify(ga,{rowIndex:Y[0],columnIndex:Y[1],isNoteEditable:!1}),this.parent.spreadsheetNoteModule.isNoteVisible=!0}this.parent.isMobileView()&&(this.parent.element.classList.add("e-mobile-focused"),this.parent.renderModule.setSheetPanelSize())}}if(d&&(n.target.classList.contains("e-cell")||n.target.classList.contains("e-wrap-content")||n.target.classList.contains("e-header-cell"))&&this.parent.isEdit){var X=(z=this.parent.getActiveSheet().selectedRange).split(" ");z=m(s(X[X.length-1]))?X[X.length-1].split(":")[0]:X[X.length-1],this.parent.notify(bo,{range:z,isSelect:!1,isMouseDown:n.ctrlKey})}}},n.prototype.mouseMoveHandler=function(n){var i=this,o=this.parent.getActiveSheet();ad(n)&&n.preventDefault();var s={action:"getCurrentEditValue",editedValue:""};this.parent.notify(si,s);var l,d,h=wr(s.editedValue,!0),p=this.parent.getMainContent().parentElement,c=this.parent.element.getElementsByClassName("e-scroller")[0],u=p.getBoundingClientRect(),f=this.parent.frozenColCount(o),g=u.left+this.parent.sheetModule.getRowHeaderWidth(o,!1,!0),m=u.right-Gl(),v=u.top,y=u.bottom,C=pd(n),b=cd(n),x=this.isRowSelected?o.colCount-1:this.getColIdxFromClientX({clientX:C,target:n.target}),S=this.isColSelected?o.rowCount-1:this.getRowIdxFromClientY({clientY:b,target:n.target});if(n.ctrlKey){var w=o.selectedRange.split(" ");l=t(w[w.length-1])}else l=t(o.selectedRange);if(e.Browser.isDevice){var I=screen.availWidth;m>=I-40&&(m-=40-(I-m)),!o.showHeaders&&g<40&&(g+=40-g)}var E={range:[S,x,S,x]};if(this.parent.notify(Et,E),!(E.range[2]===l[2]&&E.range[3]===l[3]&&b<=y&&b>=v&&C<=m&&C>=g)){var N=this.parent.frozenRowCount(o);h||this.isColSelected||this.isRowSelected||(l=r(o.activeCell));var R,A,k=b>y&&!this.isColSelected&&S<o.rowCount,O=b<v&&S>=0&&!this.isColSelected&&!!p.scrollTop&&(!N||l[0]>=N),F=C>m&&!this.isRowSelected&&x<o.colCount,T=C<g&&x>=0&&!this.isRowSelected&&!!c.scrollLeft&&(!f||l[1]>=f);if(this.clearInterval(),k||O||F||T){(O||T)&&(R=S,A=x);var D=function(){if(k||O){if((S=i.getRowIdxFromClientY({clientY:k?y:v}))>=o.rowCount)return void i.clearInterval();p.scrollTop+=(k?1:-1)*yl(o,S)}if(F||T){if((x=i.getColIdxFromClientX({clientX:F?m:g,isFScroll:!0}))>=o.colCount)return void i.clearInterval();c.scrollLeft+=(F?1:-1)*Nl(o,x)}if(O&&o.frozenRows&&!p.scrollTop||T&&o.frozenColumns&&!c.scrollLeft)return i.selectRangeByIdx([].concat(l[0],l[1],[R,A]),n),void i.clearInterval();i.selectRangeByIdx([].concat(l[0],l[1],[S,x]),n)};D(),this.scrollInterval=setInterval((function(){D(),i.clearInterval(),i.scrollInterval=setInterval(D,100)}))}else{var L=[].concat(l[0],l[1],[S,x]);if(N&&L[0]<N&&L[2]>=N&&p.scrollTop&&!this.isColSelected&&(p.scrollTop=0,L[2]=N),f&&L[1]<f&&L[3]>=f&&c.scrollLeft&&!this.isRowSelected&&(c.scrollLeft=0,L[3]=f),this.isautoFillClicked){n.target.classList.contains("e-autofill")&&(this.dAutoFillCell=o.selectedRange);var P={e:n,indexes:null};this.parent.notify(rs,P),d=L=P.indexes}this.selectRangeByIdx(L,n)}if(h&&this.parent.isEdit&&!(0,e.closest)(n.target,"#"+this.parent.element.id+"_edit")){var M=(this.isautoFillClicked?a(d):this.parent.getActiveSheet().selectedRange).split(" ");this.parent.notify(bo,{range:M[M.length-1],isSelect:!1})}}},n.prototype.mouseUpHandler=function(r){var n=this.getRowIdxFromClientY({clientY:cd(r),target:r.target}),i=this.getColIdxFromClientX({clientX:pd(r),target:r.target});this.clearInterval(),!od(r)||this.isColSelected||this.isRowSelected||this.getRowIdxFromClientY({clientY:cd(this.touchEvt),target:r.target})!==n||this.getColIdxFromClientX({clientX:pd(this.touchEvt),target:r.target})!==i||this.mouseDownHandler(r),document.removeEventListener(rd().split(" ")[0],this.mouseMoveEvt),e.Browser.isPointer||document.removeEventListener(rd().split(" ")[1],this.mouseMoveEvt),e.EventHandler.remove(document,nd(),this.mouseUpHandler);var a=this.parent.getActiveSheet();if((a.frozenRows||a.frozenColumns)&&Jl(this.parent.element,null,"e-cur-selection",!0,!0),this.parent.notify(wi,r),this.isautoFillClicked){var o=this.parent.getActiveSheet(),s=t(o.selectedRange),l=Nr(o,s);if(!(Rr(o,s)&&s[1]===i||l&&s[0]===n)){var d=r.target.parentElement.querySelector(".e-dragfill-ddb");d&&!d.classList.contains("e-hide")||(this.dAutoFillCell=o.selectedRange),this.parent.notify(ts,{event:r,dAutoFillCell:this.dAutoFillCell})}this.isautoFillClicked=!1}else r.ctrlKey||Hd(kn(this.parent.getActiveSheet()))?this.parent.notify(is,null):this.parent.notify(Qo,null);this.updateFormulaCursorPosition(r)},n.prototype.updateFormulaCursorPosition=function(e){if(this.parent.isEdit){var t={action:"getCurrentEditValue",editedValue:""};this.parent.notify(si,t),wr(t.editedValue,!0)&&this.parent.notify(vo,{isCellEdit:e.target.classList.contains("e-spreadsheet-edit")})}},n.prototype.isSelected=function(e,r){for(var n,i=!1,a=this.parent.getActiveSheet().selectedRange.split(" "),o=0;o<a.length;o++)if((n=c(t(a[o])))[0]<=e&&e<=n[2]&&n[1]<=r&&r<=n[3]){i=!0;break}return i},n.prototype.virtualContentLoadedHandler=function(e){var r,n,i,a=this,o=this.parent.getActiveSheet();o.selectedRange.split(" ").forEach((function(s,l){if(r=t(s),i=0===r[1]&&r[3]===e.prevRowColCnt.colCount-1,n=0===r[0]&&r[2]===e.prevRowColCnt.rowCount-1,i||n)r=n&&i?[0,0,o.rowCount-1,o.colCount-1]:n?[0,r[1],o.rowCount-1,r[3]]:[r[0],0,r[2],o.colCount-1],o.frozenRows||o.frozenColumns?a.selectRangeByIdx(r,{type:"mousedown",ctrlKey:0!==l},!1,!1,!1,!1,void 0,!0):a.selectRangeByIdx(r,null,!0,null,null,null,l);else{r=t(s);var d=a.parent.viewport.topIndex+a.parent.frozenRowCount(o),h=a.parent.viewport.leftIndex+a.parent.frozenColCount(o);a.highlightHdr(r,0!==l,r[0]>=d||r[2]>=d,r[1]>=h||r[3]>=h)}}))},n.prototype.clearInterval=function(){this.scrollInterval&&(clearInterval(this.scrollInterval),this.scrollInterval=null)},n.prototype.getScrollLeft=function(){return this.parent.scrollModule?this.parent.scrollModule.prevScroll.scrollLeft:0},n.prototype.cellNavigateHandler=function(e){var t=this.parent.getActiveSheet();(!t.isProtected||t.protectSettings.selectCells||t.protectSettings.selectUnLockedCells)&&(e.type="mousedown",this.selectRangeByIdx(e.range,e,!1,!1,!1,!1,void 0,e.preventAnimation))},n.prototype.getColIdxFromClientX=function(t){var r,n,i=this,a=0,o=this.parent.getActiveSheet(),s=0;if(t.isImage)s=t.clientX;else{var l=document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect();s=this.parent.enableRtl?l.right-this.parent.sheetModule.getRowHeaderWidth(o,!0,!0)-t.clientX:t.clientX-(l.left+this.parent.sheetModule.getRowHeaderWidth(o,!0,!0)),s+=this.parent.viewport.beforeFreezeWidth;if(t.target&&((0,e.closest)(t.target,".e-row-header")||(0,e.closest)(t.target,".e-selectall-container"))&&!this.isScrollableArea(t.clientX,t.target,!0)||!(!this.parent.frozenColCount(o)||s>(r=i.parent.element.querySelector(".e-frozen-column"),parseInt(r.style[i.parent.enableRtl?"right":"left"],10)/i.parent.viewport.scaleX)||t.isFScroll)||(s+=this.getScrollLeft()/this.parent.viewport.scaleX),o.frozenRows&&s<0&&o.showHeaders)return-1}for(var d=0;;d++)if(n=a+=Nl(o,d,null,!t.isImage)/this.parent.viewport.scaleX,s<(t.isImage?Number(tn(n).toFixed(2)):n)||this.parent.scrollSettings.isFinite&&d===o.colCount-1)return t.isImage||(t.size=s),t.clientX=d,d},n.prototype.isScrollableArea=function(e,t,r){return!!t.classList.contains("e-table")&&(r?e>this.parent.getMainContent().getBoundingClientRect().left:e>this.parent.getMainContent().parentElement.getBoundingClientRect().top)},n.prototype.getRowIdxFromClientY=function(t){var r,n=0,i=this.parent.getActiveSheet(),a=0;if(t.isImage)a=t.clientY;else{var o=document.getElementById(this.parent.element.id+"_sheet");if(a=t.clientY+this.parent.viewport.beforeFreezeHeight-(o.getBoundingClientRect().top+(i.showHeaders?(t.isOverlay?30:31)/this.parent.viewport.scaleY:0)),t.target&&(0,e.closest)(t.target,".e-header-panel")&&!this.isScrollableArea(t.clientY,t.target)||(a+=this.parent.getMainContent().parentElement.scrollTop/this.parent.viewport.scaleY),i.frozenColumns&&a<0&&i.showHeaders)return-1}for(var s=0;;s++)if(r=n+=yl(i,s,!t.isImage)/this.parent.viewport.scaleY,a<(t.isImage?Number(tn(r).toFixed(2)):r)||this.parent.scrollSettings.isFinite&&s===i.rowCount-1)return t.isImage||(t.size=a),t.clientY=s,s},n.prototype.initFormulaReferenceIndicator=function(e){if(this.parent.isEdit){var t=this.parent.createElement("div",{className:"e-formularef-indicator"});t.appendChild(this.parent.createElement("div",{className:"e-top"})),t.appendChild(this.parent.createElement("div",{className:"e-bottom"})),t.appendChild(this.parent.createElement("div",{className:"e-left"})),t.appendChild(this.parent.createElement("div",{className:"e-right"})),this.parent.getMainContent().appendChild(t),Zl(this.parent,t,e,"e-formularef-indicator")}},n.prototype.isMouseEvent=function(e){return sd(e)||dd(e)||ld(e)},n.prototype.selectRangeByIdx=function(r,n,i,o,s,l,d,h,p){var c=this,u=n&&this.isMouseEvent(n);if(!(n&&n.target&&u&&(0,e.closest)(n.target,"#"+this.parent.element.id+"_edit"))){var f={action:"getCurrentEditValue",editedValue:"",endFormulaRef:!1};this.parent.notify(si,f);var g,v=!!this.parent.isEdit&&wr(f.editedValue,!0)&&!f.endFormulaRef,y=n&&n.ctrlKey&&sd(n);y||(g=this.getSelectionElement(n,d));var C,b=this.parent.getActiveSheet(),x=t(b.topLeftCell),S=this.parent.element.querySelector(".e-formularef-indicator"),w={range:[].slice.call(r),isActiveCell:!1,skipChecking:l},I=this.isRowColSelected(r);I.isColSelected||I.isRowSelected||this.parent.notify(It,w),r!==w.range&&(C=!0),r=w.range;var E=new Promise((function(e){e(void 0)})),N={range:a(r),cancel:!1};if(b.isProtected){var R=zn(r[2],r[3],b);if(b.protectSettings.selectUnLockedCells&&!b.protectSettings.selectCells)if((0,e.isNullOrUndefined)(R)){if(!b.protectSettings.selectCells)return}else{if(!0===R.isLocked||(0,e.isNullOrUndefined)(R.isLocked))return;var A=this.parent.element.getElementsByClassName("e-sheet-panel")[0];A&&A.classList.contains("e-protected")&&A.classList.remove("e-protected")}}if(this.parent.trigger("beforeSelect",N),!N.cancel){if(v&&S&&S.parentElement.removeChild(S),p||this.parent.notify(es,null),!m(r)&&!w.isActiveCell||y){if(y)if(void 0===d){var k=a(r);if(b.selectedRange.includes(k)&&!v)return(P=b.selectedRange.split(" ")).length>1?(P.splice(P.indexOf(k),1),k=P.join(" ")):k=b.activeCell+":"+b.activeCell,void this.selectRange({address:k});g=this.getSelectionElement(n,d)}else g=this.getSelectionElement(n,d);if(v&&this.parent.isEdit){if(n&&n.target&&(!u||!n.target.classList.contains("e-spreadsheet-edit"))&&this.parent.isEdit){T={range:a(r),isSelect:!0};if(this.parent.notify(bo,T),T.isAlertDlgOpen)return;this.initFormulaReferenceIndicator(r)}}else{F=void 0;g&&(g.classList.remove("e-hide"),(b.frozenRows||b.frozenColumns)&&((n&&n.target||y)&&(F="e-cur-selection",ld(n)&&g.classList.contains("e-cur-selection")?g.classList.add("e-hide"):g.classList.add(F)),!y&&(this.isColSelected||this.isRowSelected)&&sd(n)&&(Jl(this.parent.getSelectAllContent(),null,"e-selection"),Jl(this.parent.getColumnHeaderContent(),null,"e-selection"),Jl(this.parent.getRowHeaderContent(),null,"e-selection"))));var O=this.isColSelected&&this.isRowSelected?void 0:this.getOffset(r[2],r[3]);C&&O&&(O.left={idx:0,size:0}),E=Zl(this.parent,g,r,F,h,y,y&&!n.target)||E}}else{if(g&&(g.classList.contains("e-multi-range")||g.classList.add("e-hide"),b.frozenRows||b.frozenColumns)){var F=ld(n)?"e-cur-selection":"e-selection";Jl(this.parent.getSelectAllContent(),null,F,!0),Jl(this.parent.getColumnHeaderContent(),null,F,!0),Jl(this.parent.getRowHeaderContent(),null,F,!0)}if(b.frozenColumns||b.frozenRows||!g||Zl(this.parent,g,r),v&&n&&n.target&&(!u||!n.target.classList.contains("e-spreadsheet-edit"))&&this.parent.isEdit){var T={range:a(r).split(":")[0],isSelect:!0};if(this.parent.notify(bo,T),T.isAlertDlgOpen)return;this.initFormulaReferenceIndicator(r)}}var D={action:"getCurrentEditSheetIdx",sheetIndex:null};this.parent.notify(si,D),b.frozenColumns&&r[1]>0&&r[1]===x[1]&&r[3]===b.colCount-1&&(r[1]=0),b.frozenRows&&r[0]>0&&r[0]===x[0]&&r[2]===b.rowCount-1&&(r[0]=0);var L=a(r);if(n&&n.ctrlKey&&(ld(n)||dd(n))&&!v)L=b.selectedRange.slice(0,b.selectedRange.lastIndexOf(" "))+" "+L;else if(d>-1){var P;(P=b.selectedRange.split(" "))[d]=L,L=P.join(" ")}if(v||this.isautoFillClicked)s||this.isautoFillClicked||An(this.parent,L,b,y);else{var M=!1;b.selectedRange!==L&&(M=!0),An(this.parent,L,b,y),M&&E.then((function(){c.parent&&c.parent.trigger("select",{range:c.parent.getActiveSheet().selectedRange})}))}I=this.isRowColSelected(r),this.isRowSelected=I.isRowSelected,this.isColSelected=I.isColSelected,this.highlightHdr(r,n&&n.ctrlKey),i||n&&("mousemove"===n.type||ad(n))||(v?D.sheetIndex===this.parent.getActiveSheet().id-1&&s?(o=!0,this.updateActiveCell(o?t(b.activeCell):r,s,h)):this.parent.isEdit||this.updateActiveCell(o?t(b.activeCell):r,s,h):this.updateActiveCell(o?t(b.activeCell):r,s,h)),(0,e.isNullOrUndefined)(n)&&(n={type:"mousedown"}),v&&s||this.parent.notify(rr,n),y||Hd(kn(this.parent.getActiveSheet()))?this.parent.notify(is,null):this.parent.notify(Qo,{preventAnimation:h}),this.parent.showAggregate&&this.parent.notify(po,{}),this.parent.notify(Io,null)}}},n.prototype.isRowColSelected=function(e){var t=this.parent.getActiveSheet();return{isRowSelected:0===e[1]&&e[3]===t.colCount-1,isColSelected:0===e[0]&&e[2]===t.rowCount-1}},n.prototype.updateActiveCell=function(e,r,n){var a,o,s,l=this.parent.getActiveSheet(),d=t(l.topLeftCell);this.isColSelected?(a=d[0],o=e[1],this.isRowSelected&&(o=d[1])):(a=e[0],o=e[1],this.isRowSelected&&(o=d[1]));var h={range:[a,o].concat([a,o])};if(this.parent.notify(Et,h),e!==h.range&&(s=!0),e=h.range,l.activeCell!==i(e[0],e[1])||r){if(this.previousActiveCell=l.activeCell.indexOf(":")>-1?this.previousActiveCell:l.activeCell,this.parent.setSheetPropertyOnMute(l,"activeCell",i(e[0],e[1])),l.isProtected){var p=this.parent.element.querySelector(".e-formula-bar"),c=Tr(zn(e[0],e[1],l),Il(l,e[1]));c&&p&&!p.disabled?p.disabled=!0:!c&&p&&p.disabled&&(p.disabled=!1)}if(this.getActiveCell()){var u=this.getOffset(e[2],e[3]);s&&(u.left={idx:0,size:0}),Zl(this.parent,this.getActiveCell(),e,"e-active-cell",n)}this.parent.notify(ve,null)}else Zl(this.parent,this.getActiveCell(),e,"e-active-cell",n)},n.prototype.getOffset=function(e,t){var r={left:{idx:0,size:0},top:{idx:0,size:0}};return this.parent.scrollModule&&(t>=this.parent.scrollModule.offset.left.idx&&(r.left=this.parent.scrollModule.offset.left),e>=this.parent.scrollModule.offset.top.idx&&(r.top=this.parent.scrollModule.offset.top)),r},n.prototype.getSelectionElement=function(r,n){var i=this.parent.getActiveSheet();if(r&&r.ctrlKey&&!this.parent.isEdit){if(dd(r)||ld(r))return i.frozenColumns||i.frozenRows?(a=this.parent.getMainContent().querySelector(".e-cur-selection"))||(a=this.parent.element.querySelector(".e-multi-range"))&&a.cloneNode():this.parent.getMainContent().querySelector(".e-selection:last-child");var a,o=this.parent.getMainContent().getElementsByClassName("e-selection")[0];return(a=o.cloneNode()).classList.add("e-multi-range"),i.frozenColumns||i.frozenRows?(i.selectedRange.includes(" ")||(o.classList.remove("e-hide"),Zl(this.parent,o,c(t(i.selectedRange)),void 0,!1,!0)),!this.parent.getMainContent().querySelector(".e-multi-range")&&o.classList.contains("e-hide")?o:a):(o.classList.remove("e-hide"),this.parent.getMainContent().appendChild(a))}return n>-1?i.frozenRows||i.frozenColumns?this.parent.element.querySelector(".e-sheet").getElementsByClassName("e-selection")[n]:this.parent.getMainContent().getElementsByClassName("e-selection")[n]:([].slice.call(this.parent.element.getElementsByClassName("e-multi-range")).forEach((function(t){(0,e.remove)(t)})),this.parent.getMainContent().getElementsByClassName("e-selection")[0])},n.prototype.getActiveCell=function(){return this.parent.getMainContent().getElementsByClassName("e-active-cell")[0]},n.prototype.getSheetElement=function(){return document.getElementById(this.parent.element.id+"_sheet")},n.prototype.highlightHdr=function(t,n,i,a){var o=this;void 0===i&&(i=!0),void 0===a&&(a=!0);var s=this.parent.getActiveSheet();if(s.showHeaders){n||((0,e.removeClass)(this.getSheetElement().querySelectorAll(".e-highlight"),"e-highlight"),(0,e.removeClass)(this.getSheetElement().querySelectorAll(".e-prev-highlight"),"e-prev-highlight"));var l=this.parent.element.getElementsByClassName("e-select-all-cell")[0];l&&(0,e.removeClass)([l],["e-prev-highlight-right","e-prev-highlight-bottom"]);var d=[],h=[],p=c(t);this.isRowSelected&&(p[1]=Pr(s,p[1],!0,"columns")),this.isColSelected&&(p[0]=Pr(s,p[0],!0));var u,f,g=[0,0,0,0],m=[0,0,0,0],v=r(s.topLeftCell),y=function(e,t,r){var n,i,a;e&&p[u]<e?(v[u]=Pr(s,v[u],!0,t),(a=Pr(s,p[u],!0,t))===v[u]&&(p[u]=a),i=o.parent.hiddenCount(v[u],p[u]-1,t,s),g[u]=p[u]-i-v[u],n=p[f]<e?p[f]:e-1,g[f]=n-o.parent.hiddenCount(p[u],n,t,s)-i-v[u]+1,n=o.parent.viewport[""+r]+e,p[f]>=n&&(m[u]=0,m[u]-=o.parent.hiddenCount(n,n,t,s),m[f]=p[f]-o.parent.hiddenCount(n,p[f],t,s)-n+1)):((n=Pr(s,o.parent.viewport[""+r]+e,!0,t))===(a=Pr(s,p[u],!0,t))&&(p[u]=n),i=o.parent.hiddenCount(n,p[u]-1,t,s),m[u]=p[u]-i-n,m[f]=p[f]-o.parent.hiddenCount(p[u],p[f],t,s)-i-n+1)},C=function(e,t,r){for(var n=[].slice.call(t.getElementsByClassName("e-header-cell")),i=e[u];i<e[f];i++)n[i]&&r.push(n[i])};if(i){if(u=0,f=2,y(this.parent.frozenRowCount(s),"rows","topIndex"),s.frozenRows){var b=this.parent.getSelectAllContent().querySelector("tbody");b&&C(g,b,d)}C(m,this.parent.getRowHeaderContent(),d)}if(a){if(u=1,f=3,y(this.parent.frozenColCount(s),"columns","leftIndex"),s.frozenColumns){var x=this.parent.getSelectAllContent().querySelector("thead");x&&C(g,x,h)}C(m,this.parent.getColumnHeaderContent(),h)}s.isProtected&&!s.protectSettings.selectCells?(0,e.removeClass)([].concat(d,h),"e-highlight"):(0,e.addClass)([].concat(d,h),"e-highlight"),d.length&&d[0].parentElement.previousElementSibling&&d[0].parentElement.previousElementSibling.classList.add("e-prev-highlight"),h.length&&h[0].previousElementSibling&&h[0].previousElementSibling.classList.add("e-prev-highlight"),this.isRowSelected&&this.isColSelected&&(s.isProtected&&!s.protectSettings.selectCells?document.getElementById(this.parent.element.id+"_select_all").classList.remove("e-highlight"):document.getElementById(this.parent.element.id+"_select_all").classList.add("e-highlight")),l&&(Pr(s,p[0],!0)===Pr(s,0,!0)&&l.classList.add("e-prev-highlight-bottom"),Pr(s,p[1],!0,"columns")===Pr(s,0,!0,"columns")&&l.classList.add("e-prev-highlight-right"))}},n.prototype.protectHandler=function(){var e=t(this.parent.getActiveSheet().selectedRange),n=c(e),i=r(this.parent.getActiveSheet().activeCell),a=n[0]<=i[0]&&n[2]>=i[0]&&n[1]<=i[1]&&n[3]>=i[1];this.selectRangeByIdx(e,null,null,a)},n.prototype.initiateFormulaSelection=function(e){this.processFormulaEditRange(e.range,e.formulaSheetIdx)},n.prototype.processFormulaEditRange=function(e,t){var r,n=t,i=0,a={formula:e};this.parent.notify(dr,a);var o=a.formulaArr,s=o.length,l=0,d=[["e-vborderright","e-vborderbottom"],["e-pborderright","e-pborderbottom"],["e-cborderright","e-cborderbottom"],["e-gborderright","e-gborderbottom"],["e-oborderright","e-oborderbottom"],["e-bborderright","e-bborderbottom"]];this.clearBorder();for(var h=this.parent.getActiveSheet().id-1;i<s&&(r=o[i],!(this.invalidOperators.indexOf(r)>-1));){if(Ir(r.toUpperCase())){if(r=r.replace(/\$/g,""),i>0&&o[i-1].lastIndexOf("!")===o[i-1].length-1){var p=o[i-1].substring(1,o[i-1].lastIndexOf("!")-1);n=p?In(this.parent,p):n}":"===o[i+1]&&o[++i+1]&&Ir(o[i+1].toUpperCase())&&(r=r+":"+o[i+1],i++),h===n&&this.updateFormulaEditRange(r,l,d),n=t,l++}i++}},n.prototype.updateFormulaEditRange=function(e,r,n){var i=t(e);this.formulaRange[r]=e,this.dStartCell={rowIndex:i[0],colIndex:i[1]},this.dEndCell={rowIndex:i[2],colIndex:i[3]},this.focusBorder(this.dStartCell,this.dEndCell,n[r%6])},n.prototype.chartBorderHandler=function(e){this.focusBorder(e.startcell,e.endcell,e.classes,!0)},n.prototype.focusBorder=function(t,r,n,i){i=!(0,e.isNullOrUndefined)(i)&&i;var a=this.parent.getActiveSheet(),o=c([t.rowIndex,t.colIndex,r.rowIndex,r.colIndex]);if(a.frozenRows||a.frozenColumns){var s=this.parent.createElement("div",{className:i?"e-range-indicator e-chart-range":"e-range-indicator e-formuala-range"});return s.appendChild(this.parent.createElement("div",{className:"e-top"})),s.appendChild(this.parent.createElement("div",{className:"e-bottom"})),s.appendChild(this.parent.createElement("div",{className:"e-left"})),s.appendChild(this.parent.createElement("div",{className:"e-right"})),void Zl(this.parent,s,o,"e-range-indicator")}var l=this.getRefIndicatorFn(i),d=o[0],h=o[1],p=o[2],u=o[3];if(d){var f=Pr(a,d-1,!1);l([f,h,f,u],n[1])}var g=Pr(a,u,!1,"columns");l([d,g,p,g],n[0]);var m=Pr(a,p,!1);if(l([m,h,m,u],n[1]),h){var v=Pr(a,h-1,!1,"columns");l([d,v,p,v],n[0])}},n.prototype.getRefIndicatorFn=function(e){var t=this,r=this.parent.getActiveSheet(),n=this.parent.scrollSettings.enableVirtualization?[this.parent.viewport.topIndex,this.parent.viewport.leftIndex,this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex]:[0,0,r.rowCount-1,r.colCount-1];return function(i,a){var o,s;i[0]>i[2]&&(o=i[0],i[0]=i[2],i[2]=o),i[1]>i[3]&&(o=i[1],i[1]=i[3],i[3]=o);for(var l=i[0];l<=i[2];l++)if(l>=n[0]&&l<=n[2]&&!ml(r,l)&&(s=t.parent.getRow(l,null)))for(var d=i[1];d<=i[3];d++)if(d>=n[1]&&d<=n[3]&&!Al(r,d)){var h=t.parent.getCell(l,d,s);h&&(h.classList.add(a),e||h.classList.add("e-formularef-selection"))}}},n.prototype.clearBorder=function(){var t=this.parent.getActiveSheet();if(t.frozenColumns||t.frozenRows)[].slice.call(this.parent.element.getElementsByClassName("e-formuala-range")).forEach((function(t){(0,e.detach)(t)}));else for(var r=this.parent.element.getElementsByClassName("e-formularef-selection"),n=r.length-1;n>=0;n--)for(var i=r[n],a=["e-vborderright","e-vborderbottom","e-pborderright","e-pborderbottom","e-cborderright","e-cborderbottom","e-gborderright","e-gborderbottom","e-oborderright","e-oborderbottom","e-bborderright","e-bborderbottom","e-formularef-selection"],o=0;o<a.length;o++)i.classList.remove(a[o])},n.prototype.getModuleName=function(){return"selection"},n.prototype.destroy=function(){this.removeEventListener(),this.parent=null},n}(),dh=function(){function t(e){this.clientX=0,this.isKeyScroll=!0,this.parent=e,this.addEventListener(),this.initProps()}return t.prototype.onContentScroll=function(t){if(this.parent){var r,n,i=this.parent.getMainContent().parentElement,a=t.scrollLeft,o=t.scrollTop||i.scrollTop,s=a&&this.parent.enableRtl?this.initScrollValue-a:a;if(this.parent.allowAutoFill){var l=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn-popup"),d=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn");if(l)(0,e.getComponent)(d,"dropdown-btn").toggle()}if(!(0,e.isNullOrUndefined)(a)&&this.prevScroll.scrollLeft!==s){var h=s>this.prevScroll.scrollLeft;n=this.offset.left.size,this.offset.left=this.getColOffset(s,h,t.skipHidden),t.preventScroll||(this.parent.getColumnHeaderContent().scrollLeft=a,this.parent.getMainContent().scrollLeft=a,t.scrollLeft=a),r={cur:this.offset.left,prev:{idx:this.leftIndex,size:n},increase:h,preventScroll:t.preventScroll},this.updateTopLeftCell(h,!0),this.parent.notify(vi,null),this.parent.notify(mi,r),this.updateNoteContainer(),this.parent.scrollSettings.enableVirtualization||!h||this.parent.scrollSettings.isFinite||this.updateNonVirtualCols(),this.leftIndex=r.prev.idx,this.prevScroll.scrollLeft=s}if(Math.round(this.prevScroll.scrollTop)!==Math.round(o)){t.skipRowVirualScroll&&(this.prevScroll.scrollTop=0,this.offset.top={idx:0,size:0});var p=o>this.prevScroll.scrollTop;n=this.offset.top.size,this.offset.top=this.getRowOffset(o,p),r={cur:this.offset.top,prev:{idx:this.topIndex,size:n},increase:p,preventScroll:t.preventScroll},this.updateTopLeftCell(p),t.preventScroll&&this.offset.top.idx<=this.parent.getThreshold("row")?this.offset.top={idx:0,size:0}:t.skipRowVirualScroll?r.prev.idx=r.cur.idx:(this.parent.notify(vi,null),this.parent.notify(gi,r),this.updateNoteContainer()),this.parent.scrollSettings.enableVirtualization||!p||this.parent.scrollSettings.isFinite||this.updateNonVirtualRows(),this.topIndex=r.prev.idx,this.prevScroll.scrollTop=o}var c={isEdit:!1};if(this.parent.notify(ni,c),c.isEdit)this.parent.element.querySelector(".e-formula-bar").focus();this.isKeyScroll=!0}},t.prototype.updateNoteContainer=function(){document.getElementsByClassName("e-addNoteContainer")&&document.getElementsByClassName("e-addNoteContainer").length>0&&this.parent.notify(va,null)},t.prototype.updateScrollValue=function(e){void 0!==e.scrollLeft&&(this.prevScroll.scrollLeft=e.scrollLeft+(this.prevScroll.scrollLeft-this.offset.left.size),this.offset.left.size=e.scrollLeft),void 0!==e.scrollTop&&(this.prevScroll.scrollTop=e.scrollTop+(this.prevScroll.scrollTop-this.offset.top.size),this.offset.top.size=e.scrollTop)},t.prototype.updateNonVirtualRows=function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("row");this.offset.top.idx>e.rowCount-(this.parent.viewport.rowCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:e.rowCount,colIndex:0,direction:"first",refresh:"RowPart"},i(e.rowCount,0)+":"+i(e.rowCount+t-1,e.colCount-1)),this.parent.setSheetPropertyOnMute(e,"rowCount",e.rowCount+t),this.parent.viewport.bottomIndex=e.rowCount-1)},t.prototype.updateNonVirtualCols=function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("col");this.offset.left.idx>e.colCount-(this.parent.viewport.colCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:0,colIndex:e.colCount,direction:"first",refresh:"ColumnPart"},i(0,e.colCount)+":"+i(e.rowCount-1,e.colCount+t-1)),this.parent.setSheetPropertyOnMute(e,"colCount",e.colCount+t),this.parent.viewport.rightIndex=e.colCount-1)},t.prototype.updateTopLeftCell=function(e,t){var r=this.parent.getActiveSheet(),n=this.offset.top.idx,i=this.offset.left.idx;if(!e){var a=this.parent.frozenRowCount(r);n=Pr(r,n+a,!0)-a;var o=this.parent.frozenColCount(r);i=Pr(r,i+o,!0,"columns")-o}t?this.parent.updateTopLeftCell(null,i,"row"):this.parent.updateTopLeftCell(n,null,"col")},t.prototype.getRowOffset=function(e,t){var r=this.offset.top.size,n=this.parent.getActiveSheet(),i=t?this.offset.top.idx+1:this.offset.top.idx?this.offset.top.idx-1:0,a=this.parent.frozenRowCount(n),o=this.parent.scrollSettings.isFinite?n.rowCount:1/0;for(e=Math.round(e);i<o;)if(t){if(r+=s=yl(n,i-1+a,!0),Math.abs(Math.round(r)-e)<=1)return{idx:Pr(n,i+a,!0)-a,size:r};if(Math.round(r)>e)return{idx:i-1,size:r-s};i++}else{var s;if((r-=s=yl(n,i+a,!0))<=0)return{idx:0,size:0};if(Math.abs(Math.round(r)-e)<=1)return{idx:i,size:r};if(Math.round(r)<e)return r+=s,Math.round(r)>e?{idx:i,size:r-s<0?0:r-s}:{idx:Pr(n,i+1+a,!0)-a,size:r};i--}return{idx:this.offset.top.idx,size:this.offset.top.size}},t.prototype.getColOffset=function(e,t,r){for(var n=this.offset.left.size,i=this.parent.getActiveSheet(),a=t?this.offset.left.idx+1:this.offset.left.idx?this.offset.left.idx-1:0,o=this.parent.frozenColCount(i),s=this.parent.scrollSettings.isFinite?i.colCount:1/0;a<s;)if(t){if(n+=l=Nl(i,a-1+o,r,!0),Math.abs(Math.round(n)-e)<=1)return{idx:Pr(i,a+o,!0,"columns")-o,size:n};if(Math.round(n)>e)return{idx:a-1,size:n-l};a++}else{var l;if((n-=l=Nl(i,a+o,r,!0))<=0)return{idx:0,size:0};if(Math.abs(Math.round(n)-e)<=1)return{idx:a,size:n};if(Math.round(n)<e)return n+=l,Math.round(n)>e?{idx:a,size:(n-=l)<0?0:n}:{idx:Pr(i,a+1+o,!0,"columns")-o,size:n};a--}return{idx:this.offset.left.idx,size:this.offset.left.size}},t.prototype.contentLoaded=function(e){if(!this.parent.scrollSettings.enableVirtualization){var t=this.parent.createElement("div",{className:"e-virtualtrack"});this.updateNonVirualScrollWidth({scrollTrack:t}),this.parent.getScrollElement().appendChild(t)}e.left&&(this.parent.getScrollElement().scrollLeft=e.left),this.setScrollEvent(),this.parent.enableRtl&&(this.initScrollValue=this.parent.getScrollElement().scrollLeft)},t.prototype.updateNonVirualScrollWidth=function(e){e.scrollTrack||(e.scrollTrack=this.parent.getScrollElement().getElementsByClassName("e-virtualtrack")[0]),e.scrollTrack.style.width=Math.abs(this.parent.getContentTable().getBoundingClientRect().width+(this.parent.scrollSettings.isFinite?this.parent.sheetModule.getScrollSize():0))+"px"},t.prototype.onHeaderWheel=function(e){e.preventDefault(),this.parent.getMainContent().parentElement.scrollTop+=e.deltaY,this.parent.getScrollElement().scrollLeft+=e.deltaX},t.prototype.onContentWheel=function(e){0!==e.deltaX&&(e.preventDefault(),this.parent.getScrollElement().scrollLeft+=e.deltaX)},t.prototype.scrollHandler=function(e){this.onContentScroll({scrollLeft:e.target.scrollLeft})},t.prototype.updateScroll=function(t){(0,e.isNullOrUndefined)(t.left)?this.parent.sheetModule.contentPanel.scrollTop=t.top:this.parent.getScrollElement().scrollLeft=t.left},t.prototype.setScrollEvent=function(){e.EventHandler.add(this.parent.sheetModule.contentPanel,"scroll",this.onContentScroll,this),e.EventHandler.add(this.parent.getColumnHeaderContent(),"wheel",this.onHeaderWheel,this),e.EventHandler.add(this.parent.getSelectAllContent(),"wheel",this.onHeaderWheel,this),e.EventHandler.add(this.parent.getMainContent(),"wheel",this.onContentWheel,this),e.EventHandler.add(this.parent.getRowHeaderContent(),"wheel",this.onContentWheel,this),e.EventHandler.add(this.parent.getScrollElement(),"scroll",this.scrollHandler,this)},t.prototype.initProps=function(){this.topIndex=0,this.leftIndex=0,this.prevScroll={scrollLeft:0,scrollTop:0},this.offset={left:{idx:0,size:0},top:{idx:0,size:0}}},t.prototype.setPadding=function(e){this.parent.sheetModule.contentPanel.style.overflowY="scroll";var t=Gl();if(t>0){var r=this.parent.getColumnHeaderContent(),n=this.parent.enableRtl?{margin:"marginLeft",border:"borderLeftWidth"}:{margin:"marginRight",border:"borderRightWidth"};r.parentElement.style[n.margin]=t+"px",r.style[n.border]="1px"}e&&(this.initScrollValue=0)},t.prototype.setClientX=function(t){if("mousedown"!==t.type&&"mouse"!==t.pointerType){var r={touchSelectionStarted:!1};if(this.parent.notify(Ko,r),!r.touchSelectionStarted&&!r.isOverlayClicked){this.clientX=this.getPointX(t);var n=document.getElementById(this.parent.element.id+"_sheet");e.EventHandler.add(n,e.Browser.isPointer?"pointermove":"touchmove",this.onTouchScroll,this),e.EventHandler.add(n,e.Browser.isPointer?"pointerup":"touchend",this.pointerUpHandler,this)}}},t.prototype.getPointX=function(e){return e.touches&&e.touches.length?e.touches[0].clientX:e.clientX},t.prototype.onTouchScroll=function(e){if("mouse"!==e.pointerType){var t=this.getPointX(e),r=this.clientX-t,n=this.parent.element.getElementsByClassName("e-scroller")[0];(r>10||r<-10)&&n.scrollLeft+r>=0&&(e.preventDefault(),this.clientX=t,zl((function(){n.scrollLeft+=r})))}},t.prototype.pointerUpHandler=function(){var t=document.getElementById(this.parent.element.id+"_sheet");e.EventHandler.remove(t,e.Browser.isPointer?"pointermove":"touchmove",this.onTouchScroll),e.EventHandler.remove(t,e.Browser.isPointer?"pointerup":"touchend",this.pointerUpHandler)},t.prototype.addEventListener=function(){this.parent.on(ii,this.contentLoaded,this),this.parent.on(ea,this.onContentScroll,this),this.parent.on(Jo,this.updateScroll,this),this.parent.on(ta,this.initProps,this),this.parent.on(oi,this.destroy,this),this.parent.on(ai,this.setClientX,this),this.parent.on(ls,this.updateScrollValue,this),this.parent.scrollSettings.enableVirtualization||(this.parent.on(bi,this.updateNonVirualScrollWidth,this),this.parent.on(Qi,this.updateNonVirualScrollWidth,this))},t.prototype.destroy=function(){this.removeEventListener();var t=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn");if(t){var r=(0,e.getComponent)(t,"dropdown-btn");r&&r.destroy()}this.parent=null},t.prototype.removeEventListener=function(){this.parent.off(ii,this.contentLoaded),this.parent.off(ea,this.onContentScroll),this.parent.off(Jo,this.updateScroll),this.parent.off(ta,this.initProps),this.parent.off(oi,this.destroy),this.parent.off(ai,this.setClientX),this.parent.off(ls,this.updateScrollValue),this.parent.scrollSettings.enableVirtualization||(this.parent.off(bi,this.updateNonVirualScrollWidth),this.parent.off(Qi,this.updateNonVirualScrollWidth))},t}(),hh=function(){function n(e){this.scroll=[],this.parent=e,this.addEventListener()}return n.prototype.createVirtualElement=function(t){var n=this.parent.getActiveSheet(),i=this.parent.getMainContent();this.content=this.parent.createElement("div",{className:"e-virtualable"}),this.content.appendChild(i.querySelector(".e-table")),i.appendChild(this.content);var a,o=i.appendChild(this.parent.createElement("div",{className:"e-virtualtrack"})),s=0;this.parent.sheets.length>this.scroll.length&&this.initScroll();var l=this.parent.viewport.bottomIndex;n.rowCount>l+1||n.usedRange.rowIndex>l?(!this.parent.scrollSettings.isFinite&&n.rowCount<=n.usedRange.rowIndex&&this.parent.setSheetPropertyOnMute(n,"rowCount",n.usedRange.rowIndex+1),this.setScrollCount(n.rowCount,"row")):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(n,"rowCount",l+1),this.scroll[this.parent.activeSheetIndex].rowCount=n.rowCount);var d=this.parent.frozenRowCount(n),h=r(n.topLeftCell);t.top&&(s=t.top,n.frozenRows&&(s+=bl(n,h[0],d-1,!0)),d=r(n.paneTopLeftCell)[0]),s+=bl(n,d,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0),l=this.parent.viewport.rightIndex;var p=0,c=this.parent.frozenColCount(n);t.left?(p=t.left,c&&(p+=Rl(n,h[1],c-1,!0)),d=r(n.paneTopLeftCell)[1]):d=c,n.colCount>l+1||n.usedRange.colIndex>l?(!this.parent.scrollSettings.isFinite&&n.colCount<=n.usedRange.colIndex&&this.parent.setSheetPropertyOnMute(n,"colCount",n.usedRange.colIndex+1),p+=Rl(n,d,l,!0),this.setScrollCount(n.colCount,"col"),a=p+Rl(n,l+1,this.scroll[this.parent.activeSheetIndex].colCount-1,!0)):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(n,"colCount",l+1),p+=Rl(n,d,n.colCount-1,!0),this.scroll[this.parent.activeSheetIndex].colCount=n.colCount,a=p),(0,e.isNullOrUndefined)(this.parent.viewport.leftIndex)&&(this.parent.viewport.leftIndex=0),(0,e.isNullOrUndefined)(this.parent.viewport.topIndex)&&(this.parent.viewport.topIndex=0),t.left&&(p=Rl(n,this.parent.viewport.leftIndex+c,l,!0)),(0,e.isNullOrUndefined)(this.translateX)&&(this.translateX=0),(0,e.isNullOrUndefined)(this.translateY)&&(this.translateY=0),i=this.parent.getRowHeaderContent(),this.rowHeader=this.content.cloneNode(),this.rowHeader.appendChild(i.querySelector(".e-table")),i.appendChild(this.rowHeader);var u=i.appendChild(o.cloneNode());this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)",i=this.parent.getColumnHeaderContent(),this.colHeader=this.content.cloneNode(),this.colHeader.appendChild(i.querySelector(".e-table")),i.appendChild(this.colHeader);var f=i.appendChild(o.cloneNode());if(this.colHeader.style.width=p+"px",u.style.height=s+"px",f.style.width=a+"px",this.colHeader.style.transform="translate("+this.translateX+"px, 0px)",this.content.style.transform="translate("+this.translateX+"px, "+this.translateY+"px)",this.content.style.width=p+"px",o.style.height=s+"px",o.style.width=a+"px",this.parent.allowScrolling){var g=f.cloneNode(!0);g.style.width=a+(this.parent.scrollSettings.isFinite?this.parent.sheetModule.getScrollSize():0)+"px",this.parent.getScrollElement().appendChild(g)}},n.prototype.initScroll=function(){for(var e=0;e<this.parent.sheets.length;)this.scroll[e]||this.scroll.push({rowCount:0,colCount:0}),e++},n.prototype.setScrollCount=function(e,t){var r=this.parent.activeSheetIndex;this.scroll[r][t+"Count"]&&this.scroll[r][t+"Count"]===e||(this.scroll[r][t+"Count"]=e)},n.prototype.getRowAddress=function(e){var t=this.parent.getActiveSheet();return a([e[0],t.frozenColumns?r(t.topLeftCell)[1]:this.parent.viewport.leftIndex,e[1],this.parent.viewport.rightIndex])},n.prototype.getColAddress=function(e){var t=this.parent.getActiveSheet();return a([t.frozenRows?r(t.topLeftCell)[0]:this.parent.viewport.topIndex,e[0],this.parent.viewport.bottomIndex,e[1]])},n.prototype.updateScrollCount=function(e,t,r){void 0===r&&(r=e);var n=this.parent.getActiveSheet(),i=e+this.parent.viewport[t+"Count"]+1+r,a=this.scroll[this.parent.activeSheetIndex][t+"Count"];if(i<a){if(n[t+"Count"]===a)return;i=a}this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(n,t+"Count",i)},n.prototype.onVerticalScroll=function(e){var n=e.cur.idx,i=e.cur.size,a=e.prev.idx,o=Math.abs(n-a),s=this.parent.getThreshold("row");if(o>Math.round(s/2)){var l=void 0,d=void 0,h=void 0,p=this.parent.getActiveSheet();if(n<=s&&!e.increase){if(this.translateY&&a>s){this.translateY=0;var c=this.parent.frozenColCount(p),u=this.parent.frozenRowCount(p);if(e.preventScroll)this.parent.viewport.topIndex=a-(s-u);else{var f=c?r(p.topLeftCell)[1]:this.parent.viewport.leftIndex,g=c?[u,this.parent.viewport.leftIndex+c]:[];if(o<this.parent.viewport.rowCount+s){l=Pr(p,u,!0),d=Pr(p,this.parent.viewport.topIndex+u-1,!1),this.parent.viewport.topIndex=l-u;var m=this.skipHiddenLastIdx(this.parent.viewport.bottomIndex-(d-l+1-this.hiddenCount(l,d)),this.parent.viewport.bottomIndex);this.parent.viewport.bottomIndex=Pr(p,m,!1),this.parent.renderModule.refreshUI({colIndex:f,rowIndex:l,direction:"last",refresh:"RowPart",skipUpdateOnFirst:!0,frozenIndexes:g},this.getRowAddress([l,Pr(p,d,!1)]))}else{var v=this.parent.viewport.leftIndex;this.parent.renderModule.refreshUI({rowIndex:0,colIndex:f,refresh:"Row",skipUpdateOnFirst:!0,frozenIndexes:g,skipTranslate:!0}),c&&(this.parent.viewport.leftIndex=v),this.translate({refresh:"Row"})}Md(this.parent.element),n=0}}this.updateScrollCount(s,"row")}if(a<s&&(o=Math.abs(n-s)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex===Pr(p,p.rowCount-1,!1)){u=this.parent.frozenRowCount(p);var y=this.parent.viewport.topIndex+u+t(p.paneTopLeftCell)[0]-1;if(n+u>y)return void(e.prev.idx=n);o=y-(n+u)}if(n>s){if(h=this.parent.viewport.topIndex,this.parent.viewport.topIndex=n-s,e.increase&&h>this.parent.viewport.topIndex)return void(this.parent.viewport.topIndex=h);u=this.parent.frozenRowCount(p);if(e.preventScroll)this.setThresholdHeight(i,s,u),this.translate({refresh:"Row"});else{f=void 0;var C=[];if((c=this.parent.frozenColCount(p))?(f=r(p.topLeftCell)[1],C.push(u),C.push(this.parent.viewport.leftIndex+c)):f=this.parent.viewport.leftIndex,o<this.parent.viewport.rowCount+s)if(e.increase){if(l=this.parent.viewport.bottomIndex+1,d=this.parent.viewport.bottomIndex+(this.parent.viewport.topIndex-h),(d-=this.hiddenCount(h+u,this.parent.viewport.topIndex-1+u))<=this.parent.viewport.bottomIndex||this.parent.scrollSettings.isFinite&&l>Pr(p,p.rowCount-1,!1,"rows"))return void(this.parent.viewport.topIndex=h);var b=this.parent.skipHidden(l,d,"rows",!1),x=this.checkLastIdx(b[1],"row");l=b[0],d=x.index;var S=this.parent.viewport.topIndex+u;if(x.diff)S=Pr(p,h,!0,"rows",d-l+1-this.hiddenCount(l,d))+u;this.parent.viewport.topIndex=Pr(p,S,!x.diff)-u,this.setThresholdHeight(i,n-this.parent.viewport.topIndex,u,!!x.diff,h===Pr(p,u,!0)),this.parent.viewport.bottomIndex=d,this.parent.renderModule.refreshUI({colIndex:f,rowIndex:l,direction:"first",refresh:"RowPart",frozenIndexes:C},this.getRowAddress([l,d]))}else{if((l=Pr(p,this.parent.viewport.topIndex+u,!1))<u&&(l=Pr(p,l=u,!0)),this.parent.viewport.topIndex=l-u,(d=Pr(p,h+u-1,!1))<u||d<l)return void(this.parent.viewport.topIndex=h);m=this.skipHiddenLastIdx(this.parent.viewport.bottomIndex-(d-l+1-this.hiddenCount(l,d)),this.parent.viewport.bottomIndex);this.parent.viewport.bottomIndex=Pr(p,m,!1),this.setThresholdHeight(i,n-this.parent.viewport.topIndex,u),this.parent.renderModule.refreshUI({colIndex:f,rowIndex:l,direction:"last",refresh:"RowPart",frozenIndexes:C},this.getRowAddress([l,d]))}else h=this.parent.viewport.leftIndex,this.parent.viewport.topIndex=Pr(p,this.parent.viewport.topIndex+u,!1)-u,this.parent.viewport.topIndex<0&&(this.parent.viewport.topIndex=Pr(p,u,!0)-u),this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:f,refresh:"Row",frozenIndexes:C,skipTranslate:!0}),c&&(this.parent.viewport.leftIndex=h),this.setThresholdHeight(i,n-this.parent.viewport.topIndex,u,this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex===Pr(p,p.rowCount-1,!1)),this.translate({refresh:"Row"});this.updateScrollCount(n,"row",s),this.focusSheet()}}e.prev.idx=n}},n.prototype.skipHiddenLastIdx=function(e,t,r){void 0===r&&(r="rows");for(var n=this.parent.getActiveSheet(),i=0,a=e;a<=t;a++)n[""+r][a]&&n[""+r][a].hidden&&i++;return i&&(e=this.skipHiddenLastIdx(e-i,e-1,r)),e},n.prototype.hiddenCount=function(e,t,r){void 0===r&&(r="rows");for(var n=0,i=this.parent.getActiveSheet(),a=e;a<=t;a++)i[""+r][a]&&i[""+r][a].hidden&&n++;return n},n.prototype.checkLastIdx=function(e,t){var r=0;if(this.parent.scrollSettings.isFinite){var n=this.parent.getActiveSheet(),i=Pr(n,n[t+"Count"]-1,!1,"col"===t?"columns":"rows");e>i&&(r=e-i,e=i)}return{index:e,diff:r}},n.prototype.onHorizontalScroll=function(e){var n=e.cur.idx,i=e.cur.size,a=e.prev.idx,o=Math.abs(n-a),s=this.parent.getThreshold("col");if(o>Math.round(s/2)){var l=void 0,d=void 0,h=void 0,p=this.parent.getActiveSheet();if(n<=s&&!e.increase){if(this.translateX&&a>s){this.translateX=0;var c=this.parent.frozenColCount(p),u=this.parent.frozenRowCount(p);if(e.preventScroll)this.parent.viewport.leftIndex=a-(s-c);else{var f=u?r(p.topLeftCell)[0]:this.parent.viewport.topIndex,g=u?[this.parent.viewport.topIndex+u,c]:[];if(o<this.parent.viewport.colCount+s){l=Pr(p,c,!0,"columns"),d=Pr(p,this.parent.viewport.leftIndex+c-1,!1,"columns"),this.parent.viewport.leftIndex=l-c;var m=this.skipHiddenLastIdx(this.parent.viewport.rightIndex-(d-l+1-this.hiddenCount(l,d,"columns")),this.parent.viewport.rightIndex,"columns");this.parent.viewport.rightIndex=Pr(p,m,!1,"columns"),this.parent.renderModule.refreshUI({rowIndex:f,colIndex:l,direction:"last",refresh:"ColumnPart",skipUpdateOnFirst:!0,frozenIndexes:g},this.getColAddress([l,Pr(p,d,!1,"columns")]))}else{var v=this.parent.viewport.topIndex;this.parent.renderModule.refreshUI({rowIndex:f,colIndex:0,refresh:"Column",skipUpdateOnFirst:!0,frozenIndexes:g,skipTranslate:!0}),u&&(this.parent.viewport.topIndex=v),this.translate({refresh:"Column"})}Md(this.parent.element),n=0}}this.updateScrollCount(s,"col")}if(a<s&&(o=Math.abs(n-s)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.rightIndex===Pr(p,p.colCount-1,!1,"columns")){c=this.parent.frozenColCount(p);var y=this.parent.viewport.leftIndex+c+t(p.paneTopLeftCell)[1]-1;if(n+c>(y+=this.hiddenCount(this.parent.viewport.leftIndex+c,y)))return void(e.prev.idx=n);o=y-(n+c)}if(n>s){if(h=this.parent.viewport.leftIndex,this.parent.viewport.leftIndex=n-s,e.increase&&h>this.parent.viewport.leftIndex)return void(this.parent.viewport.leftIndex=h);c=this.parent.frozenColCount(p);if(e.preventScroll)this.setThresholdWidth(i,s,c),this.translate({refresh:"Column"});else{f=(u=this.parent.frozenRowCount(p))?r(p.topLeftCell)[0]:this.parent.viewport.topIndex;var C=[];if(u&&(C=[u+this.parent.viewport.topIndex,c]),o<this.parent.viewport.colCount+s)if(e.increase){if(l=this.parent.viewport.rightIndex+1,d=this.parent.viewport.rightIndex+(this.parent.viewport.leftIndex-h),(d-=this.hiddenCount(h+c,this.parent.viewport.leftIndex-1+c,"columns"))<=this.parent.viewport.rightIndex||this.parent.scrollSettings.isFinite&&l>Pr(p,p.colCount-1,!1,"columns"))return void(this.parent.viewport.leftIndex=h);var b=this.parent.skipHidden(l,d,"columns",!1),x=this.checkLastIdx(b[1],"col");l=b[0],d=x.index,this.parent.viewport.leftIndex=Pr(p,this.parent.viewport.leftIndex-x.diff+c,!x.diff,"columns")-c,this.setThresholdWidth(i,n-this.parent.viewport.leftIndex,c,!!x.diff,h===Pr(p,c,!0,"columns")),this.parent.viewport.rightIndex=d,this.parent.renderModule.refreshUI({rowIndex:f,colIndex:l,direction:"first",refresh:"ColumnPart",frozenIndexes:C},this.getColAddress([l,d]))}else{if((l=Pr(p,this.parent.viewport.leftIndex+c,!1,"columns"))<c&&(l=Pr(p,l=c,!0,"columns")),this.parent.viewport.leftIndex=l-c,(d=Pr(p,h+c-1,!1,"columns"))<c||d<l)return void(this.parent.viewport.leftIndex=h);m=this.skipHiddenLastIdx(this.parent.viewport.rightIndex-(d-l+1-this.hiddenCount(l,d,"columns")),this.parent.viewport.rightIndex,"columns");this.parent.viewport.rightIndex=Pr(p,m,!1,"columns"),this.setThresholdWidth(i,n-this.parent.viewport.leftIndex,c),this.parent.renderModule.refreshUI({rowIndex:f,colIndex:l,direction:"last",refresh:"ColumnPart",frozenIndexes:C},this.getColAddress([l,d]))}else h=this.parent.viewport.topIndex,this.parent.viewport.leftIndex=Pr(p,this.parent.viewport.leftIndex+c,!1,"columns")-c,this.parent.viewport.leftIndex<0&&(this.parent.viewport.leftIndex=Pr(p,c,!0,"columns")-c),this.parent.renderModule.refreshUI({rowIndex:f,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:C,skipTranslate:!0}),u&&(this.parent.viewport.topIndex=h),this.setThresholdWidth(i,n-this.parent.viewport.leftIndex,c,this.parent.scrollSettings.isFinite&&this.parent.viewport.rightIndex===Pr(p,p.colCount-1,!1,"columns")),this.translate({refresh:"Column"});this.updateScrollCount(n,"col",s),this.focusSheet()}}e.prev.idx=n}},n.prototype.focusSheet=function(){document.activeElement.classList.contains("e-text-findNext-short")&&(0,e.closest)(document.activeElement,"#"+this.parent.element.id)||Md(this.parent.element)},n.prototype.setThresholdHeight=function(e,t,r,n,i){var a=this.parent.getActiveSheet(),o=this.parent.viewport.topIndex+r,s=o+t-1;this.translateY=n||i||s<o?o<=r?0:bl(a,r,o-1,!0):e-bl(a,o,s,!0)},n.prototype.setThresholdWidth=function(e,t,r,n,i){var a=this.parent.getActiveSheet(),o=this.parent.viewport.leftIndex+r,s=o+t-1;this.translateX=n||i||s<o?o<=r?0:Rl(a,r,o-1,!0):e-Rl(a,o,s,!0)},n.prototype.translate=function(e){if(!e.skipTranslate&&this.content){var t=this.translateX||0;t=this.parent.enableRtl?-t:t,"Row"!==e.refresh&&"RowPart"!==e.refresh||(this.content.style.transform="translate("+t+"px, "+this.translateY+"px)",this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)"),"Column"!==e.refresh&&"ColumnPart"!==e.refresh||(this.content.style.transform="translate("+t+"px, "+this.translateY+"px)",this.colHeader.style.transform="translate("+t+"px, 0px)")}},n.prototype.updateColumnWidth=function(e){if("Column"===e.refresh){this.content.style.width="";var t=this.parent.getActiveSheet(),r=Rl(t,this.parent.viewport.leftIndex+this.parent.frozenColCount(t),this.parent.viewport.rightIndex,!0);if(this.colHeader.style.width=r+"px",this.content.style.width=r+"px",!this.parent.scrollSettings.isFinite||e.isUpdate){var n=this.parent.element.querySelector(".e-scroller .e-virtualtrack");if(!n)return;var i=parseInt(n.style.width,10),a=r+this.translateX+this.parent.viewport.beforeFreezeWidth;if(a>i){var o=a-i;n.style.width=i+o+"px"}else{o=i-a;var s=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];i-o<parseInt(s.style.width,10)&&(n.style.width=s.style.width)}}}else if(!this.parent.scrollSettings.isFinite){s=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];var l=parseInt(s.style.height,10),d=this.content.getBoundingClientRect().height+this.translateY+this.parent.viewport.beforeFreezeHeight;if(d>l){o=d-l;s.style.height=l+o+"px"}else{o=l-d;var h=this.parent.getRowHeaderContent().getElementsByClassName("e-virtualtrack")[0];l-o<parseInt(h.style.height,10)&&(s.style.height=h.style.height)}}},n.prototype.updateRowColCount=function(e){if(this.scroll.length){var t=this.parent.getActiveSheet();if("row"===e.update){if(e.index!==this.scroll[this.parent.activeSheetIndex].rowCount-1){var r=this.getVTrackHeight("height"),n=r;if(e.index>=this.scroll[this.parent.activeSheetIndex].rowCount?void 0===e.start?n+=bl(t,this.scroll[this.parent.activeSheetIndex].rowCount,e.index,!0):n+=bl(t,e.start,e.end,!0):void 0===e.start?n-=bl(t,e.index+1,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0):n-=bl(t,e.start,e.end,!0),!e.isDelete&&n<r)return;this.scroll[this.parent.activeSheetIndex].rowCount=e.index+1,this.updateVTrack(this.rowHeader,n,"height"),this.scroll[this.parent.activeSheetIndex].rowCount>t.rowCount&&this.parent.setSheetPropertyOnMute(t,"rowCount",this.scroll[this.parent.activeSheetIndex].rowCount)}}else if(e.index!==this.scroll[this.parent.activeSheetIndex].colCount-1){var i=this.getVTrackHeight("width"),a=i;if(e.index>=this.scroll[this.parent.activeSheetIndex].colCount?void 0===e.start?a+=Rl(t,this.scroll[this.parent.activeSheetIndex].colCount,e.index,!0):a+=Rl(t,e.start,e.end,!0):void 0===e.start?a-=Rl(t,e.index+1,this.scroll[this.parent.activeSheetIndex].colCount-1,!0):a-=Rl(t,e.start,e.end,!0),!e.isDelete&&a<i)return;this.scroll[this.parent.activeSheetIndex].colCount=e.index+1,this.updateVTrack(this.colHeader,a,"width"),this.scroll[this.parent.activeSheetIndex].colCount>t.colCount&&this.parent.setSheetPropertyOnMute(t,"colCount",this.scroll[this.parent.activeSheetIndex].colCount)}}},n.prototype.getVTrackHeight=function(e){var t=this.content.nextElementSibling.style[""+e];if(t.includes("e+")){var r=(t=t.split("px")[0]).split("e+");return Number(r[0])*Math.pow(10,Number(r[1]))}return parseFloat(t)},n.prototype.updateVTrackHeight=function(e){var t=this.parent.frozenRowCount(this.parent.getActiveSheet());if(e.rowIdx<this.scroll[this.parent.activeSheetIndex].rowCount&&this.updateVTrack(this.rowHeader,this.getVTrackHeight("height")+e.threshold,"height"),e.rowIdx>=t&&e.rowIdx<this.parent.scrollModule.offset.top.idx+t){var r=this.parent.element.getElementsByClassName("e-main-panel")[0];r&&(this.parent.scrollModule.prevScroll.scrollTop=r.scrollTop+e.threshold,r.scrollTop+=e.threshold),this.parent.scrollModule.offset.top.size+=e.threshold,e.rowIdx<this.parent.viewport.topIndex+t&&(this.translateY+=e.threshold,this.translate({refresh:"Row"}))}},n.prototype.updateVTrackWidth=function(e){if(!Al(this.parent.getActiveSheet(),e.colIdx)){var t=this.parent.frozenColCount(this.parent.getActiveSheet());if(e.colIdx>=this.parent.viewport.leftIndex+t&&e.colIdx<=this.parent.viewport.rightIndex){var r=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualtrack")[0];r.style.width=parseFloat(r.style.width)+e.threshold+"px";var n=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];n.style.width=parseFloat(n.style.width)+e.threshold+"px";var i=this.parent.getScrollElement().getElementsByClassName("e-virtualtrack")[0];i.style.width=parseFloat(i.style.width)+e.threshold+"px";var a=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualable")[0];a.style.width=parseFloat(a.style.width)+e.threshold+"px";var o=this.parent.getMainContent().getElementsByClassName("e-virtualable")[0];o.style.width=parseFloat(o.style.width)+e.threshold+"px"}else e.colIdx>=t&&e.colIdx<this.parent.viewport.leftIndex+t&&(this.parent.scrollModule.offset.left.size+=e.threshold,this.translateX+=e.threshold,this.translate({refresh:"Column"}))}},n.prototype.updateVTrack=function(e,t,r){e.nextElementSibling.style[""+r]=t+"px",this.content.nextElementSibling.style[""+r]=t+"px","width"===r&&this.parent.allowScrolling&&(this.parent.getScrollElement().firstElementChild.style.width=t+"px")},n.prototype.deInitProps=function(){this.parent.viewport.leftIndex=null,this.parent.viewport.topIndex=null,this.parent.viewport.bottomIndex=null,this.translateX=null,this.translateY=null},n.prototype.updateScrollProps=function(e){var t=this;void 0===e&&(e={sheetIndex:0,sheets:this.parent.sheets}),0===this.scroll.length?this.initScroll():e.sheets.forEach((function(){t.scroll.splice(e.sheetIndex,0,{rowCount:0,colCount:0})}))},n.prototype.sliceScrollProps=function(t){(0,e.isNullOrUndefined)(t.sheetIndex)?this.scroll.length=0:this.scroll.splice(t.sheetIndex,1)},n.prototype.updateTranslate=function(e){if(e.height){if(e.isRender)this.translateY-=e.height;else{var t=parseInt(this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0].style.height,10);e.isHide?(this.updateVTrack(this.rowHeader,t-e.height,"height"),this.setThresholdHeight(this.translateY,e.prevSize-1-this.parent.viewport.topIndex+1,this.parent.frozenRowCount(this.parent.getActiveSheet()))):(this.updateVTrack(this.rowHeader,t+e.height,"height"),this.translateY=this.translateY+e.size)}this.translate({refresh:"Row"})}e.width&&(this.translateX-=e.width,this.translate({refresh:"Column"}))},n.prototype.addEventListener=function(){this.parent.on(yi,this.createVirtualElement,this),this.parent.on(Ci,this.translate,this),this.parent.on(bi,this.updateColumnWidth,this),this.parent.on(Lo,this.updateColumnWidth,this),this.parent.on(gi,this.onVerticalScroll,this),this.parent.on(mi,this.onHorizontalScroll,this),this.parent.on(he,this.updateRowColCount,this),this.parent.on(Ji,this.updateVTrackHeight,this),this.parent.on(Qi,this.updateVTrackWidth,this),this.parent.on(ta,this.deInitProps,this),this.parent.on(xe,this.sliceScrollProps,this),this.parent.on(be,this.updateScrollProps,this),this.parent.on(os,this.updateTranslate,this),this.parent.on(oi,this.destroy,this)},n.prototype.destroy=function(){this.removeEventListener();var e=document.querySelectorAll(".e-addNoteIndicator");e&&e.forEach((function(e){e.remove()})),this.rowHeader&&(jl(this.rowHeader),this.rowHeader.remove()),this.colHeader&&(jl(this.colHeader),this.colHeader.remove()),this.content&&(jl(this.content),this.content.remove()),this.rowHeader=null,this.colHeader=null,this.content=null,this.parent=null,this.scroll.length=0,this.translateX=null,this.translateY=null},n.prototype.removeEventListener=function(){this.parent.off(yi,this.createVirtualElement),this.parent.off(Ci,this.translate),this.parent.off(bi,this.updateColumnWidth),this.parent.off(Lo,this.updateColumnWidth),this.parent.off(gi,this.onVerticalScroll),this.parent.off(mi,this.onHorizontalScroll),this.parent.off(he,this.updateRowColCount),this.parent.off(Ji,this.updateVTrackHeight),this.parent.off(Qi,this.updateVTrackWidth),this.parent.off(xe,this.sliceScrollProps),this.parent.off(be,this.updateScrollProps),this.parent.off(os,this.updateTranslate),this.parent.off(oi,this.destroy)},n}(),ph=function(){function n(e){this.parent=e,this.addEventListener()}return n.prototype.addEventListener=function(){this.parent.on(ci,this.keyDownHandler,this)},n.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(ci,this.keyDownHandler)},n.prototype.keyDownHandler=function(n){var i=this,o=n.target,s=this.parent.enableRtl,l=this.parent.enableKeyboardShortcut;if(!n.altKey||38!==n.keyCode&&40!==n.keyCode||l)if(n.altKey&&38===n.keyCode&&this.parent.element.lastElementChild.classList.contains("e-filter-popup"))this.parent.notify(Ma,{closePopup:!0});else{if(this.parent.allowPrint&&n.ctrlKey&&80===n.keyCode&&l)return n.preventDefault(),void this.parent.print();var d=n.target;if((0,e.isNullOrUndefined)(d)||!d.classList.contains("e-addNoteContainer")){var h=this.parent.serviceLocator.getService(Ll).dialogInstance,p=o.id===this.parent.element.id+"_name_box";if("None"===this.parent.selectionSettings.mode||h||this.parent.isEdit||o.classList.contains("e-ss-ddb")&&117!==n.keyCode&&9!==n.keyCode||p&&117!==n.keyCode||o.classList.contains("e-sheet-rename")||o.id===this.parent.element.id+"_SearchBox"||o.classList.contains("e-chk-hidden")||o.classList.contains("e-ddl")&&o.classList.contains("e-input-focus")){if(h){if(13===n.keyCode)h.element.classList.contains("e-spreadsheet-function-dlg")&&(o.classList.contains("e-formula-list")||o.classList.contains("e-list-item"))&&Md(h.element.querySelector(".e-footer-content .e-primary"));else if(9===n.keyCode)if(h.element.classList.contains("e-find-dlg")){var c=h.element.querySelectorAll(".e-footer-content .e-btn:not(:disabled)"),u=c.length?c[c.length-1].className:"e-findnreplace-checkmatch";if(n.shiftKey){if(document.activeElement.classList.contains("e-dlg-closeicon-btn"))if(n.preventDefault(),c.length)Md(c[c.length-1]);else{var f=h.element.querySelector(".e-findnreplace-exactmatchcheckbox");f&&(Md(f.querySelector(".e-findnreplace-checkmatch")),f.classList.add("e-focus"))}}else document.activeElement.className.includes(u)&&Md(h.element)}else if(h.element.classList.contains("e-protect-dlg")){if(n.shiftKey?document.activeElement.classList.contains("e-primary"):document.activeElement.id===this.parent.element.id+"_protect_check")if((g=h.element.querySelector(".e-protect-option-list"))&&!g.querySelector(".e-list-item.e-focused"))(v=g.querySelector(".e-list-item"))&&v.classList.add("e-focused")}else if(h.element.classList.contains("e-custom-format-dlg"))if(n.shiftKey){if(document.activeElement.className.includes("e-list-item e-active")){(g=(0,e.closest)(document.activeElement,".e-custom-listview"))&&Md(g)}}else if(document.activeElement.classList.contains("e-btn")&&document.activeElement.parentElement.classList.contains("e-custom-dialog")){var g=h.element.querySelector(".e-custom-listview"),m=(0,e.getComponent)(g,"listview");if(g){var v;if(!(v=g.querySelector(".e-list-item.e-active"))){if(!(v=g.querySelector(".e-list-item")))return;m.selectItem(v)}n.preventDefault(),v.focus()}}else document.activeElement.classList.contains("e-list-item")&&Md(h.element);else if(h.element.classList.contains("e-spreadsheet-function-dlg")){if(n.shiftKey&&document.activeElement.className.includes("e-list-item e-active"))(g=(0,e.closest)(document.activeElement,".e-formula-list"))&&Md(g)}else if(h.element.classList.contains("e-goto-dlg")&&!h.element.classList.contains("e-dlg-modal"))if(n.shiftKey){if(document.activeElement.className.includes("e-dlg-closeicon-btn")){var y=h.element.querySelector(".e-footer-content .e-btn");y&&(n.preventDefault(),Md(y))}}else document.activeElement.className.includes("e-btn-goto-ok")&&Md(h.element)}else p&&9===n.keyCode&&n.shiftKey&&this.focusEle(n,".e-formula-bar",!1,!0);pe={action:"getCurrentEditValue",editedValue:""};this.parent.notify(si,pe);var C=wr(pe.editedValue,!0);this.parent.isEdit&&C&&n.shiftKey&&!n.ctrlKey&&hd(n.keyCode)&&this.shiftSelection(n)}else{var b=this.parent.getActiveSheet(),x=r(b.activeCell);if(n.altKey){if(40===n.keyCode){if(o.classList.contains("e-dropdown-btn")||o.classList.contains("e-split-btn"))return;var S={e:n,isFilterCell:!1};if(this.parent.notify(Ma,S),S.isFilterCell)return}if(40===n.keyCode&&!document.getElementById(this.parent.element.id+"listValid_popup"))if(se=this.parent.getCell(x[0],x[1])){var w=se.querySelector(".e-validation-list .e-ddl");if(w){Md(w);var I=w.querySelector(".e-dropdownlist")||w;return void((m=(0,e.getComponent)(I,"dropdownlist"))&&m.showPopup())}}}o.id===this.parent.element.id+"_File"&&Md(this.parent.element);var E,N=o.classList.contains("e-add-sheet-tab")||o.classList.contains("e-sheets-list")||o.classList.contains("e-tab-wrap")&&!!(0,e.closest)(o,".e-sheet-tabs-items")||o.classList.contains("e-aggregate-list")||o.classList.contains("e-scroll-nav");[9,37,38,39,40,33,34,35,36].indexOf(n.keyCode)>-1&&!N&&n.preventDefault();var R=t(b.selectedRange);if(36===n.keyCode){var A=this.parent.frozenColCount(b),k=void 0;if(n.ctrlKey||n.metaKey){var O=Pr(b,this.parent.frozenRowCount(b),!0);n.shiftKey?k=[x[0],x[1],O,Pr(b,A,!0,"columns")]:(k=[O,Pr(b,A,!0,"columns"),O])[3]=k[1],(B=this.parent.element.querySelector(".e-main-panel")).scrollTop&&(B.scrollTop=0);var F=this.parent.getScrollElement();F.scrollLeft&&(F.scrollLeft=0)}else if(n.shiftKey){var T=Pr(b,A,!0,"columns");k=b.frozenColumns&&Pr(b,x[1],!0,"columns")===T?[R[0],x[1],R[2],Pr(b,0,!0,"columns")]:[R[0],x[1],R[2],T],this.scrollNavigation([k[2],k[3]],!0)}else{T=Pr(b,A,!0,"columns");!b.frozenColumns||T!==x[1]&&A!==x[1]||(T=Pr(b,0,!0,"columns")),k=[x[0],T,x[0],T],this.scrollNavigation([k[0],k[1]],!0)}this.updateSelection(b,k,n)}else if(n.ctrlKey||n.metaKey){if(35===n.keyCode){n.preventDefault();var D=Pr(b,b.usedRange.rowIndex,!1);D=D>-1?D:b.usedRange.rowIndex;var L=Pr(b,b.usedRange.colIndex,!1,"columns");L=L>-1?L:b.usedRange.colIndex,n.shiftKey||(x[0]=D,x[1]=L),x[2]=D,x[3]=L,this.updateSelection(b,x.concat(x),n),this.scrollNavigation([D,L],!0)}else 32===n.keyCode&&!n.shiftKey&&l&&(R[0]=0,R[2]=b.rowCount-1,this.updateSelection(b,R,{shiftKey:!0}));if(40===n.keyCode||39===n.keyCode||38===n.keyCode||37===n.keyCode)n.shiftKey?(40===n.keyCode?R[2]=this.getNextNonEmptyCell(R[2],x[1],"down"):39===n.keyCode&&!s||37===n.keyCode&&s?R[3]=this.getNextNonEmptyCell(x[0],R[3],"right"):38===n.keyCode?R[2]=this.getNextNonEmptyCell(R[2],x[1],"top"):R[3]=this.getNextNonEmptyCell(x[0],R[3],"left"),this.updateSelection(b,R,n),this.scrollNavigation([R[2],R[3]],!0)):(37===n.keyCode&&!s||39===n.keyCode&&s?x[1]=this.getNextNonEmptyCell(x[0],x[1],"left"):38===n.keyCode?x[0]=this.getNextNonEmptyCell(x[0],x[1],"top"):39===n.keyCode&&!s||37===n.keyCode&&s?x[1]=this.getNextNonEmptyCell(x[0],x[1],"right"):x[0]=this.getNextNonEmptyCell(x[0],x[1],"down"),this.parent.selectRange(a(x)),this.scrollNavigation([x[0],x[1]],!0));else if(117===n.keyCode){var P=document.activeElement;P.classList.contains("e-spreadsheet")||(0,e.closest)(P,".e-sheet")?this.setFocus("Sheet",n,!0):N?this.setFocus("SheetTabs",n):(0,e.closest)(P,".e-ribbon")?this.setFocus("Ribbon",n):(p||P.classList.contains("e-insert-function"))&&this.setFocus("FormulaBar",n)}}else{if(n.shiftKey){if(32===n.keyCode&&l&&(n.preventDefault(),R[1]=0,R[3]=b.colCount-1,this.updateSelection(b,R,n)),this.shiftSelection(n),(34===n.keyCode||33===n.keyCode)&&this.parent.scrollModule&&this.parent.scrollModule.isKeyScroll){var M=0,B=this.parent.element.querySelector(".e-main-panel"),H=Pr(b,r(b.paneTopLeftCell)[0],!0),U=Vd(this.parent,H).height;if(34===n.keyCode){if(M=U+this.parent.scrollModule.offset.top.size,!this.parent.scrollSettings.isFinite)(W=this.parent.getMainContent().querySelector(".e-virtualtrack"))&&parseFloat(W.style.height)<M+U&&(W.style.height=M+U+"px")}else if(M=this.parent.scrollModule.offset.top.size-U,Math.round(M)<0){if(!B.scrollTop)return void this.parent.selectRange(a([R[0],R[1],H,R[3]]));M=0}var V=Pr(b,t(b.selectedRange)[2],!0),z=H>V?0:V-H;this.parent.scrollModule&&B.scrollTop&&(this.parent.scrollModule.isKeyScroll=!1),B.scrollTop=M,zl((function(){34===n.keyCode?(R[2]=Pr(b,r(b.paneTopLeftCell)[0]+z,!0),i.parent.scrollSettings.isFinite&&R[2]>b.rowCount-1&&(R[2]=Pr(b,b.rowCount-1,!1),R[2]=R[2]<0?0:R[2])):(R[2]=Pr(b,r(b.paneTopLeftCell)[0]+z,!1),R[2]=R[2]<0?0:R[2]),i.updateSelection(b,R,n)}))}}else if(9===n.keyCode||(this.parent.enableRtl?37===n.keyCode:39===n.keyCode)){if((se=zn(x[0],x[1],b))&&se.colSpan>1&&(x[1]+=se.colSpan-1),x[1]<b.colCount-1&&(!b.isProtected||b.protectSettings.selectCells))x[1]+=1,E=!0;else if(b.protectSettings.selectUnLockedCells){var j=this.getNextUnlockedCell("right",x);E=x[1]!==j[1]||x[0]!==j[0],x[1]=j[1],x[0]=j[0]}}else if(13===n.keyCode||40===n.keyCode){if((se=zn(x[0],x[1],b))&&se.rowSpan>1&&(x[0]+=se.rowSpan-1),x[0]<b.rowCount-1&&(!b.isProtected||b.protectSettings.selectCells))E=!0,x[0]+=1;else if(b.protectSettings.selectUnLockedCells){j=this.getNextUnlockedCell("down",x);E=x[0]!==j[0]||x[1]!==j[1],x[1]=j[1],x[0]=j[0]}}else if((34===n.keyCode||33===n.keyCode)&&this.parent.scrollModule&&this.parent.scrollModule.isKeyScroll){B=this.parent.element.querySelector(".e-main-panel"),M=0;var _=Pr(b,r(b.paneTopLeftCell)[0],!0),q=Pr(b,r(b.activeCell)[0],!0);U=Vd(this.parent,_).height;if(34===n.keyCode){var W;if(M=this.parent.scrollModule.offset.top.size+U,!this.parent.scrollSettings.isFinite)(W=this.parent.getMainContent().querySelector(".e-virtualtrack"))&&parseFloat(W.style.height)<M+U&&(W.style.height=M+U+"px")}else{if(M=this.parent.scrollModule.offset.top.size-U,b.frozenRows&&x[0]<this.parent.frozenRowCount(b))return void this.parent.selectRange(a([_,R[1],_,R[1]]));if(Math.round(M)<0){if(!B.scrollTop)return;M=0}}var G=_>q?0:q-_;this.parent.scrollModule&&B.scrollTop&&(this.parent.scrollModule.isKeyScroll=!1),B.scrollTop=M,zl((function(){var e;34===n.keyCode?(e=Pr(b,r(b.paneTopLeftCell)[0]+G,!0),i.parent.scrollSettings.isFinite&&e>b.rowCount-1&&(e=(e=Pr(b,b.rowCount-1,!1))<0?0:e)):(e=r(b.paneTopLeftCell)[0]+G,e-=i.parent.hiddenCount(_,q),e=(e=Pr(b,e,!1))<0?0:e),i.parent.notify(Si,{range:[e,x[1],e,x[1]],preventAnimation:!0})}))}if(n.shiftKey?9===n.keyCode:this.parent.enableRtl?39===n.keyCode:37===n.keyCode){if(x[1]>0&&(!b.isProtected||b.protectSettings.selectCells))x[1]-=1,E=!0;else if(b.protectSettings.selectUnLockedCells){j=this.getNextUnlockedCell("left",x);E=x[1]!==j[1]||x[0]!==j[0],x[1]=j[1],x[0]=j[0]}if(x[1]<=0){var Y=this.parent.getMainContent();0===x[1]&&Y.scrollLeft&&!this.parent.enableRtl&&(Y.scrollLeft=0)}}else if((n.shiftKey?13===n.keyCode:38===n.keyCode)&&!this.parent.element.querySelector(".e-find-toolbar")){if(x[0]>0&&(!b.isProtected||b.protectSettings.selectCells))x[0]-=1,E=!0;else if(b.protectSettings.selectUnLockedCells){var X=this.getNextUnlockedCell("up",x);E=x[0]!==X[0]||x[1]!==X[1],x[1]=X[1],x[0]=X[0]}if(x[0]<=0){var K=this.parent.getMainContent().parentElement;0===x[0]&&K.scrollTop&&(K.scrollTop=0)}}}if(!E||this.parent.scrollModule&&!this.parent.scrollModule.isKeyScroll||N||(0,e.closest)(document.activeElement,".e-ribbon")||o.classList.contains("e-insert-function")||o.classList.contains("e-formula-bar")&&(!o.classList.contains("e-formula-bar")||"TEXTAREA"!==o.nodeName||13!==n.keyCode)){if(9===n.keyCode){var $=this.parent.showRibbon&&(0,e.closest)(document.activeElement,".e-ribbon");if($)(0,e.closest)(document.activeElement,".e-tab-header")?n.shiftKey||$.classList.contains("e-collapsed")?this.focusEle(n,".e-ribbon .e-drop-icon"):this.focusEle(n,".e-ribbon .e-content .e-toolbar-item:not(.e-separator):not(.e-overlay):not(.e-hide) .e-btn"):(0,e.closest)(document.activeElement,".e-content")?n.shiftKey?this.focusEle(n,".e-ribbon .e-toolbar-items .e-toolbar-item.e-active .e-tab-wrap",!0):this.focusEle(n,".e-ribbon .e-drop-icon"):document.activeElement.classList.contains("e-drop-icon")&&(n.shiftKey&&!$.classList.contains("e-collapsed")?this.focusEle(n,".e-ribbon .e-content .e-toolbar-item:not(.e-separator):not(.e-overlay):not(.e-hide) .e-btn"):this.focusEle(n,".e-ribbon .e-toolbar-items .e-toolbar-item.e-active .e-tab-wrap",!0));else if(o.classList.contains("e-insert-function"))n.shiftKey?this.focusEle(n,".e-formula-bar-panel .e-combobox"):this.focusEle(n,".e-formula-bar",!1,!0);else if(N)if(n.shiftKey){var Z=o.classList.contains("e-aggregate-list")||o.classList.contains("e-scroll-left-nav");if(o.classList.contains("e-add-sheet-tab")||Z||o.classList.contains("e-sheets-list")&&o.previousElementSibling&&o.previousElementSibling.disabled){var J=!Z&&this.parent.element.querySelector(".e-aggregate-list");if(J)this.focusEle(n,null,!1,!1,J);else if(!o.classList.contains("e-scroll-left-nav")&&this.parent.element.querySelector(".e-sheet-tab-panel .e-scroll-nav"))this.focusEle(n,".e-sheet-tab-panel .e-scroll-right-nav",!0);else{(ee=[].slice.call(this.parent.element.querySelectorAll(".e-sheet-tab-panel .e-toolbar-item")))[ee.length-1]&&this.focusEle(n,null,!0,!1,ee[ee.length-1].querySelector(".e-tab-wrap"))}}else if(o.classList.contains("e-scroll-right-nav"))this.focusEle(n,".e-sheet-tab-panel .e-scroll-left-nav",!0);else if(o.classList.contains("e-tab-wrap")){0===(j=(ee=[].slice.call(this.parent.element.querySelectorAll(".e-sheet-tab-panel .e-toolbar-item"))).indexOf(o.parentElement))?this.focusEle(n,".e-sheet-tab-panel .e-sheets-list"):this.focusEle(n,null,!0,!1,ee[j-1].querySelector(".e-tab-wrap"))}}else{var Q=!!this.parent.element.querySelector(".e-aggregate-list");if(o.classList.contains("e-aggregate-list")||!Q&&o.classList.contains("e-scroll-right-nav"))this.focusEle(n,".e-sheet-tab-panel .e-icon-btn:not(:disabled)");else if(o.classList.contains("e-sheets-list"))this.focusEle(n,".e-sheet-tab-panel .e-toolbar-item .e-tab-wrap",!0);else if(o.classList.contains("e-scroll-left-nav"))this.focusEle(n,".e-sheet-tab-panel .e-scroll-right-nav",!0);else if(o.classList.contains("e-tab-wrap")){var ee,te=(ee=[].slice.call(this.parent.element.querySelectorAll(".e-sheet-tab-panel .e-toolbar-item"))).indexOf(o.parentElement);if(te===ee.length-1){var re=!!this.parent.element.querySelector(".e-sheet-tab-panel .e-scroll-nav");!re&&Q||this.focusEle(n,".e-sheet-tab-panel ."+(re?"e-scroll-nav":"e-icon-btn:not(:disabled)"),re)}else this.focusEle(n,null,!0,!1,ee[te+1].querySelector(".e-tab-wrap"))}}}}else{if(40===n.keyCode||38===n.keyCode||13===n.keyCode)for(;ml(b,x[0]);)if((40===n.keyCode||!n.shiftKey&&13===n.keyCode)&&(x[0]=x[0]+1),(38===n.keyCode||n.shiftKey&&13===n.keyCode)&&(x[0]=x[0]-1,x[0]<0))return;if(37===n.keyCode||39===n.keyCode||9===n.keyCode)for(;Al(b,x[1]);)if((39===n.keyCode||!n.shiftKey&&9===n.keyCode)&&(x[1]=x[1]+1),(37===n.keyCode||n.shiftKey&&9===n.keyCode)&&(x[1]=x[1]-1,x[1]<0))return;var ne=t(b.topLeftCell);b.frozenRows&&x[0]<ne[0]&&(x[0]=Pr(b,ne[0],!0)),b.frozenColumns&&x[1]<ne[1]&&(x[1]=Pr(b,ne[1],!0,"columns")),this.scrollNavigation(x);var ie=a(x),ae=function(t){var r;ie!==b.selectedRange&&(i.parent.selectionModule.previousActiveCell=b.activeCell,document.getElementsByClassName("e-addNoteContainer")&&document.getElementsByClassName("e-addNoteContainer").length>0&&i.parent.notify(ya,""),i.parent.setSheetPropertyOnMute(b,"activeCell",ie),i.parent.notify(Si,{range:x.concat(x),preventAnimation:t}),e.Browser.isDevice&&"safari"===e.Browser.info.name&&(e.Browser.isIos||e.Browser.isIos7)&&(r=i.parent.element.querySelector(".e-ss-focus-edit")),(r=r||i.parent.getCell(x[0],x[1]))&&Md(r))};if(this.parent.scrollModule&&this.parent.scrollModule.isKeyScroll){if(ie===b.selectedRange)return;zl(ae.bind(this,!0))}else ae()}121===n.keyCode&&n.shiftKey&&!this.parent.enableKeyboardShortcut&&n.preventDefault()}}else if("Escape"===n.key||27===n.keyCode){var oe=!(0,e.isNullOrUndefined)(this.parent.spreadsheetNoteModule.noteCellIndexes)?this.parent.spreadsheetNoteModule.noteCellIndexes:r(this.parent.getActiveSheet().activeCell),se=zn(oe[0],oe[1],this.parent.getActiveSheet()),le=this.parent.getCell(oe[0],oe[1]),de=Pn(this.parent,this.parent.activeSheetIndex)+"!"+a(oe);if(!(0,e.isNullOrUndefined)(d)&&!(0,e.isNullOrUndefined)(d.value)&&((0,e.isNullOrUndefined)(se)||(0,e.isNullOrUndefined)(se.notes)||se.notes!==d.value)&&document.activeElement.className.indexOf("e-addNoteContainer")>-1){var he=!(0,e.isNullOrUndefined)(se)&&se.notes?"editNote":"addNote";this.parent.notify(Ea,{args:{action:"beforeCellSave",eventArgs:{address:de}}}),Vr(this.parent,this.parent.getActiveSheet(),{rowIdx:oe[0],colIdx:oe[1],preventEvt:!0,cell:{notes:d.value,isNoteEditable:!1}});var pe={notes:d.value,address:de};this.parent.notify(Pa,{eventArgs:pe,action:he})}this.parent.spreadsheetNoteModule.isShowNote=null,this.parent.notify(ya,""),Md(le)}}else n.preventDefault()},n.prototype.setFocus=function(e,t,r){"Sheet"===e?t.shiftKey?this.parent.showFormulaBar?this.focusEle(t,".e-formula-bar-panel .e-combobox"):this.setFocus("FormulaBar",t,r):this.parent.showSheetTabs?this.focusEle(t,".e-sheet-tab-panel .e-icon-btn:not(:disabled)"):this.setFocus("SheetTabs",t,r):"SheetTabs"===e?t.shiftKey?r||this.focusEle(t,".e-selectall"):this.parent.showRibbon?this.focusEle(t,".e-ribbon .e-toolbar-items .e-toolbar-item.e-active .e-tab-wrap",!0):this.setFocus("Ribbon",t,r):"Ribbon"===e?t.shiftKey?this.parent.showSheetTabs?this.focusEle(t,".e-sheet-tab-panel .e-icon-btn:not(:disabled)"):r||this.focusEle(t,".e-selectall"):this.parent.showFormulaBar?this.focusEle(t,".e-formula-bar-panel .e-combobox"):this.setFocus("FormulaBar",t,r):"FormulaBar"===e&&(t.shiftKey?this.parent.showRibbon?this.focusEle(t,".e-ribbon .e-toolbar-items .e-toolbar-item.e-active .e-tab-wrap",!0):this.setFocus("Ribbon",t,r):r||this.focusEle(t,".e-selectall"))},n.prototype.focusEle=function(t,r,n,i,a){if(a=a||this.parent.element.querySelector(r),n&&!a){var o=(s=this.parent.element.querySelector(".e-ribbon .e-tab"))&&(0,e.getComponent)(s,"tab").selectedItem||0;a=(a=this.parent.element.querySelector(".e-tab-header").getElementsByClassName("e-toolbar-item")[o])&&a.querySelector(".e-tab-wrap")}if(a)if(t.preventDefault(),i)a.click(),Md(a),a.setSelectionRange(a.value.length,a.value.length);else if(n){var s;if(a.setAttribute("tabindex","0"),a.parentElement.classList.contains("e-active")&&a.parentElement.classList.contains("e-toolbar-item"))!(s=this.parent.element.querySelector(".e-sheet-tab-panel .e-sheet-tab"))&&s.classList.contains("e-focused")&&s.classList.add("e-focused");a.focus()}else Md(a)},n.prototype.updateSelection=function(e,t,r){e.isProtected&&!e.protectSettings.selectCells&&e.protectSettings.selectUnLockedCells&&Bd(this.parent,c(t))||this.parent.notify(Si,{range:t,shiftKey:r.shiftKey})},n.prototype.getNextNonEmptyCell=function(r,n,i){var a,o,s=this.parent.getActiveSheet(),l=function(t,r){var n=zn(t,r,s,null,!0).value;return!(0,e.isNullOrUndefined)(n)&&""!==n};if("down"===i){a=l(p=Pr(s,r+1,!0),n);for(var d=Pr(s,s.rowCount-1,!1),h=p;h<s.rowCount;h++){if(h===d)return h;if(a){if(!l(Pr(s,h,!0),n))return Pr(s,h-1,!1)}else if(l(o=Pr(s,h+1,!0),n))return o}return r}if("top"===i){var p;a=l(p=Pr(s,r-1,!1),n);for(var c=this.parent.frozenRowCount(s)?t(s.topLeftCell)[0]:0,u=Pr(s,c,!0),f=p;f>=0;f--){if(f===u)return f;if(a){if(!l(Pr(s,f,!1),n))return Pr(s,f+1,!0)}else if(l(o=Pr(s,f-1,!1),n))return o}return r}if("right"===i){var g;a=l(r,g=Pr(s,n+1,!0,"columns"));for(var m=Pr(s,s.colCount-1,!1,"columns"),v=g;v<s.colCount;v++){if(v===m)return v;if(a){if(!l(r,Pr(s,v,!0,"columns")))return Pr(s,v-1,!1,"columns")}else if(l(r,o=Pr(s,v+1,!0,"columns")))return o}return n}a=l(r,g=Pr(s,n-1,!1,"columns"));c=this.parent.frozenColCount(s)?t(s.topLeftCell)[1]:0,u=Pr(s,c,!0,"columns");for(var y=g;y>=0;y--){if(y===u)return y;if(a){if(!l(r,Pr(s,y,!1,"columns")))return Pr(s,y+1,!0,"columns")}else if(l(r,o=Pr(s,y-1,!1,"columns")))return o}return n},n.prototype.getNextUnlockedCell=function(e,t){var r,n=this.parent.getActiveSheet();if("right"===e)for(var i=t[0],a=void 0,o=void 0,s=n.usedRange.rowIndex,l=n.usedRange.colIndex;i<=s;){for(a=void 0===a?t[1]+1:0,o&&i===t[0]&&(l=t[1]-1);a<=l;a++)if(!Tr(zn(i,a,n),r=Il(n,a)||{})&&!r.hidden&&!ml(n,i))return[i,a];i!==n.usedRange.rowIndex||o?i++:(i=0,s=t[0],o=!0)}else if("left"===e)for(i=t[0],a=void 0,o=void 0,s=0,l=0;i>=s;){for(a=void 0===a?t[1]-1:n.usedRange.colIndex,o&&i===t[0]&&(l=t[1]+1);a>=l;a--)if(!Tr(zn(i,a,n),r=Il(n,a)||{})&&!r.hidden&&!ml(n,i))return[i,a];0!==i||o?i--:(i=n.usedRange.rowIndex,s=t[0],o=!0)}else if("down"===e)for(a=t[1],i=void 0,o=void 0,l=n.usedRange.colIndex,s=n.usedRange.rowIndex;a<=l;){for(i=void 0===i?t[0]+1:0,o&&a===t[1]&&(s=t[0]-1);i<=s;i++)if(!Tr(zn(i,a,n),r=Il(n,a)||{})&&!r.hidden&&!ml(n,i))return[i,a];a!==n.usedRange.colIndex||o?a++:(a=0,l=t[1],o=!0)}else for(a=t[1],i=void 0,o=void 0,l=0,s=0;a>=l;){for(i=void 0===i?t[0]-1:n.usedRange.rowIndex,o&&a===t[1]&&(s=t[0]+1);i>=s;i--)if(!Tr(zn(i,a,n),r=Il(n,a)||{})&&!r.hidden&&!ml(n,i))return[i,a];0!==a||o?a--:(a=n.usedRange.colIndex,l=t[1],o=!0)}return t},n.prototype.shiftSelection=function(n){var i=this.parent.getActiveSheet(),o=t(i.selectedRange),s=c(o),l=!0,d=this.parent.enableRtl;if(38===n.keyCode){for(var h=s[1];h<=s[3];h++){var p=zn(o[2],h,i);if(!(0,e.isNullOrUndefined)(p)&&p.rowSpan&&p.rowSpan<0){o[2]=Pr(i,o[2]-(Math.abs(p.rowSpan)+1),!1),l=!1;break}}l&&(o[2]=Pr(i,o[2]-1,!1));var u=this.parent.frozenRowCount(i)?t(i.topLeftCell)[0]:0;if(o[2]<u)return}if(40===n.keyCode){for(h=s[1];h<=s[3];h++){p=zn(o[2],h,i);if(!(0,e.isNullOrUndefined)(p)&&p.rowSpan&&p.rowSpan>0){o[2]=Pr(i,o[2]+Math.abs(p.rowSpan),!0),l=!1;break}}if(l&&(o[2]=Pr(i,o[2]+1,!0)),o[2]>=i.rowCount&&(o[2]=Pr(i,i.rowCount-1,!1),o[2]<0))return}if(39===n.keyCode&&!d||37===n.keyCode&&d){for(h=s[0];h<=s[2];h++){p=zn(h,o[3],i);if(!(0,e.isNullOrUndefined)(p)&&p.colSpan&&p.colSpan>0){o[3]=Pr(i,o[3]+Math.abs(p.colSpan),!0,"columns"),l=!1;break}}if(l&&(o[3]=Pr(i,o[3]+1,!0,"columns")),o[3]>=i.colCount&&(o[3]=Pr(i,i.colCount-1,!1,"columns"),o[3]<0))return}if(37===n.keyCode&&!d||39===n.keyCode&&d){for(h=s[0];h<=s[2];h++){p=zn(h,o[3],i);if(!(0,e.isNullOrUndefined)(p)&&p.colSpan&&p.colSpan<0){o[3]=Pr(i,o[3]-(Math.abs(p.colSpan)+1),!1,"columns"),l=!1;break}}l&&(o[3]=Pr(i,o[3]-1,!1,"columns"));u=this.parent.frozenColCount(i)?t(i.topLeftCell)[1]:0;if(o[3]<u)return}if(!this.parent.scrollSettings.enableVirtualization&&n.shiftKey&&n.ctrlKey){var f=[i.usedRange.rowIndex,i.usedRange.colIndex];if(37===n.keyCode&&(o[3]<=f[1]?o[3]=Pr(i,0,!0,"columns"):o[3]=Pr(i,f[1],!0,"columns")),38===n.keyCode&&(o[2]<=f[0]?o[2]=Pr(i,0,!0):o[2]=Pr(i,f[0],!0)),39===n.keyCode&&(o[3]<=f[1]?o[3]=Pr(i,f[1],!1,"columns"):o[3]=Pr(i,i.colCount,!1,"columns"),o[3]<0))return;if(40===n.keyCode&&(o[2]<=f[0]?o[2]=Pr(i,f[0],!1):o[2]=Pr(i,i.rowCount,!1),o[2]<0))return}if(37===n.keyCode||39===n.keyCode||38===n.keyCode||40===n.keyCode){var g=r(i.activeCell);this.parent.isEdit&&n.shiftKey?(n.preventDefault(),this.parent.notify(Di,{range:o,e:n}),this.parent.notify(bo,{range:a(c(o)),isSelect:!1}),this.parent.notify(vo,{})):this.parent.notify(Si,{range:o,shiftKey:n.shiftKey}),this.scrollNavigation([Rr(i,o)?g[0]:o[2],Nr(i,o)?g[1]:o[3]])}},n.prototype.scrollNavigation=function(e,n){if(this.parent.allowScrolling){var i=this.parent.enableRtl?-1:1,a=this.parent.getMainContent().parentElement,o=this.parent.getScrollElement(),s=this.parent.getActiveSheet(),l=c(t(s.selectedRange)),d=r(s.topLeftCell),h=this.parent.frozenRowCount(s),p=this.parent.frozenColCount(s),u=r(s.paneTopLeftCell),f=Pr(s,e[0]<h?d[0]:u[0],!0),g=this.parent.scrollModule.offset.top.size;if(a.scrollTop)if(h&&e[0]!==l[2]){if(e[0]===h)return void(a.scrollTop=0);e[0]===h-1&&(a.scrollTop=0)}else if(e[0]===Pr(s,0,!0))return void(a.scrollTop=0);if(o&&o.scrollLeft)if(p&&e[1]!==l[3]){if(e[1]===p)return void(o.scrollLeft=0);e[1]===p-1&&(o.scrollLeft=0)}else if(e[1]===Pr(s,0,!0,"columns"))return void(o.scrollLeft=0);var m=Vd(this.parent,f).index;if(m<=e[0]){if(e[0]>=h)if(n){var v=a.getBoundingClientRect().height,y=bl(s,u[0],e[0],!0);a.scrollTop=y>2*v?g+y-v:g+y-yl(s,e[0],!0),Md(this.parent.element)}else a.scrollTop=g+bl(s,m,e[0],!0)}else f>e[0]&&(a.scrollTop&&(this.parent.scrollModule.isKeyScroll=!1),a.scrollTop=g-Math.ceil(bl(s,e[0],f-1,!0)),n&&Md(this.parent.element));var C=zd(this.parent,u[1]);if(C<=e[1]&&o){if(e[1]>=p)if(n){var b=o.getBoundingClientRect().width,x=Rl(s,u[1],e[1],!0);o.scrollLeft=x>2*b?(this.parent.scrollModule.offset.left.size+x-b)*i:(this.parent.scrollModule.offset.left.size+(x-Nl(s,e[0],null,!0)))*i,Md(this.parent.element)}else o.scrollLeft=(this.parent.scrollModule.offset.left.size+Rl(s,C,e[1],!0))*i}else u[1]>e[1]&&o&&(o.scrollLeft&&(this.parent.scrollModule.isKeyScroll=!1),o.scrollLeft=(this.parent.scrollModule.offset.left.size-Rl(s,e[1],u[1]-1,!0))*i,n&&Md(this.parent.element))}},n.prototype.getModuleName=function(){return"keyboardNavigation"},n.prototype.destroy=function(){this.removeEventListener(),this.parent=null},n}(),ch=function(){function n(e){this.parent=e,this.addEventListener()}return n.prototype.addEventListener=function(){this.parent.on(ci,this.keyDownHandler,this),this.parent.on(pi,this.keyUpHandler,this)},n.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ci,this.keyDownHandler),this.parent.off(pi,this.keyUpHandler))},n.prototype.isTrgtNotInput=function(t){var r=t.target;return!((0,e.closest)(r,".e-filter-popup")||(0,e.closest)(r,".e-find-dlg")||(0,e.closest)(r,".e-hyperlink-dlg")||(0,e.closest)(r,".e-sheet-tab")||(0,e.closest)(r,".e-name-box")||(0,e.closest)(r,".e-link-dialog"))},n.prototype.ribbonShortCuts=function(t){if(this.parent.showRibbon&&t.altKey&&!t.ctrlKey&&!t.shiftKey){var n=(0,e.getComponent)(this.parent.element.querySelector(".e-ribbon .e-tab"),"tab"),i=void 0;if(72===t.keyCode)i=1;else if(78===t.keyCode)i=2;else if(65===t.keyCode)i=4;else if(87===t.keyCode)i=5;else if(77===t.keyCode)i=3;else if(70===t.keyCode)t.preventDefault(),(0,e.select)("#"+this.parent.element.id+"_File",this.parent.element).click();else if(18===t.keyCode){t.preventDefault();var a=r(this.parent.getActiveSheet().activeCell),o={sheetIdx:this.parent.activeSheetIndex};if(this.parent.notify(Ba,o),!(o.hasFilter&&o.filterRange&&o.filterRange[0]===a[0]&&o.filterRange[1]<=a[1]&&o.filterRange[3]>=a[1])){var s=document.activeElement;if(!(s.classList.contains("e-spreadsheet-edit")||s.classList.contains("e-sheet-rename")||s.id===this.parent.element.id+"_name_box"||(0,e.closest)(s,".e-dropdown-btn")||(0,e.closest)(s,".e-split-btn")||(0,e.closest)(s,".e-popup-open"))){var l=this.parent.getCell(a[0],a[1]);if(l&&l.querySelector(".e-validation-list"))return;if((0,e.closest)(s,".e-ribbon"))return void Md(this.parent.element);for(var d=0;d<=this.parent.ribbonModule.ribbon.items.length;d++)if(d===this.parent.ribbonModule.ribbon.selectedTab){var h=this.parent.element.querySelector(".e-toolbar-items").children[d+2].children[0];return h.setAttribute("tabindex","0"),void Md(h)}}}}i&&(n.items[i].disabled||n.items[i].cssClass.includes("e-hide")?Md(this.parent.element):(t.preventDefault(),n.select(i,Object.assign(t,{isShortcut:!0}))))}},n.prototype.keyUpHandler=function(t){if(37===t.keyCode||39===t.keyCode){var r=document.activeElement;if(r.classList.contains("e-colorpicker-wrapper")||r.classList.contains("e-split-btn-wrapper")){var n=r.querySelector(".e-split-btn");n&&Md(n)}}else if(13===t.keyCode){var i=t.target;if(i.classList.contains("e-scroll-nav")){var a=function(){i.getAttribute("tabindex")||(i.setAttribute("tabindex","0"),Md(i)),e.EventHandler.remove(i,"blur",a)};e.EventHandler.add(i,"blur",a,this)}}},n.prototype.keyDownHandler=function(n){var i="None"===this.parent.selectionSettings.mode;this.ribbonShortCuts(n);var o=this.parent.getActiveSheet(),s=n.target,l=n.target;if((0,e.isNullOrUndefined)(l)||!l.classList.contains("e-addNoteContainer")){if((n.ctrlKey||n.metaKey)&&this.isTrgtNotInput(n)){(0,e.closest)(s,".e-find-dlg")||i||([79,83].indexOf(n.keyCode)>-1?n.preventDefault():65!==n.keyCode||this.parent.isEdit||n.preventDefault());var d=r(o.activeCell);if(79===n.keyCode)this.parent.allowOpen&&this.parent.openUrl&&(0,e.select)("#"+this.parent.element.id+"_fileUpload",this.parent.element).click();else if(83===n.keyCode)this.parent.saveUrl&&this.parent.allowSave&&this.parent.notify(J,null);else if(67!==n.keyCode||i)if(75!==n.keyCode||i)if(90!==n.keyCode||i)if(89!==n.keyCode||i){if((82===n.keyCode||68===n.keyCode)&&!i){n.preventDefault();var h=c(t(o.selectedRange)),p={colIndex:h[1],rowIndex:h[0]},u=void 0,f=void 0;if(68===n.keyCode?(h[0]===h[2]?p.rowIndex=h[0]-1:h[0]+=1,f=a([p.rowIndex,p.colIndex,p.rowIndex,h[3]]),u="Down"):(h[1]===h[3]?p.colIndex=h[1]-1:h[1]+=1,u="Right",f=a([p.rowIndex,p.colIndex,h[2],p.colIndex])),p.rowIndex<0||p.colIndex<0)return;this.parent.notify(ts,{fillType:zn(p.rowIndex,p.colIndex,o,!1,!0).formula?"FillSeries":"CopyCells",dAutoFillCell:f,rangeInfo:{direction:u,startCell:p,endCell:{rowIndex:h[2],colIndex:h[3]},fillRange:h}}),this.parent.notify(rr,{type:"mousedown"}),this.parent.notify(Mt,null)}}else this.parent.isEdit||(n.preventDefault(),this.parent.notify(wa,{isUndo:!1}));else this.parent.isEdit||(n.preventDefault(),this.parent.notify(wa,{isUndo:!0}));else{var g=o.rows[d[0]],m=void 0;n.preventDefault(),(0,e.isNullOrUndefined)(g)||(m=g.cells[d[1]]),(0,e.isNullOrUndefined)(m)&&jn(d[0],d[1],o,m,!1),m&&m.hyperlink?this.parent.notify(ha,null):this.parent.notify(da,null)}else this.parent.notify(Pi,{promise:Promise});var v=o.isProtected&&Tr(zn(d[0],d[1],o),Il(o,d[1]));if(70===n.keyCode&&!i&&this.parent.allowFindAndReplace&&(n.preventDefault(),this.parent.notify(Z,{})),v&&o.isProtected&&86!==n.keyCode||70===n.keyCode||i||(71===n.keyCode?(n.preventDefault(),this.parent.notify(Ka,null)):72===n.keyCode?(n.preventDefault(),this.parent.notify($a,null)):88===n.keyCode?this.parent.notify(Li,{promise:Promise}):86===n.keyCode&&this.parent.notify(Mi,{isAction:!0}),!n.shiftKey||76!==n.keyCode||this.parent.isEdit||o.isProtected||(n.preventDefault(),this.parent.notify(Aa,{}))),!i&&(!o.isProtected||o.protectSettings.formatCells))if(66===n.keyCode)n.preventDefault(),y="bold"===(y=this.parent.getCellStyleValue(["fontWeight"],d).fontWeight)?"normal":"bold",this.parent.notify(ae,{style:{fontWeight:y},onActionUpdate:!0,refreshRibbon:!0});else if(73===n.keyCode){var y;n.preventDefault(),y="italic"===(y=this.parent.getCellStyleValue(["fontStyle"],d).fontStyle)?"normal":"italic",this.parent.notify(ae,{style:{fontStyle:y},onActionUpdate:!0,refreshRibbon:!0})}else n.ctrlKey&&85===n.keyCode&&!n.shiftKey?(n.preventDefault(),this.parent.notify(se,{style:{textDecoration:"underline"},refreshRibbon:!0})):n.ctrlKey&&53===n.keyCode&&!n.shiftKey&&(n.preventDefault(),this.parent.notify(se,{style:{textDecoration:"line-through"},refreshRibbon:!0}))}if(27===n.keyCode&&this.parent.notify(Bi,null),((n.ctrlKey||n.metaKey)&&119===n.keyCode||13===n.keyCode&&s.classList.contains("e-drop-icon"))&&this.parent.showRibbon){n.preventDefault();var C=this.parent.element.querySelector(".e-drop-icon");C&&C.click()}if((n.ctrlKey||n.metaKey)&&!i)if(57===n.keyCode){if(!o.isProtected||o.protectSettings.formatRows){n.preventDefault();d=t(o.selectedRange);this.parent.notify(Rt,{startIndex:d[0],endIndex:d[2],hide:!n.shiftKey,isCol:!1,actionUpdate:!0})}}else if(48===n.keyCode&&(!o.isProtected||o.protectSettings.formatColumns)){d=t(o.selectedRange);this.parent.notify(Rt,{startIndex:d[1],endIndex:d[3],hide:!n.shiftKey,isCol:!0,actionUpdate:!0})}if(n.shiftKey&&!i)if(113!==n.keyCode||o.isProtected){if(114===n.keyCode)n.preventDefault(),this.parent.notify(ps,null);else if(116===n.keyCode&&this.parent.allowFindAndReplace)n.preventDefault(),this.parent.notify(Z,{});else if(121===n.keyCode){var b=document.activeElement.className;["e-spreadsheet","e-cell","e-header-cell","e-clipboard","e-rowhdr-table","e-selectall-table","e-main-panel"].some((function(e){return b.includes(e)}))&&this.focusTarget(o)}}else n.preventDefault(),n.target.children.length>0&&"string"==typeof n.target.children[n.target.children.length-1].className&&n.target.children[n.target.children.length-1].className.indexOf("e-addNoteIndicator")>-1?this.parent.notify(ua,null):this.parent.notify(ca,null);if(n.altKey&&!i&&((n.ctrlKey||n.metaKey)&&78===n.keyCode?(n.preventDefault(),this.parent.refresh(!0)):113===n.keyCode&&this.parent.saveUrl&&(n.preventDefault(),this.parent.notify(J,null))),(n.ctrlKey||n.metaKey)&&n.shiftKey&&!i){if(!o.isProtected||o.protectSettings.formatCells){var x=o.selectedRange,S=void 0;if(192===n.keyCode)S="General";else if(52===n.keyCode)S=Vs("CurrencyWithColorCode");else if(53===n.keyCode)S="0%";else if(54===n.keyCode)S=Vs("Scientific");else if(51===n.keyCode)S="dd-mmm-yy";else if(50===n.keyCode)S="h:mm AM/PM";else if(49===n.keyCode)S=Vs("Number");else if(55===n.keyCode){n.preventDefault();this.parent.notify(ae,{style:{border:"1px solid #000000"},onActionUpdate:!0,borderType:"Outer"})}if(S)if(!Qr(this.parent,c(t(x)))){var w={format:S,range:x,cancel:!1,requestType:"NumberFormat"},I={range:o.name+"!"+w.range,format:w.format,requestType:"NumberFormat"};this.parent.trigger("beforeCellFormat",w),this.parent.notify(K,{eventArgs:w,action:"format"}),w.cancel||(this.parent.notify(te,w),this.parent.notify(rr,{type:"mousedown"}),this.parent.notify(Pa,{eventArgs:I,action:"format"}),this.parent.notify(Mt,null))}}if(85===n.keyCode){n.preventDefault();var E=this.parent.element.querySelector(".e-formula-bar-panel .e-drop-icon");E&&E.click()}}122!==n.keyCode||!n.shiftKey||n.ctrlKey||this.parent.isProtected||this.parent.notify($e,{model:this.parent,start:this.parent.activeSheetIndex+1,end:this.parent.activeSheetIndex+1,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex+1}),n.shiftKey&&n.altKey&&75===n.keyCode&&this.parent.showSheetTabs&&this.parent.element.querySelector(".e-sheets-list").click()}},n.prototype.focusTarget=function(e){var r,n=c(t(e.selectedRange)),i=0===n[1]&&n[3]===e.colCount-1,a=0===n[0]&&n[2]===e.rowCount-1;if(i&&a)r=this.parent.element.querySelector(".e-selectall");else if(i){var o=this.parent.frozenRowCount(e);if(n[0]<o){r=(p=this.parent.getRow(n[0],this.parent.sheetModule.getSelectAllTable()))&&p.cells[0]}else{n[0]=Pr(e,n[0],!0);var s=Pr(e,t(e.paneTopLeftCell)[0],!0),l=Vd(this.parent,s).index,d=void 0;r=(d=n[0]>s&&n[0]<l?this.parent.getRow(n[0],this.parent.getRowHeaderTable()):n[0]>=l?this.parent.getRow(l-1,this.parent.getRowHeaderTable()):this.parent.getRow(s+1,this.parent.getRowHeaderTable()))&&d.cells[0]}}else if(a){var h=this.parent.frozenColCount(e);if(n[1]<h){var p;r=(p=this.parent.element.querySelector(".e-selectall-container .e-header-row"))&&this.parent.getCell(0,n[1],p)}else{n[1]=Pr(e,n[1],!0,"columns");var u=Pr(e,t(e.paneTopLeftCell)[1],!0,"columns"),f=zd(this.parent,u);d=this.parent.element.querySelector(".e-column-header .e-header-row");r=n[1]>u&&n[1]<f?d&&this.parent.getCell(0,n[1],d):n[1]>=f?d&&this.parent.getCell(0,f-1,d):d&&this.parent.getCell(0,u+1,d)}}else{var g=t(e.paneTopLeftCell);r=this.parent.getCell(n[0],n[1]);o=this.parent.frozenRowCount(e),h=this.parent.frozenColCount(e);if(n[0]<o&&n[1]<h)r=this.parent.getCell(n[0],n[1]);else if(n[0]<o){u=t(e.paneTopLeftCell)[1],f=zd(this.parent,u);r=n[1]>u&&n[1]<f?this.parent.getCell(n[0],n[1]):n[1]>=f?this.parent.getCell(n[0],f-1):this.parent.getCell(n[0],u+1)}else if(n[1]<h){s=t(e.paneTopLeftCell)[0],l=Vd(this.parent,s).index;r=n[0]>s&&n[0]<l?this.parent.getCell(n[0],n[1]):n[0]>=l?this.parent.getCell(l-1,n[1]):this.parent.getCell(s+1,n[1])}else{s=t(e.paneTopLeftCell)[0],l=Vd(this.parent,s).index,u=t(e.paneTopLeftCell)[1],f=zd(this.parent,u);r=n[0]>s&&n[0]<l?n[1]>u&&n[1]<f?this.parent.getCell(n[0],n[1]):n[1]>=f?this.parent.getCell(n[0],f-1):this.parent.getCell(n[0],u+1):n[0]>=l?n[1]>u&&n[1]<f?this.parent.getCell(l-1,n[1]):n[1]>=f?this.parent.getCell(l-1,f-1):this.parent.getCell(l-1,u+1):n[1]>u&&n[1]<f?this.parent.getCell(s+1,n[1]):n[1]>=f?this.parent.getCell(s+1,f-1):this.parent.getCell(s+1,u+1)}r||(r=this.parent.getCell(g[0]+1,g[1]+1))}r&&Md(r)},n.prototype.getModuleName=function(){return"keyboardShortcut"},n.prototype.destroy=function(){this.removeEventListener(),this.parent=null},n}(),uh=function(){function r(e){this.checkHeight=!1,this.parent=e,this.addEventListener()}return r.prototype.applyCellFormat=function(e){if(e.checkHeight)return this.checkHeight||(this.checkHeight=!0),void this.updateRowHeight(e.rowIdx,e.colIdx,e.lastCell,e.onActionUpdate,e.outsideViewport,e.rowHeight);var t=Object.keys(e.style),r=this.parent.getActiveSheet();if(!(e.lastCell&&!t.length&&Pd(r,e.rowIdx)<=(r.standardHeight||20))){var n=e.td||this.parent.getCell(e.rowIdx,e.colIdx);if(n){this.updateMergeBorder(e,r);var i=void 0;if(e.formatColor&&n.style.color===e.formatColor&&(i=e.style.color,delete e.style.color),void 0!==e.style.border||void 0!==e.style.borderTop||void 0!==e.style.borderLeft){var a={};Object.keys(e.style).forEach((function(t){a[""+t]=e.style[""+t]})),void 0!==a.border&&(Object.assign(n.style,{borderRight:e.style.border,borderBottom:e.style.border}),this.setLeftBorder(e.style.border,n,e.rowIdx,e.colIdx,e.colIdx===this.parent.frozenColCount(r)?e.hRow:e.row,e.onActionUpdate,e.first,r),this.setTopBorder(e.style.border,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,r,e),delete a.border),void 0!==a.borderTop&&(this.setTopBorder(e.style.borderTop,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,r,e),delete a.borderTop),void 0!==a.borderLeft&&(this.setLeftBorder(e.style.borderLeft,n,e.rowIdx,e.colIdx,e.colIdx===this.parent.frozenColCount(r)?e.hRow:e.row,e.onActionUpdate,e.first,r),delete a.borderLeft),Object.keys(a).length&&(void 0!==a.borderBottom&&this.setThickBorderHeight(a.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,a))}else{if(void 0!==e.style.borderBottom&&this.setThickBorderHeight(e.style.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,e.style),n){var o=n.querySelector(".e-cf-databar");if(o){var s=o.querySelector(".e-databar-value");s&&(s.style.textDecoration=e.style.textDecoration,e.style.verticalAlign&&(s.style.alignItems="top"===e.style.verticalAlign?"start":"middle"===e.style.verticalAlign?"center":"end"))}}var l=zn(e.rowIdx,e.colIdx,r);if(l&&(l.rowSpan||l.colSpan)&&n.offsetHeight>0)(h=Nd(this.parent,l.style||this.parent.cellStyle))>n.offsetHeight&&Ed(this.parent,r,n.offsetHeight,e.rowIdx);if(e.style.fontSize&&n){var d=n.querySelector(".e-validation-list");d&&this.parent.notify(vr,{ddlCont:d,rowIdx:e.rowIdx,colIdx:e.colIdx,updatePosition:!0})}}var h,p=zn(e.rowIdx,e.colIdx,r,null,!0);if(r.rows[e.rowIdx]&&r.rows[e.rowIdx].customHeight){if(!p.wrap&&(e.style.fontSize||e.style.fontFamily)){var c=yl(r,e.rowIdx,!0)-Fd(e.rowIdx,e.colIdx,r);c<Nd(this.parent,p.style)?n.style.lineHeight=c+"px":n.style.lineHeight&&(n.style.lineHeight="")}}else if(e.isHeightCheckNeeded)if(e.manualUpdate)this.checkHeight||(this.checkHeight=Mr(e.style,e.onActionUpdate)),n&&n.children[0]&&"e-cf-databar"===n.children[0].className&&e.style.fontSize&&(n.children[0].querySelector(".e-databar-value").style.fontSize=e.style.fontSize),e.isFromAutoFillOption||this.updateRowHeight(e.rowIdx,e.colIdx,e.lastCell,e.onActionUpdate,null,e.rowHeight),p.wrap&&(e.style.fontSize||e.style.fontFamily)&&(n.style.lineHeight=parseFloat(p.style&&p.style.fontSize||this.parent.cellStyle.fontSize)*Rd(p.style&&p.style.fontFamily?p.style:this.parent.cellStyle)+"pt");else if(!p.wrap&&Mr(e.style)&&Ld(r,e.rowIdx,e.colIdx,Dd(this.parent,e.rowIdx,e.colIdx,r,e.style)),e.lastCell)(h=Pd(r,e.rowIdx))>(r.standardHeight||20)&&h>yl(r,e.rowIdx)&&Ed(this.parent,r,h,e.rowIdx,e.row,e.hRow);void 0!==i&&(e.style.color=i)}else this.updateRowHeight(e.rowIdx,e.colIdx,!0,e.onActionUpdate,null,e.rowHeight)}},r.prototype.updateRowHeight=function(e,t,r,n,i,a){if(this.checkHeight){var o=this.parent.getActiveSheet(),s=zn(e,t,o,null,!0);if(!s.rowSpan){var l=0;l=Dd(this.parent,e,t,o,s.style||this.parent.cellStyle,s.wrap&&!s.colSpan?kd(this.parent.getDisplayText(s),Td(o,e,t),s.style,this.parent.cellStyle):1);var d=s.value&&s.value.toString();if(d&&d.indexOf("\n")>-1){var h=void 0,p=d.split("\n"),c=0,u=p.length;for(h=0;h<u;h++){var f=kd(p[h],Td(o,e,t),s.style,this.parent.cellStyle);0===f&&(f=1),c+=f}l=Dd(this.parent,e,t,o,s.style||this.parent.cellStyle,c)}var g=o&&o.standardHeight?o.standardHeight:20;if(l<g&&(l=g),Ld(o,e,t,l),!i){var m=this.parent.getCell(e,t);m&&m.children[0]&&"e-cf-databar"===m.children[0].className&&(m.children[0].style.height="100%",m.children[0].firstElementChild.nextElementSibling.style.height="100%")}if(r){this.checkHeight=!1;var v=a||Pd(o,e),y=yl(o,e);(n?v!==y:v>y)&&Ed(this.parent,o,v,e,null,null,!0,i)}}}},r.prototype.updateMergeBorder=function(e,t){var r=zn(e.rowIdx,e.colIdx,t,null,!0);if(r.rowSpan>1||r.colSpan>1){var n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};if(this.parent.notify(Et,n),r.rowSpan>1){var i=zn(n.range[2],n.range[1],t,null,!0);i.style&&i.style.borderBottom&&(e.style.borderBottom=i.style.borderBottom)}if(r.colSpan>1){var a=zn(n.range[0],n.range[3],t,null,!0);a.style&&a.style.borderRight&&(e.style.borderRight=a.style.borderRight)}}},r.prototype.setLeftBorder=function(e,t,r,n,i,a,o,s){if(!o||!o.includes("Column")){var l=this.parent.enableRtl?this.parent.getCell(r,n+1,i):this.parent.getCell(r,n-1,i);if(l){var d=zn(r,n-1,s,!1,!0);if(d.rowSpan&&1!==d.rowSpan||d.colSpan&&1!==d.colSpan){var h={range:[r,n-1,r,n-1]};if(this.parent.notify(Et,h),(d=zn(h.range[0],h.range[1],s,!1,!0)).style&&d.style.borderRight&&"none"!==d.style.borderRight)return;if((d=zn(h.range[0],h.range[3],s,null,!0)).style&&d.style.borderRight&&"none"!==d.style.borderRight)return;t.style.borderLeft=e}else a&&""!==e&&n===this.parent.viewport.leftIndex&&(this.parent.getMainContent().scrollLeft-=this.getBorderSize(e)),l.style.borderRight="none"===e?l.style.borderRight:e}else t.style.borderLeft=e}},r.prototype.setTopBorder=function(e,t,r,n,i,a,o,s,l,d,h,p){if(!s||!s.includes("Row")){var c=n,u=zn(r,n,h,!1,!0);u.colSpan>1&&Al(h,n)&&(c=Pr(h,n,!0,"columns"))>n+u.colSpan-1&&(c=n);var f=this.parent.getCell(r-1,c,i);if(f)if((u=zn(r-1,n,h,!1,!0)).rowSpan&&1!==u.rowSpan||u.colSpan&&1!==u.colSpan){var g={range:[r-1,n,r-1,n]};if(this.parent.notify(Et,g),(u=zn(g.range[0],g.range[1],h,!1,!0)).style&&u.style.borderBottom&&"none"!==u.style.borderBottom)return;if((u=zn(g.range[2],g.range[1],h,null,!0)).style&&u.style.borderBottom&&"none"!==u.style.borderBottom)return;t.style.borderTop=e,void 0!==p.mergeBorderRows&&-1===p.mergeBorderRows.indexOf(r)&&p.mergeBorderRows.push(r)}else{if(ml(h,r-1)){var m=[Number(f.parentElement.getAttribute("aria-rowindex"))-1,n];if(this.parent.getCellStyleValue(["bottomPriority"],m).bottomPriority)return}o&&""!==e&&h.topLeftCell.includes(""+(r+1))&&(this.parent.getMainContent().parentElement.scrollTop-=this.getBorderSize(e)),this.setThickBorderHeight(e,r-1,n,f,i,a,o,l,d),f.style.borderBottom="none"===e?f.style.borderBottom:e}else t.style.borderTop=e}},r.prototype.setThickBorderHeight=function(e,t,r,n,i,a,o,s,l){var d=e?this.getBorderSize(e):1,h=this.parent.getActiveSheet();if(d>2&&(!h.rows[t]||!h.rows[t].customHeight))if(l)this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,r,s,o);else{var p=yl(h,t),c=Math.ceil(this.parent.calculateHeight(this.parent.getCellStyleValue(["fontFamily","fontSize"],[t,r]),1,3));c>p&&Ed(this.parent,h,c,t,i,a)}if(h.rows[t]&&h.rows[t].customHeight){var u=zn(t,r,h,null,!0);if(!u.wrap)if(d>1){var f=yl(h,t,!0)-Fd(t,r,h);f<Nd(this.parent,u.style)&&d>1?n.style.lineHeight=f+"px":n.style.lineHeight&&(n.style.lineHeight="")}else n.style.lineHeight&&(n.style.lineHeight="")}else o&&(s||!this.checkHeight)&&d<3&&(this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,r,s,o))},r.prototype.getBorderSize=function(e){var t=e.split(" ")[0];return"thin"===t?1:"medium"===t?2:"thick"===t?3:parseInt(t,10)||1},r.prototype.clearObj=function(r){var n=this,i=r.options,o=i.range?i.range.indexOf("!")>0?i.range.substring(i.range.lastIndexOf("!")+1):i.range:this.parent.getActiveSheet().selectedRange,s=i.range&&i.range.indexOf("!")>0?In(this.parent,i.range.substring(0,i.range.lastIndexOf("!"))):this.parent.activeSheetIndex,l=c(t(o));if(Qr(this.parent,l))r.isAction&&this.parent.notify(to,null);else{var d,h,p,u=this.parent.sheets[s],f=l[0],g=l[2],m=this.parent.element.getElementsByClassName("e-ss-overlay-active"),v=m.length>0,y=this.parent.element.getElementsByClassName("e-prev-highlight-bottom").length>0,C={range:o,type:i.type,requestType:"clear",sheetIndex:s},b=function(){r.isAction&&n.parent.notify(K,{action:"beforeClear",eventArgs:C})},x=function(){r.isAction&&(C={range:u.name+"!"+o,type:i.type,sheetIndex:s},p&&(C.cfClearActionArgs=p.cfClearActionArgs),n.parent.notify(Pa,{eventArgs:C,action:"clear",isSelectAll:y}))},S="Clear All"===i.type;if(v)("Clear Contents"===i.type||S)&&(b(),m[0].classList.contains("e-datavisualization-chart")?this.parent.notify(Oo,{id:m[0].id,sheetIdx:this.parent.activeSheetIndex+1,clearAction:!0}):this.parent.notify(ko,{id:m[0].id,sheetIdx:this.parent.activeSheetIndex+1,clearAction:!0}),x());else{if(b(),"Clear Formats"===i.type||S)for(p={range:o,sheetIdx:s,isClear:!0},this.parent.notify(Ot,p),r.cfClearActionArgs=p.cfClearActionArgs,S&&(this.parent.notify(Qe,{range:o,isRemoveValidation:!0}),0===f&&0===l[1]&&g>=u.usedRange.rowIndex&&l[3]>=u.usedRange.colIndex&&this.parent.setUsedRange(f,l[1],u,!1,!0));f<=g;f++)for(d=l[1],h=l[3];d<=h;d++){var w=zn(f,d,u),I=this.parent.getCell(f,d);w&&(S&&w.formula&&this.parent.notify(Re,{cellRef:a([f,d,f,d])}),w.wrap&&this.parent.notify(Ge,{range:[f,d,f,d],wrap:!1,sheet:u}),w.hyperlink&&(I&&(0,e.removeClass)(I.querySelectorAll(".e-hyperlink"),"e-hyperlink-style"),S&&this.parent.removeHyperlink(u.name+"!"+a([f,d,f,d]))))}"Clear Hyperlinks"===i.type&&this.parent.removeHyperlink(u.name+"!"+o),this.parent.notify(Ft,{range:u.name+"!"+o,type:i.type}),this.parent.serviceLocator.getService("cell").refreshRange(c(t(o)),!1,!1,!1,"Clear Hyperlinks"===i.type,Kr(this.parent),!S,null,!0,null,y),r.isFromUpdateAction||this.parent.notify(Ti,{address:o}),this.parent.notify(ve,null),x()}}},r.prototype.addEventListener=function(){this.parent.on(le,this.applyCellFormat,this),this.parent.on(go,this.clearObj,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(le,this.applyCellFormat),this.parent.off(go,this.clearObj))},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.checkHeight=null},r.prototype.getModuleName=function(){return"cellformat"},r}(),fh=u(197),gh=function(){function n(e){this.parent=e,this.addEventListener()}return n.prototype.addEventListener=function(){this.parent.on(ii,this.wireEvents,this),this.parent.on(oa,this.autoFit,this),this.parent.on(Ha,this.setAutoFitHandler,this),this.parent.on(us,this.propertyChange,this)},n.prototype.autoFit=function(e){for(var t=e.isRow?this.parent.getRowHeaderTable():this.parent.getColHeaderTable().rows[0],r=e.startIndex;r<=e.endIndex;r++)this.trgtEle=e.isRow?this.parent.getRow(r,t):this.parent.getCell(null,r,t),this.setAutofit(r,!e.isRow)},n.prototype.wireEvents=function(){var t=this.parent.getRowHeaderContent(),r=this.parent.element.getElementsByClassName("e-header-panel")[0];r&&(e.EventHandler.add(r,"dblclick",this.dblClickHandler,this),e.EventHandler.add(t,"dblclick",this.dblClickHandler,this),e.EventHandler.add(r,"mousedown",this.mouseDownHandler,this),e.EventHandler.add(t,"mousedown",this.mouseDownHandler,this),this.wireResizeCursorEvent(t,r))},n.prototype.wireResizeCursorEvent=function(t,r){e.EventHandler.add(t,"mousemove",this.setTarget,this),e.EventHandler.add(r,"mousemove",this.setTarget,this)},n.prototype.unWireResizeCursorEvent=function(){e.EventHandler.remove(this.parent.getRowHeaderContent(),"mousemove",this.setTarget);var t=this.parent.element.getElementsByClassName("e-header-panel")[0];t&&e.EventHandler.remove(t,"mousemove",this.setTarget)},n.prototype.unwireEvents=function(){var t=this.parent.getRowHeaderContent(),r=this.parent.element.getElementsByClassName("e-header-panel")[0];r&&(e.EventHandler.remove(r,"dblclick",this.dblClickHandler),e.EventHandler.remove(t,"dblclick",this.dblClickHandler),e.EventHandler.remove(r,"mousedown",this.mouseDownHandler),e.EventHandler.remove(t,"mousedown",this.mouseDownHandler),this.unWireResizeCursorEvent())},n.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ii,this.wireEvents),this.parent.off(oa,this.autoFit),this.parent.off(Ha,this.setAutoFitHandler),this.parent.off(us,this.propertyChange))},n.prototype.mouseMoveHandler=function(e){var t=this.parent.element.getElementsByClassName("e-colresize-handler")[0],r=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];if(this.resizeTooltip(null,!0,e),t||r){this.isMouseMoved=!0;var n=this.parent.enableRtl;t?(n?e.x<this.trgtEle.parentElement.firstChild.getBoundingClientRect().right:e.x>this.trgtEle.parentElement.firstChild.getBoundingClientRect().left)&&(t.style.left=e.clientX-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().left+"px"):r&&e.y>=this.trgtEle.parentElement.parentElement.firstChild.getBoundingClientRect().top&&(r.style.top=e.clientY-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().top+"px")}},n.prototype.mouseDownHandler=function(t){if((0,e.closest)(t.target,".e-header-cell")&&!t.target.className.includes("e-filter-icon")){if(this.event=t,this.trgtEle=t.target,this.trgtEle.parentElement.classList.contains("e-hide-end")||this.trgtEle.classList.contains("e-hide-end")){var r=this.trgtEle.offsetHeight,n=t.offsetY;(r>=10&&n<5||r-2<8&&n<Math.ceil((n-2)/2))&&this.trgtEle.classList.add("e-skip-resize")}this.updateTarget(t,this.trgtEle);var i=this.trgtEle,a=i.classList.contains("e-colresize")?"e-colresize-handler":i.classList.contains("e-rowresize")?"e-rowresize-handler":"";this.createResizeHandler(i,a),this.unWireResizeCursorEvent(),e.EventHandler.add(this.parent.element,"mousemove",this.mouseMoveHandler,this),e.EventHandler.add(document,"mouseup",this.mouseUpHandler,this)}},n.prototype.mouseUpHandler=function(t){var r=this.parent.element.getElementsByClassName("e-resize-handle")[0];this.resizeOn(t),this.isMouseMoved=null;var n=document.querySelector(".e-header-tooltip");r&&((0,e.detach)(r),this.updateCursor()),n&&n.remove(),e.EventHandler.remove(document,"mouseup",this.mouseUpHandler),e.EventHandler.remove(this.parent.element,"mousemove",this.mouseMoveHandler);var i=this.parent.element.getElementsByClassName("e-header-panel")[0];i&&this.wireResizeCursorEvent(this.parent.getRowHeaderContent(),i),this.parent.notify(Qo,null),this.parent.notify(es,null)},n.prototype.dblClickHandler=function(t){if((0,e.closest)(t.target,".e-header-cell")&&!t.target.className.includes("e-filter-icon"))if(this.trgtEle=t.target,this.updateTarget(t,this.trgtEle))this.parent.notify(to,null);else{if(this.trgtEle.classList.contains("e-colresize")){var r=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1,n=Nl(this.parent.getActiveSheet(),r)+"px";this.trgtEle.classList.contains("e-unhide-column")?this.showHiddenColumns(r-1):this.setAutofit(r,!0,n,this.trgtEle)}else if(this.trgtEle.classList.contains("e-rowresize")){var i=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,a=yl(this.parent.getActiveSheet(),i)+"px";this.setAutofit(i,!1,a)}this.parent.notify(Qo,null)}},n.prototype.setTarget=function(t){if(!this.parent.isEdit&&(0,e.closest)(t.target,".e-header-cell")&&!t.target.className.includes("e-filter-icon")){var r,n,i,a,o=t.target,s=this.parent.getActiveSheet();if(s.isProtected&&(!s.protectSettings.formatColumns||!s.protectSettings.formatRows)){if(!s.protectSettings.formatRows&&!s.protectSettings.formatColumns)return;if(s.protectSettings.formatRows&&(0,e.closest)(o,".e-colhdr-table"))return;if(s.protectSettings.formatColumns&&(0,e.closest)(o,".e-rowhdr-table"))return}if((0,e.closest)(o,".e-header-row"))n=o.offsetWidth,a="e-colresize",i=this.parent.enableRtl?n-t.offsetX:t.offsetX,(l=this.getColPrevSibling(o))&&!l.classList.contains("e-select-all-cell")?r=l:Number(o.getAttribute("aria-colindex"))>1&&(r=o);else if((0,e.closest)(o,".e-row")){var l;i=t.offsetY,n=o.offsetHeight,a="e-rowresize",(l=this.getRowPrevSibling(o))?r=l.firstElementChild:Number(o.parentElement.getAttribute("aria-rowindex"))>1&&(r=o)}if(n-2<8&&i!==Math.ceil((n-2)/2))i<Math.ceil((n-2)/2)?(o.classList.add(a),r&&r.classList.add(a)):i>Math.ceil((n-2)/2)&&o.classList.add(a);else if(n-5<i&&i<=n&&n>=10)o.classList.add(a);else if(i<5&&r&&n>=10)o.classList.add(a),r.classList.add(a);else for(var d=this.parent.element.getElementsByClassName(a),h=0;h<d.length;h++)d[h].classList.remove(a)}},n.prototype.getColPrevSibling=function(t){var r=this.parent.frozenColCount(this.parent.getActiveSheet());return t.previousElementSibling||(r&&(0,e.closest)(t,".e-column-header")?this.parent.getSelectAllContent().querySelector(".e-header-row").lastElementChild:null)},n.prototype.getRowPrevSibling=function(t){var r=this.parent.frozenRowCount(this.parent.getActiveSheet());return t.parentElement.previousElementSibling||(r&&(0,e.closest)(t,".e-row-header")?this.parent.getSelectAllContent().querySelector("tbody").lastElementChild:null)},n.prototype.updateTarget=function(r,n){if((0,e.closest)(n,".e-header-row")){var i=this.parent.enableRtl?n.offsetWidth-r.offsetX:r.offsetX;if(n.offsetWidth<10&&i<Math.ceil((n.offsetWidth-2)/2)||i<5&&n.offsetWidth>=10&&n.classList.contains("e-colresize")){var a=this.parent.getActiveSheet(),o=Number(this.trgtEle.getAttribute("aria-colindex"))-2;if((s=this.getColPrevSibling(n))&&!Al(a,o))this.trgtEle=s;else if(o>-1){if(Il(a,o).isReadOnly||Qr(this.parent,[0,o,a.rowCount-1,o]))return!0;this.trgtEle.classList.add("e-unhide-column")}}}else if(n.offsetHeight<10&&r.offsetY<Math.ceil((n.offsetHeight-2)/2)||r.offsetY<5&&n.offsetHeight>=10&&n.classList.contains("e-rowresize")){var s;a=this.parent.getActiveSheet(),o=Number(n.parentElement.getAttribute("aria-rowindex"))-2;if((s=this.getRowPrevSibling(n))||ml(a,o))if("dblclick"===r.type&&ml(a,o)){if(fl(a,o).isReadOnly||Qr(this.parent,[o,0,o,a.colCount-1]))return!0;var l=c(t(a.selectedRange)),d=void 0;d=o<=l[2]&&o>l[0]&&Nr(a,l)?{startIndex:l[0],endIndex:l[2],hide:!1,autoFit:!0}:{startIndex:o,endIndex:o,hide:!1,autoFit:!0},this.parent.notify(Rt,d)}else ml(a,o)||(this.trgtEle=s.getElementsByClassName("e-header-cell")[0])}return!1},n.prototype.setAutoFitHandler=function(e){e.isCol&&Al(this.parent.getActiveSheet(),e.idx)?this.showHiddenColumns(e.idx):this.setAutofit(e.idx,e.isCol,null,null,e.sheetIdx)},n.prototype.getWrapText=function(e,t,r){var n,i=this,a=e.toString().split(" "),o=Ad(" ",r,this.parent.cellStyle),s=0,l=0,d=e,h="",p=function(){var e=parseInt(l.toString(),10);(e>s||e===s&&Ad(h.trim(),r,i.parent.cellStyle)>Ad(d,r,i.parent.cellStyle))&&(d=h.trim(),s=e)};return a.forEach((function(e,s){n=Ad(e,r,i.parent.cellStyle),(l+n)/t>1?(p(),h="",l=n):l+=n+=(l+n+o)/t>=1?0:o,h+=e+" ",s===a.length-1&&p()})),d},n.prototype.setAutofit=function(r,n,i,a,o){var s,l,d=this,h=(0,e.isNullOrUndefined)(o)?this.parent.getActiveSheet():Fn(this.parent,o),p=!!(0,e.isNullOrUndefined)(o)||o===this.parent.activeSheetIndex;if(a){var c={cancel:!1,index:r,isCol:n,sheetIndex:this.parent.activeSheetIndex};if(n?(c.oldWidth=i,c.autoFitWithHeader=!1):c.oldHeight=i,this.parent.notify(K,{eventArgs:c,action:"resizeToFit"}),c.cancel)return;s=c.autoFitWithHeader}var u,f,g,m={},v=this.parent.createElement("table",{className:this.parent.getContentTable().className+" e-resizetable",styles:"height: auto"}),y=this.parent.createElement("tbody"),C=this.parent.createElement("tr",{className:"e-row"}),b=this.parent.createElement("td",{className:"e-cell"}),x=0,S=0;if(n){var w;v.style.width="auto";var I=function(e){(u=b.cloneNode()).textContent=e,u.style.fontFamily=m.style&&m.style.fontFamily||d.parent.cellStyle.fontFamily,u.style.fontSize=m.style&&m.style.fontSize||d.parent.cellStyle.fontSize,u.style.fontWeight=m.style&&m.style.fontWeight||d.parent.cellStyle.fontWeight,(w=C.cloneNode()).appendChild(u),y.appendChild(w)};s&&I(a.textContent);for(var E=0,N=h.rows.length;E<N;E++)(m=zn(E,r,h))&&m.value&&(m.wrap?(g=!0,I(this.getWrapText(this.parent.getDisplayText(m),Td(h,r,r,m.colSpan>1?r+m.colSpan-1:r),m.style))):I(this.parent.getDisplayText(m)));l=Nl(h,r)}else{var R=h.rows[r]&&h.rows[r].cells?h.rows[r].cells.length:0;f=this.parent.createElement("colgroup");for(var A=0;A<R;A++)(m=zn(r,A,h))&&(u=b.cloneNode(),m.wrap&&u.classList.add("e-wraptext"),u.textContent=this.parent.getDisplayText(m),u.style.fontFamily=m.style&&m.style.fontFamily||this.parent.cellStyle.fontFamily,u.style.fontSize=m.style&&m.style.fontSize||this.parent.cellStyle.fontSize,C.appendChild(u),x+=S=m.colSpan&&m.colSpan>=1?this.getMergedColumnsWidth(m.colSpan,A,h):m.colSpan&&m.colSpan<1?0:Nl(h,A,!1,!0),f.appendChild(this.parent.createElement("col",{styles:"width:"+S+"px"})));v.appendChild(f),y.appendChild(C),l=yl(h,r)}v.appendChild(y),x&&(v.style.width=x+"px");var k=this.parent.createElement("div",{className:this.parent.element.className,styles:"display: block"});k.appendChild(v),document.body.appendChild(k);var O=v.getBoundingClientRect();document.body.removeChild(k);var F,T=Math.ceil(n?O.width:O.height),D=(n?this.getFloatingElementWidth(T+(g?1:0),r):T)||l;if(n){F=D>0?-(l-D):-l;var L=this.parent.frozenColCount(h);L&&r>=t(h.topLeftCell)[1]&&r<L||r>=this.parent.viewport.leftIndex+L&&r<=this.parent.viewport.rightIndex?(Il(h,r).width=D>0?D:0,p&&(this.resizeStart(r,this.parent.getViewportIndex(r,!0),D+"px",n,!0,i),this.parent.notify(Qi,{threshold:F,colIdx:r}))):(p&&this.parent.notify(Qi,{threshold:F,colIdx:r}),Il(h,r).width=D>0?D:0)}else{var P=this.parent.frozenRowCount(h);F=-(l-(D=D>20?D:20)),P&&r>=t(h.topLeftCell)[0]&&r<P||r>=this.parent.viewport.topIndex+P&&r<=this.parent.viewport.bottomIndex?(Cl(h,r,D),gl(h,r,{customHeight:!1}),p&&(this.resizeStart(r,this.parent.getViewportIndex(r),D+"px",n,!0,i),this.parent.notify(Ji,{threshold:F,rowIdx:r}))):(p&&this.parent.notify(Ji,{threshold:F,rowIdx:r}),Cl(h,r,D))}p&&this.parent.selectRange(h.selectedRange)},n.prototype.getMergedColumnsWidth=function(e,t,r){for(var n=0,i=0;i<e;i++)n+=Nl(r,t,!1,!0),t++;return n},n.prototype.createResizeHandler=function(e,t){var r=this.parent.createElement("div",{className:t});r.classList.add("e-resize-handle");var n=document.getElementById(this.parent.element.id+"_sheet");e.classList.contains("e-colresize")?(r.style.height=this.parent.getMainContent().parentElement.clientHeight+this.parent.getColumnHeaderContent().offsetHeight+"px",r.style.left=this.event.clientX-n.getBoundingClientRect().left+"px",r.style.top="0px"):e.classList.contains("e-rowresize")&&(r.style.width=this.parent.getMainContent().parentElement.clientWidth+"px",r.style.left="0px",r.style.top=this.event.clientY-n.getBoundingClientRect().top+"px"),n.appendChild(r),this.resizeTooltip(e,!1),this.updateCursor()},n.prototype.resizeTooltip=function(t,r,n){if(r){var i=this.parent.enableRtl,a=document.querySelector(".e-header-tooltip"),o=this.parent.element.getElementsByClassName("e-colresize-handler")[0],s=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];if(o){var l=i?Math.round(this.trgtEle.getBoundingClientRect().right)-n.clientX:n.clientX-Math.round(this.trgtEle.getBoundingClientRect().left);a&&(a.firstChild.textContent=l>0?"Width:("+l.toString()+" pixels)":"Width: 0.00")}else if(s){var d=n.clientY-Math.round(this.trgtEle.getBoundingClientRect().top);a&&(a.firstChild.textContent=d>0?"Height:("+d.toString()+" pixels)":"Height: 0.00")}}else{var h=t.classList.contains("e-colresize"),p=t.classList.contains("e-rowresize");if(h||p){var c=h?"e-colresize-handler":"e-rowresize-handler",u=new fh.Tooltip({cssClass:"e-header-tooltip",showTipPointer:!1});h?u.content=(0,e.initializeCSPTemplate)((function(){return"Width:("+Math.round(t.getBoundingClientRect().width).toString()+" pixels)"})):p&&(u.content=(0,e.initializeCSPTemplate)((function(){return"Height:("+Math.round(t.getBoundingClientRect().height).toString()+" pixels)"})),u.offsetX=-(this.parent.getMainContent().parentElement.clientWidth/2-Math.round(t.getBoundingClientRect().width))),u.appendTo("."+c),u.open(),u.refresh()}}},n.prototype.setColWidth=function(e,t,r,n){var i=this.parent.getActiveSheet(),a=gd(r)-n;if(a<0&&n<-a&&(a=-n),r>0){if(this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column"))return this.showHiddenColumns(e,r),void this.parent.notify(Pa,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIndex:this.parent.activeSheetIndex,oldWidth:n+"px",hide:!1},action:"resize"});this.resizeStart(e,t,r+"px",!0,!1,n+"px"),El(i,e,{width:r,customWidth:!0}),this.parent.notify(Qi,{threshold:a,colIdx:e,checkWrapCell:!0})}else this.isMouseMoved&&(this.parent.hideColumn(e),this.showHideCopyIndicator(),this.parent.notify(Pa,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIndex:this.parent.activeSheetIndex,oldWidth:n+"px",hide:!0},action:"resize"}))},n.prototype.showHideCopyIndicator=function(){var t=this.parent.element.getElementsByClassName("e-copy-indicator")[0],r=!1;t&&((0,e.detach)(t),this.parent.notify(is,null),r=!0),r&&this.parent.notify(ii,{})},n.prototype.showHiddenColumns=function(e,n){var i,a,o,s=this,l=this.parent.getActiveSheet(),d=t(l.selectedRange);if(e>=d[1]&&e<=d[3]&&d[2]===l.rowCount-1&&r(l.activeCell)[0]===r(l.topLeftCell)[0]?(i=d[1],a=d[3],o=this.parent.getMainContent().querySelector("colgroup")):i=a=e,void 0!==n)for(var h=i;h<=a;h++)El(l,h,{width:n,customWidth:!0}),h>=this.parent.viewport.leftIndex&&h<=this.parent.viewport.rightIndex&&!Al(l,h)&&(o.children[this.parent.getViewportIndex(h,!0)].style.width=n+"px");this.trgtEle&&this.trgtEle.classList.remove("e-unhide-column");var p={startIndex:i,endIndex:a,hide:!1,isCol:!0,autoFit:!0};if(this.parent.notify(Rt,p),this.showHideCopyIndicator(),void 0===n)if(p.autoFit)this.autoFit({isRow:!1,startIndex:i,endIndex:a});else{var c=function(){s.parent.off(ii,c),s.autoFit({isRow:!1,startIndex:i,endIndex:a})};this.parent.on(ii,c,this)}},n.prototype.setRowHeight=function(e,t,r,n){var i,a=this.parent.getActiveSheet(),o=this.parent.frozenColCount(a),s=parseInt(this.parent.getRow(e,null,o).style.height,10),l=r,d=gd(parseInt(l,10))-s;d<0&&s<-d&&(d=-s),a.rows[e]&&a.rows[e].customHeight&&(i=!0),this.resizeStart(e,t,l,!1,!1,n,i),gl(a,e,{height:parseInt(l,10)>0?parseInt(l,10):0,customHeight:!0}),this.parent.notify(Ji,{threshold:d,rowIdx:e,isCustomHgt:!0})},n.prototype.resizeOn=function(e){var r,n,i=this,a=this.parent.getActiveSheet(),o=t(a.activeCell),s=zn(o[0],o[1],a);if(this.trgtEle.classList.contains("e-rowresize")){var l=Number(this.trgtEle.parentElement.getAttribute("aria-rowindex"))-2;if(this.isMouseMoved&&ml(a,l)&&this.trgtEle.classList.contains("e-skip-resize")&&e.clientY>this.trgtEle.getBoundingClientRect().top){this.trgtEle.classList.remove("e-skip-resize");var d={startIndex:l,endIndex:l,hide:!1,skipAppend:!0};this.parent.notify(Rt,d);var h=this.parent.getRowHeaderTable().tBodies[0],p=this.parent.getContentTable().tBodies[0];d.hdrRow.style.display="none",d.row.style.display="none",h.insertBefore(d.hdrRow,h.children[d.insertIdx]),p.insertBefore(d.row,p.children[d.insertIdx]),this.trgtEle=d.hdrRow.firstElementChild,d.hdrRow.nextElementSibling.classList.remove("e-hide-end"),d.mergeCollection.forEach((function(e){i.parent.notify(St,e)}))}else if(this.trgtEle.classList.contains("e-skip-resize")){if(this.trgtEle.classList.remove("e-skip-resize"),!this.isMouseMoved&&ml(a,l)||!this.trgtEle.parentElement.previousElementSibling)return;this.trgtEle=this.trgtEle.parentElement.previousElementSibling.getElementsByClassName("e-header-cell")[0]}n=r=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,r=this.parent.getViewportIndex(n);var u=this.parent.frozenColCount(a),f=this.parent.getRow(n,null,u).style.height,g=e.clientY-this.event.clientY+parseInt(f,10);if(g<=0)return this.parent.hideRow(n),this.showHideCopyIndicator(),gl(a,n,{height:0,customHeight:!0}),void this.parent.notify(Pa,{eventArgs:{index:n,height:"0px",isCol:!1,sheetIndex:this.parent.activeSheetIndex,oldHeight:f},action:"resize"});if(this.setRowHeight(n,r,g+"px",f),this.parent.notify(sa,{rowIndex:n}),"none"===this.trgtEle.parentElement.style.display){var m=this.parent.getActiveSheet(),v=c(t(m.selectedRange));if(n<=v[2]&&n>v[0]){g=yl(m,n);for(var y=void 0,C=v[0];C<=v[2];C++)C!==n&&(f=yl(m,C)+"px",gl(m,C,{customHeight:!0,height:g}),ml(m,C)?y||(y=C):(this.parent.getRow(C).style.height=g+"px",m.showHeaders&&(this.parent.getRow(C,this.parent.getRowHeaderTable()).style.height=g+"px")),this.parent.notify(Pa,{eventArgs:{index:C,height:g+"px",isCol:!1,sheetIndex:this.parent.activeSheetIndex,oldHeight:f},action:"resize"}));this.parent.hideRow(v[0],n-1,!1),this.showHideCopyIndicator(),r+=Math.abs(n-y)}else 0===r||ml(m,n-1)?0!==r&&this.trgtEle.parentElement.classList.add("e-hide-end"):this.trgtEle.parentElement.previousElementSibling.classList.remove("e-hide-start"),this.parent.selectRange(m.selectedRange);this.trgtEle.parentElement.style.display="",this.parent.getContentTable().rows[r].style.display=""}}else if(this.trgtEle.classList.contains("e-colresize")){this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column")&&e.clientX<this.trgtEle.getBoundingClientRect().left&&(this.trgtEle.classList.remove("e-unhide-column"),this.trgtEle.previousElementSibling&&(this.trgtEle=this.trgtEle.previousElementSibling)),r=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1;var b=void 0;this.trgtEle.classList.contains("e-unhide-column")?(r-=1,b=0):b=Nl(this.parent.getActiveSheet(),r),this.setColWidth(r,this.parent.getViewportIndex(r,!0),(this.parent.enableRtl?this.event.clientX-e.clientX:e.clientX-this.event.clientX)+b,b)}s&&s.format&&s.format.includes("*")&&this.parent.notify(re,{value:s.value,format:s.format,cell:s,formattedText:s.value,rowIndex:o[0],colIndex:o[1]})},n.prototype.resizeStart=function(e,t,r,n,i,a,o){Cd(e,t,r,n,this.parent);var s,l,d=i?"resizeToFit":"resize";n?(s={index:e,width:r,isCol:n,sheetIndex:this.parent.activeSheetIndex,oldWidth:a},l=a!==r):(s={index:e,height:r,isCol:n,sheetIndex:this.parent.activeSheetIndex,oldHeight:a,isPrevCustomHeight:o},l=a!==r),l&&this.parent.notify(Pa,{eventArgs:s,action:d})},n.prototype.updateCursor=function(){this.parent.element.getElementsByClassName("e-colresize-handler")[0]?this.parent.element.classList.add("e-col-resizing"):this.parent.element.classList.contains("e-col-resizing")&&this.parent.element.classList.remove("e-col-resizing"),this.parent.element.getElementsByClassName("e-rowresize-handler")[0]?this.parent.element.classList.add("e-row-resizing"):this.parent.element.classList.contains("e-row-resizing")&&this.parent.element.classList.remove("e-row-resizing")},n.prototype.getFloatingElementWidth=function(e,t){var r=e,n={filterRange:[],hasFilter:!1};return this.parent.notify(Ba,n),n.hasFilter&&n.filterRange&&n.filterRange[1]<=t&&n.filterRange[3]>=t&&(r=e+22),r},n.prototype.destroy=function(){this.unwireEvents(),this.removeEventListener(),this.trgtEle&&this.trgtEle.remove(),this.trgtEle=null,this.event=null,this.parent=null},n.prototype.getModuleName=function(){return"resize"},n.prototype.propertyChange=function(e){"allowResizing"===e.propertyName&&this.wireEvents()},n}(),mh=function(){function n(e){this.parent=e,this.addEventListener()}return n.prototype.hideShow=function(t){var r,n=this,i=(0,e.isUndefined)(t.sheetIndex)?this.parent.activeSheetIndex:t.sheetIndex,a=Fn(this.parent,i);if(t.startIndex>t.endIndex){var o=t.startIndex;t.startIndex=t.endIndex,t.endIndex=o}if(void 0!==t.actionUpdate){var s=t.isCol?[0,t.startIndex,a.rowCount-1,t.endIndex]:[t.startIndex,0,t.endIndex,a.colCount-1];if(Qr(this.parent,s))return void(t.actionUpdate&&this.parent.notify(to,null))}if(t.actionUpdate){if(t.sheetIndex=i,r={eventArgs:t,action:"hideShow"},this.parent.notify(K,r),t.cancel)return;delete t.cancel}t.hide&&(t.hiddenIndexes=[]);var l=function(e){t.isCol?(n.hideCol(t),e&&n.parent.sheetModule.colWidthChanged({colIdx:t.startIndex,isHideShow:!0})):(n.hideRow(t),e&&n.parent.sheetModule.rowHeightChanged({rowIdx:t.startIndex,isHideShow:!0}))},d=t.isCol?this.parent.frozenColCount(a):this.parent.frozenRowCount(a);if(d&&t.startIndex<d){var h=void 0;if(t.freezePane=!0,t.endIndex>=d&&(h=t.endIndex,t.endIndex=d-1),l(!0),delete t.freezePane,void 0!==h){var p=t.startIndex;t.endIndex=h,t.startIndex=d,l(!this.parent.scrollSettings.enableVirtualization),t.startIndex=p}}else l(!this.parent.scrollSettings.enableVirtualization);t.actionUpdate&&(this.updateIndexOnlyForHiddenColumnsAndRows(t,a),this.parent.notify(Pa,r),Md(this.parent.element))},n.prototype.updateIndexOnlyForHiddenColumnsAndRows=function(e,t){for(var r=e.startIndex,n=e.endIndex,i=e.startIndex;i<=n;i++)if(!1===(e.isCol?Il(t,i):fl(t,i)||{}).hidden){e.startIndex=i;break}for(var a=e.endIndex;a>=r;a--)if(!1===(e.isCol?Il(t,a):fl(t,a)||{}).hidden){e.endIndex=a;break}},n.prototype.hideRow=function(n){var a,o,s,l,d,h,p=this,c=(0,e.isUndefined)(n.sheetIndex)?this.parent.activeSheetIndex:n.sheetIndex,u=Fn(this.parent,c),f=0,g=Object.assign({},n),m=this.parent.scrollSettings.isFinite&&!g.freezePane;if(m){if(g.startIndex>=u.rowCount)return;g.endIndex>=u.rowCount&&(g.endIndex=u.rowCount-1),h=0}var v=this.parent.frozenRowCount(u);if(g.hide){for(var y,C=void 0,b=void 0,x=[],S=[],w=m&&g.endIndex===Pr(u,u.rowCount-1,!1),I=g.startIndex;I<=g.endIndex;I++)if(ml(u,I))g.isFiltering&&!vl(u,I)&&gl(u,I,{isFiltered:!0});else if(void 0===o&&(g.freezePane?(y=this.parent.sheetModule.getSelectAllTable(),C=this.parent.getColHeaderTable()):(y=this.parent.getRowHeaderTable(),C=this.parent.getContentTable()),o=this.parent.getViewportIndex(I),f=0),d={hidden:!0},g.isFiltering&&(d.isFiltered=!0),g.isFiltering||(x=qd(this.parent)),gl(u,I,d),g.isFiltering||(S=qd(this.parent)),c===this.parent.activeSheetIndex)if(m&&(h+=yl(u,I,!0,!0)),this.refreshChart(I,"rows"),g.isFiltering||this.refreshChartCellModel(x,S),b=C&&C.rows[o]){if(!l)for(var E=0;E<=u.usedRange.colIndex;E++)if(((a=zn(I,E,u)||{}).colSpan||a.rowSpan)&&(g.startIndex>=this.parent.viewport.topIndex||this.parent.scrollSettings.enableVirtualization)){l=!0;break}if(l)continue;if(y.rows[o]&&(0,e.detach)(y.rows[o]),(0,e.detach)(b),f++,(b=C.rows[o])&&I===g.endIndex){var N=void 0,R=(s=Pr(u,I+1,!0))!==Pr(u,0,!0)&&s===(this.parent.viewport.topIndex>=g.startIndex?g.endIndex+1:this.parent.viewport.topIndex)?"Row":"";for(E=this.parent.viewport.leftIndex;E<=this.parent.viewport.rightIndex;E++){""!==(te=this.parent.getCellStyleValue(["borderTop"],[s,E]).borderTop)&&(N=b.cells[E],this.parent.notify(le,{onActionUpdate:!1,rowIdx:s,colIdx:E,style:{borderTop:te},row:b,pRow:b.previousElementSibling,first:R,td:N}))}}}else I<=this.parent.viewport.bottomIndex?f++:f--;if(g.refreshUI)return;if(l&&(g.startIndex>=this.parent.viewport.topIndex||!this.parent.scrollSettings.enableVirtualization))return void(g.isFiltering?n.refreshUI=!0:(this.parent.selectRange(u.selectedRange),u.frozenRows||u.frozenColumns?(this.parent.renderModule.refreshSheet(!1,!1,!0),n.refreshUI=!0):this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"})));if(!f)return;this.parent.selectRange(u.selectedRange);var A=function(){if(u.showHeaders){var e=g.freezePane?1:0;o===e?y.rows[e]&&y.rows[e].classList.add("e-hide-end"):(y&&y.rows[o-1]&&y.rows[o-1].classList.add("e-hide-start"),y&&y.rows[o]&&y.rows[o].classList.add("e-hide-end"))}};if(!g.freezePane&&this.parent.scrollSettings.enableVirtualization){var k=g.startIndex,O=g.startIndex;if(g.startIndex<r(u.paneTopLeftCell)[0]||f>this.parent.viewport.rowCount){if(g.isFiltering)return void(n.refreshUI=!0);this.parent.updateTopLeftCell(Pr(u,g.startIndex-1<v?v:g.startIndex-1,!0)-v,null,"col"),this.parent.renderModule.refreshSheet(!1,!1,!0)}else{O=(k=this.parent.viewport.bottomIndex+1)+f-1;var F=this.parent.skipHidden(k,O,"rows",!1);if(k=F[0],O=F[1],m){if(k>=u.rowCount)return void(this.parent.viewport.topIndex+v===Pr(u,v,!0)?(A(),this.parent.notify(os,{isHide:!0,height:h}),w&&(this.parent.viewport.bottomIndex=Pr(u,u.rowCount-1,!1))):this.parent.renderModule.refreshSheet(!1,!1,!0));if(O>=u.rowCount)return void this.parent.renderModule.refreshSheet(!1,!1,!0);this.parent.notify(os,{isHide:!0,height:h})}this.parent.viewport.bottomIndex=O;var T=void 0,D=this.parent.frozenColCount(u),L=[];D?(L.push(v),L.push(this.parent.viewport.leftIndex+D),T=r(u.topLeftCell)[1]):T=this.parent.viewport.leftIndex,this.parent.renderModule.refreshUI({colIndex:T,rowIndex:k,direction:"",refresh:"RowPart",frozenIndexes:L},i(k,T)+":"+i(O,this.parent.viewport.rightIndex))}}A()}else{var P=void 0,M=void 0,B=void 0,H=(b=void 0,void 0),U=void 0,V=(C=void 0,void 0),z=void 0,j=g.startIndex-1,_=[],q=g.freezePane,W="lastElementChild",G=0,Y=this.parent.viewport.topIndex+v;if(m){var X=Pr(u,u.rowCount-1,!1);if(this.parent.viewport.bottomIndex===X)if(Y===Pr(u,v,!0))q=!0;else{var K=t(u.paneTopLeftCell)[0];u.rowCount-1-K+1-this.parent.hiddenCount(K,u.rowCount-1)<this.parent.viewport.rowCount+Math.round(this.parent.getThreshold("row")/2)&&(W="firstElementChild")}}x=qd(this.parent),I=g.startIndex;for(var $=g.endIndex;I<=$;I++)if(g.isFiltering?ml(u,I):ml(u,I)&&!vl(u,I))if(void 0===H){if(d={hidden:!1},g.isFiltering&&(d.isFiltered=!1),!q&&I>this.parent.viewport.bottomIndex){if(gl(u,I,d),void 0===z)return}else if(void 0===z&&(z=I),gl(u,I,d),c===this.parent.activeSheetIndex){m&&(h+=yl(u,I,!0,!0)),this.refreshChart(I,"rows"),void 0===o&&(P=document.createDocumentFragment(),M=document.createDocumentFragment(),U=this.parent.serviceLocator.getService("row"),g.freezePane?(V=this.parent.sheetModule.getSelectAllTable(),C=this.parent.getColHeaderTable()):(V=this.parent.getRowHeaderTable(),C=this.parent.getContentTable(),I<this.parent.viewport.topIndex+v&&(this.parent.viewport.topIndex=I-v)),o=this.parent.getViewportIndex(I)),j++,B=U.refresh(I,null,null,!0,!0),P.appendChild(B),V&&V.rows.length&&!q&&(0,e.detach)(V.tBodies[0][""+W]),b=M.appendChild(U.refresh(I,b,B)),C&&C.rows.length&&!q&&((0,e.detach)(C.tBodies[0][""+W]),"firstElementChild"===W&&(void 0!==o&&o-1>-1&&(o-=1),G+=yl(u,this.parent.viewport.topIndex,!0),this.parent.viewport.topIndex=Pr(u,this.parent.viewport.topIndex+1,!0)));for(E=this.parent.viewport.leftIndex;E<=this.parent.viewport.rightIndex;E++)if(void 0!==(a=zn(I,E,u)||{}).rowSpan||void 0!==a.colSpan){var Z={range:[I,E,I,E],isAction:!1,merge:!0,type:"All",skipChecking:!0};this.parent.notify(Et,Z),_.length&&Z.range[1]===_[_.length-1].range[1]&&Z.range[0]===_[_.length-1].range[0]||_.push(Z)}}}else $=I;else{if(g.startIndex===g.endIndex)return;void 0===o?j++:H=I}S=qd(this.parent);if(this.refreshChartCellModel(x,S),void 0===o)return;var J=void 0;if(!g.freezePane){if(g.isFiltering&&g.startIndex<r(u.paneTopLeftCell)[0]&&(n.refreshUI=!0,void 0===H||H===g.endIndex))return;var Q=this.parent.viewport.bottomIndex;this.parent.viewport.bottomIndex=this.parent.viewport.topIndex+v+this.parent.viewport.rowCount+2*this.parent.getThreshold("row");var ee=this.parent.hiddenCount(g.endIndex+1,this.parent.viewport.bottomIndex);f=this.parent.hiddenCount(this.parent.viewport.topIndex+v,g.startIndex)+ee,this.parent.viewport.bottomIndex+=f,m&&this.parent.viewport.bottomIndex>=u.rowCount&&(this.parent.viewport.bottomIndex=Pr(u,u.rowCount-1,!1)),!g.isFiltering&&z>=Y&&z<=Q&&z>this.parent.viewport.bottomIndex-ee-Math.abs(j-z)&&(J=!0)}if(g.insertIdx=n.insertIdx=o,g.row=n.row=M.querySelector(".e-row"),g.mergeCollection=n.mergeCollection=_,u.showHeaders&&(n.hdrRow=g.hdrRow=P.querySelector(".e-row"),0!==o&&!ml(u,j-1)&&V.rows[o-1]&&V.rows[o-1].classList.remove("e-hide-start"),0!==g.startIndex&&ml(u,g.startIndex-1)&&g.hdrRow.classList.add("e-hide-end"),ml(u,j+1)?P.lastElementChild.classList.add("e-hide-start"):V.rows[o]&&V.rows[o].classList.remove("e-hide-end")),b&&C&&C.rows[o]){s=Pr(u,j+1,!0);for(I=this.parent.viewport.leftIndex;I<=this.parent.viewport.rightIndex;I++){var te;if(""!==(te=this.parent.getCellStyleValue(["borderTop"],[s,I]).borderTop)){this.parent.notify(le,{onActionUpdate:!1,rowIdx:s,colIdx:I,style:{borderTop:te},pRow:b,td:C.rows[o].cells[I],first:""});var re=Pr(u,z-1,!1);re>-1?!C.rows[o-1]||this.parent.getCellStyleValue(["borderBottom"],[re,I]).borderBottom||this.parent.getCellStyleValue(["borderTop"],[z,I]).borderTop||(C.rows[o-1].cells[I].style.borderBottom=""):C.rows[o].cells[I].style.borderTop=""}}}if(g.skipAppend)return;m&&this.parent.notify(os,{height:h,size:G}),J||Math.abs(j-z)>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")?this.parent.renderModule.refreshSheet(!1,!1,!0):(V&&(V.tBodies[0].rows.length?V.tBodies[0].insertBefore(P,V.rows[o]):V.tBodies[0].appendChild(P)),C&&C.tBodies[0]&&(C.tBodies[0].rows.length?C.tBodies[0].insertBefore(M,C.rows[o]):C.tBodies[0].appendChild(M)),this.parent.selectRange(u.selectedRange),g.autoFit&&u.showHeaders&&this.parent.notify(oa,{startIndex:g.startIndex,endIndex:g.endIndex,isRow:!0}),_.forEach((function(e){p.parent.notify(St,e)})),void 0!==H&&H!==g.endIndex&&(g.startIndex=H,this.hideRow(g)))}},n.prototype.hideCol=function(t){for(var n,i=this,o=(0,e.isUndefined)(t.sheetIndex)?this.parent.activeSheetIndex:t.sheetIndex,s=Fn(this.parent,o),l=[],d=[],h=r(s.paneTopLeftCell),p=this.parent.frozenColCount(s),c=this.parent.frozenRowCount(s),u=this.parent.viewport.leftIndex+p,f=Pr(s,s.colCount-1,!1,"columns"),g=t.startIndex;g<=t.endIndex;g++){if(t.hide){if(Al(s,g))continue}else if(!Al(s,g)||t.hiddenIndexes&&-1===t.hiddenIndexes.indexOf(g))continue;var m=qd(this.parent);El(s,g,{hidden:t.hide});var v=qd(this.parent);this.refreshChart(g,"columns"),this.refreshChartCellModel(m,v),this.parent.scrollSettings.enableVirtualization&&!t.freezePane&&(g<u||g>this.parent.viewport.rightIndex&&(!this.parent.scrollSettings.isFinite||!(f===this.parent.viewport.rightIndex&&g>=f&&g<s.colCount)))?g<u&&d.push(g):(l.push(g),t.hide&&(t.hiddenIndexes.push(g),g<=h[1]&&(n=!0)))}if((d.length||l.length)&&o===this.parent.activeSheetIndex){var y,C,b=r(s.topLeftCell),x=function(){var e;return e=i.parent.scrollSettings.enableVirtualization?[c?b[0]:i.parent.viewport.topIndex,i.parent.viewport.bottomIndex]:[0,s.rowCount-1],t.freezePane?(y=i.parent.getRowHeaderTable(),C=i.parent.sheetModule.getSelectAllTable()):(y=i.parent.getContentTable(),C=i.parent.getColHeaderTable()),e};if(t.hide){if(!l.length)return;if((l.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization||t.freezePane)&&this.removeCell(s,l,x(),y,C),!t.freezePane&&this.parent.scrollSettings.enableVirtualization){if(n)return this.parent.updateTopLeftCell(null,Pr(s,l[0]-1<p?p:l[0]-1,!0,"columns")-p,"row"),void this.parent.renderModule.refreshSheet(!1,!1,!0);var S=[],w=this.parent.viewport.topIndex,I=c?b[0]:w;if(c&&(S=[c+w,p]),this.parent.scrollSettings.isFinite){var E=Pr(s,s.colCount-1,!1,"columns"),N=this.parent.viewport.leftIndex+p,R=this.parent.viewport.rightIndex;if(R+l.length>=E){var A=Pr(s,N-(R+l.length-E),!1,"columns");return A>=p&&(this.parent.viewport.leftIndex=A,this.parent.viewport.leftIndex-=this.parent.hiddenCount(R,E)),this.parent.viewport.rightIndex=E,N!==this.parent.viewport.leftIndex+p||R!==this.parent.viewport.rightIndex?(this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:S,rowIndex:I,skipUpdateOnFirst:this.parent.viewport.leftIndex+p===Pr(s,p,!0,"columns")}),c&&(this.parent.viewport.topIndex=w)):this.parent.notify(Lo,{refresh:"Column",isUpdate:!0}),void this.parent.selectRange(s.selectedRange)}}if(l.length<=this.parent.getThreshold("col")){var k=this.parent.skipHidden(this.parent.viewport.rightIndex+1,this.parent.viewport.rightIndex+l.length,"columns");this.parent.viewport.rightIndex=k[1],this.parent.renderModule.refreshUI({rowIndex:I,colIndex:k[0],direction:"",refresh:"ColumnPart",frozenIndexes:S},""+a([I,k[0],this.parent.viewport.bottomIndex,k[1]]))}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex+p===Pr(s,p,!0,"columns"),rowIndex:I,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:S}),c&&(this.parent.viewport.topIndex=w)}this.parent.selectRange(s.selectedRange)}else{if(d.length&&this.parent.scrollSettings.enableVirtualization){d.sort((function(e,t){return e-t}));var O=d[0]-1<p?p:d[0]-1;return this.parent.updateTopLeftCell(null,Pr(s,O,!0,"columns")-p,"row"),this.parent.renderModule.refreshSheet(!1,!1,!0),void(t.autoFit&&(t.autoFit=!1))}(!this.parent.scrollSettings.isFinite||this.parent.viewport.rightIndex<f)&&(l.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization||t.freezePane)?(this.appendCell(s,l,x(),y,C,t.freezePane),this.parent.scrollSettings.enableVirtualization&&!t.freezePane&&this.parent.notify(bi,{refresh:"Column",prevRowColCnt:{rowCount:s.rowCount,colCount:s.colCount}}),this.parent.selectRange(s.selectedRange)):this.parent.renderModule.refreshSheet(!1,!1,!0)}}},n.prototype.removeCell=function(t,r,n,i,a){var o,s,l,d,h,p=this,c=n[0],u=n[1],f=0,g=r.length-1,m=this.parent.frozenRowCount(t),v=i.getElementsByTagName("colgroup")[0],y=this.parent.getViewportIndex(r[0],!0)+1,C=Pr(t,m-1,!1);for(t.showHeaders&&(l=a.getElementsByTagName("colgroup")[0],o=a.rows[0]);c<=u;)ml(t,c)?c++:(s=m&&c<m?a.rows[f+1]:i.rows[f],r.forEach((function(n,i){if(0===f&&c>=m&&(t.showHeaders&&((0,e.detach)(l.children[y]),(0,e.detach)(o.cells[y])),(0,e.detach)(v.children[y])),(0,e.detach)(s.cells[y]),0===i&&(void 0!==(d=zn(c,n,t,!1,!0)).colSpan&&(void 0===d.rowSpan||d.colSpan>1)||d.rowSpan<0&&c-1>-1&&ml(t,c-1)&&Math.abs(d.rowSpan)===p.parent.hiddenCount(c+d.rowSpan,c,"rows",t))&&p.parent.notify(oo,{rowIdx:c,colIdx:n,model:"col",start:r[0],end:r[g]}),i===g){h=Pr(t,n+1,!0,"columns");var a=p.parent.getCellStyleValue(["borderLeft"],[f,h]).borderLeft;""!==a&&p.parent.notify(le,{onActionUpdate:!1,rowIdx:f,colIdx:h,style:{borderLeft:a},row:s,first:""}),(void 0!==(d=zn(c,n,t)||{}).colSpan&&(void 0===d.rowSpan||d.colSpan>1)||d.rowSpan<0&&c-1>-1&&ml(t,c-1)&&Math.abs(d.rowSpan)===p.parent.hiddenCount(c+d.rowSpan,c,"rows",t))&&p.parent.notify(oo,{rowIdx:c,colIdx:n,model:"col",start:r[0],end:r[g],isEnd:!0})}})),m&&c===C?(f=0,c=this.parent.viewport.topIndex+m):(f++,c++));y-1>-1&&t.showHeaders&&o.cells[y-1]&&o.cells[y-1].classList.add("e-hide-start"),t.showHeaders&&o.cells[y]&&o.cells[y].classList.add("e-hide-end")},n.prototype.appendCell=function(t,r,n,a,o,s){var l,d,h,p,c=this,u=n[0],f=n[1],g=0,m=r.length-1,v=this.parent.frozenRowCount(t),y=a.getElementsByTagName("colgroup")[0];t.showHeaders&&(h=o.getElementsByTagName("colgroup")[0],l=o.rows[0]);var C=this.parent.serviceLocator.getService("cell");r.sort((function(e,t){return e-t}));for(var b,x,S,w,I=[],E=[],N=Pr(t,v-1,!1);u<=f;)ml(t,u)?u++:(d=v&&u<v?o.rows[g+1]:a.rows[g],r.forEach((function(n,a){(0===g&&(E[a]=c.parent.getViewportIndex(n,!0),t.showHeaders&&(x=l.cells[E[a]])&&(0===a&&r[a]&&!Al(t,r[a]-1)&&x.previousSibling&&x.previousElementSibling.classList.remove("e-hide-start"),a===m&&x.classList.remove("e-hide-end")),u>=v&&(y.children[E[a]]?(y.insertBefore(c.parent.sheetModule.updateCol(t,n),y.children[E[a]]),t.showHeaders&&C.renderColHeader(n,l,x)):(y.appendChild(c.parent.sheetModule.updateCol(t,n)),t.showHeaders&&C.renderColHeader(n,l)),s||((0,e.detach)(y.lastChild),t.showHeaders&&(0,e.detach)(l.lastChild)),t.showHeaders&&a===m&&((0,e.detach)(h),o.insertBefore(y.cloneNode(!0),o.tHead)))),s||(0,e.detach)(d.lastChild),x=d.cells[E[a]],w={rowIdx:u,colIdx:n,cell:zn(u,n,t),row:d,address:i(u,n),lastCell:n===m,isHeightCheckNeeded:!0,first:n!==Pr(t,0,!0,"columns")&&n===c.parent.viewport.leftIndex?"Column":"",checkNextBorder:a===m?"Column":"",checkCF:!0},x&&(w.refChild=x),b=C.render(w),0===a&&b.previousSibling)&&(""!==c.parent.getCellStyleValue(["borderLeft"],[g,Pr(t,r[r.length-1]+1,!0,"columns")]).borderLeft&&(p=Pr(t,r[0]-1,!1,"columns"))>-1&&!c.parent.getCellStyleValue(["borderRight"],[g,p]).borderRight&&!c.parent.getCellStyleValue(["borderLeft"],[g,r[0]]).borderLeft&&(b.previousSibling.style.borderRight=""));if(void 0!==(S=zn(u,n,t)||{}).colSpan&&(void 0===S.rowSpan||S.colSpan>1)||S.rowSpan<0&&u-1>-1&&ml(t,u-1)&&Math.abs(S.rowSpan)===c.parent.hiddenCount(u+S.rowSpan,u,"rows",t)){var f={range:[u,n,u,n],isAction:!1,merge:!0,type:"All",skipChecking:!0};c.parent.notify(Et,f),I.length&&f.range[1]===I[I.length-1].range[1]&&f.range[0]===I[I.length-1].range[0]||I.push(f)}})),v&&u===N?(u=this.parent.viewport.topIndex+v,g=0):(u++,g++));I.forEach((function(e){c.parent.notify(St,e)})),this.parent.viewport.rightIndex=Pr(t,this.parent.viewport.rightIndex-r.length,!1,"columns")},n.prototype.refreshChart=function(e,t){this.parent.notify(Bt,{rIdx:e,showHide:t})},n.prototype.refreshChartCellModel=function(e,t){this.parent.notify(To,{prevChartIndexes:e,currentChartIndexes:t})},n.prototype.addEventListener=function(){this.parent.on(Rt,this.hideShow,this),this.parent.on(oi,this.destroy,this)},n.prototype.destroy=function(){this.removeEventListener(),this.parent=null},n.prototype.removeEventListener=function(){this.parent.off(Rt,this.hideShow),this.parent.off(oi,this.destroy)},n}(),vh=u(215),yh=function(){function n(e){this.divElements=[],this.inputElements=[],this.parent=e,this.addEventListener()}return n.prototype.destroy=function(){this.removeEventListener(),this.parent=null},n.prototype.addEventListener=function(){this.parent.on(da,this.initiateHyperlinkHandler,this),this.parent.on(ha,this.editHyperlinkHandler,this),this.parent.on(pa,this.openHyperlinkHandler,this),this.parent.on(hi,this.hyperlinkClickHandler,this),this.parent.on(ba,this.createHyperlinkEle,this),this.parent.on(pi,this.keyUpHandler,this),this.parent.on(Gt,this.removeHyperlink,this),this.parent.on(Ca,this.removeHyperlinkHandler,this)},n.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(da,this.initiateHyperlinkHandler),this.parent.off(ha,this.editHyperlinkHandler),this.parent.off(pa,this.openHyperlinkHandler),this.parent.off(hi,this.hyperlinkClickHandler),this.parent.off(ba,this.createHyperlinkEle),this.parent.off(pi,this.keyUpHandler),this.parent.off(Gt,this.removeHyperlink),this.parent.off(Ca,this.removeHyperlinkHandler))},n.prototype.getModuleName=function(){return"spreadsheetHyperlink"},n.prototype.keyUpHandler=function(t){var r=t.target;if((0,e.closest)(r,".e-document")){var n=document.querySelector(".e-hyp-text"),i=this.parent.element.querySelector(".e-hyperlink-alert-span"),a=((0,e.closest)(r,".e-hyperlink-dlg")||(0,e.closest)(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;n&&!(0,e.isNullOrUndefined)(n.value)&&(Ir(n.value.toUpperCase())?i&&(i.remove(),a.removeAttribute("disabled")):(this.showDialog(),a.setAttribute("disabled","true")))}if(r.classList.contains("e-text")&&(0,e.closest)(r,".e-cont")&&(0,e.closest)(r,".e-webpage")&&(0,e.closest)(r,".e-webpage").getElementsByClassName("e-cont")[1]===r.parentElement){a=((0,e.closest)(r,".e-hyperlink-dlg")||(0,e.closest)(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;if(""!==r.value)a.removeAttribute("disabled");else!!(0,e.closest)(r,".e-link-dialog").querySelector(".e-webpage").querySelectorAll(".e-cont")[1].querySelector(".e-text").value||a.setAttribute("disabled","true")}},n.prototype.initiateHyperlinkHandler=function(){var e=this,t=this.parent.getActiveSheet();if(!t.isProtected||t.protectSettings.insertLink&&!Bd(this.parent))if(Qr(this.parent))this.parent.notify(to,null);else{var r=this.parent.serviceLocator.getService(Dl);if(!this.parent.element.querySelector(".e-hyperlink-dlg")){var n,i=this.parent.serviceLocator.getService(Ll);i.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-hyperlink-dlg",header:r.getConstant("InsertLink"),beforeOpen:function(t){var r={dialogName:"InsertLinkDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel?t.cancel=!0:(i.dialogInstance.content=e.hyperlinkContent(),n=i.dialogInstance.content.querySelector(".e-text").value,i.dialogInstance.dataBind(),Md(e.parent.element))},open:function(){setTimeout((function(){Md(i.dialogInstance.element.querySelectorAll(".e-webpage input")[1])}))},beforeClose:this.dialogBeforeClose.bind(this),buttons:[{buttonModel:{content:r.getConstant("Insert"),isPrimary:!0,disabled:!0},click:function(){e.dlgClickHandler(n),i.hide()}}]})}}else this.parent.notify(eo,null)},n.prototype.dialogBeforeClose=function(){var e=this.headerTabs;e&&e.element&&(e.destroy(),e.element.remove()),this.headerTabs=null,Kd(this.inputElements),this.inputElements=[],Kd(this.divElements),this.divElements=[]},n.prototype.dlgClickHandler=function(e){var t,r,n=this.parent.getActiveSheet(),i=n.name+"!"+n.selectedRange,a=this.parent.element.querySelector(".e-link-dialog").getElementsByClassName("e-content")[0].querySelector(".e-item.e-active");if(a)if((t=a.getElementsByClassName("e-cont")[0].querySelector(".e-text").value)===e&&(t=null),a.querySelector(".e-webpage")){var o={address:r=a.getElementsByClassName("e-cont")[1].querySelector(".e-text").value};this.parent.insertHyperlink(o,i,t,!1)}else{r=a.getElementsByClassName("e-cont")[1].querySelector(".e-text").value;var s=a.getElementsByClassName("e-cont")[2];if(s.getElementsByClassName("e-list-item")[0].querySelector(".e-active")){o={address:r=a.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent+"!"+r.toUpperCase()};this.parent.insertHyperlink(o,i,t,!1)}else if(s.querySelector(".e-active"))for(var l=a.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent,d=0;d<this.parent.definedNames.length;d++)if(this.parent.definedNames[d].name===l){o={address:this.parent.definedNames[d].name};this.parent.insertHyperlink(o,i,t,!1)}}},n.prototype.showDialog=function(){this.parent.element.querySelector(".e-hyperlink-alert-span")&&this.parent.element.querySelector(".e-hyperlink-alert-span").remove();var e=this.parent.serviceLocator.getService(Dl),t=this.parent.createElement("span",{className:"e-hyperlink-alert-span"});t.innerText=e.getConstant("HyperlinkAlert"),(this.parent.element.querySelector(".e-hyperlink-dlg")||this.parent.element.querySelector(".e-edithyperlink-dlg")).querySelector(".e-dlg-content").appendChild(t)},n.prototype.editHyperlinkHandler=function(){var e,t=this,r=this.parent.serviceLocator.getService(Dl),n=this.parent.serviceLocator.getService(Ll);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-edithyperlink-dlg",header:r.getConstant("EditLink"),beforeOpen:function(r){var i={dialogName:"EditLinkDialog",element:r.element,target:r.target,cancel:r.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel?r.cancel=!0:(n.dialogInstance.content=t.hyperEditContent(),e=n.dialogInstance.content.querySelector(".e-text").value,n.dialogInstance.dataBind(),Md(t.parent.element))},open:function(){setTimeout((function(){n.dialogInstance.element.querySelector(".e-webpage")?Md(n.dialogInstance.element.querySelectorAll(".e-webpage input")[1]):Md(n.dialogInstance.element.querySelectorAll(".e-document input")[1])}))},buttons:[{buttonModel:{content:r.getConstant("Update"),isPrimary:!0},click:function(){t.dlgClickHandler(e),n.hide()}}]})},n.prototype.openHyperlinkHandler=function(){var e=r(this.parent.getActiveSheet().activeCell),t=this.parent.getCell(e[0],e[1]);t.getElementsByClassName("e-hyperlink")[0]&&(t=t.querySelector(".e-hyperlink")),this.hlOpenHandler(t)},n.prototype.hlOpenHandler=function(r,n,i){var o=this;if(r.classList.contains("e-hyperlink")){var s=(0,e.closest)(r,".e-cell");if(!s)return;var l=["",""],d=void 0,h=!0,p=this.parent.getActiveSheet(),c=parseInt(s.getAttribute("aria-colindex"),10)-1,u=parseInt(s.parentElement.getAttribute("aria-rowindex"),10)-1,f=zn(u,c,p,!1,!0);f.style&&"#00e"===f.style.color&&(Vr(this.parent,p,{rowIdx:u,colIdx:c,preventEvt:!0,cell:{style:{color:"#551a8b"}}}),s.style.color="#551a8b");var g=f.hyperlink,m=void 0,v={hyperlink:g,address:p.activeCell,target:"_blank",cancel:!1};if(this.parent.trigger(Be,v),v.cancel)return void(i&&i.preventDefault());var y={hyperlink:g=v.hyperlink,address:p.activeCell};"string"==typeof g&&(m=g),"object"==typeof g&&(m=g.address);var C=m;if(-1===m.indexOf("http://")&&-1===m.indexOf("https://")&&-1===m.indexOf("ftp://")){if(!(0,e.isNullOrUndefined)(m)){if(this.parent.definedNames)for(var b=0;b<this.parent.definedNames.length;b++)if(this.parent.definedNames[b].name===m){m=(m=this.parent.definedNames[b].refersTo).slice(1);break}var x;-1!==m.lastIndexOf("!")?(l[0]=m.substring(0,m.lastIndexOf("!")),l[0].startsWith("'")&&l[0].endsWith("'")&&(l[0]=l[0].slice(1,l[0].length-1)),l[1]=m.substring(m.lastIndexOf("!")+1)):(l[0]=this.parent.getActiveSheet().name,l[1]=m);for(b=0;b<this.parent.sheets.length;b++)this.parent.sheets[b].name===l[0]&&(x=b);if(p=this.parent.sheets[x],-1!==l[1].indexOf(":")){var S=l[1].indexOf(":"),w=l[1].substr(0,S),I=l[1].substr(S+1,l[1].length);w=w.replace("$",""),(I=I.replace("$","")).match(/\D/g)&&!I.match(/[0-9]/g)&&w.match(/\D/g)&&!w.match(/[0-9]/g)?(w+="1",I+=p.rowCount,l[1]=w+":"+I):!I.match(/\D/g)&&I.match(/[0-9]/g)&&!w.match(/\D/g)&&w.match(/[0-9]/g)&&(d=[parseInt(w,10)-1,0,parseInt(I,10)-1,p.colCount-1],h=!1)}var E=void 0,N=this.parent.definedNames;if(!(0,e.isNullOrUndefined)(N))for(b=0;b<N.length;b++)if(N[b].name===C){E=!0;break}if(Ir(l[1])||E){if(d=h?t(l[1]):d,!(0,e.isNullOrUndefined)(p)){var R=a(d);if(p===this.parent.getActiveSheet())zl((function(){o.parent.goTo(R)}));else{if(R.indexOf(":")>=0){var A=R.split(":");R=A[0]===A[1]?A[0]:R}zl((function(){o.parent.goTo(o.parent.sheets[x].name+"!"+R)}))}}}else this.showInvalidHyperlinkDialog()}}else n||(this.isValidUrl(m)?window.open(m,v.target):this.showInvalidHyperlinkDialog());this.parent.trigger(He,y)}},n.prototype.isValidUrl=function(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)},n.prototype.showInvalidHyperlinkDialog=function(){var e=this.parent.serviceLocator.getService(Ll),t=this.parent.serviceLocator.getService(Dl);e.show({width:323,isModal:!0,showCloseIcon:!0,header:t.getConstant("Hyperlink"),content:t.getConstant("InvalidHyperlinkAlert"),buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){e.hide()}}]},!1)},n.prototype.hyperlinkClickHandler=function(t){var r=t.target;if((0,e.closest)(r,".e-link-dialog")&&(0,e.closest)(r,".e-toolbar-item")){var n=(p=(0,e.closest)(r,".e-hyperlink-dlg")||(0,e.closest)(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild,i=p.querySelector(".e-document"),a=p.querySelector(".e-webpage"),o=a?a.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value,s=i?i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:o;if((0,e.closest)(r,".e-toolbar-items").getElementsByClassName("e-toolbar-item")[1].classList.contains("e-active")){var l=i.querySelectorAll(".e-cont")[2].querySelector(".e-active");i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=o,(0,e.closest)(l,".e-list-item").classList.contains("e-level-2")&&n.hasAttribute("disabled")?n.removeAttribute("disabled"):(0,e.closest)(l,".e-list-item").classList.contains("e-level-1")&&!n.hasAttribute("disabled")&&n.setAttribute("disabled","true")}else{var d=!a.querySelectorAll(".e-cont")[1].querySelector(".e-text").value;a.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=s,d&&!n.hasAttribute("disabled")?n.setAttribute("disabled","true"):!d&&n.hasAttribute("disabled")&&n.removeAttribute("disabled")}}if((0,e.closest)(r,".e-list-item")&&r.classList.contains("e-fullrow")){var h=this.parent.element.getElementsByClassName("e-link-dialog")[0];if(!h)return;var p,c=(h=h.getElementsByClassName("e-content")[0].getElementsByClassName("e-active")[0]).getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0];n=(p=(0,e.closest)(r,".e-hyperlink-dlg")||(0,e.closest)(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;(0,e.closest)(r,".e-list-item").classList.contains("e-level-2")?"defName"===(0,e.closest)(r,".e-list-item").getAttribute("data-uid")?(c.classList.contains("e-disabled")||c.hasAttribute("readonly")||(c.setAttribute("readonly","true"),c.classList.add("e-disabled"),c.setAttribute("disabled","true")),n.hasAttribute("disabled")&&n.removeAttribute("disabled")):"sheet"===(0,e.closest)(r,".e-list-item").getAttribute("data-uid")&&(c.classList.contains("e-disabled")&&c.hasAttribute("readonly")&&(c.removeAttribute("readonly"),c.classList.remove("e-disabled"),c.removeAttribute("disabled")),Ir(c.value.toUpperCase())&&n.hasAttribute("disabled")&&n.removeAttribute("disabled")):(0,e.closest)(r,".e-list-item").classList.contains("e-level-1")&&n.setAttribute("disabled","true")}else this.hlOpenHandler(r,!0,t)},n.prototype.createHyperlinkEle=function(t){var r=t.cell;if(!(0,e.isNullOrUndefined)(r.hyperlink)){var n=t.td,i=this.parent.createElement("a",{className:"e-hyperlink e-hyperlink-style"}),a=void 0;if("string"==typeof r.hyperlink?(0===r.hyperlink.toLowerCase().indexOf("www.")&&(r.hyperlink="http://"+r.hyperlink),a=r.hyperlink):0===(a=r.hyperlink.address).toLowerCase().indexOf("www.")&&(r.hyperlink.address=a="http://"+a),0===a.indexOf("http://")||0===a.indexOf("https://")||0===a.indexOf("ftp://")?(i.setAttribute("href",a),i.setAttribute("target","_blank")):(a.includes("=")||a.includes("!"))&&i.setAttribute("ref",a),"Accounting"===zs(r.format)?i.innerHTML=n.innerHTML:i.innerText=""!==n.innerText?n.innerText:a,n.textContent="",n.innerText="","FillWithoutFormatting"!==this.parent.autoFillSettings.fillType&&"FillWithoutFormatting"!==t.fillType&&"Clear Formats"!==t.action||(i.style.textDecoration="none"),n.appendChild(i),!t.style.color||!t.style.textDecoration){var o={};t.style.color||(t.style.color=o.color="#00e"),t.style.textDecoration||(t.style.textDecoration=o.textDecoration="underline"),Vr(this.parent,this.parent.getActiveSheet(),{rowIdx:t.rowIdx,colIdx:t.colIdx,preventEvt:!0,cell:{style:o}})}}},n.prototype.hyperEditContent=function(){var e=!0,r=this.hyperlinkContent(),n=t(this.parent.getActiveSheet().activeCell),i=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[n[0]].cells[n[1]];this.parent.scrollSettings.enableVirtualization&&(n[0]=n[0]-this.parent.viewport.topIndex,n[1]=n[1]-this.parent.viewport.leftIndex);var a,o=this.parent.getDisplayText(i),s=i.hyperlink;"string"==typeof s?(a=s,o=o||a,-1===a.indexOf("http://")&&-1===a.indexOf("https://")&&-1===a.indexOf("ftp://")&&(e=!1)):"object"==typeof s&&(a=s.address,o=o||a,-1===a.indexOf("http://")&&-1===a.indexOf("https://")&&-1===a.indexOf("ftp://")&&(e=!1));for(var l=0,d=0,h=this.parent.definedNames,p=this.parent.sheets,c=0,u=h.length;c<u;c++)h[c].name===a&&l++;for(c=0,u=p.length;c<u;c++)a.includes(p[c].name)&&d++;0===l&&0===d&&(e=!0);var f=r.querySelector(".e-content");if(e){var g=f.querySelector(".e-webpage");if(g.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",o),"string"==typeof s)g.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",s);else g.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",s.address)}else{var m=void 0,v=f.querySelector(".e-document");v.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",o);var y=void 0,C=void 0;if(this.parent.definedNames)for(c=0;c<this.parent.definedNames.length;c++)if(this.parent.definedNames[c].name===a){m=!0;break}if(m){var b=v.getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0];b.setAttribute("readonly","true"),b.classList.add("e-disabled"),b.setAttribute("disabled","true");var x=v.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[1];for(c=0;c<x.getElementsByTagName("li").length;c++)x.getElementsByTagName("li")[c].innerText===a&&x.getElementsByTagName("li")[c].classList.add("e-active")}else{if(a&&-1!==a.lastIndexOf("!")){var S=a.lastIndexOf("!");y=a.substring(0,S),C=a.substring(S+1)}v.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",C);for(x=v.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[0],c=0;c<x.getElementsByTagName("li").length;c++)if(x.getElementsByTagName("li")[c].innerText===y){if(x.getElementsByTagName("li")[c].classList.contains("e-active"))break;x.getElementsByTagName("li")[c].classList.add("e-active")}else x.getElementsByTagName("li")[c].classList.contains("e-active")&&x.getElementsByTagName("li")[c].classList.remove("e-active")}}return r},n.prototype.hyperlinkContent=function(){var r,n,i=this.parent.serviceLocator.getService(Dl),a=0,o=0,s=!0,l=!0,d=t(this.parent.getActiveSheet().activeCell),h=this.parent.getActiveSheet(),p=zn(d[0],d[1],h),c=!0;if(p){c=!!(p.value&&"string"==typeof p.value&&null!==p.value.match("[A-Za-z]+")||""===p.value||(0,e.isNullOrUndefined)(p.value));var u=p.hyperlink;if("string"==typeof u)-1===(f=u).indexOf("http://")&&-1===f.indexOf("https://")&&-1===f.indexOf("ftp://")&&(n=u,s=!1);else if("object"==typeof u){var f;-1===(f=u.address).indexOf("http://")&&-1===f.indexOf("https://")&&-1===f.indexOf("ftp://")&&(n=u.address,s=!1)}if(n){for(var g=0,m=0,v=this.parent.definedNames,y=this.parent.sheets,C=0,b=y.length;C<b;C++)n.includes(y[C].name)&&m++;var x=0;for(b=v.length;x<b;x++)v[x].name===n&&g++;0===g&&0===m&&(s=!0)}if(o=s?0:1,this.parent.definedNames)for(var S=0;S<this.parent.definedNames.length;S++)if(this.parent.definedNames[S].name===n){r=!0,l=!1;break}}var w=this.parent.createElement("div",{className:"e-link-dialog"}),I=this.parent.createElement("div",{className:"e-webpage"}),E=this.parent.createElement("div",{className:"e-document"});this.headerTabs=new vh.Tab({selectedItem:o,items:[{header:{text:i.getConstant("WebPage")},content:I},{header:{text:i.getConstant("ThisDocument")},content:E}]}),this.headerTabs.appendTo(w);var N=w.querySelector(".e-toolbar-items").querySelector(".e-indicator");N.style.cssText=s?"left: 0; right: 136px":"left: 136px; right: 0";var R=this.parent.createElement("div",{className:"e-cont"}),A=this.parent.createElement("div",{className:"e-cont"}),k=this.parent.createElement("div",{className:"e-header"});k.innerText=i.getConstant("DisplayText");var O=this.parent.createElement("div",{className:"e-header"});O.innerText=i.getConstant("Url");var F=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});this.inputElements.push(F),c||(F.classList.add("e-disabled"),F.setAttribute("readonly","true"),F.setAttribute("disabled","true")),p&&(0,e.isNullOrUndefined)(p.hyperlink)&&F.setAttribute("value",this.parent.getDisplayText(p));var T=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});this.inputElements.push(T),F.setAttribute("placeholder",i.getConstant("EnterTheTextToDisplay")),T.setAttribute("placeholder",i.getConstant("EnterTheUrl")),R.appendChild(F),R.insertBefore(k,F),A.appendChild(T),A.insertBefore(O,T),I.appendChild(A),I.insertBefore(R,A);for(var D=[],L=[],P=this.parent.sheets;a<this.parent.sheets.length;a++){var M=this.parent.sheets[a].name;"Visible"===this.parent.sheets[a].state&&(P[a]===this.parent.getActiveSheet()?D.push({nodeId:"sheet",nodeText:-1!==M.indexOf(" ")?"'"+M+"'":M,selected:!0}):D.push({nodeId:"sheet",nodeText:-1!==M.indexOf(" ")?"'"+M+"'":M}))}for(a=0;a<this.parent.definedNames.length;a++)L.push({nodeId:"defName",nodeText:this.parent.definedNames[a].name});var B=[{nodeId:"01",nodeText:i.getConstant("CellReference"),expanded:l,nodeChild:D},{nodeId:"02",nodeText:i.getConstant("DefinedNames"),expanded:r,nodeChild:L}],H=new vh.TreeView({fields:{dataSource:B,id:"nodeId",text:"nodeText",child:"nodeChild"}}),U=this.parent.createElement("div",{className:"e-cont"}),V=this.parent.createElement("div",{className:"e-header"});V.innerText=i.getConstant("CellReference");var z=this.parent.createElement("input",{className:"e-input e-text e-hyp-text",attrs:{type:"Text"}});z.setAttribute("value","A1"),this.inputElements.push(z),U.appendChild(z),U.insertBefore(V,z);var j=this.parent.createElement("div",{className:"e-cont"}),_=this.parent.createElement("div",{className:"e-header"});_.innerText=i.getConstant("DisplayText");var q=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});this.inputElements.push(q),c||(q.classList.add("e-disabled"),q.setAttribute("readonly","true"),q.setAttribute("disabled","true")),p&&(0,e.isNullOrUndefined)(p.hyperlink)&&q.setAttribute("value",this.parent.getDisplayText(p)),q.setAttribute("placeholder",i.getConstant("EnterTheTextToDisplay")),j.appendChild(q),j.insertBefore(_,q);var W=this.parent.createElement("div",{className:"e-cont"}),G=this.parent.createElement("div",{className:"e-header"});G.innerText=i.getConstant("Sheet");var Y=this.parent.createElement("div",{className:"e-refcont"});return this.divElements.push(R),this.divElements.push(A),this.divElements.push(k),this.divElements.push(O),this.divElements.push(U),this.divElements.push(V),this.divElements.push(j),this.divElements.push(_),this.divElements.push(W),this.divElements.push(G),this.divElements.push(Y),this.divElements.push(E),this.divElements.push(I),this.divElements.push(w),W.appendChild(Y),W.insertBefore(G,Y),E.appendChild(U),E.insertBefore(j,U),H.appendTo(Y),E.appendChild(W),w},n.prototype.removeHyperlink=function(e){var t=zn(e.rowIdx,e.colIdx,e.sheet);t&&t.hyperlink&&("string"==typeof t.hyperlink?t.value=t.value||0===t.value?t.value:t.hyperlink:t.value=t.value||0===t.value?t.value:t.hyperlink.address,delete t.hyperlink,t.style&&(delete t.style.textDecoration,delete t.style.color),t.validation&&t.validation.isHighlighted&&t.style.backgroundColor&&(t.style.color="#ff0000"),e.sheet===this.parent.getActiveSheet()&&(t.style&&this.parent.notify(Mt,null),e.preventRefresh||this.parent.serviceLocator.getService("cell").refresh(e.rowIdx,e.colIdx,!1,null,!0,!1,Kr(this.parent))))},n.prototype.removeHyperlinkHandler=function(e){var r,n,i=e.range,a=this.parent.getActiveSheet();if(!e.preventEventTrigger){var o={address:-1===i.indexOf("!")?a.name+"!"+i:i,cancel:!1};if(this.parent.notify(K,{action:"removeHyperlink",eventArgs:o}),o.cancel)return}if(i&&-1!==i.indexOf("!")){var s=i.lastIndexOf("!");r=i.substring(0,s);for(var l=this.parent.sheets,d=0;d<l.length;d++)l[d].name===r&&(n=d);a=this.parent.sheets[n],i=i.substring(s+1)}for(var h,p,c=t(i||a.activeCell),u=c[0];u<=c[2];u++)for(var f=c[1];f<=c[3];f++)if(a&&a.rows[u]&&a.rows[u].cells[f]){if(p=[],h=this.parent.getCell(u,f))for(var g=0;g<h.classList.length;g++)p.push(h.classList[g]);this.parent.notify(Gt,{sheet:a,rowIdx:u,colIdx:f});for(g=0;g<p.length;g++)h.classList.contains(p[g])||h.classList.add(p[g])}e.preventEventTrigger||this.parent.notify(Pa,{action:"removeHyperlink",eventArgs:{address:-1===i.indexOf("!")?a.name+"!"+i:i}})},n}(),Ch=function(){return Ch=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ch.apply(this,arguments)},bh=function(){function r(e){this.undoCollection=[],this.redoCollection=[],this.isUndo=!1,this.undoRedoStep=100,this.parent=e,this.addEventListener()}return r.prototype.setActionData=function(e){var r,i=this.parent.getActiveSheet(),a=[],o=[],s=e.args,d=s.eventArgs,h={};switch(s.action){case"format":r=t(s.eventArgs.range);break;case"clipboard":h=d.copiedInfo,r=t(l(d.pastedRange)),h&&h.isCut&&(o=this.getCellDetails(h.range,Fn(this.parent,En(this.parent,h.sId)),"clipboard"));break;case"beforeSort":(r=t(s.eventArgs.range))[0]===r[2]&&r[2]-r[0]===0&&(r[0]=0,r[1]=0,r[2]=i.usedRange.rowIndex,r[3]=i.usedRange.colIndex);break;case"beforeCellSave":case"cellDelete":case"cellSave":case"addNote":case"editNote":case"deleteNote":case"deleteImage":case"hyperlink":case"removeHyperlink":r=t(d.address);break;case"beforeWrap":case"beforeReplace":case"chartDesign":r=this.parent.getAddressInfo(d.address).indices;break;case"beforeClear":case"beforeInsertImage":case"beforeInsertChart":case"filter":r=t(d.range);break;case"autofill":r=t(d.fillRange);break;case"validation":Wd(d.range.substring(d.range.lastIndexOf("!")+1))?(r=t(d.range))[2]=i.usedRange.rowIndex:r=t(d.range);break;case"removeValidation":if(d.isColSelected){this.beforeActionData={cellDetails:[]};for(var p=d.range.substring(d.range.lastIndexOf("!")+1).split(":"),c=n(p[0]),u=n(p[1]);c<=u;c++)i.columns[c]&&i.columns[c].validation&&this.beforeActionData.cellDetails.push({colIndex:c,validation:i.columns[c].validation})}else r=t(d.range)}"beforeSort"===s.action?(this.beforeActionData={cellDetails:d.cellDetails},this.beforeActionData.sortedCellDetails=d.sortedCellDetails):r&&(a=s.isClearAction&&this.beforeActionData.cellDetails.length>0?this.beforeActionData.cellDetails:this.getCellDetails(r,i,s.action),this.beforeActionData={cellDetails:a,cutCellDetails:o})},r.prototype.getBeforeActionData=function(e){e.beforeDetails=this.beforeActionData},r.prototype.performUndoRedo=function(t){var r,n;if(t.isFromUpdateAction?r=t:(r=t.isUndo?this.undoCollection.pop():this.redoCollection.pop(),t.setCollection&&(t.undoArgs=r)),this.isUndo=t.isUndo,r){var i,a=void 0,o=r.action,s={},l=[];if("autofill"===r.action||"autofillWithCF"===r.action?l=r.eventArgs.fillRange.split("!"):"cellSave"===r.action||"cellDelete"===r.action?l=r.eventArgs.address.split("!"):"clipboard"===r.action&&(l=r.eventArgs.pastedRange.split("!")),l.length>0?i=Fn(this.parent,In(this.parent,l[0])):"clear"===r.action&&(i=Fn(this.parent,r.eventArgs.sheetIndex)),"autofillWithCF"===r.action){r.action="autofill";var d=i.conditionalFormats;"autofillWithCF"===d[d.length-1].action&&t.isUndo&&(d[d.length-1].value?d.pop():this.parent.notify(Ot,{range:d[d.length-1].range,isAction:!0}))}if(!t.isPublic){var h=r.eventArgs.beforeActionData;if(delete r.eventArgs.beforeActionData,a={action:r.action,eventArgs:{}},(0,e.extend)(a.eventArgs,r.eventArgs,null,!0),"Manual"===this.parent.calculationMode&&("clipboard"===r.action||"cellDelete"===r.action||"autofill"===r.action||"clear"===r.action))if(t.isUndo){if("paste"===r.eventArgs.requestType&&"clipboard"===r.action||r.eventArgs.fillType){var p=void 0;if(h.cutCellDetails.length?i.isSheetCalculated&&(p="Cut"):p=r.eventArgs.fillType?"autofill":"Copy",p)for(var c=0,u=h.cellDetails,f=h.cutCellDetails;c<u.length;c++){var g=zn(u[c].rowIndex,u[c].colIndex,i,!1,!0);g=g?g.value:"","Copy"===p?u[c].copyCellValue=g:"autofill"===p?u[c].value!==g&&u[c].autoFillText!==g&&(u[c].autoFillText=g):"Cut"===p&&f[c].value!==g&&(f[c].value=g)}}}else i.isSheetCalculated&&(h.cutCellDetails.length?h.cutCellDetails:h.cellDetails).forEach((function(e){var t=zn(e.rowIndex,e.colIndex,i,!1,!0).value;!t&&0!==t||e.value===t||(e.value=t)}));if(r.eventArgs.beforeActionData=h,a.eventArgs.cancel=!1,r.preventAction=a.preventAction=!0,t.isUndo){if(a.isUndo=!0,"cellSave"===r.action&&"Manual"===this.parent.calculationMode&&i.isSheetCalculated&&1===h.cellDetails.length){var m=zn(h.cellDetails[0].rowIndex,h.cellDetails[0].colIndex,i);m&&r.eventArgs.displayText!==m.value&&(r.eventArgs.displayText=m.value)}}else a.isRedo=!0;if(t.isFromUpdateAction||this.parent.notify(K,a),a.eventArgs.cancel)return void this.updateUndoRedoIcons();delete a.eventArgs.cancel}switch(r.action){case"cellSave":case"format":case"wrap":case"cellDelete":case"autofill":case"removeValidation":case"hyperlink":case"addNote":case"editNote":case"deleteNote":case"removeHyperlink":(r=this.performOperation(r,t.preventEvt,t.preventReSelect,t.isFromAutoFillOption)).action=o;break;case"sorting":this.undoForSorting(r,t.isUndo);break;case"clipboard":r=this.undoForClipboard(r,t.isUndo,a),n=!0;break;case"resize":case"resizeToFit":if(r=this.undoForResize(r),t.isUndo){var v=r.eventArgs;if(!v.isPrevCustomHeight){var y=this.parent.sheets[v.sheetIndex],C=y&&fl(y,v.index);C&&C.customHeight&&delete C.customHeight}}break;case"hideShow":case"delete":case"addHighlight":case"removeHighlight":case"clearCF":case"insertImage":case"deleteImage":case"imageRefresh":case"insertChart":case"deleteChart":case"chartRefresh":case"addDefinedName":wd(r,this.parent,!t.isUndo);break;case"replace":r=this.performOperation(r);break;case"replaceAll":r.eventArgs.isAction=!1,t.isUndo&&(s.value=r.eventArgs.replaceValue,s.replaceValue=r.eventArgs.value,s.skipFormatCheck=Kr(this.parent)),this.parent.notify(ot,Ch({},r.eventArgs,s));break;case"insert":case"filter":wd(r,this.parent,!t.isUndo,null,a),n="filter"===r.action;break;case"validation":wd(r,this.parent,!t.isUndo),r=this.performOperation(r);break;case"merge":r.eventArgs.merge=r.isFromUpdateAction?r.eventArgs.merge:!r.eventArgs.merge,wd(r,this.parent,!t.isUndo);break;case"clear":r=this.performOperation(r),t.isUndo&&r.eventArgs.cfClearActionArgs&&wd({action:"clearCF",eventArgs:r.eventArgs.cfClearActionArgs},this.parent,!t.isUndo);for(c=this.undoCollection.length;c>0&&this.undoCollection[c-1].isClearAction;c--)this.performUndoRedo(t);break;case"conditionalFormat":wd(r,this.parent,!t.isUndo,this.undoCollection);break;case"chartDesign":r.eventArgs.isUndo=t.isUndo,this.parent.notify(_o,r.eventArgs)}t.isFromUpdateAction||(t.isUndo?this.redoCollection.push(r):this.undoCollection.push(r),this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.redoCollection.length>this.undoRedoStep&&this.redoCollection.splice(0,1),this.updateUndoRedoIcons(),t.isPublic||n||this.parent.notify(Pa,(0,e.extend)({isUndoRedo:!0,isUndo:t.isUndo},r))),this.parent.notify(Mt,null)}},r.prototype.undoForSorting=function(r,i){var a=this,o=p(this.parent,r.eventArgs.range),s=t(r.eventArgs.range),l=function(t,r){if(o===a.parent.activeSheetIndex){var n=a.parent.getCell(s[0]-1,a.parent.sortCollection[t].columnIndex);if(n&&(n=(0,e.select)(".e-filter-icon",n))){var i="e-sort"+("Ascending"===a.parent.sortCollection[t].order?"asc":"desc")+"-filter";r?n.classList.add(i):n.classList.remove(i)}}};if(i){if(this.parent.notify(Fe,{result:r.eventArgs.beforeActionData.cellDetails,range:s,sheet:Fn(this.parent,o),jsonData:r.eventArgs.beforeActionData.sortedCellDetails,isUndo:!0}),this.parent.notify(Te,{range:r.eventArgs.range}),this.parent.sortCollection&&r.eventArgs.previousSort)for(var d=this.parent.sortCollection.length-1;d>=0;d--)if(this.parent.sortCollection[d].sheetIndex===o){l(d,!1),this.parent.sortCollection.splice(d,1);var h=r.eventArgs.previousSort;if(Array.isArray(h))for(var c=0;c<h.length;c++)this.parent.sortCollection.splice(c,0,h[c]),l(c,!0);this.parent.sortCollection.length||(this.parent.sortCollection=void 0);break}}else if(wd(r,this.parent,!0),r.eventArgs.previousSort){var u=0;if(this.parent.sortCollection)for(d=this.parent.sortCollection.length-1;d>=0;d--)this.parent.sortCollection[d].sheetIndex===o&&(l(d,!1),u=d,this.parent.sortCollection.splice(d,1));else this.parent.sortCollection=[];this.parent.sortCollection.splice(u,0,{sortRange:r.eventArgs.range.substring(r.eventArgs.range.lastIndexOf("!")+1),sheetIndex:o,columnIndex:n(r.eventArgs.sortOptions.sortDescriptors.field),order:r.eventArgs.sortOptions.sortDescriptors.order}),l(u,!0)}},r.prototype.updateUndoRedoCollection=function(e){var t=["clipboard","format","sorting","cellSave","resize","resizeToFit","wrap","hideShow","replace","validation","merge","clear","conditionalFormat","clearCF","insertImage","imageRefresh","insertChart","deleteChart","chartRefresh","filter","cellDelete","autofill","autofillWithCF","addDefinedName","removeValidation","removeHighlight","addHighlight","hyperlink","removeHyperlink","deleteImage","chartDesign","replaceAll","addNote","editNote","deleteNote"];"insert"!==e.args.action&&"delete"!==e.args.action||"Sheet"===e.args.eventArgs.modelType||t.push(e.args.action);var r=e.args.action;if(-1!==t.indexOf(r)||e.isPublic){var n=e.args.eventArgs;if("clipboard"===r||"sorting"===r||"format"===r||"cellSave"===r||"wrap"===r||"replace"===r||"validation"===r||"clear"===r||"conditionalFormat"===r||"clearCF"===r||"insertImage"===r||"imageRefresh"===r||"insertChart"===r||"chartRefresh"===r||"filter"===r||"cellDelete"===r||"autofill"===r||"autofillWithCF"===r||"removeValidation"===r||"addDefinedName"===r||"hyperlink"===r||"removeHyperlink"===r||"deleteImage"===r||"chartDesign"===r||"addNote"===r||"editNote"===r||"deleteNote"===r){var i={beforeDetails:{cellDetails:[]}};this.parent.notify(Na,i),n.beforeActionData=i.beforeDetails}if("clipboard"===r&&n.copiedInfo&&n.copiedInfo.isExternal){var a=this.parent.getAddressInfo(n.pastedRange);n.copiedInfo.cellDetails=this.getCellDetails(a.indices,Fn(this.parent,a.sheetIndex),r)}this.redoCollection.length>0&&"autofillWithCF"===this.redoCollection[this.redoCollection.length-1].action&&"autofill"===e.args.action&&(e.args.action="autofillWithCF"),this.undoCollection.push(e.args),this.redoCollection=[],this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.updateUndoRedoIcons()}},r.prototype.clearUndoRedoCollection=function(){this.undoCollection=[],this.redoCollection=[],this.updateUndoRedoIcons()},r.prototype.updateUndoRedoIcons=function(){var e=this.parent.serviceLocator.getService(Dl);this.parent.notify(Oi,[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_undo"],enable:this.undoCollection.length>0}]),this.parent.notify(Oi,[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_redo"],enable:this.redoCollection.length>0}])},r.prototype.updateUndoRedoSheetReferences=function(e){var t=function(t){t.forEach((function(t){var r=t.eventArgs;r&&["address","dataRange","fillRange"].forEach((function(t){r[t]&&r[t].includes(e.pName)&&(r[t]=r[t].replace(e.pName,e.value))}))}))};t(this.undoCollection),t(this.redoCollection)},r.prototype.undoForClipboard=function(e,r,n){var i=this,a=e.eventArgs,o=[];o[0]=a.pastedRange.substring(0,a.pastedRange.lastIndexOf("!")),o[1]=a.pastedRange.substring(a.pastedRange.lastIndexOf("!")+1);var l,d=t(o[1]),h=In(this.parent,o[0]),p=Fn(this.parent,h),u=a.copiedInfo,f=a.beforeActionData,g=e.isFromUpdateAction,m=h===this.parent.activeSheetIndex;if(n&&(n.isUndoRedo=!0,n.eventArgs.beforeActionData=f),"imagePaste"===e.eventArgs.requestType){var v=a.copiedShapeInfo;r?(l=v.pictureElem,v.isCut?(this.parent.notify(ko,{id:l.id,sheetIdx:a.pasteSheetIndex+1,isUndoRedo:!0}),this.parent.notify(Ao,{options:{src:l.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:v.height,width:v.width,id:l.id},range:v.copiedRange,isPublic:!1,isUndoRedo:!0})):this.parent.notify(ko,{id:a.pastedPictureElement.id,sheetIdx:a.pasteSheetIndex+1,range:a.pastedRange,isUndoRedo:!0})):v.isCut?(l=v.pictureElem,this.parent.notify(ko,{id:l.id,sheetIdx:v.sId,isUndoRedo:!0}),this.parent.notify(Ao,{options:{src:l.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:v.height,width:v.width,id:l.id},range:v.pastedRange,isPublic:!1,isUndoRedo:!0})):(l=a.pastedPictureElement,this.parent.notify(Ao,{options:{src:l.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:v.height,width:v.width,id:l.id},range:a.pastedRange,isPublic:!1,isUndoRedo:!0}))}else{if(r){if(u.isCut){var y=f.cutCellDetails;this.updateCellDetails(y,Fn(this.parent,En(this.parent,u.sId)),c(u.range),m,e),a.cfClearActionArgs&&wd({action:"clearCF",eventArgs:a.cfClearActionArgs},this.parent,!1)}f&&this.updateCellDetails(f.cellDetails,p,d,m,e,null,null,n?n.isUndoRedo:null),a.cfActionArgs&&a.cfActionArgs.cfModel.forEach((function(e){wd({eventArgs:{range:e.range,type:e.type,cFColor:e.cFColor,value:e.value,sheetIdx:a.cfActionArgs.sheetIdx,cancel:!0},action:"conditionalFormat"},i.parent,!1)})),Ld(p,d[0],d[1],yl(p,d[0]));var C=Pd(p,d[0]);Ed(this.parent,p,C,d[0]),a.mergeCollection.forEach((function(e){e.merge=!e.merge,i.parent.notify(St,e),e.merge=!e.merge})),n&&!g&&this.parent.notify(Pa,n)}else if(u.isExternal){var b=this.parent.getAddressInfo(a.pastedRange);this.updateCellDetails(u.cellDetails,Fn(this.parent,b.sheetIndex),b.indices,!0,e,null,null,n?n.isUndoRedo:null),n&&!g&&this.parent.notify(Pa,n)}else{var x=new Promise((function(e){e(void 0)}));b=this.parent.getAddressInfo(a.copiedRange);this.parent.notify(a.copiedInfo.isCut?Li:Pi,{range:b.indices,sId:Fn(this.parent,b.sheetIndex).id,promise:x,invokeCopy:!0,isPublic:!0,isFromUpdateAction:g}),x.then((function(){i.parent.notify(Mi,{range:o?s(a.pastedRange):o,sIdx:o?In(i.parent,Nn(a.pastedRange)):o,type:a.type,isAction:!1,isInternal:!0,isFromUpdateAction:g,beforeActionData:a.beforeActionData,isUndo:r}),n&&!g&&i.parent.notify(Pa,n)}))}m&&!g?(this.parent.notify(Ti,{address:a.selectedRange}),this.parent.notify(Qo,{})):this.checkRefreshNeeded(h,g)}return e},r.prototype.undoForResize=function(e){var r=e.eventArgs;if(void 0===r.hide)if(r.isCol){var n=r.oldWidth;r.oldWidth=r.width,r.width=n}else{n=r.oldHeight;r.oldHeight=r.height,r.height=n}else r.hide=!r.hide;wd(e,this.parent,!1);var i=this.parent.getActiveSheet(),a=t(i.activeCell),o=zn(a[0],a[1],i);if(o&&o.rowSpan){var s=this.parent.getCell(a[0],a[1]);this.parent.element.querySelector(".e-active-cell").style.height=s.offsetHeight+"px"}else if(o&&o.colSpan){s=this.parent.getCell(a[0],a[1]);this.parent.element.querySelector(".e-active-cell").style.width=s.offsetWidth+"px"}return e},r.prototype.performOperation=function(r,o,s,l){var d=r.eventArgs,h=[],p="cellSave"===r.action||"wrap"===r.action||"replace"===r.action||"cellDelete"===r.action||"hyperlink"===r.action||"addNote"===r.action||"editNote"===r.action||"deleteNote"===r.action||"removeHyperlink"===r.action?d.address:d.range;"autofill"===r.action?(h[0]=d.fillRange.substring(0,d.fillRange.lastIndexOf("!")),h[1]=d.fillRange.substring(d.fillRange.lastIndexOf("!")+1)):(h[0]=p.substring(0,p.lastIndexOf("!")),h[1]=p.substring(p.lastIndexOf("!")+1));var u,f=In(this.parent,h[0]),g=Fn(this.parent,f);if(d.isColSelected){var m=h[1].split(":");u=[0,n(m[0]),g.rowCount-1,n(m[1])]}else u=c(t(h[1]));var v=u,y=d.beforeActionData,C=r.isFromUpdateAction,b=this.checkRefreshNeeded(f,C),x={cellIdx:[u[0],u[1]],isUnique:!1,uniqueRange:""};if(d.isColSelected||this.parent.notify(Ee,x),this.isUndo){if(x.isUnique&&d.formula&&d.formula.indexOf("UNIQUE")>-1)if("#SPILL!"!==zn((I=t(x.uniqueRange))[0],I[1],this.parent.getActiveSheet()).value)for(var S=I[0];S<=I[2];S++)for(var w=I[1];w<=I[3];w++)S===I[0]&&w===I[1]&&(w+=1),this.parent.updateCellInfo({value:""},a([S,w]),!0);if(this.updateCellDetails(y.cellDetails,g,u,b,r,o,d.isColSelected,!0,l),x.isUnique&&"cellDelete"===r.action&&d.isSpill){for(var I,E=zn((I=t(x.uniqueRange))[0],I[1],this.parent.getActiveSheet()),N=I[0];N<=I[2];N++)for(S=I[1];S<=I[3];S++)for(w=u[0];w<=u[2];w++)for(var R=u[1];R<=u[3];R++)N===w&&S===R||this.parent.updateCellInfo({value:""},i(N,S),!0);E.value="#SPILL!",this.parent.updateCellInfo(E,i(I[0],I[1]),!0)}if(!d.isSpill&&""!==x.uniqueRange){var A=t(x.uniqueRange);for(S=A[0];S<=A[2];S++)for(w=A[1];w<=A[3];w++)S===A[0]&&w===A[1]&&(w+=1),this.parent.updateCellInfo({value:""},a([S,w]),!0);this.parent.notify(Ne,null)}}else{var k=r.eventArgs,O=t(g.activeCell),F=h[1]?h[1].split(":"):[];v[0]!==O[0]&&v[1]!==O[1]&&"hyperlink"===r.action&&F.length>0&&(g.activeCell=F[0],O=t(g.activeCell));var T=this.parent.getCellStyleValue(["textDecoration"],O).textDecoration;if(k&&k.style&&k.style.textDecoration){var D=k.style.textDecoration,L=D,P=void 0,M=!1;"underline"===T?L="underline"===D?"none":"underline line-through":"line-through"===T?L="line-through"===D?"none":"underline line-through":"underline line-through"===T&&(L="underline"===D?"line-through":"underline",M=!0),"none"===L&&(M=!0),k.style.textDecoration=L,r.eventArgs=k;for(N=v[0];N<=v[2];N++)for(S=v[1];S<=v[3];S++){if(P={},"none"===(T=this.parent.getCellStyleValue(["textDecoration"],[N,S]).textDecoration)){if(M)continue;P.textDecoration=D}else if("underline"===T||"line-through"===T)if(M){if(D!==T)continue;P.textDecoration="none"}else P.textDecoration=D!==T?"underline line-through":D;else if("underline line-through"===T){if(!M)continue;P.textDecoration="underline"===D?"line-through":"underline"}this.parent.notify(ae,{style:{textDecoration:P.textDecoration},range:[N,S,N,S],refreshRibbon:!0,onActionUpdate:!0})}k.style.textDecoration=D,r.eventArgs=k}else{if(!(0,e.isNullOrUndefined)(d.oldValue)&&d.oldValue!==d.value&&x.isUnique){var B=t(x.uniqueRange);if("#SPILL!"!==zn(B[0],B[1],this.parent.getActiveSheet()).value)for(S=B[0];S<=B[2];S++)for(w=B[1];w<=B[3];w++)S===B[0]&&w===B[1]&&(this.parent.updateCellInfo({value:"#SPILL!"},a([B[0],B[1]]),!0),w+=1),this.parent.updateCellInfo({value:""},a([S,w]),!0)}if(wd(r,this.parent,!0),x.isUnique&&"cellDelete"===r.action&&d.isSpill){var H=t(x.uniqueRange),U=!1;for(N=H[0];N<=H[1];N++)for(S=H[1];S<=H[3];S++)N===H[0]&&S===H[1]&&S++,zn(N,S,g)&&!(0,e.isNullOrUndefined)(zn(N,S,g).value)&&""!==zn(N,S,g).value&&(U=!0);if(!U)(E=zn(H[0],H[1],this.parent.getActiveSheet())).value="",this.parent.updateCellInfo(E,i(H[0],H[1]),!0),this.parent.notify(Ne,null)}}}return"autofill"===r.action&&(h[1]=this.isUndo?r.eventArgs.dataRange:r.eventArgs.selectedRange),!b||s||C||(d.isColSelected&&(h[1]=g.selectedRange),this.parent.notify(Ti,{address:h[1]})),this.parent.showAggregate&&this.parent.notify(po,{}),r},r.prototype.getCellDetails=function(t,r,n){var i,a=this,o=[],s="cellDelete"===n,l={};t=c(t);var d=function(t,n){var s={rowIndex:t,colIndex:n,value:i?i.value:"",formula:i?i.formula:""},l=yl(r,t);if(i){i.format&&(s.format=i.format),(0,e.isNullOrUndefined)(i.isLocked)||(s.isLocked=i.isLocked),i.style&&(s.style=Object.assign({},i.style)),i.wrap&&(s.wrap=i.wrap),i.rowSpan&&(s.rowSpan=i.rowSpan),i.colSpan&&(s.colSpan=i.colSpan),i.image&&(s.image=i.image),i.chart&&(s.chart=JSON.parse(JSON.stringify(i.chart))),i.validation&&(s.validation=Object.assign({},i.validation)),i.notes&&(s.notes=i.notes),i.isReadOnly&&(s.isReadOnly=i.isReadOnly),i.formattedText&&(s.formattedText=i.formattedText),i.hyperlink&&(s.hyperlink=(0,e.isObject)(i.hyperlink)?(0,e.extend)({},i.hyperlink):i.hyperlink),(r.standardHeight?l!==r.standardHeight:20!==l)&&(i.rowHeight=s.rowHeight=l);var d=a.parent.editModule;s.value=i&&d&&i.formula===d.editCellData.value&&!(0,e.isNullOrUndefined)(d.editCellData.prevFormulaValue)?d.editCellData.prevFormulaValue:s.value}o.push(s)};if("validation"===n||"removeValidation"===n)for(var h=t[1];h<=t[3];h++)for(var p=Il(r,h),u=t[0];u<=t[2];u++)!l[h]&&kl(p,u,h)&&(o.push({colIndex:h,validation:Object.assign({},p.validation)}),l[h]=!0),(i=zn(u,h,r))&&!i.validation||d(u,h);else for(var f=t[0];f<=t[2];f++)if(!s||!vl(r,f))for(var g=t[1];g<=t[3];g++)i=zn(f,g,r),d(f,g);return o},r.prototype.updateCellDetails=function(t,r,n,o,s,l,d,h,p){var c,u,f,g,m,v,y,C=this,b=t.length,x=s&&!l&&("cellSave"===s.action||"cellDelete"===s.action||"autofill"===s.action||"clipboard"===s.action),S=s&&!s.eventArgs.cfClearActionArgs&&r.conditionalFormats&&r.conditionalFormats.length&&[].slice.call(r.conditionalFormats),w=[];"cellDelete"===s.action&&(v=!1,y=n);for(var I=function(n){if(d||(0,e.isUndefined)(t[n].rowIndex))return El(r,t[n].colIndex,{validation:t[n].validation}),"continue";(u=zn(t[n].rowIndex,t[n].colIndex,r,!1,!0)).style&&s&&("format"===s.action||"clipboard"===s.action)&&(!u.style.borderTop||t[n].style&&t[n].style.borderTop||E.parent.setBorder({borderTop:""},r.name+"!"+i(t[n].rowIndex,t[n].colIndex),null,h),!u.style.borderLeft||t[n].style&&t[n].style.borderLeft||E.parent.setBorder({borderLeft:""},r.name+"!"+i(t[n].rowIndex,t[n].colIndex),null,h),!u.style.borderRight||t[n].style&&t[n].style.borderRight||E.parent.setBorder({borderRight:""},r.name+"!"+i(t[n].rowIndex,t[n].colIndex),null,h),!u.style.fontSize||t[n].style&&t[n].style.fontSize||(u.style.fontSize="11pt",f=!0,E.parent.notify(le,{style:{fontSize:"11pt"},rowIdx:t[n].rowIndex,colIdx:t[n].colIndex,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0})),!u.style.fontFamily||t[n].style&&t[n].style.fontFamily||(f=!0,u.style.fontFamily="Calibri",E.parent.notify(le,{style:{fontFamily:"Calibri"},rowIdx:t[n].rowIndex,colIdx:t[n].colIndex,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0}))),u.image&&s&&"clipboard"===s.action&&u.image.forEach((function(e){C.parent.notify(ko,{id:e.id,sheet:r,preventEventTrigger:!0,rowIdx:t[n].rowIndex,colIdx:t[n].colIndex})}));var o={value:t[n].formula&&t[n].formula.toUpperCase().includes("UNIQUE")?null:t[n].value,formula:t[n].formula};if(t[n].format&&(o.format=t[n].format),(0,e.isNullOrUndefined)(t[n].isLocked)||(o.isLocked=u.isLocked?u.isLocked:t[n].isLocked),t[n].style&&(o.style=Object.assign({},t[n].style)),t[n].wrap&&(o.wrap=t[n].wrap),t[n].rowSpan&&(o.rowSpan=t[n].rowSpan),t[n].colSpan&&(o.colSpan=t[n].colSpan),t[n].hyperlink&&(o.hyperlink=t[n].hyperlink),t[n].image&&(o.image=t[n].image),t[n].notes&&(o.notes=t[n].notes),t[n].isReadOnly&&(o.isReadOnly=t[n].isReadOnly),t[n].formattedText&&(o.formattedText=t[n].formattedText),jn(t[n].rowIndex,t[n].colIndex,r,o),m={action:"updateCellValue",address:[t[n].rowIndex,t[n].colIndex,t[n].rowIndex,t[n].colIndex],notes:t[n].notes,value:t[n].formula?t[n].formula:t[n].value,sheetIndex:In(E.parent,r.name),skipFormatCheck:Kr(E.parent),isDelete:v,deletedRange:y,actionName:s.action},E.parent.notify(ce,m),S&&!g&&(g=m.isFormulaDependent),s&&"format"===s.action&&"NumberFormat"===s.eventArgs.requestType&&o.wrap&&o.format!==u.format&&!fl(r,t[n].rowIndex).customHeight?E.parent.notify(Ge,{range:[t[n].rowIndex,t[n].colIndex,t[n].rowIndex,t[n].colIndex],wrap:!0,sheet:r,initial:!0,isOtherAction:!0}):(s&&"wrap"===s.action&&s.eventArgs.wrap||u.wrap&&!t[n].wrap)&&E.parent.notify(Ge,{range:[t[n].rowIndex,t[n].colIndex,t[n].rowIndex,t[n].colIndex],wrap:!1,sheet:r,initial:!0}),s&&t[n].hyperlink&&"clear"===s.action){var l=r.name+"!"+a([t[n].rowIndex,t[n].colIndex,t[n].rowIndex,t[n].colIndex]);c=E.parent.getCell(t[n].rowIndex,t[n].colIndex),"Clear All"===s.eventArgs.type||"Clear Hyperlinks"===s.eventArgs.type?E.parent.addHyperlink(t[n].hyperlink,l,t[n].value):"Clear Formats"===s.eventArgs.type&&c&&(0,e.addClass)(c.querySelectorAll(".e-hyperlink"),"e-hyperlink-style")}t[n].validation&&E.parent.notify(Qe,{rules:t[n].validation,range:r.name+"!"+i(t[n].rowIndex,t[n].colIndex)}),x&&t[n].value!==u.value&&E.parent.trigger("cellSave",{element:null,value:t[n].value,oldValue:u.value,formula:t[n].formula,cancel:!1,address:r.name+"!"+i(t[n].rowIndex,t[n].colIndex),displayText:E.parent.getDisplayText(t[n])}),S&&!g&&qr(S,w,t[n].rowIndex,t[n].colIndex)},E=this,N=0;N<b;N++)I(N);if(o){if(n[0]===n[2]&&n[1]===n[3]){var R=zn(n[0],n[1],r);R.rowSpan>1&&(n[2]=n[0]+R.rowSpan-1),R.colSpan>1&&(n[3]=n[1]+R.colSpan-1)}var A=!1;"autofill"===s.action||"clipboard"===s.action||"wrap"===s.action?A=!0:"format"===s.action&&"CellFormat"===s.eventArgs.requestType&&(A=Mr(s.eventArgs.style,!0)),this.parent.serviceLocator.getService("cell").refreshRange(n,!1,!1,!0,!1,Kr(this.parent),null,p,A,null,null,t),(w.length||g)&&this.parent.notify(kt,{cfModel:!g&&w,refreshAll:g,isAction:!0}),f&&zl((function(){return C.parent.selectRange(r.selectedRange)}))}},r.prototype.checkRefreshNeeded=function(e,t){var r=!0;return e!==this.parent.activeSheetIndex&&(t||(this.parent.activeSheetIndex=e,this.parent.dataBind()),r=!1),r},r.prototype.addEventListener=function(){this.parent.on(wa,this.performUndoRedo,this),this.parent.on(Ia,this.updateUndoRedoCollection,this),this.parent.on(Ea,this.setActionData,this),this.parent.on(Na,this.getBeforeActionData,this),this.parent.on(Ra,this.clearUndoRedoCollection,this),this.parent.on(no,this.updateUndoRedoIcons,this),this.parent.on(yr,this.updateUndoRedoSheetReferences,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(wa,this.performUndoRedo),this.parent.off(Ia,this.updateUndoRedoCollection),this.parent.off(Ea,this.setActionData),this.parent.off(Na,this.getBeforeActionData),this.parent.off(Ra,this.clearUndoRedoCollection),this.parent.off(no,this.updateUndoRedoIcons),this.parent.off(yr,this.updateUndoRedoSheetReferences))},r.prototype.destroy=function(){this.removeEventListener(),this.undoCollection.length>0&&(this.undoCollection=[]),this.redoCollection.length>0&&(this.redoCollection=[]),this.beforeActionData&&this.beforeActionData.cellDetails&&(this.beforeActionData.cellDetails=[]),this.parent=null},r.prototype.getModuleName=function(){return"undoredo"},r}(),xh=function(){function t(e){this.parent=e,this.wrapCell=this.parent.createElement("span",{className:"e-wrap-content"}),this.addEventListener()}return t.prototype.addEventListener=function(){this.parent.on(Ai,this.ribbonClickHandler,this),this.parent.on(Ge,this.wrapTextHandler,this),this.parent.on(Ji,this.rowHeightChangedHandler,this),this.parent.on(Qi,this.colWidthChanged,this),this.parent.on(fs,this.updateWrapCell,this)},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ai,this.ribbonClickHandler),this.parent.off(Ge,this.wrapTextHandler),this.parent.off(Ji,this.rowHeightChangedHandler),this.parent.off(Qi,this.colWidthChanged),this.parent.off(fs,this.updateWrapCell))},t.prototype.wrapTextHandler=function(t){if(t.initial||Kl(this.parent,t.range,!0)){if(t.isPublic&&Qr(this.parent,t.range))return;t.initial&&!t.td&&!t.outsideViewport&&Kl(this.parent,t.range,!0)&&(t.initial=!1);var r=void 0,n=void 0,i=void 0,a=void 0,o=void 0,s=void 0,l=void 0,d=void 0,h=void 0,p=void 0,c=this.parent.frozenRowCount(t.sheet),u=void 0,f=void 0,g=void 0;!(0,e.isNullOrUndefined)(t.sheet.standardHeight)&&t.sheet.standardHeight<20?u=!0:f=this.parent.allowFiltering&&this.parent.filterModule.filterRange.has(this.parent.activeSheetIndex)&&this.parent.filterModule.filterRange.get(this.parent.activeSheetIndex).range;for(var m=t.range[0];m<=t.range[2];m++){a=0,s=(l=(h=fl(t.sheet,m)).customHeight)||t.isCustomHgt,p=!ml(t.sheet,m);for(var v=t.range[1];v<=t.range[3];v++)if(!((n=zn(m,v,t.sheet,null,!0)).rowSpan<0||n.colSpan<0)){var y=n.rowSpan>1||n.colSpan>1;if((r=t.initial?t.td:p&&!Al(t.sheet,v)&&this.parent.getCell(m,v))?(t.wrap?(d=Rd(n.style&&n.style.fontFamily?n.style:this.parent.cellStyle),r.classList.add(Tl)):(r.classList.remove(Tl),d=null),(s||y||h.height<20||u||f&&m===f[0]&&v>=f[1]&&v<=f[3])&&this.updateWrapCell({rowIdx:m,colIdx:v,sheet:t.sheet,ele:r}),e.Browser.isIE&&r.classList.add("e-ie-wrap")):d=null,!s&&!y){i=Td(t.sheet,m,v,n.colSpan>1?v+n.colSpan-1:v);var C=this.parent.getDisplayText(n).toString();if(this.parent.isEdit&&r&&C.indexOf("\n")<0){var b=this.parent.element.querySelector(".e-spreadsheet-edit");b&&b.textContent.indexOf("\n")>-1&&(C=b.textContent)}if(C)if(t.wrap){r&&r.classList.contains("e-alt-unwrap")&&(r.classList.remove("e-alt-unwrap"),C.includes("\n")&&(g=r.querySelector(".e-hyperlink"))&&!g.innerText.includes("\n")&&(g.innerText=C));var x=void 0,S=0,w=void 0;if(C.indexOf("\n")>-1){var I=C.split("\n"),E=I.length;for(w=0;w<E;w++)0===(x=kd(I[w],i,n.style,this.parent.cellStyle))&&(x=1),S+=x;x=S}else x=kd(C,i,n.style,this.parent.cellStyle);if(o=Dd(this.parent,m,v,t.sheet,n.style||this.parent.cellStyle,x,d),a=Math.max(a,o),n.rowSpan>1){var N=bl(t.sheet,m,m+(n.rowSpan-1));if(N>=a)return;o=a=yl(t.sheet,m)+(a-N)}Ld(t.sheet,m,v,o)}else{if(r&&(C.indexOf("\n")>-1&&r.classList.add("e-alt-unwrap"),g=r.querySelector(".e-hyperlink"))){var R=g.innerText;R.includes("\n")&&(g.innerText=R.split("\n").join(" "))}o=Dd(this.parent,m,v,t.sheet,n.style||this.parent.cellStyle,1,d),Ld(t.sheet,m,v,o),a=Math.max(Pd(t.sheet,m),20)}else t.wrap&&C||(Ld(t.sheet,m,v,20),a=Math.max(Pd(t.sheet,m),20));if(v===t.range[3]){var A=yl(t.sheet,m);(t.wrap&&(t.isOtherAction?a>=20:a>20)&&Pd(t.sheet,m)<=a||(!t.wrap||!C)&&Pd(t.sheet,m)<A&&A>20)&&A!==a&&(r?(Ed(this.parent,t.sheet,a,m,t.row,t.hRow,p),r&&t.sheet.conditionalFormats&&t.sheet.conditionalFormats.length&&this.parent.notify(kt,{indexes:[m,v],isAction:!0})):Ed(this.parent,t.sheet,a,m,null,null,p,!p||m>this.parent.viewport.bottomIndex||m>=c&&m<this.parent.viewport.topIndex+c))}}if(r){if(s&&!y){C=this.parent.getDisplayText(n);t.wrap?r.classList.contains("e-alt-unwrap")&&r.classList.remove("e-alt-unwrap"):C.indexOf("\n")>-1&&r.classList.add("e-alt-unwrap")}t.wrap?l?r.style.lineHeight&&(r.style.lineHeight=""):r.style.lineHeight=parseFloat(n.style&&n.style.fontSize||this.parent.cellStyle.fontSize)*d+"pt":r.style.lineHeight=""}}}t.initial||this.parent.notify(Qo,null)}},t.prototype.ribbonClickHandler=function(t){var r=(0,e.closest)(t.originalEvent.target,".e-btn");if(r&&r.id===this.parent.element.id+"_wrap"){var n=r.classList.contains("e-active"),i=d(this.parent.getActiveSheet()),a={address:i,wrap:n,cancel:!1};if(Qr(this.parent))return void this.parent.notify(to,null);this.parent.notify(K,{action:"beforeWrap",eventArgs:a}),a.cancel||(qn(this.parent.getActiveSheet().selectedRange,n,this.parent),this.parent.notify(Pa,{action:"wrap",eventArgs:{address:i,wrap:n}}))}},t.prototype.rowHeightChangedHandler=function(e){if(e.isCustomHgt){e.sheet=this.parent.getActiveSheet();for(var t=this.parent.viewport.leftIndex,r=this.parent.viewport.rightIndex;t<=r;t++)zn(e.rowIdx,t,e.sheet,!1,!0).wrap&&(e.colIdx=t,e.ele=this.parent.getCell(e.rowIdx,t),this.updateWrapCell(e),e.ele.style.lineHeight&&(e.ele.style.lineHeight=""))}},t.prototype.colWidthChanged=function(e){if(e.checkWrapCell){e.sheet=this.parent.getActiveSheet();for(var t=this.parent.viewport.topIndex,r=this.parent.viewport.bottomIndex;t<=r;t++)zn(t,e.colIdx,e.sheet,!1,!0).wrap&&(e.rowIdx=t,e.ele=this.parent.getCell(t,e.colIdx),this.updateWrapCell(e))}},t.prototype.updateWrapCell=function(t){if(t.ele&&!t.ele.querySelector(".e-wrap-content")){for(var r=this.wrapCell.cloneNode(),n=t.ele.querySelector(".e-filter-btn");t.ele.childElementCount&&!(0,e.isNullOrUndefined)(t.ele.firstElementChild)&&-1===t.ele.firstElementChild.className.indexOf("e-addNoteIndicator");)r.appendChild(t.ele.firstElementChild);var i=void 0;if(!(0,e.isNullOrUndefined)(t.ele.firstElementChild)&&t.ele.firstElementChild.className.indexOf("e-addNoteIndicator")>-1&&(i=t.ele.firstElementChild),n&&(t.ele.firstChild?t.ele.insertBefore(n,t.ele.firstChild):t.ele.appendChild(n)),!zn(t.rowIdx,t.colIdx,t.sheet,!1,!0).hyperlink){var a=t.ele.lastChild;a&&3===a.nodeType?(r.appendChild(document.createTextNode(a.textContent)),a.textContent=""):(r.appendChild(document.createTextNode(t.ele.textContent)),t.ele.textContent="")}t.ele.appendChild(r),(0,e.isNullOrUndefined)(i)||t.ele.appendChild(i)}},t.prototype.getModuleName=function(){return"wrapText"},t.prototype.destroy=function(){this.removeEventListener(),this.wrapCell&&(this.wrapCell.remove(),this.wrapCell=null),this.parent=null},t}(),Sh=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.insert=function(e){var t=e.eventArgs;this.parent.notify(qt,t);var n=Fn(this.parent,t.activeSheetIndex);switch(t.modelType){case"Sheet":this.parent.notify(Ei,{startIdx:t.index,endIdx:t.index+(t.model.length-1),preventUpdate:!t.isAction}),this.parent.renderModule.refreshSheet();break;case"Row":if(t.activeSheetIndex===this.parent.activeSheetIndex){var a=this.parent.frozenRowCount(n);if(!this.parent.scrollSettings.enableVirtualization||t.index<=this.parent.viewport.bottomIndex)if(t.freezePane)this.parent.renderModule.refreshSheet(!1,!1,!0);else if(this.parent.scrollSettings.enableVirtualization){var o=this.parent.frozenColCount(n);if(t.index>=this.parent.viewport.topIndex+a){var s=[],l=void 0;o?(l=r(n.topLeftCell)[1],s.push(a),s.push(this.parent.viewport.leftIndex+o)):l=this.parent.viewport.leftIndex;var d=this.parent.viewport.leftIndex;this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:l,refresh:"Row",frozenIndexes:s,skipUpdateOnFirst:this.parent.viewport.topIndex+a===Pr(n,a,!0)}),o&&(this.parent.viewport.leftIndex=d)}var h=r(n.paneTopLeftCell)[0];t.index<h&&(this.parent.notify(ls,{scrollTop:bl(n,a,h-1,!0)}),this.parent.goTo(i(t.index,Pr(n,o,!0,"columns")))),this.parent.selectRange(n.selectedRange)}else this.parent.renderModule.refreshSheet(!1,!1,!0);else!this.parent.scrollSettings.isFinite||this.parent.viewport.topIndex+a!==Pr(n,0,!0)&&this.parent.viewport.bottomIndex!==Pr(n,n.rowCount-t.model.length-1,!1)||this.parent.renderModule.refreshSheet(!1,!1,!0)}break;case"Column":if(t.activeSheetIndex===this.parent.activeSheetIndex){o=this.parent.frozenColCount(n);if(!this.parent.scrollSettings.enableVirtualization||t.index<=this.parent.viewport.rightIndex)if(t.freezePane)this.parent.renderModule.refreshSheet(!1,!1,!0);else if(this.parent.scrollSettings.enableVirtualization){a=this.parent.frozenRowCount(n);if(t.index>=this.parent.viewport.leftIndex+o){s=[];a&&(s=[a+this.parent.viewport.topIndex,o]);var p=a?r(n.topLeftCell)[0]:this.parent.viewport.topIndex,c=this.parent.viewport.topIndex;this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex+o===Pr(n,o,!0,"columns"),rowIndex:p,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:s}),a&&(this.parent.viewport.topIndex=c)}var u=r(n.paneTopLeftCell)[1];t.index<u&&(this.parent.notify(ls,{scrollLeft:Rl(n,0,u-1,!0)}),this.parent.goTo(i(Pr(n,a,!0),t.index))),this.parent.selectRange(n.selectedRange)}else this.parent.renderModule.refreshSheet(!1,!1,!0);else!this.parent.scrollSettings.isFinite||this.parent.viewport.leftIndex+o!==Pr(n,0,!0,"columns")&&this.parent.viewport.rightIndex!==Pr(n,n.colCount-t.model.length-1,!1,"columns")||this.parent.renderModule.refreshSheet(!1,!1,!0)}}this.refreshImgChartElement(t.model.length,this.parent.activeSheetIndex,t.modelType,t.index),t.isAction?(delete t.isAction,this.parent.notify(Pa,e),Md(this.parent.element)):t.isUndoRedo||(t.isMethod=!0,this.parent.notify(G,e))},e.prototype.refreshImgChartElement=function(e,t,r,n){if("Sheet"!==r)for(var i=this.parent.sheets[t],a=i.rows,o=0,s=a.length;o<s;o++){var l=a[o]&&a[o].cells;if(l&&l.length)for(var d=0;d<l.length;d++){var h=zn(o,d,i);if(("Row"===r&&o>=n||"Column"===r&&d>=n)&&(h&&h.image&&h.image.length>0&&this.parent.notify(Do,{rowIdx:o,colIdx:d,sheetIdx:t,type:r,count:e,status:"insert"}),h&&h.chart&&h.chart.length>0))for(var p=0;p<h.chart.length;p++){var c=h.chart[p],u={clientY:Number(tn(c.top).toFixed(2)),isImage:!0},f={clientX:Number(tn(c.left).toFixed(2)),isImage:!0};if(this.parent.notify(cr,u),this.parent.notify(ur,f),o!==u.clientY||d!==f.clientX){var g={prevTop:c.top,prevLeft:c.left,prevRowIdx:o,prevColIdx:d,prevHeight:c.height,prevWidth:c.width,currentTop:c.top,currentLeft:c.left,currentRowIdx:u.clientY,currentColIdx:f.clientX,currentHeight:c.height,currentWidth:c.width,id:c.id,requestType:"chartRefreshOnInit"};this.parent.notify(fr,g)}}}}},e.prototype.addEventListener=function(){this.parent.on(Xe,this.insert,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Xe,this.insert)},e.prototype.getModuleName=function(){return"insert"},e}(),wh=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.delete=function(e){var t=e.eventArgs;if("Sheet"===t.modelType){var n=t.activeSheetIndex>=t.startIndex&&t.activeSheetIndex<=t.endIndex;n&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(t.startIndex<this.parent.sheets.length?t.startIndex:t.startIndex?t.startIndex-1:0)},!0),t.endIndex<t.activeSheetIndex&&this.parent.setProperties({activeSheetIndex:t.activeSheetIndex-(t.endIndex+1-t.startIndex)},!0),this.parent.notify(ri,null),n&&this.parent.renderModule.refreshSheet(!1,!1,!0)}else if(t.activeSheetIndex===this.parent.activeSheetIndex){var i=this.parent.getActiveSheet(),a=this.parent.frozenRowCount(i),o=this.parent.frozenColCount(i);if("Row"===t.modelType){if(!this.parent.scrollSettings.enableVirtualization||t.startIndex<=this.parent.viewport.bottomIndex)if(this.parent.scrollSettings.enableVirtualization)if(t.startIndex<r(i.paneTopLeftCell)[0])this.parent.updateTopLeftCell(Pr(i,t.startIndex-1<a?a:t.startIndex-1,!0)-a,null,"col"),this.parent.renderModule.refreshSheet(!1,!1,!0);else if(t.freezePane||this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex>=Pr(i,i.rowCount-1,!1))this.parent.renderModule.refreshSheet(!1,!1,!0);else{var s=[],l=this.parent.frozenColCount(i),d=void 0,h=this.parent.viewport.leftIndex;l?(s.push(a),s.push(h+l),d=r(i.topLeftCell)[1]):d=h,this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,refresh:"Row",colIndex:d,skipUpdateOnFirst:this.parent.viewport.topIndex+a===Pr(i,a,!0),frozenIndexes:s}),l&&(this.parent.viewport.leftIndex=h),this.parent.selectRange(i.selectedRange)}else this.parent.renderModule.refreshSheet(!1,!1,!0)}else{if(!1!==t.refreshSheet&&(!this.parent.scrollSettings.enableVirtualization||t.startIndex<=this.parent.viewport.rightIndex))if(this.parent.scrollSettings.enableVirtualization)if(t.startIndex<r(i.paneTopLeftCell)[1])this.parent.updateTopLeftCell(null,Pr(i,t.startIndex-1<o?o:t.startIndex-1,!0,"columns")-o,"row"),this.parent.renderModule.refreshSheet(!1,!1,!0);else if(t.freezePane||!0===t.refreshSheet)this.parent.renderModule.refreshSheet(!1,!1,!0);else{var p=this.parent.frozenRowCount(i),c=(s=[],this.parent.viewport.topIndex),u=p?r(i.topLeftCell)[0]:c;p&&(s=[p+c,o]),this.parent.renderModule.refreshUI({rowIndex:u,refresh:"Column",colIndex:this.parent.viewport.leftIndex,insertDelete:!0,skipUpdateOnFirst:this.parent.viewport.leftIndex+o===Pr(i,o,!0,"columns"),frozenIndexes:s}),p&&(this.parent.viewport.topIndex=c),this.parent.selectRange(i.selectedRange)}else this.parent.renderModule.refreshSheet(!1,!1,!0);delete t.refreshSheet}}this.refreshImgChartElement(t.deletedModel.length,this.parent.activeSheetIndex,t.modelType,t.startIndex),t.isAction?(delete t.isAction,this.parent.notify(Pa,e),Md(this.parent.element)):t.isUndoRedo||(t.isMethod=!0,this.parent.notify(G,e))},e.prototype.refreshImgChartElement=function(e,t,r,n){if("Sheet"!==r)for(var i=this.parent.sheets[t],a=i.rows,o=0,s=a.length;o<s;o++){var l=a[o]&&a[o].cells;if(l&&l.length)for(var d=0;d<l.length;d++){var h=zn(o,d,i);if(("Row"===r&&o>=n||"Column"===r&&d>=n)&&(h&&h.image&&h.image.length>0&&this.parent.notify(Do,{rowIdx:o,colIdx:d,sheetIdx:t,type:r,count:e,status:"delete"}),h&&h.chart&&h.chart.length>0))for(var p=0;p<h.chart.length;p++){var c=h.chart[p],u={clientY:Number(tn(c.top).toFixed(2)),isImage:!0},f={clientX:Number(tn(c.left).toFixed(2)),isImage:!0};if(this.parent.notify(cr,u),this.parent.notify(ur,f),o!==u.clientY||d!==f.clientX){var g={prevTop:c.top,prevLeft:c.left,prevRowIdx:o,prevColIdx:d,prevHeight:c.height,prevWidth:c.width,currentTop:c.top,currentLeft:c.left,currentRowIdx:u.clientY,currentColIdx:f.clientX,currentHeight:c.height,currentWidth:c.width,id:c.id,requestType:"chartRefreshOnInit"};this.parent.notify(fr,g)}}}}},e.prototype.addEventListener=function(){this.parent.on(Ke,this.delete,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Ke,this.delete)},e.prototype.getModuleName=function(){return"delete"},e}(),Ih=u(323),Eh=u(741),Nh=u(778),Rh=function(){function n(e){this.divElements=[],this.spanElements=[],this.inputElements=[],this.checkBoxElements=[],this.numericTextBoxElements=[],this.dropDownListElements=[],this.parent=e,this.addEventListener()}return n.prototype.destroy=function(){this.removeEventListener();var t={};if(!this.parent.isDestroyed&&!this.parent.refreshing){var n=r(this.parent.getActiveSheet().activeCell),i=this.parent.getCell(n[0],n[1]);i&&(t={rowIdx:n[0],colIdx:n[1],td:i,isRefresh:!0})}this.removeListDropdownHandler(this.parent.element.querySelector(".e-validation-list"),t);var a=(0,e.select)("#"+this.parent.element.id+"_datavalidation-popup");a&&a.remove(),this.typeData=[],this.operatorData=[],this.dataList&&(this.dataList=null),this.formObj&&(this.formObj.destroy(),this.formObj=null),this.parent=null},n.prototype.addEventListener=function(){e.Browser.isDevice&&"safari"===e.Browser.info.name&&(e.Browser.isIos||e.Browser.isIos7)?e.EventHandler.add(this.parent.element,"touchend",this.listOpen,this):e.EventHandler.add(this.parent.element,"dblclick",this.listOpen,this),this.parent.on(Va,this.initiateDataValidationHandler,this),this.parent.on(_a,this.invalidDataHandler,this),this.parent.on(Je,this.isValidCellHandler,this),this.parent.on(ve,this.listHandler,this),this.parent.on(pi,this.keyUpHandler,this),this.parent.on(ho,this.removeValidationHandler,this),this.parent.on(_t,this.updateHighlightHandler,this),this.parent.on(Ji,this.listValidationHeightHandler,this),this.parent.on(vr,this.addListValidationDropdownHandler,this)},n.prototype.removeEventListener=function(){e.Browser.isDevice&&"safari"===e.Browser.info.name&&(e.Browser.isIos||e.Browser.isIos7)?e.EventHandler.remove(this.parent.element,"touchend",this.listOpen):e.EventHandler.remove(this.parent.element,"dblclick",this.listOpen),this.parent.isDestroyed||(this.parent.off(Va,this.initiateDataValidationHandler),this.parent.off(_a,this.invalidDataHandler),this.parent.off(Je,this.isValidCellHandler),this.parent.off(ve,this.listHandler),this.parent.off(pi,this.keyUpHandler),this.parent.off(ho,this.removeValidationHandler),this.parent.off(_t,this.updateHighlightHandler),this.parent.off(Ji,this.listValidationHeightHandler),this.parent.off(vr,this.addListValidationDropdownHandler))},n.prototype.removeValidationHandler=function(e){var t,r,n={cancel:!1,isColSelected:e.isCol};if(e.range&&e.range.includes("!")){if(r=e.range,!(t=Fn(this.parent,In(this.parent,r.substring(0,r.lastIndexOf("!"))))))return}else if(r=(t=this.parent.getActiveSheet()).name+"!",e.range)r+=e.range;else{var i=this.getRange(t.selectedRange);r+=i.range,n.isColSelected=i.isColSelected}n.range=r,e.isAction&&this.parent.notify(K,{eventArgs:n,action:"removeValidation"}),n.cancel||(this.parent.notify(Qe,{range:r,isRemoveValidation:!0}),e.isAction&&(delete n.cancel,this.parent.notify(Pa,{eventArgs:n,action:"removeValidation"})))},n.prototype.updateNoteIndicator=function(t,r,n){var i=t.querySelector(".e-addNoteIndicator");i&&((0,e.remove)(i),this.parent.notify(ma,{targetElement:t,rowIndex:r,columnIndex:n,skipEvent:!0}))},n.prototype.keyUpHandler=function(t){var r=t.target,n=this.parent.element.querySelector(".e-datavalidation-dlg");if((0,e.closest)(r,".e-values")&&n&&13!==t.keyCode){var i=n.querySelector(".e-values"),a=i.querySelector(".e-dlg-error"),o=n.querySelector(".e-footer-content").querySelector(".e-primary");o.hasAttribute("disabled")&&o.removeAttribute("disabled"),a&&i.removeChild(a)}},n.prototype.listOpen=function(e){var t=e.target;this.listObj&&t.classList.contains("e-cell")&&t.querySelector(".e-validation-list")&&this.parent.isEdit&&this.listObj.showPopup()},n.prototype.invalidDataHandler=function(e){var t,r={range:"",cancel:!1},n=e.isRemoveHighlight?dt:et;!e.isPublic&&(t={eventArgs:r,action:n},this.parent.notify(K,t),r.cancel)||(this.parent.notify(n,{range:r.range,isAction:!0}),e.isPublic||(t.preventAction=!0,this.parent.notify(Pa,t)))},n.prototype.listHandler=function(){var e=this.parent.getActiveSheet(),t=r(e.activeCell),n=zn(t[0],t[1],e),i=this.parent.getCell(t[0],t[1]);if(i){this.removeListDropdownHandler(this.parent.element.getElementsByClassName("e-validation-list")[0]);var a=n&&n.validation||e.columns&&e.columns[t[1]]&&e.columns[t[1]].validation;if(a&&"List"===a.type){if(a.address&&!kr(a.address,t[0],t[1]))return;this.addListValidationDropdownHandler({cell:n,validation:a,td:i,rowIdx:t[0],colIdx:t[1]})}n&&n.validation&&(n.validation=a)}},n.prototype.removeListDropdownHandler=function(t,n){if(t)if(this.listObj&&this.listObj.destroy(),(0,e.remove)(t),n)n.isRefresh&&this.updateNoteIndicator(n.td,n.rowIdx,n.colIdx);else if(!(0,e.isNullOrUndefined)(this.parent.selectionModule.previousActiveCell)){var i=r(this.parent.selectionModule.previousActiveCell),a=this.parent.getCell(i[0],i[1]);a&&this.updateNoteIndicator(a,i[0],i[1])}},n.prototype.addListValidationDropdownHandler=function(t){var r=this;if(t.updatePosition)this.updateTopPosition({ddlCont:t.ddlCont,rowIdx:t.rowIdx,colIdx:t.colIdx});else{var n=t.validation.inCellDropDown;if(t.isRefresh){if(!t.td&&(t.td=this.parent.getCell(t.rowIdx,t.colIdx),!t.td))return;if(this.removeListDropdownHandler(t.td.querySelector(".e-validation-list"),t),"List"!==t.validation.type)return;(0,e.isNullOrUndefined)(n)&&(n=!0)}else(0,e.isNullOrUndefined)(t.validation.ignoreBlank)&&(t.validation.ignoreBlank=!0),(0,e.isNullOrUndefined)(n)&&(n=t.validation.inCellDropDown=!0);if(n){var i,a=this.parent.createElement("div",{className:"e-validation-list"}),o=this.parent.createElement("input",{id:this.parent.element.id+"listValid"});a.appendChild(o);var s=t.td,l=s.getElementsByClassName("e-wrap-content")[0]||s;this.updateTopPosition({ddlCont:a,rowIdx:t.rowIdx,colIdx:t.colIdx}),this.listValidationHeightHandler({ddlCont:a}),l.insertBefore(a,l.firstChild);var d=t.validation.value1;t.cell&&t.cell.validation||!d.startsWith("=")||(d=Br([t.rowIdx,t.colIdx,t.rowIdx,t.colIdx],[0,t.colIdx,0,t.colIdx],this.parent.getActiveSheet(),this.parent,{formula:d}));var h=this.getListDataSource(d);this.listObj=new Nh.DropDownList({index:this.setDropDownListIndex(h,t.cell),dataSource:h,fields:{text:"text",value:"id"},width:"0px",popupHeight:"200px",noRecordsTemplate:"",change:function(){return r.listValueChange(r.listObj.text)},beforeOpen:function(){(i=window.browserDetails.isDevice)&&(window.browserDetails.isDevice=!1)},open:function(e){e.popup.offsetX=r.listObj.enableRtl?3:-s.offsetWidth+(r.parent.enableRtl?4:24),e.popup.offsetY=-(s.querySelector(".e-control-wrapper.e-ddl").offsetHeight-18),e.popup.element.style.width=s.offsetWidth-1+"px",i&&(window.browserDetails.isDevice=!0)},close:function(e){e.event&&(13===e.event.keyCode||e.event.altKey&&38===e.event.keyCode)&&(e.event.preventDefault(),e.event.stopPropagation()),Md(r.parent.element)}}),this.listObj.appendTo(o),this.updateNoteIndicator(s,t.rowIdx,t.colIdx)}}},n.prototype.updateTopPosition=function(e){var t=this.parent.getActiveSheet(),r=zn(e.rowIdx,e.colIdx,t);r&&r.style&&r.style.fontSize&&parseFloat(r.style.fontSize)>11?e.ddlCont.style.top=parseFloat(r.style.fontSize)-11+"pt":e.ddlCont.style.top&&(e.ddlCont.style.top="")},n.prototype.listValidationHeightHandler=function(e){var t=this.parent.getActiveSheet(),n=r(t.activeCell),i=zn(n[0],n[1],t),a=i&&i.validation||t.columns&&t.columns[n[1]]&&t.columns[n[1]].validation;if(a&&"List"===a.type&&a.inCellDropDown){var o=yl(t,n[0],!0)-Fd(n[0],n[1],t);if(o<=18)(s=e.ddlCont||this.parent.element.querySelector(".e-validation-list"))&&(s.style.height=o+"px");else if(!e.ddlCont){var s;(s=this.parent.element.querySelector(".e-validation-list"))&&s.style.removeProperty("height")}}},n.prototype.setDropDownListIndex=function(t,r){if(r&&!(0,e.isNullOrUndefined)(r.value))for(var n=r.value.toString(),i=dn(n),a=i&&(0,e.getNumericObject)(this.parent.locale),o=0,s=t.length;o<s;o++)if(t[o].text===n||i&&this.parseValidationValue(t[o].text,a).toString()===n)return o;return null},n.prototype.getListDataSource=function(e){var r=this,n=[],i=0,a=this.parent.definedNames,o=e,s=o.startsWith("=");if(a.length>0&&s)for(var l=o.split("=")[1],d=0,h=a.length;d<h;d++)if(a[d].name===l){for(var p=a[d].refersTo;p.includes("'");)p=p.replace("'","");o=p}if(s){var c=void 0,u=void 0,f=void 0,g=o.lastIndexOf("!");g>-1?(f=o.substring(1,g),u=o.substring(g+1),f.startsWith("'")&&f.endsWith("'")&&(f=f.substring(1,f.length-1)),c=Fn(this.parent,In(this.parent,f))):(c=this.parent.getActiveSheet(),u=o.substring(1));var m=this.parent.getActiveSheet();if(c){if(c.name!==m.name){var v,y=t(m.selectedRange);c.ranges.forEach((function(e){e.info&&e.info.loadedRange&&e.info.loadedRange.length||(v=!0)})),v&&(this.parent.showSpinner(),gn(this.parent,c.name+"!"+u).then((function(){if(r.parent.hideSpinner(),m.name===r.parent.getActiveSheet().name){var n=t(r.parent.getActiveSheet().selectedRange);if(n[0]===y[0]&&n[1]===y[1]){var i=r.getListDataSource(e);r.listObj.dataSource=i;var a=zn(n[0],n[1],m);r.listObj.index=r.setDropDownListIndex(i,a),r.listObj.dataBind()}}})))}var C=void 0,b=u.split(":");if(b[0]&&b[1]&&(b[0].match(/[a-z]+$/gi)&&b[1].match(/[a-z]+$/gi)||b[0].match(/^[0-9]/g)&&b[1].match(/^[0-9]/g))){var x=this.parent.getIndexes(u);C=x.isCol?[0,x.startIdx,c.usedRange.rowIndex,x.startIdx]:[x.startIdx,0,x.startIdx,c.usedRange.colIndex]}else C=t(u);for(var S=void 0,w=C[0];w<=C[2];w++){c.rows[w]||gl(c,w,{});for(var I=C[1];I<=C[3];I++){c.rows[w].cells||jn(w,I,c,{}),i+=1,S=c.rows[w].cells[I];var E=this.parent.getDisplayText(S)||"";n.push({text:E,id:"list-"+i})}}}}else{var N=this.getListOfValues(o);for(d=0;d<N.length;d++)i+=1,n.push({text:N[d],id:"list-"+i})}return n},n.prototype.listValueChange=function(e){var t=this.parent.getActiveSheet(),r=s(t.activeCell),n=Object.assign({},zn(r[0],r[1],t));if(t.isProtected&&Tr(n,Il(t,r[1])))this.parent.notify(eo,null);else if(Jr(n,Il(t,r[1]),fl(t,r[0])))this.parent.notify(to,null);else{this.parent.isEdit&&this.parent.closeEdit();var i={value:e,oldValue:n.value,address:t.name+"!"+t.activeCell,cancel:!1};if(this.parent.notify(K,{action:"cellSave",eventArgs:i}),i.cancel)return;var a={value:e,formula:""};if(n.format&&Yn(n.format)&&!dn(e)){var o={formattedText:e,value:e,format:"General",cell:{value:e,format:"General"},isEdit:!0};this.parent.notify(re,o),"General"!==o.format&&["Currency","Percentage"].indexOf(zs(o.format))>-1&&(a.format=o.format,a.value=o.value)}if(!Vr(this.parent,t,{cell:a,rowIdx:r[0],colIdx:r[1],valChange:!0,lastCell:!0,checkCF:!0,uiRefresh:!0})){var l=zn(r[0],r[1],t,!1,!0);delete l.formula,this.parent.notify(di,{action:"refreshFormulabar",cell:l}),this.parent.notify(Mt,null),this.parent.notify(Pa,{action:"cellSave",eventArgs:{value:e,oldValue:n.value,address:t.name+"!"+t.activeCell}})}}},n.prototype.getRange=function(e){var r,n=t(e),i=this.parent.getActiveSheet().rowCount;return n[2]===i-1&&0===n[0]&&(e=e.replace(/[0-9]/g,""),r=!0),{range:e,isColSelected:r}},n.prototype.initiateDataValidationHandler=function(){var e,r,n,i,a,o,s,l,d,h,p,c=this,u=this.parent.getActiveSheet(),f=t(u.selectedRange),g=f[0],m=f[1];f[2]>=f[0]?(e=function(){return g<=f[2]},r=function(){g++}):(e=function(){return g>=f[2]},r=function(){g--}),f[3]>=f[1]?(n=function(){return m<=f[3]},i=function(){m++}):(n=function(){return m>=f[3]},i=function(){m--});for(var v=function(e,t){var r;h&&((r=Br(e,t,u,c.parent,{formula:l.value1})).includes("#REF!")||(l.value1=r));p&&((r=Br(e,t,u,c.parent,{formula:l.value2})).includes("#REF!")||(l.value2=r))};e();r()){for(;n();i())if(d=(a=zn(g,m,u,!1,!0)).validation||kl(u.columns[m],g,m)&&u.columns[m].validation)if(l){if(!(d.type===l.type&&d.operator===l.operator&&(h&&wr(d.value1)||d.value1===l.value1)&&(p&&wr(d.value2)||d.value2===l.value2))){o=!0;break}}else{l=Object.assign({},d),h=wr(l.value1),p=wr(l.value2),a.validation||v([g,m,g,m],[0,m,0,m]);var y=t(u.activeCell);g===y[0]&&m===y[1]||v(y,[g,m,g,m])}else s=!0;m=f[1]}var C=this.parent.serviceLocator.getService(Dl),b=this.parent.serviceLocator.getService(Ll),x=function(e){if(!c.parent.element.querySelector(".e-datavalidation-dlg")){var t=c.getRange(u.selectedRange).range;b.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-datavalidation-dlg",header:C.getConstant("DataValidation"),beforeOpen:function(r){var n={dialogName:"ValidationDialog",element:r.element,target:r.target,cancel:r.cancel};c.parent.trigger("dialogBeforeOpen",n),n.cancel?r.cancel=!0:(b.dialogInstance.content=c.dataValidationContent(C,t,e),b.dialogInstance.dataBind(),Md(c.parent.element))},beforeClose:c.dialogBeforeClose.bind(c),buttons:[{buttonModel:{content:C.getConstant("ClearAll"),cssClass:"e-btn e-clearall-btn e-flat"},click:function(){b.dialogInstance.content=c.dataValidationContent(C,t),b.dialogInstance.dataBind()}},{buttonModel:{content:C.getConstant("Apply"),isPrimary:!0},click:function(){c.dlgClickHandler(b)}}]})}};if(o||l&&s){var S,w=[{buttonModel:{isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){b.hide(!0),x()}}];o?(S="MoreValidation",w[0].buttonModel.content=C.getConstant("Ok")):(S="ExtendValidation",w[0].buttonModel.content=C.getConstant("No"),w.splice(0,0,{buttonModel:{content:C.getConstant("Yes"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){b.hide(!0),x(l)}}));var I=C.getConstant(S),E={width:350,isModal:!0,showCloseIcon:!0,cssClass:"e-goto-dlg",header:C.getConstant("Spreadsheet"),content:I,beforeOpen:function(e){var t={dialogName:S,element:e.element,target:e.target,cancel:e.cancel,content:I};c.parent.trigger("dialogBeforeOpen",t),t.cancel?e.cancel=!0:(t.content!==I&&(b.dialogInstance.content=t.content,b.dialogInstance.dataBind()),Md(c.parent.element))},buttons:w};b.show(E)}else x(l)},n.prototype.dataValidationContent=function(t,r,n){var i,a,o,s,l,d=this,h=!n;if(h)i=a="0",l=!0;else{var p=n.value1,c=n.value2;if(o=n.type,s=n.operator,l=!1!==n.ignoreBlank,"Date"===o||"Time"===o){var u=function(e){if(dn(e)){var t={cell:{value:e},type:o.toLowerCase(),value:e};return d.parent.notify(me,t),t.value}return e};i=u(p),a=u(c)}else{var f=function(t){if(dn(t)){t=t.toString();var r=(0,e.getNumericObject)(d.parent.locale);"."!==r.decimal&&t.includes(".")&&(t=t.replace(".",r.decimal))}return t};i=f(p),a=f(c)}}var g=this.parent.createElement("div",{className:"e-validation-dlg"}),m=this.parent.createElement("div",{className:"e-cellrange"}),v=this.parent.createElement("div",{className:"e-allowdata"}),y=this.parent.createElement("div",{className:"e-values"}),C=this.parent.createElement("div",{className:"e-ignoreblank"});this.divElements.push(g),this.divElements.push(m),this.divElements.push(v),this.divElements.push(y),this.divElements.push(C),g.appendChild(m),g.appendChild(v),g.appendChild(y),g.appendChild(C);var b=this.parent.createElement("span",{className:"e-header"});b.innerText=t.getConstant("CellRange");var x=this.parent.createElement("input",{className:"e-input",attrs:{value:r,"aria-label":t.getConstant("CellRange")}});m.appendChild(b),m.appendChild(x);var S=this.parent.createElement("div",{className:"e-allow"}),w=this.parent.createElement("div",{className:"e-data"});v.appendChild(S),v.appendChild(w);var I=this.parent.createElement("span",{className:"e-header"});I.innerText=t.getConstant("Allow"),this.typeData=[{text:t.getConstant("WholeNumber"),id:"type-1"},{text:t.getConstant("Decimal"),id:"type-2"},{text:t.getConstant("Date"),id:"type-3"},{text:t.getConstant("Time"),id:"type-4"},{text:t.getConstant("TextLength"),id:"type-5"},{text:t.getConstant("List"),id:"type-6"},{text:t.getConstant("Custom"),id:"type-7"}],this.operatorData=[{text:t.getConstant("Between"),id:"operator-1"},{text:t.getConstant("NotBetween"),id:"operator-2"},{text:t.getConstant("EqualTo"),id:"operator-3"},{text:t.getConstant("NotEqualTo"),id:"operator-4"},{text:t.getConstant("GreaterThan"),id:"operator-5"},{text:t.getConstant("LessThan"),id:"operator-6"},{text:t.getConstant("GreaterThanOrEqualTo"),id:"operator-7"},{text:t.getConstant("LessThanOrEqualTo"),id:"operator-8"}];var E=this.parent.createElement("input",{className:"e-select"});this.spanElements.push(b),this.inputElements.push(x),this.divElements.push(S),this.divElements.push(w),this.spanElements.push(I),this.inputElements.push(E);var N=0;if(!h){o&&(o=this.formattedType(o));for(var R=0;R<this.typeData.length;R++)if(o===this.formattedType(this.typeData[R].text)){N=R;break}}if(h||"List"!==o&&"Custom"!==o){var A=0,k=this.parent.createElement("span",{className:"e-header"});k.innerText=t.getConstant("Data");var O=this.parent.createElement("input",{className:"e-select"});if(!h)for(R=0;R<this.operatorData.length;R++)if(s===this.formattedValue(this.operatorData[R].text)){A=R;break}w.appendChild(k),w.appendChild(O),this.spanElements.push(k),this.inputElements.push(O),this.dataList=new Nh.DropDownList({dataSource:this.operatorData,index:A,popupHeight:"200px",change:this.userInput.bind(this)}),this.dropDownListElements.push(this.dataList),this.dataList.appendTo(O)}else if("Custom"!==o){var F=this.parent.createElement("input",{className:"e-checkbox"});w.appendChild(F);var T=new Eh.CheckBox({label:t.getConstant("InCellDropDown"),checked:!1!==n.inCellDropDown});this.checkBoxElements.push(T),T.appendTo(F),this.inputElements.push(F)}S.appendChild(I),S.appendChild(E),this.typeList=new Nh.DropDownList({dataSource:this.typeData,index:N,popupHeight:"200px",change:this.userInput.bind(this)}),this.dropDownListElements.push(this.typeList),this.typeList.appendTo(E);var D=function(e,t){var r=d.parent.createElement("span",{className:"e-header"});r.innerText=e;var n=d.parent.createElement("input",{className:"e-input",attrs:{value:t}});y.appendChild(r),y.appendChild(n),d.spanElements.push(r),d.inputElements.push(n)};if(h||this.typeList.value!==t.getConstant("List")&&this.typeList.value!==t.getConstant("Custom")&&(this.dataList.value===t.getConstant("Between")||this.dataList.value===t.getConstant("NotBetween"))){var L=this.parent.createElement("div",{className:"e-minimum"}),P=this.parent.createElement("div",{className:"e-maximum"});y.appendChild(L),y.appendChild(P);var M=this.parent.createElement("span",{className:"e-header"});M.innerText=t.getConstant("Minimum");var B=this.parent.createElement("span",{className:"e-header"});B.innerText=t.getConstant("Maximum");var H=this.parent.createElement("input",{id:"minvalue",className:"e-input",attrs:{value:i,"aria-label":t.getConstant("Minimum")}}),U=this.parent.createElement("input",{id:"maxvalue",className:"e-input",attrs:{value:a,"aria-label":t.getConstant("Maximum")}});L.appendChild(M),L.appendChild(H),P.appendChild(B),P.appendChild(U),this.divElements.push(L),this.divElements.push(P),this.spanElements.push(M),this.spanElements.push(B),this.inputElements.push(H),this.inputElements.push(U);var V=new Ih.NumericTextBox({value:0});this.numericTextBoxElements.push(V),V.appendTo("#minvalue");var z=new Ih.NumericTextBox({value:0});this.numericTextBoxElements.push(z),z.appendTo("#maxvalue")}else D(h||"List"!==o?h||"Custom"!==o?t.getConstant("Value"):t.getConstant("Formula"):t.getConstant("Sources"),i);var j=this.parent.createElement("input",{className:"e-checkbox"});C.appendChild(j);var _=new Eh.CheckBox({label:t.getConstant("IgnoreBlank"),checked:l});return this.checkBoxElements.push(_),_.appendTo(j),this.inputElements.push(j),g},n.prototype.dialogBeforeClose=function(){this.checkBoxElements.forEach((function(e){e&&e.element&&(e.destroy(),e.element.remove())})),this.checkBoxElements=[],this.numericTextBoxElements.forEach((function(e){e&&e.element&&(e.destroy(),e.element.remove())})),this.numericTextBoxElements=[],this.dropDownListElements.forEach((function(e){e&&e.element&&(e.destroy(),e.element.remove())})),this.dropDownListElements=[],Kd(this.spanElements),this.spanElements=[],Kd(this.inputElements),this.inputElements=[],Kd(this.divElements),this.divElements=[]},n.prototype.userInput=function(){var e=this.typeList,t=this.dataList,r=this.parent.element.querySelector(".e-datavalidation-dlg").querySelector(".e-validation-dlg"),n=r.querySelector(".e-allowdata"),i=r.querySelector(".e-values"),a=this.parent.serviceLocator.getService(Dl),o=n.querySelector(".e-data"),s=function(e){for(;e.lastChild;)e.removeChild(e.lastChild)};if(s(i),e.value===a.getConstant("List")){s(o);var l=this.parent.createElement("input",{className:"e-checkbox"});this.inputElements.push(l),o.appendChild(l);var d=new Eh.CheckBox({label:a.getConstant("InCellDropDown"),checked:!0});this.checkBoxElements.push(d),d.appendTo(l)}else if(e.value===a.getConstant("Custom"))s(o);else if(!o.childElementCount||o.getElementsByClassName("e-checkbox-wrapper")[0]){s(o);var h=this.parent.createElement("span",{className:"e-header"});h.innerText=a.getConstant("Data");var p=this.parent.createElement("input",{className:"e-select"});this.spanElements.push(h),this.inputElements.push(p),o.appendChild(h),o.appendChild(p),t.appendTo(p)}if(e.value===a.getConstant("List")||e.value===a.getConstant("Custom")||t.value!==a.getConstant("Between")&&t.value!==a.getConstant("NotBetween")){var c=this.parent.createElement("span",{className:"e-header"});c.innerText=e.value===a.getConstant("List")?a.getConstant("Sources"):e.value===a.getConstant("Custom")?a.getConstant("Formula"):a.getConstant("Value");var u=e.value===a.getConstant("List")?this.parent.createElement("input",{className:"e-input",attrs:{placeholder:"Enter value"}}):this.parent.createElement("input",{className:"e-input",attrs:{value:"0"}});this.spanElements.push(c),this.inputElements.push(u),i.appendChild(c),i.appendChild(u)}else{var f=this.parent.createElement("div",{className:"e-minimum"}),g=this.parent.createElement("div",{className:"e-maximum"});this.divElements.push(f),this.divElements.push(g),i.appendChild(f),i.appendChild(g);var m=this.parent.createElement("span",{className:"e-header"});m.innerText=a.getConstant("Minimum");var v=this.parent.createElement("span",{className:"e-header"});v.innerText=a.getConstant("Maximum");var y=this.parent.createElement("input",{id:"min",className:"e-input",attrs:{value:"0"}}),C=this.parent.createElement("input",{id:"max",className:"e-input",attrs:{value:"0"}});this.spanElements.push(m),this.spanElements.push(v),this.inputElements.push(y),this.inputElements.push(C);var b=new Ih.NumericTextBox({value:0});this.numericTextBoxElements.push(b),b.appendTo("min");var x=new Ih.NumericTextBox({value:0});this.numericTextBoxElements.push(x),x.appendTo("max"),f.appendChild(m),f.appendChild(y),g.appendChild(v),g.appendChild(C)}},n.prototype.dlgClickHandler=function(r){var n,i=this,a=this.parent.serviceLocator.getService(Dl),o=this.parent.element.querySelector(".e-datavalidation-dlg"),s=o.querySelector(".e-footer-content"),l=o.getElementsByClassName("e-dlg-content")[0].getElementsByClassName("e-validation-dlg")[0],d=l.getElementsByClassName("e-allowdata")[0],h=d.getElementsByClassName("e-allow")[0].getElementsByTagName("input")[0],p=d.getElementsByClassName("e-data")[0].getElementsByTagName("input")[0],u=l.getElementsByClassName("e-values")[0],f=[];f[0]=u.getElementsByTagName("input")[0].value,f[1]=u.getElementsByTagName("input")[1]?u.getElementsByTagName("input")[1].value:"";var g,m=this.formattedType(h.value),v=!0,y=l.querySelector(".e-ignoreblank .e-checkbox").checked,C=d.querySelector(".e-data").querySelector(".e-checkbox-wrapper")?!!d.querySelector(".e-data").querySelector(".e-checkbox-wrapper").querySelector(".e-check"):null,b=l.querySelector(".e-cellrange").getElementsByTagName("input")[0].value;p&&(g=this.formattedValue(p.value));var x=[];if("List"===m)if(""!==f[0]&&x.push(f[0]),f[0].startsWith("=")){var S=f[0].substring(1),w=this.parent.definedNames.find((function(e){return e.name===S}));w&&(S=w.refersTo.substring(1));var I=void 0,E=void 0;if(S.includes("!")){E=S.lastIndexOf("!");var N=S.substring(0,E);S=S.substring(E+1),N.startsWith("'")&&N.endsWith("'")&&(N=N.substring(1,N.length-1)),I=In(this.parent,N)>-1,w||(x[0]="="+N+"!"+S)}else I=!0;!S.includes(":")&&Ir(S)&&(S=S+":"+S);var R=void 0;if(I){var A=S.split(":");2===A.length&&(R=S.match(/[a-z]/gi)&&A[0].replace(/[0-9]/g,"")===A[1].replace(/[0-9]/g,"")||S.match(/\d/g)&&A[0].replace(/\D/g,"")===A[1].replace(/\D/g,""))}(v=R)||(n=w||void 0!==E||S.includes(":")?a.getConstant("DialogError"):a.getConstant("NamedRangeError"))}else f[0].length>256&&(v=!1,n=a.getConstant("ListLengthError"));else{var k=(0,e.getNumericObject)(this.parent.locale);if("Decimal"===m&&"."!==k.decimal){var O=function(e){return dn(e)&&e.includes(".")&&("."!==k.group||!xr(e,i.parent.locale,k.group,k.decimal))};(O(f[0])||O(f[1]))&&(v=!1,n=a.getConstant("InvalidNumberError"))}Gr(f,this.parent,k),""!==f[0]&&x.push(f[0]),""!==f[1]&&x.push(f[1])}if(v){var F=this.parent.getActiveSheet(),T=this.isDialogValidator(x,m,g);if("Between"===g&&T.isValid&&!isNaN(parseFloat(x[0]))&&!isNaN(parseFloat(x[1]))&&parseFloat(x[0])>parseFloat(x[1])&&(T.isValid=!1,T.errorMsg=a.getConstant("MinMaxError")),"Custom"===m&&wr(x[0])){var D={value:x[0]};this.parent.notify(pr,D),["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!","#CALC!"].indexOf(D.value)>-1&&(T.isValid=!1,T.errorMsg=a.getConstant("InvalidFormula"))}if(n=T.errorMsg,v=T.isValid){if(Qr(this.parent,c(t(b))))return r.hide(!0),void this.parent.notify(to,null);var L={range:F.name+"!"+b,value1:x[0],value2:x[1]||"",ignoreBlank:y,type:m,operator:g,inCellDropDown:C,cancel:!1};this.parent.notify(K,{eventArgs:L,action:"validation"}),L.cancel||(this.parent.notify(Qe,{rules:{type:L.type,operator:L.operator,value1:L.value1,value2:L.value2,ignoreBlank:L.ignoreBlank,inCellDropDown:L.inCellDropDown},range:L.range,isAction:!0}),delete L.cancel,this.parent.element.getElementsByClassName("e-validation-error-dlg")[0]||(r.dialogInstance?r.dialogInstance.hide():r.hide()),this.parent.notify(Pa,{eventArgs:L,action:"validation"}))}}if(!v){var P=this.parent.createElement("div",{className:"e-dlg-error",id:"e-invalid"});P.innerText=n,u.appendChild(P),s.querySelector(".e-primary").setAttribute("disabled","true")}},n.prototype.formattedValue=function(e){var t=this.parent.serviceLocator.getService(Dl);switch(e){case t.getConstant("Between"):e="Between";break;case t.getConstant("NotBetween"):e="NotBetween";break;case t.getConstant("EqualTo"):e="EqualTo";break;case t.getConstant("NotEqualTo"):e="NotEqualTo";break;case t.getConstant("GreaterThan"):e="GreaterThan";break;case t.getConstant("LessThan"):e="LessThan";break;case t.getConstant("GreaterThanOrEqualTo"):e="GreaterThanOrEqualTo";break;case t.getConstant("LessThanOrEqualTo"):e="LessThanOrEqualTo";break;default:e="Between"}return e},n.prototype.formattedType=function(e){var t=this.parent.serviceLocator.getService(Dl);switch(e){case t.getConstant("WholeNumber"):e="WholeNumber";break;case t.getConstant("Decimal"):e="Decimal";break;case t.getConstant("Date"):e="Date";break;case t.getConstant("TextLength"):e="TextLength";break;case t.getConstant("List"):e="List";break;case t.getConstant("Time"):e="Time";break;case t.getConstant("Custom"):e="Custom"}return e},n.prototype.isDialogValidator=function(e,t,r){var n,i=this.parent.serviceLocator.getService(Dl),a=0;if("List"===t?!(e.length>0):"Between"===r||"NotBetween"===r?2!==e.length:!(e.length>0))return{isValid:!1,errorMsg:i.getConstant("EmptyError")};for(var o=void 0,s=0;s<e.length;s++){if(wr(e[s])){var l={value:e[s]};this.parent.notify(pr,l),o=l.value}else o="Date"===t||"Time"===t?e[s]=this.getDateAsNumber({range:[],cell:{value:e[s]}},e[s]):e[s];if(!(n=this.formatValidation(o,t,!0)).isValid)break;a+=1}return n.isValid=a===e.length,n},n.prototype.getDateAsNumber=function(e,t){var r={value:t,rowIndex:e.range[0],cell:e.cell,colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""};return this.parent.notify(ue,r),r.updatedVal||t},n.prototype.getListOfValues=function(e){return","!==this.parent.listSeparator&&e.includes(this.parent.listSeparator)?e.split(this.parent.listSeparator):e.split(",")},n.prototype.checkValidationHandler=function(t,r){var n=t.value.toString(),i=this.parent.sheets[t.sheetIdx],a=zn(t.range[0],t.range[1],i,null,!0),o=r.value1,s=r.value2;if(!a.validation){var l=t.range,d=[0,t.range[1],0,t.range[3]];wr(o)&&(o=Br(l,d,i,this.parent,{formula:o})),wr(s)&&(s=Br(l,d,i,this.parent,{formula:s}))}if("List"!==r.type){if(wr(o)){var h={value:o};this.parent.notify(pr,h),o=h.value}if(wr(s)){var p={value:s};this.parent.notify(pr,p),s=p.value}if(wr(t.value)){var c={value:t.value};this.parent.notify(pr,c),t.value=c.value}}var u=t.value,f=r.operator||"Between",g=r.type||"WholeNumber",m=!!(0,e.isNullOrUndefined)(r.ignoreBlank)||r.ignoreBlank;if(m&&""===n)return!0;var v="Date"===g||"Time"===g;if(t.value)if(v||"TextLength"===r.type)dn(t.value)||(u=t.value=this.getDateAsNumber(t,t.value));else{var y=t.isEdit&&(0,e.getNumericObject)(this.parent.locale);(N=this.parseValidationValue(t.value,y))!==t.value&&dn(N)&&(u=t.value=N.toString())}var C=this.formatValidation(t.value,g).isValid;if(C)if(C=!1,v?(o&&!dn(o)&&(o=this.getDateAsNumber(t,o)),s&&!dn(s)&&(s=this.getDateAsNumber(t,s))):"TextLength"===r.type&&(u=t.value.toString().length.toString()),"List"===g){var b=t.value.toString(),x=dn(b);y=x&&(0,e.getNumericObject)(this.parent.locale);if(o.startsWith("=")){for(var S=void 0,w=this.getListDataSource(o),I=0;I<w.length;I++)if(n===(S=w[I].text.toString())||b===S||x&&b===this.parseValidationValue(S,y).toString()){C=!0;break}}else{var E=this.getListOfValues(o);for(I=0;I<E.length;I++)if(n===E[I]||b===E[I]||x&&b===this.parseValidationValue(E[I],y).toString()){C=!0;break}}!C&&m&&""===b&&(C=!0)}else if("Custom"===g){var N;if(dn(N=parseFloat(o.toString())))if(0===N){var R={value:r.value1};this.parent.notify(hr,R),C=""===R.value}else C=!0;else C="TRUE"===o.toUpperCase();!C&&m&&""===o&&(C=!0)}else switch("Decimal"===g||"Time"===g?(u=parseFloat(u.toString()),o=parseFloat(o.toString()),s=s?parseFloat(s.toString()):null):(u=parseInt(u.toString(),10),o=parseInt(o.toString(),10),s=s?parseInt(s.toString(),10):null),f){case"EqualTo":C=u===o;break;case"NotEqualTo":C=u!==o;break;case"Between":C=u>=o&&u<=s;break;case"NotBetween":C=!(u>=o&&u<=s);break;case"GreaterThan":C=u>o;break;case"LessThan":C=u<o;break;case"GreaterThanOrEqualTo":C=u>=o;break;case"LessThanOrEqualTo":C=u<=o}return C},n.prototype.parseValidationValue=function(e,t){if(dn(e))return t&&"."===t.group&&(e=e.toString()).indexOf(".")&&xr(e,this.parent.locale,t.group,t.decimal)&&(e=e.split(t.group).join("")),e;var r={formattedText:e,value:e,format:"General",cell:{value:e,format:"General"},isEdit:!!t};return this.parent.notify(re,r),r.value},n.prototype.isValidCellHandler=function(t){var r=this.parent.sheets[t.sheetIdx],n=zn(t.range[0],t.range[1],r),i={skip:!1,value:""},a=n&&n.validation;if(a){if(wr(a.value1)&&!Ir(a.value1.substring(1,a.value1.length))&&a.value1.indexOf("(")>-1){var o=a.value1;o=o.substring(o.indexOf("=")+1,o.indexOf("(")),i.value=o.toUpperCase(),this.parent.notify(Ae,i)}if(!i.skip&&wr(a.value2)&&!Ir(a.value2.substring(1,a.value2.length))&&a.value1.indexOf("(")>-1){var s=a.value2;s=s.substring(s.indexOf("=")+1,s.indexOf("(")),i.value=s.toUpperCase(),this.parent.notify(Ae,i)}}if(!i.skip&&(t.value=(0,e.isNullOrUndefined)(t.value)?"":t.value,a?(t.isValid=this.checkValidationHandler(t,a),t.isValid&&kl(r.columns[t.range[1]],t.range[0],t.range[1])&&(a=r.columns[t.range[1]].validation,t.isValid=this.checkValidationHandler(t,a))):kl(r.columns[t.range[1]],t.range[0],t.range[1])&&(a=r.columns[t.range[1]].validation,t.isValid=this.checkValidationHandler(t,a)),a)){var l=void 0;t.isEdit&&!t.isValid&&(t.isValid=l=this.validationErrorHandler(this.parent.serviceLocator.getService(Dl).getConstant("ValidationError"))),t.isValid&&a.isHighlighted&&!ml(r,t.range[0])&&!Al(r,t.range[1])&&this.updateHighlightHandler({rowIdx:t.range[0],colIdx:t.range[1],isRemoveHighlightedData:!l,isRemoveValidation:!0})}},n.prototype.formatValidation=function(e,t,r){var n,i,a=this.parent.element.getElementsByClassName("e-sheet-panel")[0],o=this.parent.createElement("form",{id:"formId",className:"form-horizontal"}),s=this.parent.createElement("input",{id:"e-validation"});if(s.setAttribute("name","validation"),s.setAttribute("type","text"),"Date"===t&&dn(e)){var l=e.toString().split(".");2===l.length&&(e=l[0])}switch(s.setAttribute("value",e),o.appendChild(s),a.appendChild(o),t){case"Date":i={rules:{validation:{date:!0}},customPlacement:function(e,t){n=t.innerText}};break;case"Decimal":i={rules:{validation:{number:!0}},customPlacement:function(e,t){n=t.innerText}};break;case"WholeNumber":i={rules:{validation:{regex:/^-?\d*\.?[0]*$/}},customPlacement:function(e,t){n=t.innerText}};break;case"TextLength":r&&(i={rules:{validation:{regex:/^\d*\.?[0]*$/}},customPlacement:function(e,t){n=t.innerText}})}this.formObj=new Ih.FormValidator("#formId",i);var d=this.formObj.validate();return a.removeChild(a.getElementsByClassName("form-horizontal")[0]),{isValid:d,errorMsg:n}},n.prototype.updateHighlightHandler=function(e){var t;if(!e.isRemoveValidation){var r=e.cell.value||0===e.cell.value?e.cell.value:e.cell.hyperlink?"string"==typeof e.cell.hyperlink?e.cell.hyperlink:e.cell.hyperlink.address||"":"",n={value:r,range:[e.rowIdx,e.colIdx],sheetIdx:this.parent.activeSheetIndex};(t=this.checkValidationHandler(n,e.validation))&&e.col&&kl(e.col,e.rowIdx,e.colIdx)&&(n.value=r,t=this.checkValidationHandler(n,e.col.validation))}if(t){if(e.removeOnValidData){var i=this.parent.getCell(e.rowIdx,e.colIdx);i&&i.style.backgroundColor&&(e.td=i,e.style=this.parent.getCellStyleValue(["backgroundColor","color"],[e.rowIdx,e.colIdx]),this.parent.notify(le,e),e.td=null)}}else e.isRemoveHighlightedData?(e.style=this.parent.getCellStyleValue(["backgroundColor","color"],[e.rowIdx,e.colIdx]),this.parent.notify(le,e)):(e.style={backgroundColor:"#ffff00",color:"#ff0000"},this.parent.notify(le,e))},n.prototype.validationErrorHandler=function(e){var t=this,r=this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0],n=this.parent.serviceLocator.getService(Dl),i=!1;if(!this.parent.element.querySelector(".e-validation-error-dlg")){var a=this.parent.serviceLocator.getService(Ll),o={width:400,height:200,isModal:!0,showCloseIcon:!0,cssClass:"e-validation-error-dlg",target:document.getElementById(this.parent.element.id)||this.parent.element,beforeOpen:function(n){var o={dialogName:"ValidationErrorDialog",element:n.element,target:n.target,cancel:n.cancel,content:e};t.parent.trigger("dialogBeforeOpen",o),o.cancel&&(n.cancel=!0,i=!0),r.focus(),a.dialogInstance.content=o.content,a.dialogInstance.dataBind()},buttons:[{buttonModel:{content:n.getConstant("Retry"),isPrimary:!0},click:function(){t.errorDlgHandler(a,"Retry")}},{buttonModel:{content:n.getConstant("Cancel")},click:function(){t.errorDlgHandler(a,"Cancel")}}]};a.show(o,!1)}return i},n.prototype.errorDlgHandler=function(e,t){if("Retry"===t){var n=this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0];e.hide(),n.innerText&&(window.getSelection().selectAllChildren(n),this.listObj&&!this.listObj.isDestroyed&&this.listObj.showPopup())}else{var i=r(this.parent.getActiveSheet().activeCell),a=zn(i[0],i[1],this.parent.getActiveSheet()),o=a?this.parent.getDisplayText(a):"";this.parent.notify(si,{action:"cancelEdit",value:o,refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!1,trigEvent:!0}),e.hide()}},n.prototype.getModuleName=function(){return"dataValidation"},n}(),Ah=u(90),kh=function(){function r(e){this.parent=e,this.init()}return r.prototype.init=function(){this.addEventListener()},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.addEventListener=function(){this.parent.on(Ga,this.protect,this),this.parent.on(Wa,this.protectSheetHandler,this),this.parent.on(eo,this.editProtectedAlert,this),this.parent.on(qo,this.protectWorkbook,this),this.parent.on(pi,this.KeyUpHandler,this),this.parent.on(Wo,this.unProtectWorkbook,this),this.parent.on(as,this.unProtectSheetPassword,this),this.parent.on(Xo,this.importProtectWorkbook,this),this.parent.on(Go,this.protectWorkbookHandler,this),this.parent.on(Yo,this.removeWorkbookProtection,this),this.parent.on(cs,this.toggleProtect,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ga,this.protect),this.parent.off(Wa,this.protectSheetHandler),this.parent.off(eo,this.editProtectedAlert),this.parent.off(qo,this.protectWorkbook),this.parent.off(pi,this.KeyUpHandler),this.parent.off(Wo,this.unProtectWorkbook),this.parent.off(as,this.unProtectSheetPassword),this.parent.off(Xo,this.importProtectWorkbook),this.parent.off(Go,this.protectWorkbookHandler),this.parent.off(Yo,this.removeWorkbookProtection),this.parent.off(cs,this.toggleProtect))},r.prototype.protect=function(e){if(e.isActive){var t=this.parent.getActiveSheet();t.isImportProtected&&(t.isImportProtected=!1)}this.parent.notify(Bi,null),e.isActive?(this.parent.setSheetPropertyOnMute(Fn(this.parent,e.sheetIndex),"isProtected",!1),this.parent.notify(la,{props:"Protect"}),this.parent.notify(Wa,e),this.parent.notify(ao,null)):this.createDialogue()},r.prototype.createDialogue=function(){var t=this,r=this.parent.serviceLocator.getService(Dl),n=[{text:r.getConstant("SelectCells"),id:"1"},{text:r.getConstant("SelectUnlockedCells"),id:"6"},{text:r.getConstant("FormatCells"),id:"2"},{text:r.getConstant("FormatRows"),id:"3"},{text:r.getConstant("FormatColumns"),id:"4"},{text:r.getConstant("InsertLinks"),id:"5"}];this.optionList=new Ah.ListView({dataSource:n,showCheckBox:!0,select:this.dialogOpen.bind(this)});var i=this.parent.createElement("div",{className:"e-sheet-password-dialog"}),a=this.parent.createElement("div",{className:"e-sheet-password-content"}),o=this.parent.createElement("div",{className:"e-header"});o.innerText=r.getConstant("SheetPassword");var s=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});s.setAttribute("placeholder",r.getConstant("EnterThePassword")),a.appendChild(s),a.insertBefore(o,s),i.appendChild(a);var l=this.parent.createElement("div",{className:"e-protect-content"});l.innerText=r.getConstant("ProtectAllowUser"),this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!1);var d=new Eh.CheckBox({checked:!0,label:r.getConstant("ProtectContent"),cssClass:"e-protect-checkbox"}),h=this.parent.createElement("div",{className:"e-protect-option-list",id:this.parent.element.id+"_option_list"}),p=this.parent.createElement("div",{className:"e-header-content"});p.innerText=r.getConstant("ProtectSheet");var c,u=this.parent.createElement("input",{id:this.parent.element.id+"_protect_check",attrs:{type:"checkbox"}}),f=this.parent.serviceLocator.getService("dialog"),g=function(){var r=(0,e.getInstance)(document.getElementById(t.parent.element.id+"_protect_check"),Eh.CheckBox);f.dialogInstance.element.querySelector(".e-footer-content .e-btn.e-primary").disabled=!r.checked};f.show({header:p.outerHTML,content:i.outerHTML+u.outerHTML+l.outerHTML+h.outerHTML,showCloseIcon:!0,isModal:!0,cssClass:"e-protect-dlg",beforeOpen:function(e){var r={dialogName:"ProtectSheetDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel?c=e.cancel=!0:Md(t.parent.element)},beforeClose:function(){c||e.EventHandler.remove(d.element,"click",g)},buttons:[{click:this.selectOption.bind(this,f),buttonModel:{content:r.getConstant("Ok"),isPrimary:!0}},{click:function(){return f.hide()},buttonModel:{content:r.getConstant("Cancel")}}]},!1),c||(d.appendTo("#"+this.parent.element.id+"_protect_check"),this.optionList.appendTo("#"+this.parent.element.id+"_option_list"),this.optionList.selectMultipleItems([{id:"1"},{id:"6"}]),e.EventHandler.add(d.element,"click",g,this))},r.prototype.dialogOpen=function(e){var t=this.parent.serviceLocator.getService(Dl);e.text===t.getConstant("SelectCells")&&e.isChecked&&e.isInteracted&&this.optionList.checkItem({id:"6"}),e.text===t.getConstant("SelectUnlockedCells")&&!e.isChecked&&e.isInteracted&&this.optionList.uncheckItem({id:"1"})},r.prototype.selectOption=function(e){var r=e.dialogInstance.element.querySelector(".e-sheet-password-content .e-input").value;if(r)this.reEnterSheetPassword(r);else{var n=this.parent.getActiveSheet();this.parent.setSheetPropertyOnMute(n,"isProtected",!0),this.parent.setSheetPropertyOnMute(n,"password",r),this.updateProtectSheet(r),e.hide(),n.protectSettings.selectCells||n.protectSettings.selectUnLockedCells?n.protectSettings.selectUnLockedCells&&Bd(this.parent,t(n.selectedRange))&&this.parent.notify(is,null):this.parent.notify(is,null)}},r.prototype.applySheetPwd=function(e){var t=this.parent.getActiveSheet();this.parent.setSheetPropertyOnMute(t,"isProtected",!0),this.parent.setSheetPropertyOnMute(t,"password",e),this.updateProtectSheet(e),t.protectSettings.selectCells||t.protectSettings.selectUnLockedCells||this.parent.notify(is,null)},r.prototype.updateProtectSheet=function(e){var t=this.parent.serviceLocator.getService(Dl),r=this.optionList.getSelectedItems(),n={selectCells:r.text.indexOf(t.getConstant("SelectCells"))>-1,formatCells:r.text.indexOf(t.getConstant("FormatCells"))>-1,formatRows:r.text.indexOf(t.getConstant("FormatRows"))>-1,formatColumns:r.text.indexOf(t.getConstant("FormatColumns"))>-1,insertLink:r.text.indexOf(t.getConstant("InsertLinks"))>-1,selectUnLockedCells:r.text.indexOf(t.getConstant("SelectUnlockedCells"))>-1};this.parent.notify(gt,{protectSettings:n,password:e,triggerEvent:!0}),this.parent.notify(ao,null),this.parent.notify(Ra,null)},r.prototype.protectSheetHandler=function(r){var n=(0,e.isNullOrUndefined)(r&&r.sheetIndex)?this.parent.activeSheetIndex:r.sheetIndex,i=Fn(this.parent,n),a=this.parent.element.id,o=[a+"_undo",a+"_redo",a+"_cut",a+"_copy",a+"_paste",a+"_number_format",a+"_font_name",a+"_font_size",a+"_bold",a+"_italic",a+"_line-through",a+"_underline",a+"_font_color_picker",a+"_fill_color_picker",a+"_borders",a+"_merge_cells",a+"_text_align",a+"_vertical_align",a+"_wrap",a+"_sorting",a+"_clear",a+"_conditionalformatting"],s=[a+"_cut",a+"_copy",a+"_number_format",a+"_font_name",a+"_font_size",a+"_bold",a+"_italic",a+"_line-through",a+"_underline",a+"_font_color_picker",a+"_fill_color_picker",a+"_borders",a+"_text_align",a+"_vertical_align",a+"_wrap",a+"_sorting",a+"_clear",a+"_conditionalformatting"],l=[a+"_insert_function"],d=[a+"_hyperlink",a+"_",a+"_chart"],h=[a+"_image"],p=[a+"_find"],c=[a+"_datavalidation"],u=[a+"_chart"],f=document.getElementById(this.parent.element.id+"_sheet_panel");f&&(i.isProtected&&(i.protectSettings.selectCells||i.protectSettings.selectUnLockedCells&&!Bd(this.parent,t(i.selectedRange)))?f.classList.remove("e-protected"):f.classList.add("e-protected"),i.isProtected||f.classList.remove("e-protected")),this.parent.dataBind(),this.parent.notify(Xa,{disableHomeBtnId:o,enableHomeBtnId:s,enableFrmlaBtnId:l,enableInsertBtnId:d,findBtnId:p,dataValidationBtnId:c,imageBtnId:h,chartBtnId:u}),this.parent.notify(io,null),i.isProtected&&this.parent.notify(la,{props:"Protect"}),r&&r.triggerEvent&&this.parent.notify(Pa,{action:"protectSheet",eventArgs:{sheetIndex:n,isProtected:i.isProtected,password:i.password,protectSettings:i.protectSettings.properties||i.protectSettings}})},r.prototype.editProtectedAlert=function(){var e=this,t=this.parent.serviceLocator.getService(Dl),r=this.parent.serviceLocator.getService("dialog");r.show({content:t.getConstant("EditAlert"),isModal:!0,closeOnEscape:!0,showCloseIcon:!0,width:"400px",cssClass:"e-editAlert-dlg",beforeOpen:function(n){var i={dialogName:"EditAlertDialog",content:t.getConstant("EditAlert"),element:n.element,target:n.target,cancel:n.cancel};e.parent.trigger("dialogBeforeOpen",i),i.cancel?n.cancel=!0:(r.dialogInstance.content=i.content,Md(e.parent.element))},close:function(){return Md(e.parent.element)}})},r.prototype.protectWorkbook=function(){var e=this,t=this.parent.serviceLocator.getService(Dl),r=this.parent.serviceLocator.getService(Ll);r.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-protectworkbook-dlg",header:t.getConstant("ProtectWorkbook"),beforeOpen:function(t){var n={dialogName:"ProtectWorkbook",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel?t.cancel=!0:(r.dialogInstance.content=e.passwordProtectContent(),r.dialogInstance.dataBind(),Md(e.parent.element))},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){e.alertMessage(),e.dlgClickHandler(r)}}]})},r.prototype.passwordProtectContent=function(){var e=this.parent.serviceLocator.getService(Dl),t=this.parent.createElement("div",{className:"e-password-dialog"}),r=this.parent.createElement("div",{className:"e-password-content"}),n=this.parent.createElement("div",{className:"e-password-content"}),i=this.parent.createElement("div",{className:"e-header"});i.innerText=e.getConstant("Password");var a=this.parent.createElement("div",{className:"e-header"});a.innerText=e.getConstant("ConfirmPassword");var o=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}}),s=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return o.setAttribute("placeholder",e.getConstant("EnterThePassword")),s.setAttribute("placeholder",e.getConstant("EnterTheConfirmPassword")),r.appendChild(o),r.insertBefore(i,o),n.appendChild(s),n.insertBefore(a,s),t.appendChild(n),t.insertBefore(r,n),t},r.prototype.KeyUpHandler=function(t){var r=t.target;if(r.classList.contains("e-text")&&(0,e.closest)(r,".e-password-content")&&(0,e.closest)(r,".e-password-dialog")&&(0,e.closest)(r,".e-password-dialog").getElementsByClassName("e-password-content")[1]===r.parentElement){var n=(0,e.closest)(r,".e-protectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?n.removeAttribute("disabled"):n.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&(0,e.closest)(r,".e-unprotectpwd-content")&&(0,e.closest)(r,".e-unprotectpwd-dialog")&&(0,e.closest)(r,".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0]===r.parentElement){var i=(0,e.closest)(r,".e-unprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?i.removeAttribute("disabled"):i.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&(0,e.closest)(r,".e-reenterpwd-content")&&(0,e.closest)(r,".e-reenterpwd-dialog")&&(0,e.closest)(r,".e-reenterpwd-dialog").getElementsByClassName("e-reenterpwd-content")[0]===r.parentElement){var a=(0,e.closest)(r,".e-reenterpwd-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?a.removeAttribute("disabled"):a.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&(0,e.closest)(r,".e-unprotectsheetpwd-content")&&(0,e.closest)(r,".e-unprotectsheetpwd-dialog")&&(0,e.closest)(r,".e-unprotectsheetpwd-dialog").getElementsByClassName("e-unprotectsheetpwd-content")[0]===r.parentElement){var o=(0,e.closest)(r,".e-unprotectworksheet-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?o.removeAttribute("disabled"):o.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&(0,e.closest)(r,".e-importprotectpwd-content")&&(0,e.closest)(r,".e-importprotectpwd-dialog")&&(0,e.closest)(r,".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0]===r.parentElement){o=(0,e.closest)(r,".e-importprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?o.removeAttribute("disabled"):o.setAttribute("disabled","true")}},r.prototype.alertMessage=function(){var e=this.parent.element.querySelector(".e-pwd-alert-span"),t=this.parent.element.querySelector(".e-unprotectpwd-alert-span"),r=this.parent.element.querySelector(".e-importprotectpwd-alert-span"),n=this.parent.element.querySelector(".e-reenterpwd-alert-span"),i=this.parent.element.querySelector(".e-unprotectsheetpwd-alert-span");e&&e.remove(),t&&t.remove(),r&&r.remove(),n&&n.remove(),i&&i.remove()},r.prototype.dlgClickHandler=function(e){var t=this.parent.serviceLocator.getService(Dl),r=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[0].querySelector(".e-input"),n=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[1].querySelector(".e-input"),i=this.parent.createElement("span",{className:"e-pwd-alert-span"});r.value===n.value?(e.hide(),this.parent.notify(la,{props:"Protectworkbook"}),this.protectWorkbookHandler({password:r.value}),this.parent.notify(Pa,{action:"protectWorkbook",eventArgs:{isProtected:!0,password:r.value}})):""===r.value?i.textContent=t.getConstant("PasswordAlertMsg"):""===n.value?i.textContent=t.getConstant("ConfirmPasswordAlertMsg"):r.value!==n.value&&(i.textContent=t.getConstant("PasswordAlert")),e.dialogInstance&&this.parent.element.querySelector(".e-protectworkbook-dlg").querySelector(".e-dlg-content").appendChild(i)},r.prototype.protectWorkbookHandler=function(e){this.parent.password=e.password,this.parent.isProtected=!0,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled")),this.parent.notify(la,{props:"Protectworkbook"})},r.prototype.unProtectWorkbook=function(){var e=this,t=this.parent.serviceLocator.getService(Dl),r=this.parent.serviceLocator.getService(Ll);r.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-unprotectworkbook-dlg",header:t.getConstant("UnprotectWorkbook"),beforeOpen:function(t){var n={dialogName:"UnprotectWorkbook",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel?t.cancel=!0:(r.dialogInstance.content=e.unProtectPasswordContent(),r.dialogInstance.dataBind(),Md(e.parent.element))},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){e.alertMessage(),e.unprotectdlgOkClick(r)}}]})},r.prototype.unProtectsheet=function(e){var t=this,r=this.parent.serviceLocator.getService(Dl),n=this.parent.serviceLocator.getService(Ll);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-unprotectworksheet-dlg",header:r.getConstant("UnprotectWorksheet"),beforeOpen:function(e){var r={dialogName:"UnProtectSheet",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel?e.cancel=!0:(n.dialogInstance.content=t.unProtectSheetPasswordContent(),n.dialogInstance.dataBind(),Md(t.parent.element))},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,disabled:!this.parent.allowOpen||!this.parent.openModule.isImportedFile||-1!==this.parent.openModule.unProtectSheetIdx.indexOf(this.parent.activeSheetIndex)},click:function(){t.alertMessage(),t.unprotectSheetdlgOkClick(n,e)}}]})},r.prototype.reEnterSheetPassword=function(e){var t,r,n=this,i=this.parent.serviceLocator.getService(Dl),a=this.parent.serviceLocator.getService(Ll),o=a.dialogInstance;a.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-reenterpwd-dlg",header:i.getConstant("ConfirmPassword"),beforeOpen:function(e){var r={dialogName:"Re-enterPassword",element:e.element,target:e.target,cancel:e.cancel};if(n.parent.trigger("dialogBeforeOpen",r),r.cancel)t=e.cancel=!0;else{var i=n.parent.serviceLocator.getService(Dl),o=n.parent.createElement("div",{className:"e-reenterpwd-dialog"}),s=n.parent.createElement("div",{className:"e-reenterpwd-content"}),l=n.parent.createElement("div",{className:"e-header"});l.innerText=i.getConstant("ReEnterPassword");var d=n.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});s.appendChild(d),s.insertBefore(l,d),o.appendChild(s),a.dialogInstance.content=o,a.dialogInstance.dataBind(),Md(n.parent.element.querySelector(".e-protect-dlg.e-dialog .e-footer-content .e-btn"))}},close:function(){a.dialogInstance=o,t?(n.applySheetPwd(e),a.hide(!0)):r&&a.hide(!0)},buttons:[{buttonModel:{content:i.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){n.alertMessage();var t=n.parent.serviceLocator.getService(Dl),i=n.parent.element.querySelector(".e-reenterpwd-dialog .e-reenterpwd-content .e-input").value;if(e===i)n.applySheetPwd(e),r=!0,a.hide();else{var o=n.parent.createElement("span",{className:"e-reenterpwd-alert-span"});o.textContent=i?t.getConstant("PasswordAlert"):t.getConstant("ConfirmPasswordAlertMsg"),n.parent.element.querySelector(".e-reenterpwd-dlg").querySelector(".e-reenterpwd-dialog").appendChild(o)}}}]})},r.prototype.unProtectPasswordContent=function(){var e=this.parent.serviceLocator.getService(Dl),t=this.parent.createElement("div",{className:"e-unprotectpwd-dialog"}),r=this.parent.createElement("div",{className:"e-unprotectpwd-content"}),n=this.parent.createElement("div",{className:"e-header"});n.innerText=e.getConstant("EnterThePassword");var i=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return r.appendChild(i),r.insertBefore(n,i),t.appendChild(r),t},r.prototype.unProtectSheetPasswordContent=function(){var e=this.parent.serviceLocator.getService(Dl),t=this.parent.createElement("div",{className:"e-unprotectsheetpwd-dialog"}),r=this.parent.createElement("div",{className:"e-unprotectsheetpwd-content"}),n=this.parent.createElement("div",{className:"e-header"});n.innerText=e.getConstant("EnterThePassword");var i=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return r.appendChild(i),r.insertBefore(n,i),t.appendChild(r),t},r.prototype.unprotectdlgOkClick=function(e){var t=this.parent.serviceLocator.getService(Dl),r=this.parent.element.querySelector(".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0].querySelector(".e-input");if(this.parent.password===r.value)e.hide(),this.removeWorkbookProtection(),this.parent.notify(Pa,{action:"protectWorkbook",eventArgs:{isProtected:!1}});else{var n=this.parent.createElement("span",{className:"e-unprotectpwd-alert-span"});n.innerText=t.getConstant("UnprotectPasswordAlert"),this.parent.element.querySelector(".e-unprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(n)}},r.prototype.removeWorkbookProtection=function(){this.parent.password="",this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled"));var e=document.getElementById(this.parent.element.id+"_protectworkbook");e&&e.classList.remove("e-active"),this.parent.notify(la,{props:"Protectworkbook"})},r.prototype.unprotectSheetdlgOkClick=function(e,t){var r=this.parent.serviceLocator.getService(Dl),n=this.parent.getActiveSheet(),i=this.parent.element.querySelector(".e-unprotectsheetpwd-dialog").getElementsByClassName("e-unprotectsheetpwd-content")[0].querySelector(".e-input");if(t&&0===n.password.length){var a={sheetPassword:i.value,sheetIndex:this.parent.activeSheetIndex};this.parent.open(a)}else if(n.password===i.value)e.hide(),this.unProtectSheetPassword();else{var o=this.parent.createElement("span",{className:"e-unprotectsheetpwd-alert-span"});o.innerText=r.getConstant("UnprotectPasswordAlert"),this.parent.element.querySelector(".e-unprotectworksheet-dlg").querySelector(".e-dlg-content").appendChild(o)}},r.prototype.unProtectSheetPassword=function(){var e=this.parent.getActiveSheet(),t=this.parent.activeSheetIndex;this.parent.setSheetPropertyOnMute(e,"isProtected",!e.isProtected),this.parent.setSheetPropertyOnMute(e,"password","");var r=!e.isProtected;this.parent.notify(Ga,{isActive:r,id:this.parent.element.id+"_protect",sheetIndex:t,triggerEvent:!0}),this.parent.allowOpen&&this.parent.openModule.isImportedFile&&-1===this.parent.openModule.unProtectSheetIdx.indexOf(t)&&this.parent.openModule.unProtectSheetIdx.push(t)},r.prototype.importProtectWorkbook=function(e){var t=this,r=this.parent.serviceLocator.getService(Dl),n=this.parent.serviceLocator.getService(Ll);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-importprotectworkbook-dlg",header:r.getConstant("UnprotectWorkbook"),beforeOpen:function(r){var i={dialogName:"ImportProtectWorkbook",element:r.element,target:r.target,cancel:r.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel?r.cancel=!0:(n.dialogInstance.content=t.importProtectPasswordContent(e),n.dialogInstance.dataBind(),Md(t.parent.element))},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){t.alertMessage(),t.importOkClick(e)}}]})},r.prototype.importProtectPasswordContent=function(e){var t=this.parent.serviceLocator.getService(Dl),r=this.parent.createElement("div",{className:"e-importprotectpwd-dialog"}),n=this.parent.createElement("div",{className:"e-importprotectpwd-content"}),i=this.parent.createElement("span",{className:"e-header"});i.innerText='"'+e.file.name+'" '+t.getConstant("IsProtected");var a=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return a.setAttribute("placeholder",t.getConstant("EnterThePassword")),n.appendChild(i),n.appendChild(a),r.appendChild(n),r},r.prototype.importOkClick=function(e){var t=this.parent.element.querySelector(".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0].querySelector(".e-input");this.parent.password=t.value;var r={file:e.file,password:t.value};this.parent.open(r)},r.prototype.toggleProtect=function(){var e,t=this.parent.element.id,r=this.parent.getActiveSheet();r.isProtected&&this.parent.allowOpen&&r.isImportProtected&&this.parent.openModule.isImportedFile&&-1===this.parent.openModule.unProtectSheetIdx.indexOf(this.parent.activeSheetIndex)?this.unProtectsheet(!0):r.password&&r.password.length>0?this.unProtectsheet():(this.parent.setSheetPropertyOnMute(r,"isProtected",!r.isProtected),e=!r.isProtected,this.parent.notify(Ga,{isActive:e,id:t+"_protect",sheetIndex:this.parent.activeSheetIndex,triggerEvent:!0}))},r.prototype.getModuleName=function(){return"protectSheet"},r}(),Oh=function(){function r(e){this.shortValue="",this.divElements=[],this.paraElements=[],this.inputElements=[],this.textBoxElements=[],this.dropDownListElements=[],this.parent=e,this.addEventListener()}return r.prototype.addEventListener=function(){this.parent.on($a,this.renderFindDlg,this),this.parent.on(Ka,this.renderGotoDlg,this),this.parent.on(nt,this.gotoHandler,this),this.parent.on(Za,this.findHandler,this),this.parent.on(st,this.showFindAlert,this),this.parent.on(mt,this.replaceAllDialog,this),this.parent.on(lt,this.findKeyUp,this),this.parent.on(Z,this.findToolDlg,this),this.parent.on(ra,this.refreshFindDlg,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off($a,this.renderFindDlg),this.parent.off(Ka,this.renderGotoDlg),this.parent.off(nt,this.gotoHandler),this.parent.off(Za,this.findHandler),this.parent.off(st,this.showFindAlert),this.parent.off(mt,this.replaceAllDialog),this.parent.off(lt,this.findKeyUp),this.parent.off(Z,this.findToolDlg),this.parent.off(ra,this.refreshFindDlg))},r.prototype.findToolDlg=function(t){var r=this,n=function(n){var i=r.parent.showRibbon&&r.parent.element.querySelector(".e-ribbon");if(i){var a=t.event&&t.event.target?(0,e.closest)(t.event.target,"#"+r.parent.element.id+"_findbtn"):(0,e.select)("#"+r.parent.element.id+"_findbtn",i);a&&(n?a.classList.add("e-disabled"):a.classList.remove("e-disabled"),a.disabled=n)}},i=t.dialogEle||this.parent.element.getElementsByClassName("e-findtool-dlg")[0];t.isPublic&&(this.findValue=t.findValue);var a,o,s,l=this.parent.getActiveSheet(),d=function(e){if(o&&(!l.isProtected||l.protectSettings.selectCells||l.protectSettings.selectUnLockedCells)){var t=o.value;if(e&&13===e.keyCode)o.value&&"0 of 0"!==s.textContent&&(r.parent.notify(Za,{findOption:e.shiftKey?"prev":"next"}),r.updateCount(s,e.shiftKey));else{var n=void 0;if(""===t)s.textContent="0 of 0",n=!1;else{var i={value:t,mode:"Sheet",isCSen:!1,sheetIndex:r.parent.activeSheetIndex,isEMatch:!1,searchBy:"By Row"};r.parent.notify(pt,i),s.textContent=i.findCount,n="0 of 0"!==i.findCount}a.enableItems(1,n),a.enableItems(2,n)}}};if(i)if(t.isPublic||t.refreshPosition){if(t.isPublic&&((o=i.querySelector(".e-text-findNext-short")).value=this.findValue,s=i.querySelector(".e-input-group-icon"),a=(0,e.getComponent)(i.querySelector(".e-find-toolbar"),"toolbar"),d()),t.refreshPosition){var h=void 0;if(this.parent.getActiveSheet().showHeaders){var p=this.parent.getColumnHeaderContent().parentElement;h=(p&&p.offsetHeight||30)+1}else h=1;i.style.top=h+"px"}}else n(!0),this.findDialog.hide();else{var c=this.parent.createElement("div",{className:"e-input-group"});o=this.parent.createElement("input",{className:"e-input e-text-findNext-short",attrs:{type:"Text"}}),this.findValue&&(o.value=this.findValue);var u,f=this.parent.serviceLocator.getService(Dl);o.setAttribute("placeholder",f.getConstant("FindValue")),s=this.parent.createElement("span",{className:"e-input-group-icon"});var g=l.usedRange.rowIndex*l.usedRange.colIndex>100;o.onkeyup=function(e){g?(u&&clearTimeout(u),u=setTimeout(d.bind(r,e),500)):d(e)},c.appendChild(o),c.appendChild(s);var m=[{type:"Input",template:c},{prefixIcon:"e-icons e-prev-icon",tooltipText:f.getConstant("FindPreviousBtn"),type:"Button",cssClass:"e-findRib-prev",disabled:!0},{prefixIcon:"e-icons e-next-icon",tooltipText:f.getConstant("FindNextBtn"),type:"Button",cssClass:"e-findRib-next",disabled:!0},{type:"Separator"},{prefixIcon:"e-icons e-option-icon",tooltipText:f.getConstant("MoreOptions"),type:"Button",cssClass:"e-findRib-more"},{prefixIcon:"e-icons e-close",tooltipText:f.getConstant("Close"),type:"Button",cssClass:"e-findRib-close"}];a=new vh.Toolbar({clicked:function(e){"e-findRib-next"===e.item.cssClass?(r.parent.notify(Za,{findOption:"next"}),r.updateCount(s)):"e-findRib-prev"===e.item.cssClass?(r.parent.notify(Za,{findOption:"prev"}),r.updateCount(s,!0)):"e-findRib-more"===e.item.cssClass&&(r.findDialog.animationSettings.effect="None",r.findDialog.setProperties({animationSettings:r.findDialog.animationSettings},!0),r.renderFindDlg(),r.findDialog.hide())},width:"auto",height:"auto",items:m,cssClass:"e-find-toolObj",created:function(){a.element.querySelectorAll(".e-toolbar-item .e-tbar-btn").forEach((function(e){return e.removeAttribute("tabindex")}))}});var v=this.parent.createElement("div",{className:"e-find-toolbar",attrs:{tabindex:"-1"}});a.createElement=this.parent.createElement,a.appendTo(v),i=this.parent.createElement("div",{className:"e-dlg-div",attrs:{"aria-label":f.getConstant("FindValue")}});var y,C=this.parent.element.getElementsByClassName("e-sheet-panel")[0],b={cssClass:"e-findtool-dlg",visible:!1,enableRtl:this.parent.enableRtl,target:C,open:function(){if(e.EventHandler.add(document,"click",r.closeDialog,r),r.findValue&&(!l.isProtected||l.protectSettings.selectCells||l.protectSettings.selectUnLockedCells)){var t={value:r.findValue,mode:"Sheet",isCSen:!1,sheetIndex:r.parent.activeSheetIndex,isEMatch:!1,searchBy:"By Row"};r.parent.notify(pt,t),s.textContent=t.findCount;var i="0 of 0"!==t.findCount;a.enableItems(1,i),a.enableItems(2,i)}else s.textContent="0 of 0";n(!1);var o=a.element.querySelector(".e-input-group");o&&o.addEventListener("focus",(function(){var e=a.element.querySelector(".e-text-findNext-short");Md(e),e.classList.add("e-input-focus"),e.setSelectionRange(0,e.value.length)})),y&&r.findDialog.setProperties({animationSettings:y},!0)},beforeOpen:function(){return Md(r.parent.element)},beforeClose:function(){r.findValue=o.value||null,a.destroy(),e.EventHandler.remove(document,"click",r.closeDialog)},close:function(){r.findDialog.destroy(),r.findDialog=null,(0,e.detach)(i),C.style.position="",Md(r.parent.element),n(!1)},created:function(){C.style.position="relative",i.style.width=r.parent.getMainContent().offsetWidth+"px",i.style.visibility="hidden",i.style.display="block",r.findDialog.width=2*parseInt(getComputedStyle(i).borderLeftWidth,10)+i.querySelector(".e-toolbar-items").getBoundingClientRect().width+"px",i.style.display="",i.style.width="",i.style.visibility="",i.style.top=(t&&t.headerHgt||r.parent.getColumnHeaderContent().parentElement.offsetHeight+1)+"px",i.style.left="",i.style[r.parent.enableRtl?"left":"right"]=r.parent.sheetModule.getScrollSize()+"px",r.findDialog.show()}};e.Browser.isDevice?(b.header=v,b.allowDragging=!0):b.content=v,this.findDialog=new fh.Dialog(b),this.findDialog.createElement=this.parent.createElement,t&&t.isPublic&&(y={effect:this.findDialog.animationSettings.effect},this.findDialog.setProperties({animationSettings:{effect:"None"}},!0)),this.findDialog.appendTo(i)}},r.prototype.refreshFindDlg=function(){var e=this.findDialog&&this.parent.element.getElementsByClassName("e-findtool-dlg")[0];if(e){var t=e.querySelector(".e-text-findNext-short");this.findToolDlg({findValue:t.value,isPublic:!0,refreshPosition:!0,dialogEle:e})}},r.prototype.updateCount=function(e,t){var r,n=e.textContent.split(" ");t?(r=Number(n[0])-1)<1&&(r=Number(n[2])):(r=Number(n[0])+1)>Number(n[2])&&(r=1),n[0]=r.toString(),e.textContent=n.join(" ")},r.prototype.closeDialog=function(t){!(0,e.closest)(t.target,".e-findRib-close")&&(0,e.closest)(t.target,".e-spreadsheet")||!this.findDialog||this.findToolDlg({})},r.prototype.renderFindDlg=function(){var t=this,r=this.parent.serviceLocator.getService(Ll);if(this.parent.element.querySelector(".e-find-dlg"))r.hide();else{var n=this.parent.serviceLocator.getService(Dl),i={isModal:!1,showCloseIcon:!0,cssClass:"e-find-dlg",header:n.getConstant("FindAndReplace"),beforeOpen:function(e){var n={dialogName:"FindAndReplaceDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",n),n.cancel?e.cancel=!0:(r.dialogInstance.content=t.findandreplaceContent(),r.dialogInstance.dataBind(),Md(t.parent.element))},buttons:[{buttonModel:{content:n.getConstant("FindPreviousBtn"),isPrimary:!0,cssClass:"e-btn-findPrevious",disabled:!0},click:function(e){t.dialogMessage(),t.findHandler({findOption:e&&13===e.keyCode?"next":"prev"})}},{buttonModel:{content:n.getConstant("FindNextBtn"),isPrimary:!0,cssClass:"e-btn-findNext",disabled:!0},click:function(){t.dialogMessage(),t.findHandler({findOption:"next"})}},{buttonModel:{content:n.getConstant("ReplaceBtn"),isPrimary:!0,cssClass:"e-btn-replace",disabled:!0},click:function(){t.dialogMessage(),t.replaceHandler(at)}},{buttonModel:{content:n.getConstant("ReplaceAllBtn"),isPrimary:!0,cssClass:"e-btn-replaceAll",disabled:!0},click:function(){t.dialogMessage(),t.replaceHandler(ot)}}],open:function(){var r=t.parent.element.querySelector(".e-text-findNext");if(r.value){var n=t.parent.element.querySelector(".e-btn-findPrevious");(0,e.getComponent)(n,"btn").disabled=!1,(0,e.getComponent)(t.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}zl((function(){Md(r)}))},beforeClose:this.dialogBeforeClose.bind(this)};r.show(i)}},r.prototype.dialogBeforeClose=function(){var e=this.checkBoxElements;e&&e.element&&(e.destroy(),e.element.remove()),this.checkBoxElements=null,this.textBoxElements.forEach((function(e){e&&e.element&&(e.destroy(),e.element.remove())})),this.textBoxElements=[],this.dropDownListElements.forEach((function(e){e&&e.element&&(e.destroy(),e.element.remove())})),this.dropDownListElements=[],Kd(this.paraElements),this.paraElements=[],Kd(this.inputElements),this.inputElements=[],Kd(this.divElements),this.divElements=[]},r.prototype.dialogMessage=function(){this.parent.element.querySelector(".e-replace-alert-span")?this.parent.element.querySelector(".e-replace-alert-span").remove():this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove()},r.prototype.renderGotoDlg=function(){var t=this,r=this.parent.serviceLocator.getService(Dl),n=this.parent.serviceLocator.getService(Ll);if((0,e.isNullOrUndefined)(this.parent.element.querySelector(".e-goto-dlg"))){var i={width:300,isModal:!1,showCloseIcon:!0,cssClass:"e-goto-dlg",header:r.getConstant("GotoHeader"),beforeOpen:function(e){var r={dialogName:"GoToDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel?e.cancel=!0:(n.dialogInstance.content=t.GotoContent(),n.dialogInstance.dataBind(),Md(t.parent.element))},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){t.gotoHandler()&&n.hide()}}],open:function(){t.textFocus()}};n.show(i,!1)}else n.hide()},r.prototype.textFocus=function(){var e=this;this.parent.element.querySelector(".e-text-goto").addEventListener("focus",(function(){e.parent.element.querySelector(".e-goto-alert-span")&&e.parent.element.querySelector(".e-goto-alert-span").remove()}))},r.prototype.findHandler=function(t){var r=this.parent.element.querySelector(".e-text-findNext");r||(r=this.parent.element.querySelector(".e-text-findNext-short"))||this.gotoAlert();var n=r.value;if(""!==r.value){var i=this.parent.getActiveSheet();if(i.isProtected&&!i.protectSettings.selectCells&&!i.protectSettings.selectUnLockedCells)return;var a=this.parent.activeSheetIndex,o=this.parent.element.querySelector(".e-findnreplace-checkcase"),s=void 0;if(o)s=(0,e.getComponent)(o,"checkbox").checked;else s=!1;var l=this.parent.element.querySelector(".e-findnreplace-checkmatch"),d=void 0;if(l)d=(0,e.getComponent)(l,"checkbox").checked;else d=!1;var h=this.parent.element.querySelector(".e-findnreplace-searchby"),p=void 0;if(h)p=(0,e.getComponent)(h,"dropdownlist").value.toString();else p="By Row";var c=this.parent.element.querySelector(".e-findnreplace-searchwithin"),u=void 0;if(c)u=(0,e.getComponent)(c,"dropdownlist").value.toString();else u="Sheet";var f={value:n,sheetIndex:a,findOpt:t.findOption,mode:u,isCSen:s,isEMatch:d,searchBy:p,isAction:!0};this.parent.find(f)}},r.prototype.replaceHandler=function(e){var t=this.parent.element.querySelector(".e-find-dlg").querySelector(".e-text-findNext").value,r=this.parent.element.querySelector(".e-text-replaceInp").value,n=this.parent.element.querySelector(".e-findnreplace-checkcase").checked,i=this.parent.element.querySelector(".e-findnreplace-checkmatch").checked,a=this.parent.element.querySelector(".e-search-within .e-ddl-hidden").value,o=this.parent.element.querySelector(".e-searchby .e-ddl-hidden").value;this.parent.notify(e,{value:t,mode:a,isCSen:n,isEMatch:i,searchBy:o,findOpt:"next",replaceValue:r,replaceBy:e,sheetIndex:this.parent.activeSheetIndex,isAction:!0})},r.prototype.gotoHandler=function(e){var r=!0;if(e)this.parent.goTo(e.address);else{for(var n=this.parent.element.querySelector(".e-text-goto").value,i=0;i<this.parent.definedNames.length;i++)if(this.parent.definedNames[i].name===n){n=this.parent.definedNames[i].refersTo.slice(1);break}var a=n;n.includes("!")&&(a=n.substring(n.lastIndexOf("!")+1)),(a=a.split("$").join("")).includes(":")&&(a=a.split(":")[0]);var o=a.match(/\d+/),s=a.match(/[A-Z]+/i);if(o&&s&&0===s.index){var l=c(t(a)),d=this.parent.getActiveSheet();l[2]>=1048576||l[3]>=16384?(this.gotoAlert(),r=!1):this.parent.scrollSettings.isFinite&&(d.rowCount<l[2]+1||d.colCount<l[3]+1)?(this.parent.notify(ro,null),r=!1):this.parent.goTo(n)}else this.gotoAlert(),r=!1}return r},r.prototype.gotoAlert=function(){var e=this.parent.serviceLocator.getService(Dl),t=this.parent.createElement("span",{className:"e-goto-alert-span"});t.innerText=e.getConstant("InsertingEmptyValue"),this.parent.element.querySelector(".e-goto-alert-span")&&this.parent.element.querySelector(".e-goto-alert-span").remove(),this.parent.element.querySelector(".e-goto-dlg").querySelector(".e-dlg-content").appendChild(t)},r.prototype.showFindAlert=function(){this.parent.element.querySelector(".e-replace-alert-span")&&this.parent.element.querySelector(".e-replace-alert-span").remove();var e=this.parent.element.querySelector(".e-find-dlg .e-dlg-content");if(e){var t=this.parent.createElement("span",{className:"e-find-alert-span"});t.innerText=this.parent.serviceLocator.getService(Dl).getConstant("NoElements"),e.appendChild(t)}},r.prototype.replaceAllDialog=function(e){this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove();var t=this.parent.element.querySelector(".e-replace-alert-span");t&&t.remove();var r=this.parent.serviceLocator.getService(Dl),n=this.parent.createElement("span",{className:"e-replace-alert-span"});n.innerText=e.count+r.getConstant("ReplaceAllEnd")+e.replaceValue,this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(n)},r.prototype.findKeyUp=function(t){if(t.target.classList.contains("e-text-findNext")){var r=this.parent.element.querySelector(".e-text-findNext").value;if((0,e.isNullOrUndefined)(r)||""===r)(0,e.getComponent)(this.parent.element.querySelector(".e-btn-findPrevious"),"btn").disabled=!0,(0,e.getComponent)(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!0,this.dialogMessage();else{var n=this.parent.element.querySelector(".e-btn-findPrevious");(0,e.getComponent)(n,"btn").disabled=!1,(0,e.getComponent)(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}}var i=this.parent.element.querySelector(".e-text-findNext").value,a=this.parent.element.querySelector(".e-text-replaceInp").value;(0,e.isNullOrUndefined)(i)||(0,e.isNullOrUndefined)(a)||""===i||""===a?((0,e.getComponent)(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!0,(0,e.getComponent)(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!0):this.parent.getActiveSheet().isProtected||((0,e.getComponent)(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!1,(0,e.getComponent)(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!1)},r.prototype.findandreplaceContent=function(){this.parent.element.querySelector(".e-text-findNext-short")&&(this.shortValue=this.parent.element.querySelector(".e-text-findNext-short").value);var e=this.parent.createElement("div",{className:"e-link-dialog"}),t=this.parent.createElement("div",{className:"e-find"}),r=this.parent.createElement("div",{className:"e-findCheck"});this.divElements.push(e),this.divElements.push(t),this.divElements.push(r);var n=this.parent.serviceLocator.getService(Dl);e.appendChild(t);var i=this.parent.createElement("div",{className:"e-cont"}),a=this.parent.createElement("p",{className:"e-header"});a.innerText=n.getConstant("FindWhat");var o=this.parent.createElement("input",{className:"e-input e-text-findNext",attrs:{type:"Text",placeholder:n.getConstant("FindValue"),value:this.shortValue}});this.divElements.push(i),this.paraElements.push(a),this.inputElements.push(o),i.appendChild(o),i.insertBefore(a,o),t.appendChild(i);var s=new Ih.TextBox({width:"70%"});this.textBoxElements.push(s),s.createElement=this.parent.createElement,s.appendTo(o);var l=this.parent.createElement("div",{className:"e-cont"}),d=this.parent.createElement("p",{className:"e-header"});d.innerText=n.getConstant("ReplaceWith");var h=this.parent.createElement("input",{className:"e-input e-text-replaceInp",attrs:{type:"Text",placeholder:n.getConstant("ReplaceValue")}});this.divElements.push(l),this.paraElements.push(d),this.inputElements.push(h),l.appendChild(h),l.insertBefore(d,h),t.appendChild(l);var p=new Ih.TextBox({width:"70%"});this.textBoxElements.push(p),p.createElement=this.parent.createElement,p.appendTo(h);var c=[{Id:"Sheet",Within:n.getConstant("Sheet")},{Id:"Workbook",Within:n.getConstant("Workbook")}],u=new Nh.DropDownList({dataSource:c,cssClass:"e-search-within",fields:{value:"Id",text:"Within"},width:"50%",index:0});this.dropDownListElements.push(u);var f=n.getConstant("SearchWithin"),g=this.parent.createElement("input",{className:"e-findnreplace-searchwithin",attrs:{type:"select",label:f}}),m=this.parent.createElement("p",{className:"e-header"});m.innerText=f,this.inputElements.push(g),this.paraElements.push(m),t.appendChild(m),t.appendChild(g),u.createElement=this.parent.createElement,u.appendTo(g);var v=[{Id:"By Row",Search:n.getConstant("ByRow")},{Id:"By Column",Search:n.getConstant("ByColumn")}],y=new Nh.DropDownList({dataSource:v,cssClass:"e-searchby",fields:{value:"Id",text:"Search"},width:"50%",index:0});this.dropDownListElements.push(y),f=n.getConstant("SearchBy");var C=this.parent.createElement("input",{className:"e-findnreplace-searchby",attrs:{type:"select",label:f}}),b=this.parent.createElement("p",{className:"e-header"});b.innerText=f,this.inputElements.push(C),this.paraElements.push(b),t.appendChild(b),t.appendChild(C),y.createElement=this.parent.createElement,y.appendTo(C);var x=new Eh.CheckBox({label:n.getConstant("MatchCase"),checked:!1,cssClass:"e-findnreplace-casecheckbox"}),S=this.parent.createElement("input",{className:"e-findnreplace-checkcase",attrs:{type:"checkbox"}});this.inputElements.push(S),r.appendChild(S),x.createElement=this.parent.createElement,x.appendTo(S);var w=new Eh.CheckBox({label:n.getConstant("MatchExactCellElements"),checked:!1,cssClass:"e-findnreplace-exactmatchcheckbox"});this.checkBoxElements=w;var I=this.parent.createElement("input",{className:"e-findnreplace-checkmatch",attrs:{type:"checkbox"}});return this.inputElements.push(I),r.appendChild(I),w.createElement=this.parent.createElement,w.appendTo(I),t.appendChild(r),e},r.prototype.GotoContent=function(){var e=this.parent.serviceLocator.getService(Dl),t=this.parent.createElement("div",{className:"e-link-dialog"}),r=this.parent.createElement("div",{className:"e-goto"});t.appendChild(r);var n=this.parent.createElement("div",{className:"e-cont"}),i=this.parent.createElement("p",{className:"e-header"});i.innerText=e.getConstant("Reference");var a=new Ih.TextBox({placeholder:e.getConstant("EnterCellAddress")}),o=this.parent.createElement("input",{className:"e-text-goto",attrs:{type:"Text"}});return n.appendChild(o),n.insertBefore(i,o),r.appendChild(n),a.createElement=this.parent.createElement,a.appendTo(o),t},r.prototype.destroy=function(){this.removeEventListener(),this.findDialog&&this.findDialog.hide(),this.parent=null},r.prototype.getModuleName=function(){return"findAndReplace"},r}(),Fh=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.merge=function(e){this.parent.serviceLocator.getService("cell").refresh(e.rowIdx,e.colIdx,e.lastCell,e.element,!1,!1,Kr(this.parent))},e.prototype.hideHandler=function(e){var t=this.parent.getActiveSheet(),r={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(Et,r),r.range=r.range;var n=zn(r.range[0],r.range[1],t)||{},i="row"===e.model?r.range[0]:r.range[1],a=i+((n[e.model+"Span"]||1)-1);if(!(!e.isEnd&&(e.start===i||Al(t,i))||e.isEnd&&e.start>i&&!Al(t,i))&&n[e.model+"Span"]>1&&a>=e.start)if("row"===e.model?ml(t,i):Al(t,i)){if(e.colIdx<=a){var o=Pr(t,r.range[1],!0,"columns");if(o<=a){var s=r.range[0];n.rowSpan>1&&(s=(s=Pr(t,r.range[0],!0))<=r.range[2]?s:r.range[0]);var l=this.parent.getCell(s,o);l&&(l.style.display="",this.parent.serviceLocator.getService("cell").refresh(r.range[0],r.range[1],!0,l,!0,!0))}}}else{s=n.rowSpan>1?Pr(t,r.range[0],!0):r.range[0];this.merge({rowIdx:r.range[0],colIdx:r.range[1],element:this.parent.getCell(s,r.range[1])})}},e.prototype.checkPrevMerge=function(e){var t,r,n,i,a,o=this,s=this.parent.getActiveSheet(),l=function(){var t=o.parent.getContentTable(),n=t&&t.rows[0];if(n){var i=parseInt(n.getAttribute("aria-rowindex"),10)-1;if(r.range=r.range,i>o.parent.viewport.topIndex+o.parent.frozenRowCount(s)&&i>r.range[0]&&i<=r.range[2]){var a=void 0,l=o.parent.getRowHeaderTable(),d=l&&l.rows[0],h=o.parent.frozenColCount(s);if(h&&!d)return;for(var p=e.colIdx;p<=r.range[3];p++)(a=o.parent.getCell(i,p,p<h?d:n))&&(a.colSpan>1||a.rowSpan>1)&&(a.style.display="none",a.removeAttribute("colSpan"),a.removeAttribute("rowSpan"))}}},d=function(d){if(r.range=r.range,ml(s,r.range[0])&&e.rowIdx>=r.range[0]&&e.rowIdx<=r.range[2]){i=!1;for(var h=r.range[0];h<e.rowIdx;h++)if(!ml(s,h)){i=!0;break}if(t.rowSpan>1&&!i){var p=t.rowSpan-o.parent.hiddenCount(r.range[0],r.range[2]);p>0&&(l(),e.td.style.display="",e.colSpan=n,e.rowSpan=p,e.cell=t,e.isMerged=!1)}}else if(d){for(h=r.range[0];a&&h<e.rowIdx;h++)if(!ml(s,h)){i=!0;break}i||(l(),e.td.style.display="",e.colSpan=n,e.cell=t,e.isMerged=!1)}};if(e.cell.colSpan<0){if(e.colIdx-1>-1&&Al(s,e.colIdx-1)&&(t=zn(e.rowIdx,e.colIdx-1,s,!1,!0),a=e.rowIdx-1>-1&&ml(s,e.rowIdx-1),(void 0!==t.colSpan||void 0!==t.rowSpan)&&(void 0===t.rowSpan||t.rowSpan>1||a)&&(r={range:[e.rowIdx,e.colIdx-1,e.rowIdx,e.colIdx-1]},this.parent.notify(Et,r),r.range=r.range,t=zn(r.range[0],r.range[1],s,!1,!0),Al(s,r.range[1])&&e.colIdx>=r.range[1]&&e.colIdx<=r.range[3]))){for(var h=r.range[1];h<e.colIdx;h++)if(!Al(s,h)){i=!0;break}t.colSpan>1&&!i&&(n=t.colSpan-this.parent.hiddenCount(r.range[1],r.range[3],"columns"))>0&&d(!0)}}else e.rowIdx-1>-1&&ml(s,e.rowIdx-1)&&void 0!==(t=zn(e.rowIdx-1,e.colIdx,s,!1,!0)).rowSpan&&(r={range:[e.rowIdx-1,e.colIdx,e.rowIdx-1,e.colIdx]},this.parent.notify(Et,r),r.range=r.range,t=zn(r.range[0],r.range[1],s,!1,!0),d())},e.prototype.checkMerge=function(e){var t,r=this.parent.getActiveSheet(),n=zn(e.rowIdx,e.colIdx,r)||{};if(e.isRow){if(void 0===n.colSpan||Al(r,e.colIdx-1)){if((t={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]}).range=t.range,this.parent.notify(Et,t),Al(r,e.colIdx-1)&&!Al(r,t.range[1])||e.isFreezePane&&t.range[0]<this.parent.frozenRowCount(r))return void(e.insideFreezePane=t.range[0]<this.parent.frozenRowCount(r));if(e.colIdx!==this.parent.viewport.leftIndex+this.parent.frozenColCount(r)&&Al(r,e.colIdx-1))for(var i=t.range[1];void 0!==n.colSpan&&i<e.colIdx;i++)if(!Al(r,i))return;n=zn(t.range[0],t.range[1],r),(o=t.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,t.range[2]))>=1&&(this.merge({rowIdx:t.range[0],colIdx:t.range[1],element:e.td}),1===o?e.td.removeAttribute("rowspan"):e.td.rowSpan=o,e.td.style.display="")}}else if(void 0===n.rowSpan||ml(r,e.rowIdx-1)){if((t={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]}).range=t.range,this.parent.notify(Et,t),ml(r,e.rowIdx-1)&&!ml(r,t.range[0])||e.isFreezePane&&t.range[1]<this.parent.frozenColCount(r))return void(e.insideFreezePane=t.range[1]<this.parent.frozenColCount(r));if(e.rowIdx!==this.parent.viewport.topIndex+this.parent.frozenRowCount(r)&&ml(r,e.rowIdx-1))for(var a=t.range[0];void 0!==n.rowSpan&&a<e.rowIdx;a++)if(!ml(r,a))return;var o;n=zn(t.range[0],t.range[1],r),(o=t.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,t.range[3],"columns"))>=1&&(this.merge({rowIdx:t.range[0],colIdx:t.range[1],element:e.td}),1===o?e.td.removeAttribute("colspan"):e.td.colSpan=o,e.td.style.display="")}},e.prototype.addEventListener=function(){this.parent.on(wt,this.merge,this),this.parent.on(oo,this.hideHandler,this),this.parent.on(so,this.checkPrevMerge,this),this.parent.on(lo,this.checkMerge,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(wt,this.merge),this.parent.off(oo,this.hideHandler),this.parent.off(so,this.checkPrevMerge),this.parent.off(lo,this.checkMerge))},e.prototype.getModuleName=function(){return"merge"},e}(),Th=function(){function n(e){this.divElements=[],this.spanElements=[],this.inputElements=[],this.dropDownListElements=[],this.parent=e,this.addEventListener()}return n.prototype.destroy=function(){this.removeEventListener(),this.dupData&&(this.dupData=[]),this.colorData&&(this.colorData=[]),this.parent=null},n.prototype.addEventListener=function(){this.parent.on(kt,this.applyCF,this),this.parent.on(fo,this.renderCFDlg,this),this.parent.on(Tt,this.clearCF,this)},n.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(kt,this.applyCF),this.parent.off(fo,this.renderCFDlg),this.parent.off(Tt,this.clearCF))},n.prototype.clearCF=function(t){var n=this,i=this.parent.getActiveSheet();this.updateRange(i,t.indexes,this.parent.frozenRowCount(i),this.parent.frozenColCount(i),r(i.topLeftCell),(function(t,r,i,a){var o,s,l;if((0,e.removeClass)([a],["e-redft","e-yellowft","e-greenft","e-redf","e-redt","e-iconset"]),["backgroundColor","color"].forEach((function(e){a.style[""+e]&&(a.style[""+e]="",(o=i&&i.style&&i.style[""+e]||n.parent.commonCellStyle[""+e])&&((s={})[""+e]=o,n.parent.notify(le,{style:s,rowIdx:t,colIdx:r,td:a})))})),[".e-cf-databar",".e-iconsetspan"].forEach((function(e){l=a.querySelector(e);var o=a.querySelector(".e-wrap-content");l&&(o?o.removeChild(l):a.removeChild(l),a.textContent=n.parent.getDisplayText(i),i&&i.hyperlink&&n.parent.notify(ba,{cell:i,style:i.style,td:a,rowIdx:t,colIdx:r}))})),i&&i.format&&i.format.includes("[")&&Wn(i.format)){var d={value:i.value,format:i.format,formattedText:i.value,cell:i,rowIndex:t,colIndex:r,refresh:!0,td:a};n.parent.notify(re,d)}}))},n.prototype.renderCFDlg=function(e){var r,n=this,i=this.parent.serviceLocator.getService(Dl),a=this.parent.serviceLocator.getService(Ll);a.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-conditionalformatting-dlg",header:e.action.replace("...",""),beforeOpen:function(t){var r={dialogName:"ConditionalFormatDialog",element:t.element,target:t.target,cancel:t.cancel};n.parent.trigger("dialogBeforeOpen",r),r.cancel?t.cancel=!0:(a.dialogInstance.content=n.cfDlgContent(e.action),a.dialogInstance.dataBind(),Md(n.parent.element))},beforeClose:this.dialogBeforeClose.bind(this),close:function(){r&&(n.parent.notify(to,null),r=!1)},buttons:[{buttonModel:{content:i.getConstant("Ok"),isPrimary:!0},click:function(){var i=n.parent.getActiveSheet();Qr(n.parent,c(t(i.selectedRange)))?r=!0:n.dlgClickHandler(e.action),a.hide()}}]})},n.prototype.dialogBeforeClose=function(){var e=this.numericTBElements;e&&e.element&&(e.destroy(),e.element.remove()),this.numericTBElements=null,this.dropDownListElements.forEach((function(e){e&&e.element&&(e.destroy(),e.element.remove())})),this.dropDownListElements=[],this.value1Inp&&(this.value1Inp.removeEventListener("input",this.validateCFInput.bind(this)),this.value1Inp.parentNode&&this.value1Inp.parentNode.removeChild(this.value1Inp),this.value1Inp=null),this.value2Inp&&(this.value2Inp.removeEventListener("input",this.validateCFInput.bind(this)),this.value2Inp.parentNode&&this.value2Inp.parentNode.removeChild(this.value2Inp),this.value2Inp=null),Kd(this.spanElements),this.spanElements=[],Kd(this.inputElements),this.inputElements=[],Kd(this.divElements),this.divElements=[]},n.prototype.dlgClickHandler=function(e){var t=this.parent.serviceLocator.getService(Dl),r=this.parent.element.querySelector(".e-conditionalformatting-dlg .e-dlg-content .e-cf-dlg"),n={cFColor:this.getCFColor(r.querySelector(".e-cfsub .e-input").value),range:this.parent.getActiveSheet().selectedRange},i=r.querySelectorAll(".e-cfmain .e-input");if(e===t.getConstant("DuplicateValues")+"...")n.type=i[0].value===t.getConstant("Duplicate")?"Duplicate":"Unique";else{n.type=this.getType(e);var a=[];i[0]&&a.push(i[0].value),i[1]&&a.push(i[1].value),Gr(a,this.parent),n.value=a.join(",")}this.parent.notify(At,{cfModel:n,isAction:!0})},n.prototype.getType=function(e){var t,r=this.parent.serviceLocator.getService(Dl);switch(e){case r.getConstant("GreaterThan")+"...":t="GreaterThan";break;case r.getConstant("LessThan")+"...":t="LessThan";break;case r.getConstant("Between")+"...":t="Between";break;case r.getConstant("CFEqualTo")+"...":t="EqualTo";break;case r.getConstant("TextThatContains")+"...":t="ContainsText";break;case r.getConstant("ADateOccuring")+"...":t="DateOccur";break;case r.getConstant("Top10Items")+"...":t="Top10Items";break;case r.getConstant("Bottom10Items")+"...":t="Bottom10Items";break;case r.getConstant("Top10")+" %...":t="Top10Percentage";break;case r.getConstant("Bottom10")+" %...":t="Bottom10Percentage";break;case r.getConstant("AboveAverage")+"...":t="AboveAverage";break;case r.getConstant("BelowAverage")+"...":t="BelowAverage"}return t},n.prototype.getCFColor=function(e){var t=this.parent.serviceLocator.getService(Dl),r="RedFT";switch(e){case t.getConstant("LightRedFillWithDarkRedText"):r="RedFT";break;case t.getConstant("YellowFillWithDarkYellowText"):r="YellowFT";break;case t.getConstant("GreenFillWithDarkGreenText"):r="GreenFT";break;case t.getConstant("RedFill"):r="RedF";break;case t.getConstant("RedText"):r="RedT"}return r},n.prototype.cfDlgContent=function(e){var t=this.getDlgText(e),r=this.parent.serviceLocator.getService(Dl),n=this.parent.createElement("div",{className:"e-cf-dlg"}),i=this.parent.createElement("div",{className:"e-cfmain"}),a=this.parent.createElement("div",{className:"e-cfsub"});this.divElements.push(n),this.divElements.push(i),this.divElements.push(a);var o=this.parent.createElement("span",{className:"e-header e-top-header"});o.innerText=t,this.value1Inp=this.parent.createElement("input",{className:"e-input",id:"valueInput",attrs:{type:"text","aria-label":t}});var s=this.parent.createElement("input",{className:"e-select"}),l=this.parent.createElement("span",{className:"e-header"});l.innerText=r.getConstant("With");var d,h=this.parent.createElement("input",{className:"e-select"});if(this.spanElements.push(o),this.inputElements.push(s),this.spanElements.push(l),this.inputElements.push(h),n.appendChild(i),n.appendChild(a),i.appendChild(o),e!==r.getConstant("DuplicateValues")+"..."){if(e!==r.getConstant("AboveAverage")+"..."&&e!==r.getConstant("BelowAverage")+"..."){i.appendChild(this.value1Inp),d=!0;var p=e===r.getConstant("Top10")+" %..."||e===r.getConstant("Bottom10")+" %...";if(e===r.getConstant("Top10Items")+"..."||e===r.getConstant("Bottom10Items")+"..."||p){this.value1Inp.maxLength=p?3:4;var c=new Ih.NumericTextBox({value:10,min:1,max:p?100:1e3,format:"###"});this.numericTBElements=c,c.appendTo(this.value1Inp)}}}else{i.appendChild(s),this.dupData=[{text:r.getConstant("Duplicate"),id:"duplicate"},{text:r.getConstant("Unique"),id:"unique"}];var u=new Nh.DropDownList({dataSource:this.dupData,index:0,popupHeight:"200px"});this.dropDownListElements.push(u),u.appendTo(s)}if(e===r.getConstant("Between")+"..."){var f=this.parent.createElement("span",{className:"e-header e-header-2"});f.innerText=r.getConstant("And"),this.value2Inp=this.parent.createElement("input",{className:"e-input e-between"}),this.spanElements.push(f),i.appendChild(f),i.appendChild(this.value2Inp),this.value2Inp.addEventListener("input",this.validateCFInput.bind(this))}d&&(this.validateCFInput({target:this.value1Inp}),this.value1Inp.addEventListener("input",this.validateCFInput.bind(this))),a.appendChild(l),a.appendChild(h),this.colorData=[{text:r.getConstant("LightRedFillWithDarkRedText"),value:"redft",id:"redft"},{text:r.getConstant("YellowFillWithDarkYellowText"),id:"yellowft"},{text:r.getConstant("GreenFillWithDarkGreenText"),id:"greenft"},{text:r.getConstant("RedFill"),id:"redf"},{text:r.getConstant("RedText"),id:"redt"}];var g=new Nh.DropDownList({dataSource:this.colorData,index:0,popupHeight:"200px"});return this.dropDownListElements.push(g),g.appendTo(h),n},n.prototype.validateCFInput=function(e){var t=this.parent.serviceLocator.getService(Ll),r=e.target.value,n=t.dialogInstance.element.getElementsByClassName("e-primary")[0];r&&(e.target.classList.contains("e-between")||e.target.parentElement.querySelector(".e-between"))&&(r=e.target.parentElement.querySelector(e.target.classList.contains("e-between")?".e-input":".e-between").value),n.disabled=!r.trim()},n.prototype.checkCellHandler=function(e,r,n){return n.range.trim().split(",").some((function(n){var i=t(n.includes(":")?n:n+":"+n);return e>=i[0]&&e<=i[2]&&r>=i[1]&&r<=i[3]}))},n.prototype.getDlgText=function(e){var t=this.parent.serviceLocator.getService(Dl),r="";switch(e){case t.getConstant("GreaterThan")+"...":r=t.getConstant("FormatCellsGreaterThan");break;case t.getConstant("LessThan")+"...":r=t.getConstant("FormatCellsLessThan");break;case t.getConstant("Between")+"...":r=t.getConstant("FormatCellsBetween");break;case t.getConstant("CFEqualTo")+"...":r=t.getConstant("FormatCellsEqualTo");break;case t.getConstant("TextThatContains")+"...":r=t.getConstant("FormatCellsThatContainTheText");break;case t.getConstant("ADateOccuring")+"...":r=t.getConstant("FormatCellsThatContainADateOccurring");break;case t.getConstant("DuplicateValues")+"...":r=t.getConstant("FormatCellsDuplicate");break;case t.getConstant("Top10Items")+"...":case t.getConstant("Top10")+" %...":r=t.getConstant("FormatCellsTop");break;case t.getConstant("Bottom10Items")+"...":case t.getConstant("Bottom10")+" %...":r=t.getConstant("FormatCellsBottom");break;case t.getConstant("AboveAverage")+"...":r=t.getConstant("FormatCellsAbove");break;case t.getConstant("BelowAverage")+"...":r=t.getConstant("FormatCellsBelow")}return r},n.prototype.updateResult=function(r,n,i,a,o,s,l,d){var h,p,c,u,f,g={},m={},v=r.range.split(","),y=[];i?f=function(){if(dn(p)&&"Text"!==u){var e=parseFloat(p);e>=0?(void 0===y[0]||e>y[0])&&(y[0]=e):(void 0===y[1]||e<y[1])&&(y[1]=e)}}:a?f=function(){if(dn(p)&&"Text"!==u){var e=parseFloat(p);y.push(Number(e))}}:o?(y=[0,0],f=function(){dn(p)&&"Text"!==u&&(y[0]+=parseFloat(p),y[1]++)}):f=s?function(){dn(p)&&"Text"!==u&&y.push(parseFloat(p))}:l?function(){if(dn(p)&&"Text"!==u){var e=parseFloat(p);(void 0===y[0]||e<y[0])&&(y[0]=e),(void 0===y[1]||e>y[1])&&(y[1]=e)}}:function(){g[""+p]?""!==p&&(m[""+p]||(m[""+p]=!0,y.push(p))):g[""+p]=!0};for(var C=0;C<v.length;C++)for(var b=(h=t(v[C]))[0];b<=h[2];b++)for(var x=h[1];x<=h[3];x++)c=zn(b,x,n,!1,!0),u="",(0,e.isNullOrUndefined)(c.value)?c.formula&&(this.parent.notify(ne,{cell:c,rowIdx:b,colIdx:x,sheetIndex:this.parent.activeSheetIndex}),p=c.value.toString().toLowerCase(),u=zs(c.format),f()):(p=c.value.toString().toLowerCase(),u=zs(c.format),f());if(a||s){if(y=y.sort((function(e,t){return e-t})),r.type.includes("Bottom")||(y=y.reverse()),s){var S=parseFloat(d);r.type.includes("Percentage")&&(S=(S/=100/y.length)<1?1:S),y=y.slice(0,S)}}else o&&((y=[y[0]/y[1]])[0]||(y=[]));r.result=y},n.prototype.applyCF=function(e){var t=!e.cfModel,r=this.parent.getActiveSheet(),n=e.cfModel||r.conditionalFormats,i=[e.indexes];e.refreshAll&&(i=Yr(this.parent,this.parent.viewport));for(var a={},o=n.length-1;o>=0;o--)t&&!(2===i[0].length?this.checkCellHandler(e.indexes[0],e.indexes[1],n[o]):Wr(i,n[o].range))||this.updateCF(e,r,n[o],a)},n.prototype.updateCF=function(n,a,o,s){var l,d,h,p=this,c="",u=!1;if(o.value){var f=[],g=[];if("Between"===o.type?(f=o.value.split('"').filter((function(e){return e.trim()&&","!==e.trim()}))).length>1?(g=f,u=!0):g=o.value.split(",").filter((function(e){return!!e.trim()})):g=[o.value],g.length>1)if(g[0].split("(").length>1){for(var m="",v=0;v<g.length;v++)(m+=g[v]+",").split("(").length===m.split(")").length&&void 0===l&&(l=m.substring(0,m.length-1),m="");c=m.substring(0,m.length-1)}else{l=g[0];for(v=1;v<g.length;v++)c+=v+1===g.length?g[v]:g[v]+","}else l=g[0]||o.value}o.type||(o.type="GreaterThan"),o.format&&o.format.style?(d=_n(o.format.style,!0),Object.keys(d).length||(h=o.cFColor)||(h=o.cFColor="RedFT")):(d={},(h=o.cFColor)||(h=o.cFColor="RedFT"));var y=o.type.includes("Average"),C=o.type.includes("10")&&dn(l),b=o.type.includes("Three")||o.type.includes("Four")||o.type.includes("Five"),x=o.type.includes("DataBar"),S=o.type.includes("ColorScale");n.isRender&&o.result||!("Duplicate"===o.type||"Unique"===o.type||x||S||y||C||b)||this.updateResult(o,a,x,S,y,C,b,l);var w=function(t,r,a,u,f,g){var m,v,y,C=a&&!(0,e.isNullOrUndefined)(a.value)?a.value.toString():"",b=!0,w=a?zs(a.format):"";switch(o.type){case"GreaterThan":case"LessThan":m=p.isGreaterThanLessThan(o,C,l,w);break;case"Between":m=dn(C)&&"Text"!==w&&p.isBetWeen(o,C,l,c,g);break;case"EqualTo":m=p.isEqualTo(o,C,l);break;case"ContainsText":m=C&&l&&p.isContainsText(C,l);break;case"DateOccur":v={value:l,cell:{},updatedVal:l},dn(l)||p.parent.notify(ue,v),m=C===v.updatedVal;break;case"Unique":m=""!==C&&-1===o.result.indexOf(C.toLowerCase());break;case"Duplicate":m=o.result.indexOf(C.toLowerCase())>-1;break;case"Top10Items":case"Bottom10Items":case"Top10Percentage":case"Bottom10Percentage":if(o.result){var I=parseFloat(C);ln(C)&&(I=sn(C)),m=o.result.indexOf(I)>-1}break;case"AboveAverage":m=o.result.length&&dn(C)&&"Text"!==w&&parseFloat(C)>o.result[0];break;case"BelowAverage":m=o.result.length&&dn(C)&&"Text"!==w&&parseFloat(C)<o.result[0];break;default:if(b=!1,x)s[t+"_"+r+"_bars"]||(s[t+"_"+r+"_bars"]=!0,p.applyDataBars(C,o,u,t,w,f));else if(S){if(!s[t+"_"+r]){I=dn(C)?parseFloat(C):NaN;if(isNaN(I)){if(u.style.backgroundColor&&!u.classList.contains("e-yellowft")&&!u.classList.contains("e-greenft")&&!u.classList.value.includes("e-redf")){u.style.backgroundColor="";var E=(0,e.extend)({},p.parent.commonCellStyle,a&&a.style);E.backgroundColor&&p.parent.notify(le,{style:{backgroundColor:E.backgroundColor},td:u,rowIdx:t,colIdx:r})}}else{var N=o.result,R=N.indexOf(I);if(-1===R){if(u.style.backgroundColor){u.style.backgroundColor="";var A=(0,e.extend)({},p.parent.commonCellStyle,a&&a.style);A.backgroundColor&&p.parent.notify(le,{style:{backgroundColor:A.backgroundColor},td:u,rowIdx:t,colIdx:r})}}else{var k=p.getColor(o.type);u.style.backgroundColor=0===R?k[0]:R===N.length-1?k[k.length-1]:3===N.length&&1===R?k[1]:p.getGradient(R,k[0],k[1],k[2],N.length),s[t+"_"+r]=!0}}}}else if(!s[t+"_"+r+"_icons"]){s[t+"_"+r+"_icons"]=!0;var O=p.parent.createElement("span",{className:"e-icon e-iconsetspan"});p.applyIconSet(C,o,u,O,w)&&a&&a.format&&a.format.includes("*")&&"Accounting"!==zs(a.format)&&p.parent.notify(Jt,{cell:a,cellEle:u,rowIdx:t,colIdx:r,updateFillSize:!0,iconSetSpan:O})}}n.isAction&&b&&(p.parent.trigger("beforeConditionalFormat",{conditionalFormat:o,cell:a,element:u,apply:m,address:i(t,r)}),m||!n.isEdit||s[t+"_"+r]||(h?u.className.includes("e-"+h.toLowerCase())&&(u.classList.remove("e-"+h.toLowerCase()),u.style.backgroundColor="",u.style.color="",((y=(0,e.extend)({},p.parent.commonCellStyle,a&&a.style)).backgroundColor||y.color)&&p.parent.notify(le,{rowIdx:t,colIdx:r,td:u,style:{backgroundColor:y.backgroundColor,color:y.color}})):(u.removeAttribute("style"),y=(0,e.extend)({},p.parent.commonCellStyle,a&&a.style),Object.keys(y).length&&p.parent.notify(le,{style:y,rowIdx:t,colIdx:r,td:u}))));m&&!s[t+"_"+r]&&(s[t+"_"+r]=!0,(0,e.removeClass)([u],["e-redft","e-yellowft","e-greenft","e-redf","e-redt"]),h&&(u.classList.add("e-"+h.toLowerCase()),p.setCFStyle(d,o)),Object.assign(u.style,d))};if(n.ele)w(n.indexes[0],n.indexes[1],n.cell,n.ele,n.resizedRowHeight,u);else for(var I=o.range.split(","),E=this.parent.frozenRowCount(a),N=this.parent.frozenColCount(a),R=r(a.topLeftCell),A=0;A<I.length;A++)this.updateRange(a,t(I[A]),E,N,R,w,u)},n.prototype.updateRange=function(e,t,r,n,i,a,o){var s;t[0]=t[0]<r?t[0]<i[0]?i[0]:t[0]:t[0]<this.parent.viewport.topIndex+r?this.parent.viewport.topIndex+r:t[0],t[1]=t[1]<n?t[1]<i[1]?i[1]:t[1]:t[1]<this.parent.viewport.leftIndex+n?this.parent.viewport.leftIndex+n:t[1],t[2]=t[2]<r?t[2]<i[0]?i[0]-1:t[2]:t[2]>this.parent.viewport.bottomIndex?this.parent.viewport.bottomIndex:t[2],t[3]=t[3]<n?t[3]<i[1]?i[1]-1:t[3]:t[3]>this.parent.viewport.rightIndex?this.parent.viewport.rightIndex:t[3];for(var l=t[0];l<=t[2];l++)if(r&&l===r&&(l=this.parent.viewport.topIndex+r),!ml(e,l))for(var d=t[1];d<=t[3];d++)n&&d===n&&(d=this.parent.viewport.leftIndex+n),Al(e,d)||(s=this.parent.getCell(l,d))&&a(l,d,zn(l,d,e),s,void 0,o)},n.prototype.applyIconSet=function(e,t,r,n,i){var a=r.classList.contains("e-iconset"),o=r.querySelector(".e-wrap-content");if(a){r.classList.remove("e-iconset");var s=r.querySelector(".e-iconsetspan");s&&(o?o.removeChild(s):r.removeChild(s))}var l=dn(e)?parseFloat(e):NaN,d=t.result;if(isNaN(l)||void 0===d[0]&&void 0===d[1]||dn(e)&&"Text"===i)return a;var h,p=d[0],c=d[1],u=this.getIconList(t.type).split(",");if(3===u.length){var f=p+.33*(c-p);h="e-"+(l>=p+.67*(c-p)?u[0].trim():l>=f?u[1].trim():u[2].trim())}else if(4===u.length){var g=p+.25*(c-p),m=p+.5*(c-p);h="e-"+(l>=(v=p+.75*(c-p))?u[0].trim():l>=m?u[1].trim():l>=g?u[2].trim():u[3].trim())}else if(5===u.length){g=p+.2*(c-p),m=p+.4*(c-p);var v=p+.6*(c-p);h="e-"+(l>=p+.8*(c-p)?u[0].trim():l>=v?u[1].trim():l>=m?u[2].trim():l>=g?u[3].trim():u[4].trim())}n.classList.add(h);var y=r.querySelector(".e-cf-databar");return y&&(n.style.height=y.style.height,n.classList.add("top"===r.style.verticalAlign?"e-cf-icon-top":"middle"===r.style.verticalAlign?"e-cf-icon-middle":"e-cf-icon-end")),o?o.insertBefore(n,o.firstChild):r.insertBefore(n,r.childNodes[0]),r.classList.add("e-iconset"),!0},n.prototype.getIconList=function(e){switch(e){case"ThreeArrows":return"3arrows-1,3arrows-2,3arrows-3";case"ThreeArrowsGray":return"3arrowsgray-1,3arrowsgray-2,3arrowsgray-3";case"FourArrowsGray":return"4arrowsgray-1,4arrowsgray-2,4arrowsgray-3,4arrowsgray-4";case"FourArrows":return"4arrows-1,4arrows-2,4arrows-3,4arrows-4";case"FiveArrowsGray":return"5arrowsgray-1,5arrowsgray-2,5arrowsgray-3,5arrowsgray-4,5arrowsgray-5";case"FiveArrows":return"5arrows-1,5arrows-2,5arrows-3,5arrows-4,5arrows-5";case"ThreeTrafficLights1":return"3trafficlights-1,3trafficlights-2,3trafficlights-3";case"ThreeTrafficLights2":return"3rafficlights2-1,3rafficlights2-2,3rafficlights2-3";case"ThreeSigns":return"3signs-1,3signs-2,3signs-3";case"FourTrafficLights":return"4trafficlights-1,4trafficlights-2,4trafficlights-3,4trafficlights-4";case"FourRedToBlack":return"4redtoblack-1,4redtoblack-2,4redtoblack-3,4redtoblack-4";case"ThreeSymbols":return"3symbols-1,3symbols-2,3symbols-3";case"ThreeSymbols2":return"3symbols2-1,3symbols2-2,3symbols2-3";case"ThreeFlags":return"3flags-1,3flags-2,3flags-3";case"FourRating":return"4rating-4,4rating-3,4rating-2,4rating-1";case"FiveQuarters":return"5quarters-1,5quarters-2,5quarters-3,5quarters-4,5quarters-5";case"FiveRating":return"5rating-5,5rating-4,5rating-3,5rating-2,5rating-1";case"ThreeTriangles":return"3triangles-1,3triangles-2,3triangles-3";case"ThreeStars":return"3stars-1,3stars-2,3stars-3";case"FiveBoxes":return"5boxes-1,5boxes-2,5boxes-3,5boxes-4,5boxes-5"}return"3arrows-1,3arrows-2,3arrows-3"},n.prototype.applyDataBars=function(e,t,r,n,i,a){var o,s,l=this.parent.getActiveSheet(),d=t.result,h=0;if(dn(e)&&(s=parseFloat(e)),void 0===d[0]&&void 0===d[1]||isNaN(s)||dn(e)&&"Text"===i){var p=r.getElementsByClassName("e-cf-databar")[0];if(p){var c=p.getElementsByClassName("e-databar-value")[0].textContent,u=r.querySelector(".e-hyperlink"),f=r.querySelector(".e-addNoteIndicator"),g=r.querySelector(".e-wrap-content");g?(g.textContent="",u?g.appendChild(u):g.innerText=c):(r.removeChild(p),u?r.appendChild(u):r.innerText=c),f&&r.appendChild(f)}}else{void 0!==d[0]&&void 0!==d[1]?(o=d[0]+Math.abs(d[1]),h=Math.abs(d[1]/o*100)):o=void 0!==d[0]?d[0]:d[1];var m=this.parent.createElement("div",{id:"spreadsheet-databar",className:"e-cf-databar"}),v=this.parent.createElement("span",{id:"spreadsheet-leftspan",className:"e-databar"}),y=this.parent.createElement("span",{id:"spreadsheet-rightspan",className:"e-databar"}),C=this.parent.createElement("span",{id:"spreadsheet-dataspan",className:"e-databar-value"}),b=r.querySelector(".e-iconsetspan"),x=r.querySelector(".e-addNoteIndicator"),S=r.querySelector(".e-wrap-content"),w=a||yl(l,n,!0),I=r.querySelector("#"+this.parent.element.id+"_currency");m.style.height=w-1+"px",b&&(b.style.height=w-1+"px",b.classList.add("top"===r.style.verticalAlign?"e-cf-icon-top":"middle"===r.style.verticalAlign?"e-cf-icon-middle":"e-cf-icon-end")),I&&(I.style.alignItems="top"===r.style.verticalAlign?"start":"middle"===r.style.verticalAlign?"center":"end",I.classList.add("e-cf-currency"));var E=t.type[0];"L"===E&&(E+="B"),void 0===d[1]?(y.style.width=Math.ceil(Math.abs(s/o*100))+"%",y.style.height=w-3+"px",y.style.backgroundColor=this.getColor(E)[0],y.style.left="0px"):void 0===d[0]?(y.style.width=Math.ceil(Math.abs(s/o*100))+"%",y.style.height=w-3+"px",y.style.backgroundColor=this.getColor("R")[0],y.style.left="0px"):s>=0?(v.style.width=h+"%",v.style.height=w-3+"px",v.style.backgroundColor="transparent",v.style.left="0px",y.style.width=Math.ceil(Math.abs(s/o*100))+"%",y.style.height=w-3+"px",y.style.backgroundColor=this.getColor(E)[0],y.style.left=h+"%"):(v.style.width=Math.ceil(Math.abs(s/o*100))+"%",v.style.height=w-3+"px",v.style.backgroundColor=this.getColor("R")[0],v.style.width===h+"%"?v.style.left="0px":v.style.right=100-h+"%"),C.style.fontSize=r.style.fontSize||"11pt",C.style.alignItems="top"===r.style.verticalAlign?"start":"middle"===r.style.verticalAlign?"center":"end",C.style.textDecoration=r.style.textDecoration;var N=r.querySelector("#"+this.parent.element.id+"_currency");N&&m.appendChild(N);var R=r.querySelector(".e-hyperlink");if(R)C.appendChild(R);else{var A=r.querySelector(".e-validation-list")?r.innerText:r.textContent;C.innerText=A,""===A&&C.appendChild(document.createTextNode(A))}m.appendChild(v),m.appendChild(y),m.appendChild(C),r.textContent="",S?(S.textContent="",b&&S.appendChild(b),S.appendChild(m),r.appendChild(S)):(b&&r.insertBefore(b,r.firstElementChild),r.appendChild(m)),x&&r.appendChild(x)}},n.prototype.getColor=function(e){if("LB"===e)return["#008aef"];for(var t=e.split(""),r=[],n=0;n<t.length;n++)switch(t[n]){case"G":r.push("#63be7b");break;case"Y":r.push("#ffeb84");break;case"R":r.push("#f8696b");break;case"W":r.push("#ffffff");break;case"B":r.push("#5a8ac6");break;case"O":r.push("#ffb628");break;case"LB":r.push("#008aef");break;case"P":r.push("#d6007b")}return r},n.prototype.getGradient=function(t,r,n,i,a){if((0,e.isNullOrUndefined)(i))return this.getLinear(r,n,t/a);var o=a/2;return t>=o?this.getLinear(n,i,Math.abs((t-o)/o)):this.getLinear(r,n,t/o)},n.prototype.getLinear=function(e,t,r){return"#"+this.byteLinear(e[1]+e[2],t[1]+t[2],r)+this.byteLinear(e[3]+e[4],t[3]+t[4],r)+this.byteLinear(e[5]+e[6],t[5]+t[6],r)},n.prototype.byteLinear=function(e,t,r){var n=parseInt(e,16)*(1-r)+parseInt(t,16)*r|0;return Math.abs(n).toString(16)},n.prototype.isGreaterThanLessThan=function(e,t,r,n){if(dn(t)&&"Text"!==n){if(dn(r)){var i=new RegExp(/[^.-a-zA-Z 0-9]+/g);return"GreaterThan"===e.type?parseFloat(t)>parseFloat(r.replace(i,"")):parseFloat(t)<parseFloat(r.replace(i,""))}var a={value:r,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};if(this.parent.notify(ue,a),a.isDate||a.isTime)return e.value=a.updatedVal.toString(),"GreaterThan"===e.type?Number(t)>Number(a.updatedVal):Number(t)<Number(a.updatedVal);if(r)return"GreaterThan"===e.type?t.toLowerCase()>r.toLowerCase():t.toLowerCase()<r.toLowerCase()}else if(""===t&&Number(r)>0&&"LessThan"===e.type)return!0;return!1},n.prototype.isBetWeen=function(e,t,r,n,i){var a,o;if(!i){var s=new RegExp(/[^.-a-zA-Z 0-9]+/g);r=r.replace(s,""),n=n.replace(s,"")}if(dn(r)){var l=parseFloat(r),d=parseFloat(n);return l>d&&(l=(a=[d,l])[0],d=a[1]),parseFloat(t)>=l&&parseFloat(t)<=d}if(r&&n){var h={value:r,cell:{},updatedVal:""},p={value:n,cell:{},updatedVal:""};return this.parent.notify(ue,h),this.parent.notify(ue,p),(h.isDate||h.isTime)&&(p.isDate||p.isTime)?(e.value=h.updatedVal+","+p.updatedVal,h.updatedVal>p.updatedVal&&(o=[p.updatedVal,h.updatedVal],h.updatedVal=o[0],p.updatedVal=o[1]),t>=h.updatedVal&&t<=p.updatedVal):t.toLowerCase()>=r.toLowerCase()&&t.toLowerCase()<=n.toLowerCase()}return!1},n.prototype.isEqualTo=function(e,t,r){if(dn(r)){if(""===t)return 0===parseFloat(r);var n=new RegExp(/[^.-a-zA-Z 0-9]+/g);return parseFloat(t)===parseFloat(r.replace(n,""))}if(t&&r){var i={value:r,cell:{},updatedVal:""};return this.parent.notify(ue,i),i.isTime||i.isDate?(e.value=i.updatedVal,t===i.updatedVal):t.toLowerCase()===r.toLowerCase()}return!1},n.prototype.isContainsText=function(e,t){var r=new RegExp(/[^.-a-zA-Z 0-9]+/g);return dn(t.replace(r,""))?(t=t.replace(r,""),ln(e)&&(e=sn(e).toString()),e.indexOf(t)>-1):ln(t)?(ln(e)&&(e=sn(e).toString()),e.indexOf(sn(t).toString())>-1):e.toLowerCase().indexOf(t.toLowerCase())>-1},n.prototype.setCFStyle=function(e,t){switch(t.cFColor){case"RedFT":e.backgroundColor="#ffc7ce",e.color="#9c0055";break;case"YellowFT":e.backgroundColor="#ffeb9c",e.color="#9c6500";break;case"GreenFT":e.backgroundColor="#c6efce",e.color="#006100";break;case"RedF":e.backgroundColor="#ffc7ce";break;case"RedT":e.color="#9c0055"}return e},n.prototype.getModuleName=function(){return"conditionalFormatting"},n}(),Dh=u(295),Lh=function(){function r(e){this.fillOptionIndex=0,this.parent=e,this.addEventListener()}return r.prototype.getfillItems=function(){var e=this.parent.serviceLocator.getService(Dl);return[{text:e.getConstant("CopyCells")},{text:e.getConstant("FillSeries")},{text:e.getConstant("FillFormattingOnly")},{text:e.getConstant("FillWithoutFormatting")}]},r.prototype.createAutoFillElement=function(){if(this.parent.allowAutoFill){var e=this.parent.getMainContent(),t=this.parent.createElement("div",{className:"e-autofill"});e.lastElementChild&&e.lastElementChild.classList.contains("e-ss-overlay")?e.insertBefore(t,e.getElementsByClassName("e-ss-overlay")[0]):e.appendChild(t),this.autoFillElement=t,this.autoFillDropDown&&(this.autoFillDropDown.destroy(),this.autoFillDropDown=null),this.getautofillDDB({id:this.parent.element.id+"_autofilloptionbtn",appendElem:e})}},r.prototype.getautofillDDB=function(e){var t=this;return this.splitBtnElem=this.parent.createElement("button",{id:e.id,className:"e-filloption",attrs:{type:"button"}}),this.splitBtnElem.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text"})),this.autoFillDropDown=new Dh.DropDownButton({cssClass:"e-dragfill-ddb",iconCss:"e-icons e-dragfill-icon",items:this.getfillItems(),createPopupOnClick:!0,enableRtl:this.parent.enableRtl,select:function(e){t.autoFillOptionClick({type:t.getFillType(e.item.text)})},beforeOpen:function(){return t.autoFillClick()}}),this.autoFillDropDown.createElement=this.parent.createElement,this.autoFillDropDown.appendTo(this.splitBtnElem),e.appendElem.appendChild(this.splitBtnElem),this.autoFillDropDown},r.prototype.getFillType=function(e){var t=this.parent.serviceLocator.getService(Dl);return e===t.getConstant("CopyCells")?"CopyCells":e===t.getConstant("FillSeries")?"FillSeries":e===t.getConstant("FillFormattingOnly")?"FillFormattingOnly":"FillWithoutFormatting"},r.prototype.autoFillClick=function(){var e=this.parent.serviceLocator.getService(Dl),t={fillType:"FillSeries",disableItems:[""]};this.parent.notify($t,t),this.autoFillDropDown.setProperties({items:this.getfillItems()},!0),this.autoFillDropDown.removeItems(t.disableItems),this.refreshAutoFillOption(e.getConstant(t.fillType))},r.prototype.getFillRange=function(e,t,r,n){switch(n){case"Up":return[r.rowIndex,e.colIndex,e.rowIndex-1,t.colIndex];case"Right":return[e.rowIndex,t.colIndex+1,t.rowIndex,r.colIndex];case"Down":return[t.rowIndex+1,e.colIndex,r.rowIndex,t.colIndex];case"Left":return[e.rowIndex,r.colIndex,t.rowIndex,e.colIndex-1]}},r.prototype.autoFillOptionClick=function(e){var r=this.parent.serviceLocator.getService(Dl),n=this.parent.getActiveSheet(),i=c(t(this.parent.selectionModule.dAutoFillCell)),o=t(n.selectedRange),s=i[0],l=i[1],d=i[2],h=i[3],p=this.getDirection({rowIndex:d,colIndex:h},{rowIndex:o[2],colIndex:o[3]}),u=[s,l,d,h],f=this.getFillRange({rowIndex:s,colIndex:l},{rowIndex:d,colIndex:h},{rowIndex:o[2],colIndex:o[3]},p);this.refreshAutoFillOption(r.getConstant(e.type));var g={isUndo:!0,isPublic:!0,preventReSelect:!0,preventEvt:"FillWithoutFormatting"===e.type,setCollection:"FillFormattingOnly"===e.type||"FillWithoutFormatting"===e.type,isFromAutoFillOption:!0};this.parent.notify(wa,g);var m={dataRange:n.name+"!"+a(u),fillRange:n.name+"!"+a(f),direction:p,fillType:e.type,isFillOptClick:!0};this.isVerticalFill="Down"===m.direction||"Up"===m.direction,this.parent.notify(Xt,m),this.positionAutoFillElement({isautofill:!0});var v={dataRange:m.dataRange,fillRange:m.fillRange,fillType:m.fillType,direction:m.direction,selectedRange:n.name+"!"+a(o),undoArgs:g.undoArgs};this.parent.notify(Pa,{eventArgs:v,action:"autofill"}),this.parent.showAggregate&&this.parent.notify(po,{}),this.autoFillClick()},r.prototype.refreshAutoFillOption=function(e){for(var t=0;t<this.autoFillDropDown.items.length;t++)this.autoFillDropDown.items[t].iconCss="";for(t=0;t<this.autoFillDropDown.items.length;t++)this.autoFillDropDown.items[t].text===e&&(this.autoFillDropDown.items[t].iconCss="e-icons e-selected-icon");["Copy Cells","Fill Series","Fill Formatting Only","Fill Without Formatting"].indexOf(e)<0&&(this.autoFillDropDown.items[this.fillOptionIndex].iconCss=""),this.autoFillDropDown.dataBind()},r.prototype.positionAutoFillElement=function(r){var n,i,a,o=0,s=0,l=this.parent.getActiveSheet(),d=c(t(l.selectedRange)),h=-5,p=-5,u=6,f=6,g=0===d[1]&&d[3]===l.colCount-1,m=0===d[0]&&d[2]===l.rowCount-1,v=d[2],y=d[3],C=this.parent.enableRtl,b=this.parent.getCell(v,y);if(Al(l,d[3])||ml(l,d[2])||b&&b.classList.contains("e-formularef-selection")||l.isProtected&&l.protectSettings.selectUnLockedCells&&Bd(this.parent,d))this.hideAutoFillElement();else if(l.isProtected&&(l.protectSettings.selectCells||l.protectSettings.selectUnLockedCells)||!l.isProtected)if(g?(h=-5,p=-1,u=6,f=2,v=d[2],y=d[1]):m&&(p=-5,h=0,u=1,f=6,v=d[0],y=d[3]),l.frozenColumns||l.frozenRows){if(m||g?(Zl(this.parent,this.autoFillElement,d,"e-autofill",r&&r.preventAnimation),this.parent.autoFillSettings.showFillOptions&&r&&r.isautofill&&Zl(this.parent,this.autoFillDropDown.element,d,"e-filloption")):(Zl(this.parent,this.autoFillElement,[v,y,v,y],"e-autofill",r&&r.preventAnimation),this.parent.autoFillSettings.showFillOptions&&r&&r.isautofill&&Zl(this.parent,this.autoFillDropDown.element,[v,y,v,y],"e-filloption")),this.autoFillElement){this.autoFillCell={rowIndex:v,colIndex:y};var x=this.parent.element.querySelectorAll(".e-autofill");if(x.length){var S=x[0].getBoundingClientRect();this.autoFillElementPosition={left:S.left,top:S.top},[].slice.call(x).forEach((function(t){(0,e.removeClass)([t],"e-hide")}))}}}else if(a=$l(l,[v,y,v,y],this.parent.frozenRowCount(l),this.parent.frozenColCount(l),this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth),n=bl(l,v,v,!0),i=Rl(l,y,y,!0),m||(o+=n),g||(s+=i),o+=Math.round(a.top)+h,s+=Math.round(a.left)+p,this.autoFillElement){(0,e.removeClass)([this.autoFillElement],"e-hide"),this.autoFillElement.style.top=o+"px",C?this.autoFillElement.style.right=s+"px":this.autoFillElement.style.left=s+"px",this.autoFillCell={rowIndex:v,colIndex:y};S=this.autoFillElement.getBoundingClientRect();if(this.autoFillElementPosition={left:S.left,top:S.top},this.parent.autoFillSettings.showFillOptions&&r&&r.isautofill){(0,e.removeClass)([this.autoFillDropDown.element],"e-hide");var w=this.parent.element.querySelector(".e-main-panel"),I=this.parent.element.querySelector(".e-main-panel .e-sheet-content .e-virtualable"),E=this.parent.element.querySelector(".e-sheet-panel .e-scrollbar .e-scroller"),N=I&&I.clientHeight<w.clientHeight?w.clientHeight-I.clientHeight:0,R=I&&I.clientWidth<w.clientWidth?w.clientWidth-I.clientWidth:0,A=this.autoFillDropDown.element.getBoundingClientRect();w.scrollTop+w.clientHeight-N<o+A.height&&(o-=A.height),E.scrollLeft+E.clientWidth-R<s+A.width&&(s-=A.width),this.autoFillDropDown.element.style.top=o+u+"px",C?this.autoFillDropDown.element.style.right=s+f+"px":this.autoFillDropDown.element.style.left=s+f+"px"}}},r.prototype.hideAutoFillElement=function(){var t=this.parent.element;[].slice.call(t.querySelectorAll(".e-autofill")).forEach((function(r){t&&(0,e.addClass)([r],"e-hide")}))},r.prototype.hideAutoFillOptions=function(){var t=this.parent.element;[].slice.call(t.querySelectorAll(".e-filloption")).forEach((function(r){t&&(0,e.addClass)([r],"e-hide")}))},r.prototype.selectAutoFillRange=function(e){var r,n={clientY:cd(e.e),target:e.e.target},i={clientX:pd(e.e),target:e.e.target},a=this.parent.getActiveSheet();this.parent.notify(No,n),this.parent.notify(Ro,i);var o=this.getAutoFillRange({rowIndex:n.clientY,colIndex:i.clientX});return r=o&&o.fillRange?[o.startCell.rowIndex,o.startCell.colIndex,o.endCell.rowIndex,o.endCell.colIndex]:t(a.selectedRange),e.indexes=r,r},r.prototype.getAutoFillRange=function(e){var r=this.parent.getActiveSheet(),n=this.autoFillCell,i=c(t(r.selectedRange)),a=i[0],o=i[1],s=i[2],l=i[3],d=Or(i,[e.rowIndex,e.colIndex,e.rowIndex,e.colIndex],!0),h={rowIndex:a,colIndex:o},p={rowIndex:i[0],colIndex:i[1]},u={rowIndex:i[2],colIndex:i[3]},f={rowIndex:s,colIndex:l},g=this.modifyRangeForMerge(e.rowIndex,e.colIndex,n.rowIndex,n.colIndex,i);return e.rowIndex<n.rowIndex?a-e.rowIndex>e.colIndex-l&&a-e.rowIndex>o-e.colIndex?d?{startCell:h,endCell:{rowIndex:e.rowIndex,colIndex:l}}:{startCell:f,endCell:{rowIndex:g.rowIndex,colIndex:o},fillRange:[g.rowIndex,o,a-1,l],direction:"Up"}:e.colIndex>n.colIndex?{startCell:h,endCell:{rowIndex:s,colIndex:e.colIndex},fillRange:[a,l+1,s,e.colIndex],direction:"Right"}:e.colIndex<n.colIndex?d?{startCell:h,endCell:f}:{startCell:f,endCell:{rowIndex:a,colIndex:e.colIndex},fillRange:[a,e.colIndex,s,o-1],direction:"Left"}:{startCell:p,endCell:u}:e.colIndex>n.colIndex?e.rowIndex-s>e.colIndex-l?{startCell:h,endCell:{rowIndex:e.rowIndex,colIndex:l},fillRange:[s+1,o,e.rowIndex,l],direction:"Down"}:{startCell:h,endCell:{rowIndex:s,colIndex:g.colIndex},fillRange:[a,l+1,s,g.colIndex],direction:"Right"}:e.colIndex<n.colIndex?e.rowIndex-s>l-e.colIndex||e.rowIndex-a>l-e.colIndex&&e.rowIndex!==s?{startCell:h,endCell:{rowIndex:e.rowIndex,colIndex:l},fillRange:[s+1,o,e.rowIndex,l],direction:"Down"}:d?{startCell:h,endCell:f}:{startCell:f,endCell:{rowIndex:a,colIndex:g.colIndex},fillRange:[a,g.colIndex,s,o-1],direction:"Left"}:e.rowIndex>n.rowIndex?{startCell:h,endCell:{rowIndex:g.rowIndex,colIndex:l},fillRange:[s+1,o,g.rowIndex,l],direction:"Down"}:(e.rowIndex===n.rowIndex&&(e.colIndex,n.colIndex),{startCell:p,endCell:u})},r.prototype.modifyRangeForMerge=function(e,t,r,n,i){var a={rowIndex:e,colIndex:t};if(this.isMergedRange(i)){var o=i[2]-i[0]+1,s=i[3]-i[1]+1,l=void 0;e<r?(l=(i[2]-e+1)%o)&&e-(o-l)>=0&&(a.rowIndex=e-(o-l)):t>n?(l=(t-i[1]+1)%s)&&(a.colIndex=t+(s-l)):t<n?(l=(i[3]-t+1)%s)&&t-(s-l)>=0&&(a.colIndex=t-(s-l)):e>r&&(l=(e-i[0]+1)%o)&&(a.rowIndex=e+(o-l))}return a},r.prototype.performAutoFill=function(e){if(!e.rangeInfo&&(e.event.clientX>this.autoFillElementPosition.left&&e.event.clientX<this.autoFillElementPosition.left+10)&&(e.event.clientY>this.autoFillElementPosition.top&&e.event.clientY<this.autoFillElementPosition.top+10))this.positionAutoFillElement({isautofill:!1});else{var r=void 0;if(e.rangeInfo)r=e.rangeInfo;else{var n={clientY:cd(e.event),target:e.event.target},i={clientX:pd(e.event),target:e.event.target};this.parent.notify(No,n),this.parent.notify(Ro,i),r=this.getAutoFillRange({rowIndex:n.clientY,colIndex:i.clientX})}var o=this.parent.getActiveSheet();if(r&&r.fillRange){var s={dataRange:o.name+"!"+e.dAutoFillCell,fillRange:o.name+"!"+a(r.fillRange),direction:r.direction,fillType:e.fillType||this.parent.autoFillSettings.fillType,cancel:!1};if(Qr(this.parent,t(e.dAutoFillCell))||Qr(this.parent,r.fillRange))return void this.parent.notify(to,null);if(this.parent.notify(K,{eventArgs:s,action:"autofill"}),s.cancel)return;var l=Bd(this.parent,r.fillRange);if(o.isProtected&&l)return void this.parent.notify(eo,null);e.rangeInfo?this.performAutoFillAction(s,null,l):(this.performAutoFillAction(s,r,l),this.positionAutoFillElement({isautofill:!0}))}}},r.prototype.refreshCell=function(e){this.parent.serviceLocator.getService("cell").refreshRange([e.rowIndex,e.colIndex,e.rowIndex,e.colIndex])},r.prototype.getDirection=function(t,r,n){if(n=(0,e.isNullOrUndefined)(n)?this.isVerticalFill:n){if(r.rowIndex<t.rowIndex)return"Up";if(r.rowIndex>t.rowIndex)return"Down";if(r.colIndex>t.colIndex)return"Right";if(r.colIndex<t.colIndex)return"Left"}else{if(r.colIndex>t.colIndex)return"Right";if(r.colIndex<t.colIndex)return"Left";if(r.rowIndex<t.rowIndex)return"Up";if(r.rowIndex>t.rowIndex)return"Down"}return null},r.prototype.performAutoFillAction=function(e,r,n){var i=this,o=this.parent.getActiveSheet(),s=this.parent.serviceLocator.getService(Dl);if(this.isMergedRange(t(e.fillRange))){var l=this.parent.serviceLocator.getService(Ll);l.show({isModal:!0,showCloseIcon:!0,height:180,width:400,content:s.getConstant("AutoFillMergeAlertMsg"),buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(Dl).getConstant("Ok"),isPrimary:!0},click:function(){l.hide(),i.parent.selectRange(e.dataRange)}}],close:function(){l.hide(),i.parent.selectRange(e.dataRange)}},!1)}else{this.isVerticalFill="Down"===e.direction||"Up"===e.direction,this.parent.notify(Xt,{dataRange:e.dataRange,fillRange:e.fillRange,direction:e.direction,fillType:e.fillType,isLockedCell:n});var d=r?a([r.startCell.rowIndex,r.startCell.colIndex,r.endCell.rowIndex,r.endCell.colIndex]):o.selectedRange;An(this.parent,d,o);var h={dataRange:e.dataRange,fillRange:e.fillRange,fillType:e.fillType,direction:e.direction,selectedRange:d};this.parent.notify(Pa,{eventArgs:h,action:o.conditionalFormats&&o.conditionalFormats.length>0&&"autofillWithCF"===o.conditionalFormats[o.conditionalFormats.length-1].action?"autofillWithCF":"autofill"}),this.parent.trigger("select",{range:this.parent.getActiveSheet().selectedRange}),this.parent.showAggregate&&this.parent.notify(po,{}),this.parent.notify(Mt,null)}},r.prototype.getRangeData=function(e){for(var t,r=[],n=this.parent.getActiveSheet(),i=e.range[0],a=e.range[1],o=e.range[2],s=e.range[3],l=a;i<=o;)if(ml(n,i))i++;else{for(a=l;a<=s;)Al(n,a)||(t=zn(i,a,n),r.push(t)),a++;i++}return r},r.prototype.isMergedRange=function(e){var t=0,r=this.getRangeData({range:e,sheetIdx:this.parent.activeSheetIndex});for(t=0;t<r.length;t++)if(r[t]&&(r[t].rowSpan||r[t].colSpan))return!0;return!1},r.prototype.addEventListener=function(){this.parent.on(ii,this.createAutoFillElement,this),this.parent.on(Qo,this.positionAutoFillElement,this),this.parent.on(es,this.hideAutoFillOptions,this),this.parent.on(is,this.hideAutoFillElement,this),this.parent.on(ts,this.performAutoFill,this),this.parent.on(rs,this.selectAutoFillRange,this),this.parent.on(Kt,this.refreshCell,this),this.parent.on(Zt,this.getautofillDDB,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ii,this.createAutoFillElement),this.parent.off(Qo,this.positionAutoFillElement),this.parent.off(es,this.hideAutoFillOptions),this.parent.off(is,this.hideAutoFillElement),this.parent.off(ts,this.performAutoFill),this.parent.off(rs,this.selectAutoFillRange),this.parent.off(Kt,this.refreshCell),this.parent.off(Zt,this.getautofillDDB))},r.prototype.destroy=function(){this.removeEventListener(),this.autoFillElement&&this.autoFillElement.remove(),this.autoFillElement=null,this.autoFillElementPosition=null,this.autoFillCell=null,this.autoFillDropDown&&this.autoFillDropDown.destroy(),this.autoFillDropDown=null,this.isVerticalFill=null,this.fillOptionIndex=null,this.splitBtnElem&&(jl(this.splitBtnElem),this.splitBtnElem.remove()),this.splitBtnElem=null,this.parent=null},r.prototype.getModuleName=function(){return"autofill"},r}(),Ph=function(){function t(e){this.isNoteVisible=!1,this.isNoteVisibleOnTouch=!1,this.parent=e,this.addEventListener()}return t.prototype.destroy=function(){if(this.removeEventListener(),!this.parent.isDestroyed&&!this.parent.refreshing)for(var t=this.parent.element.getElementsByClassName("e-addNoteIndicator");t.length;){var r=(0,e.closest)(t[0],".e-cell");r&&(e.EventHandler.remove(r,"mouseover",this.mouseOver),e.EventHandler.remove(r,"mouseout",this.mouseOut)),(0,e.detach)(t[0])}this.parent=null,this.isNoteVisible=null},t.prototype.addEventListener=function(){this.parent.on(ca,this.addNote,this),this.parent.on(ua,this.editNote,this),this.parent.on(fa,this.deleteNote,this),this.parent.on(ma,this.createNoteIndicator,this),this.parent.on(ga,this.showNote,this),this.parent.on(ya,this.removeNoteContainer,this),this.parent.on(va,this.updateNoteContainer,this)},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ca,this.addNote),this.parent.off(ua,this.editNote),this.parent.off(ga,this.showNote),this.parent.off(fa,this.deleteNote),this.parent.off(ma,this.createNoteIndicator),this.parent.off(ya,this.removeNoteContainer),this.parent.off(va,this.updateNoteContainer))},t.prototype.getModuleName=function(){return"spreadsheetNote"},t.prototype.addNote=function(){var t=(0,e.isNullOrUndefined)(this.noteCellIndexes)?r(this.parent.getActiveSheet().activeCell):this.noteCellIndexes,n=this.parent.getCell(t[0],t[1]);!(0,e.isNullOrUndefined)(n)&&(0===n.children.length||n.children.length>0&&-1===n.children[n.childElementCount-1].className.indexOf("e-addNoteIndicator"))&&(this.createNoteIndicator({targetElement:n,rowIndex:t[0],columnIndex:t[1]}),this.createNoteContainer(n,t[0],t[1],!1,!0))},t.prototype.deleteNote=function(t){var n=r(this.parent.getActiveSheet().activeCell),i=(0,e.isNullOrUndefined)(t)||(0,e.isNullOrUndefined)(t.rowIndex)?n[0]:t.rowIndex,a=(0,e.isNullOrUndefined)(t)||(0,e.isNullOrUndefined)(t.columnIndex)?n[1]:t.columnIndex,o=this.parent.getCell(i,a);if(o.children.length>0&&o.children[o.children.length-1].className.indexOf("e-addNoteIndicator")>-1){o.removeChild(o.children[o.children.length-1]),e.EventHandler.remove(o,"mouseover",this.mouseOver),e.EventHandler.remove(o,"mouseout",this.mouseOut);var s=Pn(this.parent,this.parent.activeSheetIndex)+"!"+this.parent.getActiveSheet().activeCell,l=zn(i,a,this.parent.getActiveSheet());if(!(0,e.isNullOrUndefined)(t)&&t.isDeleteFromMenu&&this.parent.notify(Ea,{args:{action:"beforeCellSave",eventArgs:{address:s}}}),!(0,e.isNullOrUndefined)(l)&&l.notes&&delete l.notes,!(0,e.isNullOrUndefined)(t)&&t.isDeleteFromMenu){var d={notes:l.notes,address:s};this.parent.notify(Pa,{eventArgs:d,action:"deleteNote"}),this.isShowNote=null}}},t.prototype.editNote=function(){var t=(0,e.isNullOrUndefined)(this.noteCellIndexes)?r(this.parent.getActiveSheet().activeCell):this.noteCellIndexes;this.showNote({rowIndex:t[0],columnIndex:t[1],isNoteEditable:!0});var n=document.getElementsByClassName("e-addNoteContainer")[0];Vr(this.parent,this.parent.getActiveSheet(),{rowIdx:t[0],colIdx:t[1],preventEvt:!0,cell:{isNoteEditable:!0}}),n&&this.getNoteFocus(n)},t.prototype.createNoteIndicator=function(t){var r=this.parent.createElement("div",{className:"e-addNoteIndicator",styles:"position: absolute;top: 0;right: 0;width: 0;height: 0;border-left: 8px solid transparent;border-top: 8px solid red;cursor: pointer;"});if(t.targetElement.children.length>0)for(var n=yl(this.parent.getActiveSheet(),t.rowIndex),i=0;i<t.targetElement.childElementCount;i++)t.targetElement.children[i].className.indexOf("e-filter-btn")>-1&&(r.style.right=(n<30?t.targetElement.children[i].getBoundingClientRect().width<=0?20:t.targetElement.children[i].getBoundingClientRect().width:2)+"px"),t.targetElement.children[i].className.indexOf("e-validation-list")>-1&&(r.style.right=(t.targetElement.children[i].getBoundingClientRect().width||20)+2+"px");(!(0,e.isNullOrUndefined)(t.targetElement)&&0===t.targetElement.children.length||t.targetElement.children.length>0&&-1===t.targetElement.children[t.targetElement.childElementCount-1].className.indexOf("e-addNoteIndicator"))&&(t.skipEvent||(e.EventHandler.add(t.targetElement,"mouseover",this.mouseOver,[this,t.rowIndex,t.columnIndex]),e.EventHandler.add(t.targetElement,"mouseout",this.mouseOut,this)),t.targetElement.appendChild(r))},t.prototype.mouseOver=function(){var t=this,r=t[0];(r.isNoteVisibleOnTouch&&!(0,e.isNullOrUndefined)(document.getElementsByClassName("e-addNoteContainer")[0])||(0,e.isNullOrUndefined)(document.getElementsByClassName("e-addNoteContainer")[0]))&&((0,e.isNullOrUndefined)(document.getElementsByClassName("e-addNoteContainer")[0])||r.removeNoteContainer(),r.showNote({rowIndex:t[1],columnIndex:t[2],isNoteEditable:!1}),r.isNoteVisible=!0)},t.prototype.mouseOut=function(t){!this.isNoteVisible||this.isNoteVisibleOnTouch||(0,e.isNullOrUndefined)(document.getElementsByClassName("e-addNoteContainer")[0])||-1!==document.activeElement.className.indexOf("e-addNoteContainer")||(0,e.isNullOrUndefined)(t.relatedTarget)||-1!==t.relatedTarget.className.indexOf("e-connectorLine")||-1!==t.relatedTarget.className.indexOf("e-addNoteContainer")||(this.removeNoteContainer(),this.isNoteVisible=!1)},t.prototype.createNoteContainer=function(t,r,n,i,a){var o=zn(r,n,this.parent.getActiveSheet()),s=t.getBoundingClientRect(),l=this.parent.createElement("textarea",{className:"e-addNoteContainer"});this.createContainer(l,o,s,i),this.createConnectorLine(l,s),a&&this.getNoteFocus(l),e.EventHandler.add(l,"mouseout",this.mouseOut,this),e.EventHandler.add(document.getElementsByClassName("e-connectorLine")[0],"mouseout",this.mouseOut,this)},t.prototype.getNoteFocus=function(e){e.selectionStart=e.value.length,e.focus()},t.prototype.createContainer=function(t,r,n,i){var a=5;!(0,e.isNullOrUndefined)(document.getElementsByClassName("e-select-all-cell")[0])&&!(0,e.isNullOrUndefined)(document.getElementsByClassName("e-scroller")[0])&&n.top>=document.getElementsByClassName("e-select-all-cell")[0].getBoundingClientRect().bottom&&n.right>=document.getElementsByClassName("e-select-all-cell")[0].getBoundingClientRect().right&&n.bottom<=document.getElementsByClassName("e-scroller")[0].getBoundingClientRect().top&&n.right<=document.getElementsByClassName("e-scroller")[0].getBoundingClientRect().width?(t.style.display="block",a=n.top===document.getElementsByClassName("e-select-all-cell")[0].getBoundingClientRect().bottom?0:a):t.style.display="none";var o=this.parent.element.getBoundingClientRect(),s=this.parent.element.style.getPropertyValue("position");t.style.position="absolute",t.style.top=n.top-(o.top-("absolute"===s?0:this.parent.element.offsetTop))-a+"px",t.style.left=n.left+n.width-(o.left-("absolute"===s?0:this.parent.element.offsetLeft))+10+"px",t.style.width="120px",t.style.height="120px",t.style.zIndex="5",t.style.color="black",t.style.backgroundColor="lightyellow",!i||(0,e.isNullOrUndefined)(r)||(0,e.isNullOrUndefined)(r.notes)?t.innerHTML="":t.innerHTML=r.notes,this.parent.element.appendChild(t)},t.prototype.createConnectorLine=function(e,t){var r=this.parent.createElement("canvas",{className:"e-connectorLine",styles:"width: 100px; position: absolute;  z-index: 1;"}),n=r.getContext("2d"),i=this.parent.element.getBoundingClientRect(),a=this.parent.element.style.getPropertyValue("position");r.style.left=t.left+t.width-(i.left-("absolute"===a?0:this.parent.element.offsetLeft))+"px",r.style.top=e.getBoundingClientRect().top-(i.top-("absolute"===a?0:this.parent.element.offsetTop))-5+"px",n.clearRect(0,0,r.width,r.height),n.beginPath(),e.getBoundingClientRect().top===t.top?(n.moveTo(0,16),n.lineTo(30,15)):(n.moveTo(0,30),n.lineTo(30,15)),n.strokeStyle="black",n.lineWidth=5,n.stroke(),this.parent.element.appendChild(r),e.getBoundingClientRect().top>0?(r.style.display="block",r.style.zIndex="4"):r.style.display="none"},t.prototype.showNote=function(t){var r=(0,e.isNullOrUndefined)(this.parent.getCell(t.rowIndex,t.columnIndex))?t.cellElement:this.parent.getCell(t.rowIndex,t.columnIndex),n=document.getElementById(this.parent.element.id+"_contextmenu"),i=(0,e.isNullOrUndefined)(n)?"none":n.style.getPropertyValue("display"),a=!!t.isNoteEditable||"block"!==i;!(0,e.isNullOrUndefined)(r)&&(0,e.isNullOrUndefined)(document.getElementsByClassName("e-addNoteContainer")[0])&&a&&(t.isScrollWithNote||null!==r.children&&r.children.length>0&&r.children[r.children.length-1].classList.contains("e-addNoteIndicator"))&&(this.createNoteContainer(r,t.rowIndex,t.columnIndex,!0,t.isNoteEditable),this.noteCellIndexes=[t.rowIndex,t.columnIndex])},t.prototype.removeNoteContainer=function(){e.EventHandler.remove(document.getElementsByClassName("e-addNoteContainer")[0],"mouseout",this.mouseOut),e.EventHandler.remove(document.getElementsByClassName("e-connectorLine")[0],"mouseout",this.mouseOut),this.parent.element.removeChild(document.getElementsByClassName("e-addNoteContainer")[0]),this.parent.element.removeChild(document.getElementsByClassName("e-connectorLine")[0]),this.noteCellIndexes=null,this.isNoteVisible=!1,this.isNoteVisibleOnTouch=!1},t.prototype.updateNoteContainer=function(){this.parent.selectionModule.isNoteActiveElement=document.activeElement.className.indexOf("e-addNoteContainer")>-1||this.parent.selectionModule.isNoteActiveElement;var t=(0,e.isNullOrUndefined)(this.noteCellIndexes)?r(this.parent.getActiveSheet().activeCell):this.noteCellIndexes,n=zn(t[0],t[1],this.parent.getActiveSheet()),i=document.getElementsByClassName("e-addNoteContainer")[0];if(((0,e.isNullOrUndefined)(n)||(0,e.isNullOrUndefined)(n.notes)||n.notes!==i.value)&&this.parent.selectionModule.isNoteActiveElement){var o=Pn(this.parent,this.parent.activeSheetIndex)+"!"+a(t);this.parent.notify(Ea,{args:{action:"beforeCellSave",eventArgs:{address:o}}});var s=!(0,e.isNullOrUndefined)(n)&&n.notes?"editNote":"addNote";Vr(this.parent,this.parent.getActiveSheet(),{rowIdx:t[0],colIdx:t[1],preventEvt:!0,cell:{notes:i.value,isNoteEditable:!0}});var l={notes:i.value,address:o};this.parent.notify(Pa,{eventArgs:l,action:s}),this.isShowNote=null}if(this.isShowNote=(0,e.isNullOrUndefined)(this.isShowNote)?this.parent.selectionModule.isNoteActiveElement:this.isShowNote,this.isShowNote){var d=!(0,e.isNullOrUndefined)(n)&&!(0,e.isNullOrUndefined)(n.isNoteEditable)&&n.isNoteEditable;this.parent.notify(ya,""),this.parent.notify(ga,{rowIndex:t[0],columnIndex:t[1],isNoteEditable:!0,isScrollWithNote:d})}else this.parent.notify(ya,""),this.isShowNote=null},t}(),Mh=function(){function t(e){this.parent=e}return t.prototype.show=function(t,r){var n,i=this;r=!!(0,e.isNullOrUndefined)(r);var a=t.beforeOpen||null,o=t.close||null,s={header:"Spreadsheet",cssClass:this.parent.cssClass,target:this.parent.element,buttons:[],allowDragging:!0};t.beforeOpen=function(e){a&&(a(e),e.cancel&&(i.hide(!0),e.preventFocus||Md(i.parent.element)))},t.close=function(){i.destroyDialog(),o&&o()},(0,e.extend)(s,t),r&&(n=this.parent.serviceLocator.getService(Dl).getConstant(s.buttons.length?"Cancel":"Ok"),s.buttons.push({buttonModel:{content:n,isPrimary:0===s.buttons.length},click:this.hide.bind(this)}));var l=this.parent.createElement("div");document.body.appendChild(l),this.dialogInstance=new fh.Dialog(s),this.dialogInstance.createElement=this.parent.createElement,this.dialogInstance.appendTo(l),this.dialogInstance&&this.dialogInstance.refreshPosition()},t.prototype.destroyDialog=function(){this.dialogInstance.destroy(),(0,e.remove)(this.dialogInstance.element),this.dialogInstance=null},t.prototype.hide=function(e){this.dialogInstance&&(e&&(this.dialogInstance.animationSettings.effect="None",this.dialogInstance.dataBind()),this.dialogInstance.hide())},t.prototype.destroy=function(){this.parent=null},t}(),Bh=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.initializeActionBegin=function(){var e=this,t=this.parent.beforeCellFormat;this.parent.beforeCellFormat=function(r){e.actionEventHandler({evtArgs:r,evtFunc:t,actionType:"begin",eventType:"format"})};var r=this.parent.beforeOpen;this.parent.beforeOpen=function(t){e.actionEventHandler({evtArgs:t,evtFunc:r,actionType:"begin",eventType:"beforeOpen"})};var n=this.parent.beforeSave;this.parent.beforeSave=function(t){e.actionEventHandler({evtArgs:t,evtFunc:n,actionType:"begin",eventType:"beforeSave"})};var i=this.parent.beforeSort;this.parent.beforeSort=function(t){e.actionEventHandler({evtArgs:t,evtFunc:i,actionType:"begin",eventType:"beforeSort"})}},e.prototype.initializeActionComplete=function(){var e=this,t=this.parent.sortComplete;this.parent.sortComplete=function(r){e.actionEventHandler({evtArgs:r,evtFunc:t,actionType:"complete",eventType:"sorting"})};var r=this.parent.cellSave;this.parent.cellSave=function(t){e.actionEventHandler({evtArgs:t,evtFunc:r,actionType:"complete",eventType:"cellSave"})}},e.prototype.actionEventHandler=function(e){e.evtFunc&&e.evtFunc.apply(this,[e]),"begin"===e.actionType?this.actionBeginHandler({eventArgs:e.evtArgs,action:e.eventType}):this.actionCompleteHandler({eventArgs:e.evtArgs,action:e.eventType})},e.prototype.actionBeginHandler=function(e){var t=e.preventAction;delete e.preventAction;var r={action:e.action};e.isUndo&&(r.isUndo=!0,delete e.isUndo),e.isRedo&&(r.isUndo=!1,delete e.isRedo),r.args=e,this.parent.trigger("actionBegin",r),t||this.parent.isPrintingProcessing||"clipboard"!==e.action&&"format"!==e.action&&"cellSave"!==e.action&&"addNote"!==e.action&&"editNote"!==e.action&&"deleteNote"!==e.action&&"beforeWrap"!==e.action&&"beforeReplace"!==e.action&&"filter"!==e.action&&"beforeClear"!==e.action&&"beforeInsertImage"!==e.action&&"beforeInsertChart"!==e.action&&"chartDesign"!==e.action&&"cellDelete"!==e.action&&"autofill"!==e.action&&"validation"!==e.action&&"removeValidation"!==e.action&&"hyperlink"!==e.action&&"removeHyperlink"!==e.action&&"deleteImage"!==e.action||this.parent.notify(Ea,{args:e}),t&&(e.preventAction=!0),r.isUndo&&(e.isUndo=!0),!1===r.isUndo&&(e.isRedo=!0)},e.prototype.actionCompleteHandler=function(e){var t=e.preventAction;delete e.preventAction,this.parent.notify(G,e),e.preventEventTrigger||this.parent.trigger("actionComplete",e),t||"undoRedo"===e.action||"gotoSheet"===e.action||this.parent.notify(Ia,{args:e}),this.parent.notify(Qo,null)},e.prototype.addEventListener=function(){this.parent.on(Pa,this.actionCompleteHandler,this),this.parent.on(K,this.actionBeginHandler,this),this.parent.on(oi,this.removeEventListener,this)},e.prototype.removeEventListener=function(){this.parent.off(Pa,this.actionCompleteHandler),this.parent.off(K,this.actionBeginHandler),this.parent.off(oi,this.removeEventListener)},e}(),Hh=function(){function n(e){this.minHeight="300px",this.minWidth="400px",this.isOverlayClicked=!1,this.isResizerClicked=!1,this.currentWidth=400,this.currenHeight=300,this.parent=e,this.parent.on(Ko,this.isOverlaySelected,this),this.parent.on(Io,this.refreshOverlayElem,this),this.parent.on(oi,this.destroy,this)}return n.prototype.insertOverlayElement=function(n,i,a){var o=this.parent.createElement("div",{id:n,attrs:{class:"e-ss-overlay"},styles:"width: "+this.minWidth+";  height: "+this.minHeight});if(this.parent.allowEditing){var s=this.parent.element.getElementsByClassName("e-ss-overlay-active")[0];s&&((0,e.removeClass)([s],"e-ss-overlay-active"),this.parent.notify(Vo,{})),o.classList.add("e-ss-overlay-active")}var l,d=t(i),h=this.parent.sheets[a],p=this.parent.frozenRowCount(h),c=this.parent.frozenColCount(h),u=$l(h,d,p,c,this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth,!0);if(d[0]>=p&&d[1]<c){var f=this.parent.sheetModule.contentPanel;f.scrollTop&&(u.top-=f.scrollTop,u.top+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height)}if(d[1]>=c&&d[0]<p){var g=this.parent.getScrollElement();g.scrollLeft&&(u.left-=g.scrollLeft,u.left+=this.parent.sheetModule.getRowHeaderWidth(h))}return d[0]<p||d[1]<c?(l=this.parent.element.querySelector("#"+this.parent.element.id+"_sheet"),p&&(d[0]>=p?u.top+=(h.showHeaders?31:0)+bl(h,r(h.topLeftCell)[0],p-1):c||(u.left+=this.parent.sheetModule.getRowHeaderWidth(h,!0))),c&&(d[1]>=c?u.left+=this.parent.sheetModule.getRowHeaderWidth(h):p||(u.left+=h.showHeaders?31:0))):l=this.parent.getMainContent(),o.style.top=Number(tn(u.top).toFixed(2))+"px",o.style.left=Number(tn(u.left).toFixed(2))+"px",a===this.parent.activeSheetIndex?(l.appendChild(o),this.renderResizeHandler(o),this.addEventListener(o)):this.parent.isPrintingProcessing&&(o.style.visibility="hidden",document.body.append(o)),this.originalWidth=parseFloat(getComputedStyle(o,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(o,null).getPropertyValue("height").replace("px","")),{element:o,top:u.top,left:u.left}},n.prototype.adjustFreezePaneSize=function(n,i,a){var o=t(a),s=this.parent.getActiveSheet(),l=this.parent.frozenRowCount(s),d=this.parent.frozenColCount(s);if(o[0]<l||o[1]<d?((0,e.isNullOrUndefined)(n.top)||(i.style.top=n.top+(s.showHeaders?31:0)-this.parent.viewport.beforeFreezeHeight+"px"),(0,e.isNullOrUndefined)(n.left)||(i.style.left=n.left+this.parent.sheetModule.getRowHeaderWidth(s,!0)-this.parent.viewport.beforeFreezeWidth+"px")):((0,e.isNullOrUndefined)(n.top)||(i.style.top=n.top-this.parent.viewport.beforeFreezeHeight-(l?bl(s,r(s.topLeftCell)[0],l-1):0)+"px"),(0,e.isNullOrUndefined)(n.left)||(i.style.left=n.left-this.parent.viewport.beforeFreezeWidth-(d?Rl(s,r(s.topLeftCell)[1],d-1):0)+"px")),(0,e.isNullOrUndefined)(n.top)){var h=r(s.topLeftCell)[0];n.top=this.parent.viewport.beforeFreezeHeight+(l&&h===o[0]?0:bl(s,l?h:0,o[0]-1))}if((0,e.isNullOrUndefined)(n.left)){var p=r(s.topLeftCell)[1];n.left=this.parent.viewport.beforeFreezeWidth+(d&&p===o[1]?0:Rl(s,d?p:0,o[1]-1))}},n.prototype.addEventListener=function(t){var r=t;e.EventHandler.add(r,td(),this.overlayClickHandler,this),e.EventHandler.add(r,rd(),this.overlayMouseMoveHandler,this),e.EventHandler.add(this.parent.element.querySelector("#"+this.parent.element.id+"_sheet"),rd(),this.overlayMouseMoveHandler,this),this.mouseUpHandler||(this.mouseUpHandler=this.overlayMouseUpHandler,e.EventHandler.add(document,nd(),this.mouseUpHandler,this)),this.parent.on(Zo,this.setOriginalSize,this)},n.prototype.setOriginalSize=function(e){this.originalHeight=e.height,this.originalWidth=e.width},n.prototype.overlayMouseMoveHandler=function(t){var r,n,i,a,o,s,l=t.target,d=document.getElementsByClassName("e-ss-overlay-active")[0],h=this.parent.getActiveSheet(),p=h.frozenRows||h.frozenColumns?[29,this.parent.sheetModule.getRowHeaderWidth(h,!0)]:[-1,-1];if(this.isOverlayClicked&&this.isResizerClicked)switch(ad(t)&&t.preventDefault(),this.resizer){case"e-ss-overlay-t":r=Math.max(this.originalMouseY-cd(t)+this.originalHeight,20),n=cd(t)-(this.originalMouseY-this.originalResizeTop),r>20&&n>p[0]&&(d.style.height=r+"px",d.style.top=n+"px",this.resizedReorderTop=n,this.currenHeight=r,this.parent.notify(Ht,{height:d.style.height,width:d.style.width,overlayEle:d}));break;case"e-ss-overlay-r":(i=this.originalWidth+(ud(t)-this.originalMouseX))>20&&(d.style.width=i+"px",this.currentWidth=i,this.parent.notify(Ht,{height:d.style.height,width:d.style.width,overlayEle:d}));break;case"e-ss-overlay-b":(a=this.originalHeight+(fd(t)-this.originalMouseY))>20&&(d.style.height=a+"px",this.currenHeight=a,this.parent.notify(Ht,{height:d.style.height,width:d.style.width,overlayEle:d}));break;case"e-ss-overlay-l":o=Math.max(this.originalMouseX-pd(t)+this.originalWidth,20),s=pd(t)-(this.originalMouseX-this.originalResizeLeft),o>20&&s>p[1]&&(d.style.width=o+"px",d.style.left=s+"px",this.resizedReorderLeft=s,this.currentWidth=o,this.parent.notify(Ht,{height:d.style.height,width:d.style.width,overlayEle:d}))}else if(this.isOverlayClicked)if(ad(t)&&t.preventDefault(),(0,e.closest)(l,".e-sheet")&&!l.classList.contains("e-sheet-content")||l.classList.contains("e-cell")){if(!d)return;var c=pd(t)-this.diffX,u=cd(t)-this.diffY;c>p[1]&&(d.style.left=c+"px"),u>p[0]&&(d.style.top=u+"px"),this.resizedReorderLeft=c<0?0:c,this.resizedReorderTop=u<0?0:u}else this.overlayMouseUpHandler(t,!0)},n.prototype.overlayMouseUpHandler=function(t,r){if(this.parent&&!this.parent.getActiveSheet().isProtected&&this.parent.allowEditing){this.isResizerClicked=!1;var n=t.target,i=document.getElementsByClassName("e-datavisualization-chart e-ss-overlay-active");n.classList.contains("e-ss-overlay")||(n=(0,e.closest)(t.target,".e-datavisualization-chart")?(0,e.closest)(t.target,".e-datavisualization-chart"):n);var a=this.parent.getActiveSheet(),o={prevTop:a.frozenRows||a.frozenColumns?this.prevY:this.originalReorderTop,prevLeft:a.frozenRows||a.frozenColumns?this.prevX:this.originalReorderLeft,currentTop:this.resizedReorderTop>=0?parseInt(this.resizedReorderTop.toString(),10):this.originalReorderTop,currentLeft:this.resizedReorderLeft>=0?parseInt(this.resizedReorderLeft.toString(),10):this.originalReorderLeft,id:n.id,currentHeight:this.currenHeight,currentWidth:this.currentWidth,requestType:"imageRefresh",prevHeight:this.originalHeight,prevWidth:this.originalWidth};if(this.isOverlayClicked||r){var s=void 0,l=void 0,d={clientY:o.prevTop,isImage:!0},h={clientX:o.prevLeft,isImage:!0},p=this.parent.element.getElementsByClassName("e-ss-overlay-active")[0];if(a.frozenRows||a.frozenColumns){if(!p)return;d.isImage=!1,h.isImage=!1,d.target=p,h.target=p,o.prevTop<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(d.target=this.parent.getColumnHeaderContent(),d.isOverlay=!0),o.prevLeft<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(h.target=this.parent.getRowHeaderTable());var c=p.getBoundingClientRect();s={clientY:c.top},l={clientX:c.left},c.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(s.target=this.parent.getColumnHeaderContent(),s.isOverlay=!0),c.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(l.target=this.parent.getRowHeaderTable())}else s={clientY:o.currentTop,isImage:!0},l={clientX:o.currentLeft,isImage:!0};if(this.parent.notify(No,d),this.parent.notify(No,s),this.parent.notify(Ro,h),this.parent.notify(Ro,l),s.size&&(o.currentTop=s.size),l.size&&(o.currentLeft=l.size),o.prevRowIdx=d.clientY,o.prevColIdx=h.clientX,o.currentRowIdx=s.clientY,o.currentColIdx=l.clientX,(a.frozenColumns||a.frozenRows)&&!(0,e.closest)(p,".e-sheet-content")){var u=this.parent.frozenColCount(a),f=this.parent.frozenRowCount(a);if(o.currentRowIdx>=f&&o.currentColIdx>=u){var g=parseFloat(p.style.top),m=parseFloat(p.style.left);if(g+=this.parent.sheetModule.contentPanel.scrollTop,g-=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height,m+=this.parent.getScrollElement().scrollLeft,m-=this.parent.sheetModule.getRowHeaderWidth(a),p.style.top=g+"px",p.style.left=m+"px",this.parent.getMainContent().appendChild(p),p.classList.contains("e-datavisualization-chart")){var v=p.querySelector(".e-chart");v&&Md(v)}}}i&&i[0]&&i[0].querySelector(".e-control")&&(o.id=i[0].id),this.originalReorderTop!==this.resizedReorderTop||this.originalReorderLeft!==this.resizedReorderLeft?(o.id=p.id,i&&i[0]?(o.requestType="chartRefresh",this.parent.notify(Fo,o)):this.parent.notify(Eo,o),this.resizedReorderTop=this.originalReorderTop,this.resizedReorderLeft=this.originalReorderLeft):this.currenHeight===this.originalHeight&&this.originalWidth===this.currentWidth||(o.id=n.id.indexOf("overlay")>0?n.id:n.parentElement&&n.parentElement.classList.contains("e-ss-overlay")?n.parentElement.id:p.id,i&&i[0]?(o.requestType="chartRefresh",this.parent.notify(Fo,o)):this.parent.notify(Eo,o),this.originalHeight=this.currenHeight,this.originalWidth=this.currentWidth)}this.isOverlayClicked=!1}},n.prototype.isOverlaySelected=function(e){e.isOverlayClicked=this.isOverlayClicked},n.prototype.refreshOverlayElem=function(t){if(t){var r=".e-ss-overlay-active"+(t&&t.selector||""),n=this.parent.element.querySelector(r);n&&((0,e.removeClass)([n],"e-ss-overlay-active"),this.parent.notify(Vo,{}))}else{r="e-ss-overlay-active";for(var i=Array.from(this.parent.element.getElementsByClassName(r)),a=0;a<i.length;a++){var o=i[a];o&&((0,e.removeClass)([o],"e-ss-overlay-active"),this.parent.notify(Vo,{}))}}this.parent.notify(Mo,null)},n.prototype.overlayClickHandler=function(t){if(!this.parent.getActiveSheet().isProtected&&this.parent.allowEditing){this.isOverlayClicked=!0;var r=t.target,n=t.target;r.classList.contains("e-ss-overlay")||(n=r.parentElement,(0,e.closest)(t.target,".e-datavisualization-chart")&&(n=(0,e.closest)(t.target,".e-datavisualization-chart")));var i=this.parent.getActiveSheet();if((i.frozenColumns||i.frozenRows)&&(0,e.closest)(n,".e-sheet-content")){var a=parseInt(n.style.top,10),o=parseInt(n.style.left,10);a-=this.parent.sheetModule.contentPanel.scrollTop,a+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height,o-=this.parent.getScrollElement().scrollLeft,o+=this.parent.sheetModule.getRowHeaderWidth(i),n.style.top=a+"px",n.style.left=o+"px",this.parent.element.querySelector("#"+this.parent.element.id+"_sheet").appendChild(n)}this.originalWidth=this.currentWidth=parseFloat(n.style.width),this.originalHeight=this.currenHeight=parseFloat(n.style.height),this.originalReorderLeft=parseFloat(n.style.left),this.originalReorderTop=parseFloat(n.style.top),this.resizedReorderLeft=parseFloat(n.style.left),this.resizedReorderTop=parseFloat(n.style.top),this.originalResizeTop=this.originalReorderTop,this.originalResizeLeft=this.originalReorderLeft,this.originalMouseX=pd(t),this.originalMouseY=cd(t),this.diffX=this.originalMouseX-this.originalReorderLeft,this.diffY=this.originalMouseY-this.originalReorderTop;var s=document.getElementsByClassName("e-ss-overlay-active")[0];s&&(0,e.removeClass)([s],"e-ss-overlay-active"),this.parent.element.querySelector("#"+n.id).classList.add("e-ss-overlay-active"),r.classList.contains("e-ss-resizer")&&(this.resizer=r.classList[0],this.isResizerClicked=!0),n.classList.contains("e-datavisualization-chart")&&(this.parent.notify(zt,{id:n.id}),s||this.parent.notify(Uo,{id:n.id}));var l=n.getBoundingClientRect();this.prevX=l.left,this.prevY=l.top}},n.prototype.renderResizeHandler=function(t){for(var r,n=["e-ss-overlay-t","e-ss-overlay-r","e-ss-overlay-b","e-ss-overlay-l"],i=0;i<n.length;)r=this.parent.createElement("div",{className:n[i]+" e-ss-resizer"+(e.Browser.isDevice?" e-ss-resizer-touch":""),styles:"width: 8px; height: 8px; border-radius: 4px;"}),t.appendChild(r),i++},n.prototype.removeEventListener=function(){var t=this.parent.element.querySelectorAll(".e-ss-overlay");if(t.length)for(var r=0;r<t.length;r++)e.EventHandler.remove(t[r],td(),this.overlayClickHandler),e.EventHandler.remove(t[r],rd(),this.overlayMouseMoveHandler);var n=this.parent.element.querySelector("#"+this.parent.element.id+"_sheet");n&&e.EventHandler.remove(n,rd(),this.overlayMouseMoveHandler),document&&this.mouseUpHandler&&(e.EventHandler.remove(document,nd(),this.mouseUpHandler),this.mouseUpHandler=null),this.parent.isDestroyed||(this.parent.off(Zo,this.setOriginalSize),this.parent.off(Ko,this.isOverlaySelected),this.parent.off(Io,this.refreshOverlayElem),this.parent.off(oi,this.destroy))},n.prototype.destroy=function(){this.removeEventListener(),this.currentWidth&&(this.currentWidth=null),this.currenHeight&&(this.currenHeight=null),this.minHeight&&(this.minHeight=null),this.minWidth&&(this.minWidth=null),this.isOverlayClicked&&(this.isOverlayClicked=null),this.isResizerClicked&&(this.isResizerClicked=null),this.parent=null},n}(),Uh=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Vh=function(){return Vh=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Vh.apply(this,arguments)},zh=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},jh=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Uh(r,t),zh([(0,e.Property)("")],r.prototype,"text",void 0),zh([(0,e.Property)("")],r.prototype,"iconCss",void 0),zh([(0,e.Property)("left")],r.prototype,"iconPosition",void 0),r}(e.ChildProperty),_h=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Uh(r,t),zh([(0,e.Complex)({},jh)],r.prototype,"header",void 0),zh([(0,e.Collection)([],vh.Item)],r.prototype,"content",void 0),zh([(0,e.Property)("")],r.prototype,"cssClass",void 0),zh([(0,e.Property)(!1)],r.prototype,"disabled",void 0),r}(e.ChildProperty),qh=function(t){function r(e,r){return t.call(this,e)||this}return Uh(r,t),r.prototype.preRender=function(){},r.prototype.render=function(){this.element.id||(this.element.id=(0,e.getUniqueID)("ribbon")),this.renderRibbon()},r.prototype.destroy=function(){var r=this.element.querySelector(".e-drop-icon");if(r&&r.removeEventListener("click",this.ribbonExpandCollapse.bind(this)),this.menuItems.length){var n=document.getElementById(this.element.id+"_menu");n&&(0,e.getComponent)(n,"menu").destroy()}this.toolbarObj&&this.toolbarObj.destroy(),this.tabObj&&this.tabObj.destroy(),this.element.innerHTML="",this.toolbarObj=null,this.tabObj=null,t.prototype.destroy.call(this)},r.prototype.getTabItems=function(){var e=this,t=[];return this.menuItems.length&&t.push({header:{text:this.initMenu(this.menuItems)},content:this.toolbarObj.element,cssClass:"e-menu-tab"}),this.items.forEach((function(r){t.push({header:r.header,content:e.toolbarObj.element})})),t},r.prototype.initMenu=function(t){var r=this,n=this.createElement("ul",{id:this.element.id+"_menu"});this.element.appendChild(n);var i=new vh.Menu({cssClass:"e-file-menu",items:t,showItemOnClick:!0,beforeOpen:function(e){e.parentItem.text===t[0].text&&(i.showItemOnClick=!1),r.trigger("beforeOpen",e)},select:function(e){r.trigger("fileMenuItemSelect",e)},beforeClose:function(n){"mouseover"!==n.event.type||(0,e.closest)(n.event.target,".e-menu-popup")?(r.trigger("beforeClose",n),n.parentItem&&n.parentItem.text!==t[0].text||i.setProperties({showItemOnClick:!0},!0)):n.cancel=!0},beforeItemRender:function(e){r.trigger("beforeFileMenuItemRender",e)},created:function(){i.element.removeAttribute("tabindex");var e=i.element.querySelector(".e-menu-item");e&&e.removeAttribute("tabindex")}});return i.createElement=this.createElement,i.appendTo(n),n.parentElement},r.prototype.renderRibbon=function(){var t,r=this,n=this.createElement("div"),i=this.createElement("div");this.toolbarObj=new vh.Toolbar({items:this.items[this.selectedTab].content,clicked:function(e){return r.trigger("clicked",e)}}),this.toolbarObj.createElement=this.createElement,this.toolbarObj.appendTo(i),this.tabObj=new vh.Tab({selectedItem:this.getIndex(this.selectedTab),animation:{next:{duration:0},previous:{duration:0}},items:this.getTabItems(),selecting:function(n){if(n.isSwiped)n.cancel=!0;else if(t=n.event&&n.event.isShortcut,r.menuItems.length&&0===n.selectingIndex){if(n.cancel=!0,(!n.event||t||"keydown"===n.event.type)&&n.selectingItem){var i=n.selectingItem.querySelector(".e-file-menu .e-menu-item");i&&i.click()}}else{if(n.selectingIndex===r.getIndex(r.selectedTab))return;r.updateToolbar(r.getIndex(n.selectingIndex,!0)),r.toolbarObj.dataBind(),r.refreshTemplateItems(r.toolbarObj),r.element.classList.contains("e-collapsed")&&e.EventHandler.remove(n.selectedItem,"click",r.ribbonExpandCollapse);var a=void 0;r.menuItems.length?((a=Vh({},n)).selectingIndex-=1,a.selectedIndex-=1):a=n,r.trigger("selecting",a)}},selected:function(e){e.isInteracted||t||(e.preventFocus=!0),e.selectedIndex!==r.getIndex(r.selectedTab)&&(r.setProperties({selectedTab:r.getIndex(e.selectedIndex,!0)},!0),r.element.classList.contains("e-collapsed")&&(r.element.classList.remove("e-collapsed"),r.trigger("expandCollapse",{element:r.toolbarObj.element,expanded:!0})))},created:function(){r.toolbarObj.refreshOverflow()}}),this.element.appendChild(n),this.tabObj.createElement=this.createElement,this.tabObj.appendTo(n);var a=this.createElement("span",{className:"e-drop-icon e-icons"});a.addEventListener("click",this.ribbonExpandCollapse.bind(this)),this.element.appendChild(a)},r.prototype.ribbonExpandCollapse=function(t){var r,n={element:this.toolbarObj.element,expanded:!0};this.element.classList.contains("e-collapsed")?(r=this.tabObj.element.querySelector(".e-tab-header").getElementsByClassName("e-toolbar-item")[this.tabObj.selectedItem],this.element.classList.remove("e-collapsed"),r.classList.add("e-active"),e.EventHandler.remove(r,"click",this.ribbonExpandCollapse),this.trigger("expandCollapse",n)):(r=this.tabObj.element.querySelector(".e-tab-header .e-toolbar-item.e-active"),this.element.classList.add("e-collapsed"),n.expanded=!1,r.classList.remove("e-active"),e.EventHandler.add(r,"click",this.ribbonExpandCollapse,this),this.trigger("expandCollapse",n))},r.prototype.getIndex=function(e,t){return this.menuItems.length?t?e-1:e+1:e},r.prototype.updateToolbar=function(e){this.toolbarObj.items=this.items[e].content,this.toolbarObj.dataBind()},r.prototype.refreshTemplateItems=function(e){this.spreadInstance&&this.spreadInstance.isReact&&this.spreadInstance.portals&&e&&e.portals&&(this.spreadInstance.portals=this.spreadInstance.portals.concat(e.portals),this.spreadInstance.renderReactTemplates())},r.prototype.enableMenuItems=function(t,r,n){void 0===r&&(r=!0),this.menuItems.length&&(0,e.getComponent)(document.getElementById(this.element.id+"_menu"),"menu").enableItems(t,r,n)},r.prototype.hideMenuItems=function(t,r,n){if(void 0===r&&(r=!0),this.menuItems.length){var i=(0,e.getComponent)(document.getElementById(this.element.id+"_menu"),"menu");r?i.hideItems(t,n):i.showItems(t,n)}},r.prototype.addMenuItems=function(t,r,n,i){if(void 0===n&&(n=!0),this.menuItems.length){var a=(0,e.getComponent)(document.getElementById(this.element.id+"_menu"),"menu");n?a.insertAfter(t.reverse(),r,i):a.insertBefore(t,r,i)}},r.prototype.hideTabs=function(e,t){var r,n,i,a,o=this;if(void 0===t&&(t=!0),t||(a=this.isAllHidden()),e.forEach((function(e){(r=o.getTabIndex(e,-1))>-1&&(t?o.items[r].cssClass.includes(" e-hide")||(o.items[r].cssClass=o.items[r].cssClass+" e-hide",o.tabObj.items[o.getIndex(r)].cssClass=o.items[r].cssClass,void 0===n&&r===o.selectedTab&&(n=!0),i=!0):o.items[r].cssClass.includes(" e-hide")&&(o.items[r].cssClass=o.items[r].cssClass.replace(" e-hide",""),o.tabObj.items[o.getIndex(r)].cssClass=o.items[r].cssClass,void 0===n&&r===o.selectedTab&&(n=!0),i=!0))})),this.setProperties({items:this.items},!0),this.tabObj.items=this.tabObj.items,this.tabObj.dataBind(),t&&(a=this.isAllHidden())&&(n=!1),!t&&a&&(n=!n),i&&a&&(this.element.classList.contains("e-collapsed")?(this.element.classList.remove("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.remove("e-hide")):(this.element.classList.add("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.add("e-hide"))),n)for(var s=0;s<this.items.length;s++)if(!this.items[s].cssClass.includes(" e-hide")){this.tabObj.selectedItem=this.getIndex(s),this.tabObj.dataBind();break}},r.prototype.isAllHidden=function(){for(var e=!0,t=0;t<this.items.length;t++)if(!this.items[t].cssClass.includes(" e-hide")){e=!1;break}return e},r.prototype.enableTabs=function(e,t){var r=this;void 0===t&&(t=!0),e.forEach((function(e){var n=r.getTabIndex(e,-1);n>-1&&(r.items[n].disabled=!t,n=r.getIndex(n),r.tabObj.enableTab(n,t))})),this.setProperties({items:this.items},!0)},r.prototype.addTabs=function(e,t){var r,n=this,i=this.getTabIndex(t);e.forEach((function(e){e=new _h(n.items[0],"items",e,!0),n.items.splice(i,0,e),r={header:e.header,content:n.toolbarObj.element},e.cssClass&&(r.cssClass=e.cssClass),e.disabled&&(r.disabled=e.disabled),n.tabObj.addTab([r],n.getIndex(i)),i++})),this.setProperties({items:this.items},!0),this.setProperties({selectedTab:this.getIndex(this.tabObj.selectedItem,!0)},!0)},r.prototype.getTabIndex=function(e,t){if(void 0===t&&(t=this.items.length),e)for(var r=0;r<this.items.length;r++)if(this.items[r].header.text===e){t=r;break}return t},r.prototype.addToolbarItems=function(t,r,n){var i=this,a=this.getTabIndex(t);(0,e.isNullOrUndefined)(n)&&(n=this.items[a].content.length),r.forEach((function(e){e=new vh.Item(i.items[a].content[0],"content",e,!0),i.items[a].content.splice(n,0,e),n++})),this.setProperties({items:this.items},!0),a===this.selectedTab&&r.length&&this.updateToolbar(a)},r.prototype.enableItems=function(e,t,r,n){if(void 0===r&&(r=!0),t){var i=this.getTabIndex(e,-1);if(i<0)return;for(var a=void 0,o=0;o<t.length;o++){if("string"==typeof t[o])for(var s=0;s<this.items[i].content.length;s++)if(this.items[i].content[s].id===t[o]){t[o]=s;break}if("string"==typeof t[o]){if(t.length-1>o)continue;return}var l=this.items[i].content[t[o]];a=r,n?l.isManuallyEnabled=r:r&&void 0!==l.isManuallyEnabled&&(a=l.isManuallyEnabled),l.disabled=!a,this.setProperties({items:this.items},!0),i===this.selectedTab&&this.toolbarObj.enableItems(t[o],a)}}else this.toolbarObj.disable(!r)},r.prototype.hideToolbarItems=function(e,t,r){var n,i,a=this;void 0===r&&(r=!0);for(var o=0;o<this.items.length;o++)if(this.items[o].header.text===e){n=o,t.forEach((function(e){(i=a.items[n].content[e])&&(r?i.cssClass.includes(" e-hide")||(i.cssClass=i.cssClass+" e-hide"):i.cssClass.includes(" e-hide")&&(i.cssClass=i.cssClass.replace(" e-hide","")))}));break}this.setProperties({items:this.items},!0),void 0!==n&&n===this.selectedTab&&this.updateToolbar(n)},r.prototype.getModuleName=function(){return"ribbon"},r.prototype.getPersistData=function(){return this.addOnPersist([])},r.prototype.onPropertyChanged=function(e,t){for(var r=0,n=Object.keys(e);r<n.length;r++){if("selectedTab"===n[r])this.tabObj.selectedItem=this.getIndex(e.selectedTab),this.tabObj.dataBind()}},zh([(0,e.Property)("")],r.prototype,"cssClass",void 0),zh([(0,e.Property)(!0)],r.prototype,"menuType",void 0),zh([(0,e.Collection)([],vh.MenuItem)],r.prototype,"menuItems",void 0),zh([(0,e.Property)(0)],r.prototype,"selectedTab",void 0),zh([(0,e.Collection)([],_h)],r.prototype,"items",void 0),zh([(0,e.Property)(null)],r.prototype,"spreadInstance",void 0),zh([(0,e.Event)()],r.prototype,"selecting",void 0),zh([(0,e.Event)()],r.prototype,"fileMenuItemSelect",void 0),zh([(0,e.Event)()],r.prototype,"beforeFileMenuItemRender",void 0),zh([(0,e.Event)()],r.prototype,"beforeOpen",void 0),zh([(0,e.Event)()],r.prototype,"beforeClose",void 0),zh([(0,e.Event)()],r.prototype,"selectFormat",void 0),zh([(0,e.Event)()],r.prototype,"clicked",void 0),zh([(0,e.Event)()],r.prototype,"created",void 0),zh([(0,e.Event)()],r.prototype,"expandCollapse",void 0),r=zh([e.NotifyPropertyChanges],r)}(e.Component),Wh=function(){function t(e){this.parent=e,this.addEventListener()}return t.prototype.render=function(){var t=this,r=this.parent.element.id,n=this.parent.createElement("input",{attrs:{type:"color"}}),i=function(e){e.element.tabIndex=-1};this.fontColorPicker=new Ih.ColorPicker({value:"#000000ff",mode:"Palette",showButtons:!1,presetColors:Bl,enableOpacity:!1,cssClass:"e-spreadsheet-color-popup",beforeTileRender:i,beforeClose:function(){return t.beforeCloseHandler(t.fontColorPicker)},open:this.openHandler.bind(this),beforeModeSwitch:function(e){return t.beforeModeSwitch(t.fontColorPicker,e)},change:function(e){var r={style:{color:t.fontColorPicker.getValue(e.currentValue.rgba)},onActionUpdate:!0};t.parent.notify(ae,r),r.cancel?t.fontColorPicker.setProperties({value:t.fontColorPicker.getValue(e.previousValue.rgba,"HEXA")},!0):t.updateSelectedColor(r.style.color,t.fontColorPicker.element,"TextColor")},created:function(){return t.updateSelectedColor("#000000",t.fontColorPicker.element,"TextColor",!0)}}),this.fontColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(n),this.fontColorPicker.appendTo(n),n.parentElement.id=r+"_font_color_picker",(0,e.addClass)([n.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-font-color"]),n=this.parent.createElement("input",{attrs:{type:"color"}}),this.filColorPicker=new Ih.ColorPicker({value:"#ffff00ff",mode:"Palette",presetColors:Hl,showButtons:!1,enableOpacity:!1,cssClass:"e-spreadsheet-color-popup",open:this.openHandler.bind(this),beforeTileRender:i,beforeClose:function(){return t.beforeCloseHandler(t.filColorPicker)},beforeModeSwitch:function(e){return t.beforeModeSwitch(t.filColorPicker,e)},change:function(e){var r={style:{backgroundColor:t.filColorPicker.getValue(e.currentValue.rgba)},onActionUpdate:!0};t.parent.notify(ae,r),r.cancel?t.filColorPicker.setProperties({value:t.filColorPicker.getValue(e.previousValue.rgba,"HEXA")},!0):t.updateSelectedColor(r.style.backgroundColor,t.filColorPicker.element,"FillColor")},created:function(){return t.updateSelectedColor("#ffff00",t.filColorPicker.element,"FillColor",!0)}}),this.filColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(n),this.filColorPicker.appendTo(n),n.parentElement.id=r+"_fill_color_picker",(0,e.addClass)([n.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-fill-color"])},t.prototype.updateSelectedColor=function(e,t,r,n){var i=this.parent.serviceLocator.getService(Dl).getConstant(r);n&&t.parentElement.querySelector(".e-dropdown-btn").setAttribute("aria-label",i);var a=t.parentElement.querySelector(".e-split-colorpicker");a.setAttribute("aria-label",i+" "+e),a.firstElementChild.style.borderBottomColor=e},t.prototype.openHandler=function(e){e.element.querySelector(".e-mode-switch-btn").title=this.parent.serviceLocator.getService(Dl).getConstant("MoreColors")},t.prototype.beforeCloseHandler=function(e){e.modeSwitcher||e.setProperties({modeSwitcher:!0},!0),e.showButtons&&e.setProperties({showButtons:!1},!0),Md(e.element.parentElement.querySelector(".e-split-colorpicker"))},t.prototype.beforeModeSwitch=function(e,t){var r=this.parent.serviceLocator.getService(Dl);"Picker"===t.mode?(e.showButtons=!0,e.dataBind(),t.element.querySelector(".e-apply").title=r.getConstant("Apply"),t.element.querySelector(".e-cancel").title=r.getConstant("Cancel"),t.element.querySelector(".e-mode-switch-btn").title=r.getConstant("StandardColors")):(e.showButtons=!1,e.dataBind(),t.element.querySelector(".e-mode-switch-btn").title=r.getConstant("MoreColors"))},t.prototype.destroy=function(){this.parent&&(this.removeEventListener(),this.fontColorPicker&&this.fontColorPicker.destroy(),this.fontColorPicker=null,this.filColorPicker&&this.filColorPicker.destroy(),this.filColorPicker=null,this.parent=null)},t.prototype.addEventListener=function(){this.parent.on(Zi,this.render,this),this.parent.on("destroyRibbonComponents",this.destroy,this),this.parent.on(oi,this.destroy,this)},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Zi,this.render),this.parent.off("destroyRibbonComponents",this.destroy),this.parent.off(oi,this.destroy))},t}(),Gh=function(){function n(e){this.border="1px solid #000000",this.fontNameIndex=5,this.numPopupWidth=0,this.preTabIdx=1,this.spanElements=[],this.iconSetGroupElement=[],this.iconSetElements=[],this.iconWrapElements=[],this.parent=e,this.addEventListener(),new Wh(e)}return n.prototype.getModuleName=function(){return"ribbon"},n.prototype.ribbonOperation=function(e){e&&e.onPropertyChange?this.onPropertyChanged(e.prop):this.initialize()},n.prototype.initialize=function(e){if(this.parent.notify(Zi,{}),this.parent.isMobileView())this.createMobileView();else{var t=e&&(this.parent.element.querySelector(".e-formula-bar-panel")||document.getElementById(this.parent.element.id+"_sheet_panel"));this.createRibbon(t)}},n.prototype.getRibbonMenuItems=function(){var e=this.parent.serviceLocator.getService(Dl),t=this.parent.element.id;return[{text:this.parent.isMobileView()?"":e.getConstant("File"),iconCss:this.parent.isMobileView()?"e-icons e-file-menu-icon":null,id:t+"_File",items:[{text:e.getConstant("New"),id:t+"_New",iconCss:"e-new e-icons"},{text:e.getConstant("Open"),id:t+"_Open",iconCss:"e-open e-icons"},{text:e.getConstant("SaveAs"),iconCss:"e-save e-icons",id:t+"_Save_As",items:[{text:e.getConstant("ExcelXlsx"),id:t+"_Xlsx",iconCss:"e-xlsx e-icons"},{text:e.getConstant("ExcelXls"),id:t+"_Xls",iconCss:"e-xls e-icons"},{text:e.getConstant("CSV"),id:t+"_Csv",iconCss:"e-csv e-icons"},{text:e.getConstant("PDF"),id:t+"_Pdf",iconCss:"e-pdf e-icons"}]},{text:e.getConstant("Print"),id:t+"_Print",iconCss:"e-print e-icons"}]}]},n.prototype.getRibbonItems=function(){var t=this,r=this.parent.element.id,n=this.parent.serviceLocator.getService(Dl),i=[{header:{text:n.getConstant("Home")},content:[{prefixIcon:"e-undo-icon",tooltipText:n.getConstant("Undo")+" (Ctrl+Z)",htmlAttributes:{"aria-label":n.getConstant("Undo")},id:r+"_undo",disabled:!0},{prefixIcon:"e-redo-icon",tooltipText:n.getConstant("Redo")+" (Ctrl+Y)",htmlAttributes:{"aria-label":n.getConstant("Redo")},id:r+"_redo",disabled:!0},{type:"Separator",id:r+"_separator_1"},{prefixIcon:"e-cut-icon",tooltipText:n.getConstant("Cut")+" (Ctrl+X)",htmlAttributes:{"aria-label":n.getConstant("Cut")},id:r+"_cut"},{prefixIcon:"e-copy-icon",tooltipText:n.getConstant("Copy")+" (Ctrl+C)",htmlAttributes:{"aria-label":n.getConstant("Copy")},id:r+"_copy"},{tooltipText:n.getConstant("Paste")+" (Ctrl+V)",template:this.getPasteBtn(r,n),id:r+"_paste",disabled:!0},{type:"Separator",id:r+"_separator_2"},{template:this.getNumFormatDDB(r,n),tooltipText:n.getConstant("NumberFormat"),id:r+"_number_format"},{type:"Separator",id:r+"_separator_3"},{template:this.getFontNameDDB(r),tooltipText:n.getConstant("Font"),id:r+"_font_name"},{type:"Separator",id:r+"_separator_4"},{template:this.getFontSizeDDB(r),tooltipText:n.getConstant("FontSize"),id:r+"_font_size"},{type:"Separator",id:r+"_separator_5"},{template:this.getBtn(r,"bold",n.getConstant("Bold")),tooltipText:n.getConstant("Bold")+" (Ctrl+B)",id:r+"_bold"},{template:this.getBtn(r,"italic",n.getConstant("Italic")),tooltipText:n.getConstant("Italic")+" (Ctrl+I)",id:r+"_italic"},{template:this.getBtn(r,"line-through",n.getConstant("Strikethrough")),tooltipText:n.getConstant("Strikethrough")+" (Ctrl+5)",id:r+"_line-through"},{template:this.getBtn(r,"underline",n.getConstant("Underline")),tooltipText:n.getConstant("Underline")+" (Ctrl+U)",id:r+"_underline"},{template:document.getElementById(r+"_font_color_picker"),tooltipText:n.getConstant("TextColor"),id:r+"_font_color_picker"},{type:"Separator",id:r+"_separator_6"},{template:document.getElementById(r+"_fill_color_picker"),tooltipText:n.getConstant("FillColor"),id:r+"_fill_color_picker"},{template:this.getBordersDBB(r),tooltipText:n.getConstant("Borders"),id:r+"_borders"},{template:this.getMergeSplitBtn(r),tooltipText:n.getConstant("MergeCells"),id:r+"_merge_cells",disabled:!0},{type:"Separator",id:r+"_separator_7"},{template:this.getTextAlignDDB(r),tooltipText:n.getConstant("HorizontalAlignment"),id:r+"_text_align"},{template:this.getVerticalAlignDDB(r),tooltipText:n.getConstant("VerticalAlignment"),id:r+"_vertical_align"},{template:this.getBtn(r,"wrap",n.getConstant("WrapText"),!1),tooltipText:""+n.getConstant("WrapText"),id:r+"_wrap"}]},{header:{text:n.getConstant("Insert")},content:[{prefixIcon:"e-hyperlink-icon",text:n.getConstant("Link"),id:r+"_hyperlink",tooltipText:n.getConstant("Link"),click:function(){t.getHyperlinkDlg()}},{prefixIcon:"e-image-icon",text:n.getConstant("Image"),id:r+"_image",tooltipText:n.getConstant("Image"),click:function(){(0,e.select)("#"+r+"_imageUpload",t.parent.element).click()}}]},{header:{text:n.getConstant("Formulas")},content:[{prefixIcon:"e-insert-function",tooltipText:n.getConstant("InsertFunction"),text:n.getConstant("InsertFunction"),id:r+"_insert_function"},{type:"Separator",id:r+"_separator_14"},{template:this.createCalcOptions(r,n),tooltipText:n.getConstant("CalcOptionsTip"),id:r+"_calc_types"},{type:"Separator",id:r+"_separator_15"},{prefixIcon:"e-calculate-sheet",tooltipText:n.getConstant("CalcSheetTip"),text:n.getConstant("CalcActiveSheet"),id:r+"_calc_current_sheet",click:function(){t.parent.notify(pe,{action:"ClearDependentCellCollection"}),t.parent.calculateNow("Sheet")},disabled:"Automatic"===this.parent.calculationMode},{prefixIcon:"e-calculation",tooltipText:n.getConstant("CalcWorkbookTip"),text:n.getConstant("CalcWorkbook"),id:r+"_calc_entire_sheets",click:function(){t.parent.notify(pe,{action:"ClearDependentCellCollection"}),t.parent.calculateNow("Workbook")},disabled:"Automatic"===this.parent.calculationMode}]},{header:{text:n.getConstant("Data")},content:[{prefixIcon:"e-protect-icon",text:n.getConstant("ProtectSheet"),id:r+"_protect",tooltipText:n.getConstant("ProtectSheet")},{prefixIcon:"e-password-protect-icon",text:n.getConstant("ProtectWorkbook"),id:r+"_protectworkbook",tooltipText:n.getConstant("ProtectWorkbook")},{type:"Separator",id:r+"_separator_8"},{template:this.datavalidationDDB(r),tooltipText:n.getConstant("DataValidation"),id:r+"_datavalidation"}]},{header:{text:n.getConstant("View")},content:[{prefixIcon:"e-hide-headers",text:this.getLocaleText("Headers"),id:r+"_headers",tooltipText:this.getLocaleText("Headers")},{type:"Separator",id:r+"_separator_9"},{prefixIcon:"e-hide-gridlines",text:this.getLocaleText("GridLines"),id:r+"_gridlines",tooltipText:this.getLocaleText("GridLines")},{type:"Separator",id:r+"_separator_13"},{prefixIcon:"e-freeze-pane",text:n.getConstant("FreezePanes"),id:r+"_freezepanes",tooltipText:n.getConstant("FreezePanes"),disabled:!this.parent.allowFreezePane},{prefixIcon:"e-freeze-row",text:n.getConstant("FreezeRows"),id:r+"_freezerows",tooltipText:n.getConstant("FreezeRows"),disabled:!this.parent.allowFreezePane},{prefixIcon:"e-freeze-column",text:n.getConstant("FreezeColumns"),id:r+"_freezecolumns",tooltipText:n.getConstant("FreezeColumns"),disabled:!this.parent.allowFreezePane}]}];return this.parent.allowConditionalFormat&&i.find((function(e){return e.header&&e.header.text===n.getConstant("Home")})).content.push({type:"Separator",id:r+"_separator_10"},{template:this.getCFDBB(r),tooltipText:n.getConstant("ConditionalFormatting"),id:r+"_conditionalformatting"}),this.parent.allowChart&&i.find((function(e){return e.header&&e.header.text===n.getConstant("Insert")})).content.push({type:"Separator",id:r+"_separator_11"},{template:this.getChartDDB(r,!0),text:n.getConstant("Chart"),tooltipText:n.getConstant("Chart"),id:r+"_chart"}),this.parent.allowCellFormatting&&i.find((function(e){return e.header&&e.header.text===n.getConstant("Home")})).content.push({type:"Separator",id:r+"_separator_12"},{template:this.getClearDDB(r),tooltipText:n.getConstant("Clear"),id:r+"_clear"}),(this.parent.allowSorting||this.parent.allowFiltering)&&i.find((function(e){return e.header&&e.header.text===n.getConstant("Home")})).content.push({template:this.getSortFilterDDB(r),tooltipText:n.getConstant("SortAndFilter"),id:r+"_sorting"}),this.parent.allowFindAndReplace&&i.find((function(e){return e.header&&e.header.text===n.getConstant("Home")})).content.push({template:this.getFindBtn(r),prefixIcon:"e-tbar-search-icon tb-icons",tooltipText:n.getConstant("FindReplaceTooltip"),id:r+"_find"}),i},n.prototype.createCalcOptions=function(t,r){var n=(0,e.createElement)("button",{id:t+"_calc_types",attrs:{type:"button"},className:"e-calc-types"}),i=(0,e.createElement)("span",{className:"e-calc-types-text"});return i.innerText=r.getConstant("CalcOptions"),n.appendChild(i),this.calcTypeOptions=new Dh.DropDownButton({items:[{id:t+"_Automatic",text:r.getConstant("Automatic"),iconCss:"Automatic"===this.parent.calculationMode?"e-icons e-selected-icon":""},{id:t+"_Manual",text:r.getConstant("Manual"),iconCss:"Manual"===this.parent.calculationMode?"e-icons e-selected-icon":""}],createPopupOnClick:!0,iconCss:"e-calculation e-icons",cssClass:"e-flat e-calc-types"}),this.calcTypeOptions.select=this.selectCalcOptions.bind(this),this.calcTypeOptions.appendTo(n),n},n.prototype.selectCalcOptions=function(e){e.item.id===this.parent.element.id+"_Automatic"?(this.calcTypeOptions.items[0].iconCss="e-icons e-selected-icon",this.calcTypeOptions.items[1].iconCss="","Manual"===this.parent.calculationMode&&this.parent.notify(pe,{action:"ClearDependentCellCollection"}),this.parent.setProperties({calculationMode:"Automatic"},!0),this.updateFormulaButtons(),this.parent.calculateNow("Workbook")):(this.calcTypeOptions.items[0].iconCss="",this.calcTypeOptions.items[1].iconCss="e-icons e-selected-icon",this.parent.setProperties({calculationMode:"Manual"},!0),this.updateFormulaButtons())},n.prototype.updateFormulaButtons=function(){var e=this.parent.serviceLocator.getService(Dl);this.parent.notify(Oi,[{tab:e.getConstant("Formulas"),items:[this.parent.element.id+"_calc_current_sheet"],enable:"Manual"===this.parent.calculationMode}]),this.parent.notify(Oi,[{tab:e.getConstant("Formulas"),items:[this.parent.element.id+"_calc_entire_sheets"],enable:"Manual"===this.parent.calculationMode}])},n.prototype.getPasteBtn=function(e,t){var r=this,n=this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_paste",attrs:{type:"button"}}));return this.pasteSplitBtn=new Dh.SplitButton({iconCss:"e-icons e-paste-icon",items:[{text:t.getConstant("All"),id:"All"},{text:t.getConstant("Values"),id:"Values"},{text:t.getConstant("Formats"),id:"Formats"}],createPopupOnClick:!0,select:function(e){r.pasteSplitBtn.element.setAttribute("aria-label",t.getConstant("Paste")+" "+e.item.text),r.parent.notify(Mi,{type:e.item.id,isAction:!0,isInternal:!0})},click:function(){n.setAttribute("aria-label",t.getConstant("Paste")),r.parent.notify(Mi,{isAction:!0,isInternal:!0})},beforeOpen:function(e){e.element.setAttribute("aria-label",t.getConstant("Paste"))}}),this.pasteSplitBtn.createElement=this.parent.createElement,this.pasteSplitBtn.appendTo(n),n.parentElement},n.prototype.getHyperlinkDlg=function(){var e=this.parent.getActiveSheet(),r=t(e.activeCell),n=zn(r[0],r[1],e);n&&n.hyperlink?this.parent.notify(ha,null):this.parent.notify(da,null)},n.prototype.passwordProtectDlg=function(){this.parent.password.length>0?this.parent.notify(Wo,null):document.getElementById(this.parent.element.id+"_protectworkbook").classList.contains("e-active")?(document.getElementById(this.parent.element.id+"_protectworkbook").classList.remove("e-active"),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled")):this.parent.notify(qo,null)},n.prototype.getLocaleText=function(e){var t=this.parent.serviceLocator.getService(Dl);return this.parent.getActiveSheet()["show"+e]?t.getConstant("Hide"+e):t.getConstant("Show"+e)},n.prototype.getLocaleProtectText=function(e,t){var r,n=this.parent.serviceLocator.getService(Dl);return this.parent.getActiveSheet().isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),r=n.getConstant("Unprotect"+e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),r=n.getConstant("Protect"+e)),r},n.prototype.getLocaleProtectWorkbook=function(e,t){var r,n=this.parent.serviceLocator.getService(Dl);return this.parent.isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),r=n.getConstant(e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),r=n.getConstant(e)),r},n.prototype.insertDesignChart=function(){var e=this,t=this.parent.serviceLocator.getService(Dl),r=this.ribbon.items.length-1,n=t.getConstant("ChartDesign");if(this.parent.allowChart&&this.ribbon.items[r]&&this.ribbon.items[r].header.text!==n){this.preTabIdx=this.ribbon.selectedTab;var i=this.parent.element.id,a=[{header:{text:n},content:[{template:this.getAddChartEleDBB(i),tooltipText:t.getConstant("AddChartElement"),id:i+"add_chart_ element_chart"},{type:"Separator"},{prefixIcon:"e-switch-row-column-icon",text:t.getConstant("SwitchRowColumn"),tooltipText:t.getConstant("SwitchRowColumn"),id:i+"switch_row_column_chart",click:function(){e.parent.notify(zo,{switchRowColumn:!0,triggerEvent:!0})}},{type:"Separator"},{template:this.getChartThemeDDB(i),tooltipText:t.getConstant("ChartTheme"),id:i+"_chart_theme"},{type:"Separator"},{template:this.getChartDDB(i,!1),tooltipText:t.getConstant("ChartType"),id:i+"_chart_type"}]}];this.addRibbonTabs({items:a}),this.ribbon.tabObj.select(this.ribbon.items.length)}},n.prototype.removeDesignChart=function(){var e=this.parent.serviceLocator.getService(Dl),t=this.ribbon.items.length-1;this.ribbon.items[t]&&this.ribbon.items[t].header.text===e.getConstant("ChartDesign")&&(this.ribbon.tabObj.select(this.preTabIdx+1),this.parent.hideRibbonTabs([e.getConstant("ChartDesign")],!0),document.getElementsByClassName("e-addchart-ddb").length>0&&document.getElementsByClassName("e-addchart-ddb")[0].remove(),document.getElementsByClassName("e-chart-type-ddb").length>0&&document.getElementsByClassName("e-chart-type-ddb")[0].remove(),document.getElementsByClassName("e-charttheme-ddb").length>0&&document.getElementsByClassName("e-charttheme-ddb")[0].remove(),delete this.ribbon.items[t].content[0],this.ribbon.items.length=this.ribbon.items.length-1)},n.prototype.createRibbon=function(e){var t=this.parent.createElement("div",{id:this.parent.element.id+"_ribbon"});this.ribbon=new qh({selectedTab:0,menuItems:this.getRibbonMenuItems(),items:this.getRibbonItems(),fileMenuItemSelect:this.fileMenuItemSelect.bind(this),beforeOpen:this.fileMenuBeforeOpen.bind(this),beforeClose:this.fileMenuBeforeClose.bind(this),clicked:this.toolbarClicked.bind(this),created:this.ribbonCreated.bind(this),selecting:this.tabSelecting.bind(this),expandCollapse:this.expandCollapseHandler.bind(this),beforeFileMenuItemRender:this.beforeRenderHandler.bind(this),spreadInstance:this.parent&&this.parent.isReact?this.parent:null}),this.ribbon.createElement=this.parent.createElement,e?this.parent.element.insertBefore(t,e):this.parent.element.appendChild(t),this.ribbon.appendTo(t)},n.prototype.tabSelecting=function(e){if(e.selectingIndex!==this.ribbon.selectedTab){var t=this.parent.serviceLocator.getService(Dl);if(this.ribbon.items[e.selectingIndex]&&this.ribbon.items[e.selectingIndex].header.text===t.getConstant("Insert"))for(var r=(n=this.ribbon.items[e.selectingIndex].content).length-1;r>=0;r--)if(n[r].id===this.parent.element.id+"_chart"){(i=n[r].template)&&!i.classList.contains("e-dropdown-btn")&&this.createChartDdb(document.getElementById(this.parent.element.id+"_chart-btn"),!0);break}if(this.ribbon.items[e.selectedIndex]&&this.ribbon.items[e.selectedIndex].header.text===t.getConstant("Insert")){var n;for(r=(n=this.ribbon.items[e.selectedIndex].content).length-1;r>=0;r--)if(n[r].id===this.parent.element.id+"_chart"){var i;(i=n[r].template)&&i.classList.contains("e-dropdown-btn")&&this.destroyComponent(i,"dropdown-btn");break}}this.refreshRibbonContent(e.selectingIndex),this.parent.notify(Fi,{activeTab:e.selectingIndex})}},n.prototype.beforeRenderHandler=function(e){var t=this.parent.serviceLocator.getService(Dl);e.item.text!==t.getConstant("Open")||this.parent.openUrl&&this.parent.allowOpen||e.element.classList.add("e-disabled"),e.item.text!==t.getConstant("SaveAs")||this.parent.saveUrl&&this.parent.allowSave||e.element.classList.add("e-disabled"),e.item.text!==t.getConstant("Print")||this.parent.allowPrint||e.element.classList.add("e-disabled")},n.prototype.getChartThemeDDB=function(t){var r=this,n=this.parent.serviceLocator.getService(Dl),i=this.parent.createElement("button",{id:t+"_chart_theme",attrs:{type:"button"},className:"e-ss-ddb"});i.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text"}));var a="Material",o=this.parent.element.querySelector(".e-ss-overlay-active");if(o){var s=o.querySelector(".e-chart");s?a=(0,e.getComponent)(s,"chart").theme:(s=o.querySelector(".e-accumulationchart"))&&(a=(0,e.getComponent)(s,"accumulationchart").theme)}var l=new Dh.DropDownButton({items:this.getChartThemeDdbItems(a),content:n.getConstant(a),createPopupOnClick:!0,select:function(e){r.parent.notify(rr,{type:"mousedown"}),e.element&&e.element.querySelector(".e-selected-icon")||(l.content=e.item.text,l.dataBind(),r.parent.notify(zo,{chartTheme:e.item.id,triggerEvent:!0}),l.setProperties({items:r.getChartThemeDdbItems(e.item.id)},!0))},cssClass:"e-flat e-charttheme-ddb",beforeOpen:function(e){r.tBarDdbBeforeOpen(e.element,e.items,r.parent.serviceLocator.getService(Dl).getConstant("Chart"))}});return l.createElement=this.parent.createElement,l.appendTo(i),i},n.prototype.getNumFormatDDB=function(e,t){var n=this,i=this.parent.createElement("button",{id:e+"_number_format",attrs:{type:"button"},className:"e-ss-ddb"}),a=this.parent.createElement("span",{className:"e-tbar-btn-text"});a.innerText=t.getConstant("General"),i.appendChild(a);var o={action:"getLocalizedFormats"};this.parent.notify(gr,o);var s=o.defaultFormats,l=o.localizedFormats;return this.numFormatDDB=new Dh.DropDownButton({items:this.getNumFormatDdbItems(e),createPopupOnClick:!0,select:function(e){var t=n.parent.serviceLocator.getService(Dl);if(e.item.text===t.getConstant("Custom"))n.renderCustomFormatDialog(s,l);else{var i=e.item.id.split(n.parent.element.id+"_")[1],a=Vs(i);n.applyNumFormat(a);var o=n.parent.getActiveSheet();n.refreshNumFormatSelection(zs(a,!0),o,t,a);var d=r(o.activeCell);n.refreshTextAlign(o,zn(d[0],d[1],o,!1,!0),i,d),n.numFormatDDB.element.setAttribute("aria-label",i),n.parent.showAggregate&&n.parent.notify(po,{})}},open:function(e){return n.numDDBOpen(e)},beforeItemRender:function(e){return n.previewNumFormat(e)},cssClass:"e-flat e-numformat-ddb",beforeOpen:function(e){n.tBarDdbBeforeOpen(e.element,e.items,n.parent.serviceLocator.getService(Dl).getConstant("NumberFormat"))}}),this.numFormatDDB.createElement=this.parent.createElement,this.numFormatDDB.appendTo(i),i},n.prototype.getFontSizeDDB=function(e){var t=this;return this.fontSizeDdb=new Dh.DropDownButton({cssClass:"e-font-size-ddb",content:"11",createPopupOnClick:!0,items:[{text:"8"},{text:"9"},{text:"10"},{text:"11"},{text:"12"},{text:"14"},{text:"16"},{text:"18"},{text:"20"},{text:"22"},{text:"24"},{text:"26"},{text:"28"},{text:"36"},{text:"48"},{text:"72"}],beforeOpen:function(e){t.tBarDdbBeforeOpen(e.element,e.items,t.parent.serviceLocator.getService(Dl).getConstant("FontSize")),t.refreshSelected(t.fontSizeDdb,e.element,"content","text")},select:function(e){var r={style:{fontSize:e.item.text+"pt"},onActionUpdate:!0};t.parent.notify(ae,r),r.cancel||(t.fontSizeDdb.content=r.style.fontSize.split("pt")[0],t.fontSizeDdb.dataBind()),t.fontSizeDdb.element.setAttribute("aria-label",e.item.text)}}),this.fontSizeDdb.createElement=this.parent.createElement,this.fontSizeDdb.appendTo(this.parent.createElement("button",{id:e+"_font_size",attrs:{type:"button"},className:"e-ss-ddb"})),this.fontSizeDdb.element},n.prototype.getChartDDB=function(e,t){var r,n,i=this.parent.serviceLocator.getService(Dl);t?(r=this.parent.createElement("button",{id:e+"_chart-btn",attrs:{type:"button"}}),(n=this.parent.createElement("span",{id:e+"_chart"})).innerText=i.getConstant("Chart"),r.appendChild(n)):(r=this.parent.createElement("button",{id:e+"_chart-type-btn",attrs:{type:"button"}}),(n=this.parent.createElement("span",{id:e+"_chart_type"})).innerText=i.getConstant("ChartType"),r.appendChild(n),this.createChartDdb(r,!1));return r},n.prototype.closeDropdownPopup=function(e){if(e.altKey&&38===e.keyCode||27===e.keyCode){var t=this[1];t&&(t.toggle(),Md(t.element))}},n.prototype.createChartDdb=function(t,r){var n,i=this,a=this.parent.serviceLocator.getService(Dl),o=r?"e-chart-menu":"e-chart-type-menu",s=this.parent.createElement("ul",{id:this.parent.element.id+(r?"_chart_menu":"_chart_type_menu")}),l=new Dh.DropDownButton({iconCss:"e-icons "+(r?"e-chart-icon":"e-chart-type-icon"),cssClass:r?"e-chart-ddb":"e-chart-type-ddb",target:s,createPopupOnClick:!0,beforeOpen:function(t){n=i.createChartMenu(s,o,a,l),i.tBarDdbBeforeOpen(t.element,n.items,i.parent.serviceLocator.getService(Dl).getConstant("Chart")),e.EventHandler.add(s,"keydown",i.closeDropdownPopup,[i,l])},open:function(){return Md(s)},beforeClose:function(t){t.event&&(0,e.closest)(t.event.target,"."+o)?t.cancel=!0:(e.EventHandler.remove(s,"keydown",i.closeDropdownPopup),n.destroy())}});l.createElement=this.parent.createElement,l.appendTo(t)},n.prototype.createChartMenu=function(t,r,n,i){var a=this,o=new vh.Menu({cssClass:r,items:[{iconCss:"e-icons e-column",text:n.getConstant("Column"),items:[{id:"column_chart"}]},{iconCss:"e-icons e-bar",text:n.getConstant("Bar"),items:[{id:"bar_chart"}]},{iconCss:"e-icons e-area",text:n.getConstant("Area"),items:[{id:"area_chart"}]},{iconCss:"e-icons e-pie-doughnut",text:n.getConstant("PieAndDoughnut"),items:[{id:"pie_doughnut_chart"}]},{iconCss:"e-icons e-line",text:n.getConstant("Line"),items:[{id:"line_chart"}]},{iconCss:"e-icons e-scatter",text:n.getConstant("Scatter"),items:[{id:"scatter_chart"}]}],orientation:"Vertical",beforeOpen:function(t){var r;t.parentItem.text===n.getConstant("Column")?(t.element.firstChild.appendChild(s),r="e-column-chart"):t.parentItem.text===n.getConstant("Bar")?(t.element.firstChild.appendChild(y),r="e-bar-chart"):t.parentItem.text===n.getConstant("Area")?(t.element.firstChild.appendChild(A),r="e-area-chart"):t.parentItem.text===n.getConstant("Line")?(t.element.firstChild.appendChild(L),r="e-line-chart"):t.parentItem.text===n.getConstant("PieAndDoughnut")?(t.element.firstChild.appendChild(q),r="e-pie-doughnut-chart"):t.parentItem.text===n.getConstant("Radar")?(t.element.firstChild.appendChild(K),r="e-radar-chart"):t.parentItem.text===n.getConstant("Scatter")&&(t.element.firstChild.appendChild(ee),r="e-scatter-chart"),r&&(t.element.parentElement.classList.add(r),e.EventHandler.add(t.element,"keydown",a.menuIconKeyDown.bind(a,r+" .e-menu-icon",0)))},select:function(e){return a.chartSelected(e,i)},beforeItemRender:function(e){e.item.text||e.element.removeAttribute("tabindex")},beforeClose:function(t){t.event&&37===t.event.keyCode?t.cancel=!0:e.EventHandler.remove(t.element,"keydown",a.menuIconKeyDown)}}),s=this.parent.createElement("div",{id:"column_main",className:"e-column-main"}),l=this.parent.createElement("div",{id:"column1_text",className:"e-column1-text"});l.innerText=n.getConstant("Column");var d=this.parent.createElement("div",{id:"column1_cont",className:"e-column1-cont"}),h=this.parent.createElement("div",{id:"column2_cont",className:"e-column2-cont"});s.appendChild(l),s.appendChild(d);var p=n.getConstant("ClusteredColumn"),c=this.parent.createElement("span",{id:"clusteredColumn",className:"e-clusteredcolumn e-column-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});p=n.getConstant("StackedColumn");var u=this.parent.createElement("span",{id:"stackedColumn",className:"e-stackedcolumn e-column-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});p=n.getConstant("StackedColumn100");var f=this.parent.createElement("span",{id:"stackedColumn100",className:"e-stackedcolumn100 e-column-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}}),g=this.parent.createElement("span",{id:"clusteredColumn3D",className:"e-clusteredColumn3D e-column-icon"}),m=this.parent.createElement("span",{id:"stackedColumn3D",className:"e-stackedColumn3D e-column-icon"}),v=this.parent.createElement("span",{id:"stackedColumn1003D",className:"e-stackedColumn1003D e-column-icon"});d.appendChild(c),d.appendChild(u),d.appendChild(f),h.appendChild(g),h.appendChild(m),h.appendChild(v);var y=this.parent.createElement("div",{id:"bar_main",className:"e-bar-main"}),C=this.parent.createElement("div",{id:"bar1_text",className:"e-bar1-text"});C.innerText=n.getConstant("Bar");var b=this.parent.createElement("div",{id:"bar1_cont",className:"e-bar1-cont"}),x=this.parent.createElement("div",{id:"bar2_cont",className:"e-bar2-cont"});y.appendChild(C),y.appendChild(b),p=n.getConstant("ClusteredBar");var S=this.parent.createElement("span",{id:"clusteredBar",className:"e-clusteredbar e-bar-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});p=n.getConstant("StackedBar");var w=this.parent.createElement("span",{id:"stackedBar",className:"e-stackedbar e-bar-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});p=n.getConstant("StackedBar100");var I=this.parent.createElement("span",{id:"stackedBar100",className:"e-stackedbar100 e-bar-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}}),E=this.parent.createElement("span",{id:"clusteredBar3D",className:"e-clusteredBar3D e-bar-icon"}),N=this.parent.createElement("span",{id:"stackedBar3D",className:"e-stackedBar3D e-bar-icon"}),R=this.parent.createElement("span",{id:"stackedBar1003D",className:"e-stackedBar1003D e-bar-icon"});b.appendChild(S),b.appendChild(w),b.appendChild(I),x.appendChild(E),x.appendChild(N),x.appendChild(R);var A=this.parent.createElement("div",{id:"area_main",className:"e-area-main"}),k=this.parent.createElement("div",{id:"area_text",className:"e-area-text"});k.innerText=n.getConstant("Area");var O=this.parent.createElement("div",{id:"area_cont",className:"e-area-cont"});A.appendChild(k),A.appendChild(O),p=n.getConstant("Area");var F=this.parent.createElement("span",{id:"area",className:"e-area e-area-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});p=n.getConstant("StackedArea");var T=this.parent.createElement("span",{id:"stackedArea",className:"e-stackedarea e-area-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});p=n.getConstant("StackedArea100");var D=this.parent.createElement("span",{id:"stackedArea100",className:"e-stackedarea100 e-area-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});O.appendChild(F),O.appendChild(T),O.appendChild(D);var L=this.parent.createElement("div",{id:"line_main",className:"e-line-main"}),P=this.parent.createElement("div",{id:"line_text",className:"e-line-text"});P.innerText=n.getConstant("Line");var M=this.parent.createElement("div",{id:"line_cont",className:"e-line-cont"}),B=this.parent.createElement("div",{id:"line_cont_marker",className:"e-line-cont"});L.appendChild(P),L.appendChild(M),L.appendChild(B),p=n.getConstant("Line");var H=this.parent.createElement("span",{id:"line",className:"e-line e-line-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});p=n.getConstant("StackedLine");var U=this.parent.createElement("span",{id:"stackedLine",className:"e-stackedline e-line-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});p=n.getConstant("StackedLine100");var V=this.parent.createElement("span",{id:"stackedLine100",className:"e-stackedline100 e-line-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});p=n.getConstant("LineMarker");var z=this.parent.createElement("span",{id:"lineMarker",className:"e-line-marker e-line-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});p=n.getConstant("StackedLineMarker");var j=this.parent.createElement("span",{id:"stackedLineMarker",className:"e-stackedline-marker e-line-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});p=n.getConstant("StackedLine100Marker");var _=this.parent.createElement("span",{id:"stackedLine100Marker",className:"e-stackedline100-marker e-line-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});M.appendChild(H),M.appendChild(U),M.appendChild(V),B.appendChild(z),B.appendChild(j),B.appendChild(_);var q=this.parent.createElement("div",{id:"pie_main",className:"e-pie-main"}),W=this.parent.createElement("div",{id:"pie_text",className:"e-pie-text"});W.innerText=n.getConstant("Pie");var G=this.parent.createElement("div",{id:"pie_cont",className:"e-pie-cont"});q.appendChild(W),q.appendChild(G),p=n.getConstant("Pie");var Y=this.parent.createElement("span",{id:"pie",className:"e-pie e-pie-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});p=n.getConstant("Doughnut");var X=this.parent.createElement("span",{id:"doughnut",className:"e-doughnut e-pie-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});G.appendChild(Y),G.appendChild(X);var K=this.parent.createElement("div",{id:"radar_main",className:"e-radar-main"}),$=this.parent.createElement("div",{id:"radar_text",className:"e-radar-text"});$.innerText=n.getConstant("Radar");var Z=this.parent.createElement("div",{id:"radar_cont",className:"e-radar-cont"});K.appendChild($),K.appendChild(Z);var J=this.parent.createElement("span",{id:"radar",className:"e-radar e-radar-icon e-menu-icon e-icons",attrs:{tabindex:"-1"}}),Q=this.parent.createElement("span",{id:"radar_markers",className:"e-radar-markers e-radar-icon e-menu-icon e-icons",attrs:{tabindex:"-1"}});J.title=n.getConstant("BlueDataBar"),Q.title=n.getConstant("GreenDataBar"),Z.appendChild(J),Z.appendChild(Q);var ee=this.parent.createElement("div",{id:"scatter_main",className:"e-scatter-main"}),te=this.parent.createElement("div",{id:"scatter_text",className:"e-scatter-text"});p=n.getConstant("Scatter"),te.innerText=p;var re=this.parent.createElement("div",{id:"scatter_cont",className:"e-scatter-cont"});ee.appendChild(te),ee.appendChild(re);var ne=this.parent.createElement("span",{id:"scatter",className:"e-scatter e-scatter-icon e-menu-icon e-icons",attrs:{title:p,"aria-label":p,tabindex:"-1"}});return re.appendChild(ne),o.createElement=this.parent.createElement,o.appendTo(t),t.classList.add("e-ul"),o},n.prototype.getAddChartEleDBB=function(t){var r,n=this,i=this.parent.serviceLocator.getService(Dl),a=this.parent.createElement("ul",{id:t+"_add_chart_menu"});this.addChartDdb=new Dh.DropDownButton({iconCss:"e-icons e-addchart-icon",cssClass:"e-addchart-ddb",target:a,createPopupOnClick:!0,close:function(){return Md(n.parent.element)},beforeOpen:function(t){r=n.createAddChartMenu(a,i),n.tBarDdbBeforeOpen(t.element,r.items),e.EventHandler.add(a,"keydown",n.closeDropdownPopup,[n,n.addChartDdb])},open:function(){return Md(a)},beforeClose:function(t){t.event&&(0,e.closest)(t.event.target,".e-addchart-menu")?t.cancel=!0:(e.EventHandler.remove(a,"keydown",n.closeDropdownPopup),r.destroy())}}),this.addChartDdb.createElement=this.parent.createElement;var o=this.parent.createElement("button",{id:t+"_addchart",attrs:{type:"button"}}),s=this.parent.createElement("span",{id:t+"_chart"});return s.innerText=i.getConstant("AddChartElement"),o.appendChild(s),this.addChartDdb.appendTo(o),this.addChartDdb.element},n.prototype.createAddChartMenu=function(t,r){var n=this,i=[],a=this.parent.element.querySelector(".e-datavisualization-chart.e-ss-overlay-active");a&&(i=a.querySelector(".e-chart")?[{iconCss:"e-icons e-axes",text:r.getConstant("Axes"),items:[{iconCss:"e-icons e-ph-axes",id:"PHAxes",text:r.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axes",id:"PVAxes",text:r.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-axis-title",text:r.getConstant("AxisTitle"),items:[{iconCss:"e-icons e-ph-axistitle",id:"PHAxisTitle",text:r.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axistitle",id:"PVAxisTitle",text:r.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-chart-title",text:r.getConstant("ChartTitle"),items:[{iconCss:"e-icons e-ct-none",id:"ChartTitleNone",text:r.getConstant("None")},{iconCss:"e-icons e-ct-abovechart",id:"ChartTitleAbove",text:r.getConstant("AboveChart")}]},{iconCss:"e-icons e-data-labels",id:this.parent.element.id+"data-labels",text:r.getConstant("DataLabels"),items:[{iconCss:"e-icons e-dl-none",id:"DLNone",text:r.getConstant("None")},{iconCss:"e-icons e-dl-center",id:"DLCenter",text:r.getConstant("Center")},{iconCss:"e-icons e-dl-insideend",id:"DLInsideend",text:r.getConstant("InsideEnd")},{iconCss:"e-icons e-dl-insidebase",id:"DLInsidebase",text:r.getConstant("InsideBase")},{iconCss:"e-icons e-dl-outsideend",id:"DLOutsideend",text:r.getConstant("OutsideEnd")}]},{iconCss:"e-icons e-gridlines",text:r.getConstant("Gridlines"),items:[{iconCss:"e-icons e-gl-major-horizontal",id:"GLMajorHorizontal",text:r.getConstant("PrimaryMajorHorizontal")},{iconCss:"e-icons e-gl-major-vertical",id:"GLMajorVertical",text:r.getConstant("PrimaryMajorVertical")},{iconCss:"e-icons e-gl-minor-horizontal",id:"GLMinorHorizontal",text:r.getConstant("PrimaryMinorHorizontal")},{iconCss:"e-icons e-gl-minor-vertical",id:"GLMinorVertical",text:r.getConstant("PrimaryMinorVertical")}]},{iconCss:"e-icons e-legends",text:r.getConstant("Legends"),items:[{iconCss:"e-icons e-legends-none",id:"LegendNone",text:r.getConstant("None")},{iconCss:"e-icons e-legends-right",id:"LegendsRight",text:r.getConstant("Right")},{iconCss:"e-icons e-legends-left",id:"LegendsLeft",text:r.getConstant("Left")},{iconCss:"e-icons e-legends-bottom",id:"LegendsBottom",text:r.getConstant("Bottom")},{iconCss:"e-icons e-legends-top",id:"LegendsTop",text:r.getConstant("Top")}]}]:[{iconCss:"e-icons e-chart-title",text:r.getConstant("ChartTitle"),items:[{iconCss:"e-icons e-ct-none",id:"ChartTitleNone",text:r.getConstant("None")},{iconCss:"e-icons e-ct-abovechart",id:"ChartTitleAbove",text:r.getConstant("AboveChart")}]},{iconCss:"e-icons e-data-labels",id:this.parent.element.id+"data-labels",text:r.getConstant("DataLabels"),items:[{iconCss:"e-icons e-dl-none",id:"DLNone",text:r.getConstant("None")},{iconCss:"e-icons e-dl-center",id:"DLCenter",text:r.getConstant("Center")},{iconCss:"e-icons e-dl-insideend",id:"DLInsideend",text:r.getConstant("InsideEnd")},{iconCss:"e-icons e-dl-insidebase",id:"DLInsidebase",text:r.getConstant("InsideBase")},{iconCss:"e-icons e-dl-outsideend",id:"DLOutsideend",text:r.getConstant("OutsideEnd")}]},{iconCss:"e-icons e-legends",text:r.getConstant("Legends"),items:[{iconCss:"e-icons e-legends-none",id:"LegendNone",text:r.getConstant("None")},{iconCss:"e-icons e-legends-right",id:"LegendsRight",text:r.getConstant("Right")},{iconCss:"e-icons e-legends-left",id:"LegendsLeft",text:r.getConstant("Left")},{iconCss:"e-icons e-legends-bottom",id:"LegendsBottom",text:r.getConstant("Bottom")},{iconCss:"e-icons e-legends-top",id:"LegendsTop",text:r.getConstant("Top")}]}]);var o=new vh.Menu({cssClass:"e-addchart-menu",title:r.getConstant("AddChartElement"),orientation:"Vertical",select:this.addChartEleSelected.bind(this),items:i,beforeOpen:function(t){if(t.parentItem.id===n.parent.element.id+"data-labels"){var i=n.parent.element.querySelector(".e-ss-overlay-active");if(i){var a=i.querySelector(".e-chart");if(a){var o=(0,e.getComponent)(a,"chart");if(o.series[0]&&o.series[0].type.includes("Line")){var s=function(e,t){if(e){var n=e.parentElement;n.innerHTML="",n.appendChild(e),n.appendChild(document.createTextNode(r.getConstant(t)))}};s(t.element.querySelector(".e-dl-insideend"),"Above"),s(t.element.querySelector(".e-dl-insidebase"),"Below");var l=t.element.querySelector(".e-dl-outsideend");l&&(l.parentElement.style.display="none")}}}}}});return o.createElement=this.parent.createElement,o.appendTo(t),t.classList.add("e-ul"),o},n.prototype.getCFDBB=function(t){var r,n=this,i=this.parent.createElement("ul",{id:t+"_cf_menu"});return this.cfDdb=new Dh.DropDownButton({iconCss:"e-icons e-conditionalformatting-icon",cssClass:"e-cf-ddb",target:i,createPopupOnClick:!0,close:function(){return Md(n.parent.element)},beforeOpen:function(t){r=n.createCFMenu(i),n.tBarDdbBeforeOpen(t.element,r.items,n.parent.serviceLocator.getService(Dl).getConstant("ConditionalFormatting")),e.EventHandler.add(i,"keydown",n.closeDropdownPopup,[n,n.cfDdb])},open:function(){return Md(i)},beforeClose:function(t){t.event&&(0,e.closest)(t.event.target,".e-cf-menu")?t.cancel=!0:(e.EventHandler.remove(i,"keydown",n.closeDropdownPopup),r&&r.element&&(Kd(n.spanElements),n.spanElements=[],Kd(n.iconWrapElements),n.iconWrapElements=[],Kd(n.iconSetElements),n.iconSetElements=[],Kd(n.iconSetGroupElement),n.iconSetGroupElement=[],r.destroy(),r.element.remove()))}}),this.cfDdb.createElement=this.parent.createElement,this.cfDdb.appendTo(this.parent.createElement("button",{id:t+"_conditionalformatting",attrs:{type:"button"}})),this.cfDdb.element},n.prototype.createCFMenu=function(t){var r=this,n=this.parent.serviceLocator.getService(Dl),i=function(e,t,i){var a;e.forEach((function(e){a=n.getConstant(e+t);var o=r.parent.createElement("span",{id:e+t,className:"e-"+e.toLowerCase()+" e-cf-icon",attrs:{title:a,"aria-label":a,tabindex:"-1"}});r.spanElements.push(o),i.appendChild(o)}))},a=new vh.Menu({cssClass:"e-cf-menu",items:[{iconCss:"e-icons e-hlcellrules",text:n.getConstant("HighlightCellsRules"),items:[{iconCss:"e-icons e-greaterthan",id:"cf_greaterthan_dlg",text:n.getConstant("GreaterThan")+"..."},{iconCss:"e-icons e-lessthan",id:"cf_lessthan_dlg",text:n.getConstant("LessThan")+"..."},{iconCss:"e-icons e-between",id:"cf_between_dlg",text:n.getConstant("Between")+"..."},{iconCss:"e-icons e-equalto",id:"cf_eqaulto_dlg",text:n.getConstant("CFEqualTo")+"..."},{iconCss:"e-icons e-textcontains",id:"cf_textcontains_dlg",text:n.getConstant("TextThatContains")+"..."},{iconCss:"e-icons e-adateoccuring",id:"cf_adateoccuring_dlg",text:n.getConstant("ADateOccuring")+"..."},{iconCss:"e-icons e-duplicate",id:"cf_duplicatevalues_dlg",text:n.getConstant("DuplicateValues")+"..."}]},{iconCss:"e-icons e-topbottomrules",text:n.getConstant("TopBottomRules"),items:[{iconCss:"e-icons e-top10items",id:"cf_top10items_dlg",text:n.getConstant("Top10Items")+"..."},{iconCss:"e-icons e-top10",id:"cf_top10_dlg",text:n.getConstant("Top10")+" %..."},{iconCss:"e-icons e-bottom10items",id:"cf_bottom10items_dlg",text:n.getConstant("Bottom10Items")+"..."},{iconCss:"e-icons e-bottom10",id:"cf_bottom10_dlg",text:n.getConstant("Bottom10")+" %..."},{iconCss:"e-icons e-aboveaverage",id:"cf_aboveaverage_dlg",text:n.getConstant("AboveAverage")+"..."},{iconCss:"e-icons e-belowaverage",id:"cf_belowaverage_dlg",text:n.getConstant("BelowAverage")+"..."}]},{iconCss:"e-icons e-databars",text:n.getConstant("DataBars"),items:[{id:"db_icons1"},{id:"db_icons2"}]},{iconCss:"e-icons e-colorscales",text:n.getConstant("ColorScales"),items:[{id:"cs_icons1"},{id:"cs_icons2"},{id:"cs_icons3"}]},{iconCss:"e-icons e-iconsets",text:n.getConstant("IconSets"),items:[{id:"is_icons"}]},{iconCss:"e-icons e-clearrules",text:n.getConstant("ClearRules"),items:[{id:"cf_cr_cells",text:n.getConstant("SelectedCells")},{id:"cf_cr_sheet",text:n.getConstant("EntireSheet")}]}],orientation:"Vertical",beforeOpen:function(t){if("e-icons e-databars"===t.parentItem.iconCss)t.element.parentElement.classList.add("e-databars"),i(["Blue","Green","Red"],"DataBar",t.element.firstChild),i(["Orange","LightBlue","Purple"],"DataBar",t.element.lastChild),e.EventHandler.add(t.element,"keydown",r.menuIconKeyDown.bind(r,"e-cf-icon",3));else if("e-icons e-colorscales"===t.parentItem.iconCss)t.element.parentElement.classList.add("e-colorscales"),i(["GYR","RYG","GWR","RWG"],"ColorScale",t.element.firstChild),i(["BWR","RWB","WR","RW"],"ColorScale",t.element.querySelector("#cs_icons2")),i(["GW","WG","GY","YG"],"ColorScale",t.element.lastChild),e.EventHandler.add(t.element,"keydown",r.menuIconKeyDown.bind(r,"e-cf-icon",4));else if("e-icons e-iconsets"===t.parentItem.iconCss){t.element.parentElement.classList.add("e-iconsets");var a=r.parent.createElement("div",{id:"is",className:"e-is"});r.iconSetGroupElement.push(a);var o,s,l,d;[{hdr:"Directional"},{cont:[{cls:"3arrows",key:"ThreeArrowsColor",id:"ThreeArrows",count:3},{cls:"3arrowsgray",key:"ThreeArrowsGray",count:3},{cls:"3triangles",key:"ThreeTriangles",count:3},{cls:"4arrowsgray",key:"FourArrowsGray",count:4},{cls:"4arrows",key:"FourArrowsColor",id:"FourArrows",count:4},{cls:"5arrowsgray",key:"FiveArrowsGray",count:5},{cls:"5arrows",key:"FiveArrowsColor",id:"FiveArrows",count:5}]},{hdr:"Shapes"},{cont:[{cls:"3trafficlights",key:"ThreeTrafficLights1",count:3},{cls:"3rafficlights2",key:"ThreeTrafficLights2",count:3},{cls:"3signs",key:"ThreeSigns",count:3},{cls:"4trafficlights",key:"FourTrafficLights",count:4},{cls:"4redtoblack",key:"RedToBlack",id:"FourRedToBlack",count:4}]},{hdr:"Indicators"},{cont:[{cls:"3symbols",key:"ThreeSymbols1",id:"ThreeSymbols",count:3},{cls:"3symbols2",key:"ThreeSymbols2",count:3},{cls:"3flags",key:"ThreeFlags",count:3}]},{hdr:"Ratings"},{cont:[{cls:"3stars",key:"ThreeStars",count:3},{cls:"4rating",key:"FourRatings",id:"FourRating",count:4},{cls:"5quarters",key:"FiveQuarters",count:5},{cls:"5rating",key:"FiveRatings",id:"FiveRating",count:5},{cls:"5boxes",key:"FiveBoxes",count:5}]}].forEach((function(e,t){o=r.parent.createElement("div",{id:"is"+(t+1),className:"e-is"+(t+1)}),r.iconSetElements.push(o),e.hdr?o.innerText=n.getConstant(e.hdr):e.cont.forEach((function(e){for(l=n.getConstant(e.key),s=r.parent.createElement("div",{id:e.id||e.key,className:"e-"+e.cls+" e-is-wrapper",attrs:{title:l,"aria-label":l,tabindex:"-1"}}),r.iconWrapElements.push(s),d=0;d<e.count;d++){var t=r.createElement("span","e-"+e.cls+"-"+(d+1)+" e-iconsetspan");r.spanElements.push(t),s.appendChild(t)}o.appendChild(s)})),a.appendChild(o)})),t.element.firstChild.appendChild(a),e.EventHandler.add(t.element,"keydown",r.menuIconKeyDown.bind(r,"e-is-wrapper",0))}},select:this.cfSelected.bind(this),beforeItemRender:function(e){(e.item.id.includes("db_icons")||e.item.id.includes("cs_icons")||"is_icons"===e.item.id)&&e.element.removeAttribute("tabindex")},beforeClose:function(t){var n=["e-icons e-databars","e-icons e-colorscales","e-icons e-iconsets"].indexOf(t.parentItem.iconCss)>-1;t.cancel=t.event&&37===t.event.keyCode&&n,n&&!t.cancel&&e.EventHandler.remove(t.element,"keydown",r.menuIconKeyDown)}});return a.createElement=this.parent.createElement,a.appendTo(t),t.classList.add("e-ul"),a},n.prototype.menuIconKeyDown=function(e,t,r){var n,i=[];if(r){if(40===r.keyCode||39===r.keyCode||38===r.keyCode||37===r.keyCode)if(r.preventDefault(),-1===(n=(i=[].slice.call(document.querySelectorAll("."+e))).indexOf(r.target)))n=0;else if(39===r.keyCode)++n===i.length&&(n=0);else if(37===r.keyCode)-1===--n&&(n=i.length-1);else if(!e.includes("e-menu-icon")){var a=i.length,o=void 0,s=void 0;t||(t=2,40===r.keyCode?(o=[6,11,14,19],s=[5,10,13]):(o=[7,12,15],s=[8,13,16]),a--),40===r.keyCode?n===a-1?n=0:(n+=o&&o.indexOf(n)>-1?1:s&&s.indexOf(n)>-1?3:t,o&&a++,n>=a&&(n=n-a+1)):0===n?n=a-1:(n-=o&&o.indexOf(n)>-1?1:s&&s.indexOf(n)>-1?3:t)<0&&(n=o?a:a+n-1)}}else n=0,i=[].slice.call(document.querySelectorAll("."+e));i[n]&&Md(i[n])},n.prototype.createElement=function(e,t){return this.parent.createElement(e,{className:t})},n.prototype.getBordersDBB=function(t){var r,n=this,i=this.parent.createElement("ul",{id:t+"_borders_menu"});return this.cPickerEle=this.parent.createElement("input",{id:t+"_cell_border_color",attrs:{type:"color"}}),this.parent.element.appendChild(this.cPickerEle),this.colorPicker=new Ih.ColorPicker({cssClass:"e-border-colorpicker",mode:"Palette",inline:!0,beforeTileRender:function(e){e.element.tabIndex=-1},change:function(e){var t=n.border.split(" ");t[2]=e.currentValue.hex,n.border=t.join(" ")}}),this.colorPicker.createElement=this.parent.createElement,this.colorPicker.appendTo(this.cPickerEle),this.bordersDdb=new Dh.DropDownButton({iconCss:"e-icons e-bottom-borders",cssClass:"e-borders-ddb",target:i,createPopupOnClick:!0,beforeOpen:function(t){r=n.createBorderMenu(i),n.tBarDdbBeforeOpen(t.element,r.items,n.parent.serviceLocator.getService(Dl).getConstant("Borders"),1),e.EventHandler.add(i,"keydown",n.closeDropdownPopup,[n,n.bordersDdb])},open:function(){return Md(i)},beforeClose:function(t){t.event&&(0,e.closest)(t.event.target,".e-borders-menu")?t.cancel=!0:(e.EventHandler.remove(i,"keydown",n.closeDropdownPopup),r.destroy())},close:function(){return Md(n.bordersDdb.element)}}),this.bordersDdb.createElement=this.parent.createElement,this.bordersDdb.appendTo(this.parent.createElement("button",{id:t+"_borders",attrs:{type:"button"}})),this.bordersDdb.element},n.prototype.createBorderMenu=function(t){var r=this,n=this.parent.serviceLocator.getService(Dl),i=this.parent.element.id,a=new vh.Menu({cssClass:"e-borders-menu",items:[{iconCss:"e-icons e-top-borders",text:n.getConstant("TopBorders"),id:i+"_border_topborders"},{iconCss:"e-icons e-left-borders",text:n.getConstant("LeftBorders"),id:i+"_border_leftborders"},{iconCss:"e-icons e-right-borders",text:n.getConstant("RightBorders"),id:i+"_border_rightborders"},{iconCss:"e-icons e-bottom-borders",text:n.getConstant("BottomBorders"),id:i+"_border_bottomborders"},{iconCss:"e-icons e-all-borders",text:n.getConstant("AllBorders"),id:i+"_border_allborders"},{iconCss:"e-icons e-horizontal-borders",text:n.getConstant("HorizontalBorders"),id:i+"_border_horizontalborders"},{iconCss:"e-icons e-vertical-borders",text:n.getConstant("VerticalBorders"),id:i+"_border_verticalborders"},{iconCss:"e-icons e-outside-borders",text:n.getConstant("OutsideBorders"),id:i+"_border_outsideborders"},{iconCss:"e-icons e-inside-borders",text:n.getConstant("InsideBorders"),id:i+"_border_insideborders"},{iconCss:"e-icons e-no-borders",text:n.getConstant("NoBorders"),id:i+"_border_noborders"},{separator:!0},{text:n.getConstant("BorderColor"),items:[{id:i+"_border_colors"}],id:i+"_border_bordercolor"},{text:n.getConstant("BorderStyle"),items:[{iconCss:"e-icons e-selected-icon",id:i+"_1px"},{id:i+"_2px"},{id:i+"_3px"},{id:i+"_dashed"},{id:i+"_dotted"},{id:i+"_double"}]}],orientation:"Vertical",beforeOpen:function(e){if(e.parentItem.id===i+"_border_bordercolor"){r.colorPicker.refresh();var t=r.colorPicker.element.parentElement;e.element.firstElementChild.appendChild(t),t.style.display="inline-block",e.element.parentElement.classList.add("e-border-color"),e.element.firstElementChild.removeAttribute("tabindex")}else e.element.classList.add("e-border-style")},beforeClose:function(t){if(t.event&&t.parentItem.id===i+"_border_bordercolor")if(!(0,e.closest)(t.event.target,".e-border-colorpicker")||(0,e.closest)(t.event.target,".e-apply")||(0,e.closest)(t.event.target,".e-cancel")){r.colorPicker=(0,e.getComponent)(r.cPickerEle,"colorpicker"),"Picker"===r.colorPicker.mode&&(r.colorPicker.mode="Palette",r.colorPicker.dataBind());var n=r.colorPicker.element.parentElement;n.style.display="",r.parent.element.appendChild(n)}else t.cancel=!0},onOpen:function(e){if(e.parentItem.id===i+"_border_bordercolor"){e.element.parentElement.style.overflow="visible";var t=e.element.querySelector(".e-color-palette .e-palette");t&&Md(t)}},onClose:function(){return Md(a.element)},select:function(e){r.borderSelected(e,a)}});return a.createElement=this.parent.createElement,a.appendTo(t),t.classList.add("e-ul"),a},n.prototype.chartSelected=function(t,r){var n=!(0,e.isNullOrUndefined)((0,e.closest)(t.element,".e-chart-menu")),i=t.element.id;if("column_chartbar_chartarea_chartpie_doughnut_chartline_chartradar_chartscatter_chart".includes(i)){!t.item||t.item.items&&t.item.items.length||r.toggle();var a=t.event.target.id;this.parent.notify(Bo,{action:i,id:a,isChart:n})}},n.prototype.addChartEleSelected=function(e){var t=e.element.id;this.parent.notify(zo,{addChartEle:t,triggerEvent:!0}),!e.item||e.item.items&&e.item.items.length||this.addChartDdb.toggle()},n.prototype.cfSelected=function(e){var r=this.parent.getActiveSheet();if(e.item.id.includes("_dlg"))this.parent.notify(fo,{action:e.item.text});else{var n=e.item.id.includes("icons");if(n||"cf_cr_cells"===e.item.id||"cf_cr_sheet"===e.item.id)if(Qr(this.parent,c(t(r.selectedRange))))this.parent.notify(to,null);else if(n){var i=e.event.target;this.parent.notify(At,{cfModel:{type:i.id||i.parentElement.id,range:r.selectedRange},isAction:!0})}else"cf_cr_cells"===e.item.id?this.parent.notify(Ot,{range:r.selectedRange,isAction:!0}):"cf_cr_sheet"===e.item.id&&(this.parent.conditionalFormat=null,this.parent.notify(Ot,{isAction:!0}))}!e.item||e.item.items&&e.item.items.length||this.cfDdb.toggle()},n.prototype.borderSelected=function(e,t){this.bordersDdb.element.setAttribute("aria-label",e.item.text);var r=this.parent.element.id;if(!e.item.items.length&&e.item.id!==r+"_border_colors"){if(!e.item.text){var n=this.border.split(" "),i="solid"===n[1]?r+"_"+n[0]:r+"_"+n[1];if(i===e.item.id)return;return e.item.id===r+"_1px"||e.item.id===r+"_2px"||e.item.id===r+"_3px"?(n[0]=e.item.id.split(r+"_")[1],n[1]="solid"):(n[1]=e.item.id.split(r+"_")[1],n[0]="double"===n[1]?"3px":"1px"),this.border=n.join(" "),t.items[12].items.forEach((function(t){t.id===i&&(t.iconCss=null),t.id===e.item.id&&(t.iconCss="e-icons e-selected-icon")})),void t.setProperties({items:t.items},!0)}switch(this.bordersDdb.toggle(),this.parent.showSpinner(),e.item.id){case r+"_border_topborders":this.parent.notify(ae,{style:{borderTop:this.border},onActionUpdate:!0});break;case r+"_border_leftborders":this.parent.notify(ae,{style:{borderLeft:this.border},onActionUpdate:!0});break;case r+"_border_rightborders":this.parent.notify(ae,{style:{borderRight:this.border},onActionUpdate:!0});break;case r+"_border_bottomborders":this.parent.notify(ae,{style:{borderBottom:this.border},onActionUpdate:!0});break;case r+"_border_allborders":this.parent.notify(ae,{style:{border:this.border},onActionUpdate:!0});break;case r+"_border_horizontalborders":this.parent.notify(ae,{style:{border:this.border},onActionUpdate:!0,borderType:"Horizontal"});break;case r+"_border_verticalborders":this.parent.notify(ae,{style:{border:this.border},onActionUpdate:!0,borderType:"Vertical"});break;case r+"_border_outsideborders":this.parent.notify(ae,{style:{border:this.border},onActionUpdate:!0,borderType:"Outer"});break;case r+"_border_insideborders":this.parent.notify(ae,{style:{border:this.border},onActionUpdate:!0,borderType:"Inner"});break;case r+"_border_noborders":this.parent.notify(ae,{style:{border:""},onActionUpdate:!0})}this.parent.hideSpinner()}},n.prototype.getFontNameDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_font_name",attrs:{type:"button"},className:"e-ss-ddb"}),n=this.parent.createElement("span",{className:"e-tbar-btn-text"});return n.innerText="Calibri",r.appendChild(n),this.fontNameDdb=new Dh.DropDownButton({cssClass:"e-font-family",items:this.getFontFamilyItems(),createPopupOnClick:!0,select:function(e){var n={style:{fontFamily:e.item.text},onActionUpdate:!0};t.parent.notify(ae,n),r.setAttribute("aria-label",e.item.text),n.cancel||t.refreshFontNameSelection(n.style.fontFamily)},beforeOpen:function(e){t.tBarDdbBeforeOpen(e.element,e.items,t.parent.serviceLocator.getService(Dl).getConstant("Font"))}}),this.fontNameDdb.createElement=this.parent.createElement,this.fontNameDdb.appendTo(r),r},n.prototype.getBtn=function(e,t,r,n){void 0===n&&(n=!0);var i=new Eh.Button({iconCss:"e-icons e-"+t+"-icon",cssClass:"e-flat",isToggle:!0});return i.createElement=this.parent.createElement,i.appendTo(this.parent.createElement("button",{id:e+"_"+t,attrs:{"aria-label":r,type:"button"}})),n&&i.element.addEventListener("click",this.toggleBtnClicked.bind(this)),i.element},n.prototype.datavalidationDDB=function(e){var t,r=this,n=this.parent.serviceLocator.getService(Dl);return this.datavalidationDdb=new Dh.DropDownButton({cssClass:"e-datavalidation-ddb",iconCss:"e-datavalidation-icon e-icons",content:n.getConstant("DataValidation"),items:[{text:n.getConstant("DataValidation")},{text:n.getConstant("HighlightInvalidData")},{text:n.getConstant("ClearHighlight")},{text:n.getConstant("ClearValidation")}],createPopupOnClick:!0,beforeOpen:function(e){r.refreshSelected(r.datavalidationDdb,e.element,"iconCss"),e.element.setAttribute("aria-label",n.getConstant("DataValidation"))},select:function(e){switch(e.item.text){case n.getConstant("DataValidation"):r.parent.notify(Va,null);break;case n.getConstant("HighlightInvalidData"):r.parent.notify(_a,{});break;case n.getConstant("ClearHighlight"):r.parent.notify(_a,{isRemoveHighlight:!0});break;case n.getConstant("ClearValidation"):r.parent.notify(ho,{isAction:!0});break;default:t=e.item.text===n.getConstant("SortAscending")?"Ascending":"Descending",r.parent.notify(ia,{sortOptions:{sortDescriptors:{order:t}}})}r.datavalidationDdb.element.setAttribute("aria-label",e.item.text)}}),this.datavalidationDdb.createElement=this.parent.createElement,this.datavalidationDdb.appendTo(this.parent.createElement("button",{id:e+"_datavalidation",attrs:{type:"button"},className:"e-ss-ddb"})),this.datavalidationDdb.element},n.prototype.getTextAlignDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(Dl);return this.textAlignDdb=new Dh.DropDownButton({cssClass:"e-align-ddb",iconCss:"e-icons e-left-icon",items:[{iconCss:"e-icons e-left-icon"},{iconCss:"e-icons e-center-icon"},{iconCss:"e-icons e-right-icon"}],beforeItemRender:this.alignItemRender.bind(this),createPopupOnClick:!0,beforeOpen:function(e){t.refreshSelected(t.textAlignDdb,e.element,"iconCss"),e.element.setAttribute("aria-label",r.getConstant("HorizontalAlignment"))},select:function(e){var n={style:{textAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};t.parent.notify(ae,n),n.cancel||(t.textAlignDdb.iconCss="e-icons e-"+n.style.textAlign+"-icon",t.textAlignDdb.dataBind()),t.textAlignDdb.element.setAttribute("aria-label",r.getConstant("HorizontalAlignment")+" "+r.getConstant("Align"+t.getAlignText(e)))}}),this.textAlignDdb.createElement=this.parent.createElement,this.textAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_text_align",attrs:{type:"button"},className:"e-ss-ddb"})),this.textAlignDdb.element},n.prototype.getVerticalAlignDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(Dl);return this.verticalAlignDdb=new Dh.DropDownButton({cssClass:"e-align-ddb",iconCss:"e-icons e-bottom-icon",items:[{iconCss:"e-icons e-top-icon"},{iconCss:"e-icons e-middle-icon"},{iconCss:"e-icons e-bottom-icon"}],beforeItemRender:this.alignItemRender.bind(this),createPopupOnClick:!0,beforeOpen:function(e){t.refreshSelected(t.verticalAlignDdb,e.element,"iconCss"),e.element.setAttribute("aria-label",r.getConstant("VerticalAlignment"))},select:function(e){var n={style:{verticalAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};t.parent.notify(ae,n),n.cancel||(t.verticalAlignDdb.iconCss="e-icons e-"+n.style.verticalAlign+"-icon",t.verticalAlignDdb.dataBind()),t.verticalAlignDdb.element.setAttribute("aria-label",r.getConstant("VerticalAlignment")+" "+r.getConstant("Align"+t.getAlignText(e)))}}),this.verticalAlignDdb.createElement=this.parent.createElement,this.verticalAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_vertical_align",attrs:{type:"button"},className:"e-ss-ddb"})),this.verticalAlignDdb.element},n.prototype.getMergeSplitBtn=function(e){var t=this;this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_merge",attrs:{type:"button"}}));var r=this.parent.serviceLocator.getService(Dl);return this.mergeSplitBtn=new Dh.SplitButton({cssClass:"e-merge-ddb",iconCss:"e-icons e-merge-icon",createPopupOnClick:!0,items:[{text:r.getConstant("MergeAll"),id:e+"_merge_all"},{text:r.getConstant("MergeHorizontally"),id:e+"_merge_horizontally"},{text:r.getConstant("MergeVertically"),id:e+"_merge_vertically"},{separator:!0,id:e+"_merge_separator"},{text:r.getConstant("Unmerge"),id:e+"_unmerge"}],select:this.mergeSelectHandler.bind(this),click:function(e){e.element.setAttribute("aria-label",r.getConstant("MergeCells")),e.element.classList.contains("e-active")?t.unMerge():t.merge(t.parent.element.id+"_merge_all")},created:function(){var e=r.getConstant("MergeCells");t.mergeSplitBtn.element.title=e,t.mergeSplitBtn.element.setAttribute("aria-label",e),t.mergeSplitBtn.element.nextElementSibling.title=r.getConstant("SelectMergeType")},beforeOpen:function(e){return e.element.setAttribute("aria-label",r.getConstant("MergeCells"))}}),this.mergeSplitBtn.createElement=this.parent.createElement,this.mergeSplitBtn.appendTo("#"+e+"_merge"),this.mergeSplitBtn.element.parentElement},n.prototype.mergeSelectHandler=function(e){e.item.id===this.parent.element.id+"_unmerge"?this.unMerge():this.merge(e.item.id),this.mergeSplitBtn.element.setAttribute("aria-label",e.item.text)},n.prototype.unMerge=function(e){var r=this.parent.getActiveSheet(),n=c(t(r.selectedRange));if(Qr(this.parent,n))this.parent.notify(to,null);else{this.parent.showSpinner();for(var i=r.selectedRange,a=[],o=n[0];o<=n[2];o++)for(var s=n[1];s<=n[3];s++){var l=zn(o,s,r);if(l&&(l.rowSpan>1||l.colSpan>1)){var d={range:[o,s,o,s]};this.parent.notify(It,d),a.push(d.range)}}var h={merge:!1,range:e&&e.range||i,isAction:!0,refreshRibbon:!0,type:"All"};a.length>0&&(h.mergeCollection=a),this.parent.notify(St,h),this.toggleActiveState(!1),this.parent.hideSpinner()}},n.prototype.merge=function(e){var r,n=this,i=this.parent.getActiveSheet(),a=t(i.selectedRange);if(Qr(this.parent,c(a)))this.parent.notify(to,null);else{for(var o,s=e.includes("merge_all"),l=a[0];l<=a[2];l++)for(var d=a[1];d<=a[3];d++)l===a[0]&&d===a[1]&&s||l===a[0]&&e.includes("merge_vertically")||d===a[1]&&e.includes("_merge_horizontally")||((r=zn(l,d,i)||{}).value||r.formula)&&(o=!0);if(!o)return this.performMerge(e),void(s&&this.toggleActiveState(!0));var h=this.parent.serviceLocator.getService(Ll);h.show({height:200,width:400,isModal:!0,showCloseIcon:!0,cssClass:"e-merge-alert-dlg",content:this.parent.serviceLocator.getService(Dl).getConstant("MergeCellsAlert"),beforeOpen:function(e){var t={dialogName:"MergeAlertDialog",element:e.element,target:e.target,cancel:e.cancel};n.parent.trigger("dialogBeforeOpen",t),t.cancel?e.cancel=!0:Md(n.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(Dl).getConstant("Ok"),isPrimary:!0},click:function(){h.hide(),n.performMerge(e),s&&n.toggleActiveState(!0)}}]})}},n.prototype.performMerge=function(e){var t=this.parent.element.id;switch(this.parent.showSpinner(),e){case t+"_merge_all":this.parent.notify(St,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"All",isAction:!0,refreshRibbon:!0});break;case t+"_merge_horizontally":this.parent.notify(St,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Horizontally",isAction:!0});break;case t+"_merge_vertically":this.parent.notify(St,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Vertically",isAction:!0})}this.parent.hideSpinner()},n.prototype.getSortFilterDDB=function(e){var r,n=this,i=this.parent.serviceLocator.getService(Dl);return this.sortingDdb=new Dh.DropDownButton({cssClass:"e-sort-filter-ddb",iconCss:"e-icons e-sort-filter-icon",items:[{text:i.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc"},{text:i.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc"},{text:i.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom"},{separator:!0},{text:i.getConstant("Filter"),iconCss:"e-icons e-filter-apply",id:e+"_applyfilter"},{text:i.getConstant("ClearAllFilter"),iconCss:"e-icons e-filter-clear",id:e+"_clearfilter"},{text:i.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:e+"_reapplyfilter"}],createPopupOnClick:!0,beforeItemRender:function(t){var r={isFiltered:!1,isClearAll:!0};n.parent.notify(La,r),n.parent.allowSorting||t.item.text!==i.getConstant("SortAscending")&&t.item.text!==i.getConstant("SortDescending")&&t.item.text!==i.getConstant("CustomSort")+"..."||t.element.classList.add("e-disabled"),n.parent.allowFiltering||t.item.text!==i.getConstant("Filter")||t.element.classList.add("e-disabled"),t.item.id!==e+"_clearfilter"&&t.item.id!==e+"_reapplyfilter"||(r.isFiltered?t.element.classList.remove("e-disabled"):t.element.classList.add("e-disabled"))},beforeOpen:function(e){n.refreshSelected(n.sortingDdb,e.element,"iconCss"),e.element.setAttribute("aria-label",n.parent.serviceLocator.getService(Dl).getConstant("SortAndFilter"))},select:function(e){var a=[];if(e.item.text===i.getConstant("SortAscending")||e.item.text===i.getConstant("SortDescending")||e.item.text===i.getConstant("CustomSort")+"..."){var o=t(n.parent.getActiveSheet().selectedRange),s=zr(o[0],o[1],n.parent.getActiveSheet());if(Qr(n.parent,s))return void n.parent.notify(to,null)}switch(e.item.text){case i.getConstant("Filter"):n.parent.notify(Aa,{});break;case i.getConstant("ClearAllFilter"):n.parent.notify(Da,{isAction:!0});break;case i.getConstant("ReapplyFilter"):n.parent.notify(Fa,null);break;case i.getConstant("CustomSort")+"...":n.parent.notify(na,null);break;default:if(r=e.item.text===i.getConstant("SortAscending")?"Ascending":"Descending",n.parent.sortCollection)for(var l=n.parent.sortCollection.length-1;l>=0;l--)n.parent.sortCollection[l]&&n.parent.sortCollection[l].sheetIndex===n.parent.activeSheetIndex&&(a.push(n.parent.sortCollection[l]),n.parent.sortCollection.splice(l,1));n.parent.notify(Cr,{sortOptions:{sortDescriptors:{order:r}}}),n.parent.notify(ia,{sortOptions:{sortDescriptors:{order:r}},previousSort:a})}n.sortingDdb.element.setAttribute("aria-label",e.item.text)}}),this.sortingDdb.createElement=this.parent.createElement,this.sortingDdb.appendTo(this.parent.createElement("button",{id:e+"_sorting",attrs:{type:"button"},className:"e-ss-ddb"})),this.sortingDdb.element},n.prototype.getFindBtn=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_findbtn",attrs:{type:"button","aria-label":this.parent.serviceLocator.getService(Dl).getConstant("FindReplaceTooltip")}});return this.findDdb=new Eh.Button({cssClass:"e-spreadsheet-find-ddb e-flat",iconCss:"e-icons e-search-icon"}),this.findDdb.createElement=this.parent.createElement,this.findDdb.appendTo(r),r.onclick=function(e){t.parent.notify(Z,{event:e})},this.findDdb.element},n.prototype.getClearDDB=function(e){var r=this,n=this.parent.serviceLocator.getService(Dl);return this.clearDdb=new Dh.DropDownButton({cssClass:"e-clear-ddb",iconCss:"e-icons e-clear-icon",items:[{text:n.getConstant("ClearAll"),id:e+"_Clear All"},{text:n.getConstant("ClearFormats"),id:e+"_Clear Formats"},{text:n.getConstant("ClearContents"),id:e+"_Clear Contents"},{text:n.getConstant("ClearHyperlinks"),id:e+"_Clear Hyperlinks"}],createPopupOnClick:!0,beforeOpen:function(e){e.element.setAttribute("aria-label",r.parent.serviceLocator.getService(Dl).getConstant("Clear"))},beforeItemRender:function(n){var i=r.parent.getActiveSheet(),a=c(t(i.selectedRange));i.isProtected&&i.protectSettings.formatCells&&n.item.id!==e+"_Clear Formats"&&(n.item.id===e+"_Clear Hyperlinks"||Bd(r.parent,a))&&(n.element.classList.add("e-disabled"),n.element.setAttribute("aria-disabled","true"))},select:function(t){r.parent.notify(go,{options:{type:t.item.id.replace(e+"_","")},isAction:!0}),r.clearDdb.element.setAttribute("aria-label",t.item.text)}}),this.clearDdb.createElement=this.parent.createElement,this.clearDdb.appendTo(this.parent.createElement("button",{id:e+"_clear",attrs:{type:"button"},className:"e-ss-ddb"})),this.clearDdb.element},n.prototype.ribbonCreated=function(){var t=this.parent.serviceLocator.getService(Dl).getConstant("CollapseToolbar");(0,e.attributes)(this.ribbon.element.querySelector(".e-drop-icon"),{role:"button",tabindex:"-1",title:t,"aria-label":t}),this.ribbon.toolbarObj&&(this.ribbon.toolbarObj.allowKeyboard=this.parent.enableKeyboardNavigation,this.ribbon.toolbarObj.dataBind())},n.prototype.alignItemRender=function(e){e.element.title=this.parent.serviceLocator.getService(Dl).getConstant("Align"+this.getAlignText(e))},n.prototype.getAlignText=function(e){var t=e.item.iconCss.split(" e-")[1].split("-icon")[0];return t[0].toUpperCase()+t.slice(1,t.length)},n.prototype.toggleBtnClicked=function(t){var n,i,a,o,s,l=(0,e.closest)(t.target,".e-btn"),d=this.parent.element.id,h=l.id,p=ae;switch(h){case d+"_bold":i={fontWeight:"normal"},a={fontWeight:"bold"},s="fontWeight";break;case d+"_italic":i={fontStyle:"normal"},a={fontStyle:"italic"},s="fontStyle";break;case d+"_line-through":p=se,a=i={textDecoration:"line-through"},s="textDecoration";break;case d+"_underline":p=se,a=i={textDecoration:"underline"},s="textDecoration"}l.classList.contains("e-active")?(n=a[""+s],o={style:a,onActionUpdate:!0},this.parent.notify(p,o),o.cancel&&l.classList.remove("e-active")):(n=i[""+s],o={style:i,onActionUpdate:!0},this.parent.notify(p,o),o.cancel&&l.classList.add("e-active")),o.cancel||n===o.style[""+s]||this.refreshToggleBtn(r(this.parent.getActiveSheet().activeCell))},n.prototype.getCellStyleValue=function(e,t){var r=zn(t[0],t[1],this.parent.getActiveSheet()),n=this.parent.cellStyle[""+e];return r&&r.style&&r.style[""+e]&&(n=r.style[""+e]),n},n.prototype.refreshSelected=function(e,t,r,n){void 0===n&&(n=r);for(var i=0;i<e.items.length;i++)if(e.items[i][""+n]===e[""+r]){t.children[i].classList.add("e-selected");break}},n.prototype.expandCollapseHandler=function(e){var t=this.ribbon.element.querySelector(".e-drop-icon"),r=this.parent.serviceLocator.getService(Dl);e.expanded?(t.title=r.getConstant("CollapseToolbar"),t.setAttribute("aria-label",r.getConstant("ExpandToolbar"))):(t.title=r.getConstant("ExpandToolbar"),t.setAttribute("aria-label",r.getConstant("CollapseToolbar"))),this.parent.setPanelSize()},n.prototype.getChartThemeDdbItems=function(e){var t=this.parent.serviceLocator.getService(Dl),r=[];return["Material","Fabric","Bootstrap","HighContrastLight","MaterialDark","FabricDark","HighContrast","BootstrapDark","Bootstrap4","Bootstrap5Dark","Bootstrap5","TailwindDark","Tailwind","Tailwind3","Tailwind3Dark","FluentDark","Fluent","Fluent2","Fluent2Dark","Material3","Material3Dark"].forEach((function(n){r.push({id:n,text:t.getConstant(n),iconCss:n===e?"e-icons e-selected-icon":""})})),r},n.prototype.getNumFormatDdbItems=function(e){var t=this.parent.serviceLocator.getService(Dl);return[{id:e+"_General",text:t.getConstant("General")},{id:e+"_Number",text:t.getConstant("Number")},{id:e+"_Currency",text:t.getConstant("Currency")},{id:e+"_Accounting",text:t.getConstant("Accounting")},{id:e+"_ShortDate",text:t.getConstant("ShortDate")},{id:e+"_LongDate",text:t.getConstant("LongDate")},{id:e+"_Time",text:t.getConstant("Time")},{id:e+"_Percentage",text:t.getConstant("Percentage")},{id:e+"_Fraction",text:t.getConstant("Fraction")},{id:e+"_Scientific",text:t.getConstant("Scientific")},{id:e+"_Text",text:t.getConstant("Text")},{id:e+"_Custom",text:t.getConstant("Custom")}]},n.prototype.getFontFamilyItems=function(){return[{text:"Arial"},{text:"Arial Black"},{text:"Axettac Demo"},{text:"Batang"},{text:"Book Antiqua"},{text:"Calibri",iconCss:"e-icons e-selected-icon"},{text:"Comic Sans MS"},{text:"Courier"},{text:"Courier New"},{text:"Din Condensed"},{text:"Georgia"},{text:"Helvetica"},{text:"Helvetica New"},{text:"Roboto"},{text:"Tahoma"},{text:"Times New Roman"},{text:"Verdana"}]},n.prototype.applyNumFormat=function(e){var r=this.parent.getActiveSheet(),n={format:e,range:r.selectedRange,cancel:!1,requestType:"NumberFormat"},i={range:r.name+"!"+n.range,format:n.format,requestType:"NumberFormat"},a=Qr(this.parent,c(t(n.range)));return!a&&(this.parent.trigger("beforeCellFormat",n),this.parent.notify(K,{eventArgs:n,action:"format"}),n.cancel)||(this.parent.notify(te,n),this.parent.notify(rr,{type:"mousedown"}),a||this.parent.notify(Pa,{eventArgs:i,action:"format"})),n.format},n.prototype.renderCustomFormatDialog=function(e,t){var n=this,i=this.parent.serviceLocator.getService(Dl),a=this.parent.createElement("div"),o=this.parent.createElement("div",{className:"e-custom-dialog"}),s=this.parent.createElement("button",{className:"e-btn",attrs:{type:"button"}});s.innerText=i.getConstant("Apply");var l=this.parent.createElement("div",{className:"e-custom-sample"});l.innerText=i.getConstant("CustomFormatTypeList")+":";var d=this.parent.createElement("div",{className:"e-input-button"}),h=this.parent.createElement("input",{className:"e-input e-dialog-input",attrs:{type:"text",name:"input",spellcheck:"false",placeholder:i.getConstant("CustomFormatPlaceholder")}}),p=this.parent.createElement("div",{className:"e-custom-listview"}),c=this.parent.serviceLocator.getService(Ll),u=new Ah.ListView({dataSource:t,select:function(e){h.value=e.item.textContent,e.event&&"keydown"===e.event.type&&e.item&&e.item.focus()}});if(d.appendChild(h),d.appendChild(s),o.appendChild(d),o.appendChild(l),o.appendChild(p),u.appendTo(p),t[4]!==e[4])for(var f=u.element.getElementsByClassName("e-list-text"),g=0,m=f.length;g<m;g++)f[g].textContent!==t[g]&&(f[g].textContent=t[g]);s.addEventListener("click",(function(){var r,a=h.value,o=t.indexOf(a);r=o>-1?e[o]:js(n.parent,a),(r=n.applyNumFormat(r))&&(n.refreshNumFormatSelection(zs(r,!0),n.parent.getActiveSheet(),i,r),n.parent.notify(gr,{action:"addToCustomFormats",format:a,defaultFormat:r})),c.hide(),n.parent.showAggregate&&n.parent.notify(po,{})}));h.addEventListener("input",(function(){u.getSelectedItems()&&u.unselectItem()})),c.show({header:i.getConstant("CustomFormat"),cssClass:"e-custom-format-dlg",height:this.parent.cssClass.indexOf("e-bigger")>-1?502:480,width:440,isModal:!0,showCloseIcon:!0,content:o,footerTemplate:a,beforeOpen:function(t){var i={dialogName:"CustomNumberFormatDlg",element:t.element,target:t.target,cancel:t.cancel};if(n.parent.trigger("dialogBeforeOpen",i),i.cancel)t.cancel=!0;else{var a=n.parent.getActiveSheet(),o=r(a.activeCell),s=zn(o[0],o[1],a);if(s&&s.format){var l=e.indexOf(s.format);u.selectItem(u.element.getElementsByClassName("e-list-item")[l])}Md(n.parent.element)}}})},n.prototype.tBarDdbBeforeOpen=function(e,t,r,n){void 0===n&&(n=0);var i=this.parent.viewport.height,a=parseInt(getComputedStyle(e.firstElementChild).height,10)*(t.length-n)+2*parseInt(getComputedStyle(e).paddingTop,10);if(n){var o=getComputedStyle(e.querySelector(".e-separator"));a+=n*(parseInt(o.borderBottomWidth,10)+2*parseInt(o.marginTop,10))}a>i?(e.style.height=i+"px",e.style.overflowY="auto"):e.style.height&&(e.style.height="",e.style.overflowY=""),e.setAttribute("aria-label",r)},n.prototype.numDDBOpen=function(e){this.numPopupWidth=0;for(var t=e.element.querySelectorAll("span.e-numformat-preview-text"),r=0,n=t.length;r<n;r++)this.numPopupWidth<t[r].offsetWidth&&(this.numPopupWidth=t[r].offsetWidth);var i=this.numPopupWidth+160;document.querySelector(".e-numformat-ddb.e-dropdown-popup").style.width=i+"px"},n.prototype.previewNumFormat=function(t){if(!t.item.id.includes("_Custom")){var n=this.parent.createElement("div",{className:"e-numformat-text",styles:"width:100%",innerHTML:t.element.innerHTML});t.element.innerHTML="";var i=this.parent.getActiveSheet(),a=r(i.activeCell),o=zn(a[0],a[1],i,!1,!0);if(!(0,e.isNullOrUndefined)(o.value)||""!==o.value){var s=Vs(t.item.id.split(this.parent.element.id+"_")[1]),l={type:t.item.text,formattedText:"",value:o.value,format:s,cell:{value:o.value,format:s},skipFormatCheck:Kr(this.parent)};this.parent.notify(re,l);var d=this.parent.createElement("span",{className:"e-numformat-preview-text",styles:"float:right;"});d.innerText=l.formattedText,n.appendChild(d)}t.element.appendChild(n)}},n.prototype.refreshRibbonContent=function(t){if(this.ribbon){(0,e.isNullOrUndefined)(t)&&(t=this.ribbon.selectedTab);var n=this.parent.serviceLocator.getService(Dl),i=this.parent.getActiveSheet(),a=r(i.activeCell);switch(this.ribbon.items[t].header.text){case n.getConstant("Home"):this.refreshHomeTabContent(a);break;case n.getConstant("Insert"):i.isProtected&&(i.protectSettings.insertLink&&!Tr(zn(a[0],a[1],i),Il(i,a[1]))?this.enableToolbarItems([{tab:n.getConstant("Insert"),items:[this.parent.element.id+"_hyperlink"],enable:!0}]):this.enableToolbarItems([{tab:n.getConstant("Insert"),items:[this.parent.element.id+"_hyperlink"],enable:!1}]));break;case n.getConstant("Formulas"):i.isProtected&&(Tr(zn(a[0],a[1],i),Il(i,a[1]))?this.enableToolbarItems([{tab:n.getConstant("Formulas"),items:[this.parent.element.id+"_insert_function"],enable:!1}]):this.enableToolbarItems([{tab:n.getConstant("Formulas"),items:[this.parent.element.id+"_insert_function"],enable:!0}]));break;case n.getConstant("Data"):this.refreshDataTabContent(t);break;case n.getConstant("View"):this.refreshViewTabContent(t)}}},n.prototype.refreshHomeTabContent=function(n){(0,e.isNullOrUndefined)(document.getElementById(this.parent.element.id+"_number_format"))||(this.numFormatDDB=(0,e.getComponent)(document.getElementById(this.parent.element.id+"_number_format"),Dh.DropDownButton));var i=this.parent.getActiveSheet(),a=r(i.activeCell),o=this.parent.serviceLocator.getService(Dl),s=zn(a[0],a[1],i,!1,!0),l=zs(s.format||"General",!0);if(this.refreshNumFormatSelection(l,i,o,s.format),i.isProtected&&this.parent.enableClipboard&&this.parent.clipboardModule.copiedInfo&&this.parent.notify(Oi,[{items:[this.parent.element.id+"_paste"],enable:!Tr(s,Il(i,a[1]))}]),this.fontNameDdb&&(i.isProtected&&!i.protectSettings.formatCells?this.refreshFontNameSelection("Calibri"):this.refreshFontNameSelection(this.getCellStyleValue("fontFamily",n))),this.fontSizeDdb){var d=this.getCellStyleValue("fontSize",n);i.isProtected&&!i.protectSettings.formatCells?this.fontSizeDdb.content="11":(d=d.includes("pt")?d.split("pt")[0]:"11")!==this.fontSizeDdb.content&&(this.fontSizeDdb.content=d,this.fontSizeDdb.dataBind())}if(this.refreshTextAlign(i,s,l,n),this.verticalAlignDdb){d="e-icons e-"+this.getCellStyleValue("verticalAlign",n).toLowerCase()+"-icon";i.isProtected&&!i.protectSettings.formatCells?this.verticalAlignDdb.iconCss="e-icons e-bottom-icon":d!==this.verticalAlignDdb.iconCss&&(this.verticalAlignDdb.iconCss=d,this.verticalAlignDdb.dataBind())}if(this.refreshToggleBtn(n),!i.isProtected&&(s.rowSpan>1||s.colSpan>1))this.enableToolbarItems([{tab:o.getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!0}]),this.toggleActiveState(!0);else{var h=t(i.selectedRange);this.enableToolbarItems([{tab:o.getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:h[0]!==h[2]||h[1]!==h[3]}]),this.toggleActiveState(!1)}},n.prototype.refreshTextAlign=function(e,t,r,n){if(this.textAlignDdb){var i=this.getCellStyleValue("textAlign",n);if(e.isProtected&&!e.protectSettings.formatCells)this.textAlignDdb.iconCss="e-icons e-left-icon";else{void 0!==t.value&&"left"===i&&("Accounting"===r||dn(t.value)&&"Text"!==r)&&(i="right");var a="e-icons e-"+i.toLowerCase()+"-icon";a!==this.textAlignDdb.iconCss&&(this.textAlignDdb.iconCss=a,this.textAlignDdb.dataBind())}}},n.prototype.toggleActiveState=function(e){var t=this.parent.serviceLocator.getService(Dl);this.parent.getActiveSheet().isProtected||(e?this.mergeSplitBtn.element.classList.contains("e-active")||(this.mergeSplitBtn.element.classList.add("e-active"),this.mergeSplitBtn.element.title=t.getConstant("UnmergeCells")):this.mergeSplitBtn.element.classList.contains("e-active")&&(this.mergeSplitBtn.element.classList.remove("e-active"),this.mergeSplitBtn.element.title=t.getConstant("MergeCells")))},n.prototype.refreshToggleBtn=function(e){var t,r,n,i=this,a=this.parent.getActiveSheet(),o=this.parent.element.id,s=zn(e[0],e[1],a),l=["fontWeight","fontStyle","textDecoration","textDecoration"];["bold","italic","line-through","underline","wrap"].forEach((function(d,h){(t=document.getElementById(o+"_"+d))&&(n=!1,a.isProtected&&!a.protectSettings.formatCells||("wrap"===d?n=i.parent.allowWrap&&s&&s.wrap:i.parent.allowCellFormatting&&(r=i.getCellStyleValue(l[h],e).toLowerCase(),n=r.indexOf(d)>-1)),n?t.classList.add("e-active"):t.classList.contains("e-active")&&t.classList.remove("e-active"))}))},n.prototype.refreshFontNameSelection=function(e){e=e.split('"').join(""),this.fontNameDdb.element.firstElementChild.textContent=e;for(var t=0;t<this.fontNameDdb.items.length;t++)if(this.fontNameDdb.items[t].text===e){this.fontNameDdb.items[t].iconCss="e-icons e-selected-icon",t!==this.fontNameIndex&&(this.fontNameDdb.items[this.fontNameIndex].iconCss=""),this.fontNameDdb.setProperties({items:this.fontNameDdb.items},!0),this.fontNameIndex=t;break}["Arial","Arial Black","Axettac Demo","Batang","Book Antiqua","Calibri","Comic Sans MS","Courier","Courier New","Din Condensed","Georgia","Helvetica","Helvetica New","Roboto","Tahoma","Times New Roman","Verdana"].indexOf(e)<0&&(this.fontNameDdb.items[this.fontNameIndex].iconCss=""),this.fontNameDdb.element.setAttribute("aria-label",e)},n.prototype.refreshNumFormatSelection=function(e,t,r,n){if(this.numFormatDDB){t.isProtected&&!t.protectSettings.formatCells?e="General":(n&&"General"===e&&"General"!==n&&(e="Custom"),e=r.getConstant(e));for(var i=0;i<this.numFormatDDB.items.length;i++)""!==this.numFormatDDB.items[i].iconCss&&(this.numFormatDDB.items[i].iconCss=""),this.numFormatDDB.items[i].text===e&&(this.numFormatDDB.items[i].iconCss="e-icons e-selected-icon");this.numFormatDDB.element.firstElementChild.textContent=e,this.numFormatDDB.setProperties({items:this.numFormatDDB.items},!0),this.numFormatDDB.element.setAttribute("aria-label",e)}},n.prototype.fileMenuItemSelect=function(t){var r=this,n=(0,e.extend)({cancel:!1},t);this.parent.trigger("fileMenuItemSelect",n);var i,a=this.parent.element.id;if(!n.cancel)switch(t.item.id){case a+"_Print":this.parent.print();break;case a+"_Open":(0,e.select)("#"+a+"_fileUpload",this.parent.element).click(),Md(this.parent.element);break;case a+"_Xlsx":case a+"_Xls":case a+"_Csv":case a+"_Pdf":this.parent.notify(J,t);break;case a+"_New":(i=this.parent.serviceLocator.getService(Ll)).show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(Dl).getConstant("DestroyAlert"),beforeOpen:function(e){var t={dialogName:"DestroySheetDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel?e.cancel=!0:Md(r.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(Dl).getConstant("Ok"),isPrimary:!0},click:function(){i.hide(),r.parent.refresh(!0)}}]})}},n.prototype.toolbarClicked=function(e){if(e.item&&"spreadsheet_find"!==e.item.id){var t=this.parent.element.id,n=this.parent.getActiveSheet(),i=void 0,a=void 0,o=void 0,s=void 0;switch(e.item.id){case t+"_headers":if(i={isShow:!n.showHeaders,sheetIdx:this.parent.activeSheetIndex,cancel:!1},this.parent.notify(Pa,{eventArgs:i,action:"headers"}),i.cancel)return;this.parent.setSheetPropertyOnMute(n,"showHeaders",!n.showHeaders),this.parent.serviceLocator.getService("sheet").showHideHeaders(),this.toggleRibbonItems({props:"Headers",activeTab:this.ribbon.selectedTab});break;case t+"_gridlines":if(a={isShow:!n.showGridLines,sheetIdx:this.parent.activeSheetIndex,cancel:!1},this.parent.notify(Pa,{eventArgs:a,action:"gridLines"}),a.cancel)return;this.parent.setSheetPropertyOnMute(n,"showGridLines",!n.showGridLines),this.toggleRibbonItems({props:"GridLines",activeTab:this.ribbon.selectedTab});break;case t+"_protect":this.parent.notify(cs,{});break;case t+"_undo":this.parent.notify(wa,{isUndo:!0});break;case t+"_redo":this.parent.notify(wa,{isUndo:!1});break;case t+"_freezepanes":o=r(n.topLeftCell),s=n.frozenRows||n.frozenColumns?o:r(n.activeCell),this.parent.notify($o,{row:s[0]-o[0],column:s[1]-o[1],triggerEvent:!0});break;case t+"_freezerows":this.parent.notify($o,{row:n.frozenRows?0:r(n.activeCell)[0]-r(n.topLeftCell)[0],column:n.frozenColumns,triggerEvent:!0});break;case t+"_freezecolumns":this.parent.notify($o,{row:n.frozenRows,column:n.frozenColumns?0:r(n.activeCell)[1]-r(n.topLeftCell)[1],triggerEvent:!0});break;case t+"_protectworkbook":this.parent.password.length>0?this.parent.notify(Wo,null):this.parent.isProtected?(this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab}),this.parent.notify(Pa,{action:"protectWorkbook",eventArgs:{isProtected:!1}})):this.parent.element.querySelector(".e-add-sheet-tab").classList.contains("e-disabled")?this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab}):this.parent.notify(qo,null)}this.parent.notify(Ai,e)}},n.prototype.toggleRibbonItems=function(t){var r="",n=this.parent.serviceLocator.getService(Dl).getConstant("View"),i=this.parent.serviceLocator.getService(Dl).getConstant("Data");if(this.ribbon.items[this.ribbon.selectedTab].header.text===n){if((0,e.isNullOrUndefined)(t.activeTab))for(var a=0,o=this.ribbon.items.length;a<o;a++)if(this.ribbon.items[a].header.text===n){t.activeTab=a;break}var s=this.getLocaleText(t.props);"GridLines"===t.props&&this.parent.serviceLocator.getService("sheet").toggleGridlines();var l=this.parent.element.id+"_"+t.props.toLowerCase(),d=this.ribbon.items[t.activeTab].content.length;for(a=void 0;a<d;a++)"Separator"!==this.ribbon.items[t.activeTab].content[a].type&&this.ribbon.items[t.activeTab].content[a].id===l&&(this.ribbon.items[t.activeTab].content[a].text=s,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===n&&"Protect"!==t.props&&this.updateToggleText(t.props.toLowerCase(),s)}if(this.ribbon.items[this.ribbon.selectedTab].header.text===i){if((0,e.isNullOrUndefined)(t.activeTab)){a=0;for(var h=this.ribbon.items.length;a<h;a++)if(this.ribbon.items[a].header.text===i){t.activeTab=a;break}}if((l=this.parent.element.id+"_"+t.props.toLowerCase())===this.parent.element.id+"_protect"){var p=this.ribbon.items[this.ribbon.selectedTab].content.length,c=void 0;for(c=0;c<p&&this.ribbon.items[this.ribbon.selectedTab].content[c].id!==this.parent.element.id+"_protect";c++);r=this.getLocaleProtectText("Sheet",!0)}else if(l===this.parent.element.id+"_protectworkbook"){var u=this.ribbon.items[this.ribbon.selectedTab].content.length;c=void 0;for(c=0;c<u&&this.ribbon.items[this.ribbon.selectedTab].content[c].id!==this.parent.element.id+"_protectworkbook";c++);this.parent.isProtected||this.parent.password.length>0?r=this.getLocaleProtectWorkbook("UnprotectWorkbook"):this.parent.isProtected||(r=this.getLocaleProtectWorkbook("ProtectWorkbook"))}for(d=this.ribbon.items[t.activeTab].content.length,a=void 0;a<d;a++)"Separator"!==this.ribbon.items[t.activeTab].content[a].type&&this.ribbon.items[t.activeTab].content[a].id===l&&(this.ribbon.items[t.activeTab].content[a].text=r,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===i&&this.updateToggleText(t.props.toLowerCase(),r)}},n.prototype.enableFileMenuItems=function(e){this.ribbon.enableMenuItems(e.items,e.enable,e.isUniqueId)},n.prototype.hideRibbonTabs=function(e){this.ribbon.hideTabs(e.tabs,e.hide)},n.prototype.addRibbonTabs=function(t){this.ribbon.addTabs(t.items,t.insertBefore),(0,e.select)(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab).e-hide",this.parent.element)&&this.parent.updateActiveBorder((0,e.selectAll)(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab)",this.parent.element)[this.ribbon.selectedTab])},n.prototype.updateToggleText=function(t,r){var n=(0,e.select)("#"+this.parent.element.id+"_"+t+" .e-tbar-btn-text",this.ribbon.element);if("protect"===t||"protectworkbook"===t?n.parentElement.setAttribute("aria-label",r):n.parentElement.setAttribute("aria-label",n.textContent),zl((function(){n&&(n.textContent=r)})),"headers"===t){var i=this.parent.element.getElementsByClassName("e-findtool-dlg")[0];i&&i.classList.contains("e-popup-open")&&this.parent.notify(Z,{refreshPosition:!0,dialogEle:i})}},n.prototype.refreshViewTabContent=function(e){for(var t,r=this.parent.element.id,n=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(Dl),a=0;a<this.ribbon.items[e].content.length;a++)"Separator"!==(t=this.ribbon.items[e].content[a]).type&&(t.id===r+"_headers"&&this.updateViewTabContent(e,"Headers",a),t.id===r+"_gridlines"&&this.updateViewTabContent(e,"GridLines",a),t.id===r+"_freezepanes"&&(n.frozenRows||n.frozenColumns?t.text===i.getConstant("FreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Unfreeze","Panes",a,e)):t.text===i.getConstant("UnfreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Freeze","Panes",a,e))),t.id===r+"_freezerows"&&(n.frozenRows?t.text===i.getConstant("FreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Unfreeze","Rows",a,e)):t.text===i.getConstant("UnfreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Freeze","Rows",a,e))),t.id===r+"_freezecolumns"&&(n.frozenColumns?t.text===i.getConstant("FreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Unfreeze","Columns",a,e)):t.text===i.getConstant("UnfreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Freeze","Columns",a,e))))},n.prototype.updateViewTabContent=function(e,t,r){var n=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(Dl);n["show"+t]?this.ribbon.items[e].content[r].text===i.getConstant("Show"+t)&&this.updateToggleText(t.toLowerCase(),this.updateRibbonItemText("Hide",t,r,e)):this.ribbon.items[e].content[r].text===i.getConstant("Hide"+t)&&this.updateToggleText(t.toLowerCase(),this.updateRibbonItemText("Show",t,r,e))},n.prototype.updateRibbonItemText=function(e,t,r,n){var i=this.parent.serviceLocator.getService(Dl).getConstant(e+t);return this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),i},n.prototype.refreshDataTabContent=function(e){for(var t,r=this.parent.element.id,n=0;n<this.ribbon.items[e].content.length;n++)if("Separator"!==this.ribbon.items[e].content[n].type){if(this.ribbon.items[e].content[n].id===r+"_protect"){if(this.updateDataTabContent(e,"Sheet",n),t)break;t=!0}this.ribbon.items[e].content[n].id===r+"_protectworkbook"&&this.updateDataTabContent(e,"Workbook",n)}},n.prototype.updateDataTabContent=function(e,t,r){var n=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(Dl);if("Sheet"===t)n.isProtected?this.ribbon.items[e].content[r].text===i.getConstant("Protect"+t)&&(this.ribbon.items[e].content[r].cssClass="e-active",this.updateProtectBtn("Unprotect",t,r,e)):this.updateProtectBtn("Protect",t,r,e);else if("Workbook"===t){var a=this.parent.serviceLocator.getService(Dl);this.parent.isProtected?this.ribbon.items[e].content[r].text===a.getConstant("Protect"+t)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("Unprotect",t,r,e)):this.ribbon.items[e].content[r].text===a.getConstant("Unprotect"+t)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("Protect",t,r,e))}},n.prototype.updateProtectBtn=function(e,t,r,n){var i=this.parent.serviceLocator.getService(Dl).getConstant(e+t);this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protect",i)},n.prototype.updateProtectWorkbookBtn=function(e,t,r,n){var i=this.parent.serviceLocator.getService(Dl).getConstant(e);this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protectworkbook",i)},n.prototype.addToolbarItems=function(e){var t=this.parent.serviceLocator.getService(Dl);this.ribbon.addToolbarItems(t.getConstant(e.tab),e.items,e.index),this.parent&&this.parent.isReact&&this.parent.portals&&this.ribbon.toolbarObj&&this.ribbon.toolbarObj.portals&&(this.parent.portals=this.parent.portals.concat(this.ribbon.toolbarObj.portals),this.parent.renderReactTemplates())},n.prototype.enableToolbarItems=function(e){var t=this;e.forEach((function(e){t.ribbon.enableItems(e.tab||t.ribbon.items[t.ribbon.selectedTab].header.text,e.items,e.enable,e.isPublic)}))},n.prototype.createMobileView=function(){var e=this,t=this.parent.element.id,r=this.parent.createElement("div",{className:"e-header-toolbar"}),n=this.parent.createElement("ul");r.appendChild(n);var i=new vh.Toolbar({items:[{prefixIcon:"e-tick-icon",align:"Left",id:t+"focused_tick",cssClass:"e-focused-tick"},{template:n,align:"Right",id:t+"file_menu"}],clicked:function(r){if(r.item.id===t+"focused_tick")e.parent.element.classList.remove("e-mobile-focused"),e.parent.renderModule.setSheetPanelSize()},created:function(){var t=new vh.Menu({cssClass:"e-mobile e-file-menu",enableRtl:!0,showItemOnClick:!0,items:e.getRibbonMenuItems(),select:e.fileMenuItemSelect.bind(e),beforeOpen:function(t){t.element.parentElement.classList.remove("e-rtl"),e.fileMenuBeforeOpen(t)},beforeClose:e.fileMenuBeforeClose.bind(e)});t.createElement=e.parent.createElement,t.appendTo(n)}});i.createElement=this.parent.createElement,i.appendTo(r),this.parent.element.insertBefore(r,this.parent.element.firstElementChild),this.renderMobileToolbar()},n.prototype.renderMobileToolbar=function(){var e=this,t=this.parent.createElement("div",{className:"e-toolbar-panel e-ribbon"}),r=this.parent.createElement("div"),n=this.parent.createElement("button",{attrs:{type:"button"}});t.appendChild(r),t.appendChild(n),t.style.display="block",this.parent.element.appendChild(t);var i=new Dh.DropDownButton({cssClass:"e-caret-hide",content:this.ribbon.items[0].header.text,items:[{text:this.ribbon.items[0].header.text},{text:this.ribbon.items[1].header.text},{text:this.ribbon.items[2].header.text},{text:this.ribbon.items[3].header.text}],createPopupOnClick:!0,select:function(t){t.item.text!==i.content&&(a.element.style.display="none",i.content=t.item.text,i.dataBind(),a.items=e.ribbon.items[i.items.indexOf(t.item)+1].content,a.width="calc(100% - "+n.getBoundingClientRect().width+"px)",a.element.style.display="",a.dataBind(),a.items[0].text=t.item.text,a.dataBind())},open:function(e){var t=e.element.parentElement,r=t.getBoundingClientRect(),n=(0,fh.calculatePosition)(i.element,"right","bottom");t.style.left=n.left-r.width+"px",t.style.top=n.top-r.height+"px";for(var a=0;a<i.items.length;a++)if(i.content===i.items[a].text){e.element.children[a].classList.add("e-selected");break}},close:function(){return Md(e.parent.element)}});i.createElement=this.parent.createElement,i.appendTo(n);var a=new vh.Toolbar({width:"calc(100% - "+n.getBoundingClientRect().width+"px)",items:this.ribbon.items[0].content,clicked:this.toolbarClicked.bind(this)});a.createElement=this.parent.createElement,a.appendTo(r),t.style.display=""},n.prototype.fileMenuBeforeOpen=function(e){var t,r=this,n=this.parent.serviceLocator.getService(Dl),i=[".xlsx",".xls",".csv",".pdf"];e.parentItem.text===n.getConstant("SaveAs")&&[].slice.call(e.element.children).forEach((function(e,n){t=r.parent.createElement("div",{innerHTML:e.innerHTML}),e.innerHTML="";var a=r.parent.createElement("span",{className:"e-extension"});a.innerText=i[n],t.appendChild(a),e.appendChild(t)})),this.parent.trigger("fileMenuBeforeOpen",e),e.element.setAttribute("aria-label",n.getConstant("File"))},n.prototype.enableRibbonTabs=function(e){this.ribbon.enableTabs(e.tabs,e.enable)},n.prototype.fileMenuBeforeClose=function(e){var t=this;this.parent.trigger("fileMenuBeforeClose",e),e.parentItem&&e.event&&37===e.event.keyCode&&e.parentItem.id===this.parent.element.id+"_File"&&zl((function(){var e=t.ribbon.element.querySelector(".e-tab-header .e-toolbar-item .e-tab-wrap");if(e){Md(e);var r=e.querySelector(".e-menu-item.e-focused");r&&r.classList.remove("e-focused")}}))},n.prototype.hideFileMenuItems=function(e){this.ribbon.hideMenuItems(e.items,e.hide,e.isUniqueId)},n.prototype.addFileMenuItems=function(e){this.ribbon.addMenuItems(e.items,e.text,e.insertAfter,e.isUniqueId)},n.prototype.hideToolbarItems=function(e){this.ribbon.hideToolbarItems(e.tab,e.indexes,e.hide)},n.prototype.protectSheetHandler=function(e){var t=this.parent.getActiveSheet(),r=this.parent.serviceLocator.getService(Dl);t.isProtected&&t.protectSettings.formatCells||!t.isProtected?(this.parent.allowCellFormatting?(this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId,enable:!0}]),t.isProtected&&t.protectSettings.formatCells&&this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(15,16),enable:!1}])):this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(3,14),enable:!1}]),this.parent.allowWrap||this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(14,15),enable:!1}]),this.parent.allowNumberFormatting||this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(2,3),enable:!1}]),this.parent.notify(no,null)):this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.disableHomeBtnId,enable:!1}]),t.isProtected&&t.protectSettings.insertLink||!t.isProtected?!this.parent.allowHyperlink||t.isProtected&&t.protectSettings.insertLink?this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId.slice(0,1),enable:!1}]):this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId,enable:!0}]):this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.findBtnId,enable:!t.isProtected||t.protectSettings.selectCells||t.protectSettings.selectUnLockedCells}]);var n,i=this.ribbon.items[this.ribbon.selectedTab].content.length;for(n=0;n<i&&this.ribbon.items[this.ribbon.selectedTab].content[n].id!==this.parent.element.id+"_protectworkbook";n++);t.isProtected?(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===r.getConstant("UnprotectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("UnprotectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.imageBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Data"),items:e.dataValidationBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.chartBtnId,enable:!1}])):(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===r.getConstant("UnprotectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("UnprotectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.imageBtnId,enable:this.parent.allowImage}]),this.enableToolbarItems([{tab:r.getConstant("Data"),items:e.dataValidationBtnId,enable:this.parent.allowDataValidation}]),this.enableToolbarItems([{tab:r.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!0}]),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.chartBtnId,enable:this.parent.allowChart}]))},n.prototype.updateMergeItem=function(e){if(this.parent.allowMerge&&(ld(e)||"touchmove"===e.type||e.shiftKey&&("mousedown"===e.type||"touchend"===e.type))){var r=this.parent.getActiveSheet();if(!r.isProtected){var n=t(r.selectedRange);if(n[1]===n[3]&&n[0]===n[2])this.enableToolbarItems([{tab:this.parent.serviceLocator.getService(Dl).getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!1}]),this.toggleActiveState(!1);else{this.enableToolbarItems([{tab:this.parent.serviceLocator.getService(Dl).getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!0}]);var i=zn((n=c(n))[0],n[1],r,!1,!0);i.rowSpan>1||i.colSpan>1?this.toggleActiveState(!(i.rowSpan>1&&n[0]+i.rowSpan-1!==n[2]||i.colSpan>1&&n[1]+i.colSpan-1!==n[3])):this.toggleActiveState(!1)}}}},n.prototype.onPropertyChanged=function(e){var t=this.parent.serviceLocator.getService(Dl),n=this.parent.element.id,i=this.parent.getActiveSheet();switch(e){case"allowFreezePane":this.ribbon.enableItems(t.getConstant("View"),[n+"_freezepanes",n+"_freezerows",n+"_freezecolumns"],this.parent.allowFreezePane);break;case"showRibbon":this.parent.showRibbon?this.initialize(!0):this.ribbon&&this.destroy();break;case"allowImage":this.ribbon.enableItems(t.getConstant("Insert"),[n+"_image"],this.parent.allowImage);break;case"allowChart":this.ribbon.enableItems(t.getConstant("Insert"),[n+"_chart"],this.parent.allowChart),this.parent.allowChart||this.removeDesignChart();break;case"allowWrap":case"allowCellFormatting":if(this.refreshToggleBtn(r(i.activeCell)),!i.isProtected||i.protectSettings.formatCells)if("allowWrap"===e)this.ribbon.enableItems(t.getConstant("Home"),[n+"_wrap"],this.parent.allowWrap);else{var a=[n+"_font_name",n+"_font_size",n+"_bold",n+"_italic",n+"_line-through",n+"_underline",n+"_font_color_picker",n+"_fill_color_picker",n+"_borders",n+"_merge_cells",n+"_text_align",n+"_vertical_align"];this.enableToolbarItems([{tab:t.getConstant("Home"),items:a,enable:this.parent.allowCellFormatting}])}break;case"allowNumberFormatting":i.isProtected&&!i.protectSettings.formatCells||this.ribbon.enableItems(t.getConstant("Home"),[n+"_number_format"],this.parent.allowNumberFormatting);break;case"calculationMode":this.parent.notify(Oi,[{tab:t.getConstant("Formulas"),items:[this.parent.element.id+"_calc_current_sheet",this.parent.element.id+"_calc_entire_sheets"],enable:"Manual"===this.parent.calculationMode}]),this.calcTypeOptions&&(this.calcTypeOptions.items[0].iconCss="Automatic"===this.parent.calculationMode?"e-icons e-selected-icon":"",this.calcTypeOptions.items[1].iconCss="Manual"===this.parent.calculationMode?"e-icons e-selected-icon":""),"Automatic"===this.parent.calculationMode&&this.parent.calculateNow("Workbook")}},n.prototype.addEventListener=function(){this.parent.on(Qn,this.ribbonOperation,this),this.parent.on(Oi,this.enableToolbarItems,this),this.parent.on(ve,this.refreshRibbonContent,this),this.parent.on(la,this.toggleRibbonItems,this),this.parent.on(_i,this.enableFileMenuItems,this),this.parent.on(Gi,this.hideRibbonTabs,this),this.parent.on(Xi,this.addRibbonTabs,this),this.parent.on(Ki,this.addToolbarItems,this),this.parent.on(qi,this.hideFileMenuItems,this),this.parent.on(Wi,this.addFileMenuItems,this),this.parent.on($i,this.hideToolbarItems,this),this.parent.on(Yi,this.enableRibbonTabs,this),this.parent.on(Xa,this.protectSheetHandler,this),this.parent.on(rr,this.updateMergeItem,this),this.parent.on(Mt,this.refreshRibbonContent,this),this.parent.on(Uo,this.insertDesignChart,this),this.parent.on(Vo,this.removeDesignChart,this),this.parent.on(sr,this.unMerge,this)},n.prototype.destroy=function(){var t,r=this.parent.element,n=this.ribbon?this.ribbon.element:null,i=this.cPickerEle,a=r.id,o=this.parent.serviceLocator.getService(Dl),s=(0,e.getComponent)(r.querySelector(".e-tab"),"tab");s&&(t=s.selectedItem),this.switchRibbonTab(o.getConstant("Home")),["bold","italic","line-through","underline","cut","copy","undo","redo","wrap"].forEach((function(t){yd((0,e.select)("#"+a+"_"+t,r),Eh.Button)})),this.pasteSplitBtn&&this.pasteSplitBtn.destroy(),this.pasteSplitBtn=null,this.mergeSplitBtn&&this.mergeSplitBtn.destroy(),this.mergeSplitBtn=null,this.numFormatDDB&&this.numFormatDDB.destroy(),this.numFormatDDB=null,this.fontSizeDdb&&this.fontSizeDdb.destroy(),this.fontSizeDdb=null,this.fontNameDdb&&this.fontNameDdb.destroy(),this.fontNameDdb=null,this.textAlignDdb&&this.textAlignDdb.destroy(),this.textAlignDdb=null,this.verticalAlignDdb&&this.verticalAlignDdb.destroy(),this.verticalAlignDdb=null,this.sortingDdb&&this.sortingDdb.destroy(),this.sortingDdb=null,this.clearDdb&&this.clearDdb.destroy(),this.clearDdb=null,this.colorPicker&&this.colorPicker.destroy(),this.colorPicker=null,this.destroyComponent(a+"_borders_menu","menu"),this.bordersDdb&&this.bordersDdb.destroy(),this.bordersDdb=null,this.findDdb&&this.findDdb.destroy(),this.findDdb=null,this.destroyComponent(a+"_chart_menu","menu"),this.destroyComponent(a+"_chart_type_menu","menu"),this.destroyComponent(a+"_chart-btn","dropdown-btn"),this.destroyComponent(a+"_chart-type-btn","dropdown-btn"),this.destroyComponent(a+"_cf_menu","menu"),this.cfDdb&&(this.cfDdb.destroy(),this.cfDdb.element&&this.cfDdb.element.remove()),this.cfDdb=null,this.detachPopupElement(a),this.parent.notify("destroyRibbonComponents",null),t&&(s.selectedItem=t,s.dataBind()),this.addChartDdb&&(this.addChartDdb.destroy(),this.addChartDdb=null),this.destroyComponent(a+"_chart_theme","menu"),this.destroyComponent(a+"_chart_theme","dropdown-btn"),this.destroyComponent(a+"_chart-type-btn","menu"),this.destroyComponent(a+"_chart-type-btn","dropdown-btn"),this.datavalidationDdb&&this.datavalidationDdb.destroy(),this.datavalidationDdb=null,i&&(0,e.detach)(i);var l=this.parent.serviceLocator.getService(Ll);l.dialogInstance&&l.dialogInstance.element.classList.contains("e-custom-format-dlg")&&l.hide(!0),this.cPickerEle=null,this.border&&(this.border=""),this.fontNameIndex&&(this.fontNameIndex=null),this.preTabIdx&&(this.preTabIdx=null),this.numPopupWidth&&(this.numPopupWidth=null),this.ribbon&&this.ribbon.destroy(),n&&(0,e.detach)(n),this.ribbon=null,this.removeEventListener(),this.parent=null},n.prototype.destroyComponent=function(t,r){var n="string"==typeof t?document.getElementById(t):t;if(n){if("menu"!==r||n.childElementCount){var i=(0,e.getComponent)(n,r);if(i&&(i.destroy(),"dropdown-btn"===r)){var a=document.getElementById(n.id+"-popup");a&&(0,e.detach)(a)}}"menu"===r&&(0,e.detach)(n)}},n.prototype.detachPopupElement=function(t){["_conditionalformatting","_chart-type-btn","_chart-btn","_borders"].forEach((function(r){var n=document.getElementById(""+t+r+"-popup");n&&(0,e.detach)(n)}))},n.prototype.switchRibbonTab=function(t){for(var r,n=this.parent.element.querySelectorAll(".e-tab-text"),i=0;i<n.length;i++){var a=n[i];if(a.textContent.toLowerCase()===t.toLowerCase()){var o=a.closest(".e-toolbar-item");if(o){r=o.getAttribute("data-id");break}}}var s=(0,e.getComponent)(this.parent.element.querySelector(".e-tab"),"tab");s&&!(0,e.isNullOrUndefined)(r)&&(s.selectedItem=s.getItemIndex(r),s.dataBind())},n.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Qn,this.ribbonOperation),this.parent.off(Oi,this.enableToolbarItems),this.parent.off(ve,this.refreshRibbonContent),this.parent.off(la,this.toggleRibbonItems),this.parent.off(_i,this.enableFileMenuItems),this.parent.off(Gi,this.hideRibbonTabs),this.parent.off(Xi,this.addRibbonTabs),this.parent.off(Ki,this.addToolbarItems),this.parent.off(qi,this.hideFileMenuItems),this.parent.off(Wi,this.addFileMenuItems),this.parent.off($i,this.hideToolbarItems),this.parent.off(Yi,this.enableRibbonTabs),this.parent.off(Xa,this.protectSheetHandler),this.parent.off(rr,this.updateMergeItem),this.parent.off(Mt,this.refreshRibbonContent),this.parent.off(Uo,this.insertDesignChart),this.parent.off(Vo,this.removeDesignChart),this.parent.off(sr,this.unMerge))},n}(),Yh=function(){function n(e){this.categoryCollection=[],this.formulaCollection=[],this.isGoto=!1,this.parent=e,this.addEventListener()}return n.prototype.getModuleName=function(){return"formulaBar"},n.prototype.createFormulaBar=function(t){var r=this;if(this.parent.showFormulaBar||!this.insertFnRipple){var n=this.parent.serviceLocator.getService(Dl),i=this.parent.element.id,a=this.parent.createElement("div",{className:"e-formula-bar-panel"});if(!this.parent.isMobileView()){var o=this.parent.createElement("input",{id:i+"_name_box",attrs:{type:"text"}});a.appendChild(o),this.comboBoxInstance=new Nh.ComboBox({value:"A1",cssClass:"e-name-box",width:"",noRecordsTemplate:(0,e.initializeCSPTemplate)((function(){return""})),fields:{text:"name",value:"refersTo"},beforeOpen:this.nameBoxBeforeOpen.bind(this),blur:this.nameBoxBlur.bind(this),select:this.nameBoxSelect.bind(this),open:function(){r.isDevice&&(window.browserDetails.isDevice=!0)},change:function(){}}),this.comboBoxInstance.createElement=this.parent.createElement,this.comboBoxInstance.appendTo(o),this.comboBoxInstance.element.parentElement.title=n.getConstant("NameBox")}a.appendChild(this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-insert-function",attrs:{title:n.getConstant("InsertFunction"),type:"button"}})).appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons"})),this.insertFnRipple=(0,e.rippleEffect)(a,{selector:".e-insert-function"}),a.appendChild(this.parent.createElement("div",{className:"e-separator"}));var s=n.getConstant("FormulaBar"),l=a.appendChild(this.parent.createElement("textarea",{className:"e-formula-bar e-css",id:i+"_formula_input",attrs:{title:s,"aria-label":s,spellcheck:"false"}}));if(l.rows=1,this.parent.isMobileView())l.placeholder=n.getConstant("MobileFormulaBarPlaceHolder"),e.EventHandler.add(l,"focus",this.textAreaFocusIn,this),e.EventHandler.add(l,"blur",this.textAreaFocusOut,this);else{var d=n.getConstant("ExpandFormulaBar");a.appendChild(this.parent.createElement("span",{className:"e-drop-icon e-icons",attrs:{title:d,role:"button",tabindex:"-1","aria-label":d}}))}t&&t.uiUpdate?this.parent.element.insertBefore(a,document.getElementById(i+"_sheet_panel")):this.parent.element.appendChild(a)}else this.destroy()},n.prototype.textAreaFocusIn=function(){var e=this.parent.element.querySelector(".e-formula-bar-panel"),t=this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-formula-submit",attrs:{type:"button"}});t.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-tick-icon"})),e.classList.add("e-focused"),e.appendChild(t)},n.prototype.textAreaFocusOut=function(){var t=this.parent.element.querySelector(".e-formula-bar-panel");t.classList.remove("e-focused"),(0,e.detach)(t.querySelector(".e-formula-submit"))},n.prototype.keyDownHandler=function(e){var t=e.target;if(this.parent.isEdit&&(!this.parent.getActiveSheet().isProtected||t.classList.contains("e-formula-bar")&&!t.disabled)){if((wr(t.value)||t.validity&&0===t.value.toString().indexOf("="))&&(16===e.keyCode||17===e.keyCode))return;t.classList.contains("e-formula-bar")&&(!e.shiftKey||e.shiftKey&&!hd(e.keyCode))&&this.parent.notify(si,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}},n.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var t=e.target;if(t.classList.contains("e-formula-bar")){var r={action:"getCurrentEditValue",editedValue:""};this.parent.notify(si,r),r.editedValue===t.value||16===e.keyCode||17===e.keyCode||e.shiftKey&&(!e.shiftKey||hd(e.keyCode))||this.parent.notify(si,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}}},n.prototype.nameBoxBeforeOpen=function(e){this.comboBoxInstance.element.classList.contains("e-name-editing")?e.cancel=!0:(this.comboBoxInstance.element.select(),this.isDevice=window.browserDetails.isDevice,this.isDevice&&(window.browserDetails.isDevice=!1))},n.prototype.nameBoxBlur=function(){this.comboBoxInstance.element.classList.contains("e-name-editing")&&(this.comboBoxInstance.element.classList.remove("e-name-editing"),this.updateValueAfterMouseUp())},n.prototype.nameBoxSelect=function(e){if(e.isInteracted&&(!e.e||"keydown"!==e.e.type||40!==e.e.keyCode&&38!==e.e.keyCode)){var t=e.itemData.refersTo.substr(1),r=In(this.parent,Nn(t));if(void 0===r)return;var n=l(t),a=Fn(this.parent,r),o=void 0,s=void 0;if(-1===n.indexOf(":"))o=s=n.replace("$","");else{var d=n.indexOf(":");o=n.substr(0,d).replace("$",""),s=n.substr(d+1,n.length).replace("$","")}s.match(/\D/g)&&!s.match(/[0-9]/g)&&o.match(/\D/g)&&!o.match(/[0-9]/g)?n=(o+="1")+":"+(s+=a.rowCount):!s.match(/\D/g)&&s.match(/[0-9]/g)&&!o.match(/\D/g)&&o.match(/[0-9]/g)&&(n=(o=i(parseInt(o,10)-1,0))+":"+(s=i(parseInt(s,10)-1,a.colCount-1))),r===this.parent.activeSheetIndex?(this.parent.isEdit||this.parent.selectRange(n),this.parent.notify(bo,{range:n,isSelect:!1,isMouseDown:!1,isNameBoxSelect:!0}),Md(this.parent.element)):(An(this.parent,n,a),this.parent.activeSheetIndex=r,this.parent.notify(bo,{range:n,isSelect:!1,isMouseDown:!1,isNameBoxSelect:!0}),Md(this.parent.element))}},n.prototype.formulaBarUpdateHandler=function(e){var r,n=this,i=this.parent.getActiveSheet().selectedRange.split(":"),a={action:"getElement",element:null};this.parent.notify(si,a);var o=this.parent.element.querySelector(".e-formula-bar");if("mousemove"===e.type||"pointermove"===e.type){var s=t(i[0]),l=t(i[1]);r=Math.abs(s[0]-l[0])+1+"R x "+(Math.abs(s[1]-l[1])+1)+"C",this.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?this.parent.notify(Co,{}):a.element&&(o.value=a.element.textContent))}else{r=i[0];var d=Pn(this.parent)+"!"+r;gn(this.parent,d,!1,!0).then((function(t){n.parent&&t.forEach((function(t){var r=n.getFormulaBarValue(t),i={action:"getCurrentEditValue",editedValue:""};n.parent.notify(si,i);var s=document.getElementById(n.parent.element.id+"_formula_input"),l=s.value;s.value=r,i.editedValue&&wr(i.editedValue.toString(),!0)||n.parent.notify(si,{action:"refreshEditor",value:r,refreshEditorElem:!0}),n.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?n.parent.notify(Co,{isMouseDown:sd(e),formulaBarVal:l}):a.element&&(o.value=a.element.textContent))}))}))}this.updateComboBoxValue(r)},n.prototype.getFormulaBarValue=function(t){var r="";if(t)if(t.formula)r=t.formula;else if((0,e.isNullOrUndefined)(t.value)||""===t.value)t.hyperlink&&(r="string"==typeof t.hyperlink?t.hyperlink:t.hyperlink.address||"");else{var n={},i=t.format&&Yn(t.format,!0,n,!0)&&n.type;if("date"===i||"time"===i||"datetime"===i){var a=on(Number(t.value));if(a&&"Invalid Date"!==a.toString()&&a.getFullYear()>=1900){var o=new e.Internationalization,s=Vs("Time");"h:mm:ss AM/PM"===s&&(s="h:mm:ss a");var l=t.format.toLowerCase();"time"!==i||!l.includes("m")||l.includes(":m")||l.includes("m:")||l.includes("[m")||l.includes("am")||(i="date");var d=t.value.toString().split("."),h=2===d.length,p=h?on(parseFloat(d[0]+1+"."+d[1])||Number(t.value)):a;if("date"===i){var c={type:"date",skeleton:"yMd"};r=o.formatDate(a,c),h&&(r+=" "+o.formatDate(p,{type:"time",skeleton:"medium",format:s}))}else(Number(t.value)>=1||"datetime"===i)&&(r=o.formatDate(a,{type:"date",skeleton:"yMd"})+" "),r+=o.formatDate(p,{type:"time",skeleton:"medium",format:s})}}else t.format&&t.format.includes("%")&&dn(t.value)&&((r=this.parent.getDisplayText(t)).includes("%")||(r=""));if(!r)if("true"===(r=t.value.toString()).toLowerCase()||"false"===r.toLowerCase())r=r.toUpperCase();else if("en-US"!==this.parent.locale){var u=(0,e.getNumericObject)(this.parent.locale).decimal;"."!==u&&dn(r)&&r.includes(".")&&(r=r.replace(".",u))}}return r},n.prototype.updateValueAfterMouseUp=function(){this.updateComboBoxValue(this.parent.getActiveSheet().selectedRange.split(":")[0])},n.prototype.updateComboBoxValue=function(e){var t=this.parent.getActiveSheet(),r={action:"getNameFromRange",range:Pn(this.parent)+"!"+t.selectedRange,definedName:null};if(this.parent.notify(li,r),r.definedName&&(e=r.definedName.name),!this.parent.isMobileView()){if(this.comboBoxInstance.text===e)return;this.comboBoxInstance.text=e,this.comboBoxInstance.dataBind()}},n.prototype.disabletextarea=function(){var e=this.getFormulaBar();this.parent.getActiveSheet().isProtected&&!this.parent.isEdit?e.disabled=!0:e.disabled=!1},n.prototype.updateNameBoxValue=function(t,r){var n=this.parent.element.id,i=(0,e.getComponent)(this.parent.element.querySelector("#"+n+"_name_box"),"combobox"),a=this.parent.getActiveSheet();if(r)i.text===t.name&&(i.value=a.activeCell,i.dataBind());else{var o=t.refersTo.split("!");if(2===o.length&&t.refersTo.startsWith("=")){var s=o[0].split("=")[1].replace(/'/g,""),l=t.refersTo.split("!")[1];s===a.name&&l===a.selectedRange&&(i.value=t.name,i.dataBind())}}},n.prototype.formulaBarScrollEdit=function(){var e=t(this.parent.getActiveSheet().selectedRange),n=r(this.parent.getActiveSheet().topLeftCell);e[0]<n[0]&&(this.parent.goTo(this.parent.getActiveSheet().selectedRange),this.isGoto=!0),this.parent.notify(si,{action:"startEdit",refreshCurPos:!1})},n.prototype.formulaBarClickHandler=function(t){var n=t.target,i=this.parent.getActiveSheet(),a=i.isProtected,o=r(i.activeCell),s=zn(o[0],o[1],i),l=Tr(s,Il(i,o[1]));if(n.classList.contains("e-drop-icon")&&n.parentElement.classList.contains("e-formula-bar-panel"))this.toggleFormulaBar(n);else if(n.classList.contains("e-formula-bar")){if(Jr(s,Il(i,o[1]),fl(i,o[0])))return void this.parent.notify(to,null);!this.parent.isEdit&&(!a||a&&!l)||this.parent.isEdit&&a&&!n.disabled?this.formulaBarScrollEdit():a&&l&&this.parent.notify(eo,null)}else if(n.parentElement&&n.parentElement.classList.contains("e-name-box"))if(n.classList.contains("e-ddl-icon")){var d={action:"getNames",names:[]};if(this.parent.notify(li,d),this.comboBoxInstance.dataSource.length!==d.names.length||this.comboBoxInstance.value===this.comboBoxInstance.text){var h=this.comboBoxInstance.text;this.comboBoxInstance.dataSource=d.names;var p=d.names.find((function(e){return e.name===h}));this.comboBoxInstance.value=p?p.refersTo:this.comboBoxInstance.value,this.comboBoxInstance.dataBind()}}else this.comboBoxInstance.element.classList.add("e-name-editing"),this.comboBoxInstance.element.select();!(0,e.isNullOrUndefined)(n.offsetParent)&&(n.offsetParent.classList.contains("e-insert-function")||n.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===n.offsetParent.id||this.parent.element.id+"_insert_function"===n.id||n.parentElement.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===n.parentElement.id)&&this.renderInsertDlg()},n.prototype.renderInsertDlg=function(){var t=this,n=this.parent.getActiveSheet(),i=r(n.activeCell);if(n.isProtected&&Tr(zn(i[0],i[1],n),Il(n,i[1]))&&!this.parent.isEdit)this.parent.notify(eo,null);else if(Jr(zn(i[0],i[1],n),Il(n,i[1]),fl(n,i[0])))this.parent.notify(to,null);else{var a=this.parent.serviceLocator.getService(Dl),o=!this.parent.isEdit,s={action:"getCurrentEditValue",editedValue:""};if(!o){var l={action:"isFormulaEditing",isFormulaEdit:!1};this.parent.notify(li,l),o=l.isFormulaEdit,this.parent.notify(si,s)}if((o||""===s.editedValue)&&!this.parent.element.querySelector(".e-spreadsheet-function-dlg")){""===s.editedValue&&this.parent.notify(si,{action:"refreshEditor",value:"="});var d=this.parent.createElement("div",{className:"e-formula-description",id:this.parent.element.id+"_description_content"}),h=this.parent.createElement("div",{className:"e-category-content",id:this.parent.element.id+"_category_content"});h.innerText=a.getConstant("PickACategory");var p=this.parent.createElement("input",{className:"e-formula-category",id:this.parent.element.id+"_formula_category"}),c=this.parent.createElement("div",{className:"e-formula-list",id:this.parent.element.id+"_formula_list"}),u=this.parent.createElement("div",{className:"e-description-content"});u.innerText=a.getConstant("Description");var f=this.parent.createElement("div",{className:"e-header-content"});f.innerText=a.getConstant("InsertFunction");var g,m={action:"getFormulaCategory",categoryCollection:[]};this.parent.notify(pe,m),this.categoryCollection=m.categoryCollection,this.categoryList=new Nh.DropDownList({dataSource:this.categoryCollection,cssClass:"e-ss-formula-category",index:0,width:"285px",popupHeight:"210px",select:this.dropDownSelect.bind(this),open:function(){return g=!0},close:function(){return g=!1}});var v,y={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(pe,y),this.formulaCollection=y.formulaCollection,this.formulaList=new Ah.ListView({dataSource:this.formulaCollection.sort(),actionComplete:this.updateFormulaList.bind(this),select:this.listSelected.bind(this),width:"285px",height:"200px"}),this.dialog=this.parent.serviceLocator.getService(Ll),this.dialog.show({header:f.outerHTML,content:h.outerHTML+p.outerHTML+c.outerHTML+u.outerHTML+d.outerHTML,width:"320px",height:"485px",cssClass:"e-spreadsheet-function-dlg",showCloseIcon:!0,isModal:!0,beforeOpen:function(e){var r={dialogName:"InsertFunctionDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel?(t.dialog.dialogInstance.setProperties({beforeClose:void 0},!0),v=e.cancel=!0):Md(t.parent.element)},open:this.dialogOpen.bind(this),beforeClose:this.dialogBeforeClose.bind(this),close:this.dialogClose.bind(this),buttons:[{click:function(e){e&&13===e.keyCode&&!g||t.selectFormula()},buttonModel:{content:a.getConstant("Ok"),isPrimary:!0}}]}),v?this.categoryList=this.formulaList=null:(this.categoryList.appendTo("#"+this.parent.element.id+"_formula_category"),this.formulaList.appendTo("#"+this.parent.element.id+"_formula_list"),e.EventHandler.add(this.formulaList.element,"dblclick",this.formulaClickHandler,this))}}},n.prototype.toggleFormulaBar=function(e){var t=e.parentElement,r=this.parent.serviceLocator.getService(Dl);t.classList.contains("e-expanded")?(t.classList.remove("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=1,e.title=r.getConstant("ExpandFormulaBar"),e.setAttribute("aria-label",r.getConstant("CollapseFormulaBar"))):(t.classList.add("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=3,e.title=r.getConstant("CollapseFormulaBar"),e.setAttribute("aria-label",r.getConstant("ExpandFormulaBar"))),this.parent.setPanelSize()},n.prototype.dialogOpen=function(){var e=this;zl((function(){var t=e.dialog.dialogInstance.element.querySelector(".e-footer-content .e-primary"),r=e.parent.serviceLocator.getService(Dl);t.setAttribute("aria-label",r.getConstant("InsertFunction")+" "+r.getConstant("Ok")),e.categoryList&&Md(e.categoryList.element)}))},n.prototype.dialogClose=function(){var e={action:"getCurrentEditValue",editedValue:""};this.parent.notify(si,e),"="===e.editedValue.toString().trim()&&this.parent.notify(si,{action:"refreshEditor",value:""})},n.prototype.dialogBeforeClose=function(){e.EventHandler.remove(this.formulaList.element,"dblclick",this.formulaClickHandler);var t=document.getElementsByClassName("e-spreadsheet-function-dlg")[0].querySelector(".e-dlg-content");t.parentNode.removeChild(t),this.categoryList.destroy(),this.categoryList=null,this.formulaList.destroy(),this.formulaList=null},n.prototype.selectFormula=function(){var e=this.formulaList.getSelectedItems().text,t=Fn(this.parent,this.parent.activeSheetIndex);this.parent.isEdit?this.parent.notify(si,{action:"refreshEditor",value:e+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(si,{action:"startEdit",value:"="+e+"(",address:t.activeCell}),this.parent.notify(di,{action:"refreshFormulabar",value:"="+e+"("})),this.dialog.dialogInstance.storeActiveElement=document.getElementById(this.parent.element.id+"_edit"),this.dialog.hide()},n.prototype.listSelected=function(e){this.updateFormulaDescription(),e.isInteracted&&e.item&&e.item.focus()},n.prototype.updateFormulaList=function(){this.activeListFormula(),this.updateFormulaDescription()},n.prototype.dropDownSelect=function(e){this.formulaCollection=[];var t={action:"getLibraryFormulas",formulaCollection:[]};if("All"===e.item.textContent)this.parent.notify(pe,t),this.formulaCollection=t.formulaCollection;else{var r={action:"dropDownSelectFormulas",formulaCollection:[],selectCategory:e.item.textContent};this.parent.notify(pe,r),this.formulaCollection=r.formulaCollection}this.formulaList.dataSource=this.formulaCollection.sort()},n.prototype.activeListFormula=function(){var e=document.getElementById(this.parent.element.id+"_formula_list").children[0].children[0].firstElementChild;this.formulaList.selectItem(e)},n.prototype.updateFormulaDescription=function(){var e=this.formulaList.getSelectedItems().text,t={action:"getFormulaDescription",description:"",selectedList:e,isCustom:!1};this.parent.notify(pe,t);var r=this.dialog.dialogInstance.element.querySelector(".e-footer-content .e-primary");r.hasAttribute("aria-label")&&r.removeAttribute("aria-label"),e="AND"===e?"CalculateAND":"OR"===e?"CalculateOR":e,document.getElementById(this.parent.element.id+"_description_content").textContent=t.isCustom?t.description:this.parent.serviceLocator.getService(Dl).getConstant(e)},n.prototype.formulaClickHandler=function(e){var t=e.target,r=Fn(this.parent,this.parent.activeSheetIndex);(t.offsetParent.classList.contains("e-text-content")||t.classList.contains("e-list-item"))&&(this.parent.isEdit?this.parent.notify(si,{action:"refreshEditor",value:t.innerText+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(si,{action:"startEdit",value:"="+t.innerText+"(",address:r.activeCell}),this.parent.notify(di,{action:"refreshFormulabar",value:"="+t.innerText+"("})),this.dialog.hide())},n.prototype.addEventListener=function(){this.parent.on(ei,this.createFormulaBar,this),this.parent.on(hi,this.formulaBarClickHandler,this),this.parent.on(ci,this.keyDownHandler,this),this.parent.on(ps,this.renderInsertDlg,this),this.parent.on(pi,this.keyUpHandler,this),this.parent.on(rr,this.formulaBarUpdateHandler,this),this.parent.on(wi,this.updateValueAfterMouseUp,this),this.parent.on(di,this.editOperationHandler,this),this.parent.on(io,this.disabletextarea,this),this.parent.on(ni,this.isFormulaBarEdit,this)},n.prototype.destroy=function(){this.removeEventListener(),this.comboBoxInstance&&this.comboBoxInstance.destroy(),this.comboBoxInstance=null,this.categoryCollection=null,this.formulaCollection=null,this.dialog=null,this.isGoto=null,this.insertFnRipple&&this.insertFnRipple(),this.insertFnRipple=null;var t=this.parent.element.querySelector(".e-formula-bar-panel");t&&(jl(t),(0,e.detach)(t)),this.parent=null},n.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ei,this.createFormulaBar),this.parent.off(hi,this.formulaBarClickHandler),this.parent.off(ps,this.renderInsertDlg),this.parent.off(ci,this.keyDownHandler),this.parent.off(pi,this.keyUpHandler),this.parent.off(rr,this.formulaBarUpdateHandler),this.parent.off(wi,this.updateValueAfterMouseUp),this.parent.off(di,this.editOperationHandler),this.parent.off(io,this.disabletextarea),this.parent.off(ni,this.isFormulaBarEdit))},n.prototype.editOperationHandler=function(t){switch(t.action){case"refreshFormulabar":t.cell?this.getFormulaBar().value=this.getFormulaBarValue(t.cell):this.getFormulaBar().value=(0,e.isUndefined)(t.value)?"":t.value;break;case"setNameBoxValue":this.updateNameBoxValue(t.definedName,t.isRemove);break;case"getElement":t.element=this.getFormulaBar()}},n.prototype.isFormulaBarEdit=function(e){this.parent.isEdit&&this.isGoto?e.isEdit=!0:e.isEdit=!1},n.prototype.getFormulaBar=function(){return(0,e.select)("#"+this.parent.element.id+"_formula_input",this.parent.element)},n}(),Xh=function(){function t(e){this.isFormulaBar=!1,this.isFormula=!1,this.isPopupOpened=!1,this.isPreventClose=!1,this.isSubFormula=!1,this.parent=e,this.addEventListener()}return t.prototype.getModuleName=function(){return"formula"},t.prototype.destroy=function(){this.removeEventListener(),this.autocompleteInstance&&(this.autocompleteInstance.destroy(),this.autocompleteInstance.element&&(this.autocompleteInstance.element.remove(),this.autocompleteInstance.element=null)),this.autocompleteInstance=null,this.acInputElement&&(this.acInputElement.remove(),this.acInputElement=null),this.parent=null},t.prototype.addEventListener=function(){this.parent.on(li,this.performFormulaOperation,this),this.parent.on(pi,this.keyUpHandler,this),this.parent.on(ci,this.keyDownHandler,this),this.parent.on(hi,this.formulaClick,this),this.parent.on(Ua,this.refreshFormulaDatasource,this)},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(li,this.performFormulaOperation),this.parent.off(pi,this.keyUpHandler),this.parent.off(ci,this.keyDownHandler),this.parent.off(hi,this.formulaClick),this.parent.off(Ua,this.refreshFormulaDatasource))},t.prototype.performFormulaOperation=function(e){var t=this,r=e.action,n=this.parent.serviceLocator.getService(Dl);switch(r){case"renderAutoComplete":this.renderAutoComplete();break;case"endEdit":this.endEdit();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName);break;case"getNames":e.sheetName||(e.sheetName=Pn(this.parent)),e.names=this.getNames(e.sheetName);break;case"getNameFromRange":e.definedName=this.getNameFromRange(e.range);break;case"isFormulaEditing":e.isFormulaEdit=this.isFormula;break;case"isCircularReference":var i=this.parent.serviceLocator.getService(Ll),a=n.getConstant("CircularReference"),o=function(e){t.parent.trigger("dialogBeforeOpen",e),e.content!==a&&(i.dialogInstance.content=e.content,i.dialogInstance.dataBind())},s=i.dialogInstance;if(s&&s.visible&&s.element.classList.contains("e-circularref-dlg"))o({dialogName:"CircularReferenceDialog",element:s.element,target:this.parent.element,cancel:!1,cellAddress:e.address,content:a});else{var l=e.address;i.show({height:180,width:400,isModal:!0,showCloseIcon:!0,cssClass:"e-circularref-dlg",content:a,beforeOpen:function(e){var t={dialogName:"CircularReferenceDialog",element:e.element,target:e.target,cancel:e.cancel,cellAddress:l,content:a};o(t),e.cancel=t.cancel}})}e.argValue="0"}},t.prototype.renderAutoComplete=function(){if(!(0,e.select)("#"+this.parent.element.id+"_ac",this.parent.element)){var t=this.parent.createElement("input",{id:this.parent.element.id+"_ac",className:"e-ss-ac"});this.parent.element.appendChild(t);var r={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(pe,r);var n={dataSource:r.formulaCollection,cssClass:"e-ss-atc",popupWidth:"130px",allowFiltering:!0,debounceDelay:0,filterType:"StartsWith",sortOrder:"Ascending",open:this.onSuggestionOpen.bind(this),close:this.onSuggestionClose.bind(this),select:this.onSelect.bind(this),actionComplete:this.onSuggestionComplete.bind(this)};this.autocompleteInstance=new Nh.AutoComplete(n,t),this.autocompleteInstance.createElement=this.parent.createElement,this.acInputElement=t}},t.prototype.onSuggestionOpen=function(e){var t=this;this.isPopupOpened=!0,e.popup.relateTo=this.getRelateToElem(),e.popup.element.firstChild.style.maxHeight="180px",new Promise((function(e){setTimeout((function(){e()}),100)})).then((function(){t.triggerKeyDownEvent(Ul.DOWN)}))},t.prototype.onSuggestionClose=function(e){this.isPreventClose?e.cancel=!0:this.isPopupOpened=!1},t.prototype.onSelect=function(t){var r="="+t.itemData.value+"(";if(this.isSubFormula){var n=this.getEditingValue(),i=n.lastIndexOf(this.parent.listSeparator);(i>-1||(i=n.lastIndexOf("("))>-1)&&(r=n.slice(0,i+1)),r+=t.itemData.value+"("}if(this.parent.notify(si,{action:"refreshEditor",value:r,refreshFormulaBar:!0,refreshEditorElem:!0,refreshCurPos:!this.isFormulaBar}),this.isPopupOpened){this.hidePopUp();var a=(0,e.select)("#"+this.parent.element.id+"_ac_popup");a&&(0,e.detach)(a),this.isPopupOpened=!1}},t.prototype.onSuggestionComplete=function(e){this.isPreventClose=e.result.length>0,this.isPreventClose||(e.cancel=!0,this.hidePopUp())},t.prototype.refreshFormulaDatasource=function(){var e={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(pe,e),this.autocompleteInstance&&(this.autocompleteInstance.dataSource=e.formulaCollection)},t.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var t=this.getEditingValue();this.isFormula=wr(t),(this.isFormula||this.isPopupOpened)&&(e.keyCode!==Ul.TAB&&this.isFormula&&(t=this.getSuggestionKeyFromFormula(t)),this.refreshFormulaSuggestion(e,t))}else this.isPopupOpened&&this.hidePopUp()},t.prototype.keyDownHandler=function(e){var t=e.keyCode;if(this.isFormula){if(this.isPopupOpened)switch(t){case Ul.UP:case Ul.DOWN:e.preventDefault(),this.triggerKeyDownEvent(t);break;case Ul.TAB:e.preventDefault(),this.triggerKeyDownEvent(Ul.ENTER)}}else{var r=e.target;if(r.id===this.parent.element.id+"_name_box")switch(t){case Ul.ENTER:document.querySelector(".e-name-box.e-popup-open")||(this.addDefinedName({name:r.value}),Md(this.parent.element));break;case Ul.ESC:Md(this.parent.element)}}},t.prototype.formulaClick=function(e){if(this.parent.isEdit){var t=e.target;this.isFormulaBar=t.classList.contains("e-formula-bar")}},t.prototype.refreshFormulaSuggestion=function(e,t){if(t.length>0){var r=this.autocompleteInstance.element,n=e.keyCode,i=this.isPopupOpened;hd(n)||(r.value=t,r.dispatchEvent(new Event("input")),r.dispatchEvent(new Event("keyup")),i&&this.triggerKeyDownEvent(Ul.DOWN))}else this.isPopupOpened&&(this.isPreventClose=!1,this.hidePopUp())},t.prototype.endEdit=function(){if(this.isSubFormula=!1,this.isPreventClose=!1,this.isFormula=!1,this.isFormulaBar=!1,this.isPopupOpened){this.hidePopUp();var t=(0,e.select)("#"+this.parent.element.id+"_ac_popup");t&&(0,e.detach)(t),this.isPopupOpened=!1}},t.prototype.hidePopUp=function(){this.autocompleteInstance.hidePopup()},t.prototype.getSuggestionKeyFromFormula=function(e){var t="";if(e=e.substr(1)){var r=e.lastIndexOf("("),n=(e=e.substr(r+1)).split(this.parent.listSeparator);1===n.length?(t=n[0],this.isSubFormula=r>-1):(t=n[n.length-1],this.isSubFormula=!0);var i=t.match(/\w/);(!i||i&&0!==i.index)&&(t="")}return t},t.prototype.getRelateToElem=function(){var e={action:"getElement"};return this.isFormulaBar?this.parent.notify(di,e):this.parent.notify(si,e),e.element},t.prototype.getEditingValue=function(){var e={action:"getCurrentEditValue",editedValue:""};return this.parent.notify(si,e),e.editedValue},t.prototype.triggerKeyDownEvent=function(e){var t=this.autocompleteInstance.element;t.dispatchEvent(new Event("input"));var r=new Event("keydown");r.keyCode=e,r.which=e,r.altKey=!1,r.shiftKey=!1,r.ctrlKey=!1,t.dispatchEvent(r)},t.prototype.getNames=function(e){return this.parent.definedNames.filter((function(t){return"Workbook"===t.scope||""===t.scope||t.scope===e}))},t.prototype.getNameFromRange=function(e){var t,r,n=e.slice(0,e.indexOf(":")),i=e.substring(e.lastIndexOf("!")+1).split(":"),a=i.length>1&&i[0]===i[1],o=this.parent.definedNames.filter((function(i){t=i.refersTo.substring(0,i.refersTo.lastIndexOf("!")),r=i.refersTo.substring(i.refersTo.lastIndexOf("!")+1),t.includes("'")&&t.match(/^='.*'$/)&&(t="="+t.slice(2,-1));var o=t+"!"+r.split("$").join("");return!(!a||o!=="="+n)||o==="="+e}));return o&&o[0]},t.prototype.addDefinedName=function(t){var n=this,i=t.name,a=!1;if(i&&Ir(i.toUpperCase()))return this.parent.goTo(i),a;if(!t.refersTo){var o=Fn(this.parent,this.parent.activeSheetIndex),s=Pn(this.parent);s=-1!==s.indexOf(" ")?"'"+s+"'":s;var l=o.selectedRange;if(!(0,e.isNullOrUndefined)(l)){var d=l.indexOf(":"),h=l.substr(0,d),p=l.substr(d+1,l.length);parseInt(p.replace(/\D/g,""),10)===o.rowCount&&1===parseInt(h.replace(/\D/g,""),10)?(p=p.replace(/[0-9]/g,""),l="$"+(h=h.replace(/[0-9]/g,""))+":$"+p):r(p)[1]===o.colCount-1&&0===r(h)[1]?(p=p.replace(/\D/g,""),l="$"+(h=h.replace(/\D/g,""))+":$"+p):l=h===p?h:l}t.refersTo=s+"!"+l,t.scope="Workbook"}if(i.length>0&&/^([a-zA-Z_0-9.]){0,255}$/.test(i)){var c={action:"addDefinedName",definedName:t,isAdded:!1};this.parent.notify(pe,c),a=c.isAdded,c.isAdded||this.parent.serviceLocator.getService(Ll).show({content:this.parent.serviceLocator.getService(Dl).getConstant("DefineNameExists"),width:"300",beforeOpen:function(e){var t={dialogName:"DefineNameExistsDialog",element:e.element,target:e.target,cancel:e.cancel};n.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}})}else this.parent.serviceLocator.getService(Ll).show({content:this.parent.serviceLocator.getService(Dl).getConstant("DefineNameInValid"),width:"300",beforeOpen:function(e){var t={dialogName:"DefineNameInValidDialog",element:e.element,target:e.target,cancel:e.cancel};n.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}});return a},t}(),Kh=function(){function r(e){this.aggregateContent="",this.selaggregateCnt="Sum",this.parent=e,this.addEventListener()}return r.prototype.getModuleName=function(){return"sheetTabs"},r.prototype.createSheetTabs=function(){var t=this;if(this.parent.showSheetTabs||!this.tabInstance){var r=this.parent.serviceLocator.getService(Dl),n=this.parent.createElement("div",{className:"e-sheet-tab-panel",id:this.parent.element.id+"_sheet_tab_panel"}),i=this.parent.createElement("button",{className:"e-add-sheet-tab e-btn e-css e-flat e-icon-btn"+(this.parent.allowInsert?"":" e-disabled"),attrs:{title:r.getConstant("AddSheet"),type:"button"}});i.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-add-icon"})),i.addEventListener("click",this.addSheetTab.bind(this)),i.disabled=!this.parent.allowInsert,n.appendChild(i),this.addBtnRipple=(0,e.rippleEffect)(n,{selector:".e-add-sheet-tab"});var a=this.parent.createElement("button",{attrs:{title:r.getConstant("ListAllSheets"),type:"button"}});n.appendChild(a),this.parent.element.appendChild(n);var o=this.getSheetTabItems();this.dropDownInstance=new Dh.DropDownButton({iconCss:"e-icons",items:o.ddbItems,createPopupOnClick:!0,beforeItemRender:function(e){var r=t.parent.sheets[t.dropDownInstance.items.indexOf(e.item)];"Hidden"===r.state?e.element.classList.add("e-hide"):"VeryHidden"===r.state&&(e.element.style.display="none")},select:function(e){return t.updateSheetTab({idx:t.dropDownInstance.items.indexOf(e.item)})},beforeOpen:function(e){return t.beforeOpenHandler(t.dropDownInstance,e.element,r.getConstant("ListAllSheets"))},open:function(e){return t.openHandler(t.dropDownInstance,e.element,"left")},cssClass:"e-sheets-list e-flat e-caret-hide",close:function(){return t.focusTab(t.tabInstance.element)}}),this.dropDownInstance.createElement=this.parent.createElement,this.dropDownInstance.appendTo(a);var s,l=this.parent.createElement("div",{className:"e-sheet-tab"});this.tabInstance=new vh.Tab({selectedItem:this.parent.activeSheetIndex,overflowMode:"Scrollable",items:o.tabItems,scrollStep:250,selecting:function(e){if(e.selectingIndex!==e.selectedIndex)if(s)s=!1;else{var r={currentSheetIndex:e.selectingIndex,previousSheetIndex:e.selectedIndex,cancel:!1};t.parent.notify(K,{eventArgs:r,action:"gotoSheet"}),s=r.cancel}},selected:function(e){e.isInteracted||(e.preventFocus=!0),t.goToSheet(e,s,!0)},created:function(){var r=t.tabInstance.element.querySelector(".e-toolbar-items");r.classList.add("e-sheet-tabs-items"),e.EventHandler.add(r,"dblclick",t.renameSheetTab,t)}}),n.appendChild(l),this.tabInstance.createElement=this.parent.createElement,this.tabInstance.appendTo(l),e.EventHandler.remove(this.tabInstance.element,"keydown",this.tabInstance.spaceKeyDown);for(var d,h=o.tabItems.length,p=0;p<h;p++){var c={action:"addSheet",sheetName:"Sheet"+(d=Fn(this.parent,p)).id,sheetId:d.id,visibleName:d.name};this.parent.notify(pe,c)}this.parent.notify(pe,{action:"initiateDefinedNames"}),this.parent.notify(Wa,null)}else this.destroy()},r.prototype.goToSheet=function(e,t,r){var n=this;if(e.selectedIndex!==e.previousIndex){if(t)return this.tabInstance.selectedItem=e.previousIndex,this.tabInstance.dataBind(),void Md(this.parent.element);if(this.parent.notify(Vo,{}),this.parent.isEdit){var i=window.getSelection(),a={action:"getCurrentEditValue",editedValue:""};this.parent.notify(si,a);var o=!!a.editedValue&&wr(a.editedValue,!0);!o&&i&&i.focusNode&&i.focusNode.classList&&i.focusNode.classList.contains("e-formula-bar-panel")&&(o=wr(this.parent.element.querySelector(".e-formula-bar").value,!0)),o||this.parent.endEdit()}this.parent.activeSheetIndex=e.selectedIndex,this.parent.dataBind(),this.updateDropDownItems(e.selectedIndex,e.previousIndex);var s={action:"registerGridInCalc",sheetID:(e.selectedIndex+1).toString()};this.parent.notify(pe,s),r&&(this.parent.notify(Pa,{eventArgs:{previousSheetIndex:e.previousIndex,currentSheetIndex:e.selectedIndex},action:"gotoSheet"}),zl((function(){return Md(n.parent.element)})))}},r.prototype.updateDropDownItems=function(e,t){t>-1&&(this.dropDownInstance.items[t].iconCss=""),this.dropDownInstance.items[e].iconCss="e-selected-icon e-icons",this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0)},r.prototype.beforeOpenHandler=function(e,t,r){var n=this.parent.viewport.height;parseInt(getComputedStyle(t.firstElementChild).height,10)*e.items.length+2*parseInt(getComputedStyle(t).paddingTop,10)>n&&(t.style.height=n+"px",t.style.overflowY="auto"),t.parentElement.style.visibility="hidden",r&&t.setAttribute("aria-label",r)},r.prototype.openHandler=function(e,t,r){var n,i=t.parentElement;if(-1===(0,fh.isCollide)(i).indexOf("bottom")){n="auto"===t.style.overflowY?this.parent.viewport.height:i.getBoundingClientRect().height;var a=(0,fh.calculatePosition)(e.element,r,"top");"right"===r&&(a.left-=i.getBoundingClientRect().width),i.style.left=a.left+"px",i.style.top=a.top-n+"px"}i.style.visibility="",Md(t)},r.prototype.getSheetTabItems=function(){var e,t=this,r=[],n=[];return this.parent.sheets.forEach((function(i,a){e=Pn(t.parent,a).replace(/</g,"&lt;").replace(/>/g,"&gt;"),r.push({header:{text:e},visible:"Visible"===i.state}),n.push({text:e,iconCss:a===t.parent.activeSheetIndex?"e-selected-icon e-icons":""})})),{tabItems:r,ddbItems:n}},r.prototype.refreshSheetTab=function(){var e=this.getSheetTabItems();this.dropDownInstance.items=e.ddbItems,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.items=e.tabItems,this.tabInstance.selectedItem=this.parent.activeSheetIndex,this.tabInstance.dataBind()},r.prototype.addSheetTab=function(){this.parent.notify($e,{model:this.parent,start:this.parent.activeSheetIndex+1,end:this.parent.activeSheetIndex+1,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex+1})},r.prototype.insertSheetTab=function(e){this.parent.notify(Vo,{}),e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[this.tabInstance.selectedItem].iconCss="");for(var t=e.startIdx;t<=e.endIdx;t++){var r=this.parent.sheets[t].name.replace(/</g,"&lt;").replace(/>/g,"&gt;");this.dropDownInstance.items.splice(t,0,{text:r}),this.tabInstance.addTab([{header:{text:r},content:""}],t)}e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[e.startIdx].iconCss="e-selected-icon e-icons"),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.preventUpdate?e.startIdx!==this.tabInstance.selectedItem?this.refreshSheetTab():this.parent.notify(Wa,null):this.updateSheetTab({idx:e.startIdx,preventDataBind:!0})},r.prototype.updateSheetTab=function(e){if("activeSheetChanged"===e.name)e.idx=this.parent.skipHiddenSheets(e.idx);else if("Hidden"===this.parent.sheets[e.idx].state){if(this.parent.isProtected)return;this.showSheet({sheetIndex:e.idx,triggerEvent:!0})}this.tabInstance.selectedItem=e.idx,e.preventDataBind||this.tabInstance.dataBind(),this.parent.notify(Wa,null)},r.prototype.showSheet=function(e){this.parent.setSheetPropertyOnMute(this.parent.sheets[e.sheetIndex],"state","Visible"),this.tabInstance.hideTab(e.sheetIndex,!1),e.triggerEvent&&this.parent.notify(Pa,{action:"showSheet",eventArgs:{sheetIndex:e.sheetIndex}})},r.prototype.switchSheetTab=function(t){var r=(0,e.closest)(t.event.target,".e-toolbar-item");if(r){for(var n=r.querySelector(".e-tab-text").textContent,i=[],a=this.parent.element.id+"_cmenu",o=0,s=this.parent.sheets.length;o<s;o++)if(this.parent.sheets[o].name===n){this.parent.activeSheetIndex!==o&&this.updateSheetTab({idx:o});break}t.element.classList.contains("e-contextmenu")&&t.items[0]&&t.items[0].id===this.parent.element.id+"_cmenu_insert_sheet"&&(1===this.skipHiddenSheets()&&i.push(a+"_hide_sheet",a+"_delete_sheet"),this.parent.allowInsert&&!this.parent.isProtected||i.push(a+"_insert_sheet"),!this.parent.allowDelete&&i.indexOf(a+"_delete_sheet")>-1&&i.push(a+"_delete_sheet")),(this.parent.password.length>0||this.parent.isProtected)&&(i.indexOf(a+"_insert_sheet")>-1&&i.push(a+"_insert_sheet"),i.indexOf(a+"_delete_sheet")>-1&&i.push(a+"_delete_sheet"),i.push(a+"_duplicate",a+"_rename",a+"_hide_sheet",a+"_delete_sheet",a+"_insert_sheet",a+"_move_left",a+"_move_right")),this.parent.enableContextMenuItems(i,!1,!0)}},r.prototype.skipHiddenSheets=function(){var e=this.parent.sheets.length;return this.parent.sheets.forEach((function(t){"Visible"!==t.state&&--e})),e},r.prototype.renameSheetTab=function(){var t=this.tabInstance.element.querySelector(".e-toolbar-item.e-active");if(t){var r=(t=t.querySelector(".e-text-wrap")).querySelector(".e-tab-text").textContent,n={eventArgs:{name:r,index:this.parent.getActiveSheet().id},action:"renameSheet",cancel:!1};if(this.parent.trigger("actionBegin",n),n.cancel||this.parent.isProtected)return;var i=this.parent.createElement("input",{id:this.parent.element.id+"_rename_input",className:"e-input e-sheet-rename",styles:"width: "+t.getBoundingClientRect().width+"px",attrs:{type:"text",name:"Rename",required:"",value:r,spellcheck:"false",maxlength:"31"}});t.firstElementChild.style.display="none",t.appendChild(i),e.EventHandler.add(document,"mousedown touchstart",this.renameInputFocusOut,this),e.EventHandler.add(i,"keydown",this.renameKeyDown,this),e.EventHandler.add(i,"input",this.updateWidth,this),i.focus(),i.setSelectionRange(0,r.length),e.EventHandler.remove((0,e.closest)(t,".e-toolbar-items"),"dblclick",this.renameSheetTab)}},r.prototype.updateWidth=function(e){var t=e.target,r=t.value.length,n=t.value.split(" ");if(n.length){var i=n.length-1;r-=i,r+=.5*i}t.style.width=r+"ch"},r.prototype.renameKeyDown=function(e){32===e.keyCode?e.stopPropagation():27===e.keyCode?(this.removeRenameInput(e.target),this.focusTab(this.tabInstance.element)):13===e.keyCode&&this.renameInputFocusOut(e)},r.prototype.renameInputFocusOut=function(t){var r=t.target;if("mousedown"!==t.type&&"touchstart"!==t.type||!r.classList.contains("e-sheet-rename")&&!(0,e.closest)(r,".e-dlg-container")){var n=(r=document.getElementById(this.parent.element.id+"_rename_input")).value,i=this.parent.serviceLocator.getService(Dl);if(n){var a=this.tabInstance.selectedItem;if(n.match(new RegExp(".*[\\[\\]\\*\\\\/\\?].*")))this.showRenameDialog(r,i.getConstant("SheetRenameInvalidAlert"));else{if(this.parent.sheets[a].name!==n)for(var o=0,s=this.parent.sheets.length;o<s;o++)if(o!==this.parent.activeSheetIndex&&this.parent.sheets[o].name.toLowerCase()===n.toLowerCase())return void this.showRenameDialog(r,i.getConstant("SheetRenameAlreadyExistsAlert"));var l=this.removeRenameInput(r);this.parent.sheets[a].name!==n&&(this.parent.setSheetPropertyOnMute(this.parent.sheets[a],"name",n),this.updateSheetName({value:n,idx:a,items:l})),"keydown"===t.type?this.focusTab(l):(0,e.closest)(t.target,".e-spreadsheet")&&Md(this.parent.element)}}else this.showRenameDialog(r,i.getConstant("SheetRenameEmptyAlert"));this.parent.notify(Pa,{eventArgs:{index:this.parent.getActiveSheet().id,value:n},action:"renameSheet"})}},r.prototype.focusTab=function(t){Md((0,e.select)(".e-toolbar-item.e-active .e-tab-wrap",t))},r.prototype.updateSheetName=function(e){var t=this.tabInstance.items[e.idx].header.text.replace(/&lt;/g,"<").replace(/&gt;/g,">"),r=e.value.replace(/</g,"&lt;").replace(/>/g,"&gt;");this.tabInstance.items[e.idx].header.text=r,this.dropDownInstance.items[e.idx].text=r,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0);var n=e.items.querySelectorAll(".e-toolbar-item")[e.idx].querySelector(".e-tab-text");if(n.textContent="",n.appendChild(document.createTextNode(e.value)),e.value.indexOf("  ")>-1?this.tabInstance.setProperties({items:this.tabInstance.items},!0):this.tabInstance.dataBind(),this.parent.notify(yr,{value:e.value,pName:t}),this.parent.allowChart){var i,a=[];this.parent.chartColl.forEach((function(r){r.range.includes("!")&&(i=r.range.lastIndexOf("!"),a[0]=r.range.substring(0,i),a[0].startsWith("'")&&a[0].endsWith("'")&&(a[0]=a[0].slice(1,-1)),a[1]=r.range.substring(i+1),a[0].toLowerCase()===t.toLowerCase()&&(a[0]=e.value,r.range=a.join("!")))}))}},r.prototype.hideSheet=function(e){var t={action:"hideSheet",eventArgs:{sheetIndex:e.sheetIndex,cancel:!1}};e.triggerEvent&&(this.parent.notify(K,t),t.eventArgs.cancel)||(this.parent.setSheetPropertyOnMute(Fn(this.parent,e.sheetIndex),"state","Hidden"),this.tabInstance.hideTab(e.sheetIndex),e.triggerEvent&&(delete t.eventArgs.cancel,this.parent.notify(Pa,t)))},r.prototype.removeRenameInput=function(t){var r=t.parentElement.querySelector(".e-tab-text"),n=(0,e.closest)(t,".e-toolbar-items");return e.EventHandler.add(n,"dblclick",this.renameSheetTab,this),e.EventHandler.remove(document,"mousedown touchstart",this.renameInputFocusOut),e.EventHandler.remove(t,"keydown",this.renameKeyDown),e.EventHandler.remove(t,"input",this.updateWidth),(0,e.remove)(t),r.style.display="",n},r.prototype.showRenameDialog=function(e,t){var r,n=this;this.parent.serviceLocator.getService(Ll).show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:t,beforeOpen:function(i){var a={dialogName:"SheetRenameDialog",element:i.element,target:i.target,cancel:i.cancel};n.parent.trigger("dialogBeforeOpen",a),a.cancel?r=i.preventFocus=i.cancel=!0:(i.element.querySelector(".e-footer-content .e-primary").setAttribute("aria-label",t+" "+n.parent.serviceLocator.getService(Dl).getConstant("Ok")),Md(e))},close:function(){r?zl((function(){var t=[e.selectionStart,e.selectionEnd];Md(e),e.setSelectionRange(t[0],t[1])})):e.setSelectionRange(0,e.value.length)}})},r.prototype.focusRenameInput=function(){var e=document.getElementById(this.parent.element.id+"_rename_input");e&&e.focus()},r.prototype.removeSheetTab=function(t){var r=this;if(!t.count||t.count!==this.parent.sheets.length){var n=this.parent.serviceLocator.getService(Dl);if(this.skipHiddenSheets()>1){var i=t.sheetName?Fn(this.parent,In(this.parent,t.sheetName)):this.parent.getActiveSheet(),a=(0,e.isNullOrUndefined)(t.index)?In(this.parent,i.name):t.index,o={index:a,sheetCount:this.parent.sheets.length,sheetName:i.name};if(!(!i.rows||!i.rows.length)&&(1!==i.rows.length||!(!i.rows[0].cells||!i.rows[0].cells.length))){var s=this.parent.serviceLocator.getService(Ll);t.clicked?this.forceDelete(a):s.show({height:200,width:400,isModal:!0,showCloseIcon:!0,cssClass:"e-delete-sheet-dlg",content:n.getConstant("DeleteSheetAlert"),beforeOpen:function(e){var t={dialogName:"DeleteSheetDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel?e.cancel=!0:(e.element.querySelector(".e-footer-content .e-primary").setAttribute("aria-label",n.getConstant("DeleteSheetAlert")+" "+n.getConstant("Ok")),Md(r.parent.element))},buttons:[{buttonModel:{content:n.getConstant("Ok"),isPrimary:!0},click:function(){s.hide(),r.forceDelete(a),r.parent.notify(Ra,null),t&&!t.isAction&&(o.sheetCount=r.parent.sheets.length,r.parent.notify(Pa,{eventArgs:o,action:"removeSheet"}))}}]})}else this.parent.notify(nr,{startIndex:a,endIndex:a,modelType:"Sheet",isDelete:!0}),this.parent.notify(pe,{action:"deleteSheetTab",sheetId:Fn(this.parent,a).id}),this.destroySheet(a),this.parent.notify(Ra,null),t&&!t.isAction&&(o.sheetCount=this.parent.sheets.length,this.parent.notify(Pa,{eventArgs:o,action:"removeSheet"}))}else this.parent.serviceLocator.getService(Ll).show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:n.getConstant("DeleteSingleLastSheetAlert"),beforeOpen:function(e){var t={dialogName:"DeleteSingleSheetDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}})}},r.prototype.forceDelete=function(e){this.parent.notify(Vo,{}),this.parent.notify(nr,{startIndex:e,endIndex:e,modelType:"Sheet",isDelete:!0}),this.parent.notify(pe,{action:"deleteSheetTab",sheetId:Fn(this.parent,e).id}),this.destroySheet(e)},r.prototype.destroySheet=function(t){var r=(0,e.isNullOrUndefined)(t)?this.parent.activeSheetIndex:t;this.parent.removeSheet(r),this.parent.notify(xe,{sheetIndex:r}),this.dropDownInstance.items.splice(r,1),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.removeTab(r);var n=this.parent.skipHiddenSheets(this.tabInstance.selectedItem);this.parent.activeSheetIndex=n,this.parent.setProperties({activeSheetIndex:n},!0),this.parent.renderModule.refreshSheet(),this.tabInstance.selectedItem=n,this.tabInstance.dataBind(),this.updateDropDownItems(n),this.parent.notify(Wa,null)},r.prototype.showAggregate=function(e){var r=this;if(m(t(this.parent.getActiveSheet().selectedRange))||e&&e.remove)this.removeAggregate();else{var n={Count:0,Sum:"0",Avg:"0",Min:"0",Max:"0",countOnly:!0};if(this.parent.notify(Se,n),n.Count>1){this.aggregateContent=n.countOnly?"Count":this.selaggregateCnt,n.countOnly&&(this.aggregateContent="Count",delete n.Sum,delete n.Avg,delete n.Min,delete n.Max);var i=n.countOnly?"e-aggregate-list e-flat e-aggregate-list-countonly e-caret-hide":"e-aggregate-list e-flat";delete n.countOnly;var a=this.aggregateContent,o=a+": "+n[a.toString()];if(this.aggregateDropDown)this.updateAggregateContent(o,n);else{var s=this.parent.createElement("button",{id:this.parent.element.id+"_aggregate",attrs:{type:"button"}});document.getElementById(this.parent.element.id+"_sheet_tab_panel").appendChild(s),this.aggregateDropDown=new Dh.DropDownButton({content:o,items:this.getAggregateItems(n),createPopupOnClick:!0,select:function(e){r.parent.notify(Se,n),r.updateAggregateContent(e.item.text,{Count:n.Count,Sum:n.Sum,Avg:n.Avg,Min:n.Min,Max:n.Max},!0)},beforeOpen:function(e){return r.beforeOpenHandler(r.aggregateDropDown,e.element)},open:function(e){return r.openHandler(r.aggregateDropDown,e.element,"right")},close:function(){return Md(r.parent.element)},cssClass:i}),this.aggregateDropDown.createElement=this.parent.createElement,this.aggregateDropDown.appendTo(s)}}else this.removeAggregate()}},r.prototype.getAggregateItems=function(e){var t,r,n,i=this,a=[];return Object.keys(e).forEach((function(o){(n=e[""+o])!==Se&&(t=o+": "+n,r=o===i.aggregateContent?"e-selected-icon e-icons":"",a.push({text:t,iconCss:r}))})),a},r.prototype.updateAggregateContent=function(e,t,r){this.aggregateContent=e.split(": ")[0],r&&(this.selaggregateCnt=e.split(": ")[0]),this.aggregateDropDown.content=e,this.aggregateDropDown.dataBind(),this.aggregateDropDown.setProperties({items:this.getAggregateItems(t)},!0)},r.prototype.removeAggregate=function(){(0,e.isNullOrUndefined)(this.aggregateDropDown)||(this.aggregateDropDown.destroy(),(0,e.remove)(this.aggregateDropDown.element),this.aggregateDropDown=null)},r.prototype.addEventListener=function(){this.parent.on(ti,this.createSheetTabs,this),this.parent.on(ri,this.refreshSheetTab,this),this.parent.on(Ei,this.insertSheetTab,this),this.parent.on(Ni,this.removeSheetTab,this),this.parent.on(Ri,this.renameSheetTab,this),this.parent.on(Ii,this.switchSheetTab,this),this.parent.on(ra,this.updateSheetTab,this),this.parent.on(ve,this.removeAggregate,this),this.parent.on(vi,this.focusRenameInput,this),this.parent.on(xa,this.updateSheetName,this),this.parent.on(Sa,this.hideSheet,this),this.parent.on(po,this.showAggregate,this),this.parent.on(co,this.goToSheet,this),this.parent.on(uo,this.showSheet,this)},r.prototype.destroy=function(){this.removeEventListener(),this.dropDownInstance&&this.dropDownInstance.destroy(),this.dropDownInstance=null,this.tabInstance&&this.tabInstance.destroy(),this.tabInstance=null,this.removeAggregate(),this.aggregateContent=null,this.addBtnRipple&&this.addBtnRipple(),this.addBtnRipple=null,e.EventHandler.remove(document,"mousedown touchstart",this.renameInputFocusOut);var t=document.getElementById(this.parent.element.id+"_sheet_tab_panel");t&&(0,e.remove)(t),this.selaggregateCnt&&(this.selaggregateCnt=null),this.parent=null},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ti,this.createSheetTabs),this.parent.off(ri,this.refreshSheetTab),this.parent.off(Ei,this.insertSheetTab),this.parent.off(Ni,this.removeSheetTab),this.parent.off(Ri,this.renameSheetTab),this.parent.off(Ii,this.switchSheetTab),this.parent.off(ra,this.updateSheetTab),this.parent.off(ve,this.removeAggregate),this.parent.off(vi,this.focusRenameInput),this.parent.off(xa,this.updateSheetName),this.parent.off(Sa,this.hideSheet),this.parent.off(po,this.showAggregate),this.parent.off(co,this.goToSheet),this.parent.off(uo,this.showSheet))},r}(),$h=function(){function t(e){this.isImportedFile=!1,this.unProtectSheetIdx=[],this.parent=e,this.addEventListener(),this.renderFileUpload()}return t.prototype.addEventListener=function(){this.parent.on(ye,this.openSuccess,this),this.parent.on(Ce,this.openFailed,this),this.parent.on(xe,this.sheetsDestroyHandler,this)},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ye,this.openSuccess),this.parent.off(Ce,this.openFailed),this.parent.off(xe,this.sheetsDestroyHandler))},t.prototype.renderFileUpload=function(){var e=this.parent.element.appendChild(this.parent.createElement("input",{id:this.parent.element.id+"_fileUpload",attrs:{type:"file",accept:".xls, .xlsx, .csv, .xlsm, .xlsb",name:"fileUpload"}}));e.onchange=this.fileSelect.bind(this),e.onerror=this.openFailed.bind(this),e.style.display="none"},t.prototype.fileSelect=function(t){var r=t.target.files[0];if(!(r&&r.length<1)){var n={file:r};this.parent.open(n),(0,e.select)("#"+this.parent.element.id+"_fileUpload",this.parent.element).value=""}},t.prototype.openSuccess=function(e){var t=this,r=["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword","InCorrectSheetPassword","CorrectSheetPassword","DataLimitExceeded","FileSizeLimitExceeded","ExternalWorkbook"],n=function(r){t.parent.serviceLocator.getService(Ll).hide(!0);var n=new File([],e.guid,{type:r.toLowerCase()});t.parent.open({file:n,guid:e.guid,password:e.eventArgs.password,orginalFile:e.eventArgs.file})};if(r.indexOf(e.data)>-1){var i=this.parent.serviceLocator.getService(Dl);if(r[2]===e.data)this.parent.element.querySelector(".e-importprotectworkbook-dlg")||this.parent.notify(Xo,e.eventArgs);else if(r[3]===e.data){(a=this.parent.createElement("span",{className:"e-importprotectpwd-alert-span"})).innerText=i.getConstant("IncorrectPassword"),this.parent.element.querySelector(".e-importprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(a)}else if(r[4]===e.data){var a;(a=this.parent.createElement("span",{className:"e-unprotectsheetpwd-alert-span"})).innerText=i.getConstant("IncorrectPassword"),this.parent.element.querySelector(".e-unprotectworksheet-dlg").querySelector(".e-dlg-content").appendChild(a)}else{if(r[5]!==e.data){if(r[8]===e.data){this.parent.serviceLocator.getService(Ll).hide(!0);var o=e.data.includes("ExternalWorkbook");return this.parent.serviceLocator.getService(Ll).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant("ExternalWorkbook"),width:"350",buttons:o?[{click:n.bind(this,e.data+"Yes"),buttonModel:{content:i.getConstant("Yes"),isPrimary:!0}},{click:n.bind(this,e.data+"No"),buttonModel:{content:i.getConstant("No")}}]:[],beforeOpen:function(e){var r={dialogName:"OpenDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}},!!o||null),void this.parent.hideSpinner()}this.parent.serviceLocator.getService(Ll).hide(!0);var s=e.data.includes("LimitExceeded");return this.parent.serviceLocator.getService(Ll).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant(e.data),width:"300",buttons:s?[{click:n.bind(this,e.data+"Open"),buttonModel:{content:i.getConstant("Ok"),isPrimary:!0}},{click:n.bind(this,e.data+"Cancel"),buttonModel:{content:i.getConstant("Cancel")}}]:[],beforeOpen:function(e){var r={dialogName:"OpenDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}},!!s||null),void this.parent.hideSpinner()}this.parent.isOpen=!1,this.parent.notify(as,null),this.parent.serviceLocator.getService(Ll).hide(),this.parent.hideSpinner()}}else{this.parent.serviceLocator.getService(Ll).hide(),this.parent.showSpinner()}this.parent.element&&r[5]!==e.data&&(this.parent.notify(Re,{cellRef:null,isOpen:!0}),e.isOpenFromJson||(this.parent.trigger("openComplete",{response:e}),this.parent.notify(Pa,{response:e,action:"import"})),this.parent.isProtected&&this.parent.showSheetTabs&&e.isOpenFromJson&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled")),this.parent.renderModule.refreshSheet(e.isOpenFromJson,!1,!1,!1,e),this.parent.notify(ri,null),this.isImportedFile=!0,e.context.preventFormatCheck=e.eventArgs&&e.eventArgs.file&&e.eventArgs.file.name&&!e.eventArgs.file.name.includes(".csv"),this.unProtectSheetIdx=[],this.parent.hideSpinner())},t.prototype.openFailed=function(e){this.parent.trigger("openFailure",e),this.parent.hideSpinner()},t.prototype.sheetsDestroyHandler=function(t){(0,e.isNullOrUndefined)(t.sheetIndex)&&(this.isImportedFile=!1,this.unProtectSheetIdx=[])},t.prototype.destroy=function(){this.removeEventListener();var t=(0,e.select)("#"+this.parent.element.id+"_fileUpload",this.parent.element);t&&(0,e.detach)(t),this.isImportedFile=null,this.unProtectSheetIdx=null,this.parent=null},t.prototype.getModuleName=function(){return"open"},t}(),Zh=function(){function t(e){this.parent=e,this.addEventListener()}return t.prototype.destroy=function(){this.removeEventListener(),this.parent=null},t.prototype.addEventListener=function(){this.parent.on(X,this.initiateSave,this),this.parent.on(ee,this.saveCompleted,this),this.parent.on(jt,this.showErrorDialog,this),this.parent.on(J,this.exportDialog,this)},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(X,this.initiateSave),this.parent.off(ee,this.saveCompleted),this.parent.off(jt,this.showErrorDialog),this.parent.off(J,this.exportDialog))},t.prototype.getModuleName=function(){return"save"},t.prototype.initiateSave=function(){this.parent.showSpinner()},t.prototype.saveCompleted=function(){this.parent.hideSpinner()},t.prototype.showErrorDialog=function(e){var t=this;this.parent.serviceLocator.getService(Ll).show({isModal:!0,showCloseIcon:!0,height:180,width:400,content:e.content,beforeOpen:function(){return Md(t.parent.element)}})},t.prototype.exportDialog=function(t){var r=this,n=this.parent.serviceLocator.getService(Dl),i=this.parent.serviceLocator.getService(Ll),a=t?t.item.id.split(this.parent.element.id+"_")[1]:"xlsx";if((0,e.isNullOrUndefined)(this.parent.element.querySelector(".e-open-dlg"))){var o={isModal:!0,showCloseIcon:!0,cssClass:"e-open-dlg",header:n.getConstant("SaveAs"),beforeOpen:function(e){var t={dialogName:n.getConstant("SaveAs"),element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel?e.cancel=!0:(i.dialogInstance.content=r.OpenContent(a),i.dialogInstance.dataBind(),r.parent.element.querySelector(".e-text-open").setSelectionRange(0,r.parent.element.querySelector(".e-text-open").value.length),Md(r.parent.element))},buttons:[{buttonModel:{content:n.getConstant("Save"),isPrimary:!0,cssClass:"e-btn-open-ok"},click:function(){var n=r.parent.element.querySelector(".e-text-open").value;if(r.checkValidName(n)){i.hide();var a=t?t.item.id.split(r.parent.element.id+"_")[1]:"Xlsx";r.parent.save({saveType:a,fileName:n})}else{var o=r.parent.element.querySelector(".e-btn-open-ok");(0,e.getComponent)(o,"btn").disabled=!0;var s=r.parent.serviceLocator.getService(Dl),l=0===n.length?s.getConstant("EmptyFileName"):n.length>218?s.getConstant("LargeName"):s.getConstant("FileNameError"),d=r.parent.createElement("span",{className:"e-file-alert-span"});d.innerText=l,r.parent.element.querySelector(".e-file-alert-span")&&r.parent.element.querySelector(".e-file-alert-span").remove(),r.parent.element.querySelector(".e-open-dlg").querySelector(".e-dlg-content").appendChild(d)}}}]};i.show(o)}else i.hide()},t.prototype.checkValidName=function(e){var t=!0;return(e.match(new RegExp('.*[\\[\\]\\*\\\\/\\?\\:\\<\\>\\|\\"].*'))||e.length<1||e.length>218)&&(t=!1),t},t.prototype.OpenContent=function(t){var r=this,n=this.parent.serviceLocator.getService(Dl),i=this.parent.createElement("div",{className:"e-open-dialog"}),a=this.parent.createElement("div",{className:"e-open-head"}),o=this.parent.createElement("div",{className:"e-input-group"});i.appendChild(a),i.appendChild(o);var s=n.getConstant("FileName"),l=this.parent.element.id+"_filename",d=this.parent.createElement("p",{className:"e-header",id:l,attrs:{"aria-label":n.getConstant("SaveAs")+" "+s}});d.innerText=s;var h=this.parent.createElement("input",{className:"e-input e-text-open",attrs:{type:"Text","aria-labelledby":l}}),p=this.parent.createElement("span",{className:"e-input-group-icon"});return h.onkeyup=function(t){if(r.parent.element.querySelector(".e-file-alert-span")&&13!==t.keyCode){var n=r.parent.element.querySelector(".e-btn-open-ok");(0,e.getComponent)(n,"btn").disabled=!1,r.parent.element.querySelector(".e-file-alert-span").remove()}},a.appendChild(d),p.textContent="."+t.toLowerCase(),o.appendChild(h),h.setAttribute("value","Sample"),o.appendChild(p),i},t}(),Jh=function(){function n(e){this.parent=e,this.init()}return n.prototype.init=function(){this.initContextMenu(),this.addEventListener()},n.prototype.initContextMenu=function(){var e=document.createElement("ul");e.id=this.parent.element.id+"_contextmenu",this.parent.element.appendChild(e),this.contextMenuInstance=new vh.ContextMenu({cssClass:"e-spreadsheet-contextmenu",target:"#"+this.parent.element.id,select:this.selectHandler.bind(this),beforeOpen:this.beforeOpenHandler.bind(this),beforeClose:this.beforeCloseHandler.bind(this),beforeItemRender:function(e){e.element.setAttribute("aria-label",e.item.text)}},e),e.setAttribute("role","menu")},n.prototype.beforeCloseHandler=function(e){var t=this;this.parent.trigger("contextMenuBeforeClose",e),this.parent.enableKeyboardShortcut&&e.event&&27===e.event.keyCode&&zl((function(){return Md(t.parent.element)}))},n.prototype.selectHandler=function(n){var i=(0,e.extend)({cancel:!1},n);this.parent.trigger("contextMenuItemSelect",i);var a,s=this.parent.element.id+"_cmenu",l=t(this.parent.getActiveSheet().selectedRange),d=[];if((n.item.id===s+"_ascending"||n.item.id===s+"_descending")&&this.parent.sortCollection)for(var h=this.parent.sortCollection.length-1;h>=0;h--)this.parent.sortCollection[h]&&this.parent.sortCollection[h].sheetIndex===this.parent.activeSheetIndex&&(d.push(this.parent.sortCollection[h]),this.parent.sortCollection.splice(h,1));if(n.item.id===s+"_delete_row"||n.item.id===s+"_delete_column"||n.item.id===s+"_insert_column_before"||n.item.id===s+"_insert_column_after"||n.item.id===s+"_insert_row_above"||n.item.id===s+"_insert_row_below"){var p=fl(this.parent.getActiveSheet(),l[0]),u=Il(this.parent.getActiveSheet(),l[1]);if(p&&!p.isReadOnly&&u&&!u.isReadOnly&&Qr(this.parent,l))return void this.parent.notify(to,null)}if(n.item.id===s+"_ascending"||n.item.id===s+"_descending"||n.item.id===s+"_customsort"){var f=zr(l[0],l[1],this.parent.getActiveSheet());if(Qr(this.parent,f))return void this.parent.notify(to,null)}if(!i.cancel){var g=void 0;switch(n.item.id){case s+"_cut":this.parent.notify(Li,{invokeCopy:!0,promise:Promise});break;case s+"_copy":this.parent.notify(Pi,{invokeCopy:!0,promise:Promise});break;case s+"_paste":this.parent.notify(Mi,{isAction:!0,isInternal:!0,focus:!0});break;case s+"_pastevalues":this.parent.notify(Mi,{type:"Values",isAction:!0,isInternal:!0,focus:!0});break;case s+"_pasteformats":this.parent.notify(Mi,{type:"Formats",isAction:!0,isInternal:!0,focus:!0});break;case s+"_rename":this.parent.notify(Ri,{});break;case s+"_delete_sheet":this.parent.notify(Ni,{}),Md(this.parent.element);break;case s+"_insert_sheet":this.parent.notify($e,{model:this.parent,start:this.parent.activeSheetIndex,end:this.parent.activeSheetIndex,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex});break;case s+"_hide_sheet":this.parent.notify(Sa,{sheetIndex:this.parent.activeSheetIndex,triggerEvent:!0});break;case s+"_duplicate":Bn(this.parent,void 0,!0),Md(this.parent.element);break;case s+"_move_right":Mn(this.parent,this.parent.activeSheetIndex+1,null,!0),Md(this.parent.element);break;case s+"_move_left":Mn(this.parent,this.parent.activeSheetIndex-1,null,!0),Md(this.parent.element);break;case s+"_ascending":this.parent.notify(Cr,{sortOptions:{sortDescriptors:{order:"Ascending"}}}),this.parent.notify(ia,{sortOptions:{sortDescriptors:{order:"Ascending"}},previousSort:d});break;case s+"_descending":this.parent.notify(Cr,{sortOptions:{sortDescriptors:{order:"Descending"}}}),this.parent.notify(ia,{sortOptions:{sortDescriptors:{order:"Descending"}},previousSort:d});break;case s+"_customsort":this.parent.notify(na,null);break;case s+"_filtercellvalue":this.parent.notify(Ta,null);break;case s+"_clearfilter":a=o(r(this.parent.getActiveSheet().activeCell)[1]+1),this.parent.notify(Da,{field:a});break;case s+"_reapplyfilter":this.parent.notify(Fa,null);break;case s+"_hide_row":g=t(this.parent.getActiveSheet().selectedRange),this.parent.notify(Rt,{startIndex:g[0],endIndex:g[2],hide:!0,isCol:!1,actionUpdate:!0});break;case s+"_unhide_row":g=t(this.parent.getActiveSheet().selectedRange),this.parent.notify(Rt,{startIndex:g[0],endIndex:g[2],hide:!1,isCol:!1,actionUpdate:!0});break;case s+"_hide_column":g=t(this.parent.getActiveSheet().selectedRange),this.parent.notify(Rt,{startIndex:g[1],endIndex:g[3],hide:!0,isCol:!0,actionUpdate:!0});break;case s+"_unhide_column":g=t(this.parent.getActiveSheet().selectedRange),this.parent.notify(Rt,{startIndex:g[1],endIndex:g[3],hide:!1,isCol:!0,actionUpdate:!0});break;case s+"_insert_row_above":case s+"_delete_row":g=t(this.parent.getActiveSheet().selectedRange),this.parent.notify(n.item.id.substr(s.length+1,6)+"Model",{model:this.parent.getActiveSheet(),start:g[0],end:g[2],modelType:"Row",isAction:!0,insertType:"above"});break;case s+"_insert_row_below":g=c(t(this.parent.getActiveSheet().selectedRange)),this.parent.notify($e,{model:this.parent.getActiveSheet(),start:g[2]+1,end:g[2]+1+(g[2]-g[0]),modelType:"Row",isAction:!0,insertType:"below"});break;case s+"_insert_column_before":case s+"_delete_column":g=t(this.parent.getActiveSheet().selectedRange),this.parent.notify(n.item.id.substr(s.length+1,6)+"Model",{model:this.parent.getActiveSheet(),start:g[1],end:g[3],modelType:"Column",isAction:!0,insertType:"before"});break;case s+"_insert_column_after":g=c(t(this.parent.getActiveSheet().selectedRange)),this.parent.notify($e,{model:this.parent.getActiveSheet(),start:g[3]+1,end:g[3]+1+(g[3]-g[1]),modelType:"Column",isAction:!0,insertType:"after"});break;case s+"_addNote":this.parent.notify(ca,null);break;case s+"_editNote":this.parent.notify(ua,null);break;case s+"_deleteNote":this.parent.notify(fa,{rowIndex:null,columnIndex:null,isDeleteFromMenu:!0});break;case s+"_hyperlink":this.parent.notify(da,null);break;case s+"_editHyperlink":this.parent.notify(ha,null);break;case s+"_openHyperlink":this.parent.notify(pa,null);break;case s+"_removeHyperlink":this.parent.notify(Ca,{range:this.parent.getActiveSheet().selectedRange});break;case s+"_protect":this.parent.notify(cs,{})}}},n.prototype.getInsertModel=function(e,t){for(var r=[],n=e;n<=t;n++)n===e?r.push({index:n}):r.push({});return r},n.prototype.beforeOpenHandler=function(r){for(var n,i,a,o=r.event.target,s=["e-numericcontainer","e-active-cell","e-selection","e-row","e-header-row","e-select-all-cell","e-sheet-tabs-items","e-spreadsheet-contextmenu"],l=0,d=s.length;l<d;l++)if((0,e.closest)(o,"."+s[l])){n=!0;break}if(n)i=this.getTarget(o);else{if((n=["e-header-cell","e-rowhdr-table","e-selectall-table","e-main-panel"].some((function(e){return o.classList.contains(e)})))&&(parseInt(o.parentElement.style.zIndex,10)>1||parseInt(o.parentElement.parentElement.style.zIndex,10)>1)){var h=r.event,p={clientY:h.clientY,isImage:!1,target:o},c={clientX:h.clientX,isImage:!1,target:o};this.parent.notify(No,p),this.parent.notify(Ro,c),i=p.size<=0?"ColumnHeader":c.size<=0?"RowHeader":"Content"}else n=!1}if(n){if(r.element.classList.contains("e-contextmenu")){var u=this.parent.getActiveSheet();if(r.event.target&&(o.classList.contains("e-rowresize")||o.classList.contains("e-colresize"))){var f=t(u.selectedRange);if(!(o.classList.contains("e-rowresize")?0===f[1]&&f[3]===u.colCount-1:0===f[0]&&f[2]===u.rowCount-1))return void(r.cancel=!0);a=(o.classList.contains("e-rowresize")?this.parent.hiddenCount(f[0],f[2])!==Math.abs(f[2]-f[0])+1:this.parent.hiddenCount(f[1],f[3],"columns")!==Math.abs(f[3]-f[1])+1)?this.getDataSource(i):this.getDataSource(i,o)}else{if("Content"===i){var g=0===(f=t(u.selectedRange))[1]&&f[3]===u.colCount-1,m=0===f[0]&&f[2]===u.rowCount-1;i=g&&m?"SelectAll":g?"RowHeader":m?"ColumnHeader":"Content"}a=this.getDataSource(i,"Footer"===i?o:void 0)}this.contextMenuInstance.items=a,this.contextMenuInstance.dataBind()}else a=r.items;if("None"===this.parent.selectionSettings.mode&&"Content"===i&&this.parent.enableContextMenuItems(["Filter"],!1,!1),"ColumnHeader"===i||"RowHeader"===i){if(r.element&&r.element.childElementCount>0){var v="ColumnHeader"===i?r.element.querySelector("#"+this.parent.element.id+"_cmenu_insert_column"):r.element.querySelector("#"+this.parent.element.id+"_cmenu_insert_row"),y="ColumnHeader"===i?r.element.querySelector("#"+this.parent.element.id+"_cmenu_delete_column"):r.element.querySelector("#"+this.parent.element.id+"_cmenu_delete_row");this.parent.allowInsert&&v.classList.contains("e-disabled")?v.classList.remove("e-disabled"):this.parent.allowInsert&&!this.parent.element.querySelector(".e-selectall.e-highlight")||v.classList.contains("e-disabled")||v.classList.add("e-disabled"),this.parent.allowDelete&&y.classList.contains("e-disabled")?y.classList.remove("e-disabled"):this.parent.allowDelete||y.classList.contains("e-disabled")||y.classList.add("e-disabled"),"None"===this.parent.selectionSettings.mode&&("ColumnHeader"===i&&this.parent.enableContextMenuItems(["Insert Column","Delete Column","Hide Column"],!1,!1),"RowHeader"===i&&this.parent.enableContextMenuItems(["Insert Row","Delete Row","Hide Row"],!1,!1))}}else if("Footer"===i){var C=In(this.parent,o.textContent);0===C&&r.element.querySelector("#"+this.parent.element.id+"_cmenu_move_left").classList.add("e-disabled"),C===this.parent.sheets.length-1&&r.element.querySelector("#"+this.parent.element.id+"_cmenu_move_right").classList.add("e-disabled"),"None"===this.parent.selectionSettings.mode&&this.parent.enableContextMenuItems(["Insert"],!1,!1),this.parent.allowDelete||this.parent.enableContextMenuItems(["Delete"],!1,!1)}this.parent.notify(Ii,(0,e.extend)(r,{target:i,items:a})),this.parent.trigger("contextMenuBeforeOpen",r)}else r.cancel=!0},n.prototype.getTarget=function(t){return(0,e.closest)(t,".e-sheet-content")?"Content":(0,e.closest)(t,".e-column-header")?t.classList.contains("e-header-cell")?"ColumnHeader":"Content":(0,e.closest)(t,".e-row-header")?t.classList.contains("e-header-cell")?"RowHeader":"Content":(0,e.closest)(t,".e-sheet-tabs-items")?"Footer":(0,e.closest)(t,".e-selectall-container")?t.classList.contains("e-header-cell")?(0,e.closest)(t,".e-header-row")?"ColumnHeader":"RowHeader":(0,e.closest)(t,".e-select-all-cell")?"SelectAll":"Content":""},n.prototype.getDataSource=function(e,r){var n=this.parent.serviceLocator.getService(Dl),i=[],a=this.parent.element.id+"_cmenu";if("Content"===e)this.setClipboardData(i,n,a),i.push({separator:!0}),this.setFilterItems(i,a),this.setSortItems(i,a),i.push({separator:!0}),this.parent.enableNotes&&(this.setNotesMenu(i,a),i.push({separator:!0})),this.setHyperLink(i,a);else if("RowHeader"===e){this.setClipboardData(i,n,a);var o=t(this.parent.getActiveSheet().selectedRange);this.setInsertDeleteItems(i,n,"Row",a,[o[0],o[2]],["Above","Below"]),r&&!r.classList.contains("e-rowresize")&&r.parentElement&&r.parentElement.classList.value.includes("e-hide")||this.setHideShowItems(i,n,"Row",a,[o[0],o[2]])}else if("ColumnHeader"===e){this.setClipboardData(i,n,a);o=t(this.parent.getActiveSheet().selectedRange);this.setInsertDeleteItems(i,n,"Column",a,[o[1],o[3]],["Before","After"]),r&&r.classList.value.includes("e-hide")||this.setHideShowItems(i,n,"Column",a,[o[1],o[3]])}else"SelectAll"===e?(this.setClipboardData(i,n,a),this.setFilterItems(i,a),this.setSortItems(i,a)):"Footer"===e&&(i.push({text:n.getConstant("Insert"),id:a+"_insert_sheet"}),i.push({text:n.getConstant("Delete"),iconCss:"e-icons e-delete",id:a+"_delete_sheet"}),i.push({text:n.getConstant("DuplicateSheet"),id:a+"_duplicate"}),i.push({text:n.getConstant("Rename"),id:a+"_rename"}),i.push({text:n.getConstant("Hide"),id:a+"_hide_sheet"}),this.setProtectSheetItems(i,a,r),i.push({text:n.getConstant("MoveRight"),id:a+"_move_right"}),i.push({text:n.getConstant("MoveLeft"),id:a+"_move_left"}));return i},n.prototype.setProtectSheetItems=function(e,t,r){var n=this.parent.serviceLocator.getService(Dl);Fn(this.parent,In(this.parent,r.textContent)).isProtected?e.push({text:n.getConstant("UnprotectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"}):e.push({text:n.getConstant("ProtectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"})},n.prototype.setFilterItems=function(e,t){if(this.parent.allowFiltering){var r=this.parent.serviceLocator.getService(Dl),n={clearFilterText:null,isFiltered:!1};this.parent.notify(La,n),e.push({text:r.getConstant("Filter"),id:t+"_filter",iconCss:"",items:[{text:n.clearFilterText,iconCss:"e-icons e-filter-clear",id:t+"_clearfilter"},{text:r.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:t+"_reapplyfilter"},{separator:!0},{text:r.getConstant("FilterCellValue"),iconCss:"",id:t+"_filtercellvalue"}]})}},n.prototype.setSortItems=function(e,t){var r=this.parent.serviceLocator.getService(Dl);this.parent.allowSorting&&e.push({text:r.getConstant("Sort"),id:t+"_sort",iconCss:"e-icons e-sort-icon",items:[{text:r.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc",id:t+"_ascending"},{text:r.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc",id:t+"_descending"},{text:r.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom",id:t+"_customsort"}]})},n.prototype.setHyperLink=function(t,n){if(this.parent.allowHyperlink){var i=this.parent.serviceLocator.getService(Dl),a=r(this.parent.getActiveSheet().activeCell),o=this.parent.getCell(a[0],a[1]);(0,e.isNullOrUndefined)(o)?t.push({text:i.getConstant("Hyperlink"),iconCss:"e-icons e-hyperlink-icon",id:n+"_hyperlink"}):o.getElementsByClassName("e-hyperlink")[0]||o.classList.contains("e-hyperlink")?t.push({text:i.getConstant("EditHyperlink"),iconCss:"e-icons e-edithyperlink-icon",id:n+"_editHyperlink"},{text:i.getConstant("OpenHyperlink"),iconCss:"e-icons e-openhyperlink-icon",id:n+"_openHyperlink"},{text:i.getConstant("RemoveHyperlink"),iconCss:"e-icons e-removehyperlink-icon",id:n+"_removeHyperlink"}):t.push({text:i.getConstant("Hyperlink"),iconCss:"e-icons e-hyperlink-icon",id:n+"_hyperlink"})}},n.prototype.setNotesMenu=function(t,n){if(this.parent.enableNotes){var i=this.parent.serviceLocator.getService(Dl),a=r(this.parent.getActiveSheet().activeCell),o=this.parent.getCell(a[0],a[1]);!(0,e.isNullOrUndefined)(o)&&o.children.length>0&&o.children[o.children.length-1].className.indexOf("addNoteIndicator")>-1?t.push({text:i.getConstant("EditNote"),iconCss:"e-icons e-edit-notes",id:n+"_editNote"},{text:i.getConstant("DeleteNote"),iconCss:"e-icons e-delete-notes",id:n+"_deleteNote"}):t.push({text:i.getConstant("AddNote"),iconCss:"e-icons e-add-notes",id:n+"_addNote"})}},n.prototype.setClipboardData=function(e,t,r){this.parent.enableClipboard&&(e.push({text:t.getConstant("Cut"),iconCss:"e-icons e-cut-icon",id:r+"_cut"}),e.push({text:t.getConstant("Copy"),iconCss:"e-icons e-copy-icon",id:r+"_copy"}),e.push({text:t.getConstant("Paste"),iconCss:"e-icons e-paste-icon",id:r+"_paste"}),e.push({text:t.getConstant("PasteSpecial"),id:r+"_pastespecial",items:[{text:t.getConstant("Values"),id:r+"_pastevalues"},{text:t.getConstant("Formats"),id:r+"_pasteformats"}]}))},n.prototype.setInsertDeleteItems=function(e,t,r,n,i,a){e.push({separator:!0}),["Insert","Delete"].forEach((function(o){i[0]===i[1]?e.push({text:t.getConstant(""+o+r),id:n+"_"+o.toLowerCase()+"_"+r.toLowerCase()}):e.push({text:t.getConstant(""+o+r+"s"),id:n+"_"+o.toLowerCase()+"_"+r.toLowerCase()}),"Insert"===o&&(e[e.length-1].items=[],a.forEach((function(r){e[e.length-1].items.push({text:t.getConstant(r),id:e[e.length-1].id+"_"+r.toLowerCase()})})))}))},n.prototype.setHideShowItems=function(e,t,r,n,i){if(i[0]===i[1])e.push({text:t.getConstant("Hide"+r),id:n+"_hide_"+r.toLowerCase()});else{var a=i[0];i[0]=i[0]>i[1]?i[1]:i[0],i[1]=i[1]>a?i[1]:a,e.push({text:t.getConstant("Hide"+r+"s"),id:n+"_hide_"+r.toLowerCase()})}this.parent.hiddenCount(i[0],i[1],r.toLowerCase()+"s")&&e.push({text:t.getConstant("Unhide"+r+"s"),id:n+"_unhide_"+r.toLowerCase()})},n.prototype.addEventListener=function(){this.parent.on(Vi,this.addItemsHandler,this),this.parent.on(zi,this.removeItemsHandler,this),this.parent.on(ji,this.enableItemsHandler,this)},n.prototype.addItemsHandler=function(e){e.insertAfter?this.contextMenuInstance.insertAfter(e.items,e.text,e.isUniqueId):this.contextMenuInstance.insertBefore(e.items,e.text,e.isUniqueId)},n.prototype.removeItemsHandler=function(e){this.contextMenuInstance.removeItems(e.items,e.isUniqueId)},n.prototype.enableItemsHandler=function(e){this.contextMenuInstance.enableItems(e.items,e.enable,e.isUniqueId)},n.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Vi,this.addItemsHandler),this.parent.off(zi,this.removeItemsHandler),this.parent.off(ji,this.enableItemsHandler))},n.prototype.getModuleName=function(){return"contextMenu"},n.prototype.destroy=function(){this.removeEventListener(),this.contextMenuInstance.destroy();var t=document.getElementById(this.parent.element.id+"_contextmenu");t&&(0,e.detach)(t),this.contextMenuInstance=null,this.parent=null},n}(),Qh=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.refreshCellElement=function(e){this.parent.refreshNode(e.td,e)},e.prototype.getTextSpace=function(e){e.width=Ad(e.char,e.cell.style,this.parent.cellStyle)},e.prototype.rowFillHandler=function(e){var t=e.cellEle;if(t){var r=void 0,n=e.colIdx;if(e.cell.colSpan>1){var i={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(Et,i),n=i.range[3]}var a=Td(this.parent.getActiveSheet(),e.rowIdx,e.colIdx,n),o=e.iconSetSpan||t.querySelector(".e-iconsetspan");if(o&&(a-=o.getBoundingClientRect().width),e.updateFillSize){if(!(r=t.querySelector(".e-fill"))||!r.textContent)return;e.repeatChar=r.textContent[0],(s=t.querySelector(".e-fill-before"))&&(a-=Ad(s.textContent,e.cell.style,this.parent.cellStyle)),(l=t.querySelector(".e-fill-sec"))&&(a-=Ad(l.textContent,e.cell.style,this.parent.cellStyle))}else{var s,l,d=t.querySelector(".e-addNoteIndicator");if(t.innerText="",e.beforeFillText)(s=this.parent.createElement("span",{className:"e-fill-before",styles:"float: "+(this.parent.enableRtl?"right":"left")})).innerText=e.beforeFillText,t.appendChild(s),a-=Ad(e.beforeFillText,e.cell.style,this.parent.cellStyle);if(r=this.parent.createElement("span",{className:"e-fill"}),t.appendChild(r),e.afterFillText)(l=this.parent.createElement("span",{className:"e-fill-sec"})).innerText=e.afterFillText,t.appendChild(l),a-=Ad(e.afterFillText,e.cell.style,this.parent.cellStyle);o&&t.insertBefore(o,t.childNodes[0]),d&&t.appendChild(d)}var h=Ad(e.repeatChar,e.cell.style,this.parent.cellStyle),p=parseInt((a/h).toString(),10);e.formattedText=p>0?e.repeatChar.repeat(p):"",r.textContent=e.formattedText}},e.prototype.addEventListener=function(){this.parent.on(ie,this.refreshCellElement,this),this.parent.on(Jt,this.rowFillHandler,this),this.parent.on(Qt,this.getTextSpace,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ie,this.refreshCellElement),this.parent.off(Jt,this.rowFillHandler),this.parent.off(Qt,this.getTextSpace))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"numberFormat"},e}(),ep=function(){function r(e){this.parent=e,this.addEventListener()}return r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.addEventListener=function(){this.parent.on(ia,this.applySortHandler,this),this.parent.on(Te,this.sortCompleteHandler,this),this.parent.on(na,this.initiateCustomSortHandler,this),this.parent.on($,this.sortImport,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ia,this.applySortHandler),this.parent.off(Te,this.sortCompleteHandler),this.parent.off(na,this.initiateCustomSortHandler),this.parent.off($,this.sortImport))},r.prototype.getModuleName=function(){return"sort"},r.prototype.isValidSortRange=function(){var e=this.parent.getActiveSheet(),t=c(s(e.selectedRange));return!(t[0]>e.usedRange.rowIndex||t[1]>e.usedRange.colIndex)},r.prototype.sortImport=function(e){for(var t,r=this.parent.sortCollection,n=this.parent.getActiveSheet().usedRange.rowIndex-1,i=e?e.sheetIdx:this.parent.activeSheetIndex,a=0;a<r.length;a++)if(r[a].sheetIndex===i)for(var o=0;o<n;o++)if((t=this.parent.getCell(o,r[a].columnIndex))&&t.querySelector(".e-filter-icon"))return void("Ascending"===r[a].order||"OnTop"===r[a].order?t.querySelector(".e-filter-icon").classList.contains("e-sortasc-filter")||t.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"):t.querySelector(".e-filter-icon").classList.contains("e-sortdesc-filter")||t.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter"))},r.prototype.sortRangeAlertHandler=function(e){var t=this,r=this.parent.serviceLocator.getService(Ll),n=this.parent.serviceLocator.getService(Dl);r.show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:e.error,beforeOpen:function(i){var a={dialogName:e.error===n.getConstant("MultiRangeSortError")?"MultiRangeSortDialog":"SortRangeDialog",content:e.error,element:i.element,target:i.target,cancel:i.cancel};t.parent.trigger("dialogBeforeOpen",a),a.cancel?i.cancel=!0:(r.dialogInstance.content=a.content,Md(t.parent.element))}}),this.parent.hideSpinner()},r.prototype.initiateCustomSortHandler=function(){var t=this,r=this.parent.serviceLocator.getService(Dl),n=this.parent.getActiveSheet();if(this.isValidSortRange()&&0!==n.rows.length)if(Hd(n.selectedRange))this.sortRangeAlertHandler({error:r.getConstant("MultiRangeSortError")});else{var i,a=this.parent.serviceLocator.getService(Ll);a.show({height:400,width:560,isModal:!0,showCloseIcon:!0,cssClass:"e-customsort-dlg",header:r.getConstant("CustomSort"),beforeOpen:function(e){var r={dialogName:"CustomSortDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel?e.cancel=!0:(a.dialogInstance.content=t.customSortContent(),a.dialogInstance.dataBind(),Md(t.parent.element))},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0},click:function(){var r=a.dialogInstance.content,n=(0,e.getComponent)(r.getElementsByClassName("e-list-sort e-listview e-lib")[0],"listview").dataSource;t.clearError();var o=r.getElementsByClassName("e-sort-error")[0];o.style.display="block",t.validateError(n,r,o)||(i={sortDescriptors:n,containsHeader:r.getElementsByClassName("e-sort-checkheader")[0].checked,caseSensitive:r.getElementsByClassName("e-sort-checkcase")[0].checked},a.hide())}}],close:function(){i&&zl((function(){return t.applySortHandler({sortOptions:i})}))}})}else this.sortRangeAlertHandler({error:r.getConstant("SortOutOfRangeError")})},r.prototype.validateError=function(t,r,n){var i=this.parent.serviceLocator.getService(Dl);if(t.some((function(e){return""===e.field.toString()})))return Array.prototype.some.call(r.getElementsByClassName("e-sort-field"),(function(t){var r=!(0,e.getComponent)(t,"dropdownlist").value;return r&&t.parentElement.classList.add("e-error"),r})),n.innerText=i.getConstant("SortEmptyFieldError"),!0;var a=new Set,o="",s=t.some((function(e){return o=e.field.toString(),a.size===a.add(e.field).size})),l="";if(s){var d=0;Array.prototype.some.call(r.getElementsByClassName("e-sort-field"),(function(t){var r=(0,e.getComponent)(t,"dropdownlist");return r.value===o&&(t.parentElement.classList.add("e-error"),l=r.text,d++),2===d})),n.innerText="";var h=this.parent.createElement("strong");return h.innerText=l,n.appendChild(h),n.appendChild(document.createTextNode(i.getConstant("SortDuplicateFieldError"))),!0}return!1},r.prototype.customSortContent=function(){var t=this.parent.createElement("div",{className:"e-sort-dialog"}),r=this.getFields(),n=(0,e.getUniqueID)("customSort"),i=this.getCustomListview(n);this.setHeaderTab(t,i,r);var a=this.parent.createElement("div",{className:"e-sort-listsection",styles:""});t.appendChild(a);var o=this.parent.createElement("div",{className:"e-list-sort",styles:""});a.appendChild(o),i.createElement=this.parent.createElement,i.appendTo(o),o.removeAttribute("tabindex"),this.renderListItem(n,i,!0,r);var s=this.parent.createElement("div",{className:"e-sort-error"});return t.appendChild(s),t},r.prototype.getFields=function(){var e=this.parent.getActiveSheet(),t=c(s(e.selectedRange));if(t[0]===t[2]&&t[2]-t[0]===0){t[0]=0,t[1]=0,t[3]=e.usedRange.colIndex;var r={filterRange:[],hasFilter:!1};this.parent.notify(Ba,r),r.hasFilter&&r.filterRange&&(t[0]=r.filterRange[0])}var n,i,a=[];for(t[1];t[1]<=t[3];t[1]++){var l=zn(t[0],t[1],e);if(i="Column "+o(t[1]+1),l&&l.value){if(n=l.value,l.format){var d={formattedText:n,value:n,format:l.format,rowIndex:t[0],colIndex:t[1]};this.parent.notify(re,d),n=d.formattedText}}else n=i;a.push({text:n,value:i})}return a},r.prototype.setHeaderTab=function(t,r,n){var i=this,a=this.parent.serviceLocator.getService(Dl),o=this.parent.createElement("div",{className:"e-sort-header"});t.appendChild(o);var s=this.parent.createElement("button",{className:"e-btn e-sort-addbtn e-flat",attrs:{type:"button"}});s.innerText=a.getConstant("AddColumn");var l=this.parent.element.querySelector(".e-customsort-dlg .e-footer-content");l.insertBefore(s,l.firstElementChild),s.addEventListener("click",(function(){if(r){var t=(0,e.getUniqueID)("customSort");r.addItem([{id:t,text:a.getConstant("ThenBy"),field:"",order:"ascending"}]),i.renderListItem(t,r,d.checked,n,!0)}}));var d=new Eh.CheckBox({label:a.getConstant("ContainsHeader"),checked:!0,change:function(r){var i=r.checked?{text:"text",value:"value"}:{text:"value"};Array.prototype.forEach.call(t.getElementsByClassName("e-sort-field e-dropdownlist e-lib"),(function(t){var r=(0,e.getComponent)(t,"dropdownlist");r.dataSource=null,r.dataSource=n,r.fields=i,r.dataBind()}))},cssClass:"e-sort-headercheckbox"}),h=this.parent.createElement("input",{className:"e-sort-checkheader",attrs:{type:"checkbox"}});o.appendChild(h),d.createElement=this.parent.createElement,d.appendTo(h);var p=new Eh.CheckBox({label:a.getConstant("CaseSensitive"),checked:!1,cssClass:"e-sort-casecheckbox"}),c=this.parent.createElement("input",{className:"e-sort-checkcase",attrs:{type:"checkbox"}});o.appendChild(c),p.createElement=this.parent.createElement,p.appendTo(c)},r.prototype.getCustomListview=function(t){var r=[{id:t,text:this.parent.serviceLocator.getService(Dl).getConstant("SortBy"),field:"",order:"ascending"}];(0,e.enableRipple)(!1);var n=new Ah.ListView({dataSource:r,fields:{id:"id"},height:"100%",template:(0,e.initializeCSPTemplate)((function(e){return'<div class="e-sort-listwrapper"><span class="text">'+e.text+'</span><div class="e-sort-row"><div class="e-sort-field"></div><div class="e-sort-order"><span class="e-sort-ordertxt" style="display:none;">'+e.order+'</span></div><span class="e-icons e-sort-delete" tabindex="0"></span></div>'})),cssClass:"e-sort-template"});return n},r.prototype.deleteHandler=function(e,t){e.getElementsByClassName("e-sort-delete")[0].addEventListener("click",(function(){e&&t.removeItem(e)}))},r.prototype.renderListItem=function(e,t,r,n,i){var a=this,o=this.parent.serviceLocator.getService(Dl),s=t.element.querySelector("li[data-uid="+e+"]"),l=r?{text:"text",value:"value"}:{text:"value"},d=s.getElementsByClassName("e-sort-field")[0],h=new Nh.DropDownList({dataSource:n,width:"auto",cssClass:"e-sort-field-ddl",fields:l,placeholder:o.getConstant("SelectAColumn"),change:function(r){r.value&&(Array.prototype.some.call(t.dataSource,(function(t){return t.id===e&&(t.field=r.value.toString().replace("Column ","")),t.id===e})),a.clearError())}});h.createElement=this.parent.createElement,h.appendTo(d),i||(h.index=0);var p=s.getElementsByClassName("e-sort-order")[0],c="ascending"===p.getElementsByClassName("e-sort-ordertxt")[0].innerText.toLocaleLowerCase(),u=new Eh.RadioButton({label:o.getConstant("SortAscending"),name:"sortAZ_"+e,value:"ascending",checked:c,cssClass:"e-sort-radiobutton",change:function(r){a.setRadioBtnValue(t,e,r.value)}}),f=this.parent.createElement("input",{id:"orderAsc_"+e,className:"e-sort-radioasc",styles:"",attrs:{type:"radio"}});p.appendChild(f),u.createElement=this.parent.createElement,u.appendTo(f);var g=new Eh.RadioButton({label:o.getConstant("SortDescending"),name:"sortAZ_"+e,value:"descending",checked:!c,cssClass:"e-sort-radiobutton",change:function(r){a.setRadioBtnValue(t,e,r.value)}}),m=this.parent.createElement("input",{id:"orderDesc_"+e,className:"e-sort-radiodesc",styles:"",attrs:{type:"radio"}});p.appendChild(m),g.createElement=this.parent.createElement,g.appendTo(m),this.deleteHandler(s,t)},r.prototype.setRadioBtnValue=function(e,t,r){r&&Array.prototype.some.call(e.dataSource,(function(e){return e.id===t&&(e.order=r),e.id===t}))},r.prototype.clearError=function(){var e=document.getElementsByClassName("e-sort-dialog")[0],t=e.getElementsByClassName("e-sort-error")[0];"none"!==t.style.display&&""!==t.innerHTML&&(t.style.display="none",Array.prototype.forEach.call(e.getElementsByClassName("e-error"),(function(e){e.classList.remove("e-error")})))},r.prototype.applySortHandler=function(e){var t=this,r=this.parent.getActiveSheet(),n=e&&e.range||r.selectedRange,i=c(s(n)),o=e&&e.sortOptions||{sortDescriptors:{}},l=i[0]===i[2],d={filterRange:[],hasFilter:!1,sheetIdx:this.parent.activeSheetIndex};this.parent.notify(Ba,d),d.hasFilter&&(l?Ar(d.filterRange,i[0],i[1]):d.filterRange[0]===i[0]&&(this.parent.element.querySelector(".e-selectall.e-highlight")||i[1]>=d.filterRange[1]&&i[1]<=d.filterRange[3]||i[3]>=d.filterRange[1]&&i[3]<=d.filterRange[3]))&&(i[0]=d.filterRange[0],i[1]=d.filterRange[1],i[2]=r.usedRange.rowIndex,i[3]=r.usedRange.colIndex,o.containsHeader=!d.allowHeaderFilter,l=!1);var h={range:n=a(i),sortOptions:o,cancel:!1};if(this.parent.trigger(ke,h),!h.cancel){this.parent.notify(K,{eventArgs:h,action:"beforeSort"}),this.parent.showSpinner();var p=new Promise((function(e){e(void 0)})),u={args:{range:h.range,sortOptions:h.sortOptions,checkForHeader:l&&n!==h.range},promise:p,previousSort:e&&e.previousSort};this.parent.notify(Oe,u),u.promise.then((function(e){return t.sortCompleteHandler(e),t.parent.trigger(Te,e),t.parent.notify(Pa,{eventArgs:e,action:"sorting"}),"BODY"===document.activeElement.tagName&&Md(t.parent.element),Promise.resolve(e)})).catch((function(e){return t.sortRangeAlertHandler({error:e}),Promise.reject(e)}))}},r.prototype.sortCompleteHandler=function(e){var r,n,i=this.parent.activeSheetIndex;if(e.range.includes("!")){var a=e.range.lastIndexOf("!");i=In(this.parent,e.range.substring(0,a)),r=Fn(this.parent,i),n=t(e.range.substring(a+1))}else r=this.parent.getActiveSheet(),n=t(e.range);for(var o=n[0];o<=n[2];o++)for(var s=n[1];s<=n[3];s++)this.parent.notify(pe,{action:"refreshCalculate",rowIndex:o,colIndex:s});this.parent.serviceLocator.getService("cell").refreshRange(n,!0,!0,!1,!1,Kr(this.parent),void 0,void 0,void 0,!0),i===this.parent.activeSheetIndex&&r.conditionalFormats&&r.conditionalFormats.length&&this.parent.notify(kt,{indexes:n}),this.parent.hideSpinner(),this.parent.notify(Oa,null)},r}(),tp=u(707),rp=function(){function i(e){this.parent=e,this.filterCollection=new Map,this.filterRange=new Map,this.filterBtn=e.createElement("div",{className:"e-filter-btn e-control e-btn e-lib e-filter-iconbtn e-icon-btn"}),this.filterBtn.appendChild(e.createElement("span",{className:"e-btn-icon e-icons e-filter-icon"})),this.addEventListener()}return i.prototype.destroy=function(){var e=this;this.removeEventListener(),this.parent.refreshing&&this.filterRange.size&&(this.parent.filterCollection=[],this.filterRange.forEach((function(t,r){e.setFilteredCollection({sheetIdx:r,saveJson:{filterCollection:e.parent.filterCollection}})}))),this.filterRange=null,this.filterCollection=null,this.filterBtn&&this.filterBtn.remove(),this.filterBtn=null,this.treeViewObj&&this.treeViewObj.destroy(),this.treeViewObj=null,this.treeViewEle&&this.treeViewEle.remove(),this.treeViewEle=null,this.cBox&&(this.cBox.remove(),this.cBox=null);var t=document.querySelectorAll(".e-filter-popup");t&&t.forEach((function(e){e.remove()})),this.parent=null},i.prototype.addEventListener=function(){this.parent.on(qe,this.filterRangeAlertHandler,this),this.parent.on(Aa,this.initiateFilterUIHandler,this),this.parent.on(ai,this.filterMouseDownHandler,this),this.parent.on(ka,this.renderFilterCellHandler,this),this.parent.on(Oa,this.refreshFilterRange,this),this.parent.on(Cr,this.updateSortCollectionHandler,this),this.parent.on(tp.beforeFltrcMenuOpen,this.beforeFilterMenuOpenHandler,this),this.parent.on(tp.filterCmenuSelect,this.closeDialog,this),this.parent.on(Fa,this.reapplyFilterHandler,this),this.parent.on(Ta,this.filterByCellValueHandler,this),this.parent.on(Da,this.clearFilterHandler,this),this.parent.on(La,this.getFilteredColumnHandler,this),this.parent.on(Ii,this.cMenuBeforeOpenHandler,this),this.parent.on(tp.filterCboxValue,this.filterCboxValueHandler,this),this.parent.on(Ba,this.getFilterRangeHandler,this),this.parent.on(Ma,this.filterCellKeyDownHandler,this),this.parent.on(Q,this.setFilteredCollection,this),this.parent.on(ii,this.updateFilter,this),this.parent.on(qt,this.beforeInsertHandler,this),this.parent.on(Wt,this.beforeDeleteHandler,this),this.parent.on(xe,this.deleteSheetHandler,this),this.parent.on(Ft,this.clearHandler,this),this.parent.on(tp.filterDialogCreated,this.filterDialogCreatedHandler,this),this.parent.on(tp.filterDialogClose,this.removeFilterClass,this),this.parent.on(or,this.duplicateSheetFilterHandler,this),this.parent.on(tp.fltrPrevent,this.beforeFilteringHandler,this),this.parent.on(tp.beforeCustomFilterOpen,this.customFilterOpen,this),this.parent.on(mr,this.moveSheetHandler,this),this.parent.on(sa,this.refreshFilterCellsOnResize,this)},i.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(qe,this.filterRangeAlertHandler),this.parent.off(Aa,this.initiateFilterUIHandler),this.parent.off(ai,this.filterMouseDownHandler),this.parent.off(ka,this.renderFilterCellHandler),this.parent.off(Oa,this.refreshFilterRange),this.parent.off(Cr,this.updateSortCollectionHandler),this.parent.off(tp.beforeFltrcMenuOpen,this.beforeFilterMenuOpenHandler),this.parent.off(tp.filterCmenuSelect,this.closeDialog),this.parent.off(Fa,this.reapplyFilterHandler),this.parent.off(Ta,this.filterByCellValueHandler),this.parent.off(Da,this.clearFilterHandler),this.parent.off(La,this.getFilteredColumnHandler),this.parent.off(Ii,this.cMenuBeforeOpenHandler),this.parent.off(tp.filterCboxValue,this.filterCboxValueHandler),this.parent.off(Ba,this.getFilterRangeHandler),this.parent.off(Ma,this.filterCellKeyDownHandler),this.parent.off(Q,this.setFilteredCollection),this.parent.off(ii,this.updateFilter),this.parent.off(qt,this.beforeInsertHandler),this.parent.off(Wt,this.beforeDeleteHandler),this.parent.off(xe,this.deleteSheetHandler),this.parent.off(Ft,this.clearHandler),this.parent.off(tp.filterDialogCreated,this.filterDialogCreatedHandler),this.parent.off(tp.filterDialogClose,this.removeFilterClass),this.parent.off(or,this.duplicateSheetFilterHandler),this.parent.off(tp.fltrPrevent,this.beforeFilteringHandler),this.parent.off(tp.beforeCustomFilterOpen,this.customFilterOpen),this.parent.off(mr,this.moveSheetHandler),this.parent.off(sa,this.refreshFilterCellsOnResize))},i.prototype.getModuleName=function(){return"filter"},i.prototype.isInValidFilterRange=function(t,r){var n=c(s(r||t.selectedRange)),i=!1;return 0===t.usedRange.colIndex&&0===t.usedRange.rowIndex&&(0,e.isNullOrUndefined)(t.rows[t.usedRange.rowIndex])&&(i=!0),n[0]>t.usedRange.rowIndex||n[1]>t.usedRange.colIndex||i},i.prototype.filterRangeAlertHandler=function(e){var t=this;this.parent.serviceLocator.getService(Ll).show({content:e.error,isModal:!0,height:180,width:400,showCloseIcon:!0,beforeOpen:function(e){var r={dialogName:"FilterRangeDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel?e.cancel=!0:Md(t.parent.element)}}),this.parent.hideSpinner()},i.prototype.beforeFilterMenuOpenHandler=function(e){var t=this.parent.serviceLocator.getService(Dl);e.element.classList.add("e-spreadsheet-contextmenu");var r=e.element.querySelector("ul");this.addMenuItem(r,t.getConstant("SortDescending"),"e-filter-sortdesc","e-sort-desc"),this.addMenuItem(r,t.getConstant("SortAscending"),"e-filter-sortasc","e-sort-asc"),e.element.appendChild(r)},i.prototype.addMenuItem=function(e,t,r,n){var i=this.parent.createElement("li",{className:r+" e-menu-item"});this.parent.allowSorting||i.classList.add("e-disabled"),i.innerText=t,i.insertBefore(this.parent.createElement("span",{className:"e-menu-icon e-icons "+n}),i.firstChild),e.insertBefore(i,e.firstChild)},i.prototype.initiateFilterUIHandler=function(e){var r,i=this,o=e?e.predicates:null,s=e.sIdx;s||0===s||(s=e.isOpen?0:this.parent.activeSheetIndex),e.promise&&(r=new Sr.Deferred,e.promise=r.promise);var l=function(){r&&r.resolve()},d=e.isInternal||e.isCut;if(this.filterRange.size>0&&this.filterRange.has(s)&&!this.parent.isOpen&&!o)return this.removeFilter(s,d,!1),void l();var h=Fn(this.parent,s);if(this.isInValidFilterRange(h,e.range)){var p=this.parent.serviceLocator.getService(Dl);return this.filterRangeAlertHandler({error:p.getConstant("FilterOutOfRangeError")}),void l()}var c,u,f=e.range||h.selectedRange;if(!d){if(c={range:f,sheetIndex:s,cancel:!1,allowHeaderFilter:!1},e.predicates?(c.predicates=e.predicates,c.previousPredicates=this.filterCollection.get(s)&&[].slice.call(this.filterCollection.get(s))):c.filterOptions={predicates:e.predicates},c.useFilterRange=!1,u={action:"filter",eventArgs:c},this.parent.notify(K,u),c.cancel)return void l();delete c.cancel,e.useFilterRange=c.useFilterRange,e.allowHeaderFilter=c.allowHeaderFilter}if(e.range||!d&&f!==c.range)d||(f=c.range);else{var g=t(f);g[0]===g[2]&&g[1]===g[3]&&(f=a(g=zr(g[0],g[1],h)),d||(c.range=f))}if(o){if(o.length){var m=this.filterRange.get(s);m&&(e.useFilterRange=m.useFilterRange,e.allowHeaderFilter=m.allowHeaderFilter),this.processRange(h,s,f,!0,e.useFilterRange,e.allowHeaderFilter);var v=this.filterRange.get(s).range.slice();e.allowHeaderFilter||(v[0]=v[0]+1),e.useFilterRange||(v[2]=h.usedRange.rowIndex),v[1]=v[3]=n(o[0].field);var y=h.name+"!"+this.getPredicateRange(v,o.slice(1,o.length)),C=a(v);return void gn(this.parent,y,!0,!0,null,!0,null,null,!1,C).then((function(t){i.filterSuccessHandler(new Sr.DataManager(t),{action:"filtering",filterCollection:o,field:o[0].field,sIdx:e.sIdx,isInternal:d,isOpen:e.isOpen,prevPredicates:c&&c.previousPredicates}),l()}))}this.clearFilterHandler({sheetIndex:s}),l()}else this.processRange(h,s,f,!1,e.useFilterRange,e.allowHeaderFilter),l();d||(this.parent.notify(Pa,u),Md(this.parent.element))},i.prototype.processRange=function(e,t,r,n,i,a){var o=c(s(r||e.selectedRange));o[0]===o[2]&&o[1]===o[3]?(o[0]=0,o[1]=0,o[2]=e.usedRange.rowIndex,o[3]=e.usedRange.colIndex):o[3]>e.usedRange.colIndex&&(o[3]=e.usedRange.colIndex);var l={useFilterRange:i,range:o};a&&(l.allowHeaderFilter=a),this.filterRange.set(t,l),this.filterCollection.set(t,[]),n||this.refreshFilterRange(o,!1,t)},i.prototype.removeFilter=function(e,t,r,n){var i,o=this.filterRange.get(e),s=o.range.slice(),l=o.allowHeaderFilter,d=a(s);if(!t){if(i={action:"filter",eventArgs:{range:d,sheetIndex:e,cancel:!1},isClearAction:n},this.parent.notify(K,i),i.eventArgs.cancel)return;delete i.eventArgs.cancel}if(this.filterCollection.get(e).length||r){if(this.filterCollection.get(e).length&&n){var h={action:"filter",eventArgs:{range:d,sheetIndex:e,predicates:[],previousPredicates:this.filterCollection.get(e)},isClearAction:n};this.parent.notify(Pa,h)}this.clearFilterHandler({preventRefresh:r,sheetIndex:e})}this.filterRange.delete(e),this.filterCollection.delete(e),this.refreshFilterRange(s,!0,e,l),t||this.parent.notify(Pa,i)},i.prototype.filterByCellValueHandler=function(){var e=this,r=this.parent.activeSheetIndex,n=this.parent.getActiveSheet();if(this.isInValidFilterRange(n)){var i=this.parent.serviceLocator.getService(Dl);this.filterRangeAlertHandler({error:i.getConstant("FilterOutOfRangeError")})}else{var s,l=t(n.activeCell);this.isFilterRange(r,l[0],l[1])||(s=!0,this.processRange(n,r));var d=this.filterRange.get(r),h=d.range.slice(),p=a(h);h[0]=h[0]+1,h[2]=n.usedRange.rowIndex,h[1]=h[3]=l[1];var c=o(l[1]+1),u=zn(l[0],l[1],n),f=mn(this.parent,u,l[0],l[1],r),g=[{field:c,operator:"equal",type:this.getColumnType(n,l[1],l).type,matchCase:!1,value:f}],m=[].slice.call(this.filterCollection.get(r));m.length||(m=void 0);var v={range:p,predicates:g,previousPredicates:m,sheetIndex:r,cancel:!1,allowHeaderFilter:!1};if(this.parent.notify(K,{action:"filter",eventArgs:v}),v.cancel)s&&this.removeFilter(r,!0);else{v.allowHeaderFilter&&(d.allowHeaderFilter=v.allowHeaderFilter,h[0]--);var y=n.name+"!"+this.getPredicateRange(h,this.filterCollection.get(r)),C=a(h);gn(this.parent,y,!0,!0,null,!0,null,null,!1,C).then((function(t){e.filterSuccessHandler(new Sr.DataManager(t),{action:"filtering",filterCollection:g,field:c,isFilterByValue:!0})}))}}},i.prototype.renderFilterCellHandler=function(t){var r=(0,e.isNullOrUndefined)(t.sIdx)?this.parent.activeSheetIndex:t.sIdx;if(r===this.parent.activeSheetIndex){var n=this.filterRange.get(r)&&this.filterRange.get(r),i=n&&n.range;if(i&&(i[0]===t.rowIndex||n.allowHeaderFilter)&&i[1]<=t.colIndex&&i[3]>=t.colIndex){if(!t.td||t.td.classList.contains(n.allowHeaderFilter?"e-cell":"e-header-cell"))return;for(var a=t.td.querySelector(".e-filter-icon"),s="",l=this.parent.sortCollection,d=o(t.colIndex+1),h=this.filterCollection.get(r),p=0;p<h.length;p++)if(h[p].field===d){s=" e-filtered";break}if(l)for(p=0;p<l.length;p++)if(l[p].sheetIndex===r&&l[p].columnIndex===t.colIndex){s+="Ascending"===l[p].order?" e-sortasc-filter":" e-sortdesc-filter";break}if(a)a.className="e-btn-icon e-icons e-filter-icon"+s;else{var c=!1;if(a=this.filterBtn.cloneNode(!0),t.td.children.length>0&&t.td.children[t.td.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1&&(t.td.removeChild(t.td.children[t.td.childElementCount-1]),c=!0),a.firstElementChild.className="e-btn-icon e-icons e-filter-icon"+s,t.td.insertBefore(a,t.td.firstChild),t.isAction){var u=Fn(this.parent,r);zn(t.rowIndex,t.colIndex,u,!1,!0).wrap&&this.parent.notify(fs,{rowIdx:t.rowIndex,colIdx:t.colIndex,sheet:u,ele:t.td})}c&&this.parent.notify(ma,{targetElement:t.td,rowIndex:t.rowIndex,columnIndex:t.colIndex})}}}},i.prototype.refreshFilterRange=function(e,t,r,n){var i=r;i||0===i||(i=this.parent.activeSheetIndex);var a=this.filterRange&&this.filterRange.get(i);a?(e=e||a.range.slice(),n=a.allowHeaderFilter):e||(e=[0,0,0,0]);for(var o,s=e,l=Fn(this.parent,i),d=this.parent.frozenColCount(l),h=s[1];h<=s[3];h++){if(n){var p=h<d?this.parent.sheetModule.getSelectAllTable():this.parent.getColHeaderTable(),c=p&&this.parent.getRow(0,p);o=c&&this.parent.getCell(0,h,c)}else o=ml(l,s[0])?null:this.parent.getCell(s[0],h);if(t){if(o){var u=o.querySelector(".e-filter-btn");if(u){var f=!1;o.children.length>0&&o.children[o.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1&&(o.removeChild(o.children[o.childElementCount-1]),f=!0),u.parentElement.removeChild(u),f&&this.parent.notify(ma,{targetElement:o,rowIndex:s[0],columnIndex:h})}}}else this.renderFilterCellHandler({td:o,rowIndex:s[0],colIndex:h,sIdx:i,isAction:!0})}this.parent.sortCollection&&this.parent.notify($,null)},i.prototype.isFilterCell=function(e,t,r){var n=this.filterRange.has(e)&&this.filterRange.get(e).range;return n&&n[0]===t&&n[1]<=r&&n[3]>=r},i.prototype.isFilterRange=function(e,t,r){var n=this.filterRange.get(e)&&this.filterRange.get(e).range;return n&&n[0]<=t&&n[2]>=t&&n[1]<=r&&n[3]>=r},i.prototype.getFilteredColumnHandler=function(t){var n=(0,e.isUndefined)(t.sheetIndex)?this.parent.activeSheetIndex:t.sheetIndex,i=this.parent.serviceLocator.getService(Dl);if(t.clearFilterText=i.getConstant("ClearFilter"),this.filterRange.has(n)){var a=this.filterCollection.get(n);if(t.isClearAll)return void(t.isFiltered=a&&a.length>0);var s=this.filterRange.get(n).range.slice(),l=Fn(this.parent,n),d=r(l.activeCell);if(this.isFilterRange(n,d[0],d[1])){t.field=o(d[1]+1);var h=zn(s[0],d[1],l),p=this.parent.getDisplayText(h);t.clearFilterText=i.getConstant("ClearFilterFrom")+'"'+(p?p.toString():"Column "+t.field)+'"',a.some((function(e){return t.isFiltered=e.field===t.field,t.isFiltered}))}}},i.prototype.cMenuBeforeOpenHandler=function(e){var t=this.parent.element.id+"_cmenu";if(e.parentItem&&e.parentItem.id===t+"_filter"&&""===e.target){var r={isFiltered:!1};this.getFilteredColumnHandler(r),this.parent.enableContextMenuItems([t+"_clearfilter",t+"_reapplyfilter"],!!r.isFiltered,!0)}},i.prototype.closeDialog=function(){var t=document.querySelector(".e-filter-popup");if(t&&t.id.includes(this.parent.element.id)){var r=(0,e.getComponent)(t,"dialog");e.EventHandler.remove(t,td(),this.filterMouseDownHandler),r&&r.hide(),this.parent.notify(tp.filterDialogClose,null)}},i.prototype.removeFilterClass=function(){"relative"===this.parent.element.style.position&&(this.parent.element.style.position=""),this.parent.element.classList.contains("e-filter-open")&&this.parent.element.classList.remove("e-filter-open")},i.prototype.isPopupOpened=function(){var e=document.getElementsByClassName("e-filter-popup")[0];return e&&e.id.includes(this.parent.element.id)&&"none"!==e.style.display},i.prototype.filterCellKeyDownHandler=function(e){var t=r(this.parent.getActiveSheet().activeCell);if(this.isFilterCell(this.parent.activeSheetIndex,t[0],t[1]))if(e.closePopup)this.closeDialog();else if(e.isFilterCell=!0,!this.isPopupOpened()){var n=this.parent.getCell(t[0],t[1]);n&&this.openDialog(n)}},i.prototype.filterMouseDownHandler=function(t){if(!(e.Browser.isDevice&&"mousedown"===t.type||this.parent.getActiveSheet().isProtected)){var r=t.target;if(r.classList.contains("e-filter-icon")||r.classList.contains("e-filter-btn"))this.isPopupOpened()&&this.closeDialog(),this.openDialog((0,tp.parentsUntil)(r,"e-cell")||(0,tp.parentsUntil)(r,"e-header-cell"));else if(this.isPopupOpened()){var n=r.offsetParent;r.classList.contains("e-searchinput")||r.classList.contains("e-searchclear")||!n||n.classList.contains("e-filter-popup")||n.classList.contains("e-text-content")||n.classList.contains("e-checkboxtree")||n.classList.contains("e-checkbox-wrapper")?this.selectSortItemHandler(r):this.closeDialog()}}},i.prototype.cboxListSelected=function(t,r,n,i,a){var o=(0,tp.parentsUntil)(i.target,"e-ftrchk");if(o){var s=a&&o.querySelector(".e-add-current");if(s)return s.classList.contains("e-check")?((0,e.classList)(s,["e-uncheck"],["e-check"]),r.length||(t.btnObj.element.disabled=!0),!1):((0,e.classList)(s,["e-check"],["e-uncheck"]),t.btnObj.element.disabled=!1,!0);var l=o.querySelector(".e-selectall");if(l){o.querySelector(".e-chk-hidden").indeterminate=!1;for(var d=o.querySelector(".e-frame").classList.contains("e-check"),h=void 0,p=void 0,c=a?2:1,u=t.element.childElementCount;c<u;c++)h=t.element.children[c].querySelector(".e-frame"),(0,e.removeClass)([h],["e-check","e-stop","e-uncheck"]),d?(t.element.children[c].querySelector(".e-chk-hidden").checked=!1,h.classList.add("e-uncheck"),r.splice(0,1)):(t.element.children[c].querySelector(".e-chk-hidden").checked=!0,h.classList.add("e-check"),p=t.element.children[c].querySelector(".e-checkboxfiltertext").textContent,-1===r.indexOf(p)&&r.push(p))}else{p=o.querySelector(".e-checkboxfiltertext").textContent;o.querySelector(".e-frame").classList.contains("e-check")?r.splice(r.indexOf(p),1):r.push(p),(0,tp.toogleCheckbox)(o),l=t.element.querySelector(".e-selectall")}this.updateState(t,l,l.parentElement.querySelector(".e-chk-hidden"),r.length!==n,r.length)}return null},i.prototype.initCboxList=function(t,r,n){var i=this,a=t.column.field,o=new Sr.DataManager(t.dataSource).executeLocal((new Sr.Query).sortBy(a+"_value","ascending")),s=[],l=this.parent.getActiveSheet(),d=this.parent.serviceLocator.getService(Dl),h=document.createDocumentFragment(),p=this.createSelectAll(t,r);h.appendChild(p);var c,u,f={},g=[],m=[];o.forEach((function(e){if(""===e[a]){if(!f.isBlank){f.isBlank=!0;var t={};t[a]=d.getConstant("Blanks"),c=vl(l,Number(e.__rowIndex)-1);var n=(0,tp.createCboxWithWrap)((0,tp.getUid)("cbox"),r.createCheckbox(t[a],!c,t),"e-ftrchk");1===h.childElementCount?h.appendChild(n):h.insertBefore(n,h.children[1]),s.splice(0,0,t[a]),c||(g.push(t[a]),m.push(t[a]))}}else f[e[a]]||(f[e[a]]=!0,c=vl(l,Number(e.__rowIndex)-1),u=e[a],h.appendChild((0,tp.createCboxWithWrap)((0,tp.getUid)("cbox"),r.createCheckbox(u,!c,e),"e-ftrchk")),s.push(u),c||(g.push(u),m.push(u)))})),t.element.appendChild(h);var v=p.querySelector(".e-frame");v.classList.add("e-selectall");var y=p.querySelector(".e-chk-hidden");this.updateState(t,v,y,m.length!==s.length,m.length);var C,b,x,S,w,I=[].slice.call(t.element.childNodes);t.element.addEventListener("click",(function(e){if(C){var r=i.cboxListSelected(t,C,t.element.childElementCount-2,e,!0);null!==r&&(x=r)}else i.cboxListSelected(t,m,s.length,e)}));var E,N=function(e){if(e.toLowerCase().includes(w)){var n={};n[t.column.field]=e,h.appendChild((0,tp.createCboxWithWrap)((0,tp.getUid)("cbox"),r.createCheckbox(e,!0,n),"e-ftrchk")),b.push(e),C.push(e)}},R=t.dataSource.length>1e3?t.dataSource.length:1e3,A=s;E=n.length<=R?function(){s.forEach((function(e){N(e)}))}:function(){S||(A=[],g=[],m=[],S=new Sr.DataManager(n).executeLocal((new Sr.Query).sortBy(a+"_value","ascending")),f={},S.forEach((function(e){""===e[a]?f.isBlank||(f.isBlank=!0,u=d.getConstant("Blanks"),A.splice(0,0,u),vl(l,Number(e.__rowIndex)-1)||(g.push(u),m.push(u))):f[e[a]]||(u=e[a],f[u]=!0,A.push(e[a]),vl(l,Number(e.__rowIndex)-1)||(m.push(u),g.push(u)))})));for(var e=0,t=A.length;e<t&&b.length<R;e++)N(A[e])};this.wireFilterEvents(t,(function(){if(b)if(x){var o=void 0,l=void 0;m=g;for(var h=0,p=b.length;h<p;h++)o=b[h],b.length===C.length||C.indexOf(o)>-1?-1===m.indexOf(o)&&m.push(o):(l=m.indexOf(o))>-1&&m.splice(l,1)}else m=C;var c=m.length;if(c===s.length&&(!C||n.length<=R))i.filterSuccessHandler(new Sr.DataManager(t.dataSource),{action:"clear-filter",field:t.column.field});else{var u=[],f={field:a,ignoreAccent:!1,matchCase:!1,isFilterByMenu:!0},v=(0,e.getNumericObject)(i.parent.locale),y=function(e){var r=t.type;"number"===r&&(e===d.getConstant("Blanks")?(e="",r="string"):dn(Gr([e],i.parent,v)[0])||(r="string")),u.push(Object.assign({value:e,type:r},f))};if(c>A.length/2){f.operator="notequal",f.predicate="and";for(h=0,p=A.length;h<p;h++)-1===m.indexOf(A[h])&&y(A[h])}else{f.operator="equal",f.predicate="or";for(h=0,p=c;h<p;h++)y(m[h])}r.initiateFilter(u)}}),function(e){if("keyup"===e.event.type)w=e.event.target.value.toLowerCase();else if(e.event.target.classList.contains("e-search-icon"))return;if((h=document.createDocumentFragment()).appendChild(p),w)if(b=[],C=[],E(),C.length){i.updateState(t,v,y,!1,0),p.classList.remove("e-hide");var n={};n[a]=d.getConstant("AddCurrentSelection");var o=(0,tp.createCboxWithWrap)((0,tp.getUid)("cbox"),r.createCheckbox(n[a],!1,n),"e-ftrchk");h.insertBefore(o,h.children[1]),o.querySelector(".e-frame").classList.add("e-add-current")}else{p.classList.add("e-hide");var l=i.parent.createElement("div",{className:"e-checkfltrnmdiv"}),c=i.parent.createElement("span");c.innerText=d.getConstant("NoResult"),l.appendChild(c),h.appendChild(l),t.btnObj.element.disabled=!0}else I&&(C=null,b=null,i.updateState(t,v,y,m.length!==s.length,m.length),p.classList.remove("e-hide"),I.forEach((function(e){h.appendChild(e)})));t.element.innerHTML="",t.element.appendChild(h)}.bind(this))},i.prototype.createSelectAll=function(e,t){var r={};return r[e.column.field]=this.parent.serviceLocator.getService(Dl).getConstant("SelectAll"),(0,tp.createCboxWithWrap)((0,tp.getUid)("cbox"),t.createCheckbox(r[e.column.field],!1,r),"e-ftrchk")},i.prototype.updateState=function(t,r,n,i,a){if((0,e.removeClass)([r],["e-check","e-stop","e-uncheck"]),t.btnObj.element.disabled&&(t.btnObj.element.disabled=!1),i)if(a)r.classList.add("e-stop");else{r.classList.add("e-uncheck");var o=t.element.querySelector(".e-add-current");t.btnObj.element.disabled=!o||!o.classList.contains("e-check")}else r.classList.add("e-check");n.indeterminate=i,n.checked=!i},i.prototype.beforeFilteringHandler=function(t){var r=this;if(t.instance&&t.instance.options){if(t.isOpen&&"string"===t.instance.options.type){var n=(0,e.getNumericObject)(this.parent.locale);if("."!==n.decimal){var i=t.arg3.toString().split(".");if(2===i.length){var a=i.join(n.decimal);dn(new e.Internationalization(this.parent.locale).parseNumber(a,{format:"n"}))&&(t.arg3=a)}}}var o=function(t,n){if(n&&("notequal"===n||r.isCustomNumFilter(n)))if(t){if(dn(t))t=parseFloat(t.toString());else if("string"==typeof t){if(function(e){if(!e.includes("/"))return!0;var r=e.trim().split(" ");if(2!==r.length||!dn(r[0]))return!0;var n=r[1].split("/");return 2!==n.length||!dn(n[0])||!dn(n[1])||0===parseFloat(n[1])||(t=parseFloat(r[0])+parseFloat(n[0])/parseFloat(n[1]),!1)}(t)){var i=(0,e.getNumericObject)(r.parent.locale),a=new e.Internationalization(r.parent.locale),s={};if(t.includes(i.percentSign)){var l=t.trim().split("%");""===l[0]||l[1]||(s=br({value:l[0]},r.parent.locale,i.group,i.decimal))}if(s.isNumber)t=Number(s.value)/100;else{var d=a.parseNumber(t.trim(),{format:"n"});if(dn(d))t=/^(\(\d+\)|\d+)$/.test(t.trim())?-d:d;else{var h=t.trim(),p={value:h,cell:{value:h}};r.parent.notify(ue,p),(p.isTime||p.isDate)&&(t=parseFloat(p.updatedVal))}}}}}else"notequal"===n&&null===t&&(t="");else"equal"===n&&(dn(t)?t=t.toString():"string"==typeof t&&dn(o(t,"notequal"))?t=t.trim():null===t&&(t=""));return t};if("date"!==t.instance.options.type)t.arg3=o(t.arg3,t.arg2),t.arg8=o(t.arg8,t.arg7);else if("yMd"===t.instance.options.format){var s=function(e,n){if(e)if("string"==typeof e){var i=e.trim(),a={value:i,cell:{value:i}};if(r.parent.notify(ue,a),a.isDate)e="equal"===n?a.dateObj:parseFloat(a.updatedVal);else if("equal"===n||"notequal"===n){var s=o(e,"notequal");dn(s)?(t.instance.options.type="number","notequal"===n&&(e=s)):t.instance.options.type="string"}}else ln(e)&&"equal"!==n&&(e=sn(e,!0));return e},l=document.querySelectorAll(".e-xlfl-valuediv input.e-datepicker");2===l.length?(t.arg3=s(t.arg3||l[0].value,t.arg2),t.arg8=s(t.arg8||l[1].value,t.arg7)):t.arg3&&(t.arg3=s(t.arg3,t.arg2))}}},i.prototype.customFilterOpen=function(t){for(var r=document.querySelectorAll(".e-xlfl-optrdiv input.e-dropdownlist"),n=[],i=0;i<r.length;i++){var a=(0,e.getComponent)(r[i],"dropdownlist");a&&n.push(a.value)}var o=[];if(2===n.length){var s=this.filterCollection.get(this.parent.activeSheetIndex),l=void 0;for(i=0;i<s.length;i++)s[i].field===t.column&&null!==s[i].value&&(l=n.indexOf(s[i].operator))>-1&&("equal"===s[i].operator&&ln(s[i].value)?o[l]=sn(s[i].value,!0).toString():o[l]=s[i].value.toString(),n[l]="")}var d=(0,e.getNumericObject)(this.parent.locale),h=function(e){if("."!==d.decimal&&dn(e)){var t=e.toString();if(t.includes("."))return t.replace(".",d.decimal)}return e},p=document.querySelectorAll(".e-xlfl-valuediv input.e-ss-filter-input");if(p.length)for(i=0;i<p.length;i++){var c=new Ih.TextBox({placeholder:this.parent.serviceLocator.getService(Dl).getConstant("CustomFilterPlaceHolder")});o[i]&&(c.value=h(o[i])),c.appendTo(p[i])}else{var u=document.querySelectorAll(".e-xlfl-valuediv input.e-datepicker"),f=void 0,g=void 0;for(i=0;i<u.length;i++)g=dn(o[i])?this.parent.getDisplayText({value:o[i],format:Vs("ShortDate")+(o[i].includes(".")?" "+Vs("Time"):"")}):h(o[i]),(f=(0,e.getComponent)(u[i],"datepicker"))&&(f.value=g,u[i].value=g)}},i.prototype.wireFilterEvents=function(e,t,r){var n=this;e.btnObj.element.addEventListener("click",t.bind(this)),e.searchBox.addEventListener("keydown",(function(e){13===e.keyCode&&t()}));var i=function(){n.parent.off(hs,r),n.parent.off(tp.filterDialogClose,i),Md(n.parent.element)};this.parent.on(tp.filterDialogClose,i,this),this.parent.on(hs,r,this)},i.prototype.initTreeView=function(t,r){var n,i,a,o,s,l,d,h,p=this,c=[],u=[],f={},g=[],m=[],v=[],y=[],C=["January","February","March","April","May","June","July","August","September","October","November","December"];if("en-US"!==this.parent.locale){var b=e.IntlBase.getDependables(e.cldrData,this.parent.locale,null).dateObject,x=b.months["stand-alone"]?b.months["stand-alone"].wide:{};12===Object.keys(x).length&&(C=Object.keys(x).map(Number).map((function(e){return x[e]})))}var S=!1,w=this.parent.getActiveSheet(),I=function(e){f[""+l]=!0,vl(w,Number(e.__rowIndex)-1)?S=!0:c.push(l),u.push(l)};t.dataSource.forEach((function(e){"object"==typeof(o=e[t.column.field])&&Date.parse(o.toString())?(n=o.getFullYear().toString(),f[""+n]||((h={__rowIndex:n,hasChild:!0})[t.column.field]=n,g.push(h),f[""+n]=!0),d=o.getMonth(),i=C[d],f[""+(s=n+" "+i)]||((h={__rowIndex:s,pId:n,hasChild:!0,month:d})[t.column.field]=i,m.push(h),f[""+s]=!0),a=o.getDate(),l=s+" "+a.toString(),f[""+l]||((h={__rowIndex:l,pId:s})[t.column.field]=a,v.push(h),I(e))):(e[t.column.field]||0===e[t.column.field]?(l="text "+e[t.column.field].toString().toLowerCase(),n=e[t.column.field]):(l="blanks",n=p.parent.serviceLocator.getService(Dl).getConstant("Blanks")),f[""+l]||((h={__rowIndex:l})[t.column.field]=n,y.push(h),I(e)))})),g=new Sr.DataManager(g).executeLocal((new Sr.Query).sortBy(t.column.field,"decending")),m=new Sr.DataManager(m).executeLocal((new Sr.Query).sortBy("month","ascending")),v=new Sr.DataManager(v).executeLocal((new Sr.Query).sortBy(t.column.field,"ascending")),v=g.concat(m.concat(v)),y.length&&(y=new Sr.DataManager(y).executeLocal((new Sr.Query).sortBy(t.column.field,"ascending")),v=v.concat(y));var E=function(e){var t=[e.node];(e.event.target.classList.contains("e-fullrow")||"Enter"===e.event.key)&&("true"===O.getNode(e.node).isChecked?O.uncheckAll(t):O.checkAll(t))},N=this.createSelectAll(t,r);N.addEventListener("click",function(){A.indeterminate=!1,R.classList.contains("e-check")?(O.uncheckAll(),R.classList.add("e-uncheck"),A.checked=!1):(O.checkAll(),R.classList.add("e-check"),A.checked=!0)}.bind(this)),N.classList.add("e-spreadsheet-ftrchk");var R=N.querySelector(".e-frame");R.classList.add("e-selectall"),t.element.appendChild(N);var A=N.querySelector(".e-chk-hidden"),k=this.parent.createElement("div"),O=new vh.TreeView({fields:{dataSource:v,id:"__rowIndex",parentID:"pId",text:t.column.field,hasChildren:"hasChild"},enableRtl:this.parent.enableRtl,showCheckBox:!0,cssClass:"e-checkboxtree",checkedNodes:c,nodeClicked:E.bind(this),keyPress:E.bind(this),nodeChecked:function(e){"indeterminate"!==e.action&&(S=O.checkedNodes.length!==O.fields.dataSource.length,p.updateState(t,R,A,S,O.checkedNodes.length))}});O.createElement=this.parent.createElement,O.appendTo(k),t.element.appendChild(k),c=O.checkedNodes,this.updateState(t,R,A,S,O.checkedNodes.length);this.treeViewObj=O,this.treeViewEle=k,this.cBox=A,this.wireFilterEvents(t,(function(){O.checkedNodes.length===v.length?p.filterSuccessHandler(new Sr.DataManager(t.dataSource),{action:"clear-filter",field:t.column.field}):p.generatePredicate(O.checkedNodes,y.length?"string":t.type,t.column.field,r,u,O.checkedNodes.length>v.length/2)}),this.refreshCheckbox.bind(this,v,O,c))},i.prototype.generatePredicate=function(e,t,r,n,i,a){var o,s,l,d,h,p=[],c={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11},u=function(){"blanks"===s[0]?p.push(Object.assign({value:"",type:t},o)):"text"===s[0]&&(s.splice(0,1),d=s.join(" "),isNaN(Number(d))?h="string":(d=Number(d),h="number"),p.push(Object.assign({value:d,type:h},o)))},f=function(){(l=new Date(Number(s[0]),c[s[1]],Number(s[2]))).getDate()?p.push(Object.assign({value:l,type:t},o)):u()};if(a){o={field:r,ignoreAccent:!1,matchCase:!1,predicate:"and",operator:"notequal",isFilterByMenu:!0};for(var g=0,m=i.length;g<m;g++)-1===e.indexOf(i[g])&&(s=i[g].split(" "),f())}else{o={field:r,ignoreAccent:!1,matchCase:!1,predicate:"or",operator:"equal",isFilterByMenu:!0};for(g=0,m=e.length;g<m;g++)3===(s=e[g].split(" ")).length?f():u()}n.initiateFilter(p)},i.prototype.refreshCheckbox=function(t,r,n,i){var a,o;if("keyup"===i.event.type)a=i.event.target.value;else if(i.event.target.classList.contains("e-search-icon"))return;var s=function(){if(o.length&&!r.fields.dataSource.length){var t=r.element.parentElement;t.getElementsByClassName("e-spreadsheet-ftrchk")[0].classList.remove("e-hide"),(0,e.detach)(t.getElementsByClassName("e-checkfltrnmdiv")[0])}r.fields.dataSource=o,r.dataBind()};if(a){o=new Sr.DataManager(t).executeLocal((new Sr.Query).where(new Sr.Predicate(r.fields.text,"contains",a,!0)));var l={},d=[],h=void 0,p=void 0,c=void 0,u=void 0;if(isNaN(Number(a))){for(var f=0;f<o.length;f++)o[f].hasChild&&(d.push(new Sr.Predicate("pId","equal",o[f].__rowIndex,!1)),l[""+(h=o[f].pId)]||(d.push(new Sr.Predicate("__rowIndex","equal",h,!1)),l[""+h]=!0));p=o,u=1}else{var g=void 0,m={};c=[];for(f=0;f<o.length;f++)(h=o[f].pId)?(g=h.split(" ")[0],l[""+h]||(d.push(new Sr.Predicate("__rowIndex","equal",h,!1)),l[""+h]=!0,c.push(g),c.push(h)),m[""+g]||(l[""+g]||(d.push(new Sr.Predicate("__rowIndex","equal",g,!1)),l[""+g]=!0),d.push(new Sr.Predicate("__rowIndex","equal",o[f].__rowIndex,!1)))):m[""+(h=o[f].__rowIndex)]||(d.push(new Sr.Predicate("__rowIndex","contains",h,!1)),m[""+h]=!0);p=[]}if(o.length){d.length&&(o=p.concat(new Sr.DataManager(t).executeLocal((new Sr.Query).where(Sr.Predicate.or(d))))),s(),r.checkAll();var v=r.animation.expand.duration;r.animation.expand.duration=0,r.expandAll(c,u),r.animation.expand.duration=v}else if(r.fields.dataSource.length){s();var y=r.element.parentElement;y.getElementsByClassName("e-spreadsheet-ftrchk")[0].classList.add("e-hide");var C=this.parent.createElement("div",{className:"e-checkfltrnmdiv"}),b=this.parent.createElement("span");b.innerText=this.parent.serviceLocator.getService(Dl).getConstant("NoResult"),C.appendChild(b),y.appendChild(C)}}else o=t,s(),r.checkedNodes=n,r.refresh()},i.prototype.openDialog=function(t){var r=this,n=parseInt(t.getAttribute("aria-colindex"),10),i=o(n);this.parent.showSpinner();var s=this.parent.activeSheetIndex,l=this.filterRange.get(s),d=l.range.slice(),h=this.parent.getActiveSheet(),p=zn(d[0],n-1,h),c=this.parent.getDisplayText(p);l.allowHeaderFilter||(d[0]=d[0]+1),l.useFilterRange||(d[2]=h.usedRange.rowIndex);var u,f=[d[0],n-1,d[2],n-1],g=this.getPredicateRange(f,this.filterCollection.get(s),n-1),m=g.otherColPredicate,v=g.curPredicate;v.length&&((u={})[i]=v);var y,C=h.name+"!"+g.address,b=a(f),x=this.getColumnType(h,n-1,d,!0),S=x.type,w="date"===S||x.isDateAvail,I="number"===S,E=w||I,N=x.isMultiFormattedCol;E&&!g.filteredCol&&(y=[]),gn(this.parent,C,!0,!0,null,!0,null,null,!0,b,null,y).then((function(n){var a,o;if(r.parent.element.style.position="relative",r.parent.element.classList.add("e-filter-open"),E){if(y||!m.length)a=new Sr.DataManager(y||n);else{var s=r.getPredicates(m),l=Zr(new Sr.DataManager(n),s.predicates,s.equalOrPredicates);a=new Sr.DataManager(l)}var d=function(e){r.parent.off(ds,d),e.isCheckboxFilterTemplate=!0,w?r.initTreeView(e,b):r.initCboxList(e,b,n)};r.parent.on(ds,d,r),o=[]}else{if(m.length){var h=r.getPredicates(m);l=Zr(new Sr.DataManager(n),h.predicates,h.equalOrPredicates);a=new Sr.DataManager(l)}else a=new Sr.DataManager(n);o=r.getClonedPredicates(v)}var p=t.querySelector(".e-filter-btn"),f={field:i,filter:{}};if(I){var g=r.parent;f.filterTemplate=function(e){if(!g.isReact||!e)return[g.createElement("input",{className:"e-ss-filter-input"})];e.appendChild(g.createElement("input",{className:"e-ss-filter-input"}))};f.getFilterTemplate=function(){return e=f.filterTemplate,function(t,r,n,i,a,o,s){return e(s)};var e},g.isReact&&!g.renderTemplates&&(g.renderTemplates=function(e){return e()})}var C={type:S,field:i,format:"date"===S?"yMd":null,displayName:c||"Column "+i,dataSource:a||[],height:r.parent.element.classList.contains("e-bigger")?800:500,columns:[],hideSearchbox:!1,filteredColumns:o,column:f,handler:r.filterSuccessHandler.bind(r,new Sr.DataManager(n)),target:p,position:{X:0,Y:0},localeObj:r.parent.serviceLocator.getService(Dl),actualPredicate:u,isFormatted:E&&!w,isMultiFormattedCol:N},b=new tp.ExcelFilterBase(r.parent,r.getLocalizedCustomOperators());b.openDialog(C);var x=document.querySelector(".e-filter-popup");if(x&&x.id.includes(r.parent.element.id)){e.EventHandler.add(x,td(),r.filterMouseDownHandler,r);var R=r.parent.element.getBoundingClientRect(),A=p.getBoundingClientRect(),k=x.getBoundingClientRect(),O=A.right-R.left-k.width;O<0&&(O=A.left-R.left),x.style.left=O*r.parent.viewport.scaleX+"px",x.style.top="0px",x.style.visibility="hidden",x.classList.contains("e-hide")&&x.classList.remove("e-hide");var F=A.bottom-R.top;k.height-(R.bottom-A.bottom)>0&&(F-=k.height-(R.bottom-A.bottom))<0&&(F=0),x.style.top=F*r.parent.viewport.scaleY+"px",x.style.visibility=""}r.parent.hideSpinner()}))},i.prototype.getPredicateRange=function(e,t,r){var i,o,s,l=a(e),d=[],h=[];t&&t.length?t.forEach((function(t){t.field&&(o=""+t.field+(e[0]+1)+":"+t.field+(e[2]+1),s=n(t.field),l.includes(o)||(l+=","+o,s<e[1]&&(e[1]=s),s>e[3]&&(e[3]=s)),void 0!==r&&(s===r?(i=!0,h.push(t)):d.push(t)))})):i=!0;return void 0===r?l:{address:l,filteredCol:i,otherColPredicate:d,curPredicate:h}},i.prototype.filterDialogCreatedHandler=function(){var e=document.querySelector(".e-filter-popup");e&&e.id.includes(this.parent.element.id)&&e.classList.contains("e-popup-close")&&e.classList.add("e-hide")},i.prototype.filterCboxValueHandler=function(e){if(e.column&&e.data){var t=e.column.field;if(e.value){var n=r(t+e.data.dataObj.__rowIndex),i=zn(n[0],n[1],this.parent.getActiveSheet());i&&i.format&&(e.value=this.parent.getDisplayText(i))}}},i.prototype.selectSortItemHandler=function(e){var t=this.parent.serviceLocator.getService(Dl),r=e.classList.contains("e-filter-sortasc")?"Ascending":e.classList.contains("e-filter-sortdesc")?"Descending":null;if("Ascending"===r?e.setAttribute("aria-label",t.getConstant("SortAscending")):e.setAttribute("aria-label",t.getConstant("SortDescending")),r){var n=this.parent.getActiveSheet(),i=this.parent.activeSheetIndex,o=this.filterRange.get(i),l=o.range.slice();if(o.allowHeaderFilter||(l[0]=l[0]+1),o.useFilterRange||(l[2]=n.usedRange.rowIndex),Qr(this.parent,l))return this.closeDialog(),void this.parent.notify(to,null);this.parent.sortCollection=this.parent.sortCollection?this.parent.sortCollection:[];for(var d=[],h=this.parent.sortCollection.length-1;h>=0;h--)this.parent.sortCollection[h]&&this.parent.sortCollection[h].sheetIndex===i&&(d.push(this.parent.sortCollection[h]),this.parent.sortCollection.splice(h,1));this.parent.sortCollection.push({sortRange:a(l),columnIndex:s(n.activeCell)[1],order:r,sheetIndex:i}),this.parent.notify(ia,{sortOptions:{sortDescriptors:{order:r},containsHeader:!1},previousSort:d,range:a(l)}),this.refreshFilterRange(),this.closeDialog()}},i.prototype.filterSuccessHandler=function(e,t){var r=t.sIdx;r||0===r||(r=t.isOpen?0:this.parent.activeSheetIndex);var n=t.prevPredicates||[].slice.call(this.filterCollection.get(r));t.isFilterByValue&&!n.length&&(n=void 0);var i=this.filterCollection.get(r);if(this.updatePredicate(i,t.field),"clear-filter"!==t.action||i.length!==n.length){if("filtering"===t.action){i=i.concat(t.filterCollection.map((function(e){return e&&"string"==typeof e.value&&e.value.includes("*")&&(e.value.startsWith("*")&&e.value.endsWith("*")?(e.value=e.value.split("*").join(""),e.operator="contains"):e.value.endsWith("*")?(e.value=e.value.split("*").join(""),e.operator="startswith"):e.value.startsWith("*")&&(e.value=e.value.split("*").join(""),e.operator="endswith")),e})))}this.filterCollection.set(r,i);var o=this.getPredicates(i),s={datasource:e,predicates:o.predicates,equalOrPredicates:o.equalOrPredicates},l=this.filterRange.get(r);l.useFilterRange||(l.range[2]=Fn(this.parent,r).usedRange.rowIndex),this.applyFilter(s,a(l.range),r,n,!1,t.isInternal,t.isFilterByValue)}},i.prototype.isCustomNumFilter=function(e){return e.includes("greaterthan")||e.includes("lessthan")||"between"===e},i.prototype.getClonedPredicates=function(e,t){void 0===t&&(t=[]);for(var r,n,i=[],a=0;a<e.length;a++)r=e[a],(this.isCustomNumFilter(r.operator)||!r.isFilterByMenu&&"notequal"===r.operator)&&dn(r.value)?(i.push(Object.assign({},r,{field:r.field+"_value",type:"number"})),n=!0):(r.isFilterByMenu||"equal"!==r.operator||"or"!==r.predicate||t.push(r.field),i.push(r));return!n&&t.length&&t.splice(0),i},i.prototype.updatePredicate=function(e,t){for(var r=new Sr.DataManager(e),n=new Sr.Query,i=r.executeLocal(n.where("field","equal",t)),a=0;a<i.length;a++){for(var o=-1,s=0;s<e.length;s++)if(e[s].field===i[a].field){o=s;break}-1!==o&&e.splice(o,1)}},i.prototype.applyFilter=function(e,t,r,n,i,a,o){var s=this,l={range:t,predicates:[].slice.call(this.filterCollection.get(r)),previousPredicates:n,sheetIndex:r,cancel:!1};if(a||o||(this.parent.notify(K,{action:"filter",eventArgs:l}),!l.cancel)){t.indexOf("!")<0&&(t=this.parent.sheets[r].name+"!"+t),this.parent.showSpinner();var d={args:{range:t,filterOptions:e},promise:new Promise((function(e){e(void 0)})),refresh:i},h=qd(this.parent);this.parent.notify(je,d);var p=qd(this.parent);this.parent.notify(To,{prevChartIndexes:h,currentChartIndexes:p}),d.promise.then((function(e){return s.refreshFilterRange(),s.parent.hideSpinner(),a||(delete l.cancel,s.parent.notify(Pa,{action:"filter",eventArgs:l}),document.activeElement.id!==s.parent.element.id+"_SearchBox"&&Md(s.parent.element)),Promise.resolve(e)})).catch((function(e){return s.filterRangeAlertHandler({error:e}),Promise.reject(e)}))}},i.prototype.getPredicates=function(e){var t,r=[],n=this.getClonedPredicates(e,r);if(r.length){for(var i,a=void 0,o=void 0,s=new Map,l=0;l<n.length;l++)a=n[l].field.replace("_value",""),r.indexOf(a)>-1&&(o=n.splice(l,1)[0],l--,s.has(a)?s.get(a).push(o):s.set(a,[o]));t=[],s.forEach((function(e){i=[];for(var r=tp.CheckBoxFilterBase.getPredicate(e),n=0,a=Object.keys(r);n<a.length;n++){var o=a[n];i.push(r[""+o])}t.push(i)}))}for(var d=[],h=tp.CheckBoxFilterBase.getPredicate(n),p=0,c=Object.keys(h);p<c.length;p++){var u=c[p];d.push(h[""+u])}return{predicates:d,equalOrPredicates:t}},i.prototype.getColumnType=function(e,t,r,n){for(var i,a,o,s,l=0,d=0,h=0,p=r[0];p<=r[2];p++)if((i=zn(p,t,e))&&(!n||i.value||0===Number(i.value))){if(i.format&&"General"!==i.format){switch(zs(i.format).toLowerCase()){case"number":case"currency":case"accounting":case"percentage":case"time":l++;break;case"shortdate":case"longdate":h++;break;case"text":d++;break;default:a={},Yn(i.format,!0,a)?"date"===a.type?h++:l++:dn(i.value)?l++:i.value&&d++}o||(o=i.format)}else dn(i.value)?l++:i.value&&d++;o&&o!==i.format&&(s=!0)}return{type:l>d&&l>h&&l>0?"number":d>=l&&d>=h&&d>=0?"string":h>l&&h>d&&h>0?"date":"datetime",isDateAvail:!!h,isMultiFormattedCol:s}},i.prototype.clearFilterHandler=function(t){var r=t&&!(0,e.isNullOrUndefined)(t.sheetIndex)?t.sheetIndex:this.parent.activeSheetIndex;if(t&&t.field){var n=[].slice.call(this.filterCollection.get(r));n&&n.length&&(this.updatePredicate(n,t.field),this.initiateFilterUIHandler({predicates:n,range:a(this.filterRange.get(r).range),sIdx:r}))}else{var i=t&&t.isAction,o={isFiltered:!1,isClearAll:!0,sheetIndex:r};if(this.getFilteredColumnHandler(o),o.isFiltered||t&&t.preventRefresh){var s=void 0,l=Fn(this.parent,r),d=this.filterRange.get(r),h=d.range;if(i&&(s={range:a(h),predicates:[],previousPredicates:this.filterCollection.get(r),sheetIndex:r,cancel:!1},this.parent.notify(K,{action:"filter",eventArgs:s}),s.cancel))return;this.filterCollection.set(r,[]);var p=d.useFilterRange?h[2]:l.usedRange.rowIndex;if(this.parent.scrollSettings.enableVirtualization&&p-h[0]+1>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")){for(var c=0;c<=p;c++)gl(l,c,{hidden:!1,isFiltered:!1});t&&t.preventRefresh||this.parent.renderModule.refreshSheet(!1,!1,!0)}else{this.refreshFilterRange(null,null,r);var u={startIndex:h[0],hide:!1,isFiltering:!0,refreshUI:!1,endIndex:d.useFilterRange?h[2]:l.usedRange.rowIndex,sheetIndex:r};this.parent.notify(Rt,u),!u.refreshUI||t&&t.preventRefresh||this.parent.renderModule.refreshSheet(!1,!1,!0)}i&&(delete s.cancel,this.parent.notify(Pa,{action:"filter",eventArgs:s}),Md(this.parent.element))}}},i.prototype.reapplyFilterHandler=function(e,t){var r=this,i=this.parent.activeSheetIndex;if(this.filterRange.has(i)){var o=this.filterCollection.get(i);if(o&&o.length){var s=Fn(this.parent,i),l=this.filterRange.get(i),d=l.range.slice();l.allowHeaderFilter||(d[0]=d[0]+1),l.useFilterRange||(d[2]=s.usedRange.rowIndex),d[1]=d[3]=n(o[0].field);var h=s.name+"!"+this.getPredicateRange(d,o.slice(1,o.length));gn(this.parent,h,!0,!0,null,!0,null,null,!1,a(d)).then((function(n){var s=r.getPredicates(r.filterCollection.get(i));r.applyFilter({predicates:s.predicates,datasource:new Sr.DataManager(n),equalOrPredicates:s.equalOrPredicates},a(l.range),i,[].slice.call(o),t,e)}))}}},i.prototype.getFilterRangeHandler=function(t){var r=(0,e.isNullOrUndefined)(t.sheetIdx)?this.parent.activeSheetIndex:t.sheetIdx,n=this.filterRange&&this.filterRange.get(r);n?(t.hasFilter=!0,t.filterRange=n.range,t.allowHeaderFilter=n.allowHeaderFilter,t.isFiltered=this.filterCollection&&this.filterCollection.get(r)&&this.filterCollection.get(r).length>0):(t.hasFilter=!1,t.filterRange=null)},i.prototype.getLocalizedCustomOperators=function(){var e=this.parent.serviceLocator.getService(Dl),t=[{value:"equal",text:e.getConstant("Equal")},{value:"greaterthan",text:e.getConstant("GreaterThan")},{value:"greaterthanorequal",text:e.getConstant("GreaterThanOrEqual")},{value:"lessthan",text:e.getConstant("LessThan")},{value:"lessthanorequal",text:e.getConstant("LessThanOrEqual")},{value:"notequal",text:e.getConstant("NotEqual")}];return{stringOperator:[{value:"startswith",text:e.getConstant("StartsWith")},{value:"endswith",text:e.getConstant("EndsWith")},{value:"contains",text:e.getConstant("Contains")},{value:"equal",text:e.getConstant("Equal")},{value:"isempty",text:e.getConstant("IsEmpty")},{value:"doesnotstartwith",text:e.getConstant("NotStartsWith")},{value:"doesnotendwith",text:e.getConstant("NotEndsWith")},{value:"doesnotcontain",text:e.getConstant("NotContains")},{value:"notequal",text:e.getConstant("NotEqual")},{value:"isnotempty",text:e.getConstant("IsNotEmpty")}],numberOperator:t,dateOperator:t,datetimeOperator:t,booleanOperator:[{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}]}},i.prototype.setFilteredCollection=function(t){var r=this,i={sheetIdx:t.sheetIdx};if(this.getFilterRangeHandler(i),i.hasFilter){var o={sheetIndex:t.sheetIdx,filterRange:a(i.filterRange),hasFilter:!0,column:[],criteria:[],value:[],dataType:[],predicates:[]};t.saveJson.filterCollection.push(o);for(var s,l=this.filterCollection.get(t.sheetIdx),d=new Map,h=void 0,p=function(r){if((0,e.isNullOrUndefined)(r))return"";if(t.isSaveAction&&"date"===s){var n=r;r=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear()+" "+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()}return r},c=0;c<l.length;c++)h=l[c],t.isSaveAction&&"notequal"===h.operator&&h.isFilterByMenu?d.has(h.field)?d.get(h.field).push(h):d.set(h.field,[h]):(o.column.push(n(h.field)),o.criteria.push(h.operator),t.isSaveAction?"equal"===h.operator?(s=ln(h.value)?"date":"string",o.value.push(p(h.value)),o.dataType.push(s)):(o.value.push(h.value),o.dataType.push("custom")):(o.value.push(h.value),o.dataType.push(h.type)),o.predicates.push(h.predicate));var u,f=new Map;d.forEach((function(e,i){u=n(i),f.has(i)||f.set(i,r.getColData(u,i,t.sheetIdx));for(var a=f.get(i),l=r.getPredicates(e).predicates,d=new Sr.DataManager(a).executeLocal((new Sr.Query).where(Sr.Predicate.and(l))),h=0;h<d.length;h++)o.column.push(u),o.criteria.push("equal"),s=ln(d[h][i])?"date":"string",o.value.push(p(d[h][i])),o.dataType.push(s),o.predicates.push("or")}))}},i.prototype.updateFilter=function(e){if(this.parent.filterCollection&&(e.initLoad||e.isOpen)){for(var t=void 0,r=void 0,n=void 0,i={},a=void 0,s=void 0,l=void 0,d=0;d<this.parent.filterCollection.length;d++){var h=(n=this.parent.filterCollection[d]).sheetIndex;if(0!==d||this.parent.isOpen||e.isOpen||(h=0),r=[],n.column)for(var p=0;p<n.column.length;p++)if(s={field:o(n.column[p]+1),operator:this.getFilterOperator(n.criteria[p]),value:"string"==typeof n.value[p]?n.value[p].split("*").join(""):n.value[p],predicate:n.predicates&&n.predicates[p],type:n.dataType&&n.dataType[p]},["year","month","day"].indexOf(s.type)>-1){var c={value:s.value,cell:{value:s.value}};if(this.parent.notify(ue,c),c.isDate){var u=c.dateObj;if(s.value=u,"day"===s.type)s.type="date",s.predicate="or",r.push(s);else{s.operator="greaterthanorequal",s.predicate="and";var f=s.type;s.type="date",t=this.getPredicates([s,{field:s.field,operator:"lessthanorequal",predicate:"and",type:"date",value:new Date(u.getFullYear(),"year"===f?12:u.getMonth()+1,0,0,0,0)}]).predicates,i[s.field]||(i[s.field]=this.getColData(n.column[p],s.field,d)),a=new Sr.DataManager(i[s.field]).executeLocal((new Sr.Query).where(Sr.Predicate.and(t)));for(var g=0;g<a.length;g++)r.push({field:s.field,operator:"equal",predicate:"or",type:"date",value:a[g][s.field]})}}}else{if(l={isOpen:!0,instance:{options:{type:s.type}},arg3:s.value,arg2:s.operator},this.beforeFilteringHandler(l),s.value=l.arg3,"string"===s.type||"custom"===s.type)this.isCustomNumFilter(s.operator)&&dn(s.value)&&(s.type="number");else if("date"===s.type&&"equal"===s.operator&&"string"==typeof s.value&&s.value.includes("/")&&s.value.includes(":")){var m=s.value.split(" ");if(2===m.length){var v=m[0].split("/"),y=m[1].split(":");3===v.length&&3===y.length&&(s.value=new Date(Number(v[2]),Number(v[0])-1,Number(v[1]),Number(y[0]),Number(y[1]),Number(y[2])))}}r.push(s)}if(!e.isOpen)for(var C=0;C<r.length-1;C++)r[C].field===r[C+1].field&&(r[C].predicate||(r[C].predicate="or"),r[C+1].predicate||(r[C+1].predicate="or"));this.parent.notify(Aa,{predicates:r.length?r:void 0,range:n.filterRange,sIdx:h,isInternal:!0,isOpen:e.isOpen})}this.parent.sortCollection&&this.parent.notify($,null),this.parent.setProperties({filterCollection:null},!0)}},i.prototype.getColData=function(e,t,r){var n=Fn(this.parent,r);if(!n.rows||!n.rows.length)return[];for(var i,a,o=[],s=1,l=n.rows.length;s<l;s++)n.rows[s]&&(a=zn(s,e,n,!1,!0))&&a.value&&((i={})[t]=mn(this.parent,a,s,e,r),o.push(i));return o},i.prototype.getFilterOperator=function(e){switch(e){case"BeginsWith":e="startswith";break;case"Less":e="lessthan";break;case"EndsWith":e="endswith";break;case"Equal":e="equal";break;case"Notequal":e="notEqual";break;case"Greater":e="greaterthan";break;case"Contains":e="contains";break;case"LessOrEqual":e="lessthanorequal";break;case"GreaterOrEqual":e="greaterthanorequal";break;case"NotContains":e="doesnotcontain";break;case"NotBeginsWith":e="doesnotstartwith";break;case"NotEndsWith":e="doesnotendwith";break;case"Empty":e="isempty";break;case"NotEmpty":e="isnotempty"}return e},i.prototype.beforeInsertHandler=function(t){if("Column"===t.modelType){var r=(0,e.isUndefined)(t.activeSheetIndex)?this.parent.activeSheetIndex:t.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(r)){var i=this.filterRange.get(r).range;(this.isFilterCell(r,i[0],t.index)||t.index<i[1])&&(i[3]+=t.model.length,t.index<=i[1]&&(i[1]+=t.model.length),this.filterCollection.get(r).forEach((function(e){var r=n(e.field);t.index<=r&&(e.field=o(r+t.model.length+1))})),this.parent.sortCollection&&this.parent.sortCollection.forEach((function(e){e.sheetIndex===r&&t.index<=e.columnIndex&&(e.columnIndex+=t.model.length)})))}}else if("Sheet"===t.modelType){for(var a=0,s=Array.from(this.filterRange.keys()).sort().reverse();a<s.length;a++){var l=s[a];t.index<=l&&(this.filterRange.set(l+t.model.length,this.filterRange.get(l)),this.filterRange.delete(l),this.filterCollection.set(l+t.model.length,this.filterCollection.get(l)),this.filterCollection.delete(l))}this.parent.sortCollection&&this.parent.sortCollection.forEach((function(e){t.index<=e.sheetIndex&&(e.sheetIndex+=t.model.length)}))}},i.prototype.beforeDeleteHandler=function(e){if("Column"===e.modelType){var t=this.parent.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(t)){var r=!0,i=this.filterRange.get(t).range;if(e.start>=i[1]&&e.end<=i[3]?i[3]-=e.end-e.start+1:e.start<i[1]&&e.end<i[1]?(i[1]-=e.end-e.start+1,i[3]-=e.end-e.start+1):e.start<i[1]&&e.end>i[1]&&e.end<i[3]?(i[1]=e.start,i[3]-=e.end-e.start+1):r=!1,r){for(var a=this.filterCollection.get(t),s=void 0,l=a.length-1;l>=0;l--){var d=n(a[l].field);e.end<d?a[l].field=o(d-(e.end-e.start+1)+1):e.start<=d&&e.end>=d&&(s=!0,a.splice(l,1))}var h=this.parent.sortCollection;if(h)for(l=0;l<h.length;l++)if(h[l].sheetIndex===t){if(e.end<h[l].columnIndex){h[l].columnIndex=h[l].columnIndex-(e.end-e.start+1);break}if(e.start<=h[l].columnIndex&&e.end>=h[l].columnIndex){h.splice(l,1);break}}i.some((function(e){return e<0}))?(this.removeFilter(t,!0,!0),e.refreshSheet=!0):s&&(a&&a.length?(this.reapplyFilterHandler(!0,!0),e.refreshSheet=!1):(this.clearFilterHandler({preventRefresh:!0}),e.refreshSheet=!0))}}}},i.prototype.deleteSheetHandler=function(t){if((0,e.isUndefined)(t.sheetIndex))this.filterRange.get(this.parent.activeSheetIndex)&&(this.filterRange.delete(this.parent.activeSheetIndex),this.filterCollection.delete(this.parent.activeSheetIndex));else{for(var r=0,n=Array.from(this.filterRange.keys()).sort().reverse();r<n.length;r++){var i=n[r];t.sheetIndex===i?(this.filterRange.delete(i),this.filterCollection.delete(i)):t.sheetIndex<i&&(this.filterRange.set(i-1,this.filterRange.get(i)),this.filterRange.delete(i),this.filterCollection.set(i-1,this.filterCollection.get(i)),this.filterCollection.delete(i))}var a=this.parent.sortCollection;if(a)for(var o=a.length-1;o>=0;o--)t.sheetIndex===a[o].sheetIndex?a.splice(o,1):t.sheetIndex<a[o].sheetIndex&&(a[o].sheetIndex-=1)}},i.prototype.clearHandler=function(e){var t=this.parent.getAddressInfo(e.range);if(this.filterRange.has(t.sheetIndex)){var r=this.filterRange.get(t.sheetIndex).range.slice();Ar(t.indices,r[0],r[1])&&Ar(t.indices,r[0],r[3])&&this.removeFilter(t.sheetIndex,null,null,!0)}},i.prototype.duplicateSheetFilterHandler=function(e){for(var t=0,r=Array.from(this.filterRange.keys()).sort().reverse();t<r.length;t++){var n=r[t];if(!(e.newSheetIndex<=n))break;this.filterRange.set(n+1,this.filterRange.get(n)),this.filterRange.delete(n),this.filterCollection.set(n+1,this.filterCollection.get(n)),this.filterCollection.delete(n)}if(this.filterCollection.has(e.sheetIndex)&&this.filterCollection.set(e.newSheetIndex,this.filterCollection.get(e.sheetIndex).slice()),this.filterRange.has(e.sheetIndex)){var i=this.filterRange.get(e.sheetIndex);this.filterRange.set(e.newSheetIndex,{useFilterRange:i.useFilterRange,range:i.range.slice(),allowHeaderFilter:i.allowHeaderFilter})}},i.prototype.updateSortCollectionHandler=function(e){var t;if(e.isDuplicate){if(this.parent.sortCollection&&this.parent.sortCollection.length>0){for(var r=[],i=0;i<this.parent.sortCollection.length;i++){var o=this.parent.sortCollection[i];if(o.sheetIndex===e.curSheetIndex){var l=Object.assign({},o);l.sheetIndex=e.newSheetIndex,r.push(l)}}(t=this.parent.sortCollection).push.apply(t,r)}}else{var d=this.parent.getActiveSheet(),h=this.parent.activeSheetIndex,p=this.filterRange.get(h);if(p){var c=p.range.slice();p.allowHeaderFilter||(c[0]=c[0]+1),p.useFilterRange||(c[2]=d.usedRange.rowIndex);var u=e.sortOptions.sortDescriptors;if(this.parent.sortCollection=this.parent.sortCollection?this.parent.sortCollection:[],Array.isArray(u))for(var f=0;f<u.length;f++)this.parent.sortCollection.push({sortRange:a(c),columnIndex:n(u[f].field),order:u[f].order,sheetIndex:h});else this.parent.sortCollection.push({sortRange:a(c),columnIndex:s(d.activeCell)[1],order:u.order,sheetIndex:h})}}},i.prototype.moveSheetHandler=function(e){var t,r,n,i;this.filterRange.has(e.prevIndex)&&(t=this.filterRange.get(e.prevIndex),n=this.filterCollection.get(e.prevIndex)),this.filterRange.has(e.currentIndex)&&(r=this.filterRange.get(e.currentIndex),i=this.filterCollection.get(e.currentIndex)),t&&r?(this.filterRange.set(e.currentIndex,t),this.filterRange.set(e.prevIndex,r),this.filterCollection.set(e.currentIndex,n),this.filterCollection.set(e.prevIndex,i)):t?(this.filterRange.set(e.currentIndex,t),this.filterRange.delete(e.prevIndex),this.filterCollection.set(e.currentIndex,n),this.filterCollection.delete(e.prevIndex)):r&&(this.filterRange.set(e.prevIndex,r),this.filterRange.delete(e.currentIndex),this.filterCollection.set(e.prevIndex,i),this.filterCollection.delete(e.currentIndex))},i.prototype.refreshFilterCellsOnResize=function(e){var t=this.filterRange.has(this.parent.activeSheetIndex)&&this.filterRange.get(this.parent.activeSheetIndex).range;if(t&&t[0]===e.rowIndex)for(var r=this.parent.getActiveSheet(),n=t[1];n<=t[3];n++)if(zn(e.rowIndex,n,r,!1,!0).notes){var i=this.parent.getCell(e.rowIndex,n);i&&this.parent.serviceLocator.getService("cell").refresh(e.rowIndex,n,!1,i,!1,!1,!0)}},i}(),np=function(){function r(e){this.parent=e,this.addEventListener(),this.renderImageUpload()}return r.prototype.addEventListener=function(){this.parent.on(wo,this.insertImage,this),this.parent.on(Eo,this.refreshImgCellObj,this),this.parent.on(Ao,this.createImageElement,this),this.parent.on(ko,this.deleteImage,this),this.parent.on(Do,this.refreshInsDelImagePosition,this)},r.prototype.renderImageUpload=function(){var e=this.parent.createElement("input",{id:this.parent.element.id+"_imageUpload",attrs:{type:"file",accept:".image, .jpg, .png, .gif ,jpeg",name:"fileUpload"}});e.style.display="none",this.parent.element.appendChild(e),e.onchange=this.imageSelect.bind(this)},r.prototype.imageSelect=function(e){var t=e.target.files[0];t&&(t.type.includes("image")?this.insertImage({file:t,isAction:!0}):this.parent.serviceLocator.getService(Ll).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant("UnsupportedFile"),width:"300"}),e.target.value="")},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(wo,this.insertImage),this.parent.off(Eo,this.refreshImgCellObj),this.parent.off(Ao,this.createImageElement),this.parent.off(ko,this.deleteImage),this.parent.off(Do,this.refreshInsDelImagePosition))},r.prototype.insertImage=function(e,t){var r=this;this.binaryStringVal(e).then((function(n){return r.createImageElement({options:{src:n},range:t,isPublic:!0,isAction:e.isAction})}))},r.prototype.binaryStringVal=function(e){return new Promise((function(t,r){var n=new FileReader;n.readAsDataURL(e.file),n.onload=function(){return t(n.result)},n.onerror=function(e){return r(e)}}))},r.prototype.createImageElement=function(r){var n=r.range?r.range.lastIndexOf("!"):0,i=r.range?n>0?r.range.substring(n+1):r.range:this.parent.getActiveSheet().selectedRange,o=r.range&&n>0?In(this.parent,r.range.substring(0,n)):this.parent.activeSheetIndex,s=this.parent.serviceLocator.getService(Ml),l=r.options.id?r.options.id:(0,e.getUniqueID)(this.parent.element.id+"_overlay_picture_"),d=t(i),h=(0,e.isUndefined)(o)&&!r.isUndoRedo?this.parent.getActiveSheet():this.parent.sheets[o];if(h&&!this.parent.element.querySelector("#"+l))if(r.isPublic&&Qr(this.parent,d))r.isAction&&this.parent.notify(to,null);else{var p={requestType:"beforeInsertImage",range:h.name+"!"+i,imageData:r.options.src,sheetIndex:o};if(r.isPublic&&this.parent.notify("actionBegin",{eventArgs:p,action:"beforeInsertImage"}),!p.cancel){var c=s.insertOverlayElement(l,i,o);if(c.element.style.backgroundImage="url('"+r.options.src+"')",(r.options.height||r.options.left)&&(c.element.style.height=r.options.height+"px",c.element.style.width=r.options.width+"px",(0,e.isNullOrUndefined)(r.options.top)||(c.element.style.top=Number(tn(r.options.top).toFixed(2))+"px"),(0,e.isNullOrUndefined)(r.options.left)||(c.element.style.left=Number(tn(r.options.left).toFixed(2))+"px"),!r.options.preservePos&&!(0,e.isNullOrUndefined)(r.options.top)&&!(0,e.isNullOrUndefined)(r.options.left))){var u={clientY:r.options.top,isImage:!0},f={clientX:r.options.left,isImage:!0};this.parent.notify(No,u),this.parent.notify(Ro,f);var g=u.clientY,m=f.clientX;if(d[0]!==g||d[1]!==m){var v={prevTop:r.options.top,prevLeft:r.options.left,prevRowIdx:d[0],prevColIdx:d[1],prevHeight:r.options.height,prevWidth:r.options.width,currentTop:r.options.top,currentLeft:r.options.left,currentRowIdx:g,currentColIdx:m,currentHeight:r.options.height,currentWidth:r.options.width,id:r.options.id,requestType:"imagePositionRefresh"};this.refreshImgCellObj(v),d[0]=g,d[1]=m,i=a([g,m])}}(h.frozenRows||h.frozenColumns)&&s.adjustFreezePaneSize(r.options,c.element,i);var y={src:r.options.src,id:l,height:parseFloat(c.element.style.height.replace("px","")),width:parseFloat(c.element.style.width.replace("px","")),top:h.frozenRows||h.frozenColumns?d[0]?bl(h,0,d[0]-1):0:(0,e.isNullOrUndefined)(r.options.top)||r.options.preservePos&&c.top>r.options.top?c.top:r.options.top,left:h.frozenRows||h.frozenColumns?d[1]?Rl(h,0,d[1]-1):0:(0,e.isNullOrUndefined)(r.options.left)||r.options.preservePos&&c.left>r.options.left?c.left:r.options.left};this.parent.setUsedRange(d[0],d[1]);var C=!1;r.isPublic||r.isUndoRedo||y.top===r.options.top&&y.left===r.options.left||(r.options.top=y.top,r.options.left=y.left,C=!0);var b={options:[y],range:h.name+"!"+i,isPositionChanged:C,isElementRemoved:!1};(r.isPublic||r.isUndoRedo||C)&&this.parent.notify(Dt,b),C&&b.isElementRemoved&&((c=s.insertOverlayElement(l,i,o)).element.style.backgroundImage="url('"+r.options.src+"')",r.options.height&&r.options.width&&(c.element.style.height=r.options.height+"px",c.element.style.width=r.options.width+"px"));var x=zn(d[0],d[1],h);x.image[x.image.length-1].id||(x.image[x.image.length-1].id=y.id),!r.isUndoRedo&&r.isPublic&&(p={requestType:"insertImage",range:h.name+"!"+i,imageHeight:r.options.height?r.options.height:300,imageWidth:r.options.width?r.options.width:400,imageData:r.options.src,id:l,sheetIndex:o},this.parent.notify("actionComplete",{eventArgs:p,action:"insertImage"}))}}},r.prototype.refreshInsDelImagePosition=function(e){for(var t,r,n,i=e.count,a=e.sheetIdx,o=this.parent.sheets[a],s=zn(e.rowIdx,e.colIdx,o),l=s.image.length,d=0;d<l;d++)t=document.getElementById(s.image[d].id),r="Row"===e.type?"insert"===e.status?s.image[d].top+20*i:s.image[d].top-20*i:s.image[d].top,n="Column"===e.type?"insert"===e.status?s.image[d].left+64*i:s.image[d].left-64*i:s.image[d].left,s.image[d].top=r,s.image[d].left=n,t&&(t.style.top=r+"px",t.style.left=n+"px")},r.prototype.refreshImgCellObj=function(t){var r,n,i=(0,e.isUndefined)(t.sheetIdx)?this.parent.activeSheetIndex:t.sheetIdx,a=Fn(this.parent,i),o=zn(t.prevRowIdx,t.prevColIdx,a),s=zn(t.currentRowIdx,t.currentColIdx,a),l=o?o.image:[],d=l&&l.length?l.length:0;if(o&&o.image&&l.length>0){for(var h=0;h<d;h++)l[h]&&l[h].id===t.id&&((r=l[h]).height=t.currentHeight,r.width=t.currentWidth,r.top=t.currentTop,r.left=t.currentLeft,l.splice(h,1));if(s&&s.image&&(n=s.image,r&&n.push(r)),jn(t.currentRowIdx,t.currentColIdx,a,n?{image:n}:{image:[r]},!0),"imageRefresh"===t.requestType&&!t.isUndoRedo){var p={requestType:"imageRefresh",currentRowIdx:t.currentRowIdx,currentColIdx:t.currentColIdx,prevRowIdx:t.prevRowIdx,prevColIdx:t.prevColIdx,prevTop:t.prevTop,prevLeft:t.prevLeft,currentTop:t.currentTop,currentLeft:t.currentLeft,currentHeight:t.currentHeight,currentWidth:t.currentWidth,prevHeight:t.prevHeight,prevWidth:t.prevWidth,id:t.id,sheetIdx:this.parent.activeSheetIndex};this.parent.notify("actionComplete",{eventArgs:p,action:"imageRefresh"})}}},r.prototype.deleteImage=function(e){var r,n=e.sheet||this.parent.getActiveSheet(),a=document.getElementById(e.id),o=e.rowIdx,s=e.colIdx;if(a){if(void 0===e.rowIdx&&void 0===e.colIdx){var l=void 0,d=void 0;if(n.frozenRows||n.frozenColumns){var h=a.getBoundingClientRect();l={clientY:h.top},d={clientX:h.left},h.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(l.target=this.parent.getColumnHeaderContent()),h.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(d.target=this.parent.getRowHeaderTable())}else l={clientY:parseFloat(a.style.top),isImage:!0},d={clientX:parseFloat(a.style.left),isImage:!0};this.parent.notify(No,l),this.parent.notify(Ro,d),o=l.clientY,s=d.clientX}if(r=n.name+"!"+i(o,s),!e.preventEventTrigger){var p={address:r,cancel:!1};if(this.parent.notify(K,{action:"deleteImage",eventArgs:p}),p.cancel)return}document.getElementById(e.id).remove()}else if(!e.sheet){var c=e.range?e.range.lastIndexOf("!")>0?e.range.substring(e.range.lastIndexOf("!")+1):e.range:this.parent.getActiveSheet().selectedRange,u=e.range&&e.range.lastIndexOf("!")>0?In(this.parent,e.range.substring(0,e.range.lastIndexOf("!"))):this.parent.activeSheetIndex,f=t(c);o=f[0],s=f[1],n=this.parent.sheets[u]}var g={};if(n){for(var m=zn(o,s,n),v=m&&m.image?m.image:[],y=v.length-1;y>=0;y--)v[y].id===e.id&&(g=v.splice(y,1)[0]);jn(o,s,n,{image:v},!0)}e.preventEventTrigger||this.parent.notify(Pa,{action:"deleteImage",eventArgs:{address:r,id:g.id,imageData:g.src,imageWidth:g.width,imageHeight:g.height,cancel:!1},preventAction:e.isUndoRedo,isClearAction:e.clearAction})},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.getModuleName=function(){return"spreadsheetImage"},r}(),ip=u(60);ip.Chart.Inject(ip.ColumnSeries,ip.LineSeries,ip.BarSeries,ip.AreaSeries,ip.StackingColumnSeries,ip.StackingLineSeries,ip.StackingBarSeries,ip.ScatterSeries),ip.Chart.Inject(ip.StackingAreaSeries,ip.Category,ip.Legend,ip.Tooltip,ip.DataLabel),ip.AccumulationChart.Inject(ip.PieSeries,ip.AccumulationTooltip,ip.AccumulationDataLabel,ip.AccumulationLegend);var ap=function(){function r(e){this.parent=e,this.addEventListener()}return r.prototype.addEventListener=function(){this.parent.on(Pt,this.initiateChartHandler,this),this.parent.on(Fo,this.refreshChartCellObj,this),this.parent.on(To,this.refreshChartCellModel,this),this.parent.on(fr,this.refreshChartCellObj,this),this.parent.on(Oo,this.deleteChart,this),this.parent.on(Mo,this.clearBorder,this),this.parent.on(Bo,this.insertChartHandler,this),this.parent.on(Ho,this.chartRangeHandler,this),this.parent.on(zo,this.chartDesignTabHandler,this),this.parent.on(jo,this.updateChartElement,this),this.parent.on(_o,this.undoRedoForChartDesign,this),this.parent.on(Bt,this.refreshChartData,this)},r.prototype.insertChartHandler=function(e){var t=this,r="Column",n=!1;switch(e.id){case"clusteredColumn":r="Column";break;case"stackedColumn":r="StackingColumn";break;case"stackedColumn100":r="StackingColumn100";break;case"clusteredBar":r="Bar";break;case"stackedBar":r="StackingBar";break;case"stackedBar100":r="StackingBar100";break;case"area":r="Area";break;case"stackedArea":r="StackingArea";break;case"stackedArea100":r="StackingArea100";break;case"line":r="Line";break;case"lineMarker":r="Line",n=!0;break;case"stackedLine":r="StackingLine";break;case"stackedLineMarker":r="StackingLine",n=!0;break;case"stackedLine100":r="StackingLine100";break;case"stackedLine100Marker":r="StackingLine100",n=!0;break;case"pie":r="Pie";break;case"doughnut":r="Doughnut";break;case"scatter":r="Scatter"}var i=[{type:r,markerSettings:{visible:n,isFilled:!0}}];e.isChart?(this.parent.notify(Lt,{chart:i}),zl((function(){return Md(t.parent.element)}))):this.parent.notify(zo,{chartType:r,triggerEvent:!0,markerVisible:n})},r.prototype.chartRangeHandler=function(){var e=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(e)for(var t=e.getElementsByClassName("e-control")[0].id,r=this.parent.chartColl,n=r.length,i=0;i<n;i++){var a=document.getElementById(r[i].id);e&&a&&r[i].id===t&&this.initiateChartHandler({option:r[i],isRefresh:!0})}},r.prototype.refreshChartData=function(r){if(this.parent.chartColl&&this.parent.chartColl.length)for(var n,i,a,o,s,l,d=0,h=this.parent.chartColl.length;d<h;d++){if((n=this.parent.chartColl[d]).range.includes("!")){if(i=n.range.substring(0,n.range.lastIndexOf("!")),this.parent.activeSheetIndex!==In(this.parent,i))continue;a=n.range.substring(n.range.lastIndexOf("!")+1)}else a=n.range;if(r.viewportIndexes){for(var p=0;p<r.viewportIndexes.length;p++)if(Wr([r.viewportIndexes[p]],a)){o=!0;break}}else o=r.range?Wr([r.range],a):r.showHide?this.inRowColumnRange(t(a),r.rIdx,r.showHide):Ar(t(a),r.rIdx,r.cIdx);(o||r.isSelectAll&&!r.isRefreshChart)&&(s=this.parent.element.querySelector("."+n.id))&&(l=(0,e.getComponent)(s,"chart")||(0,e.getComponent)(s,"accumulationchart"))&&(l.series=this.initiateChartHandler({option:n,isRefresh:!0}),l.refresh())}},r.prototype.inRowColumnRange=function(e,t,r){return"rows"===r?t>=e[0]&&t<=e[2]:t>=e[1]&&t<=e[3]},r.prototype.refreshChartCellModel=function(e){for(var t=0,r=e.prevChartIndexes.length;t<r;t++){var n=e.prevChartIndexes[t].chart,i=e.prevChartIndexes[t].chartRowIdx,a=e.prevChartIndexes[t].chartColIdx,o=e.currentChartIndexes[t].chartRowIdx,s=e.currentChartIndexes[t].chartColIdx,l={prevTop:n.top,prevLeft:n.left,prevRowIdx:i,prevColIdx:a,prevHeight:n.height,prevWidth:n.width,currentTop:n.top,currentLeft:n.left,currentRowIdx:o,currentColIdx:s,currentHeight:n.height,currentWidth:n.width,id:n.id,requestType:"chartRefreshOnFilter"};this.parent.notify(Fo,l)}},r.prototype.refreshChartCellObj=function(t){var r,n,i=(0,e.isUndefined)(t.sheetIdx)?this.parent.activeSheetIndex:t.sheetIdx,a=Fn(this.parent,i),o=zn(t.prevRowIdx,t.prevColIdx,a),s=zn(t.currentRowIdx,t.currentColIdx,a),l=o?o.chart:[],d=l&&l.length?l.length:0;if(d){for(var h=0;h<d;h++)if(l[h].id===t.id.split("_overlay")[0]){(r=l[h]).height=t.currentHeight,r.width=t.currentWidth,r.top=t.currentTop,r.left=t.currentLeft,l.splice(h,1),h--,d--;for(var p=0,c=this.parent.chartColl.length;p<c;p++)r.id===this.parent.chartColl[p].id&&(r.height=t.currentHeight,this.parent.chartColl[p].width=t.currentWidth,this.parent.chartColl[p].top=t.currentTop,this.parent.chartColl[p].left=t.currentLeft)}if(s&&s.chart&&(n=s.chart,r&&n.push(r)),jn(t.currentRowIdx,t.currentColIdx,a,n?{chart:n}:{chart:[r]},!0),"chartRefresh"===t.requestType&&!t.isUndoRedo){var u={requestType:"chartRefresh",currentRowIdx:t.currentRowIdx,currentColIdx:t.currentColIdx,currentWidth:t.currentWidth,prevHeight:t.prevHeight,prevWidth:t.prevWidth,prevRowIdx:t.prevRowIdx,prevColIdx:t.prevColIdx,prevTop:t.prevTop,prevLeft:t.prevLeft,currentTop:t.currentTop,currentLeft:t.currentLeft,currentHeight:t.currentHeight,id:t.id,sheetIdx:i};this.parent.notify("actionComplete",{eventArgs:u,action:"chartRefresh"})}}},r.prototype.processChartRange=function(t,r,n){var i,a,o,s,l,d=this,h=t[0],p=t[1],c=!1,u=t[2],f=t[3],g=h===u,m=p===f,v=Fn(this.parent,r),y=$r(this.parent),C=function(t,n,i,a){var o=zn(t,n,v);if(o){o.formula&&(0,e.isNullOrUndefined)(o.value)&&d.parent.notify(ne,{cell:o,rowIdx:t,colIdx:n,sheetIndex:r});var h=void 0;if(o.format){var p={value:o.value,format:o.format,formattedText:o.value,cell:o,rowIndex:t,colIndex:n};d.parent.notify(re,p);var c=dn(o.value);c&&!Yn(o.format,!0,null,!0)?h=Number(o.value):(a&&c?s=!0:i&&c&&(l=!0),h=p.formattedText&&p.formattedText.toString())}else y(o),h=o.value;return(0,e.isNullOrUndefined)(h)?"":h}return""},b=v?C(h,f,!1,!0):"",x=v?C(u,p,!0):"",S=v?C(h,p,!0):"";if(dn(x)&&S||(c=!0),!(0,e.isNullOrUndefined)(S)&&("Scatter"!==n.type||n.isSeriesInRows)||g||m)if((0,e.isNullOrUndefined)(x)||!c||g||m||s)a=[h,p,u,f],(0,e.isNullOrUndefined)(b)||dn(b)||s?(g||m)&&(0,e.isNullOrUndefined)(S)&&(o=[h,p,h,f],g?(a[1]=Pr(v,a[1]+1,!0,"columns"),o[3]=o[1]):a[0]=Pr(v,a[0]+1,!0)):(o=[h,p,h,f],g||(a[0]=Pr(v,a[0]+1,!0)));else{var w,I=Pr(v,p+1,!0,"columns");if((0,e.isNullOrUndefined)(b)||dn(b)&&S)i=[h,p,u,p],a=[h,I,u,f];else i=[w=Pr(v,h+1,!0),p,u,p],a=[w,I,u,f],o=[h,I,h,f]}else i=[w=Pr(v,h+1,!0),p,u,p],a=[w,I=Pr(v,p+1,!0,"columns"),u,f],o=[h,I,h,f];return{xRange:i,yRange:a,lRange:o,isStringSeries:c,isDateTime:l}},r.prototype.getRangeData=function(r){var n=r.sheet;r.range?"string"==typeof r.range&&(r.range=t(r.range)):r.range=t(n.selectedRange);for(var i,a,o,s=[],l=r.range[0],d=r.isYvalue&&$r(this.parent);l<=r.range[2];)if(ml(n,l))l++;else{for(a=r.range[1];a<=r.range[3];)if(Al(n,a))a++;else{var h=zn(l,a,n,!1,!0);h.formula&&(0,e.isNullOrUndefined)(h.value)&&this.parent.notify(ne,{cell:h,rowIdx:l,colIdx:a,sheetIndex:r.sheetIdx}),r.isYvalue&&d(h),i={value:h.value||(0===h.value?0:null)},h.format?(o={formattedText:h.value,value:h.value,format:h.format,cell:h,skipFormatCheck:!0},this.parent.notify(re,o),r.isYvalue?dn(h.value)?(i.value=Number(h.value),i.displayText=o.formattedText?o.formattedText.toString():""):(i.displayText=null===i.value?"":this.parent.getDisplayText({format:h.format,value:"0"}),i.value=0):r.isScatter&&!r.isDateTime&&dn(h.value)?i.value=Number(h.value):i.value=o.formattedText?o.formattedText.toString():null):r.isYvalue&&(dn(i.value)?(i.displayText=i.value.toString(),i.value=Number(i.value)):(i.displayText=null===i.value?"":"0",i.value=0)),s.push(i),a++}l++}return s},r.prototype.toArrayData=function(e){for(var t,r="value",n=0,i=[],a=e.length;n<a;)t=e[n],Object.keys(t).length?r in t&&i.push(t[""+r]):i.push(""),n++;return i},r.prototype.getVirtualXValues=function(e){for(var t=1,r=[];t<e;)r.push(t.toString()),t++;return r},r.prototype.processChartSeries=function(t,r,n,i,a,o){var s;t=t||{};var l,d,h,p,c,u={name:"displayText"},f={},g=0,m=0,v=this.parent.isPrintingProcessing,y=[];r=(0,e.isNullOrUndefined)(r)?this.parent.activeSheetIndex:r;var C=Fn(this.parent,r),b=t&&"Scatter"===t.type,x=this.getRangeData({range:i,sheet:C,isYvalue:!0,sheetIdx:r}),S=i[2]-i[0]+1-this.parent.hiddenCount(i[0],i[2],"rows",C),w=i[3]-i[1]+1-this.parent.hiddenCount(i[1],i[3],"columns",C);t.isSeriesInRows?(l=a?this.toArrayData(this.getRangeData({range:a,sheet:C,isScatter:b,isDateTime:o})):this.getVirtualXValues(w+1),n&&(d=this.toArrayData(this.getRangeData({range:n,sheet:C}))),h=S):(l=n?this.toArrayData(this.getRangeData({range:n,sheet:C,isScatter:b,isDateTime:o})):this.getVirtualXValues(S+1),a&&(d=this.toArrayData(this.getRangeData({range:a,sheet:C}))),h=w);var I,E=l.length,N=t.isSeriesInRows?1:h;for((0,e.isNullOrUndefined)(t.dataLabelSettings)||(u.visible=t.dataLabelSettings.visible,u.position=t.dataLabelSettings.position);g<h;){for(c=0,p=[],m=t.isSeriesInRows?m:g;c<E;)(0,e.isNullOrUndefined)(l[c])&&(l[c]=(0,e.getUniqueID)("spread-chart-empty-label-")),p.push({x:l[c],y:x[m].value,displayText:x[m].displayText}),m+=N,c++;if(s=d&&d.length>0?d[g]:"Scatter"===t.type?"series"+(g+1):"series"+g,s=(0,e.isNullOrUndefined)(s)?"":s.toString(),t.type){var R=t.type;f="Line"===R||"StackingLine"===R||"StackingLine100"===R?{dataSource:p,type:t.type,xName:"x",yName:"y",name:s,animation:{enable:!v},tooltipMappingName:"displayText",marker:t.markerSettings?{visible:t.markerSettings.visible,width:t.markerSettings.size,height:t.markerSettings.size,shape:t.markerSettings.shape,dataLabel:u,isFilled:t.markerSettings.isFilled,border:t.markerSettings.border,fill:t.markerSettings.isFilled?t.markerSettings.fill:null}:{dataLabel:u}}:"Scatter"===R?{dataSource:p,type:t.type,xName:"x",yName:"y",name:s,tooltipMappingName:"displayText",animation:{enable:!v},marker:{visible:!1,width:12,height:12,shape:"Circle",dataLabel:u}}:"Pie"===R||"Doughnut"===R?{dataSource:p,radius:"100%",xName:"x",yName:"y",innerRadius:"Pie"===t.type?"0%":"40%",dataLabel:{visible:!!u.visible,position:"Outer"===u.position?"Outside":"Inside",name:"displayText",font:{fontWeight:"600"}},animation:{enable:!v},tooltipMappingName:"displayText"}:{dataSource:p,type:t.type,xName:"x",yName:"y",animation:{enable:!v},name:s,marker:{dataLabel:u},tooltipMappingName:"displayText"}}y.push(f),g++}return t.type&&(I={series:y,xRange:t.isSeriesInRows?a:n,yRange:i,lRange:t.isSeriesInRows?n:a}),I},r.prototype.getAxisFormat=function(t){var r="";if(!(0,e.isNullOrUndefined)(t)){var n=zn(t[0],t[1],this.parent.getActiveSheet());n&&n.format&&(r=n.format)}return r},r.prototype.focusChartRange=function(e,t,r){var n,i=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"];this.clearBorder();var a=this.parent.getActiveSheet(),o=!(!a.frozenRows&&!a.frozenColumns);r&&(o?n=r:this.parent.notify(Po,{startcell:{rowIndex:r[0],colIndex:r[1]},endcell:{rowIndex:r[2],colIndex:r[3]},classes:[i[0],i[1]]})),e&&(o?n?(n[0]=Math.min(r[0],e[0]),n[1]=Math.min(r[1],e[1]),n[2]=Math.max(r[2],e[2]),n[3]=Math.max(r[3],e[3])):n=e:this.parent.notify(Po,{startcell:{rowIndex:e[0],colIndex:e[1]},endcell:{rowIndex:e[2],colIndex:e[3]},classes:[i[2],i[3]]})),o&&n?this.parent.notify(Po,{startcell:{rowIndex:Math.min(n[0],t[0]),colIndex:Math.min(n[1],t[1])},endcell:{rowIndex:Math.max(n[2],t[2]),colIndex:Math.max(n[3],t[3])},classes:[i[4],i[5]]}):this.parent.notify(Po,{startcell:{rowIndex:t[0],colIndex:t[1]},endcell:{rowIndex:t[2],colIndex:t[3]},classes:[i[4],i[5]]})},r.prototype.clearBorder=function(){var t=this.parent.getActiveSheet();if(t.frozenColumns||t.frozenRows)[].slice.call(this.parent.element.getElementsByClassName("e-chart-range")).forEach((function(t){(0,e.detach)(t)}));else for(var r=this.parent.getMainContent(),n=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"],i=0,a=n.length;i<a;i++)for(var o=r.querySelectorAll("."+n[i]),s=0,l=o.length;s<l;s++){o[s].classList.remove(n[i])}},r.prototype.initiateChartHandler=function(r){var n,i,a=this,o=r.option;n=!!(0,e.isNullOrUndefined)(r.isInitCell)||!r.isInitCell,r.triggerEvent=!!(0,e.isNullOrUndefined)(r.triggerEvent)||r.triggerEvent,r.isRefresh=!(0,e.isNullOrUndefined)(r.isRefresh)&&r.isRefresh;var s,l,d=o.range&&o.range.lastIndexOf("!")>0?In(this.parent,o.range.substring(0,o.range.lastIndexOf("!"))):this.parent.activeSheetIndex,h=Fn(this.parent,d),c=o.range?o.range:this.parent.getActiveSheet().selectedRange,u=t(c),f={};if(!this.parent.allowChart&&h.isProtected)return i;var g={sheetIndex:d,reqType:"shape",type:"actionBegin",shapeType:"chart",action:"create",options:o,range:c,operation:"create"};(c=g.range,f=(f=g.options)||{},u.length>0&&!r.isRefresh&&n)&&(u[2]-u[0]<u[3]-u[1]&&(s=!0));f.isSeriesInRows=!!s||!!f.isSeriesInRows&&f.isSeriesInRows,r.dataSheetIdx=(0,e.isNullOrUndefined)(r.dataSheetIdx)?d:r.dataSheetIdx;var m=this.processChartRange(u,r.dataSheetIdx,f),v=m.xRange,y=m.yRange,C=m.lRange;if(d===this.parent.activeSheetIndex&&n&&this.focusChartRange(v,y,C),r.triggerEvent&&!r.isRefresh){if(l={type:o.type,theme:o.theme,isSeriesInRows:o.isSeriesInRows,range:o.range,markerSettings:f.markerSettings,dataLabelSettings:f.dataLabelSettings,title:f.title,legendSettings:f.legendSettings,primaryXAxis:f.primaryXAxis,primaryYAxis:f.primaryYAxis,id:o.id,height:o.height,width:o.width,posRange:r.range,isInitCell:r.isInitCell,cancel:!1,top:o.top,left:o.left},this.parent.notify(K,{eventArgs:l,action:"beforeInsertChart"}),l.cancel)return[];o.type=l.type,o.theme=l.theme,o.isSeriesInRows=l.isSeriesInRows,o.markerSettings=l.markerSettings,o.range=l.range,o.id=l.id,o.height=l.height,o.width=l.width}var b=this.processChartSeries(f,r.dataSheetIdx,v,y,C,m.isDateTime),x={majorGridLines:o.primaryXAxis&&o.primaryXAxis.majorGridLines&&!(0,e.isNullOrUndefined)(o.primaryXAxis.majorGridLines.width)?{width:o.primaryXAxis.majorGridLines.width}:{width:0},minorGridLines:o.primaryXAxis&&o.primaryXAxis.minorGridLines&&!(0,e.isNullOrUndefined)(o.primaryXAxis.minorGridLines.width)?{width:o.primaryXAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:o.primaryXAxis&&o.primaryXAxis.minorGridLines&&o.primaryXAxis.minorGridLines.width>0?5:0,lineStyle:{width:0},valueType:"Scatter"!==o.type||m.isStringSeries||o.isSeriesInRows?"Category":"Double",rangePadding:"Scatter"!==o.type||m.isStringSeries||o.isSeriesInRows?"Auto":"Round",visible:!o.primaryXAxis||o.primaryXAxis.visible,title:o.primaryXAxis?o.primaryXAxis.title:"",crossesAt:0,edgeLabelPlacement:"Shift"},S={lineStyle:{width:0},majorGridLines:o.primaryYAxis&&o.primaryYAxis.majorGridLines&&!(0,e.isNullOrUndefined)(o.primaryYAxis.majorGridLines.width)?{width:o.primaryYAxis.majorGridLines.width}:{width:1},minorGridLines:o.primaryYAxis&&o.primaryYAxis.minorGridLines&&!(0,e.isNullOrUndefined)(o.primaryYAxis.minorGridLines.width)?{width:o.primaryYAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:o.primaryYAxis&&o.primaryYAxis.minorGridLines&&o.primaryYAxis.minorGridLines.width>0?5:0,visible:!o.primaryYAxis||o.primaryYAxis.visible,title:o.primaryYAxis?o.primaryYAxis.title:"",crossesAt:0,edgeLabelPlacement:"Shift"};if(r.isRefresh){if(r.isSwitchRowColumn&&"Scatter"===o.type){var w=this.parent.element.querySelector("."+o.id);if(w)(0,e.getComponent)(w,"chart").primaryXAxis.valueType=m.isStringSeries||o.isSeriesInRows?"Category":"Double"}return b.series}var I=o.id+"_overlay",E=this.parent.serviceLocator.getService(Ml),N=!(0,e.isNullOrUndefined)(r.isInitCell)&&r.isInitCell?r.range:c,R=E.insertOverlayElement(I,N,r.isChangeChartType?this.parent.activeSheetIndex:p(this.parent,N));R.element.classList.add("e-datavisualization-chart"),R.element.style.width=o.width+"px",R.element.style.height=o.height+"px",h&&(h.frozenRows||h.frozenColumns)?E.adjustFreezePaneSize(o,R.element,N):((0,e.isNullOrUndefined)(o.top)?o.top=R.top:R.element.style.top=Number(tn(o.top).toFixed(2))+"px",(0,e.isNullOrUndefined)(o.left)?o.left=R.left:R.element.style.left=Number(tn(o.left).toFixed(2))+"px"),this.parent.notify(Zo,{height:o.height,width:o.width});var A="Pie"===o.type||"Doughnut"===o.type?{position:"Bottom",visible:!0}:{};(0,e.isNullOrUndefined)(o.legendSettings)||(A.visible=o.legendSettings.visible,A.position=o.legendSettings.position);var k=this.parent.createElement("div",{id:o.id,className:o.id}),O=o.theme||"Material",F=this.getAxisFormat(y),T=this.getAxisFormat(v),D=2*Math.round(parseFloat(getComputedStyle(R.element).borderWidth)),L=parseFloat(R.element.style.height)-(isNaN(D)?0:D)+"px";return"Pie"!==o.type&&"Doughnut"!==o.type?(this.chart=new ip.Chart({primaryXAxis:x,primaryYAxis:S,background:this.getThemeBgColor(O),chartArea:{border:{width:0}},title:o.title,legendSettings:A,theme:O,series:b.series,tooltip:{enable:!0,format:"${point.x} : <b>${point.tooltip}</b>"},width:R.element.style.width,height:L,enableRtl:this.parent.enableRtl,load:function(e){e.chart.theme=o.theme||"Material"},beforeResize:function(e){e.cancelResizedEvent=!0},tooltipRender:function(e){if(m.isDateTime){var t=e.point.x&&a.isDateTimeNegativeValue(e.point.x.toString()),r=e.point.tooltip&&a.isDateTimeNegativeValue(e.point.tooltip.toString());if(t||r){var n=e.point,i=t?n.xValue:e.point.x,o=r?n.yValue:e.point.tooltip;e.text=i+" : <b>"+o+"</b>"}}},axisLabelRender:function(t){"primaryYAxis"===t.axis.name&&F&&!o.type.includes("100")&&!(0,e.isNullOrUndefined)(t.value)&&a.parent?t.text=a.parent.getDisplayText({format:F,value:t.value.toString()}):"primaryXAxis"===t.axis.name&&t.text.startsWith("spread-chart-empty-label-")&&(t.text=""),"primaryXAxis"!==t.axis.name||"Scatter"!==o.type||m.isDateTime||(t.axis.labels.length>0&&!dn(t.text)?t.text=(t.axis.labels.indexOf(t.text)+1).toString():T&&!(0,e.isNullOrUndefined)(t.value)&&(t.text=a.parent.getDisplayText({format:T,value:t.value.toString()}))),m.isDateTime&&t.text&&a.isDateTimeNegativeValue(t.text)&&(t.cancel=!0)}}),this.chart.appendTo(k)):(this.chart=new ip.AccumulationChart({title:o.title,legendSettings:A,theme:O,background:this.getThemeBgColor(O),series:b.series,width:R.element.style.width,height:L,center:{x:"50%",y:"50%"},tooltip:{enable:!0,format:"${point.x} : <b>${point.tooltip}</b>"},enableSmartLabels:!0,enableAnimation:!0,enableRtl:this.parent.enableRtl,load:function(e){e.chart.theme=o.theme||"Material"},beforeResize:function(e){e.cancelResizedEvent=!0}}),this.chart.appendTo(k)),R.element.appendChild(k),R.element.classList.contains("e-ss-overlay-active")&&!this.parent.isPrintingProcessing&&this.parent.notify(Uo,{id:R.element.id}),r.triggerEvent&&this.parent.notify(Pa,{eventArgs:l,action:"insertChart"}),i},r.prototype.isDateTimeNegativeValue=function(e){return e.startsWith("###")&&!e.split("#").join("")},r.prototype.deleteChart=function(r){this.clearBorder();var n=null,a=this.parent.getActiveSheet();if((0,e.isNullOrUndefined)(r.id)?(n=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active"),r.id=n?n.getElementsByClassName("e-control")[0].id:null):(r.id=r.id.includes("overlay")?r.id:r.id+"_overlay",n=document.getElementById(r.id)),!(0,e.isNullOrUndefined)(r.id)){var o,s,l;r.id=r.id.includes("overlay")?r.id:r.id+"_overlay";for(var d,h=!1,p=0,c=this.parent.chartColl.length;p<c;p++)if(this.parent.chartColl[p].id===r.id.split("_overlay")[0]){d=this.parent.chartColl[p];break}var u={id:d.id,range:d.range,type:d.type,markerSettings:d.markerSettings,dataLabelSettings:d.dataLabelSettings,title:d.title,legendSettings:d.legendSettings,primaryXAxis:d.primaryXAxis,primaryYAxis:d.primaryYAxis,theme:d.theme,height:d.height,width:d.width,isSeriesInRows:d.isSeriesInRows,isInitCell:!0,posRange:null,top:d.top,left:d.left,cancel:!1};if(n){var f=void 0,g=void 0;if(a.frozenRows||a.frozenColumns){var m=n.getBoundingClientRect();f={clientY:m.top},g={clientX:m.left},m.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(f.target=this.parent.getColumnHeaderContent()),m.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(g.target=this.parent.getRowHeaderTable())}else f={clientY:parseFloat(n.style.top),isImage:!0},g={clientX:parseFloat(n.style.left),isImage:!0};this.parent.notify(Ut,{id:r.id}),this.parent.notify(No,f),this.parent.notify(Ro,g),h=!0,o=f.clientY,s=g.clientX,a=this.parent.sheets[this.parent.activeSheetIndex]}else{this.parent.notify(Ut,{id:r.id});var v=r.range?r.range.lastIndexOf("!"):0,y=r.range&&v>0?In(this.parent,r.range.substring(0,v)):this.parent.activeSheetIndex,C=t(r.range?v>0?r.range.substring(v+1):r.range:this.parent.getActiveSheet().selectedRange);o=C[0],s=C[1],a=this.parent.sheets[y]}var b=zn(o,s,a);b&&(l=b.chart);var x=l?l.length:null;for(p=0;p<x;p++)r.id===l[p].id+"_overlay"&&(l.splice(p,1),x=l.length);h&&(document.getElementById(r.id).remove(),this.parent.notify(Vo,{})),jn(o,s,a,{chart:l},!0),u.posRange=a.name+"!"+i(o,s),r.isUndoRedo||this.parent.notify(Pa,{eventArgs:u,action:"deleteChart",isClearAction:r.clearAction})}},r.prototype.updateChartModel=function(t,r,n,i,a){var o=r,s=this.parent.chartColl[i].id;if(!(a&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(t)>-1||n&&(0,e.isNullOrUndefined)(n.chart)))for(var l=0,d=n.chart.length;l<d;l++)if(n.chart[l].id===s)switch(t){case"PHAxes":case"PHAxisTitle":(0,e.isNullOrUndefined)(n.chart[l].primaryXAxis)&&(n.chart[l].primaryXAxis={},this.parent.chartColl[i].primaryXAxis={}),"PHAxes"===t?(n.chart[l].primaryXAxis.visible=r.primaryXAxis.visible,this.parent.chartColl[i].primaryXAxis.visible=r.primaryXAxis.visible):"PHAxisTitle"===t&&(n.chart[l].primaryXAxis.title=r.primaryXAxis.title,this.parent.chartColl[i].primaryXAxis.title=r.primaryXAxis.title);break;case"PVAxes":case"PVAxisTitle":(0,e.isNullOrUndefined)(n.chart[l].primaryYAxis)&&(n.chart[l].primaryYAxis={},this.parent.chartColl[i].primaryYAxis={}),"PVAxes"===t?(n.chart[l].primaryYAxis.visible=r.primaryYAxis.visible,this.parent.chartColl[i].primaryYAxis.visible=r.primaryYAxis.visible):"PVAxisTitle"===t&&(n.chart[l].primaryYAxis.title=r.primaryYAxis.title,this.parent.chartColl[i].primaryYAxis.title=r.primaryYAxis.title);break;case"ChartTitleNone":case"ChartTitleAbove":n.chart[l].title=r.title,this.parent.chartColl[i].title=r.title;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if((0,e.isNullOrUndefined)(n.chart[l].dataLabelSettings)&&(n.chart[l].dataLabelSettings={},this.parent.chartColl[i].dataLabelSettings={}),"DLNone"===t)n.chart[l].dataLabelSettings.visible=!1,this.parent.chartColl[i].dataLabelSettings.visible=!1;else{n.chart[l].dataLabelSettings.visible=!0,this.parent.chartColl[i].dataLabelSettings.visible=!0;var h=void 0;h=a?"Outside"===o.series[0].dataLabel.position?"Outer":"Middle":r.series[0].marker.dataLabel.position,n.chart[l].dataLabelSettings.position=h,this.parent.chartColl[i].dataLabelSettings.position=h}break;case"GLMajorHorizontal":(0,e.isNullOrUndefined)(n.chart[l].primaryYAxis)&&(n.chart[l].primaryYAxis={},this.parent.chartColl[i].primaryYAxis={}),(0,e.isNullOrUndefined)(n.chart[l].primaryYAxis.majorGridLines)&&(n.chart[l].primaryYAxis.majorGridLines={},this.parent.chartColl[i].primaryYAxis.majorGridLines={}),n.chart[l].primaryYAxis.majorGridLines.width=r.primaryYAxis.majorGridLines.width,this.parent.chartColl[i].primaryYAxis.majorGridLines.width=r.primaryYAxis.majorGridLines.width;break;case"GLMajorVertical":(0,e.isNullOrUndefined)(n.chart[l].primaryXAxis)&&(n.chart[l].primaryXAxis={},this.parent.chartColl[i].primaryXAxis={}),(0,e.isNullOrUndefined)(n.chart[l].primaryXAxis.majorGridLines)&&(n.chart[l].primaryXAxis.majorGridLines={},this.parent.chartColl[i].primaryXAxis.majorGridLines={}),n.chart[l].primaryXAxis.majorGridLines.width=r.primaryXAxis.majorGridLines.width,this.parent.chartColl[i].primaryXAxis.majorGridLines.width=r.primaryXAxis.majorGridLines.width;break;case"GLMinorHorizontal":(0,e.isNullOrUndefined)(n.chart[l].primaryYAxis)&&(n.chart[l].primaryYAxis={},this.parent.chartColl[i].primaryYAxis={}),(0,e.isNullOrUndefined)(n.chart[l].primaryYAxis.minorGridLines)&&(n.chart[l].primaryYAxis.minorGridLines={},this.parent.chartColl[i].primaryYAxis.minorGridLines={}),n.chart[l].primaryYAxis.minorGridLines.width=r.primaryYAxis.minorGridLines.width,this.parent.chartColl[i].primaryYAxis.minorGridLines.width=r.primaryYAxis.minorGridLines.width;break;case"GLMinorVertical":(0,e.isNullOrUndefined)(n.chart[l].primaryXAxis)&&(n.chart[l].primaryXAxis={},this.parent.chartColl[i].primaryXAxis={}),(0,e.isNullOrUndefined)(n.chart[l].primaryXAxis.minorGridLines)&&(n.chart[l].primaryXAxis.minorGridLines={},this.parent.chartColl[i].primaryXAxis.minorGridLines={}),n.chart[l].primaryXAxis.minorGridLines.width=r.primaryXAxis.minorGridLines.width,this.parent.chartColl[i].primaryXAxis.minorGridLines.width=r.primaryXAxis.minorGridLines.width;break;case"LegendNone":case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":if((0,e.isNullOrUndefined)(n.chart[l].legendSettings)&&(n.chart[l].legendSettings={},this.parent.chartColl[i].legendSettings={}),n.chart[l].legendSettings.visible=r.legendSettings.visible,this.parent.chartColl[i].legendSettings.visible=r.legendSettings.visible,"LegendNone"!==t){n.chart[l].legendSettings.position=r.legendSettings.position,this.parent.chartColl[i].legendSettings.position=r.legendSettings.position;break}}},r.prototype.updateChartElement=function(e,t,r,n,i,a,o,s){if(!(a&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1)){var l;switch(e){case"PHAxes":t.primaryXAxis.visible=!t.primaryXAxis.visible;break;case"PVAxes":t.primaryYAxis.visible=!t.primaryYAxis.visible;break;case"PHAxisTitle":t.primaryXAxis.title=i;break;case"PVAxisTitle":t.primaryYAxis.title=i;break;case"ChartTitleNone":t.title="";break;case"ChartTitleAbove":t.title=i;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if(l=t.series,"DLNone"===e)for(var d=0,h=l.length;d<h;d++)a?l[d].dataLabel.visible=!1:l[d].marker.dataLabel.visible=!1;else for(d=0,h=l.length;d<h;d++)if(a){var p="DLOutsideend"===e?"Outside":"Inside";l[d].dataLabel.visible=!0,l[d].dataLabel.position=p}else{p="DLCenter"===e?"Middle":"DLInsideend"===e?"Top":"DLInsidebase"===e?"Bottom":"DLOutsideend"===e?"Outer":l[0].marker.dataLabel.position;l[d].marker.dataLabel.visible=!0,l[d].marker.dataLabel.position=p}t.series=l,a&&t.refresh();break;case"GLMajorHorizontal":t.primaryYAxis.majorGridLines.width=0===t.primaryYAxis.majorGridLines.width?1:0;break;case"GLMajorVertical":t.primaryXAxis.majorGridLines.width=0===t.primaryXAxis.majorGridLines.width?1:0;break;case"GLMinorHorizontal":t.primaryYAxis.minorTicksPerInterval=0===t.primaryYAxis.minorGridLines.width?5:0,t.primaryYAxis.minorGridLines.width=0===t.primaryYAxis.minorGridLines.width?1:0;break;case"GLMinorVertical":t.primaryXAxis.minorTicksPerInterval=0===t.primaryXAxis.minorGridLines.width?5:0,t.primaryXAxis.minorGridLines.width=0===t.primaryXAxis.minorGridLines.width?1:0;break;case"LegendNone":t.legendSettings.visible=!1;break;case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":t.legendSettings.visible=!0,t.legendSettings.position="LegendsRight"===e?"Right":"LegendsLeft"===e?"Left":"LegendsBottom"===e?"Bottom":"LegendsTop"===e?"Top":t.legendSettings.position}if(this.updateChartModel(e,t,r,n,a),s){var c={addChartEle:e,id:t.element.id+"_overlay",title:i,address:o};this.parent.notify(Pa,{action:"chartDesign",eventArgs:c})}}},r.prototype.undoRedoForChartDesign=function(t){var r=document.getElementById(t.id);if(r){var n=this.getChartElement(r),i=(0,e.getComponent)(n,"chart");(0,e.isNullOrUndefined)(i)&&(i=(0,e.getComponent)(n,"accumulationchart"));var a=this.parent.getAddressInfo(t.address),o=zn(a.indices[0],a.indices[1],Fn(this.parent,a.sheetIndex));if(!o||!(0,e.isNullOrUndefined)(o.chart)){for(var s,l=this.getChartCollectionId(n.id),d=t.addChartEle,h=t.title,p=0;p<t.beforeActionData.cellDetails[0].chart.length;p++)if(n.id===t.beforeActionData.cellDetails[0].chart[p].id){s=t.beforeActionData.cellDetails[0].chart[p];break}var c=!(0,e.isNullOrUndefined)(s.markerSettings)&&s.markerSettings.visible;if(t.switchRowColumn)this.switchRowColumn(l,n.id,i,o);else if(t.chartTheme)this.switchChartTheme(l,n.id,t.isUndo?s.theme:t.chartTheme,i,o);else if(t.chartType)this.switchChartType(l,n.id,t.isUndo?s.type:t.chartType,i,o,!1,t.isUndo?c:t.chartMarker,"undoRedo");else if(t.addChartEle){if(t.isUndo){var u=void 0;switch(d){case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":d="Middle"===(u=s.dataLabelSettings&&s.dataLabelSettings.position)?"DLCenter":"Top"===u?"DLInsideend":"Bottom"===u?"DLInsidebase":"Outer"===u?"DLOutsideend":"DLNone";break;case"LegendNone":case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":s.legendSettings&&!s.legendSettings.visible?u="LegendNone":d="Right"===(u=s.legendSettings&&s.legendSettings.position)?"LegendsRight":"Left"===u?"LegendsLeft":"Bottom"===u?"LegendsBottom":"Top"===u?"LegendsTop":"LegendsBottom";break;case"PVAxisTitle":h=s.primaryYAxis&&s.primaryYAxis.title;break;case"PHAxisTitle":h=s.primaryXAxis&&s.primaryXAxis.title;break;case"ChartTitleNone":case"ChartTitleAbove":h=s.title}}this.updateChartElement(d,i,o,l,h,null,t.address)}}}},r.prototype.chartDesignTabHandler=function(t){var r=!1,n=this.parent.sheets[this.parent.activeSheetIndex],a=t.switchRowColumn,o=t.chartType,s=t.chartTheme,l=t.addChartEle,d=null,h=t.id?document.getElementById(t.id):document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(h){var p,c,u="ChartTitleAbove"===l||"PHAxisTitle"===l||"PVAxisTitle"===l;if(n.frozenRows||n.frozenColumns){var f=h.getBoundingClientRect();p={clientY:f.top},c={clientX:f.left},f.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(p.target=this.parent.getColumnHeaderContent()),f.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(c.target=this.parent.getRowHeaderTable())}else p={clientY:h.offsetTop,isImage:!0},c={clientX:h.offsetLeft,isImage:!0};this.parent.notify(No,p),this.parent.notify(Ro,c);var g=zn(p.clientY,c.clientX,n);if(!g||!(0,e.isNullOrUndefined)(g.chart)){var m=n.name+"!"+i(p.clientY,c.clientX);if(t.triggerEvent){var v={switchRowColumn:t.switchRowColumn,chartType:t.chartType,chartTheme:t.chartTheme,addChartEle:t.addChartEle,id:h.id,address:m,cancel:!1};if(this.parent.notify(K,{action:"chartDesign",eventArgs:v}),v.cancel)return}var y=this.getChartElement(h),C=y.getAttribute("id"),b=this.getChartCollectionId(C);if(y&&(d=(0,e.getComponent)(y,"chart"),(0,e.isNullOrUndefined)(d)&&(d=(0,e.getComponent)(y,"accumulationchart"),r=!0)),a&&this.switchRowColumn(b,C,d,g),o&&this.switchChartType(b,C,o,d,g,t.markerVisible),s&&this.switchChartTheme(b,C,s,d,g),l)if(u&&!t.title){if(this.parent.element.getElementsByClassName("e-title-dlg").length>0)return;this.titleDlgHandler(l,d,g,b,r,m,t.triggerEvent)}else this.updateChartElement(l,d,g,b,t.title,r);if(t.triggerEvent&&!u){v={switchRowColumn:t.switchRowColumn,chartType:t.chartType,chartMarker:t.markerVisible,chartTheme:t.chartTheme,addChartEle:t.addChartEle,id:h.id,address:m};this.parent.notify(Pa,{action:"chartDesign",eventArgs:v})}}}},r.prototype.switchRowColumn=function(t,r,n,i){var a=this.parent.chartColl[t];a.isSeriesInRows=!!(0,e.isNullOrUndefined)(a.isSeriesInRows)||!a.isSeriesInRows;for(var o=0,s=i.chart.length;o<s;o++)i.chart[o].id===r&&(i.chart[o].isSeriesInRows=a.isSeriesInRows);var l=this.initiateChartHandler({option:a,isRefresh:!0,isSwitchRowColumn:!0});n.series=l},r.prototype.switchChartTheme=function(e,t,r,n,i){this.parent.chartColl[e].theme=r;for(var a=0,o=i.chart.length;a<o;a++)i.chart[a].id===t&&(i.chart[a].theme=r);n.setProperties({theme:r,background:this.getThemeBgColor(r)},!0),n.refresh()},r.prototype.getThemeBgColor=function(e){var t;if(e.includes("Dark"))switch(e){case"MaterialDark":t="#383838";break;case"FabricDark":t="#242424";break;case"BootstrapDark":t="#1b1b1b";break;case"Bootstrap5Dark":t="#212529";break;case"TailwindDark":t="#1f2937";break;case"Tailwind3Dark":t="#111827";break;case"FluentDark":t="#1b1a19";break;case"Fluent2Dark":t="#292929";break;case"Material3Dark":t="#1C1B1F"}else t=e.includes("HighContrast")?"#000000":"#FFFFFF";return t},r.prototype.switchChartType=function(t,r,n,i,a,o,s,l){var d=this.parent.chartColl[t].type;this.parent.chartColl[t].type=n;for(var h=0,p=a.chart.length;h<p;h++)a.chart[h].id===r&&(a.chart[h].type=n,(0,e.isNullOrUndefined)(a.chart[h].markerSettings)||(a.chart[h].markerSettings.visible=o));if("Pie"!==n&&"Doughnut"!==n)if("Pie"===d||"Doughnut"===d)(0,e.isNullOrUndefined)(this.parent.chartColl[t].markerSettings)?!o||"Line"!==n&&"StackingLine"!==n&&"StackingLine100"!==n||(this.parent.chartColl[t].markerSettings={shape:"Circle",visible:!0,isFilled:!1}):this.parent.chartColl[t].markerSettings.visible=o||"undoRedo"===l&&s,this.changeCharType(t);else{if(d!==n)if("Scatter"===n){var c=i.primaryXAxis.labels;c&&c.length>0&&dn(c[c.length-1])&&(i.primaryXAxis.valueType="Double")}else"Double"===i.primaryXAxis.valueType&&(i.primaryXAxis.valueType="Category");for(var u="Line"===n||"StackingLine"===n||"StackingLine100"===n,f=(h=0,(g=i.series).length);h<f;h++)g[h].type=n,u?(g[h].marker.visible=o,g[h].marker.shape=(0,e.isNullOrUndefined)(g[h].marker.shape)?"Circle":g[h].marker.shape,"undoRedo"===l&&(g[h].marker.visible=s)):g[h].marker.visible=!1;i.series=g,i.refresh()}else if("Pie"===d||"Doughnut"===d){var g;for(h=0,f=(g=i.series).length;h<f;h++)g[h].innerRadius="Pie"===n?"0%":"40%";i.series=g,i.refresh()}else this.changeCharType(t)},r.prototype.getChartElement=function(t){var r=t.querySelector(".e-chart");return(0,e.isNullOrUndefined)(r)&&(r=t.querySelector(".e-accumulationchart")),r},r.prototype.getChartCollectionId=function(e){for(var t,r=0,n=this.parent.chartColl.length;r<n;r++)e===this.parent.chartColl[r].id&&(t=r);return t},r.prototype.changeCharType=function(t){var r=document.getElementById(this.parent.chartColl[t].id),n=(0,e.closest)(r,".e-datavisualization-chart");n.remove(),this.initiateChartHandler({option:this.parent.chartColl[t],isInitCell:!1,triggerEvent:!1,isPaste:!1,isChangeChartType:!0}),r=document.getElementById(this.parent.chartColl[t].id),(n=(0,e.closest)(r,".e-datavisualization-chart")).classList.contains("e-ss-overlay-active")||n.classList.add("e-ss-overlay-active")},r.prototype.titleDlgHandler=function(e,t,r,n,i,a,o){var s=this,l="";if(!i||"PHAxisTitle"!==e&&"PVAxisTitle"!==e){var d=this.parent.serviceLocator.getService(Dl),h=this.parent.serviceLocator.getService(Ll);h.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-title-dlg",header:"chart_abovechart"===e?d.getConstant("ChartTitle"):"PHAxisTitle"===e?d.getConstant("HorizontalAxisTitle"):d.getConstant("VerticalAxisTitle"),beforeOpen:function(){h.dialogInstance.content=s.titleDlgContent(e,t),h.dialogInstance.dataBind(),s.parent.element.focus()},buttons:[{buttonModel:{content:d.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn e-clearall-btn e-flat"},click:function(){var i=s.parent.element.querySelector(".e-title-dlg").getElementsByClassName("e-title-dlg-content")[0];l=i.getElementsByTagName("input")[0].value,h.hide(),s.updateChartElement(e,t,r,n,l,null,a,o)}}]}),h.dialogInstance.refresh()}},r.prototype.titleDlgContent=function(e,t){var r=this.parent.serviceLocator.getService(Dl),n=this.parent.createElement("div",{className:"e-title-dlg-content"}),i=this.parent.createElement("span",{className:"e-header e-top-header"});i.innerText=r.getConstant("EnterTitle");var a=this.parent.createElement("input",{className:"e-input",id:"titleInput",attrs:{type:"text"}});return n.appendChild(i),n.appendChild(a),t&&(a.value="PHAxisTitle"===e?t.primaryXAxis.title?t.primaryXAxis.title:a.value:"PVAxisTitle"===e?t.primaryYAxis.title?t.primaryYAxis.title:a.value:t.title?t.title:a.value),n},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Pt,this.initiateChartHandler),this.parent.off(Fo,this.refreshChartCellObj),this.parent.off(fr,this.refreshChartCellModel),this.parent.off(To,this.refreshChartCellModel),this.parent.off(Oo,this.deleteChart),this.parent.off(Mo,this.clearBorder),this.parent.off(Bo,this.insertChartHandler),this.parent.off(Ho,this.chartRangeHandler),this.parent.off(zo,this.chartDesignTabHandler),this.parent.off(jo,this.updateChartElement),this.parent.off(_o,this.undoRedoForChartDesign),this.parent.off(Bt,this.refreshChartData))},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null;var t=null;this.chart&&(t=this.chart.element,this.chart.destroy()),t&&(0,e.detach)(t),this.chart=null},r.prototype.getModuleName=function(){return"spreadsheetChart"},r}(),op=function(){function t(e){this.totalSheetCount=[],this.workbookActiveSheetCount=0,this.defaultCellWidth=64,this.defaultCellHeight=19,this.pageCounts=[],this.initialRowCount=0,this.chartHeight=0,this.columnIndex=0,this.rowIndex=0,this.multipleCanvasDataURL=[],this.chartElements=[],this.totalCharts=0,this.isChartLoaded=!1,this.chartLoadedCount=0,this.isImageLoaded=!1,this.totalImages=0,this.imageLoadedCount=0,this.endRow=0,this.isColumn=!0,this.startNewPageCount=0,this.allowTimer=!1,this.parent=e}return t.prototype.print=function(t,r){var n=this;if(t.isPrintingProcessing=!0,this.multipleCanvasDataURL=[],this.chartElements=[],"ActiveSheet"===r.type){var a=t.sheets[t.activeSheetIndex];this.activeSheetPrint(t,a,r,t.activeSheetIndex)}else{this.totalSheetCount=[],this.workbookActiveSheetCount=1;for(var o=0;o<t.sheets.length;o++){if("Visible"===t.sheets[o].state)if(this.totalSheetCount.push(o),this.totalSheetCount.length>1&&this.parent.sheets[o].ranges.length>0)if(this.parent.sheets[o].ranges.some((function(t){return!(0,e.isNullOrUndefined)(t.dataSource)}))){this.allowTimer=!0;a=t.sheets[o];var l=s(i(0,0)+":"+i(a.rowCount-1,a.colCount-1));this.parent.notify(_,{sheet:a,indexes:l})}}this.allowTimer?(this.allowTimer=!1,setTimeout((function(){n.activeSheetPrint(t,t.sheets[n.totalSheetCount[0]],r,n.totalSheetCount[0])}),2e3)):this.activeSheetPrint(t,t.sheets[this.totalSheetCount[0]],r,this.totalSheetCount[0])}},t.prototype.updateChartRowAndColumnIndices=function(e,t){var r=e.sheets[t];if(this.rowIndex=r.usedRange.rowIndex,this.columnIndex=r.usedRange.colIndex,e.chartColl.length>0)for(var n=0;n<e.chartColl.length;n++){var i=e.chartColl[n];if(t===In(e,i.range.substring(0,i.range.lastIndexOf("!")))){var a={clientX:i.left,isImage:!0},o={clientY:i.top,isImage:!0};e.notify(No,o),e.notify(Ro,a),o.clientY>r.usedRange.rowIndex&&(this.rowIndex=Math.max(this.rowIndex,o.clientY)),a.clientX>r.usedRange.colIndex&&(this.columnIndex=Math.max(this.columnIndex,a.clientX))}}},t.prototype.activeSheetPrint=function(e,t,r,n){this.updateChartRowAndColumnIndices(e,n),this.pageCounts=this.calculatePageCount(t,1e3,r.allowRowColumnHeader),this.initialRowCount=0,this.parent.currentPrintSheetIndex=n,this.endRow=this.rowIndex+1,this.processCell(0,0,this.endRow,2,[],undefined,undefined,t,this,0,0,!0,n,r)},t.prototype.processCell=function(t,r,n,i,a,s,l,d,h,p,c,u,f,g){var m=this;void 0===p&&(p=0),void 0===c&&(c=0),void 0===u&&(u=!0);var v=g.allowRowColumnHeader,y=37,C=0;this.chartHeight=0;for(var b=!1,x=t;x<this.pageCounts.length;x++){this.chartLoadedCount=0,this.totalCharts=0,this.imageLoadedCount=0,this.totalImages=0,p+=0===x?0:1100,l=document.createElement("canvas"),s=l.getContext("2d"),l.width=1e3,l.height=1100,s.font="11pt Calibri",s.textBaseline="bottom",s.index=x,s.width=1e3,(u||!this.isImageLoaded&&!this.isChartLoaded)&&(a=[],i=0,c=0);for(var S=r;S<this.endRow;S++){u=!0;var w=!1;this.isColumn=this.isColumn?this.isColumn:0===S;var I={borderBottom:"1px solid black"},E=d.rows[S]&&d.rows[S].height||this.defaultCellHeight;this.initialRowCount=S,i=0;var N=0===x?0:this.pageCounts[x-1]+1,R=this.pageCounts[x];c+=(0,e.isNullOrUndefined)(d.rows[S])?this.defaultCellHeight:E+(0===S&&v?this.defaultCellHeight:0);var A=(0,e.isNullOrUndefined)(d.rows[S])?this.defaultCellHeight:d.rows[S]&&d.rows[S].height||this.defaultCellHeight;if(c>1080){if(this.startNewPageCount=S,C=v?E+(0===S&&v?this.defaultCellHeight:0):0,w=!1,this.isColumn=!0,this.isImageLoaded||this.isChartLoaded)break;p+=1100,u&&this.multipleCanvasDataURL.push(l.toDataURL()),u=!0,l=document.createElement("canvas"),s=l.getContext("2d"),l.width=1e3,l.height=1100,s.font="11pt Calibri",s.textBaseline="bottom",s.index=x,s.width=1e3;for(var k=0;k<a.length;k++)void 0!==a[k]&&(a[k]-=c-A);c=v||g.allowGridLines?E+(v?this.defaultCellHeight:0):E}var O={borderBottom:"1px solid black",borderTop:"1px solid black",borderLeft:"1px solid black",borderRight:"1px solid black"},F={borderRight:"1px solid black"};if(v&&this.isColumn)for(var T=N;T<=R;T++){var D=o(T+1),L=T===N?2:1;s.font="11pt Calibri";for(k=0;k<L;k++){var P=0===k&&2===L?y:d.columns[T]&&d.columns[T].hidden?0:d.columns[T]&&d.columns[T].width||this.defaultCellWidth;if(0!==(P=i+P>1e3?P-1-(i+P-1e3):P)){var M=s.measureText(D).width,B=h.calculateTextPosition(M,P,i,"Center"),H=this.defaultCellHeight;s.fillText(T===N&&0===k?"":D,B,H),h.drawBorder(s,O,i,0,P,this.defaultCellHeight),i+=P,a[T]=this.defaultCellHeight,T===R&&(2===L?1===k:0===k)&&(this.isColumn=!(T===R),i=0)}else T===R&&(this.isColumn=!1,i=0)}}if((0,e.isNullOrUndefined)(d.rows[S])||!(0,e.isNullOrUndefined)(d.rows[S].hidden)&&d.rows[S].hidden){if(b||(0,e.isNullOrUndefined)(d.rows[S])){var U={borderBottom:"1px solid black",borderTop:"1px solid black",borderLeft:"1px solid black",borderRight:"1px solid black"};w=c+A+(0===S&&v?this.defaultCellHeight:0)>1080||S===d.rows.length-1||S===this.endRow-1;for(T=N;T<=R;T++){var V=d.rows[S]&&!(0,e.isNullOrUndefined)(d.rows[S].cells)&&d.rows[S].cells[T];(0,e.isNullOrUndefined)(V)||(0,e.isNullOrUndefined)(V.style)||(U=this.setBorderStyle(V,U)),v&&T===N&&(h.rowHeaderText((S+1).toString(),s,h,y,i,U,a[T],this.defaultCellHeight),i+=y);var z=d.columns[T]&&d.columns[T].width||this.defaultCellWidth;z=i+z>1e3?z-1-(i+z-1e3):z,a[T]=isNaN(a[T])?0:a[T],g.allowGridLines?h.drawBorder(s,U,i,a[T],z,A):v&&!g.allowGridLines&&T===R&&h.drawBorder(s,{borderRight:"1px solid black"},i,a[T],z,A),i+=z,T===R&&v&&w&&(h.drawBorder(s,I,0,a[T],i,A),w=!1),a[T]+=A}}}else{if(b){var j=d.rows.slice(S,S+d.rows.length-S).map((function(e){return e&&e.height||m.defaultCellHeight})).reduce((function(e,t){return e+(t||m.defaultCellHeight)}),0);l.height>c+(this.chartHeight-j)?this.endRow+=Math.ceil((this.chartHeight-j)/19):this.endRow+=Math.ceil((l.height-(c+j))/19),b=!1}w=this.endRow===d.rows.length&&(c+(d.rows[S+1]&&d.rows[S+1].height||this.defaultCellHeight)+(0===S&&v?this.defaultCellHeight:0)>1080||S===d.rows.length-1);for(var _,q=function(t){var r=d.rows[S]&&!(0,e.isNullOrUndefined)(d.rows[S].cells)&&d.rows[S].cells[t];if((0,e.isNullOrUndefined)(r)||(0,e.isNullOrUndefined)(r.style)||(O=W.setBorderStyle(r,O)),(0,e.isNullOrUndefined)(d.columns[t])||(0,e.isNullOrUndefined)(d.columns[t].hidden)||!d.columns[t].hidden){var n,u,k=!(0,e.isNullOrUndefined)(d.rows[S].cells)&&!(0,e.isNullOrUndefined)(d.rows[S].cells[t])&&!isNaN(d.rows[S].cells[t].colSpan)&&N>t+d.rows[S].cells[t].colSpan,T=!((0,e.isNullOrUndefined)(d.rows[S].cells)||(0,e.isNullOrUndefined)(d.rows[S].cells[t])||isNaN(d.rows[S].cells[t].rowSpan)||S+d.rows[S].cells[t].rowSpan>W.startNewPageCount||0===W.startNewPageCount),D="",L=(0,e.isNullOrUndefined)(r)||isNaN(r.rowSpan)||k||T?1:Math.max(r.rowSpan,0);if(a[t]=isNaN(a[t])?0:a[t],v&&t===N){s.font="11pt Calibri";var P=a[t];if(L>0)for(var M=0;M<(0===L?1:L);M++)i=0,P+=0===M?0:d.rows[S+M]&&d.rows[S+M-1].height||W.defaultCellHeight,h.rowHeaderText((S+1+M).toString(),s,h,y,i,O,P,d.rows[S+M].height||W.defaultCellHeight),i+=y;else i=0,i+=y}if(!(0,e.isNullOrUndefined)(r)&&r){var B=r.style&&r.style.fontSize||"11pt",H=r.style&&r.style.color||"#000000";if(!isNaN(d.rows[S].cells[t].rowSpan)&&d.rows[S].cells[t].rowSpan>1&&isNaN(d.rows[S+1].cells[t].rowSpan)&&W.parent.merge(""+o(t+1)+(S+1)+":"+o(t+1)+(S+d.rows[S].cells[t].rowSpan-1)),!isNaN(d.rows[S].cells[t].colSpan)&&d.rows[S].cells[t].colSpan>1)if(!(0,e.isNullOrUndefined)(d.rows[S+1])&&!(0,e.isNullOrUndefined)(d.rows[S+1].cells)&&d.rows[S+1].cells.length>0&&!(0,e.isNullOrUndefined)(d.rows[S+1].cells[t])&&isNaN(d.rows[S+1].cells[t].colSpan))W.parent.merge(""+o(t+1)+(S+1)+":"+o(t+1+d.rows[S].cells[t].colSpan-1)+(S+1));else if((0,e.isNullOrUndefined)(d.rows[S].cells[t+1].colSpan))for(var U=1;U<d.rows[S].cells[t].colSpan;U++)d.rows[S].cells[t+U].colSpan=-U;if(n=isNaN(d.rows[S].cells[t].colSpan)||k?1:Math.max(d.rows[S].cells[t].colSpan,0),d.rows[S].cells[t].rowSpan&&!k&&d.rows[S].cells[t].rowSpan<0){var V=d.rows[S+d.rows[S].cells[t].rowSpan].cells[t].colSpan;n=V||n}(t===N||t>0&&d.columns&&d.columns[t-1]&&d.columns[t-1].hidden&&d.rows[S].cells[t-1]&&d.rows[S].cells[t-1].colSpan>1)&&n<=0&&(n=1);var z=r.style&&r.style.backgroundColor||"#ffffff",j=r.style?r.style.textAlign:"";s.font=B,s.fillStyle=H;var q=[];if(n>1){var G=d.columns.slice(t,t+n);for(M=0;M<G.length;M++)q.push(G.hidden?0:G[M]&&G[M].width||W.defaultCellWidth);0===q.length?q.push(W.defaultCellWidth*n):q.length!==n&&(q=q.map((function(e){return e+m.defaultCellWidth*(n-1-q.length)})))}u=n>1?q.reduce((function(e,t){return e+t}),0):1===n?d.columns[t]&&d.columns[t].width||W.defaultCellWidth:0,u=i+u>1e3?u-1-(i+u-1e3):u,A=L>1?d.rows.slice(S,S+L).map((function(e){return e.height||m.defaultCellHeight})).reduce((function(e,t){return e+(t||m.defaultCellHeight)}),0):1===L?E:0;var Y=(r.style&&r.style.verticalAlign||"Bottom").toLowerCase();if(!(0,e.isNullOrUndefined)(r.image)&&r.image.length>0&&W.processImages(x,S,r,l,s,c,W.endRow,E,C,v,g,d,h,i,a,p,f),!(0,e.isNullOrUndefined)(r.chart)&&r.chart.length>0&&W.handleCharts(x,S,r,s,l,c,W.endRow,W.initialRowCount,C,E,v,g,d,h,W.multipleCanvasDataURL,i,a,p,f),(0,e.isNullOrUndefined)(r.value)&&(0,e.isNullOrUndefined)(r.formula)&&(0,e.isNullOrUndefined)(r.hyperlink))h.rowHeaderRect(s,i,a[t],u,A,z);else{var X;if(r.formula&&r.format){"Automatic"===W.parent.calculationMode&&W.parent.notify(pe,{action:"refreshCalculate",rowIndex:S,colIndex:t,value:r.formula,isFormula:wr(r.formula),sheetIndex:f});var K={value:r.value,format:r.format,rowIndex:S,colIndex:t,sheetIndex:W.parent.activeSheetIndex,cell:r,refresh:!0};D=W.parent.workbookNumberFormatModule.getFormattedCell(K),X=""+(j||(K.isRightAlign?"Right":"Left"))}else if(r.format){K={value:r.value,format:r.format,rowIndex:S,colIndex:t,sheetIndex:W.parent.activeSheetIndex,cell:r,refresh:!0};D=W.parent.workbookNumberFormatModule.getFormattedCell(K),X=""+(j||(K.isRightAlign?"Right":"Left"))}else if(r.formula)"Automatic"===W.parent.calculationMode&&W.parent.notify(pe,{action:"refreshCalculate",rowIndex:S,colIndex:t,value:r.formula,isFormula:wr(r.formula),sheetIndex:f}),D=r.value,X=""+(j||"Left");else{(0,e.isNullOrUndefined)(r.hyperlink)||((0,e.isNullOrUndefined)(r.value)?r.value=((0,e.isNullOrUndefined)(r.hyperlink)||"object"!=typeof r.hyperlink)&&r.hyperlink||r.hyperlink.address:((0,e.isNullOrUndefined)(r.value)||""===r.value)&&(r.value="object"==typeof r.hyperlink?r.hyperlink.address:r.hyperlink),H=r.style&&r.style.color||"#00e"),D=r.value;var $=!(0,e.isNullOrUndefined)(r.value)&&""!==r.value&&new RegExp("^[^\\p{L}]*$","u").test(r.value);X=""+(j||($?"Right":"Left"))}var Z=r.style&&r.style.fontSize||"11pt",J=r.style&&r.style.fontFamily||"Calibri",Q=r.style&&r.style.fontStyle||"",ee=r.style&&r.style.fontWeight||"normal";s.font=Q+" "+ee+" "+Z+" "+J;var te=s.measureText(D),re=te.width,ne=te.actualBoundingBoxAscent+te.actualBoundingBoxDescent;if(r.wrap){var ie=W.defaultCellHeight<A?parseInt(Z.replace("pt",""),10)/72*96:A,ae=r.colSpan>1?t+r.colSpan-1:t,oe=gd(Rl(d,t,ae)-(4+(Od(S,t,d)||1)),!0),se=W.wrapText(D,oe,r.style,W.parent.cellStyle),le=1===se.length?A:se.length*ie===A?ie:se.length*ie<A?A-(se.length-1)*ie:ie,de=a[t]+("top"===Y?ie:"middle"===Y&&le>ie+le/4?ie+le/4:le);s.save(),s.beginPath(),s.rect(i,a[t],u,A),s.clip(),s.fillStyle=z,s.fillRect(i,a[t],u,A+("top"===Y?ie:0)),se.forEach((function(e,t){s.fillStyle=H,te=s.measureText(e),re=te.width;var n=h.calculateTextPosition(re,u,i,X,!0),a=de+t*ie;"right"===X.toLowerCase()?(s.textAlign="right",s.fillText(e.trim(),n,a)):s.fillText(e,n,a),h.textDecoration(r,s,n,a,H,te,D,u)})),s.restore()}else{s.save(),s.beginPath(),s.rect(i,a[t],u,A),s.clip(),s.fillStyle=z,s.fillRect(i,a[t],u,A),s.fillStyle=H;var he=h.calculateTextPosition(re,u,i,X),ce=a[t],ue=A/2+ne/2;"top"===Y?s.textBaseline="top":ce+="middle"===Y&&A>ue?ue:A,(0,e.isNullOrUndefined)(r.style)||(ce=!(0,e.isNullOrUndefined)(r.style.borderBottom)&&r.style.borderBottom.indexOf("double")>-1||!(0,e.isNullOrUndefined)(r.style.borderTop)&&r.style.borderTop.indexOf("double")>-1?ce-2:ce,he=!(0,e.isNullOrUndefined)(r.style.borderLeft)&&r.style.borderLeft.indexOf("double")>-1||!(0,e.isNullOrUndefined)(r.style.borderRight)&&r.style.borderRight.indexOf("double")>-1?he+("Left"===X?2:-3):he),s.fillText(D,he,ce),s.restore(),h.textDecoration(r,s,he,ce,H,te,D,u)}}r.style&&(u>0||A>0)&&(r.style.borderBottom||r.style.borderTop||r.style.borderLeft||r.style.borderRight&&((0,e.isNullOrUndefined)(r.rowSpan)&&(0,e.isNullOrUndefined)(r.colSpan)||!(0,e.isNullOrUndefined)(r.rowSpan)&&r.rowSpan>0||!(0,e.isNullOrUndefined)(r.colSpan)&&r.colSpan>0))&&h.drawBorder(s,r.style,i,a[t]<=0?2:a[t],u,A)}var fe=n<=0?u:u||d.columns[t]&&d.columns[t].width||W.defaultCellWidth;g.allowGridLines&&(O.borderRight=t===R&&v?void 0:"1px solid black",h.drawBorder(s,O,i,a[t],fe,A)),i+=fe;var ge=0;if(L>1){ge=a[t];for(U=t;U<t+n;U++){var me=d.rows[S]&&!(0,e.isNullOrUndefined)(d.rows[S].cells)&&d.rows[S].cells[U];me&&!(0,e.isNullOrUndefined)(me.image)?W.processImages(x,S,me,l,s,c,W.endRow,E,C,v,g,d,h,i,a,p,f):me&&!(0,e.isNullOrUndefined)(me.chart)&&W.handleCharts(x,S,me,s,l,c,W.endRow,W.initialRowCount,C,E,v,g,d,h,W.multipleCanvasDataURL,i,a,p,f),me.style&&U===t&&A>0&&(me.style.borderBottom||me.style.borderTop||me.style.borderLeft||me.style.borderRight)&&h.drawBorder(s,me.style,i,a[t],2,A),a[U]=(isNaN(a[U])?0:a[U])+A}t+=n-1}t===R&&v&&h.drawBorder(s,F,i-2,a[t]-ge,2,A),t===R&&v&&w&&!b&&(h.drawBorder(s,I,0,a[t]-ge,i,A),w=!1),L<=1&&(a[t]+=A)}else if(v&&t===N){L=(0,e.isNullOrUndefined)(r)||isNaN(d.rows[S].cells[t].rowSpan)?1:Math.max(d.rows[S].cells[t].rowSpan,0);a[t]=isNaN(a[t])?0:a[t];P=a[t];s.font="11pt Calibri";for(M=0;M<L;M++)i=0,P+=0===M?0:d.rows[S+M]&&d.rows[S+M-1].height||W.defaultCellHeight,h.rowHeaderText((S+1+M).toString(),s,h,y,i,O,P,d.rows[S+M].height||W.defaultCellHeight),i+=y;a[t]+=A}_=t},W=this,T=N;T<=R;T++)q(T),T=_}}if(this.isImageLoaded||this.isChartLoaded){if(this.isImageLoaded||this.isChartLoaded)break}else u&&this.endRow>0&&this.multipleCanvasDataURL.push(l.toDataURL()),r=0,this.pageCounts.length-1===x&&h.canvasPrint(this.parent,f,g)}},t.prototype.setBorderStyle=function(t,r){return r.borderBottom=(0,e.isNullOrUndefined)(t.style.borderBottom)?r.borderBottom:t.style.borderBottom,r.borderTop=(0,e.isNullOrUndefined)(t.style.borderTop)?r.borderTop:t.style.borderTop,r.borderRight=(0,e.isNullOrUndefined)(t.style.borderRight)?r.borderRight:t.style.borderRight,r.borderLeft=(0,e.isNullOrUndefined)(t.style.borderLeft)?r.borderLeft:t.style.borderLeft,r},t.prototype.setToDefault=function(){this.parent.currentPrintSheetIndex=0,this.initialRowCount=0,this.chartHeight=0,this.totalCharts=0,this.totalImages=0,this.chartLoadedCount=0,this.imageLoadedCount=0,this.endRow=0,this.pageCounts=[],this.multipleCanvasDataURL=[],this.chartElements=[],this.isChartLoaded=!1,this.isImageLoaded=!1,this.startNewPageCount=0},t.prototype.handleCharts=function(t,r,n,i,a,o,s,l,d,h,p,c,u,f,g,m,v,y,C){var b=this;if(!(0,e.isNullOrUndefined)(n.chart))for(var x=function(n){S.totalCharts+=1;var s=new Image;n.left=(0,e.isNullOrUndefined)(n.left)?0:n.left,n.top=(0,e.isNullOrUndefined)(n.top)?0:n.top;var l=document.getElementById(n.id);if((0,e.isNullOrUndefined)(l)&&(S.parent.insertChart([n]),l=document.getElementById(n.id),S.chartElements.push(n.id+"_overlay")),!(0,e.isNullOrUndefined)(l)){if(S.chartHeight=n.height,S.initialRowCount+Math.ceil(n.height/19)>S.endRow&&(c.allowRowColumnHeader||c.allowGridLines)&&u.rows.length-1===r){var x=h+(p?S.defaultCellHeight:0);a.height>o+(S.chartHeight-x)?S.endRow+=Math.ceil((S.chartHeight-x)/19):S.endRow+=Math.ceil((a.height-(o+x))/19)}var w=l.cloneNode(!0),I=window.URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(w.childNodes[1])],{type:"image/svg+xml"}));s.onload=function(){var e=Math.ceil(n.left/1e3)-1,r=Math.ceil(n.top/1080)-1,l=n.left+(p?37:0),h=n.top+(p?19:0)+(r>0?d:0);if(i.drawImage(s,e<=0?l:l-1e3*e,r<=0?h:h-1160*r,n.width,n.height),b.chartLoadedCount++,b.chartLoadedCount===b.totalCharts&&(m+=n.width,b.isChartLoaded=!1,!b.isImageLoaded)){g.push(a.toDataURL());var x=b.initialRowCount===u.rows.length-1&&o<1080?u.rows.length:b.initialRowCount,S=b.endRow;b.processCell(t,x+1===S?S:x,S,m,v,i,a,u,f,y,o,!1,C,c)}},s.src=I,S.isChartLoaded=!0}},S=this,w=0,I=n.chart;w<I.length;w++){x(I[w])}},t.prototype.processImages=function(t,r,n,i,a,o,s,l,d,h,p,c,u,f,g,m,v){var y=this;if(!(0,e.isNullOrUndefined)(n.image)){for(var C=function(n){b.totalImages+=1;var s=new Image;if(s.src=n.src,n.left=(0,e.isNullOrUndefined)(n.left)?0:n.left,n.top=(0,e.isNullOrUndefined)(n.top)?0:n.top,b.chartHeight=n.height,b.initialRowCount+Math.ceil(n.height/19)>b.endRow&&(p.allowRowColumnHeader||p.allowGridLines)&&r===c.rows.length-1){var C=l+(h?b.defaultCellHeight:0);i.height>o+(b.chartHeight-C)?b.endRow+=Math.ceil((b.chartHeight-C)/19):b.endRow+=Math.ceil((i.height-(o+C))/19)}s.onload=function(){var e=Math.ceil(n.left/1e3)-1,r=Math.ceil(n.top/1080)-1,l=n.left+(h?37:0),C=n.top+(h?19:0)+(r>0?d:0);if(a.drawImage(s,e<=0?l:l-1e3*e,r<=0?C:C-1160*r,n.width,n.height),y.imageLoadedCount++,y.imageLoadedCount===y.totalImages&&(y.isImageLoaded=!1,f+=n.width,!y.isChartLoaded)){y.multipleCanvasDataURL.push(i.toDataURL());var b=y.initialRowCount===c.rows.length-1&&o<1080?c.rows.length:y.initialRowCount,x=y.endRow;y.processCell(t,b+1===x?x:b,x,f,g,a,i,c,u,m,o,!1,v,p)}},s.onerror=function(){if(y.imageLoadedCount++,y.imageLoadedCount===y.totalImages&&(y.isImageLoaded=!1,!y.isChartLoaded)){y.multipleCanvasDataURL.push(i.toDataURL());var e=y.initialRowCount===c.rows.length-1&&o<1080?c.rows.length:y.initialRowCount,r=y.endRow;y.processCell(t,e+1===r?r:e,r,f,g,a,i,c,u,m,o,!1,v,p)}}},b=this,x=0,S=n.image;x<S.length;x++){C(S[x])}this.isImageLoaded=!0}},t.prototype.textDecoration=function(t,r,n,i,a,o,s,l){""!==s&&(!(0,e.isNullOrUndefined)(t.style)&&!(0,e.isNullOrUndefined)(t.style.textDecoration)&&t.style.textDecoration.toLowerCase().indexOf("underline")>-1||!(0,e.isNullOrUndefined)(t.hyperlink))&&(r.beginPath(),r.moveTo(n,i-3),r.lineTo(n+(o.width>l?l:o.width),i-3),r.strokeStyle=a,r.lineWidth=1,r.stroke())},t.prototype.rowHeaderRect=function(e,t,r,n,i,a){void 0===a&&(a="#ffffff"),e.save(),e.beginPath(),e.rect(t,r,n,i),e.clip(),e.fillStyle=a,e.fillRect(t,r,n,i),e.restore()},t.prototype.rowHeaderText=function(e,t,r,n,i,a,o,s){var l=t.measureText(e).width,d=r.calculateTextPosition(l,n,i,"Center"),h=o;t.save(),t.beginPath(),t.rect(i,o,n,s),t.clip(),t.fillStyle="#000000",t.fillText(e,d,h+s),r.drawBorder(t,a,i,o||0,n,s),t.restore()},t.prototype.canvasPrint=function(t,r,n){var i=this;if("Workbook"===n.type&&this.totalSheetCount.length-1>=this.workbookActiveSheetCount){var a=this.totalSheetCount[this.workbookActiveSheetCount],o=t.sheets[a];this.workbookActiveSheetCount++,this.activeSheetPrint(t,o,n,a)}else{for(var s=0;s<this.chartElements.length;s++){var l=document.getElementById(this.chartElements[s]);(0,e.isNullOrUndefined)(l)||l.remove()}if(this.multipleCanvasDataURL.length>0){var d=navigator.userAgent,h=window.open(" ","_blank","height="+window.outerHeight+",width="+window.outerWidth+",tabbar=no");h.document.write("<html><head><title></title></head><body>");var p=1e3,c=1400;-1!==d.indexOf("Chrome")||-1!==d.indexOf("Safari")||-1!==d.indexOf("Firefox")?(h.document.write("<!DOCTYPE html>"),h.document.write("<html><head><style>html, body {  } img { height: 100%; width: 100%; display: block; }@media print { body {  } img { width:100%; width:100%; box-sizing: border-box; }br, button { display: none; } div{ page-break-inside: avoid; }} @page{ size:"+p.toString()+"px "+c.toString()+"px; }</style></head><body>")):(h.document.write("<!DOCTYPE html>"),h.document.write("<html><head><style>html, body {  } img { height: 100%; width: 100%; }@media print { body {  }img { width:100%; width:100%; box-sizing: border-box; }br, button { display: none; } div{ page-break-inside: avoid; }} @page{ size:"+p.toString()+"px "+c.toString()+"px; }</style></head><body>")),this.multipleCanvasDataURL.forEach((function(e,r){var n=h.document.createElement("canvas");n.width=p,n.height=c;var a=n.getContext("2d"),o=new Image;o.onload=function(){a.drawImage(o,0,0,p,c),r===i.multipleCanvasDataURL.length-1&&(t.isPrintingProcessing=!1,h.print(),h.document.close(),h.close(),t.printModule.setToDefault())},o.src=e,h.document.body.appendChild(n)}))}}},t.prototype.drawBorder=function(t,r,n,i,a,o){var s=r.borderBottom,l=r.borderLeft,d=r.borderRight,h=r.borderTop,p=r.borderColor;t.strokeStyle=p||"black",(0,e.isNullOrUndefined)(s)||-1!==s.indexOf("#FFFFFF")||(t.strokeStyle=s.split(" ")[2],this.drawPath(n,(2===i?-2:i)+o,n+a,(2===i?-2:i)+o,t,s,!1,r,"bottom")),(0,e.isNullOrUndefined)(l)||-1!==l.indexOf("#FFFFFF")||(t.strokeStyle=l.split(" ")[2],this.drawPath(n,i,n,(2===i?-2:i)+o,t,l,!0,r,"left")),(0,e.isNullOrUndefined)(d)||-1!==d.indexOf("#FFFFFF")||(t.strokeStyle=d.split(" ")[2],this.drawPath(n+a,i,n+a,(2===i?-2:i)+o,t,d,!1,r,"right")),(0,e.isNullOrUndefined)(h)||-1!==h.indexOf("#FFFFFF")||(t.strokeStyle=h.split(" ")[2],this.drawPath(n,i,n+a,i,t,h,!0,r,"top"))},t.prototype.drawPath=function(t,r,n,i,a,o,s,l,d){if(a.beginPath(),o.indexOf("dashed")>-1)a.setLineDash([3,2]),a.lineWidth=o.split(" ")[0].split("")[0];else if(o.indexOf("dotted")>-1)a.setLineDash([1,1]),a.lineWidth=o.split(" ")[0].split("")[0];else{if(o.indexOf("double")>-1){a.setLineDash([]);var h=!((0,e.isNullOrUndefined)(l.borderBottom)||(0,e.isNullOrUndefined)(l.borderLeft)||(0,e.isNullOrUndefined)(l.borderRight)||(0,e.isNullOrUndefined)(l.borderTop)),p=!(0,e.isNullOrUndefined)(l.borderBottom)&&!(0,e.isNullOrUndefined)(l.borderLeft)&&(0,e.isNullOrUndefined)(l.borderRight)&&(0,e.isNullOrUndefined)(l.borderTop),c=(0,e.isNullOrUndefined)(l.borderBottom)&&!(0,e.isNullOrUndefined)(l.borderLeft)&&(0,e.isNullOrUndefined)(l.borderRight)&&!(0,e.isNullOrUndefined)(l.borderTop),u=!(0,e.isNullOrUndefined)(l.borderBottom)&&!(0,e.isNullOrUndefined)(l.borderLeft)&&(0,e.isNullOrUndefined)(l.borderRight)&&!(0,e.isNullOrUndefined)(l.borderTop),f=!(0,e.isNullOrUndefined)(l.borderBottom)&&(0,e.isNullOrUndefined)(l.borderLeft)&&!(0,e.isNullOrUndefined)(l.borderRight)&&(0,e.isNullOrUndefined)(l.borderTop),g=(0,e.isNullOrUndefined)(l.borderBottom)&&(0,e.isNullOrUndefined)(l.borderLeft)&&!(0,e.isNullOrUndefined)(l.borderRight)&&!(0,e.isNullOrUndefined)(l.borderTop),m=!(0,e.isNullOrUndefined)(l.borderBottom)&&(0,e.isNullOrUndefined)(l.borderLeft)&&!(0,e.isNullOrUndefined)(l.borderRight)&&!(0,e.isNullOrUndefined)(l.borderTop),v=(0,e.isNullOrUndefined)(l.borderBottom)&&!(0,e.isNullOrUndefined)(l.borderLeft)&&!(0,e.isNullOrUndefined)(l.borderRight)&&!(0,e.isNullOrUndefined)(l.borderTop),y=!(0,e.isNullOrUndefined)(l.borderBottom)&&!(0,e.isNullOrUndefined)(l.borderLeft)&&!(0,e.isNullOrUndefined)(l.borderRight)&&(0,e.isNullOrUndefined)(l.borderTop);a.lineWidth=1;return h?t===n?s?this.drawDoubleBorder(a,t,r,n,i,t+3,r+3,n+3,i-2):this.drawDoubleBorder(a,t,r,n,i,t-3,r+3,n-3,i-2):r===i&&(s?this.drawDoubleBorder(a,t,r,n,i,t+2,r+3,n-2,i+3):this.drawDoubleBorder(a,t,r,n,i,t+2,r-3,n-2,i-3)):p?"left"===d?this.drawDoubleBorder(a,t,r,n,i,t+3,r,n+3,i-2):this.drawDoubleBorder(a,t,r,n,i,t+2,r-3,n,i-3):c?"left"===d?this.drawDoubleBorder(a,t,r,n,i,t+3,r+2,n+3,i):this.drawDoubleBorder(a,t,r,n,i,t+2,r+3,n,i+3):u?"left"===d?this.drawDoubleBorder(a,t,r,n,i,t+3,r+3,n+3,i-2):"top"===d?this.drawDoubleBorder(a,t,r,n,i,t+2,r+3,n,i+3):this.drawDoubleBorder(a,t,r,n,i,t+2,r-3,n,i-3):f?"right"===d?this.drawDoubleBorder(a,t,r,n,i,t-3,r,n-3,i-2):this.drawDoubleBorder(a,t,r,n,i,t,r-3,n-2,i-3):g?"right"===d?this.drawDoubleBorder(a,t,r,n,i,t-3,r+3,n-3,i):this.drawDoubleBorder(a,t,r,n,i,t,r+3,n-2,i+3):m?"right"===d?this.drawDoubleBorder(a,t,r,n,i,t-3,r+3,n-3,i-2):"top"===d?this.drawDoubleBorder(a,t,r,n,i,t,r+3,n-2,i+3):this.drawDoubleBorder(a,t,r,n,i,t,r-3,n-2,i-3):v?"right"===d?this.drawDoubleBorder(a,t,r,n,i,t-3,r+3,n-3,i):"top"===d?this.drawDoubleBorder(a,t,r,n,i,t+3,r+3,n-2,i+3):this.drawDoubleBorder(a,t,r,n,i,t+3,r+3,n+3,i):y?"right"===d?this.drawDoubleBorder(a,t,r,n,i,t-3,r,n-3,i-2):"bottom"===d?this.drawDoubleBorder(a,t,r,n,i,t+2,r-3,n-2,i-3):this.drawDoubleBorder(a,t,r,n,i,t+3,r,n+3,i-2):t===n?this.drawDoubleBorder(a,t,r,n,i,t+("left"===d?3:-3),r,n+("left"===d?3:-3),i):r===i&&this.drawDoubleBorder(a,t,r,n,i,t,r+("top"===d?3:-3),n,i+("top"===d?3:-3)),void a.stroke()}a.setLineDash([]),a.lineWidth=o.split(" ")[0].split("")[0]}a.moveTo(t,r),a.lineTo(n,i),a.stroke()},t.prototype.drawDoubleBorder=function(e,t,r,n,i,a,o,s,l){e.moveTo(t,r),e.lineTo(n,i),e.moveTo(a,o),e.lineTo(s,l)},t.prototype.calculateTextPosition=function(e,t,r,n,i){var a,o=t;if(o>=e)switch(n.toLowerCase()){case"left":a=r+3;break;case"center":a=r+(o-e)/2;break;case"right":a=i?r+(o-3):r+(o-3)-e}else a=e<t?"left"===n.toLowerCase()?r+3:"center"===n.toLowerCase()?r+(t-e)/2:r+t-e:r+3;return a},t.prototype.calculatePageCount=function(t,r,n){var i=n,a=this.columnIndex;if(0===t.columns.length){var o=Math.floor(r/this.defaultCellWidth)-(i?1:0);return Array(Math.max(1,Math.ceil(a/o))).fill(o)}for(var s=0,l=[],d=0;d<=a;d++){var h=t.columns&&t.columns[d],p=(i?27:0)+(h&&h.hidden?0:h&&!(0,e.isNullOrUndefined)(h.width)?h.width:this.defaultCellWidth);i=!1,(s+=p)>r&&(l.push(d-1),i=!0,s=p)}return(0===l.length||a>l[l.length-1])&&l.push(a),l},t.prototype.wrapText=function(t,r,n,i){if((0,e.isNullOrUndefined)(t))return[""];var a,o,s,l,d,h,p=[],c=0,u=t.toString().split(" "),f=Ad(" ",n,i,!0),g="",m=function(e){c&&p.push(g),gd(a/r,!0)>1&&(e.split("").forEach((function(e){l=Ad(e,n,i,!0),d+=e,gd(s+=l,!0)>r&&(p.push(d),s=l,d=e)})),a=s,e=d),g=e,c=a},v=u.length-1,y=function(e,t){gd(e+f,!0)/r>=1?a+=0:(a+=f,t!==v&&(g+=" "))};return u.forEach((function(e,t){if(s=0,l=0,d="",a=Ad(e,n,i,!0),gd(c+a,!0)/r>1)if((o=e.split("-")).length>1){var p=o.length-1;o.forEach((function(o,f){s=0,l=0,d="",h||(h=Ad("-",n,i,!0)),a=Ad(o,n,i,!0),f<p&&(a+=h,o+="-"),gd(c+a,!0)/r>1?(m(o),f===p&&y(a,t)):(g+=o,f===p&&u[u.length-1]!==e&&y(c+a,t),c+=a)}))}else m(e),y(a,t);else g+=e,y(c+a,t),c+=a})),c&&p.push(g),p},t.prototype.getModuleName=function(){return"print"},t.prototype.destroy=function(){this.setToDefault(),this.totalSheetCount=[],this.parent=null},t}(),sp=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),lp=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},dp=function(l){function d(e,t){var r=l.call(this,e)||this;return r.rafIds=[],r.viewport={rowCount:0,colCount:0,height:0,topIndex:0,leftIndex:0,width:0,bottomIndex:0,rightIndex:0,beforeFreezeHeight:0,beforeFreezeWidth:0,scaleX:1,scaleY:1},r.needsID=!0,h.Inject(Gh,Yh,Kh,lh,sh,ph,ch,oh,Jn,$h,Jh,Zh,Qh,uh,Xh,xh,Ks,gs,Cs,Xs,Us,Hs,ep,qs,gh,bh,Ws,rp,yh,$s,Sh,wh,Zs,Js,Rh,Qs,op,kh,rl,Oh,tl,Fh,nl,np,Th,Gs,il,ap,Ys,Lh,al,Ph),t&&r.appendTo(t),r}var h;return sp(d,l),h=d,d.prototype.getCell=function(e,t,r){var n;return this.insideViewport(e,t)&&(r||(r=this.getRow(e,null,t)),t=this.getViewportIndex(t,!0),n=r?r.cells[t]:r),n},d.prototype.getRow=function(t,r,n){if(!r){var i=this.getActiveSheet(),a=this.frozenRowCount(i),o=this.frozenColCount(i);r=(0,e.isNullOrUndefined)(n)||t>a-1&&n>o-1?this.getContentTable():t<a&&n<o?this.sheetModule.getSelectAllTable():t<a?this.getColHeaderTable():this.getRowHeaderTable()}return t=this.getViewportIndex(t),r?r.rows[t]:null},d.prototype.hiddenCount=function(e,t,r,n){void 0===r&&(r="rows"),void 0===n&&(n=this.getActiveSheet());for(var i,a=0,o=e;o<=t;o++)(i=n[""+r][o])&&i.hidden&&a++;return a},d.prototype.getViewportIndex=function(e,t){var n=this.getActiveSheet(),i=this.frozenColCount(n),a=this.frozenRowCount(n);if(t){if(i){var o=r(n.topLeftCell)[1];return e<i?(e-=this.hiddenCount(o,e,"columns"),(e-=o)+1):(e-=this.hiddenCount(this.viewport.leftIndex+i,e,"columns"),e-=this.viewport.leftIndex+i)}e-=this.hiddenCount(this.viewport.leftIndex,e,"columns"),e-=this.viewport.leftIndex}else{if(a){var s=r(n.topLeftCell)[0];return e<a?(e-=this.hiddenCount(s,e),(e-=s)+1):(e-=this.hiddenCount(this.viewport.topIndex+a,e),e-=this.viewport.topIndex+a)}e-=this.hiddenCount(this.viewport.topIndex,e),e-=this.viewport.topIndex}return e},d.prototype.preRender=function(){l.prototype.preRender.call(this),this.serviceLocator=new ol,this.initServices()},d.prototype.initServices=function(){this.serviceLocator.register(Dl,new e.L10n(this.getModuleName(),Vl,this.locale)),this.serviceLocator.register(Ll,new Mh(this)),this.serviceLocator.register(Pl,new Bh(this)),this.serviceLocator.register(Ml,new Hh(this))},d.prototype.render=function(){if(l.prototype.render.call(this),this.element.setAttribute("tabindex","0"),this.renderModule=new nh(this),this.renderSpreadsheet(),this.wireEvents(),this.created&&!this.refreshing)if(this.created.observers){if(this.created.observers.length>0){var e={observers:this.created.observers};this.isAngular&&(e={observers:this.created.observers,currentObservers:this.created.observers},this.created.currentObservers=[]),this.createdHandler=e,this.created.observers=[]}}else this.createdHandler=this.created,this.setProperties({created:void 0},!0)},d.prototype.renderSpreadsheet=function(){this.cssClass&&(0,e.addClass)([this.element],this.cssClass.split(" ")),this.setHeight(),this.setWidth(),(0,fh.createSpinner)({target:this.element},this.createElement),this.cssClass&&-1===this.cssClass.indexOf("e-mobile-view")&&this.isMobileView()&&this.element.classList.add("e-mobile-view"),e.Browser.isDevice&&this.element.classList.add("e-device"),this.sheetModule=this.serviceLocator.getService("sheet"),this.allowScrolling&&(this.scrollModule=new dh(this)),this.scrollSettings.enableVirtualization&&new hh(this),this.renderModule.render(),new mh(this)},d.prototype.showSpinner=function(){(0,fh.showSpinner)(this.element)},d.prototype.hideSpinner=function(){(0,fh.hideSpinner)(this.element)},d.prototype.protectSheet=function(e,t,r){l.prototype.protectSheet.call(this,e,t,r)},d.prototype.unprotectSheet=function(e){l.prototype.unprotectSheet.call(this,e)},d.prototype.find=function(e){var t=this.getActiveSheet().activeCell;if(l.prototype.findHandler.call(this,e),!e.isAction)return t!==this.getActiveSheet().activeCell?this.getActiveSheet().name+"!"+this.getActiveSheet().activeCell:null},d.prototype.replace=function(t){t={value:t.value,mode:t.mode?t.mode:"Sheet",isCSen:!!t.isCSen&&t.isCSen,isEMatch:!!t.isEMatch&&t.isEMatch,searchBy:t.searchBy?t.searchBy:"By Row",replaceValue:t.replaceValue,replaceBy:t.replaceBy,sheetIndex:(0,e.isUndefined)(t.sheetIndex)?this.activeSheetIndex:t.sheetIndex,findOpt:t.findOpt?t.findOpt:""},l.prototype.replaceHandler.call(this,t)},d.prototype.findAll=function(e,t,r,n,i){var a=[],o={value:e,mode:t=t||"Sheet",sheetIndex:i=i<this.sheets.length?i:this.activeSheetIndex,isCSen:r=r||!1,isEMatch:n=n||!1,findCollection:a};return this.notify(oe,o),a},d.prototype.goTo=function(e){if(e.includes("!")){var n=In(this,Nn(e));if(void 0===n)return;if(n!==this.activeSheetIndex){var a=e.substring(e.lastIndexOf("!")+1),o=a.split(":")[0],s=this.sheets[n];this.setSheetPropertyOnMute(s,"activeCell",o),this.setSheetPropertyOnMute(s,"selectedRange",a);var l=r(o);if(s.frozenColumns||s.frozenRows){var d=r(s.topLeftCell);if(!(s.frozenRows&&l[0]<d[0]||s.frozenColumns&&l[1]<d[1])){var h=this.frozenRowCount(s),p=this.frozenColCount(s),c=[],u=[],f=r(s.paneTopLeftCell);h?(c.push(d[0]),l[0]>=h?u.push(l[0]):u.push(f[0])):(c.push(l[0]),u.push(l[0])),p?(c.push(d[1]),l[1]>=p?u.push(l[1]):u.push(f[1])):(c.push(l[1]),u.push(l[1])),this.setSheetPropertyOnMute(s,"topLeftCell",i(c[0],c[1])),this.setSheetPropertyOnMute(s,"paneTopLeftCell",i(u[0],u[1]))}}else l[0]<this.viewport.rowCount&&(l[0]=0),l[1]<this.viewport.colCount&&(l[1]=0),this.updateTopLeftCell(l[0],l[1],null,s);return this.activeSheetIndex=n,void this.dataBind()}}var g=t(e),m=this.getActiveSheet(),v=this.frozenRowCount(m),y=this.frozenColCount(m),C=this.insideViewport(g[0],g[1]);if(C){this.selectRange(e);var b=r(m.paneTopLeftCell),x=this.viewport.height;this.allowScrolling&&(x-=this.getScrollElement().parentElement.getBoundingClientRect().height);var S=0,w=0;if(v)for(var I=r(m.topLeftCell)[0];I<v;I++)if((S+=yl(m,I))>x){w=I;break}if(0===w)for(I=b[0];I<=this.viewport.bottomIndex;I++){if((S+=yl(m,I))>x){w=I;break}I===this.viewport.bottomIndex&&(w=this.viewport.bottomIndex)}b[2]=w;var E=0;if(S=0,x=this.viewport.width-this.sheetModule.getScrollSize(),y)for(I=r(m.topLeftCell)[1];I<y;I++)if((S+=Nl(m,I))>x){E=I;break}if(0===E)for(I=b[1];I<=this.viewport.rightIndex;I++){if((S+=Nl(m,I))>x){E=I;break}I===this.viewport.rightIndex&&(E=this.viewport.rightIndex)}if(b[3]=E,g[0]>=b[0]&&g[0]<b[2]&&g[1]>=b[1]&&g[1]<b[3])return;if(v||y){if(b=[].concat(r(m.topLeftCell),[v,b[3]]),g[0]>=b[0]&&g[0]<b[2]&&g[1]>=b[1]&&g[1]<b[3])return;if(b[2]=w,b[3]=y,g[0]>=b[0]&&g[0]<b[2]&&g[1]>=b[1]&&g[1]<b[3])return}}var N,R,A,k,O,F,T=this.getMainContent().parentElement;g[0]===v?A=0:(A=bl(m,v,g[0]-1,!0),this.scrollSettings.enableVirtualization&&(F=A+this.getContentTable().getBoundingClientRect().height)>(O=parseFloat(T.querySelector(".e-virtualtrack").style.height))&&(F+=10,(N=T.querySelector(".e-virtualtrack")).style.height=F+"px",zl((function(){N.style.height=O+"px"})))),T.scrollTop=A,T=this.element.getElementsByClassName("e-scroller")[0],g[1]===y?A=0:(A=Rl(m,y,g[1]-1,!0),this.scrollSettings.enableVirtualization&&(F=A+this.getContentTable().getBoundingClientRect().width)>(k=parseFloat(T.querySelector(".e-virtualtrack").style.width))&&(F+=10,(N=T.querySelector(".e-virtualtrack")).style.width=F+"px",(R=this.getColumnHeaderContent().querySelector(".e-virtualtrack")).style.width=F+"px",(N=this.getMainContent().querySelector(".e-virtualtrack")).style.width=F+"px",zl((function(){N.style.width=k+"px",R.style.width=k+"px"})))),T.scrollLeft=A,C||this.selectRange(e)},d.prototype.insideViewport=function(e,t){var n=this.getActiveSheet();if(n.frozenRows||n.frozenColumns){var i=this.frozenRowCount(n),a=this.frozenColCount(n),o=r(n.topLeftCell);return(e>=o[0]&&e<i||e>=this.viewport.topIndex+i&&e<=this.viewport.bottomIndex)&&(t>=o[1]&&t<a||t>=this.viewport.leftIndex+a&&t<=this.viewport.rightIndex)}return e>=this.viewport.topIndex&&e<=this.viewport.bottomIndex&&t>=this.viewport.leftIndex&&t<=this.viewport.rightIndex},d.prototype.resize=function(){this.renderModule.setSheetPanelSize(),this.scrollSettings.enableVirtualization&&this.renderModule.refreshSheet(!1,!0)},d.prototype.cut=function(e){var t=new Promise((function(e){e(void 0)}));return this.notify(Li,e?{range:s(e),sId:this.sheets[In(this,Nn(e))]?this.sheets[In(this,Nn(e))].id:this.getActiveSheet().id,promise:t,invokeCopy:!0,isPublic:!0}:{promise:t,invokeCopy:!0,isPublic:!0}),t},d.prototype.copy=function(e){var t=new Promise((function(e){e(void 0)}));return this.notify(Pi,e?{range:s(e),sId:this.sheets[In(this,Nn(e))]?this.sheets[In(this,Nn(e))].id:this.getActiveSheet().id,promise:t,invokeCopy:!0,isPublic:!0}:{promise:t,invokeCopy:!0,isPublic:!0}),t},d.prototype.paste=function(e,t){this.notify(Mi,{range:e?s(e):e,sIdx:e?In(this,Nn(e)):e,type:t,isAction:!0,isInternal:!0})},d.prototype.updateAction=function(e){wd(e,this)},d.prototype.setHeight=function(){this.height&&(this.height.toString().indexOf("%")>-1&&(this.element.style.minHeight="400px"),this.element.style.height=(0,e.formatUnit)(this.height))},d.prototype.setWidth=function(){this.width&&((this.width.toString().indexOf("%")>-1||"auto"===this.width)&&(this.element.style.minWidth="300px"),this.element.style.width=(0,e.formatUnit)(this.width))},d.prototype.setColWidth=function(t,n,i){void 0===t&&(t=64),void 0===n&&(n=0);var a=(0,e.isNullOrUndefined)(i)?this.getActiveSheet():this.sheets[i];if(a&&(!a.isProtected||a.protectSettings.formatColumns)){var o=n,s="number"==typeof t?t+"px":t;n=(0,e.isNullOrUndefined)(n)?r(a.activeCell)[1]:n;var l=function(){Il(a,o).width=parseInt(s,10)>0?parseInt(s,10):0,a.columns[o].customWidth=!0},d=this.frozenColCount(a);if(a.id===this.getActiveSheet().id){if(n>=this.viewport.leftIndex+d&&n<=this.viewport.rightIndex||d&&n<d){n=this.getViewportIndex(n,!0);var h=Nl(a,o,null,!0);(c=gd(parseInt(s,10))-h)<0&&h<-c&&(c=-h),l(),this.notify(Qi,{threshold:c,colIdx:o,checkWrapCell:!0}),Cd(o,n,s,!0,this)}else{var p=Nl(a,n),c=void 0;c=parseInt(s,10)>0?-(p-parseInt(s,10)):-p,l(),this.notify(Qi,{threshold:c,colIdx:n})}this.notify(Qo,null)}else l()}},d.prototype.setRowHeight=function(t,n,i,a,o){void 0===t&&(t=20),void 0===n&&(n=0);var s=(0,e.isNullOrUndefined)(i)?this.getActiveSheet():this.sheets[i];if(s){var l=n;if(n=(0,e.isNullOrUndefined)(n)?r(s.activeCell)[0]:n,o&&s.rows[n]&&s.rows[n].customHeight)return;var d="number"==typeof t?t+"px":t,h=function(){Cl(s,l,parseInt(d,10)>0?parseInt(d,10):0),s.rows[l].customHeight=!0};if(s.id===this.getActiveSheet().id){var p=this.frozenRowCount(s);if(n>=this.viewport.topIndex+p&&n<=this.viewport.bottomIndex||p&&n<p){n=this.getViewportIndex(l);var c=yl(s,l,!0);(f=gd(parseInt(d,10))-c)<0&&c<-f&&(f=-c),h(),this.notify(Ji,{threshold:f,rowIdx:l,isCustomHgt:!0}),(0,e.isNullOrUndefined)(a)&&(a=!1),a||(Cd(l,n,d,!1,this),a=!1)}else{var u=yl(s,n),f=void 0;f=parseInt(d,10)>0?-(u-parseInt(d,10)):-u,h(),this.notify(Ji,{threshold:f,rowIdx:l})}this.notify(Qo,null)}else h()}},d.prototype.setRowsHeight=function(e,t,r){void 0===e&&(e=20),t||(t=["1:"+(this.getActiveSheet().usedRange.rowIndex+1)]),this.setSize(e,t,(function(e){return Number(e)-1}),this.setRowHeight.bind(this),r)},d.prototype.setColumnsWidth=function(e,t){void 0===e&&(e=64),t||(t=["A:"+o(this.getActiveSheet().usedRange.colIndex+1)]),this.setSize(e,t,(function(e){return n(e)}),this.setColWidth.bind(this))},d.prototype.setSize=function(e,t,r,n,i){var a,o,s,l,d,h=this;t.forEach((function(t){t.includes("!")?(s=t.substring(0,t.lastIndexOf("!")),a=In(h,s),t=t.substring(t.lastIndexOf("!")+1)):a=h.activeSheetIndex,t.includes(":")?(o=t.split(":"),l=r(o[0]),d=r(o[1])):l=d=r(t);for(var p=l;p<=d;p++)n(e,p,a,!1,i)}))},d.prototype.autoFit=function(e){var t;-1!==e.indexOf("!")&&(t=In(this,e.substring(0,e.lastIndexOf("!"))),e=e.substring(e.lastIndexOf("!")+1));var r=this.getIndexes(e),i=r.startIdx,a=r.endIdx,o=r.isCol,s=o?n("XFD"):1048576;if(i<=s)for(a>s&&(a=s);i<=a;i++)this.notify(Ha,{idx:i,isCol:o,sheetIdx:t})},d.prototype.getIndexes=function(t){var r,i,a,o;if(-1!==t.indexOf(":")){var s=t.split(":");a=s[0],o=s[1]}else a=t,o=t;if(!(0,e.isNullOrUndefined)(a)){var l=this.getAddress(a);a=l.address,r=l.isCol}if(!(0,e.isNullOrUndefined)(o)){var d=this.getAddress(o);o=d.address,i=d.isCol}var h=!0===r&&!0===i;return{startIdx:h?n(a.toUpperCase()):parseInt(a,10),endIdx:h?n(o.toUpperCase()):parseInt(o,10),isCol:h}},d.prototype.getAddress=function(e){var t;return e.substring(0,1).match(/\D/g)?(t=!0,{address:e=e.replace(/[0-9]/g,""),isCol:t}):e.substring(0,1).match(/[0-9]/g)&&e.match(/\D/g)?{address:"",isCol:!1}:{address:e=(parseInt(e,10)-1).toString(),isCol:t}},d.prototype.addHyperlink=function(e,t,r){this.insertHyperlink(e,t,r,!0)},d.prototype.removeHyperlink=function(e){this.notify(Ca,{range:e,preventEventTrigger:!0})},d.prototype.insertHyperlink=function(e,r,n,i){if(this.allowHyperlink){var a=void 0,o=void 0,s=void 0,l=this.getActiveSheet();if(Qr(this,s=t(r=r||l.name+"!"+l.activeCell)))return void this.notify(to,null);for(var d=this.getCell(s[0],s[1]),h=[],p=0;d&&p<d.classList.length;p++)h.push(d.classList[p]);var c={hyperlink:e,address:r,displayText:n,cancel:!1},u={hyperlink:e,address:r,displayText:n};if(i||(this.trigger(Pe,c),this.notify(K,{action:"hyperlink",eventArgs:c})),!c.cancel){var f={hyperlink:e=c.hyperlink,cell:r=c.address,displayText:n,triggerEvt:!i};if(this.notify(Ve,f),r&&-1!==r.lastIndexOf("!")){var g=r.lastIndexOf("!");a=r.substring(0,g);for(var m=this.sheets,v=0;v<m.length;v++)m[v].name===a&&(o=v);l=this.sheets[o],r=r.substring(g+1)}if(!l)return;if(s=t(r=r||this.getActiveSheet().activeCell),i||(this.trigger(Me,u),this.notify(Pa,{action:"hyperlink",eventArgs:c})),l===this.getActiveSheet()){this.serviceLocator.getService("cell").refreshRange(s,!1,!1,!1,!0,Kr(this));for(p=0;p<h.length;p++)this.getCell(s[0],s[1]).classList.contains(h[p])||this.getCell(s[0],s[1]).classList.add(h[p]);this.notify(Mt,null)}}}},d.prototype.addDataValidation=function(e,t){l.prototype.addDataValidation.call(this,e,t)},d.prototype.removeDataValidation=function(e){l.prototype.removeDataValidation.call(this,e)},d.prototype.addInvalidHighlight=function(e){l.prototype.addInvalidHighlight.call(this,e)},d.prototype.removeInvalidHighlight=function(e){l.prototype.removeInvalidHighlight.call(this,e)},d.prototype.conditionalFormat=function(e){l.prototype.conditionalFormat.call(this,e)},d.prototype.clearConditionalFormat=function(e){e=e||this.getActiveSheet().selectedRange,l.prototype.clearConditionalFormat.call(this,e)},d.prototype.setPanelSize=function(){if("auto"!==this.height){var e=document.getElementById(this.element.id+"_sheet_panel");e.style.height=this.element.getBoundingClientRect().height*this.viewport.scaleY-Yl(e,null,this.viewport.scaleY)+"px"}},d.prototype.open=function(e){this.isOpen=!0,l.prototype.open.call(this,e),this.isOpen&&this.showSpinner()},d.prototype.hideRow=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!0),this.renderModule?this.notify(Rt,{startIndex:e,endIndex:t,hide:r,actionUpdate:!1}):l.prototype.hideRow.call(this,e,t,r)},d.prototype.hideColumn=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!0),this.renderModule?this.notify(Rt,{startIndex:e,endIndex:t,hide:r,isCol:!0,actionUpdate:!1}):l.prototype.hideColumn.call(this,e,t,r)},d.prototype.clear=function(e){this.notify(go,{options:e})},d.prototype.refresh=function(e){var t=this;if(this.isReact&&this.clearTemplate(),e)this.notify(Bi,null),this.sheets.length=0,this.sheetNameCount=1,this.notify(xe,{}),this.notify(Ra,null),this.createSheet(),this.activeSheetIndex=this.sheets.length-1,this.notify(ri,null),this.notify(pe,{action:"initSheetInfo"}),this.renderModule.refreshSheet();else if(this.createdHandler){var r=function(){t.off(Qa,r),t.refresh()};this.on(Qa,r,this)}else this.notify(ta,{}),l.prototype.refresh.call(this)},d.prototype.insertImage=function(e,t){var r;for(r=0;r<e.length;r++)this.notify(Ao,{options:e[r],range:t||this.getActiveSheet().selectedRange,isPublic:!0})},d.prototype.deleteImage=function(e,t){this.notify(ko,{id:e,range:t||this.getActiveSheet().selectedRange})},d.prototype.getRowHeaderContent=function(){return this.sheetModule.getRowHeaderPanel()},d.prototype.getColumnHeaderContent=function(){return this.sheetModule.getColHeaderPanel()},d.prototype.getMainContent=function(){return this.sheetModule.getContentPanel()},d.prototype.getSelectAllContent=function(){return this.sheetModule.getSelectAllContent()},d.prototype.getScrollElement=function(){return this.sheetModule.getScrollElement()},d.prototype.getContentTable=function(){return this.sheetModule.getContentTable()},d.prototype.getRowHeaderTable=function(){return this.sheetModule.getRowHeaderTable()},d.prototype.getColHeaderTable=function(){return this.sheetModule.getColHeaderTable()},d.prototype.getThreshold=function(e){var t=Math.round((this.viewport[e+"Count"]+1)/2);return t<15?15:t},d.prototype.isMobileView=function(){return!(0,e.isNullOrUndefined)(this.cssClass)&&(this.cssClass.indexOf("e-mobile-view")>-1||e.Browser.isDevice)&&-1===this.cssClass.indexOf("e-desktop-view")&&!1},d.prototype.getValueRowCol=function(e,t,r,n,i,a,o){return l.prototype.getValueRowCol.call(this,e,t,r,n,i,a,o)},d.prototype.updateCell=function(t,r,n){(0,e.isNullOrUndefined)(n)&&(n=!0),this.updateCellInfo(t,r,n,void 0,void 0,!0)},d.prototype.updateCellInfo=function(e,r,n,i,a,o){if(!Qr(this,t(r=r||this.getActiveSheet().activeCell))){var s=this.scrollSettings.isFinite;l.prototype.updateCellDetails.call(this,e,r,i,a,n,s,o)}},d.prototype.getRowData=function(e,t){return l.prototype.getRowData.call(this,e,t)},d.prototype.sort=function(e,t){var r,n,i=this;if(!this.allowSorting)return Promise.reject();if(t?n=Fn(this,r=p(this,t)):(t=(n=this.getActiveSheet()).selectedRange,r=this.activeSheetIndex),n.isProtected)return Promise.reject(new Error("The cell you're trying to change is protected. To make change, unprotect the sheet."));var a=[];if(this.sortCollection)for(var o=this.sortCollection.length-1;o>=0;o--)this.sortCollection[o]&&this.sortCollection[o].sheetIndex===r&&(a.push(this.sortCollection[o]),this.sortCollection.splice(o,1));return this.notify(Cr,{sortOptions:e}),l.prototype.sort.call(this,e,t,a).then((function(e){return i.notify(Te,e),Promise.resolve(e)}))},d.prototype.setValueRowCol=function(e,t,r,n,i,a){if(!this.isEdit&&"#CIRCULARREF!"===t){var s={action:"isCircularReference",argValue:t,address:(h=Fn(this,En(this,e))).name+"!"+o(n)+r};this.notify(li,s),t=s.argValue}if(l.prototype.setValueRowCol.call(this,e,t,r,n,i,a),this.allowEditing)this.notify(si,{action:"refreshDependentCellValue",rowIdx:r,colIdx:n,sheetIdx:En(this,e)});else{var d=En(this,e);if(r--,n--,this.activeSheetIndex===d){var h,p=void 0;if(ml(h=Fn(this,d),r)||Al(h,n)||(p=this.getCell(r,n)),p){if(p.parentElement){var c=p.parentElement.getAttribute("aria-rowindex");if(c&&Number(c)-1!==r)return}var u=zn(r,n,h),f={value:u.value,format:u.format,onLoad:!0,formattedText:u.value,isRightAlign:!1,type:"General",cell:u,rowIndex:r,colIndex:n,isRowFill:!1};this.notify(re,f),this.refreshNode(p,f)}}}},d.prototype.getModuleName=function(){return"spreadsheet"},d.prototype.calculateNow=function(e,t){return l.prototype.calculateNow.call(this,e,t)},d.prototype.refreshNode=function(t,r){var n;if(t){if(r){if(r.result=(0,e.isNullOrUndefined)(r.formattedText)?(0,e.isNullOrUndefined)(r.result)?"":r.result:r.formattedText.toString(),!r.isRowFill){var a=t.querySelector(".e-fill-before");a&&(0,e.detach)(a);var o=(0,e.select)(".e-fill",t);o&&((0,e.detach)(o),t.style.display="table-cell");var s=(0,e.select)(".e-fill-sec",t);s&&(0,e.detach)(s)}var l=(0,e.select)("#"+this.element.id+"_currency",t);if(l&&(0,e.detach)(l),"Accounting"===r.type&&dn(r.value)&&r.result.includes(r.curSymbol)){var d=void 0,h=void 0,p=void 0;r.result.trim().endsWith(r.curSymbol)?h=r.result:(d=r.result.includes(" "+r.curSymbol)?" "+r.curSymbol:r.curSymbol,h=r.result.split(d).join(""));var c=t.querySelector(".e-databar-value"),u=t.querySelector(".e-iconsetspan"),f=t,g=void 0;if(t.children.length>0&&t.children[t.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1&&(g=document.getElementsByClassName("e-addNoteIndicator")[0]),c?(this.refreshNode(c,{result:h}),f=t.querySelector(".e-cf-databar")||t):t.querySelector("a")?t.querySelector("a").textContent=h:(p=!0,t.innerText=""),u&&t.insertBefore(u,t.firstElementChild),d){var m=this.createElement("span",{id:this.element.id+"_currency",styles:"float: left"});m.innerText=d,f.appendChild(m),(0,e.isNullOrUndefined)(g)||f.appendChild(g)}return p&&(t.innerHTML+=h),void t.classList.add("e-right-align")}var v=void 0;!r.result||"true"!==r.result.toLowerCase()&&"false"!==r.result.toLowerCase()?v="e-right-align":(r.result=r.result.toUpperCase(),v="e-center-align",r.isRightAlign=!0),n=r.result,this.allowWrap||n.toString().includes("\n")&&(n=n.replace(/\n/g,"")),r.isRightAlign?t.classList.add(v):t.classList.remove(v)}n=(0,e.isNullOrUndefined)(n)?"":n,(0,e.isNullOrUndefined)(r.rowIndex)||(0,e.isNullOrUndefined)(r.colIndex)||(0,e.attributes)(t,{"aria-label":(n?n+" ":"")+i(r.rowIndex,r.colIndex)});var y=t.lastChild;y&&"SPAN"===y.nodeName&&y.classList.contains("e-iconsetspan")&&(y=null);var C=t.querySelector(".e-addNoteIndicator");C&&(y=C.previousSibling),t.querySelector(".e-databar-value")&&(y=t.querySelector(".e-databar-value").lastChild),t.querySelector(".e-hyperlink")&&(r.cell&&r.cell.wrap&&n&&n.toString().indexOf("\n")&&(t.querySelector(".e-hyperlink").textContent=n),y=t.querySelector(".e-hyperlink").lastChild);var b=t.querySelector(".e-wrap-content");if(!b||t.querySelector(".e-hyperlink")||t.querySelector(".e-databar-value")||(b.lastChild||b.appendChild(document.createTextNode("")),y=b.lastChild),(this.isAngular||this.isVue)&&t.classList.contains("e-cell-template")&&y&&(8===y.nodeType||3===y.nodeType)){if(3===y.nodeType||""!==n){var x=function(){t.childElementCount||(3===y.nodeType?r.isRowFill||(y.nodeValue=n):t.appendChild(document.createTextNode(n)))};this.isAngular?zl(x):x()}}else!y||3!==y.nodeType&&1!==y.nodeType?t.appendChild(document.createTextNode(n)):r.isRowFill||(!(0,e.isNullOrUndefined)(y.className)&&y.className.indexOf("e-addNoteIndicator")>-1?(y=t.lastChild).nodeValue=n:y.nodeValue=n)}},d.prototype.calculateHeight=function(e,t,r){void 0===t&&(t=1),void 0===r&&(r=1);var n=e&&e.fontSize||this.cellStyle.fontSize,i="Arial Black"===e.fontFamily?1.44:1.24;return(n.indexOf("pt")>-1?1.33*parseInt(n,10):parseInt(n,10))*i*t+r*i},d.prototype.skipHidden=function(e,t,r,n){void 0===r&&(r="rows"),void 0===n&&(n=this.scrollSettings.isFinite);var i,a=this.getActiveSheet();this.scrollSettings.isFinite&&(i=("rows"===r?a.rowCount:a.colCount)-1);for(var o=e;o<=t;o++)if(a[""+r][o]&&a[""+r][o].hidden){if(e===o&&e++,t++,n&&t>i){t=i;break}}else if(!n&&this.scrollSettings.isFinite&&t>i&&a[""+r][o-1]&&a[""+r][o-1].hidden){t--;break}return[e,t]},d.prototype.updateActiveBorder=function(t,r){void 0===r&&(r=".e-ribbon");var n=(0,e.select)(r+" .e-tab-header .e-indicator",this.element);n.style.display="none",(0,e.setStyleAttribute)(n,{left:"",right:""}),(0,e.setStyleAttribute)(n,{left:t.offsetLeft+"px",right:t.parentElement.offsetWidth-(t.offsetLeft+t.offsetWidth)+"px"}),n.style.display=""},d.prototype.undo=function(){this.notify(wa,{isUndo:!0,isPublic:!0})},d.prototype.redo=function(){this.notify(wa,{isUndo:!1,isPublic:!0})},d.prototype.updateUndoRedoCollection=function(e){this.notify(Ia,{args:e,isPublic:!0})},d.prototype.addDefinedName=function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify(li,t),t.isAdded},d.prototype.removeDefinedName=function(e,t){return l.prototype.removeDefinedName.call(this,e,t)},d.prototype.mouseClickHandler=function(e){this.notify(hi,e)},d.prototype.mouseDownHandler=function(e){this.notify(ai,e)},d.prototype.keyUpHandler=function(t){(0,e.closest)(t.target,".e-find-dlg")?this.notify(lt,t):this.notify(pi,t)},d.prototype.keyDownHandler=function(t){var r=(0,e.closest)(t.target,".e-findtool-dlg");if(r){if(9===t.keyCode){var n=t.target;if(t.shiftKey){if(n.classList.contains("e-text-findNext-short")){var i=r.querySelector(".e-findRib-close .e-tbar-btn");i&&(t.preventDefault(),i.focus())}}else n.classList.contains("e-tbar-btn")&&n.parentElement.classList.contains("e-findRib-close")&&Md(r)}}else{this.notify(ci,t);var a=(0,e.closest)(t.target,".e-dialog");this.enableKeyboardNavigation||!document.activeElement.classList.contains("e-cell")&&!a||[38,40,33,34,35,36,9].indexOf(t.keyCode)>-1&&t.preventDefault()}},d.prototype.freeze=function(e){if(!(!this.allowFreezePane||e.row<0||e.column<0)){if(e.triggerEvent){var t={row:e.row,column:e.column,cancel:!1,sheetIndex:this.activeSheetIndex};if(this.notify(K,{eventArgs:t,action:"freezePanes"}),t.cancel)return}this.on(ii,this.freezePaneUpdated,this),this.freezePanes(e.row,e.column),this.notify(Mt,null)}},d.prototype.freezePaneUpdated=function(){this.off(ii,this.freezePaneUpdated);var e=this.getActiveSheet();Md(this.element),this.notify(Pa,{eventArgs:{row:e.frozenRows,column:e.frozenColumns,sheetIndex:this.activeSheetIndex},action:"freezePanes"})},d.prototype.wireEvents=function(){e.EventHandler.add(this.element,"click",this.mouseClickHandler,this),e.EventHandler.add(this.element,td(),this.mouseDownHandler,this),e.EventHandler.add(this.element,"keyup",this.keyUpHandler,this),e.EventHandler.add(this.element,"keydown",this.keyDownHandler,this),this.on($o,this.freeze,this),this.on(nr,this.refreshInsertDelete,this)},d.prototype.destroy=function(){this.isReact&&this.clearTemplate(),this.unwireEvents(),this.notify(oi,null),l.prototype.destroy.call(this),this.element.innerHTML="",this.element.removeAttribute("tabindex"),this.element.removeAttribute("role"),this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("min-height"),this.element.style.removeProperty("min-width"),this.sheetModule&&this.sheetModule.destroy()},d.prototype.unwireEvents=function(){e.EventHandler.remove(this.element,"click",this.mouseClickHandler),e.EventHandler.remove(this.element,td(),this.mouseDownHandler),e.EventHandler.remove(this.element,"keyup",this.keyUpHandler),e.EventHandler.remove(this.element,"keydown",this.keyDownHandler),this.off($o,this.freeze),this.off(nr,this.refreshInsertDelete)},d.prototype.refreshInsertDelete=function(e){var r,n=this;"Sheet"!==e.modelType&&(e.sheet.ranges.forEach((function(i){i.template&&i.address&&(r=t(i.address),n.updateRangeOnInsertDelete(e,r)&&(i.address=a(r)))})),this.setSheetPropertyOnMute(e.sheet,"ranges",e.sheet.ranges))},d.prototype.addContextMenuItems=function(e,t,r,n){void 0===r&&(r=!0),this.notify(Vi,{items:e,text:t,insertAfter:r,isUniqueId:n})},d.prototype.removeContextMenuItems=function(e,t){this.notify(zi,{items:e,isUniqueId:t})},d.prototype.enableContextMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify(ji,{items:e,enable:t,isUniqueId:r})},d.prototype.enableFileMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify(_i,{items:e,enable:t,isUniqueId:r})},d.prototype.hideFileMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify(qi,{items:e,hide:t,isUniqueId:r})},d.prototype.addFileMenuItems=function(e,t,r,n){void 0===r&&(r=!0),this.notify(Wi,{items:e,text:t,insertAfter:r,isUniqueId:n})},d.prototype.hideRibbonTabs=function(e,t){void 0===t&&(t=!0),this.notify(Gi,{tabs:e,hide:t})},d.prototype.enableRibbonTabs=function(e,t){void 0===t&&(t=!0),this.notify(Yi,{tabs:e,enable:t})},d.prototype.addRibbonTabs=function(e,t){this.notify(Xi,{items:e,insertBefore:t})},d.prototype.enableToolbarItems=function(e,t,r){this.notify(Oi,[{tab:e,items:t,enable:void 0===r||r,isPublic:!0}])},d.prototype.hideToolbarItems=function(e,t,r){void 0===r&&(r=!0),this.notify($i,{tab:e,indexes:t,hide:r})},d.prototype.addToolbarItems=function(e,t,r){this.notify(Ki,{tab:e,items:t,index:r})},d.prototype.selectRange=function(e){this.isEdit&&this.notify(si,{action:"endEdit"}),this.notify(Ti,{address:e})},d.prototype.selectChart=function(e){this.selectOverlay(e,!0)},d.prototype.selectImage=function(e){this.selectOverlay(e)},d.prototype.selectOverlay=function(e,t){var n=this.getActiveSheet();if(!n.isProtected&&this.allowEditing){if(!e){var i=r(n.activeCell),a=zn(i[0],i[1],n,!1,!0);t?a.chart&&a.chart.length&&(e=a.chart[a.chart.length-1].id):a.image&&a.image.length&&(e=a.image[a.image.length-1].id)}var o;if(e?(o=this.element.querySelector("#"+e)).classList.contains("e-ss-overlay")||(o=o.parentElement):o=this.element.querySelector(".e-ss-overlay"+(t?".e-datavisualization-chart":":not(.e-datavisualization-chart)")),o){var s=void 0,l=this.element.getElementsByClassName("e-ss-overlay-active")[0];l&&(l.classList.remove("e-ss-overlay-active"),(s=l.classList.contains("e-datavisualization-chart"))&&this.notify(Mo,null)),o.classList.add("e-ss-overlay-active"),o.classList.contains("e-datavisualization-chart")?(this.notify(zt,{id:o.id}),s||this.notify(Uo,{id:o.id})):s&&this.notify(Vo,null)}}},d.prototype.deselectChart=function(){this.notify(Io,{selector:".e-datavisualization-chart"})},d.prototype.deselectImage=function(){this.notify(Io,{selector:":not(.e-datavisualization-chart)"})},d.prototype.startEdit=function(){this.notify(si,{action:"startEdit",isNewValueEdit:!1})},d.prototype.closeEdit=function(){this.notify(si,{action:"cancelEdit"})},d.prototype.endEdit=function(){this.notify(si,{action:"endEdit",isPublic:!0})},d.prototype.print=function(t){void 0===t&&(t={type:"ActiveSheet",allowRowColumnHeader:!1,allowGridLines:!1}),this.allowPrint&&!(0,e.isNullOrUndefined)(this.printModule)&&this.printModule.print(this,t)},d.prototype.onPropertyChanged=function(t,n){var i,a=this;l.prototype.onPropertyChanged.call(this,t,n);for(var o=0,s=Object.keys(t);o<s.length;o++){var d=s[o],h=void 0,p=void 0,c=this.getActiveSheet(),u=this.getScrollElement();switch(d){case"enableRtl":if(t.locale||t.currencyCode)break;if((h=this.getColumnHeaderContent())&&(h=h.parentElement),!h)break;if(t.enableRtl?(h.style.marginRight="",document.getElementById(this.element.id+"_sheet_panel").classList.add("e-rtl")):(h.style.marginLeft="",document.getElementById(this.element.id+"_sheet_panel").classList.remove("e-rtl")),this.allowScrolling&&this.scrollModule.setPadding(!0),this.allowAutoFill){var f=this.element.querySelector(".e-dragfill-ddb");if(f){var g=(0,e.getComponent)(f,"dropdown-btn");g&&(g.enableRtl=t.enableRtl,g.dataBind())}}if(this.sheetModule.setPanelWidth(c,this.getRowHeaderContent(),!0),this.allowImage||this.allowChart)for(var m=this.element.getElementsByClassName("e-ss-overlay"),v=void 0,y=void 0,C=void 0,b=0,x=m.length-1;b<=x;b++)(y=m[0]).classList.contains("e-datavisualization-chart")&&(v=(C=y.querySelector(".e-accumulationchart"))?(0,e.getComponent)(C,"accumulationchart"):(C=y.querySelector(".e-chart"))&&(0,e.getComponent)(C,"chart"))&&v.destroy(),(0,e.detach)(y),b===x&&this.notify(tr,{});u&&(u.scrollLeft=0),this.selectRange(c.selectedRange);break;case"cssClass":n.cssClass&&(0,e.removeClass)([this.element],n.cssClass.split(" ")),t.cssClass&&(0,e.addClass)([this.element],t.cssClass.split(" "));break;case"activeSheetIndex":this.renderModule.refreshSheet(),this.notify(ra,{idx:t.activeSheetIndex});break;case"width":this.setWidth(),this.resize();break;case"height":this.setHeight(),this.resize();break;case"showRibbon":this.notify(Qn,{prop:"showRibbon",onPropertyChange:!0});break;case"showFormulaBar":this.notify(ei,{uiUpdate:!0});break;case"showSheetTabs":this.notify(ti,null);break;case"cellStyle":this.renderModule.refreshSheet();break;case"allowEditing":if(this.allowEditing){if(this.notify(si,{action:"renderEditor"}),this.enableKeyboardNavigation){this.enableKeyboardNavigation=!1,this.dataBind(),this.enableKeyboardNavigation=!0,this.dataBind();var S=this.selectionSettings.mode;"None"!==S&&(this.selectionSettings.mode="None",this.dataBind(),this.selectionSettings.mode=S,this.dataBind())}}else this.notify(Io,null);break;case"allowInsert":(p=this.element.getElementsByClassName("e-add-sheet-tab")[0])&&(p.disabled=!this.allowInsert,this.allowInsert?p.classList.contains("e-disabled")&&p.classList.remove("e-disabled"):p.classList.contains("e-disabled")||p.classList.add("e-disabled"));break;case"sheets":if(t.sheets===this.sheets){this.renderModule.refreshSheet(),this.notify(ri,null),this.notify(pe,{action:"initSheetInfo"});break}Object.keys(t.sheets).forEach((function(o,s){var l=Number(o),d=t.sheets[l],h=Fn(a,l);if(d.ranges&&Object.keys(d.ranges).length){var p,c,u,f,g,m=Object.keys(d.ranges);m.forEach((function(e,t){d.ranges[Number(e)].info||(p=t)})),m.forEach((function(t,r){((0,e.isUndefined)(p)||p===r)&&(c=Number(t),u=d.ranges[c],f=h.ranges[c],g=u.dataSource,u.fieldsOrder&&f.info&&!g&&f.dataSource&&(g=f.dataSource),g&&a.notify(q,{sheetIdx:l,rangeIdx:c,changedData:g}))}))}else if(d.paneTopLeftCell&&n.sheets&&n.sheets[""+l]&&n.sheets[""+l].paneTopLeftCell){if(a.activeSheetIndex!==Number(l))return;var v=r(d.paneTopLeftCell),y=r(n.sheets[""+l].paneTopLeftCell);if(v[0]!==y[0]){var C=a.frozenRowCount(a.getActiveSheet()),b=v[0]>C?bl(a.getActiveSheet(),C,v[0]-1):0;a.notify(Jo,{top:b})}if(v[1]!==y[1]){var x=a.frozenColCount(a.getActiveSheet()),S=v[1]>x?Rl(a.getActiveSheet(),x,v[1]-1):0;a.notify(Jo,{left:S})}}else if(0===s&&a.renderModule.refreshSheet(),a.showSheetTabs&&d.name&&!i){var w=(0,e.select)(".e-sheet-tabs-items",a.element),I=Number(l);w.children[I+1]?a.notify(xa,{items:w,value:d.name,idx:I}):(a.notify(ri,null),i=!0)}}));break;case"locale":this.refresh();break;case"currencyCode":t.locale||this.refresh();break;case"password":this.password.length>0&&this.showSheetTabs&&(this.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"));break;case"isProtected":if(this.isProtected){var w=this.element.getElementsByClassName("e-add-sheet-tab")[0];w&&(w.disabled=this.isProtected,this.isProtected?w.classList.contains("e-disabled")&&w.classList.add("e-disabled"):w.classList.contains("e-disabled")||w.classList.remove("e-disabled"))}break;case"allowFreezePane":this.notify(Qn,{prop:"allowFreezePane",onPropertyChange:!0});break;case"allowImage":case"allowChart":this.renderModule.refreshSheet(),this.notify(Qn,{prop:d,onPropertyChange:!0});break;case"calculationMode":"Manual"===n.calculationMode&&this.notify(pe,{action:"ClearDependentCellCollection"}),this.notify(Qn,{prop:d,onPropertyChange:!0});break;case"allowResizing":t.allowResizing&&this.notify(us,{propertyName:d});break;case"enableNotes":t.enableNotes&&this.notify(tr,{});break;case"allowNumberFormatting":case"allowWrap":case"allowCellFormatting":this.notify(Qn,{prop:d,onPropertyChange:!0}),this.notify(tr,{});break;case"showAggregate":this.notify(po,{remove:!this.showAggregate})}}},d.prototype.requiredModules=function(){return Ol(this)},d.prototype.appendTo=function(e){l.prototype.appendTo.call(this,e)},d.prototype.filter=function(e,t){return this.allowFiltering?(t=t||this.getActiveSheet().selectedRange,l.prototype.filter.call(this,e,t)):Promise.reject()},d.prototype.clearFilter=function(e,t){this.notify(Da,{field:e,sheetIndex:t})},d.prototype.applyFilter=function(e,t){var r=this;if(!this.allowFiltering)return Promise.reject();var n,i=new Promise((function(e){e(void 0)}));e&&e.length&&e.forEach((function(e){n={instance:{options:{type:e.type,format:"date"===e.type&&"yMd"}},arg3:e.value,arg2:e.operator},r.notify(tp.fltrPrevent,n),e.value=n.arg3}));var a={predicates:e,range:t,isInternal:!0,promise:i,sIdx:t?p(this,t):this.activeSheetIndex};return this.notify(Aa,a),a.promise},d.prototype.addCustomFunction=function(e,t,r){l.prototype.addCustomFunction.call(this,e,t,r),this.notify(Ua,null)},d.prototype.setRangeReadOnly=function(r,n,i){n=n||this.getActiveSheet().selectedRange;var a=i||this.activeSheetIndex,o=c(t(n)),s=Fn(this,a);if(!(0,e.isNullOrUndefined)(s)){if(this.notify("actionBegin",{action:"readonly",eventArgs:{readOnly:r,range:n,sheetIdx:a}}),Wd(n)||0===o[0]&&o[2]===s.rowCount-1)for(var l=o[1];l<=o[3];l++)if(r)El(s,l,{isReadOnly:r});else{var d=Il(s,l);d&&d.isReadOnly&&delete d.isReadOnly}else if(Gd(n)||0===o[1]&&o[3]===s.colCount-1)for(var h=o[0];h<=o[2];h++)if(r)gl(s,h,{isReadOnly:r});else{var p=fl(s,h);p&&p.isReadOnly&&delete p.isReadOnly}else for(var u=o[1];u<=o[3];u++)for(var f=o[0];f<=o[2];f++){if(r)jn(f,u,s,{isReadOnly:r},!0);else(v=zn(f,u,s))&&v.isReadOnly&&delete v.isReadOnly}for(var g=o[1];g<=o[3];g++)for(var m=o[0];m<=o[2];m++){var v=this.getCell(m,g);!r&&v&&v.classList.contains("e-readonly")?v.classList.remove("e-readonly"):v&&!v.classList.contains("e-readonly")&&(v.className+=" e-readonly")}this.notify("actionComplete",{action:"readonly",eventArgs:{readOnly:r,range:n,sheetIdx:a}})}},lp([(0,e.Property)("")],d.prototype,"cssClass",void 0),lp([(0,e.Property)(!0)],d.prototype,"allowScrolling",void 0),lp([(0,e.Property)(!0)],d.prototype,"allowResizing",void 0),lp([(0,e.Property)(!0)],d.prototype,"showAggregate",void 0),lp([(0,e.Property)(!0)],d.prototype,"enableClipboard",void 0),lp([(0,e.Property)(!0)],d.prototype,"enableContextMenu",void 0),lp([(0,e.Property)(!0)],d.prototype,"enableKeyboardNavigation",void 0),lp([(0,e.Property)(!0)],d.prototype,"enableKeyboardShortcut",void 0),lp([(0,e.Property)(!0)],d.prototype,"allowUndoRedo",void 0),lp([(0,e.Property)(!0)],d.prototype,"allowWrap",void 0),lp([(0,e.Complex)({},Qd)],d.prototype,"selectionSettings",void 0),lp([(0,e.Complex)({},Jd)],d.prototype,"scrollSettings",void 0),lp([(0,e.Event)()],d.prototype,"beforeCellRender",void 0),lp([(0,e.Event)()],d.prototype,"beforeSelect",void 0),lp([(0,e.Event)()],d.prototype,"select",void 0),lp([(0,e.Event)()],d.prototype,"contextMenuBeforeOpen",void 0),lp([(0,e.Event)()],d.prototype,"fileMenuBeforeOpen",void 0),lp([(0,e.Event)()],d.prototype,"contextMenuBeforeClose",void 0),lp([(0,e.Event)()],d.prototype,"dialogBeforeOpen",void 0),lp([(0,e.Event)()],d.prototype,"fileMenuBeforeClose",void 0),lp([(0,e.Event)()],d.prototype,"contextMenuItemSelect",void 0),lp([(0,e.Event)()],d.prototype,"fileMenuItemSelect",void 0),lp([(0,e.Event)()],d.prototype,"beforeDataBound",void 0),lp([(0,e.Event)()],d.prototype,"dataBound",void 0),lp([(0,e.Event)()],d.prototype,"dataSourceChanged",void 0),lp([(0,e.Event)()],d.prototype,"cellEdit",void 0),lp([(0,e.Event)()],d.prototype,"cellEditing",void 0),lp([(0,e.Event)()],d.prototype,"cellEdited",void 0),lp([(0,e.Event)()],d.prototype,"cellSave",void 0),lp([(0,e.Event)()],d.prototype,"beforeCellSave",void 0),lp([(0,e.Event)()],d.prototype,"created",void 0),lp([(0,e.Event)()],d.prototype,"beforeSort",void 0),lp([(0,e.Event)()],d.prototype,"beforeHyperlinkCreate",void 0),lp([(0,e.Event)()],d.prototype,"afterHyperlinkCreate",void 0),lp([(0,e.Event)()],d.prototype,"beforeHyperlinkClick",void 0),lp([(0,e.Event)()],d.prototype,"afterHyperlinkClick",void 0),lp([(0,e.Event)()],d.prototype,"beforeConditionalFormat",void 0),lp([(0,e.Event)()],d.prototype,"actionBegin",void 0),lp([(0,e.Event)()],d.prototype,"actionComplete",void 0),lp([(0,e.Event)()],d.prototype,"openComplete",void 0),lp([(0,e.Event)()],d.prototype,"sortComplete",void 0),lp([(0,e.Property)("USD")],d.prototype,"currencyCode",void 0),d=h=lp([e.NotifyPropertyChanges],d)}(hl)})(),f})()));